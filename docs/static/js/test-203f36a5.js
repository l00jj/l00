var be=Object.defineProperty;var ge=(R,e,t)=>e in R?be(R,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):R[e]=t;var i=(R,e,t)=>(ge(R,typeof e!="symbol"?e+"":e,t),t);import{_ as me}from"./plugin-vue_export-helper-4223c0cf.js";import{V as se,P as J,Q as Fe,d as he,h as Re,i as ve,l as Ae,o as pe,b as Ee,e as Ce,s as de,F as Be,v as Pe,H as Se}from"./vendor-ba83ea21.js";import{T as we}from"./TopMenu-afa628d4.js";import{E as Ie}from"./EventEmitter-80978bd8.js";import{S as De}from"./Stats-e2b670fc.js";import{D as ye}from"./DatGui-dad81371.js";/* empty css              */var Ue=(()=>{var R=function(r){window.console&&window.console.log&&window.console.log(r)},e=function(r){window.console&&window.console.error?window.console.error(r):R(r)},t={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},bindBuffer:{2:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}},bufferData:{3:{0:!0,2:!0},4:{0:!0,2:!0},5:{0:!0,2:!0}},bufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},copyBufferSubData:{5:{0:!0,1:!0}},getBufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},blitFramebuffer:{10:{8:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]},9:!0}},framebufferTextureLayer:{5:{0:!0,1:!0}},invalidateFramebuffer:{2:{0:!0}},invalidateSubFramebuffer:{6:{0:!0}},readBuffer:{1:{0:!0}},getInternalformatParameter:{3:{0:!0,1:!0,2:!0}},renderbufferStorageMultisample:{5:{0:!0,2:!0}},texStorage2D:{5:{0:!0,2:!0}},texStorage3D:{6:{0:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0},10:{0:!0,2:!0,6:!0,7:!0}},texImage3D:{10:{0:!0,2:!0,7:!0,8:!0},11:{0:!0,2:!0,7:!0,8:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0},10:{0:!0,6:!0,7:!0}},texSubImage3D:{11:{0:!0,8:!0,9:!0},12:{0:!0,8:!0,9:!0}},copyTexSubImage3D:{9:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0},8:{0:!0,2:!0},9:{0:!0,2:!0}},compressedTexImage3D:{8:{0:!0,2:!0},9:{0:!0,2:!0},10:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0},9:{0:!0,6:!0},10:{0:!0,6:!0}},compressedTexSubImage3D:{10:{0:!0,8:!0},11:{0:!0,8:!0},12:{0:!0,8:!0}},vertexAttribIPointer:{5:{2:!0}},drawArraysInstanced:{4:{0:!0}},drawElementsInstanced:{5:{0:!0,2:!0}},drawRangeElements:{6:{0:!0,4:!0}},readPixels:{7:{4:!0,5:!0},8:{4:!0,5:!0}},clearBufferfv:{3:{0:!0},4:{0:!0}},clearBufferiv:{3:{0:!0},4:{0:!0}},clearBufferuiv:{3:{0:!0},4:{0:!0}},clearBufferfi:{4:{0:!0}},beginQuery:{2:{0:!0}},endQuery:{1:{0:!0}},getQuery:{2:{0:!0,1:!0}},getQueryParameter:{2:{1:!0}},samplerParameteri:{3:{1:!0,2:!0}},samplerParameterf:{3:{1:!0}},getSamplerParameter:{2:{1:!0}},fenceSync:{2:{0:!0,1:{enumBitwiseOr:[]}}},clientWaitSync:{3:{1:{enumBitwiseOr:["SYNC_FLUSH_COMMANDS_BIT"]}}},waitSync:{3:{1:{enumBitwiseOr:[]}}},getSyncParameter:{2:{1:!0}},bindTransformFeedback:{2:{0:!0}},beginTransformFeedback:{1:{0:!0}},transformFeedbackVaryings:{3:{2:!0}},bindBufferBase:{3:{0:!0}},bindBufferRange:{5:{0:!0}},getIndexedParameter:{2:{0:!0}},getActiveUniforms:{3:{2:!0}},getActiveUniformBlockParameter:{3:{2:!0}}},a=null,n=null;function o(r){if(a==null){a={},n={};for(var c in r)typeof r[c]=="number"&&(a[r[c]]=c,n[c]=r[c])}}function u(){if(a==null)throw"WebGLDebugUtils.init(ctx) not called"}function f(r){return u(),a[r]!==void 0}function l(r){u();var c=a[r];return c!==void 0?"gl."+c:"/*UNKNOWN WebGL ENUM*/ 0x"+r.toString(16)}function E(r,c,p,h){var s=t[r];if(s!==void 0){var s=s[c];if(s!==void 0&&s[p])if(typeof s[p]=="object"&&s[p].enumBitwiseOr!==void 0){for(var C=s[p].enumBitwiseOr,_=0,F=[],y=0;y<C.length;++y){var b=n[C[y]];(h&b)!==0&&(_|=b,F.push(l(b)))}return _===h?F.join(" | "):l(h)}else return l(h)}return h===null?"null":h===void 0?"undefined":h.toString()}function g(r,c){for(var p="",h=c.length,s=0;s<h;++s)p+=(s==0?"":", ")+E(r,h,s,c[s]);return p}function T(r,c,p){r.__defineGetter__(p,function(){return c[p]}),r.__defineSetter__(p,function(h){c[p]=h})}function v(r,c,p,h){h=h||r,o(r),c=c||function(b,w,M){for(var B="",U=M.length,N=0;N<U;++N)B+=(N==0?"":", ")+E(w,U,N,M[N]);e("WebGL error "+l(b)+" in "+w+"("+B+")")};var s={};function C(b,w){return function(){p&&p(w,arguments);var M=b[w].apply(b,arguments),B=h.getError();return B!=0&&(s[B]=!0,c(B,w,arguments)),M}}var _={};for(var F in r)if(typeof r[F]=="function")if(F!="getExtension")_[F]=C(r,F);else{var y=C(r,F);_[F]=function(){var b=y.apply(r,arguments);return b?v(b,c,p,h):null}}else T(_,r,F);return _.getError=function(){for(var b in s)if(s.hasOwnProperty(b)&&s[b])return s[b]=!1,b;return r.NO_ERROR},_}function L(r){var c=!!r.createTransformFeedback;c&&r.bindVertexArray(null);var p=r.getParameter(r.MAX_VERTEX_ATTRIBS),h=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,h);for(var s=0;s<p;++s)r.disableVertexAttribArray(s),r.vertexAttribPointer(s,4,r.FLOAT,!1,0,0),r.vertexAttrib1f(s,0),c&&r.vertexAttribDivisor(s,0);r.deleteBuffer(h);for(var C=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS),s=0;s<C;++s)r.activeTexture(r.TEXTURE0+s),r.bindTexture(r.TEXTURE_CUBE_MAP,null),r.bindTexture(r.TEXTURE_2D,null),c&&(r.bindTexture(r.TEXTURE_2D_ARRAY,null),r.bindTexture(r.TEXTURE_3D,null),r.bindSampler(s,null));if(r.activeTexture(r.TEXTURE0),r.useProgram(null),r.bindBuffer(r.ARRAY_BUFFER,null),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.bindRenderbuffer(r.RENDERBUFFER,null),r.disable(r.BLEND),r.disable(r.CULL_FACE),r.disable(r.DEPTH_TEST),r.disable(r.DITHER),r.disable(r.SCISSOR_TEST),r.blendColor(0,0,0,0),r.blendEquation(r.FUNC_ADD),r.blendFunc(r.ONE,r.ZERO),r.clearColor(0,0,0,0),r.clearDepth(1),r.clearStencil(-1),r.colorMask(!0,!0,!0,!0),r.cullFace(r.BACK),r.depthFunc(r.LESS),r.depthMask(!0),r.depthRange(0,1),r.frontFace(r.CCW),r.hint(r.GENERATE_MIPMAP_HINT,r.DONT_CARE),r.lineWidth(1),r.pixelStorei(r.PACK_ALIGNMENT,4),r.pixelStorei(r.UNPACK_ALIGNMENT,4),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.UNPACK_COLORSPACE_CONVERSION_WEBGL&&r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.BROWSER_DEFAULT_WEBGL),r.polygonOffset(0,0),r.sampleCoverage(1,!1),r.scissor(0,0,r.canvas.width,r.canvas.height),r.stencilFunc(r.ALWAYS,0,4294967295),r.stencilMask(4294967295),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),r.viewport(0,0,r.canvas.width,r.canvas.height),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT|r.STENCIL_BUFFER_BIT),c){r.drawBuffers([r.BACK]),r.readBuffer(r.BACK),r.bindBuffer(r.COPY_READ_BUFFER,null),r.bindBuffer(r.COPY_WRITE_BUFFER,null),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),r.bindBuffer(r.PIXEL_UNPACK_BUFFER,null);for(var _=r.getParameter(r.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS),s=0;s<_;++s)r.bindBufferBase(r.TRANSFORM_FEEDBACK_BUFFER,s,null);for(var F=r.getParameter(r.MAX_UNIFORM_BUFFER_BINDINGS),s=0;s<F;++s)r.bindBufferBase(r.UNIFORM_BUFFER,s,null);r.disable(r.RASTERIZER_DISCARD),r.pixelStorei(r.UNPACK_IMAGE_HEIGHT,0),r.pixelStorei(r.UNPACK_SKIP_IMAGES,0),r.pixelStorei(r.UNPACK_ROW_LENGTH,0),r.pixelStorei(r.UNPACK_SKIP_ROWS,0),r.pixelStorei(r.UNPACK_SKIP_PIXELS,0),r.pixelStorei(r.PACK_ROW_LENGTH,0),r.pixelStorei(r.PACK_SKIP_ROWS,0),r.pixelStorei(r.PACK_SKIP_PIXELS,0),r.hint(r.FRAGMENT_SHADER_DERIVATIVE_HINT,r.DONT_CARE)}for(;r.getError(););}function X(r){var c,s,p=[],h=[],s={},C=1,_=!1,F=[],y=0,b=0,w=!1,M=0,B,U={};r.getContext=function(d){return function(){var m=d.apply(r,arguments);if(m instanceof WebGLRenderingContext||window.WebGL2RenderingContext&&m instanceof WebGL2RenderingContext){if(m!=c){if(c)throw"got different context";B=window.WebGL2RenderingContext&&m instanceof WebGL2RenderingContext,c=m,s=Te(c)}return s}return m}}(r.getContext);function N(d){return typeof d=="function"?d:function(m){d.handleEvent(m)}}var Q=function(d){p.push(N(d))},te=function(d){h.push(N(d))};function re(d){var m=d.addEventListener;d.addEventListener=function(I,S,k){switch(I){case"webglcontextlost":Q(S);break;case"webglcontextrestored":te(S);break;default:m.apply(d,arguments)}}}re(r),r.loseContext=function(){if(!_){for(_=!0,y=0,++C;c.getError(););V(),U[c.CONTEXT_LOST_WEBGL]=!0;var d=ce("context lost"),m=p.slice();setTimeout(function(){for(var I=0;I<m.length;++I)m[I](d);M>=0&&setTimeout(function(){r.restoreContext()},M)},0)}},r.restoreContext=function(){_&&h.length&&setTimeout(function(){if(!w)throw"can not restore. webglcontestlost listener did not call event.preventDefault";K(),L(c),_=!1,b=0,w=!1;for(var d=h.slice(),m=ce("context restored"),I=0;I<d.length;++I)d[I](m)},0)},r.loseContextInNCalls=function(d){if(_)throw"You can not ask a lost contet to be lost";y=b+d},r.getNumCalls=function(){return b},r.setRestoreTimeout=function(d){M=d};function V(){for(var d=Object.keys(U),m=0;m<d.length;++m)delete U[d[m]]}function P(){++b,_||y==b&&r.loseContext()}function Z(d,m){var I=d[m];return function(){if(P(),!_){var S=I.apply(d,arguments);return S}}}function K(){for(var d=0;d<F.length;++d){var m=F[d];m instanceof WebGLBuffer?c.deleteBuffer(m):m instanceof WebGLFramebuffer?c.deleteFramebuffer(m):m instanceof WebGLProgram?c.deleteProgram(m):m instanceof WebGLRenderbuffer?c.deleteRenderbuffer(m):m instanceof WebGLShader?c.deleteShader(m):m instanceof WebGLTexture?c.deleteTexture(m):B&&(m instanceof WebGLQuery?c.deleteQuery(m):m instanceof WebGLSampler?c.deleteSampler(m):m instanceof WebGLSync?c.deleteSync(m):m instanceof WebGLTransformFeedback?c.deleteTransformFeedback(m):m instanceof WebGLVertexArrayObject&&c.deleteVertexArray(m))}}function ce(d){return{statusMessage:d,preventDefault:function(){w=!0}}}return r;function Te(d){for(var m in d)typeof d[m]=="function"?s[m]=Z(d,m):T(s,d,m);s.getError=function(){if(P(),!_)for(var A;A=c.getError();)U[A]=!0;for(var A in U)if(U[A])return delete U[A],A;return s.NO_ERROR};var I=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"];B&&I.push("createQuery","createSampler","fenceSync","createTransformFeedback","createVertexArray");for(var S=0;S<I.length;++S){var k=I[S];s[k]=function(A){return function(){if(P(),_)return null;var ne=A.apply(d,arguments);return ne.__webglDebugContextLostId__=C,F.push(ne),ne}}(d[k])}var ie=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];B&&ie.push("getInternalformatParameter","getQuery","getQueryParameter","getSamplerParameter","getSyncParameter","getTransformFeedbackVarying","getIndexedParameter","getUniformIndices","getActiveUniforms","getActiveUniformBlockParameter","getActiveUniformBlockName");for(var S=0;S<ie.length;++S){var k=ie[S];s[k]=function(oe){return function(){return P(),_?null:oe.apply(d,arguments)}}(s[k])}var ae=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];B&&ae.push("isQuery","isSampler","isSync","isTransformFeedback","isVertexArray");for(var S=0;S<ae.length;++S){var k=ae[S];s[k]=function(oe){return function(){return P(),_?!1:oe.apply(d,arguments)}}(s[k])}return s.checkFramebufferStatus=function(A){return function(){return P(),_?s.FRAMEBUFFER_UNSUPPORTED:A.apply(d,arguments)}}(s.checkFramebufferStatus),s.getAttribLocation=function(A){return function(){return P(),_?-1:A.apply(d,arguments)}}(s.getAttribLocation),s.getVertexAttribOffset=function(A){return function(){return P(),_?0:A.apply(d,arguments)}}(s.getVertexAttribOffset),s.isContextLost=function(){return _},B&&(s.getFragDataLocation=function(A){return function(){return P(),_?-1:A.apply(d,arguments)}}(s.getFragDataLocation),s.clientWaitSync=function(A){return function(){return P(),_?s.WAIT_FAILED:A.apply(d,arguments)}}(s.clientWaitSync),s.getUniformBlockIndex=function(A){return function(){return P(),_?s.INVALID_INDEX:A.apply(d,arguments)}}(s.getUniformBlockIndex)),s}}return{init:o,mightBeEnum:f,glEnumToString:l,glFunctionArgToString:E,glFunctionArgsToString:g,makeDebugContext:v,makeLostContextSimulatingCanvas:X,resetToInitialState:L}})();const x=class{constructor(e,t={fit:x.Fit_Contain}){i(this,"main");i(this,"width",0);i(this,"height",0);i(this,"pixelRatio",1);i(this,"fit",x.Fit_None);this.main=e,this.update({fit:t!=null&&t.fit?t.fit:x.Fit_None}),x.resizeObserve(this)}static resizeObserve(e){const t=e.main;if(window.ResizeObserver){const a=new ResizeObserver(n=>e.update());a.observe(t.viewContainerDom),t.onDestroyed(()=>a.disconnect())}else{const a=()=>e.update();window.addEventListener("resize",a),t.onDestroyed(()=>window.removeEventListener("resize",a))}}update(e={}){let{width:t,height:a,fit:n}=e;const{viewContainerDom:o,canvasDom:u}=this.main;if(!o||!u)return;const f=(l,E)=>{this.width=l,this.height=E,u.width=l,u.height=E};n&&n!==this.fit&&x.fitMap.hasOwnProperty(n)&&(this.fit=n,u.style.objectFit=x.fitMap[this.fit]),this.fit===x.Fit_None?(t=t||o.offsetWidth,a=a||o.offsetHeight,f(t,a),u.style.width=t+"px",u.style.height=a+"px",o.style.width=t+"px",o.style.height=a+"px"):(this.width!==t||this.height!==a)&&t&&a&&(f(t,a),u.style.width="100%",u.style.height="100%",o.style.width="100%",o.style.height="100%"),this.pixelRatio=Math.min(window.devicePixelRatio,2),this.main.emit(O.Event_Resize)}onResize(e){return this.main.on(O.Event_Resize,e)}};let G=x;i(G,"Fit_Contain",Symbol()),i(G,"Fit_Cover",Symbol()),i(G,"Fit_Fill",Symbol()),i(G,"Fit_None",Symbol()),i(G,"fitMap",{[x.Fit_Contain]:"contain",[x.Fit_Cover]:"cover",[x.Fit_Fill]:"fill",[x.Fit_None]:"none"});class xe{constructor(e){i(this,"main");i(this,"time");i(this,"start");i(this,"current");i(this,"elapsed");i(this,"delta");i(this,"requestAnimationFrameID",0);i(this,"onTickLoopFunction",e=>{this.current=Date.now();const t=performance.now();this.delta=t-this.time,this.time=t,this.elapsed+=this.delta,this.main.emit(O.Event_Tick),this.currentTickLoopFunction&&(this.requestAnimationFrameID=window.requestAnimationFrame(this.currentTickLoopFunction))});i(this,"currentTickLoopFunction");i(this,"isTicking",!1);this.main=e,this.start=Date.now(),this.current=this.start,this.time=performance.now(),this.elapsed=0,this.delta=16}tick(){this.currentTickLoopFunction||(this.currentTickLoopFunction=this.main.params.helper.stats.enable?e=>{var t,a;(t=this.main.stats)==null||t.begin(),this.onTickLoopFunction(e),(a=this.main.stats)==null||a.end()}:this.onTickLoopFunction,this.isTicking||(this.isTicking=!0,this.time=performance.now()-1e3/60,this.currentTickLoopFunction(window.performance.now())))}paused(){this.isTicking&&(window.cancelAnimationFrame(this.requestAnimationFrameID),this.currentTickLoopFunction=void 0,this.isTicking=!1)}onTick(e){return this.main.on(O.Event_Tick,e)}}class Le{constructor(e){i(this,"main");i(this,"datGui");this.main=e,this.datGui=new ye(this.main.viewContainerDom),this.main.onDestroyed(()=>this.datGui.destroy()),Promise.resolve().then(()=>this.init())}init(){this.main,this.datGui}}const ee=class extends Ie{constructor(t){super();i(this,"params",{helper:{stats:{enable:!0},gui:{enable:!0}}});i(this,"time");i(this,"sizes");i(this,"viewContainerDom");i(this,"renderer");i(this,"canvasDom",window.document.createElement("canvas"));i(this,"stats");i(this,"guiHelper");this.viewContainerDom=t,this.viewContainerDom.appendChild(this.canvasDom),this.params.helper.stats.enable&&(this.stats=new De(this.viewContainerDom)),this.params.helper.gui.enable&&(this.guiHelper=new Le(this)),this.time=new xe(this),this.sizes=new G(this,{fit:G.Fit_Contain}),this.renderer=new le(this)}render(){this.time.tick()}paused(){this.time.paused()}onDestroyed(t){return this.once(ee.Event_Destroyed,t)}destroy(){this.time.paused(),this.emit(ee.Event_Destroyed)}};let O=ee;i(O,"Event_Tick",Symbol()),i(O,"Event_Resize",Symbol()),i(O,"Event_Destroyed",Symbol());class Me{constructor(e,t,a,n){i(this,"qualifier");i(this,"type");i(this,"name");i(this,"location");this.qualifier=e,this.type=t,this.name=a,this.location=n}}class W{constructor(e,t){i(this,"variables",{});i(this,"vertexShaderSource");i(this,"fragmentShaderSource");i(this,"program");i(this,"init");this.vertexShaderSource=e,this.fragmentShaderSource=t,this.init=a=>(Reflect.deleteProperty(this,"init"),!!W.createShader(a,this))}static createShader(e,t){const a=W.createProgram(e,t.vertexShaderSource,t.fragmentShaderSource);if(!a)throw new Error("Failed to create program");t.program=a;const n=new Set,o=u=>{const f=u.match(/\b(attribute|uniform) [^;]+(?=;)/g);f&&(f==null?void 0:f.length)&&f.forEach(l=>n.add(l))};if(o(t.vertexShaderSource),o(t.fragmentShaderSource),n.size)for(let u of n){const f=u.toString().split(" ");if(f.length!==3)continue;const l=/\w/.test(f[2])?f[2]:null;if(!l)continue;const E=/\w/.test(f[1])?f[1]:null;if(!E)continue;const g=/\w/.test(f[0])?f[0]:null;if(!g)continue;const T=g==="attribute"?e.getAttribLocation(a,l):g==="uniform"?e.getUniformLocation(a,l):null;T!==null&&(t.variables[l]=new Me(g,E,l,T))}return a}static createProgram(e,t,a){const n=W.loadShader(e,e.VERTEX_SHADER,t),o=W.loadShader(e,e.FRAGMENT_SHADER,a);if(!n||!o)return null;const u=e.createProgram();if(!u)return null;e.attachShader(u,n),e.attachShader(u,o),e.linkProgram(u);var f=e.getProgramParameter(u,e.LINK_STATUS);if(!f){var l=e.getProgramInfoLog(u);return console.log("Failed to link program: "+l),e.deleteProgram(u),e.deleteShader(o),e.deleteShader(n),null}return u}static loadShader(e,t,a){const n=e.createShader(t);if(n===null)return console.log("unable to create shader"),null;e.shaderSource(n,a),e.compileShader(n);var o=e.getShaderParameter(n,e.COMPILE_STATUS);if(!o){var u=e.getShaderInfoLog(n);throw console.log("Failed to compile shader: "+u),e.deleteShader(n),new Error(u==null?void 0:u.toString())}return n}}const j=class{constructor(){i(this,"type");i(this,"texture");i(this,"image")}setImage(e){this.type=j.types.image,this.image=e}static setImageTexture(e,t,a){t.texture&&e.deleteTexture(t.texture);const n=e.createTexture();if(!n)throw new Error("can not WebGLRenderingContextBase.createTexture()");return e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1),e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a),e.bindTexture(e.TEXTURE_2D,null),t.texture=n,!0}update(e){return this.type===j.types.image&&this.image?j.setImageTexture(e,this,this.image):!1}};let $=j;i($,"types",{image:Symbol()});const fe=class{constructor(){i(this,"isViewMatrixChanged",!0);i(this,"viewMatrix",new J);i(this,"position",new se(0,0,0));i(this,"up",fe.DefaultUp.clone())}lookAt(e,t,a){this.viewMatrix.identity(),this.viewMatrix.lookAt(this.position,new se(e,t,a),this.up),this.isViewMatrixChanged=!0}};let z=fe;i(z,"DefaultUp",new se(0,1,0)),i(z,"DraftMatrix",new J);class Ne extends z{constructor(){super();i(this,"left",-1);i(this,"right",1);i(this,"top",1);i(this,"bottom",-1);i(this,"near",.1);i(this,"far",2e3);i(this,"projectionMatrix",new J);i(this,"pvMatrix",new J);this.update()}update(t=-1,a=1,n=1,o=-1,u=.1,f=2e3){this.left=t,this.right=a,this.top=n,this.bottom=o,this.near=u,this.far=f,this.projectionMatrix.identity().makeOrthographic(t,a,n,o,u,f)}getPVMatrix(){return this.isViewMatrixChanged&&(this.pvMatrix.identity().multiply(this.viewMatrix).multiply(this.projectionMatrix),this.isViewMatrixChanged=!1),this.pvMatrix.elements}}const Y=class{constructor(e){i(this,"buffer");i(this,"bufferTypeID");i(this,"bufferType");i(this,"data");i(this,"dataNumber");i(this,"dataTypeID");i(this,"dataType");this.bufferTypeID=e}setData(e,t,a){this.data=e,this.dataNumber=t,this.dataTypeID=a}update(e){if(this.bufferType=this.bufferTypeID===Y.ARRAY_BUFFER?e.ARRAY_BUFFER:this.bufferTypeID===Y.ELEMENT_ARRAY_BUFFER?e.ELEMENT_ARRAY_BUFFER:NaN,this.dataType=this.dataTypeID===Y.FLOAT?e.FLOAT:this.dataTypeID===Y.UNSIGNED_BYTE?e.UNSIGNED_BYTE:NaN,Number.isNaN(this.bufferTypeID))throw new Error("Unknown Buffer type");if(Number.isNaN(this.dataTypeID))throw new Error("Unknown Data type");Y.createBuffer(this,e,this.bufferType,this.data)}static createBuffer(e,t,a,n){const o=t.createBuffer();if(!o)throw new Error("Failed to create the buffer object");t.bindBuffer(a,o),t.bufferData(a,n,t.STATIC_DRAW),e.buffer=o}};let D=Y;i(D,"ARRAY_BUFFER",Symbol()),i(D,"ELEMENT_ARRAY_BUFFER",Symbol()),i(D,"FLOAT",Symbol()),i(D,"UNSIGNED_BYTE",Symbol());class Oe{constructor(){}}class ke extends Oe{constructor(t,a,n){super();i(this,"vertexsBuffer");i(this,"texCoordsBuffer");i(this,"indicesBuffer");i(this,"isNeedUpdata",!1);const o=new Float32Array([t/2,a/2,n,t/-2,a/2,n,t/-2,a/-2,n,t/2,a/-2,n]);this.vertexsBuffer=new D(D.ARRAY_BUFFER),this.vertexsBuffer.setData(o,3,D.FLOAT);const u=new Float32Array([1,1,0,1,0,0,1,0]);this.texCoordsBuffer=new D(D.ARRAY_BUFFER),this.texCoordsBuffer.setData(u,2,D.FLOAT);const f=new Uint8Array([0,1,2,0,2,3]);this.indicesBuffer=new D(D.ELEMENT_ARRAY_BUFFER),this.indicesBuffer.setData(f,0,D.UNSIGNED_BYTE),this.isNeedUpdata=!0}update(t){!this.isNeedUpdata||(this.vertexsBuffer.update(t),this.texCoordsBuffer.update(t),this.indicesBuffer.update(t),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),this.isNeedUpdata=!1)}}class Ge{constructor(){i(this,"position",[0,0]);i(this,"angle",0);i(this,"speed",0)}}class Xe{constructor(){i(this,"vertexs",{buffer:{}});i(this,"opacitys",{buffer:{}});i(this,"texCoordMatrix",new Fe);i(this,"list",[]);i(this,"isNeedUpdata",!0)}create(e){this.list.length=0;for(let t=0;t<e;t++)this.list.push(new Ge)}update(e){if(!this.isNeedUpdata)return;const t=e.createBuffer();if(!t)return console.log("Failed to create the buffer object"),-1;this.vertexs.buffer=t;const a=e.createBuffer();if(!a)return console.log("Failed to create the buffer object"),-1;this.opacitys.buffer=a,this.isNeedUpdata=!1}}class ue{constructor(){i(this,"width",100);i(this,"height",100);i(this,"isNeedUpdate",!0);i(this,"framebuffer",null);i(this,"depthBuffer",null);i(this,"texture",null)}update(e){const t=()=>{this.framebuffer&&e.deleteFramebuffer(this.framebuffer),this.texture&&e.deleteTexture(this.texture),this.depthBuffer&&e.deleteRenderbuffer(this.depthBuffer)},a=function(){return t(),!1};if(t(),this.framebuffer=e.createFramebuffer(),!this.framebuffer)return console.log("Failed to create frame buffer object"),a();if(this.texture=e.createTexture(),!this.texture)return console.log("Failed to create texture object"),a();if(e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.depthBuffer=e.createRenderbuffer(),!this.depthBuffer)return console.log("Failed to create renderbuffer object"),a();e.bindRenderbuffer(e.RENDERBUFFER,this.depthBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.depthBuffer);var n=e.checkFramebufferStatus(e.FRAMEBUFFER);if(e.FRAMEBUFFER_COMPLETE!==n)return console.log("Frame buffer object is incomplete: "+n.toString()),a();e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindTexture(e.TEXTURE_2D,null),e.bindRenderbuffer(e.RENDERBUFFER,null)}}class We{constructor(){i(this,"brightness",0);i(this,"ratio",0);i(this,"averageRatio",0)}}class Ve{constructor(){i(this,"map",[]);i(this,"width",0);i(this,"height",0)}update(e,t,a){this.map=Array(a).fill(0).map(()=>Array(t)),this.width=t,this.height=a;const n=(f,l,E)=>Math.sqrt(f*f*.299+l*l*.587+E*E*.114);let o=1/0,u=-1/0;for(let f=0,l=e,E=this.map;f<a;f++)for(let g=0;g<t;g++){const T=(f*t+g)*4,v=l[T+0],L=l[T+1],X=l[T+2],r=n(v,L,X),c=new We;c.brightness=r,c.ratio=r/255,E[f][g]=c,o=Math.min(r,o),u=Math.max(r,u)}for(let f=0,l=this.map,E=u-o;f<a;f++)for(let g=0;g<t;g++){const T=l[f][g],v=(T.brightness-o)/E;T.averageRatio=v}}getPixels(e="ratio"){const t=this.width,a=this.height,n=t*a*4,o=new Uint8Array(n);for(let u=0,f=this.map;u<a;u++)for(let l=0;l<t;l++){let E=u*t+l;const g=f[u][l];E*=4;const T=Math.round(g[e]*255);o[E+0]=T,o[E+1]=T,o[E+2]=T,o[E+3]=255}return o}}const q=class{constructor(e,t){i(this,"main");i(this,"camera",new Ne);i(this,"programs",{});i(this,"layers",[]);i(this,"particles",new Xe);i(this,"backgroundPlane");i(this,"currentIndepFrame",new ue);i(this,"lastIndepFrame",new ue);i(this,"particlesIndepFrame",new ue);i(this,"textures",{original:new $});i(this,"particlesDensity",2);i(this,"particlesInitAngle",-45);i(this,"particlesDeflection",0);i(this,"particlesInitPosition","top");i(this,"particleSize",2);i(this,"particlesIsColourful",!0);i(this,"particlesInputColor",[1,1,1]);i(this,"particlesResistance",.5);i(this,"particlesBaseOpacity",.5);i(this,"particlesDynamicOpacity",.5);i(this,"showImgNumber",0);i(this,"isShowImg",!0);i(this,"isContinuedShowImg",!1);i(this,"dynamicsMap",new Ve);i(this,"render",()=>{const{sizes:e,renderer:{gl:t}}=this.main,a=this.programs.imageProgram;if(!a||!a.program)return!1;const n=this.programs.backgroundProgram;if(!n||!n.program)return!1;const o=this.programs.particlesProgram;if(!o||!o.program)return!1;const u=this.camera,f=this.backgroundPlane,l=this.textures.original;if(!l||!l.texture)return!1;let E=null;t.bindFramebuffer(t.FRAMEBUFFER,this.particlesIndepFrame.framebuffer),t.useProgram(o.program);const g=this.dynamicsMap,T=this.particles.list,v=new Float32Array(T.length*2),L=new Float32Array(T.length*1);for(let c=T.length,p=g.width,h=g.height,s=this.particlesDeflection,C=2,_=this.particlesResistance,F=0;F<c;F++){const y=T[F],b=y.position;let w=y.speed,M=0;const B=Math.floor(b[1]+h/2),U=Math.floor(b[0]+p/2);if(U>=0&&U<p&&B>=0&&B<h){const K=g.map[B][U];w=w*(1-_)+w*_*(1-K.averageRatio),M=K.ratio,y.angle+=s*K.averageRatio%360}const N=w,Q=y.angle*Math.PI/180,te=Math.cos(Q)*N,re=Math.sin(Q)*N;let V=b[0]+te+p/2,P=b[1]+re+h/2;P>h+C?P=-C:P<-C&&(P=h+C),V>p+C?V=-C:V<-C&&(V=p+C),b[0]=V-p/2,b[1]=P-h/2;const Z=F*2;v[Z]=b[0],v[Z+1]=b[1],L[F]=M}t.bindBuffer(t.ARRAY_BUFFER,this.particles.vertexs.buffer),t.bufferData(t.ARRAY_BUFFER,v,t.STATIC_DRAW),t.vertexAttribPointer(o.variables.a_Position.location,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(o.variables.a_Position.location),t.bindBuffer(t.ARRAY_BUFFER,this.particles.opacitys.buffer),t.bufferData(t.ARRAY_BUFFER,L,t.STATIC_DRAW),t.vertexAttribPointer(o.variables.a_Opacity.location,1,t.FLOAT,!1,0,0),t.enableVertexAttribArray(o.variables.a_Opacity.location),t.uniformMatrix4fv(o.variables.u_ProjectMatrix.location,!1,u.getPVMatrix()),t.uniformMatrix3fv(o.variables.u_TexCoordMatrix.location,!1,this.particles.texCoordMatrix.elements),t.uniform1f(o.variables.u_ParticleSize.location,this.particleSize),t.uniform1f(o.variables.u_BaseOpacity.location,this.particlesBaseOpacity),t.uniform1f(o.variables.u_DynamicOpacity.location,this.particlesDynamicOpacity),t.uniform4fv(o.variables.u_InputColor.location,[...this.particlesInputColor,this.particlesIsColourful?0:1]),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,l.texture),o.variables.u_Sampler&&t.uniform1i(o.variables.u_Sampler.location,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.drawArrays(t.POINTS,0,T.length),t.bindFramebuffer(t.FRAMEBUFFER,this.currentIndepFrame.framebuffer),t.useProgram(n.program);const X=(c,p)=>{if(!p.buffer)return;const h=c.location;t.bindBuffer(t.ARRAY_BUFFER,p.buffer),t.vertexAttribPointer(h,p.dataNumber,p.dataType,!1,0,0),t.enableVertexAttribArray(h)};if(X(n.variables.a_Position,f.vertexsBuffer),X(n.variables.a_TexCoord,f.texCoordsBuffer),t.uniform4fv(n.variables.u_AddColor.location,[0,0,0,.02]),t.activeTexture(t.TEXTURE0),this.isShowImg){const c=this.showImgNumber===0?l.texture:null;t.bindTexture(t.TEXTURE_2D,c),t.uniform4fv(n.variables.u_AddColor.location,[0,0,0,0])}else t.bindTexture(t.TEXTURE_2D,this.lastIndepFrame.texture);this.isShowImg=this.isContinuedShowImg,t.uniform1i(n.variables.u_Sampler.location,0),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this.particlesIndepFrame.texture),t.uniform1i(n.variables.u_Particles.location,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,f.indicesBuffer.buffer),t.drawElements(t.TRIANGLES,f.indicesBuffer.data.length,f.indicesBuffer.dataType,0),E=this.currentIndepFrame.texture;const r=this.currentIndepFrame;this.currentIndepFrame=this.lastIndepFrame,this.lastIndepFrame=r,t.bindFramebuffer(t.FRAMEBUFFER,null),t.useProgram(a.program),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,E),t.uniform1i(a.variables.u_Sampler.location,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.drawElements(t.TRIANGLES,f.indicesBuffer.data.length,f.indicesBuffer.dataType,0)});this.main=e,this.init(e,t),this.main.once(q.Event_Ready,()=>this.main.time.onTick(()=>this.render()))}init(e,t){t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.clearColor(0,0,0,0);const a=new W(`
attribute vec4 a_Position;
attribute vec2 a_TexCoord;

varying vec2 v_TexCoord;

void main() {
  gl_Position = a_Position;
  v_TexCoord = a_TexCoord;
}`,`
#ifdef GL_ES
precision mediump float;
#endif

uniform sampler2D u_Sampler;

varying vec2 v_TexCoord;

void main() {
  gl_FragColor = texture2D(u_Sampler, v_TexCoord);
}`);if(!a.init||!a.init(t))throw new Error("Shader Program Create Fail");this.programs.imageProgram=a;const n=new W(`
attribute vec4 a_Position;
attribute vec2 a_TexCoord;

uniform mat4 u_ProjectMatrix;

varying vec2 v_TexCoord;
void main() {
  gl_Position = a_Position;
  v_TexCoord = a_TexCoord;
}`,`
#ifdef GL_ES
precision mediump float;
#endif

uniform sampler2D u_Sampler;
uniform sampler2D u_Particles;
uniform vec4 u_AddColor;

varying vec2 v_TexCoord;

vec4 normalMix(vec4 aColor, vec4 bColor) {
  vec4 result = (1.0 - bColor.a) * aColor + bColor.a * bColor;
  result.a = 1.0;
  return result;
}

vec4 addParticles(vec4 aColor, vec4 bColor) {
    vec4 result = (1.0 - bColor.a) * aColor + bColor.a * bColor;
    result.a=1.0;
    return result;
}

void main() {
  //gl_FragColor = normalMix(texture2D(u_Sampler, v_TexCoord), u_AddColor);
  vec4 bg = normalMix(texture2D(u_Sampler, v_TexCoord), u_AddColor);
  //gl_FragColor = normalMix(bg, texture2D(u_Particles, v_TexCoord));
  gl_FragColor = addParticles(bg, texture2D(u_Particles, v_TexCoord));
  //gl_FragColor = texture2D(u_Particles, v_TexCoord);
  //gl_FragColor.a=1.0;
  //gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
  //gl_FragColor = texture2D(u_Sampler, v_TexCoord);
  //gl_FragColor = bg;
}`);if(!n.init||!n.init(t))throw new Error("Shader Program Create Fail");this.programs.backgroundProgram=n;const o=new W(`
attribute vec4 a_Position;
attribute float a_Opacity;

uniform mat4 u_ProjectMatrix;
uniform float u_ParticleSize;
uniform mat3 u_TexCoordMatrix;

varying vec2 v_TexCoord;
varying float v_Opacity;

void main() {
  gl_Position = u_ProjectMatrix * a_Position;
  gl_PointSize = u_ParticleSize;
  v_TexCoord = vec2(u_TexCoordMatrix * vec3(a_Position.xy, 1.0));
  v_Opacity = a_Opacity;
}`,`
#ifdef GL_ES
precision mediump float;
#endif

uniform sampler2D u_Sampler;
uniform vec4 u_InputColor;
uniform float u_BaseOpacity;
uniform float u_DynamicOpacity;

varying vec2 v_TexCoord;
varying float v_Opacity;


void main() {
  // \u70B9\u7684\u6837\u5F0F
  float strength = step(0.5, 1.0 - distance(gl_PointCoord, vec2(0.5)));
  float aValue = clamp((u_BaseOpacity + u_DynamicOpacity * v_Opacity) * strength, 0.0, 1.0);
  gl_FragColor = u_InputColor.a == 0.0 ? texture2D(u_Sampler, v_TexCoord) : u_InputColor;
  gl_FragColor.a = aValue;
}`);if(!o.init||!o.init(t))throw new Error("Shader Program Create Fail");this.programs.particlesProgram=o,this.particles.update(t);const u=new ke(2,2,0);u.update(t),this.backgroundPlane=u}use(e){this.main.paused();const t=new Image,a=()=>{const{sizes:n,renderer:{gl:o}}=this.main;this.textures.original.setImage(t),this.textures.original.update(o);const u=t.naturalWidth,f=t.naturalHeight;n.update({width:u,height:f}),this.camera.update(-n.width/2,n.width/2,n.height/2,-n.height/2,-100,100),o.viewport(0,0,n.width,n.height),this.createMaps(),this.particlesIndepFrame.width=n.width,this.particlesIndepFrame.height=n.height,this.particlesIndepFrame.update(o),this.currentIndepFrame.width=n.width,this.currentIndepFrame.height=n.height,this.currentIndepFrame.update(o),this.lastIndepFrame.width=n.width,this.lastIndepFrame.height=n.height,this.lastIndepFrame.update(o),this.createParticles();const l=this.particles.texCoordMatrix;l.identity(),l.scale(1/n.width,1/n.height),l.translate(.5,.5),this.main.emit(q.Event_Ready),this.main.render()};t.src=e,t.onload=a}createParticles(){const{sizes:e,renderer:{gl:t}}=this.main,a=Math.floor(this.particlesDensity*e.width*e.height/(10*10));this.particles.create(a),this.initParticles(),this.main.emit(q.Event_ParticlesNumber_Changed,a)}initParticles(){const{sizes:e}=this.main,t=this.particles.list,a=this.particlesInitPosition,n=this.particlesInitAngle,o=a==="top"?()=>[(Math.random()-.5)*e.width,.5*e.height]:a==="left"?()=>[-.5*e.width,(Math.random()-.5)*e.height]:()=>[(Math.random()-.5)*e.width,(Math.random()-.5)*e.height];for(let u of t)u.position=o(),u.speed=.5+Math.random()*1.5,u.angle=n}createMaps(){const{sizes:e}=this.main,{gl:t}=this.main.renderer,a=this.programs.imageProgram;if(!a||!a.program)return!1;const n=this.textures.original;if(!n||!n.texture)return!1;const o=this.backgroundPlane,u=e.width,f=e.height;t.bindFramebuffer(t.FRAMEBUFFER,this.currentIndepFrame.framebuffer),t.useProgram(a.program);const l=(T,v)=>{if(!v.buffer)return;const L=T.location;t.bindBuffer(t.ARRAY_BUFFER,v.buffer),t.vertexAttribPointer(L,v.dataNumber,v.dataType,!1,0,0),t.enableVertexAttribArray(L)};l(a.variables.a_Position,o.vertexsBuffer),l(a.variables.a_TexCoord,o.texCoordsBuffer),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,n.texture),t.uniform1i(a.variables.u_Sampler.location,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o.indicesBuffer.buffer),t.drawElements(t.TRIANGLES,o.indicesBuffer.data.length,o.indicesBuffer.dataType,0);const E=u*f*4,g=new Uint8Array(E);t.readPixels(0,0,u,f,t.RGBA,t.UNSIGNED_BYTE,g),this.dynamicsMap.update(g,u,f)}showMaps(){this.main;const{gl:e}=this.main.renderer,t=this.programs.imageProgram;if(!t||!t.program)return!1;const a=this.textures.original;if(!a||!a.texture)return!1;const n=this.backgroundPlane,o=this.dynamicsMap.width,u=this.dynamicsMap.height;e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.useProgram(t.program),e.viewport(0,0,o,u);const f=(g,T)=>{if(!T.buffer)return;const v=g.location;e.bindBuffer(e.ARRAY_BUFFER,T.buffer),e.vertexAttribPointer(v,T.dataNumber,T.dataType,!1,0,0),e.enableVertexAttribArray(v)};f(t.variables.a_Position,n.vertexsBuffer),f(t.variables.a_TexCoord,n.texCoordsBuffer);const l=this.dynamicsMap.getPixels("averageRatio"),E=e.createTexture();e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,0),e.bindTexture(e.TEXTURE_2D,E),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,o,u,0,e.RGBA,e.UNSIGNED_BYTE,l),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,E),e.uniform1i(t.variables.u_Sampler.location,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.indicesBuffer.buffer),e.drawElements(e.TRIANGLES,n.indicesBuffer.data.length,n.indicesBuffer.dataType,0)}};let H=q;i(H,"Event_Ready",Symbol()),i(H,"Event_ParticlesNumber_Changed",Symbol());class le{constructor(e){i(this,"core");i(this,"gl");const t=le.getWebGLContext(e.canvasDom);this.gl=t,this.core=new H(e,t),e.guiHelper&&new Ye(e,this.core)}static getWebGLContext(e,t=!0){const a=["webgl","experimental-webgl","webkit-3d","moz-webgl"];let n=null;for(var o=0;o<a.length;++o){try{n=e.getContext(a[o])}catch{alert("\u6D4F\u89C8\u5668\u4E0D\u652F\u6301 WebGL")}if(n)break}return t&&(n=Ue.makeDebugContext(n)),n}}class Ye{constructor(e,t){if(!e.guiHelper)return;const a=e.guiHelper.datGui.ui,n={toggle(){u.value=!u.value,u.value?(e.render(),f.name("\u6E32\u67D3\u4E2D-\u70B9\u51FB\u6682\u505C")):(e.paused(),f.name("\u6682\u505C\u6E32\u67D3-\u70B9\u51FB\u5F00\u59CB"))},getParticlesNumber(){const s=t.particles.list.length;E.name(`\u5F53\u524D\u7C92\u5B50\u6570: ${s}`)},initParticles(){t.initParticles()},twinkleImg(){t.isShowImg=!0}},o=a.addFolder("Renderer");o.open();const u={value:!0},f=o.add(n,"toggle").name("\u6E32\u67D3\u4E2D-\u70B9\u51FB\u6682\u505C"),l=a.addFolder("Particles");l.open(),l.add(t,"particlesDensity",1,20,1).name("\u7C92\u5B50\u5BC6\u5EA6").onFinishChange(()=>t.createParticles());const E=l.add(n,"getParticlesNumber").name("\u5F53\u524D\u7C92\u5B50\u6570:");e.on(H.Event_ParticlesNumber_Changed,n.getParticlesNumber);const g=l.add(t,"particlesInitPosition",["top","left","random"]).name("\u7C92\u5B50\u51FA\u73B0\u4F4D\u7F6E").onFinishChange(()=>t.initParticles()),T={value:-45},v=l.add(T,"value",[-45,0,-90]).name("\u7C92\u5B50\u8FD0\u52A8\u65B9\u5411").onFinishChange(s=>{t.particlesInitAngle=parseFloat(s.toString()),t.initParticles()}),L=l.add(t,"particlesDeflection",0,2,.01).name("\u7C92\u5B50\u504F\u8F6C"),X=l.add(t,"particlesIsColourful").name("\u7C92\u5B50\u662F\u5426\u8DDF\u968F\u56FE\u7247\u989C\u8272"),r={value:[255,255,255]};l.addColor(r,"value").name("\u7C92\u5B50\u989C\u8272").onFinishChange(()=>t.particlesInputColor=r.value.map(s=>s/255)),l.add(t,"particleSize",1,10,1).name("\u7C92\u5B50\u5927\u5C0F"),l.add(t,"particlesResistance",0,1,.01).name("\u7C92\u5B50\u660E\u5EA6\u963B\u529B\u6BD4\u4F8B"),l.add(t,"particlesBaseOpacity",0,1,.01).name("\u7C92\u5B50\u7684\u56FA\u5B9A\u900F\u660E\u5EA6"),l.add(t,"particlesDynamicOpacity",0,1,.01).name("\u7C92\u5B50\u7684\u52A8\u6001\u900F\u660E\u5EA6"),l.add(n,"initParticles").name("\u91CD\u7F6E\u7C92\u5B50");const c=a.addFolder("Effects");c.open(),c.add(n,"twinkleImg").name("\u95EA\u70C1\u539F\u56FE");const p={demo1(){g.setValue("random"),v.setValue(-45),L.setValue(0),X.setValue(!1)},slantwise(){}},h=a.addFolder("Demo");h.open(),h.add(p,"demo1").name("\u968F\u673A\u5355\u8272\u659C\u4E0B")}}var He="/l00/static/png/example7-229b0c03.png";const Ke={class:"container"},ze=he({name:"Preview",setup(R){const e=Re();return ve(()=>{const t=e.value,a=new O(t);a.renderer.core.use(He),Ae(()=>a.destroy())}),(t,a)=>(pe(),Ee("section",Ke,[Ce("div",{class:"viewContainer",ref_key:"viewContainer",ref:e},null,512)]))}});var je=me(ze,[["__scopeId","data-v-d182f236"],["__file","/Volumes/Work/l00 Studio/l00/source/root/test/particle-rain/Preview.vue"]]);const qe=he({name:"index",setup(R){return(e,t)=>(pe(),Ee(Be,null,[de(we),de(je)],64))}});var Qe=me(qe,[["__file","/Volumes/Work/l00 Studio/l00/source/root/test/particle-rain/index.vue"]]);const _e=Pe(Qe);_e.use(Se);_e.mount("#app");
