var a0=Object.defineProperty;var o0=(c,t,e)=>t in c?a0(c,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[t]=e;var li=(c,t,e)=>(o0(c,typeof t!="symbol"?t+"":t,e),e);import{d as r0,r as _r,v as l0,j as _0,o as e_,c as h0,m as c0,a as Eo,T as u0,F as p0,p as m0,e as f0}from"./vendor-fdd97580.js";import{L as bl,f as ds,F as Ra,g as yn,h as d0,i as qh,D as g0,j as Ya,s as vs,k as Ms,V as Zi,l as yl,m as x0,I as v0,Q as b0,N as y0,n as Jh,o as M0,p as w0,q as X0,r as $h,t as I0,u as z0,R as ka,v as Kh,w as S0,x as Qh,y as Y0,z as Z0,B as L0,H as Ro,J as A0,K as hr,U as T0,X as V0,Y as E0,Z as Ml,_ as C0,b as wl,$ as P0,a0 as tc,a1 as R0,a2 as k0,a3 as B0,a4 as D0,a as Ks,P as ec,a5 as N0,a6 as F0,a7 as O0,a8 as i_,a9 as U0,aa as G0,ab as H0,ac as W0,ad as ic,ae as j0,af as q0,ag as n_,ah as J0,ai as Za,aj as $0,ak as zs,al as K0,am as Q0,an as t1,ao as cr,ap as ur,e as as,d as nc,C as e1,aq as i1,O as n1,A as s1,S as a1,W as o1,G as r1,ar as l1}from"./PublicPath-aeb58d02.js";import{_ as _1}from"./plugin-vue_export-helper-4223c0cf.js";class h1 extends bl{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new f1(e)}),this.register(function(e){return new y1(e)}),this.register(function(e){return new M1(e)}),this.register(function(e){return new d1(e)}),this.register(function(e){return new g1(e)}),this.register(function(e){return new x1(e)}),this.register(function(e){return new v1(e)}),this.register(function(e){return new m1(e)}),this.register(function(e){return new b1(e)}),this.register(function(e){return new u1(e)}),this.register(function(e){return new w1(e)})}load(t,e,i,n){const s=this;let o;this.resourcePath!==""?o=this.resourcePath:this.path!==""?o=this.path:o=ds.extractUrlBase(t),this.manager.itemStart(t);const r=function(a){n?n(a):console.error(a),s.manager.itemError(t),s.manager.itemEnd(t)},_=new Ra(this.manager);_.setPath(this.path),_.setResponseType("arraybuffer"),_.setRequestHeader(this.requestHeader),_.setWithCredentials(this.withCredentials),_.load(t,function(a){try{s.parse(a,o,function(l){e(l),s.manager.itemEnd(t)},r)}catch(l){r(l)}},i,r)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,i,n){let s;const o={},r={};if(typeof t=="string")s=t;else if(ds.decodeText(new Uint8Array(t,0,4))===sc){try{o[zi.KHR_BINARY_GLTF]=new X1(t)}catch(h){n&&n(h);return}s=o[zi.KHR_BINARY_GLTF].content}else s=ds.decodeText(new Uint8Array(t));const _=JSON.parse(s);if(_.asset===void 0||_.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const a=new R1(_,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});a.fileLoader.setRequestHeader(this.requestHeader);for(let l=0;l<this.pluginCallbacks.length;l++){const h=this.pluginCallbacks[l](a);r[h.name]=h,o[h.name]=!0}if(_.extensionsUsed)for(let l=0;l<_.extensionsUsed.length;++l){const h=_.extensionsUsed[l],u=_.extensionsRequired||[];switch(h){case zi.KHR_MATERIALS_UNLIT:o[h]=new p1;break;case zi.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[h]=new S1;break;case zi.KHR_DRACO_MESH_COMPRESSION:o[h]=new I1(_,this.dracoLoader);break;case zi.KHR_TEXTURE_TRANSFORM:o[h]=new z1;break;case zi.KHR_MESH_QUANTIZATION:o[h]=new Y1;break;default:u.indexOf(h)>=0&&r[h]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}a.setExtensions(o),a.setPlugins(r),a.parse(i,n)}parseAsync(t,e){const i=this;return new Promise(function(n,s){i.parse(t,e,n,s)})}}function c1(){let c={};return{get:function(t){return c[t]},add:function(t,e){c[t]=e},remove:function(t){delete c[t]},removeAll:function(){c={}}}}const zi={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class u1{constructor(t){this.parser=t,this.name=zi.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let i=0,n=e.length;i<n;i++){const s=e[i];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(t){const e=this.parser,i="light:"+t;let n=e.cache.get(i);if(n)return n;const s=e.json,_=((s.extensions&&s.extensions[this.name]||{}).lights||[])[t];let a;const l=new yn(16777215);_.color!==void 0&&l.fromArray(_.color);const h=_.range!==void 0?_.range:0;switch(_.type){case"directional":a=new g0(l),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new qh(l),a.distance=h;break;case"spot":a=new d0(l),a.distance=h,_.spot=_.spot||{},_.spot.innerConeAngle=_.spot.innerConeAngle!==void 0?_.spot.innerConeAngle:0,_.spot.outerConeAngle=_.spot.outerConeAngle!==void 0?_.spot.outerConeAngle:Math.PI/4,a.angle=_.spot.outerConeAngle,a.penumbra=1-_.spot.innerConeAngle/_.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+_.type)}return a.position.set(0,0,0),a.decay=2,_.intensity!==void 0&&(a.intensity=_.intensity),a.name=e.createUniqueName(_.name||"light_"+t),n=Promise.resolve(a),e.cache.add(i,n),n}createNodeAttachment(t){const e=this,i=this.parser,s=i.json.nodes[t],r=(s.extensions&&s.extensions[this.name]||{}).light;return r===void 0?null:this._loadLight(r).then(function(_){return i._getNodeRef(e.cache,r,_)})}}class p1{constructor(){this.name=zi.KHR_MATERIALS_UNLIT}getMaterialType(){return Ya}extendParams(t,e,i){const n=[];t.color=new yn(1,1,1),t.opacity=1;const s=e.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const o=s.baseColorFactor;t.color.fromArray(o),t.opacity=o[3]}s.baseColorTexture!==void 0&&n.push(i.assignTexture(t,"map",s.baseColorTexture,vs))}return Promise.all(n)}}class m1{constructor(t){this.parser=t,this.name=zi.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,e){const n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=n.extensions[this.name].emissiveStrength;return s!==void 0&&(e.emissiveIntensity=s),Promise.resolve()}}class f1{constructor(t){this.parser=t,this.name=zi.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:Ms}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],o=n.extensions[this.name];if(o.clearcoatFactor!==void 0&&(e.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&s.push(i.assignTexture(e,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&s.push(i.assignTexture(e,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(s.push(i.assignTexture(e,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const r=o.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new Zi(r,r)}return Promise.all(s)}}class d1{constructor(t){this.parser=t,this.name=zi.KHR_MATERIALS_SHEEN}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:Ms}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[];e.sheenColor=new yn(0,0,0),e.sheenRoughness=0,e.sheen=1;const o=n.extensions[this.name];return o.sheenColorFactor!==void 0&&e.sheenColor.fromArray(o.sheenColorFactor),o.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&s.push(i.assignTexture(e,"sheenColorMap",o.sheenColorTexture,vs)),o.sheenRoughnessTexture!==void 0&&s.push(i.assignTexture(e,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}}class g1{constructor(t){this.parser=t,this.name=zi.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:Ms}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],o=n.extensions[this.name];return o.transmissionFactor!==void 0&&(e.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&s.push(i.assignTexture(e,"transmissionMap",o.transmissionTexture)),Promise.all(s)}}class x1{constructor(t){this.parser=t,this.name=zi.KHR_MATERIALS_VOLUME}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:Ms}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],o=n.extensions[this.name];e.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&s.push(i.assignTexture(e,"thicknessMap",o.thicknessTexture)),e.attenuationDistance=o.attenuationDistance||0;const r=o.attenuationColor||[1,1,1];return e.attenuationColor=new yn(r[0],r[1],r[2]),Promise.all(s)}}class v1{constructor(t){this.parser=t,this.name=zi.KHR_MATERIALS_IOR}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:Ms}extendMaterialParams(t,e){const n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=n.extensions[this.name];return e.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class b1{constructor(t){this.parser=t,this.name=zi.KHR_MATERIALS_SPECULAR}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:Ms}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],o=n.extensions[this.name];e.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&s.push(i.assignTexture(e,"specularIntensityMap",o.specularTexture));const r=o.specularColorFactor||[1,1,1];return e.specularColor=new yn(r[0],r[1],r[2]),o.specularColorTexture!==void 0&&s.push(i.assignTexture(e,"specularColorMap",o.specularColorTexture,vs)),Promise.all(s)}}class y1{constructor(t){this.parser=t,this.name=zi.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,i=e.json,n=i.textures[t];if(!n.extensions||!n.extensions[this.name])return null;const s=n.extensions[this.name],o=e.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,s.source,o)}}class M1{constructor(t){this.parser=t,this.name=zi.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const e=this.name,i=this.parser,n=i.json,s=n.textures[t];if(!s.extensions||!s.extensions[e])return null;const o=s.extensions[e],r=n.images[o.source];let _=i.textureLoader;if(r.uri){const a=i.options.manager.getHandler(r.uri);a!==null&&(_=a)}return this.detectSupport().then(function(a){if(a)return i.loadTextureImage(t,o.source,_);if(n.extensionsRequired&&n.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}}class w1{constructor(t){this.name=zi.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,i=e.bufferViews[t];if(i.extensions&&i.extensions[this.name]){const n=i.extensions[this.name],s=this.parser.getDependency("buffer",n.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([s,o.ready]).then(function(r){const _=n.byteOffset||0,a=n.byteLength||0,l=n.count,h=n.byteStride,u=new ArrayBuffer(l*h),f=new Uint8Array(r[0],_,a);return o.decodeGltfBuffer(new Uint8Array(u),l,h,f,n.mode,n.filter),u})}else return null}}const sc="glTF",xa=12,s_={JSON:1313821514,BIN:5130562};class X1{constructor(t){this.name=zi.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,xa);if(this.header={magic:ds.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==sc)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-xa,n=new DataView(t,xa);let s=0;for(;s<i;){const o=n.getUint32(s,!0);s+=4;const r=n.getUint32(s,!0);if(s+=4,r===s_.JSON){const _=new Uint8Array(t,xa+s,o);this.content=ds.decodeText(_)}else if(r===s_.BIN){const _=xa+s;this.body=t.slice(_,_+o)}s+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class I1{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=zi.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const i=this.json,n=this.dracoLoader,s=t.extensions[this.name].bufferView,o=t.extensions[this.name].attributes,r={},_={},a={};for(const l in o){const h=nl[l]||l.toLowerCase();r[h]=o[l]}for(const l in t.attributes){const h=nl[l]||l.toLowerCase();if(o[l]!==void 0){const u=i.accessors[t.attributes[l]],f=Ba[u.componentType];a[h]=f,_[h]=u.normalized===!0}}return e.getDependency("bufferView",s).then(function(l){return new Promise(function(h){n.decodeDracoFile(l,function(u){for(const f in u.attributes){const m=u.attributes[f],d=_[f];d!==void 0&&(m.normalized=d)}h(u)},r,a)})})}}class z1{constructor(){this.name=zi.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return e.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.offset===void 0&&e.rotation===void 0&&e.scale===void 0||(t=t.clone(),e.offset!==void 0&&t.offset.fromArray(e.offset),e.rotation!==void 0&&(t.rotation=e.rotation),e.scale!==void 0&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}}class il extends yl{constructor(t){super(),this.isGLTFSpecularGlossinessMaterial=!0;const e=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),i=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),n=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),r={specular:{value:new yn().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=r,this.onBeforeCompile=function(_){for(const a in r)_.uniforms[a]=r[a];_.fragmentShader=_.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",e).replace("#include <metalnessmap_pars_fragment>",i).replace("#include <roughnessmap_fragment>",n).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return r.specular.value},set:function(_){r.specular.value=_}},specularMap:{get:function(){return r.specularMap.value},set:function(_){r.specularMap.value=_,_?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return r.glossiness.value},set:function(_){r.glossiness.value=_}},glossinessMap:{get:function(){return r.glossinessMap.value},set:function(_){r.glossinessMap.value=_,_?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}copy(t){return super.copy(t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class S1{constructor(){this.name=zi.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return il}extendParams(t,e,i){const n=e.extensions[this.name];t.color=new yn(1,1,1),t.opacity=1;const s=[];if(Array.isArray(n.diffuseFactor)){const o=n.diffuseFactor;t.color.fromArray(o),t.opacity=o[3]}if(n.diffuseTexture!==void 0&&s.push(i.assignTexture(t,"map",n.diffuseTexture,vs)),t.emissive=new yn(0,0,0),t.glossiness=n.glossinessFactor!==void 0?n.glossinessFactor:1,t.specular=new yn(1,1,1),Array.isArray(n.specularFactor)&&t.specular.fromArray(n.specularFactor),n.specularGlossinessTexture!==void 0){const o=n.specularGlossinessTexture;s.push(i.assignTexture(t,"glossinessMap",o)),s.push(i.assignTexture(t,"specularMap",o,vs))}return Promise.all(s)}createMaterial(t){const e=new il(t);return e.fog=!0,e.color=t.color,e.map=t.map===void 0?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=t.aoMap===void 0?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=t.emissiveIntensity===void 0?1:t.emissiveIntensity,e.emissiveMap=t.emissiveMap===void 0?null:t.emissiveMap,e.bumpMap=t.bumpMap===void 0?null:t.bumpMap,e.bumpScale=1,e.normalMap=t.normalMap===void 0?null:t.normalMap,e.normalMapType=x0,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=t.specularMap===void 0?null:t.specularMap,e.specular=t.specular,e.glossinessMap=t.glossinessMap===void 0?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=t.envMap===void 0?null:t.envMap,e.envMapIntensity=1,e}}class Y1{constructor(){this.name=zi.KHR_MESH_QUANTIZATION}}class bs extends v0{constructor(t,e,i,n){super(t,e,i,n)}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,s=t*n*3+n;for(let o=0;o!==n;o++)e[o]=i[s+o];return e}}bs.prototype.beforeStart_=bs.prototype.copySampleValue_;bs.prototype.afterEnd_=bs.prototype.copySampleValue_;bs.prototype.interpolate_=function(c,t,e,i){const n=this.resultBuffer,s=this.sampleValues,o=this.valueSize,r=o*2,_=o*3,a=i-t,l=(e-t)/a,h=l*l,u=h*l,f=c*_,m=f-_,d=-2*u+3*h,p=u-h,g=1-d,x=p-h+l;for(let b=0;b!==o;b++){const y=s[m+b+o],z=s[m+b+r]*a,M=s[f+b+o],Y=s[f+b]*a;n[b]=g*y+x*z+d*M+p*Y}return n};const Z1=new b0;class L1 extends bs{interpolate_(t,e,i,n){const s=super.interpolate_(t,e,i,n);return Z1.fromArray(s).normalize().toArray(s),s}}const En={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Ba={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},a_={9728:y0,9729:Jh,9984:M0,9985:w0,9986:X0,9987:$h},o_={33071:I0,33648:z0,10497:ka},r_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},nl={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},On={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},A1={CUBICSPLINE:void 0,LINEAR:Kh,STEP:S0},pr={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function T1(c){return c.DefaultMaterial===void 0&&(c.DefaultMaterial=new yl({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:q0})),c.DefaultMaterial}function va(c,t,e){for(const i in e.extensions)c[i]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=e.extensions[i])}function hs(c,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(c.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function V1(c,t,e){let i=!1,n=!1,s=!1;for(let a=0,l=t.length;a<l;a++){const h=t[a];if(h.POSITION!==void 0&&(i=!0),h.NORMAL!==void 0&&(n=!0),h.COLOR_0!==void 0&&(s=!0),i&&n&&s)break}if(!i&&!n&&!s)return Promise.resolve(c);const o=[],r=[],_=[];for(let a=0,l=t.length;a<l;a++){const h=t[a];if(i){const u=h.POSITION!==void 0?e.getDependency("accessor",h.POSITION):c.attributes.position;o.push(u)}if(n){const u=h.NORMAL!==void 0?e.getDependency("accessor",h.NORMAL):c.attributes.normal;r.push(u)}if(s){const u=h.COLOR_0!==void 0?e.getDependency("accessor",h.COLOR_0):c.attributes.color;_.push(u)}}return Promise.all([Promise.all(o),Promise.all(r),Promise.all(_)]).then(function(a){const l=a[0],h=a[1],u=a[2];return i&&(c.morphAttributes.position=l),n&&(c.morphAttributes.normal=h),s&&(c.morphAttributes.color=u),c.morphTargetsRelative=!0,c})}function E1(c,t){if(c.updateMorphTargets(),t.weights!==void 0)for(let e=0,i=t.weights.length;e<i;e++)c.morphTargetInfluences[e]=t.weights[e];if(t.extras&&Array.isArray(t.extras.targetNames)){const e=t.extras.targetNames;if(c.morphTargetInfluences.length===e.length){c.morphTargetDictionary={};for(let i=0,n=e.length;i<n;i++)c.morphTargetDictionary[e[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function C1(c){const t=c.extensions&&c.extensions[zi.KHR_DRACO_MESH_COMPRESSION];let e;return t?e="draco:"+t.bufferView+":"+t.indices+":"+l_(t.attributes):e=c.indices+":"+l_(c.attributes)+":"+c.mode,e}function l_(c){let t="";const e=Object.keys(c).sort();for(let i=0,n=e.length;i<n;i++)t+=e[i]+":"+c[e[i]]+";";return t}function sl(c){switch(c){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function P1(c){return c.search(/\.jpe?g($|\?)/i)>0||c.search(/^data\:image\/jpeg/)===0?"image/jpeg":c.search(/\.webp($|\?)/i)>0||c.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}class R1{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new c1,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,n=navigator.userAgent.indexOf("Firefox")>-1,s=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap=="undefined"||i||n&&s<98?this.textureLoader=new Qh(this.options.manager):this.textureLoader=new Y0(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Ra(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const i=this,n=this.json,s=this.extensions;this.cache.removeAll(),this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const r={scene:o[0][n.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:n.asset,parser:i,userData:{}};va(s,r,n),hs(r,n),Promise.all(i._invokeAll(function(_){return _.afterRoot&&_.afterRoot(r)})).then(function(){t(r)})}).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],i=this.json.meshes||[];for(let n=0,s=e.length;n<s;n++){const o=e[n].joints;for(let r=0,_=o.length;r<_;r++)t[o[r]].isBone=!0}for(let n=0,s=t.length;n<s;n++){const o=t[n];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(i[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(t,e){e!==void 0&&(t.refs[e]===void 0&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,i){if(t.refs[e]<=1)return i;const n=i.clone(),s=(o,r)=>{const _=this.associations.get(o);_!=null&&this.associations.set(r,_);for(const[a,l]of o.children.entries())s(l,r.children[a])};return s(i,n),n.name+="_instance_"+t.uses[e]++,n}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let i=0;i<e.length;i++){const n=t(e[i]);if(n)return n}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const i=[];for(let n=0;n<e.length;n++){const s=t(e[n]);s&&i.push(s)}return i}getDependency(t,e){const i=t+":"+e;let n=this.cache.get(i);if(!n){switch(t){case"scene":n=this.loadScene(e);break;case"node":n=this.loadNode(e);break;case"mesh":n=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(e)});break;case"accessor":n=this.loadAccessor(e);break;case"bufferView":n=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(e)});break;case"buffer":n=this.loadBuffer(e);break;case"material":n=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(e)});break;case"texture":n=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(e)});break;case"skin":n=this.loadSkin(e);break;case"animation":n=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(e)});break;case"camera":n=this.loadCamera(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(i,n)}return n}getDependencies(t){let e=this.cache.get(t);if(!e){const i=this,n=this.json[t+(t==="mesh"?"es":"s")]||[];e=Promise.all(n.map(function(s,o){return i.getDependency(t,o)})),this.cache.add(t,e)}return e}loadBuffer(t){const e=this.json.buffers[t],i=this.fileLoader;if(e.type&&e.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(e.uri===void 0&&t===0)return Promise.resolve(this.extensions[zi.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(s,o){i.load(ds.resolveURL(e.uri,n.path),s,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(i){const n=e.byteLength||0,s=e.byteOffset||0;return i.slice(s,s+n)})}loadAccessor(t){const e=this,i=this.json,n=this.json.accessors[t];if(n.bufferView===void 0&&n.sparse===void 0)return Promise.resolve(null);const s=[];return n.bufferView!==void 0?s.push(this.getDependency("bufferView",n.bufferView)):s.push(null),n.sparse!==void 0&&(s.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(s).then(function(o){const r=o[0],_=r_[n.type],a=Ba[n.componentType],l=a.BYTES_PER_ELEMENT,h=l*_,u=n.byteOffset||0,f=n.bufferView!==void 0?i.bufferViews[n.bufferView].byteStride:void 0,m=n.normalized===!0;let d,p;if(f&&f!==h){const g=Math.floor(u/f),x="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+g+":"+n.count;let b=e.cache.get(x);b||(d=new a(r,g*f,n.count*f/l),b=new Z0(d,f/l),e.cache.add(x,b)),p=new L0(b,_,u%f/l,m)}else r===null?d=new a(n.count*_):d=new a(r,u,n.count*_),p=new Ro(d,_,m);if(n.sparse!==void 0){const g=r_.SCALAR,x=Ba[n.sparse.indices.componentType],b=n.sparse.indices.byteOffset||0,y=n.sparse.values.byteOffset||0,z=new x(o[1],b,n.sparse.count*g),M=new a(o[2],y,n.sparse.count*_);r!==null&&(p=new Ro(p.array.slice(),p.itemSize,p.normalized));for(let Y=0,X=z.length;Y<X;Y++){const w=z[Y];if(p.setX(w,M[Y*_]),_>=2&&p.setY(w,M[Y*_+1]),_>=3&&p.setZ(w,M[Y*_+2]),_>=4&&p.setW(w,M[Y*_+3]),_>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p})}loadTexture(t){const e=this.json,i=this.options,s=e.textures[t].source,o=e.images[s];let r=this.textureLoader;if(o.uri){const _=i.manager.getHandler(o.uri);_!==null&&(r=_)}return this.loadTextureImage(t,s,r)}loadTextureImage(t,e,i){const n=this,s=this.json,o=s.textures[t],r=s.images[e],_=(r.uri||r.bufferView)+":"+o.sampler;if(this.textureCache[_])return this.textureCache[_];const a=this.loadImageSource(e,i).then(function(l){l.flipY=!1,o.name&&(l.name=o.name);const u=(s.samplers||{})[o.sampler]||{};return l.magFilter=a_[u.magFilter]||Jh,l.minFilter=a_[u.minFilter]||$h,l.wrapS=o_[u.wrapS]||ka,l.wrapT=o_[u.wrapT]||ka,n.associations.set(l,{textures:t}),l}).catch(function(){return null});return this.textureCache[_]=a,a}loadImageSource(t,e){const i=this,n=this.json,s=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(h=>h.clone());const o=n.images[t],r=self.URL||self.webkitURL;let _=o.uri||"",a=!1;if(o.bufferView!==void 0)_=i.getDependency("bufferView",o.bufferView).then(function(h){a=!0;const u=new Blob([h],{type:o.mimeType});return _=r.createObjectURL(u),_});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const l=Promise.resolve(_).then(function(h){return new Promise(function(u,f){let m=u;e.isImageBitmapLoader===!0&&(m=function(d){const p=new n_(d);p.needsUpdate=!0,u(p)}),e.load(ds.resolveURL(h,s.path),m,void 0,f)})}).then(function(h){return a===!0&&r.revokeObjectURL(_),h.userData.mimeType=o.mimeType||P1(o.uri),h}).catch(function(h){throw console.error("THREE.GLTFLoader: Couldn't load texture",_),h});return this.sourceCache[t]=l,l}assignTexture(t,e,i,n){const s=this;return this.getDependency("texture",i.index).then(function(o){if(i.texCoord!==void 0&&i.texCoord!=0&&!(e==="aoMap"&&i.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+i.texCoord+" for texture "+e+" not yet supported."),s.extensions[zi.KHR_TEXTURE_TRANSFORM]){const r=i.extensions!==void 0?i.extensions[zi.KHR_TEXTURE_TRANSFORM]:void 0;if(r){const _=s.associations.get(o);o=s.extensions[zi.KHR_TEXTURE_TRANSFORM].extendTexture(o,r),s.associations.set(o,_)}}return n!==void 0&&(o.encoding=n),t[e]=o,o})}assignFinalMaterial(t){const e=t.geometry;let i=t.material;const n=e.attributes.tangent===void 0,s=e.attributes.color!==void 0,o=e.attributes.normal===void 0;if(t.isPoints){const r="PointsMaterial:"+i.uuid;let _=this.cache.get(r);_||(_=new A0,hr.prototype.copy.call(_,i),_.color.copy(i.color),_.map=i.map,_.sizeAttenuation=!1,this.cache.add(r,_)),i=_}else if(t.isLine){const r="LineBasicMaterial:"+i.uuid;let _=this.cache.get(r);_||(_=new T0,hr.prototype.copy.call(_,i),_.color.copy(i.color),this.cache.add(r,_)),i=_}if(n||s||o){let r="ClonedMaterial:"+i.uuid+":";i.isGLTFSpecularGlossinessMaterial&&(r+="specular-glossiness:"),n&&(r+="derivative-tangents:"),s&&(r+="vertex-colors:"),o&&(r+="flat-shading:");let _=this.cache.get(r);_||(_=i.clone(),s&&(_.vertexColors=!0),o&&(_.flatShading=!0),n&&(_.normalScale&&(_.normalScale.y*=-1),_.clearcoatNormalScale&&(_.clearcoatNormalScale.y*=-1)),this.cache.add(r,_),this.associations.set(_,this.associations.get(i))),i=_}i.aoMap&&e.attributes.uv2===void 0&&e.attributes.uv!==void 0&&e.setAttribute("uv2",e.attributes.uv),t.material=i}getMaterialType(){return yl}loadMaterial(t){const e=this,i=this.json,n=this.extensions,s=i.materials[t];let o;const r={},_=s.extensions||{},a=[];if(_[zi.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const h=n[zi.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];o=h.getMaterialType(),a.push(h.extendParams(r,s,e))}else if(_[zi.KHR_MATERIALS_UNLIT]){const h=n[zi.KHR_MATERIALS_UNLIT];o=h.getMaterialType(),a.push(h.extendParams(r,s,e))}else{const h=s.pbrMetallicRoughness||{};if(r.color=new yn(1,1,1),r.opacity=1,Array.isArray(h.baseColorFactor)){const u=h.baseColorFactor;r.color.fromArray(u),r.opacity=u[3]}h.baseColorTexture!==void 0&&a.push(e.assignTexture(r,"map",h.baseColorTexture,vs)),r.metalness=h.metallicFactor!==void 0?h.metallicFactor:1,r.roughness=h.roughnessFactor!==void 0?h.roughnessFactor:1,h.metallicRoughnessTexture!==void 0&&(a.push(e.assignTexture(r,"metalnessMap",h.metallicRoughnessTexture)),a.push(e.assignTexture(r,"roughnessMap",h.metallicRoughnessTexture))),o=this._invokeOne(function(u){return u.getMaterialType&&u.getMaterialType(t)}),a.push(Promise.all(this._invokeAll(function(u){return u.extendMaterialParams&&u.extendMaterialParams(t,r)})))}s.doubleSided===!0&&(r.side=V0);const l=s.alphaMode||pr.OPAQUE;if(l===pr.BLEND?(r.transparent=!0,r.depthWrite=!1):(r.transparent=!1,l===pr.MASK&&(r.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&o!==Ya&&(a.push(e.assignTexture(r,"normalMap",s.normalTexture)),r.normalScale=new Zi(1,1),s.normalTexture.scale!==void 0)){const h=s.normalTexture.scale;r.normalScale.set(h,h)}return s.occlusionTexture!==void 0&&o!==Ya&&(a.push(e.assignTexture(r,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(r.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&o!==Ya&&(r.emissive=new yn().fromArray(s.emissiveFactor)),s.emissiveTexture!==void 0&&o!==Ya&&a.push(e.assignTexture(r,"emissiveMap",s.emissiveTexture,vs)),Promise.all(a).then(function(){let h;return o===il?h=n[zi.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(r):h=new o(r),s.name&&(h.name=s.name),hs(h,s),e.associations.set(h,{materials:t}),s.extensions&&va(n,h,s),h})}createUniqueName(t){const e=E0.sanitizeNodeName(t||"");let i=e;for(let n=1;this.nodeNamesUsed[i];++n)i=e+"_"+n;return this.nodeNamesUsed[i]=!0,i}loadGeometries(t){const e=this,i=this.extensions,n=this.primitiveCache;function s(r){return i[zi.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(r,e).then(function(_){return __(_,r,e)})}const o=[];for(let r=0,_=t.length;r<_;r++){const a=t[r],l=C1(a),h=n[l];if(h)o.push(h.promise);else{let u;a.extensions&&a.extensions[zi.KHR_DRACO_MESH_COMPRESSION]?u=s(a):u=__(new Ml,a,e),n[l]={primitive:a,promise:u},o.push(u)}}return Promise.all(o)}loadMesh(t){const e=this,i=this.json,n=this.extensions,s=i.meshes[t],o=s.primitives,r=[];for(let _=0,a=o.length;_<a;_++){const l=o[_].material===void 0?T1(this.cache):this.getDependency("material",o[_].material);r.push(l)}return r.push(e.loadGeometries(o)),Promise.all(r).then(function(_){const a=_.slice(0,_.length-1),l=_[_.length-1],h=[];for(let f=0,m=l.length;f<m;f++){const d=l[f],p=o[f];let g;const x=a[f];if(p.mode===En.TRIANGLES||p.mode===En.TRIANGLE_STRIP||p.mode===En.TRIANGLE_FAN||p.mode===void 0)g=s.isSkinnedMesh===!0?new C0(d,x):new wl(d,x),g.isSkinnedMesh===!0&&!g.geometry.attributes.skinWeight.normalized&&g.normalizeSkinWeights(),p.mode===En.TRIANGLE_STRIP?g.geometry=h_(g.geometry,P0):p.mode===En.TRIANGLE_FAN&&(g.geometry=h_(g.geometry,tc));else if(p.mode===En.LINES)g=new R0(d,x);else if(p.mode===En.LINE_STRIP)g=new k0(d,x);else if(p.mode===En.LINE_LOOP)g=new B0(d,x);else if(p.mode===En.POINTS)g=new D0(d,x);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);Object.keys(g.geometry.morphAttributes).length>0&&E1(g,s),g.name=e.createUniqueName(s.name||"mesh_"+t),hs(g,s),p.extensions&&va(n,g,p),e.assignFinalMaterial(g),h.push(g)}for(let f=0,m=h.length;f<m;f++)e.associations.set(h[f],{meshes:t,primitives:f});if(h.length===1)return h[0];const u=new Ks;e.associations.set(u,{meshes:t});for(let f=0,m=h.length;f<m;f++)u.add(h[f]);return u})}loadCamera(t){let e;const i=this.json.cameras[t],n=i[i.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?e=new ec(N0.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):i.type==="orthographic"&&(e=new F0(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),i.name&&(e.name=this.createUniqueName(i.name)),hs(e,i),Promise.resolve(e)}loadSkin(t){const e=this.json.skins[t],i={joints:e.joints};return e.inverseBindMatrices===void 0?Promise.resolve(i):this.getDependency("accessor",e.inverseBindMatrices).then(function(n){return i.inverseBindMatrices=n,i})}loadAnimation(t){const i=this.json.animations[t],n=[],s=[],o=[],r=[],_=[];for(let a=0,l=i.channels.length;a<l;a++){const h=i.channels[a],u=i.samplers[h.sampler],f=h.target,m=f.node!==void 0?f.node:f.id,d=i.parameters!==void 0?i.parameters[u.input]:u.input,p=i.parameters!==void 0?i.parameters[u.output]:u.output;n.push(this.getDependency("node",m)),s.push(this.getDependency("accessor",d)),o.push(this.getDependency("accessor",p)),r.push(u),_.push(f)}return Promise.all([Promise.all(n),Promise.all(s),Promise.all(o),Promise.all(r),Promise.all(_)]).then(function(a){const l=a[0],h=a[1],u=a[2],f=a[3],m=a[4],d=[];for(let g=0,x=l.length;g<x;g++){const b=l[g],y=h[g],z=u[g],M=f[g],Y=m[g];if(b===void 0)continue;b.updateMatrix(),b.matrixAutoUpdate=!0;let X;switch(On[Y.path]){case On.weights:X=U0;break;case On.rotation:X=i_;break;case On.position:case On.scale:default:X=O0;break}const w=b.name?b.name:b.uuid,S=M.interpolation!==void 0?A1[M.interpolation]:Kh,V=[];On[Y.path]===On.weights?b.traverse(function(C){C.morphTargetInfluences&&V.push(C.name?C.name:C.uuid)}):V.push(w);let F=z.array;if(z.normalized){const C=sl(F.constructor),A=new Float32Array(F.length);for(let Z=0,L=F.length;Z<L;Z++)A[Z]=F[Z]*C;F=A}for(let C=0,A=V.length;C<A;C++){const Z=new X(V[C]+"."+On[Y.path],y.array,F,S);M.interpolation==="CUBICSPLINE"&&(Z.createInterpolant=function(E){const T=this instanceof i_?L1:bs;return new T(this.times,this.values,this.getValueSize()/3,E)},Z.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),d.push(Z)}}const p=i.name?i.name:"animation_"+t;return new G0(p,void 0,d)})}createNodeMesh(t){const e=this.json,i=this,n=e.nodes[t];return n.mesh===void 0?null:i.getDependency("mesh",n.mesh).then(function(s){const o=i._getNodeRef(i.meshCache,n.mesh,s);return n.weights!==void 0&&o.traverse(function(r){if(!!r.isMesh)for(let _=0,a=n.weights.length;_<a;_++)r.morphTargetInfluences[_]=n.weights[_]}),o})}loadNode(t){const e=this.json,i=this.extensions,n=this,s=e.nodes[t],o=s.name?n.createUniqueName(s.name):"";return function(){const r=[],_=n._invokeOne(function(a){return a.createNodeMesh&&a.createNodeMesh(t)});return _&&r.push(_),s.camera!==void 0&&r.push(n.getDependency("camera",s.camera).then(function(a){return n._getNodeRef(n.cameraCache,s.camera,a)})),n._invokeAll(function(a){return a.createNodeAttachment&&a.createNodeAttachment(t)}).forEach(function(a){r.push(a)}),Promise.all(r)}().then(function(r){let _;if(s.isBone===!0?_=new H0:r.length>1?_=new Ks:r.length===1?_=r[0]:_=new W0,_!==r[0])for(let a=0,l=r.length;a<l;a++)_.add(r[a]);if(s.name&&(_.userData.name=s.name,_.name=o),hs(_,s),s.extensions&&va(i,_,s),s.matrix!==void 0){const a=new ic;a.fromArray(s.matrix),_.applyMatrix4(a)}else s.translation!==void 0&&_.position.fromArray(s.translation),s.rotation!==void 0&&_.quaternion.fromArray(s.rotation),s.scale!==void 0&&_.scale.fromArray(s.scale);return n.associations.has(_)||n.associations.set(_,{}),n.associations.get(_).nodes=t,_})}loadScene(t){const e=this.json,i=this.extensions,n=this.json.scenes[t],s=this,o=new Ks;n.name&&(o.name=s.createUniqueName(n.name)),hs(o,n),n.extensions&&va(i,o,n);const r=n.nodes||[],_=[];for(let a=0,l=r.length;a<l;a++)_.push(ac(r[a],o,e,s));return Promise.all(_).then(function(){const a=l=>{const h=new Map;for(const[u,f]of s.associations)(u instanceof hr||u instanceof n_)&&h.set(u,f);return l.traverse(u=>{const f=s.associations.get(u);f!=null&&h.set(u,f)}),h};return s.associations=a(o),o})}}function ac(c,t,e,i){const n=e.nodes[c];return i.getDependency("node",c).then(function(s){if(n.skin===void 0)return s;let o;return i.getDependency("skin",n.skin).then(function(r){o=r;const _=[];for(let a=0,l=o.joints.length;a<l;a++)_.push(i.getDependency("node",o.joints[a]));return Promise.all(_)}).then(function(r){return s.traverse(function(_){if(!_.isMesh)return;const a=[],l=[];for(let h=0,u=r.length;h<u;h++){const f=r[h];if(f){a.push(f);const m=new ic;o.inverseBindMatrices!==void 0&&m.fromArray(o.inverseBindMatrices.array,h*16),l.push(m)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',o.joints[h])}_.bind(new j0(a,l),_.matrixWorld)}),s})}).then(function(s){t.add(s);const o=[];if(n.children){const r=n.children;for(let _=0,a=r.length;_<a;_++){const l=r[_];o.push(ac(l,s,e,i))}}return Promise.all(o)})}function k1(c,t,e){const i=t.attributes,n=new J0;if(i.POSITION!==void 0){const r=e.json.accessors[i.POSITION],_=r.min,a=r.max;if(_!==void 0&&a!==void 0){if(n.set(new Za(_[0],_[1],_[2]),new Za(a[0],a[1],a[2])),r.normalized){const l=sl(Ba[r.componentType]);n.min.multiplyScalar(l),n.max.multiplyScalar(l)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=t.targets;if(s!==void 0){const r=new Za,_=new Za;for(let a=0,l=s.length;a<l;a++){const h=s[a];if(h.POSITION!==void 0){const u=e.json.accessors[h.POSITION],f=u.min,m=u.max;if(f!==void 0&&m!==void 0){if(_.setX(Math.max(Math.abs(f[0]),Math.abs(m[0]))),_.setY(Math.max(Math.abs(f[1]),Math.abs(m[1]))),_.setZ(Math.max(Math.abs(f[2]),Math.abs(m[2]))),u.normalized){const d=sl(Ba[u.componentType]);_.multiplyScalar(d)}r.max(_)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(r)}c.boundingBox=n;const o=new $0;n.getCenter(o.center),o.radius=n.min.distanceTo(n.max)/2,c.boundingSphere=o}function __(c,t,e){const i=t.attributes,n=[];function s(o,r){return e.getDependency("accessor",o).then(function(_){c.setAttribute(r,_)})}for(const o in i){const r=nl[o]||o.toLowerCase();r in c.attributes||n.push(s(i[o],r))}if(t.indices!==void 0&&!c.index){const o=e.getDependency("accessor",t.indices).then(function(r){c.setIndex(r)});n.push(o)}return hs(c,t),k1(c,t,e),Promise.all(n).then(function(){return t.targets!==void 0?V1(c,t.targets,e):c})}function h_(c,t){let e=c.getIndex();if(e===null){const o=[],r=c.getAttribute("position");if(r!==void 0){for(let _=0;_<r.count;_++)o.push(_);c.setIndex(o),e=c.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),c}const i=e.count-2,n=[];if(t===tc)for(let o=1;o<=i;o++)n.push(e.getX(0)),n.push(e.getX(o)),n.push(e.getX(o+1));else for(let o=0;o<i;o++)o%2===0?(n.push(e.getX(o)),n.push(e.getX(o+1)),n.push(e.getX(o+2))):(n.push(e.getX(o+2)),n.push(e.getX(o+1)),n.push(e.getX(o)));n.length/3!==i&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=c.clone();return s.setIndex(n),s}const mr=new WeakMap;class B1 extends bl{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,e,i,n){const s=new Ra(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,o=>{const r={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(o,r).then(e).catch(n)},i,n)}decodeDracoFile(t,e,i,n){const s={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!i};this.decodeGeometry(t,s).then(e)}decodeGeometry(t,e){for(const _ in e.attributeTypes){const a=e.attributeTypes[_];a.BYTES_PER_ELEMENT!==void 0&&(e.attributeTypes[_]=a.name)}const i=JSON.stringify(e);if(mr.has(t)){const _=mr.get(t);if(_.key===i)return _.promise;if(t.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const s=this.workerNextTaskID++,o=t.byteLength,r=this._getWorker(s,o).then(_=>(n=_,new Promise((a,l)=>{n._callbacks[s]={resolve:a,reject:l},n.postMessage({type:"decode",id:s,taskConfig:e,buffer:t},[t])}))).then(_=>this._createGeometry(_.geometry));return r.catch(()=>!0).then(()=>{n&&s&&this._releaseTask(n,s)}),mr.set(t,{key:i,promise:r}),r}_createGeometry(t){const e=new Ml;t.index&&e.setIndex(new Ro(t.index.array,1));for(let i=0;i<t.attributes.length;i++){const n=t.attributes[i],s=n.name,o=n.array,r=n.itemSize;e.setAttribute(s,new Ro(o,r))}return e}_loadLibrary(t,e){const i=new Ra(this.manager);return i.setPath(this.decoderPath),i.setResponseType(e),i.setWithCredentials(this.withCredentials),new Promise((n,s)=>{i.load(t,n,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t=typeof WebAssembly!="object"||this.decoderConfig.type==="js",e=[];return t?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then(i=>{const n=i[0];t||(this.decoderConfig.wasmBinary=i[1]);const s=D1.toString(),o=["/* draco decoder */",n,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(t,e){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(s){const o=s.data;switch(o.type){case"decode":n._callbacks[o.id].resolve(o);break;case"error":n._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,s){return n._taskLoad>s._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[t]=e,i._taskLoad+=e,i})}_releaseTask(t,e){t._taskLoad-=t._taskCosts[e],delete t._callbacks[e],delete t._taskCosts[e]}debug(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this}}function D1(){let c,t;onmessage=function(o){const r=o.data;switch(r.type){case"init":c=r.decoderConfig,t=new Promise(function(l){c.onModuleLoaded=function(h){l({draco:h})},DracoDecoderModule(c)});break;case"decode":const _=r.buffer,a=r.taskConfig;t.then(l=>{const h=l.draco,u=new h.Decoder,f=new h.DecoderBuffer;f.Init(new Int8Array(_),_.byteLength);try{const m=e(h,u,f,a),d=m.attributes.map(p=>p.array.buffer);m.index&&d.push(m.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:m},d)}catch(m){console.error(m),self.postMessage({type:"error",id:r.id,error:m.message})}finally{h.destroy(f),h.destroy(u)}});break}};function e(o,r,_,a){const l=a.attributeIDs,h=a.attributeTypes;let u,f;const m=r.GetEncodedGeometryType(_);if(m===o.TRIANGULAR_MESH)u=new o.Mesh,f=r.DecodeBufferToMesh(_,u);else if(m===o.POINT_CLOUD)u=new o.PointCloud,f=r.DecodeBufferToPointCloud(_,u);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!f.ok()||u.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+f.error_msg());const d={index:null,attributes:[]};for(const p in l){const g=self[h[p]];let x,b;if(a.useUniqueIDs)b=l[p],x=r.GetAttributeByUniqueId(u,b);else{if(b=r.GetAttributeId(u,o[l[p]]),b===-1)continue;x=r.GetAttribute(u,b)}d.attributes.push(n(o,r,u,p,g,x))}return m===o.TRIANGULAR_MESH&&(d.index=i(o,r,u)),o.destroy(u),d}function i(o,r,_){const l=_.num_faces()*3,h=l*4,u=o._malloc(h);r.GetTrianglesUInt32Array(_,h,u);const f=new Uint32Array(o.HEAPF32.buffer,u,l).slice();return o._free(u),{array:f,itemSize:1}}function n(o,r,_,a,l,h){const u=h.num_components(),m=_.num_points()*u,d=m*l.BYTES_PER_ELEMENT,p=s(o,l),g=o._malloc(d);r.GetAttributeDataArrayForAllPoints(_,h,p,d,g);const x=new l(o.HEAPF32.buffer,g,m).slice();return o._free(g),{name:a,array:x,itemSize:u}}function s(o,r){switch(r){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}class qo extends bl{constructor(t){super(t),this.defaultDPI=90,this.defaultUnit="px"}load(t,e,i,n){const s=this,o=new Ra(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(t,function(r){try{e(s.parse(r))}catch(_){n?n(_):console.error(_),s.manager.itemError(t)}},i,n)}parse(t){const e=this;function i(k,O){if(k.nodeType!==1)return;const v=y(k);let D=!1,B=null;switch(k.nodeName){case"svg":break;case"style":s(k);break;case"g":O=m(k,O);break;case"path":O=m(k,O),k.hasAttribute("d")&&(B=n(k));break;case"rect":O=m(k,O),B=_(k);break;case"polygon":O=m(k,O),B=a(k);break;case"polyline":O=m(k,O),B=l(k);break;case"circle":O=m(k,O),B=h(k);break;case"ellipse":O=m(k,O),B=u(k);break;case"line":O=m(k,O),B=f(k);break;case"defs":D=!0;break;case"use":O=m(k,O);const tt=(k.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").substring(1),Q=k.viewportElement.getElementById(tt);Q?i(Q,O):console.warn("SVGLoader: 'use node' references non-existent node id: "+tt);break}B&&(O.fill!==void 0&&O.fill!=="none"&&B.color.setStyle(O.fill),M(B,P),S.push(B),B.userData={node:k,style:O});const U=k.childNodes;for(let q=0;q<U.length;q++){const tt=U[q];D&&tt.nodeName!=="style"&&tt.nodeName!=="defs"||i(tt,O)}v&&(F.pop(),F.length>0?P.copy(F[F.length-1]):P.identity())}function n(k){const O=new as,v=new Zi,D=new Zi,B=new Zi;let U=!0,q=!1;const Q=k.getAttribute("d").match(/[a-df-z][^a-df-z]*/ig);for(let nt=0,H=Q.length;nt<H;nt++){const j=Q[nt],it=j.charAt(0),et=j.slice(1).trim();U===!0&&(q=!0,U=!1);let G;switch(it){case"M":G=p(et);for(let W=0,lt=G.length;W<lt;W+=2)v.x=G[W+0],v.y=G[W+1],D.x=v.x,D.y=v.y,W===0?O.moveTo(v.x,v.y):O.lineTo(v.x,v.y),W===0&&B.copy(v);break;case"H":G=p(et);for(let W=0,lt=G.length;W<lt;W++)v.x=G[W],D.x=v.x,D.y=v.y,O.lineTo(v.x,v.y),W===0&&q===!0&&B.copy(v);break;case"V":G=p(et);for(let W=0,lt=G.length;W<lt;W++)v.y=G[W],D.x=v.x,D.y=v.y,O.lineTo(v.x,v.y),W===0&&q===!0&&B.copy(v);break;case"L":G=p(et);for(let W=0,lt=G.length;W<lt;W+=2)v.x=G[W+0],v.y=G[W+1],D.x=v.x,D.y=v.y,O.lineTo(v.x,v.y),W===0&&q===!0&&B.copy(v);break;case"C":G=p(et);for(let W=0,lt=G.length;W<lt;W+=6)O.bezierCurveTo(G[W+0],G[W+1],G[W+2],G[W+3],G[W+4],G[W+5]),D.x=G[W+2],D.y=G[W+3],v.x=G[W+4],v.y=G[W+5],W===0&&q===!0&&B.copy(v);break;case"S":G=p(et);for(let W=0,lt=G.length;W<lt;W+=4)O.bezierCurveTo(d(v.x,D.x),d(v.y,D.y),G[W+0],G[W+1],G[W+2],G[W+3]),D.x=G[W+0],D.y=G[W+1],v.x=G[W+2],v.y=G[W+3],W===0&&q===!0&&B.copy(v);break;case"Q":G=p(et);for(let W=0,lt=G.length;W<lt;W+=4)O.quadraticCurveTo(G[W+0],G[W+1],G[W+2],G[W+3]),D.x=G[W+0],D.y=G[W+1],v.x=G[W+2],v.y=G[W+3],W===0&&q===!0&&B.copy(v);break;case"T":G=p(et);for(let W=0,lt=G.length;W<lt;W+=2){const ht=d(v.x,D.x),ft=d(v.y,D.y);O.quadraticCurveTo(ht,ft,G[W+0],G[W+1]),D.x=ht,D.y=ft,v.x=G[W+0],v.y=G[W+1],W===0&&q===!0&&B.copy(v)}break;case"A":G=p(et,[3,4],7);for(let W=0,lt=G.length;W<lt;W+=7){if(G[W+5]==v.x&&G[W+6]==v.y)continue;const ht=v.clone();v.x=G[W+5],v.y=G[W+6],D.x=v.x,D.y=v.y,o(O,G[W],G[W+1],G[W+2],G[W+3],G[W+4],ht,v),W===0&&q===!0&&B.copy(v)}break;case"m":G=p(et);for(let W=0,lt=G.length;W<lt;W+=2)v.x+=G[W+0],v.y+=G[W+1],D.x=v.x,D.y=v.y,W===0?O.moveTo(v.x,v.y):O.lineTo(v.x,v.y),W===0&&B.copy(v);break;case"h":G=p(et);for(let W=0,lt=G.length;W<lt;W++)v.x+=G[W],D.x=v.x,D.y=v.y,O.lineTo(v.x,v.y),W===0&&q===!0&&B.copy(v);break;case"v":G=p(et);for(let W=0,lt=G.length;W<lt;W++)v.y+=G[W],D.x=v.x,D.y=v.y,O.lineTo(v.x,v.y),W===0&&q===!0&&B.copy(v);break;case"l":G=p(et);for(let W=0,lt=G.length;W<lt;W+=2)v.x+=G[W+0],v.y+=G[W+1],D.x=v.x,D.y=v.y,O.lineTo(v.x,v.y),W===0&&q===!0&&B.copy(v);break;case"c":G=p(et);for(let W=0,lt=G.length;W<lt;W+=6)O.bezierCurveTo(v.x+G[W+0],v.y+G[W+1],v.x+G[W+2],v.y+G[W+3],v.x+G[W+4],v.y+G[W+5]),D.x=v.x+G[W+2],D.y=v.y+G[W+3],v.x+=G[W+4],v.y+=G[W+5],W===0&&q===!0&&B.copy(v);break;case"s":G=p(et);for(let W=0,lt=G.length;W<lt;W+=4)O.bezierCurveTo(d(v.x,D.x),d(v.y,D.y),v.x+G[W+0],v.y+G[W+1],v.x+G[W+2],v.y+G[W+3]),D.x=v.x+G[W+0],D.y=v.y+G[W+1],v.x+=G[W+2],v.y+=G[W+3],W===0&&q===!0&&B.copy(v);break;case"q":G=p(et);for(let W=0,lt=G.length;W<lt;W+=4)O.quadraticCurveTo(v.x+G[W+0],v.y+G[W+1],v.x+G[W+2],v.y+G[W+3]),D.x=v.x+G[W+0],D.y=v.y+G[W+1],v.x+=G[W+2],v.y+=G[W+3],W===0&&q===!0&&B.copy(v);break;case"t":G=p(et);for(let W=0,lt=G.length;W<lt;W+=2){const ht=d(v.x,D.x),ft=d(v.y,D.y);O.quadraticCurveTo(ht,ft,v.x+G[W+0],v.y+G[W+1]),D.x=ht,D.y=ft,v.x=v.x+G[W+0],v.y=v.y+G[W+1],W===0&&q===!0&&B.copy(v)}break;case"a":G=p(et,[3,4],7);for(let W=0,lt=G.length;W<lt;W+=7){if(G[W+5]==0&&G[W+6]==0)continue;const ht=v.clone();v.x+=G[W+5],v.y+=G[W+6],D.x=v.x,D.y=v.y,o(O,G[W],G[W+1],G[W+2],G[W+3],G[W+4],ht,v),W===0&&q===!0&&B.copy(v)}break;case"Z":case"z":O.currentPath.autoClose=!0,O.currentPath.curves.length>0&&(v.copy(B),O.currentPath.currentPoint.copy(v),U=!0);break;default:console.warn(j)}q=!1}return O}function s(k){if(!(!k.sheet||!k.sheet.cssRules||!k.sheet.cssRules.length))for(let O=0;O<k.sheet.cssRules.length;O++){const v=k.sheet.cssRules[O];if(v.type!==1)continue;const D=v.selectorText.split(/,/gm).filter(Boolean).map(B=>B.trim());for(let B=0;B<D.length;B++){const U=Object.fromEntries(Object.entries(v.style).filter(([,q])=>q!==""));V[D[B]]=Object.assign(V[D[B]]||{},U)}}}function o(k,O,v,D,B,U,q,tt){if(O==0||v==0){k.lineTo(tt.x,tt.y);return}D=D*Math.PI/180,O=Math.abs(O),v=Math.abs(v);const Q=(q.x-tt.x)/2,nt=(q.y-tt.y)/2,H=Math.cos(D)*Q+Math.sin(D)*nt,j=-Math.sin(D)*Q+Math.cos(D)*nt;let it=O*O,et=v*v;const G=H*H,W=j*j,lt=G/it+W/et;if(lt>1){const Mt=Math.sqrt(lt);O=Mt*O,v=Mt*v,it=O*O,et=v*v}const ht=it*W+et*G,ft=(it*et-ht)/ht;let pt=Math.sqrt(Math.max(0,ft));B===U&&(pt=-pt);const K=pt*O*j/v,J=-pt*v*H/O,rt=Math.cos(D)*K-Math.sin(D)*J+(q.x+tt.x)/2,mt=Math.sin(D)*K+Math.cos(D)*J+(q.y+tt.y)/2,xt=r(1,0,(H-K)/O,(j-J)/v),vt=r((H-K)/O,(j-J)/v,(-H-K)/O,(-j-J)/v)%(Math.PI*2);k.currentPath.absellipse(rt,mt,O,v,xt,xt+vt,U===0,D)}function r(k,O,v,D){const B=k*v+O*D,U=Math.sqrt(k*k+O*O)*Math.sqrt(v*v+D*D);let q=Math.acos(Math.max(-1,Math.min(1,B/U)));return k*D-O*v<0&&(q=-q),q}function _(k){const O=b(k.getAttribute("x")||0),v=b(k.getAttribute("y")||0),D=b(k.getAttribute("rx")||k.getAttribute("ry")||0),B=b(k.getAttribute("ry")||k.getAttribute("rx")||0),U=b(k.getAttribute("width")),q=b(k.getAttribute("height")),tt=1-.551915024494,Q=new as;return Q.moveTo(O+D,v),Q.lineTo(O+U-D,v),(D!==0||B!==0)&&Q.bezierCurveTo(O+U-D*tt,v,O+U,v+B*tt,O+U,v+B),Q.lineTo(O+U,v+q-B),(D!==0||B!==0)&&Q.bezierCurveTo(O+U,v+q-B*tt,O+U-D*tt,v+q,O+U-D,v+q),Q.lineTo(O+D,v+q),(D!==0||B!==0)&&Q.bezierCurveTo(O+D*tt,v+q,O,v+q-B*tt,O,v+q-B),Q.lineTo(O,v+B),(D!==0||B!==0)&&Q.bezierCurveTo(O,v+B*tt,O+D*tt,v,O+D,v),Q}function a(k){function O(U,q,tt){const Q=b(q),nt=b(tt);B===0?D.moveTo(Q,nt):D.lineTo(Q,nt),B++}const v=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,D=new as;let B=0;return k.getAttribute("points").replace(v,O),D.currentPath.autoClose=!0,D}function l(k){function O(U,q,tt){const Q=b(q),nt=b(tt);B===0?D.moveTo(Q,nt):D.lineTo(Q,nt),B++}const v=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,D=new as;let B=0;return k.getAttribute("points").replace(v,O),D.currentPath.autoClose=!1,D}function h(k){const O=b(k.getAttribute("cx")||0),v=b(k.getAttribute("cy")||0),D=b(k.getAttribute("r")||0),B=new cr;B.absarc(O,v,D,0,Math.PI*2);const U=new as;return U.subPaths.push(B),U}function u(k){const O=b(k.getAttribute("cx")||0),v=b(k.getAttribute("cy")||0),D=b(k.getAttribute("rx")||0),B=b(k.getAttribute("ry")||0),U=new cr;U.absellipse(O,v,D,B,0,Math.PI*2);const q=new as;return q.subPaths.push(U),q}function f(k){const O=b(k.getAttribute("x1")||0),v=b(k.getAttribute("y1")||0),D=b(k.getAttribute("x2")||0),B=b(k.getAttribute("y2")||0),U=new as;return U.moveTo(O,v),U.lineTo(D,B),U.currentPath.autoClose=!1,U}function m(k,O){O=Object.assign({},O);let v={};if(k.hasAttribute("class")){const q=k.getAttribute("class").split(/\s/).filter(Boolean).map(tt=>tt.trim());for(let tt=0;tt<q.length;tt++)v=Object.assign(v,V["."+q[tt]])}k.hasAttribute("id")&&(v=Object.assign(v,V["#"+k.getAttribute("id")]));function D(q,tt,Q){Q===void 0&&(Q=function(H){return H.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),H}),k.hasAttribute(q)&&(O[tt]=Q(k.getAttribute(q))),v[q]&&(O[tt]=Q(v[q])),k.style&&k.style[q]!==""&&(O[tt]=Q(k.style[q]))}function B(q){return Math.max(0,Math.min(1,b(q)))}function U(q){return Math.max(0,b(q))}return D("fill","fill"),D("fill-opacity","fillOpacity",B),D("fill-rule","fillRule"),D("opacity","opacity",B),D("stroke","stroke"),D("stroke-opacity","strokeOpacity",B),D("stroke-width","strokeWidth",U),D("stroke-linejoin","strokeLineJoin"),D("stroke-linecap","strokeLineCap"),D("stroke-miterlimit","strokeMiterLimit",U),D("visibility","visibility"),O}function d(k,O){return k-(O-k)}function p(k,O,v){if(typeof k!="string")throw new TypeError("Invalid input: "+typeof k);const D={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},B=0,U=1,q=2,tt=3;let Q=B,nt=!0,H="",j="";const it=[];function et(ht,ft,pt){const K=new SyntaxError('Unexpected character "'+ht+'" at index '+ft+".");throw K.partial=pt,K}function G(){H!==""&&(j===""?it.push(Number(H)):it.push(Number(H)*Math.pow(10,Number(j)))),H="",j=""}let W;const lt=k.length;for(let ht=0;ht<lt;ht++){if(W=k[ht],Array.isArray(O)&&O.includes(it.length%v)&&D.FLAGS.test(W)){Q=U,H=W,G();continue}if(Q===B){if(D.WHITESPACE.test(W))continue;if(D.DIGIT.test(W)||D.SIGN.test(W)){Q=U,H=W;continue}if(D.POINT.test(W)){Q=q,H=W;continue}D.COMMA.test(W)&&(nt&&et(W,ht,it),nt=!0)}if(Q===U){if(D.DIGIT.test(W)){H+=W;continue}if(D.POINT.test(W)){H+=W,Q=q;continue}if(D.EXP.test(W)){Q=tt;continue}D.SIGN.test(W)&&H.length===1&&D.SIGN.test(H[0])&&et(W,ht,it)}if(Q===q){if(D.DIGIT.test(W)){H+=W;continue}if(D.EXP.test(W)){Q=tt;continue}D.POINT.test(W)&&H[H.length-1]==="."&&et(W,ht,it)}if(Q===tt){if(D.DIGIT.test(W)){j+=W;continue}if(D.SIGN.test(W)){if(j===""){j+=W;continue}j.length===1&&D.SIGN.test(j)&&et(W,ht,it)}}D.WHITESPACE.test(W)?(G(),Q=B,nt=!1):D.COMMA.test(W)?(G(),Q=B,nt=!0):D.SIGN.test(W)?(G(),Q=U,H=W):D.POINT.test(W)?(G(),Q=q,H=W):et(W,ht,it)}return G(),it}const g=["mm","cm","in","pt","pc","px"],x={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:72/6,pc:1,px:-1},px:{px:1}};function b(k){let O="px";if(typeof k=="string"||k instanceof String)for(let D=0,B=g.length;D<B;D++){const U=g[D];if(k.endsWith(U)){O=U,k=k.substring(0,k.length-U.length);break}}let v;return O==="px"&&e.defaultUnit!=="px"?v=x.in[e.defaultUnit]/e.defaultDPI:(v=x[O][e.defaultUnit],v<0&&(v=x[O].in*e.defaultDPI)),v*parseFloat(k)}function y(k){if(!(k.hasAttribute("transform")||k.nodeName==="use"&&(k.hasAttribute("x")||k.hasAttribute("y"))))return null;const O=z(k);return F.length>0&&O.premultiply(F[F.length-1]),P.copy(O),F.push(O),O}function z(k){const O=new zs,v=C;if(k.nodeName==="use"&&(k.hasAttribute("x")||k.hasAttribute("y"))){const D=b(k.getAttribute("x")),B=b(k.getAttribute("y"));O.translate(D,B)}if(k.hasAttribute("transform")){const D=k.getAttribute("transform").split(")");for(let B=D.length-1;B>=0;B--){const U=D[B].trim();if(U==="")continue;const q=U.indexOf("("),tt=U.length;if(q>0&&q<tt){const Q=U.slice(0,q),nt=p(U.slice(q+1));switch(v.identity(),Q){case"translate":if(nt.length>=1){const H=nt[0];let j=H;nt.length>=2&&(j=nt[1]),v.translate(H,j)}break;case"rotate":if(nt.length>=1){let H=0,j=0,it=0;H=-nt[0]*Math.PI/180,nt.length>=3&&(j=nt[1],it=nt[2]),A.identity().translate(-j,-it),Z.identity().rotate(H),L.multiplyMatrices(Z,A),A.identity().translate(j,it),v.multiplyMatrices(A,L)}break;case"scale":if(nt.length>=1){const H=nt[0];let j=H;nt.length>=2&&(j=nt[1]),v.scale(H,j)}break;case"skewX":nt.length===1&&v.set(1,Math.tan(nt[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":nt.length===1&&v.set(1,0,0,Math.tan(nt[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":nt.length===6&&v.set(nt[0],nt[2],nt[4],nt[1],nt[3],nt[5],0,0,1);break}}O.premultiply(v)}}return O}function M(k,O){function v(U){T.set(U.x,U.y,1).applyMatrix3(O),U.set(T.x,T.y)}const D=Y(O),B=k.subPaths;for(let U=0,q=B.length;U<q;U++){const Q=B[U].curves;for(let nt=0;nt<Q.length;nt++){const H=Q[nt];H.isLineCurve?(v(H.v1),v(H.v2)):H.isCubicBezierCurve?(v(H.v0),v(H.v1),v(H.v2),v(H.v3)):H.isQuadraticBezierCurve?(v(H.v0),v(H.v1),v(H.v2)):H.isEllipseCurve&&(D&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),E.set(H.aX,H.aY),v(E),H.aX=E.x,H.aY=E.y,H.xRadius*=X(O),H.yRadius*=w(O))}}}function Y(k){return k.elements[1]!==0||k.elements[3]!==0}function X(k){const O=k.elements;return Math.sqrt(O[0]*O[0]+O[1]*O[1])}function w(k){const O=k.elements;return Math.sqrt(O[3]*O[3]+O[4]*O[4])}const S=[],V={},F=[],C=new zs,A=new zs,Z=new zs,L=new zs,E=new Zi,T=new Za,P=new zs,N=new DOMParser().parseFromString(t,"image/svg+xml");return i(N.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:S,xml:N.documentElement}}static createShapes(t){const i={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},n={loc:i.ORIGIN,t:0};function s(p,g,x,b){const y=p.x,z=g.x,M=x.x,Y=b.x,X=p.y,w=g.y,S=x.y,V=b.y,F=(Y-M)*(X-S)-(V-S)*(y-M),C=(z-y)*(X-S)-(w-X)*(y-M),A=(V-S)*(z-y)-(Y-M)*(w-X),Z=F/A,L=C/A;if(A===0&&F!==0||Z<=0||Z>=1||L<0||L>1)return null;if(F===0&&A===0){for(let E=0;E<2;E++)if(o(E===0?x:b,p,g),n.loc==i.ORIGIN){const T=E===0?x:b;return{x:T.x,y:T.y,t:n.t}}else if(n.loc==i.BETWEEN){const T=+(y+n.t*(z-y)).toPrecision(10),P=+(X+n.t*(w-X)).toPrecision(10);return{x:T,y:P,t:n.t}}return null}else{for(let P=0;P<2;P++)if(o(P===0?x:b,p,g),n.loc==i.ORIGIN){const N=P===0?x:b;return{x:N.x,y:N.y,t:n.t}}const E=+(y+Z*(z-y)).toPrecision(10),T=+(X+Z*(w-X)).toPrecision(10);return{x:E,y:T,t:Z}}}function o(p,g,x){const b=x.x-g.x,y=x.y-g.y,z=p.x-g.x,M=p.y-g.y,Y=b*M-z*y;if(p.x===g.x&&p.y===g.y){n.loc=i.ORIGIN,n.t=0;return}if(p.x===x.x&&p.y===x.y){n.loc=i.DESTINATION,n.t=1;return}if(Y<-Number.EPSILON){n.loc=i.LEFT;return}if(Y>Number.EPSILON){n.loc=i.RIGHT;return}if(b*z<0||y*M<0){n.loc=i.BEHIND;return}if(Math.sqrt(b*b+y*y)<Math.sqrt(z*z+M*M)){n.loc=i.BEYOND;return}let X;b!==0?X=z/b:X=M/y,n.loc=i.BETWEEN,n.t=X}function r(p,g){const x=[],b=[];for(let y=1;y<p.length;y++){const z=p[y-1],M=p[y];for(let Y=1;Y<g.length;Y++){const X=g[Y-1],w=g[Y],S=s(z,M,X,w);S!==null&&x.find(V=>V.t<=S.t+Number.EPSILON&&V.t>=S.t-Number.EPSILON)===void 0&&(x.push(S),b.push(new Zi(S.x,S.y)))}}return b}function _(p,g,x){const b=new Zi;g.getCenter(b);const y=[];return x.forEach(z=>{z.boundingBox.containsPoint(b)&&r(p,z.points).forEach(Y=>{y.push({identifier:z.identifier,isCW:z.isCW,point:Y})})}),y.sort((z,M)=>z.point.x-M.point.x),y}function a(p,g,x,b,y){(y==null||y==="")&&(y="nonzero");const z=new Zi;p.boundingBox.getCenter(z);const M=[new Zi(x,z.y),new Zi(b,z.y)],Y=_(M,p.boundingBox,g);Y.sort((C,A)=>C.point.x-A.point.x);const X=[],w=[];Y.forEach(C=>{C.identifier===p.identifier?X.push(C):w.push(C)});const S=X[0].point.x,V=[];let F=0;for(;F<w.length&&w[F].point.x<S;)V.length>0&&V[V.length-1]===w[F].identifier?V.pop():V.push(w[F].identifier),F++;if(V.push(p.identifier),y==="evenodd"){const C=V.length%2===0,A=V[V.length-2];return{identifier:p.identifier,isHole:C,for:A}}else if(y==="nonzero"){let C=!0,A=null,Z=null;for(let L=0;L<V.length;L++){const E=V[L];C?(Z=g[E].isCW,C=!1,A=E):Z!==g[E].isCW&&(Z=g[E].isCW,C=!0)}return{identifier:p.identifier,isHole:C,for:A}}else console.warn('fill-rule: "'+y+'" is currently not implemented.')}let l=0,h=999999999,u=-999999999,f=t.subPaths.map(p=>{const g=p.getPoints();let x=-999999999,b=999999999,y=-999999999,z=999999999;for(let M=0;M<g.length;M++){const Y=g[M];Y.y>x&&(x=Y.y),Y.y<b&&(b=Y.y),Y.x>y&&(y=Y.x),Y.x<z&&(z=Y.x)}return u<=y&&(u=y+1),h>=z&&(h=z-1),{curves:p.curves,points:g,isCW:K0.isClockWise(g),identifier:l++,boundingBox:new Q0(new Zi(z,b),new Zi(y,x))}});f=f.filter(p=>p.points.length>1);const m=f.map(p=>a(p,f,h,u,t.userData.style.fillRule)),d=[];return f.forEach(p=>{if(!m[p.identifier].isHole){const x=new t1;x.curves=p.curves,m.filter(y=>y.isHole&&y.for===p.identifier).forEach(y=>{const z=f[y.identifier],M=new cr;M.curves=z.curves,x.holes.push(M)}),d.push(x)}}),d}static getStrokeStyle(t,e,i,n,s){return t=t!==void 0?t:1,e=e!==void 0?e:"#000",i=i!==void 0?i:"miter",n=n!==void 0?n:"butt",s=s!==void 0?s:4,{strokeColor:e,strokeWidth:t,strokeLineJoin:i,strokeLineCap:n,strokeMiterLimit:s}}static pointsToStroke(t,e,i,n){const s=[],o=[],r=[];if(qo.pointsToStrokeWithBuffers(t,e,i,n,s,o,r)===0)return null;const _=new Ml;return _.setAttribute("position",new ur(s,3)),_.setAttribute("normal",new ur(o,3)),_.setAttribute("uv",new ur(r,2)),_}static pointsToStrokeWithBuffers(t,e,i,n,s,o,r,_){const a=new Zi,l=new Zi,h=new Zi,u=new Zi,f=new Zi,m=new Zi,d=new Zi,p=new Zi,g=new Zi,x=new Zi,b=new Zi,y=new Zi,z=new Zi,M=new Zi,Y=new Zi,X=new Zi,w=new Zi;i=i!==void 0?i:12,n=n!==void 0?n:.001,_=_!==void 0?_:0,t=j(t);const S=t.length;if(S<2)return 0;const V=t[0].equals(t[S-1]);let F,C=t[0],A;const Z=e.strokeWidth/2,L=1/(S-1);let E=0,T,P,N,R,k=!1,O=0,v=_*3,D=_*2;B(t[0],t[1],a).multiplyScalar(Z),p.copy(t[0]).sub(a),g.copy(t[0]).add(a),x.copy(p),b.copy(g);for(let it=1;it<S;it++){F=t[it],it===S-1?V?A=t[1]:A=void 0:A=t[it+1];const et=a;if(B(C,F,et),h.copy(et).multiplyScalar(Z),y.copy(F).sub(h),z.copy(F).add(h),T=E+L,P=!1,A!==void 0){B(F,A,l),h.copy(l).multiplyScalar(Z),M.copy(F).sub(h),Y.copy(F).add(h),N=!0,h.subVectors(A,C),et.dot(h)<0&&(N=!1),it===1&&(k=N),h.subVectors(A,F),h.normalize();const G=Math.abs(et.dot(h));if(G!==0){const W=Z/G;h.multiplyScalar(-W),u.subVectors(F,C),f.copy(u).setLength(W).add(h),X.copy(f).negate();const lt=f.length(),ht=u.length();u.divideScalar(ht),m.subVectors(A,F);const ft=m.length();switch(m.divideScalar(ft),u.dot(X)<ht&&m.dot(X)<ft&&(P=!0),w.copy(f).add(F),X.add(F),R=!1,P?N?(Y.copy(X),z.copy(X)):(M.copy(X),y.copy(X)):tt(),e.strokeLineJoin){case"bevel":Q(N,P,T);break;case"round":nt(N,P),N?q(F,y,M,T,0):q(F,Y,z,T,1);break;case"miter":case"miter-clip":default:const pt=Z*e.strokeMiterLimit/lt;if(pt<1)if(e.strokeLineJoin!=="miter-clip"){Q(N,P,T);break}else nt(N,P),N?(m.subVectors(w,y).multiplyScalar(pt).add(y),d.subVectors(w,M).multiplyScalar(pt).add(M),U(y,T,0),U(m,T,0),U(F,T,.5),U(F,T,.5),U(m,T,0),U(d,T,0),U(F,T,.5),U(d,T,0),U(M,T,0)):(m.subVectors(w,z).multiplyScalar(pt).add(z),d.subVectors(w,Y).multiplyScalar(pt).add(Y),U(z,T,1),U(m,T,1),U(F,T,.5),U(F,T,.5),U(m,T,1),U(d,T,1),U(F,T,.5),U(d,T,1),U(Y,T,1));else P?(N?(U(g,E,1),U(p,E,0),U(w,T,0),U(g,E,1),U(w,T,0),U(X,T,1)):(U(g,E,1),U(p,E,0),U(w,T,1),U(p,E,0),U(X,T,0),U(w,T,1)),N?M.copy(w):Y.copy(w)):N?(U(y,T,0),U(w,T,0),U(F,T,.5),U(F,T,.5),U(w,T,0),U(M,T,0)):(U(z,T,1),U(w,T,1),U(F,T,.5),U(F,T,.5),U(w,T,1),U(Y,T,1)),R=!0;break}}else tt()}else tt();!V&&it===S-1&&H(t[0],x,b,N,!0,E),E=T,C=F,p.copy(M),g.copy(Y)}if(!V)H(F,y,z,N,!1,T);else if(P&&s){let it=w,et=X;k!==N&&(it=X,et=w),N?(R||k)&&(et.toArray(s,0*3),et.toArray(s,3*3),R&&it.toArray(s,1*3)):(R||!k)&&(et.toArray(s,1*3),et.toArray(s,3*3),R&&it.toArray(s,0*3))}return O;function B(it,et,G){return G.subVectors(et,it),G.set(-G.y,G.x).normalize()}function U(it,et,G){s&&(s[v]=it.x,s[v+1]=it.y,s[v+2]=0,o&&(o[v]=0,o[v+1]=0,o[v+2]=1),v+=3,r&&(r[D]=et,r[D+1]=G,D+=2)),O+=3}function q(it,et,G,W,lt){a.copy(et).sub(it).normalize(),l.copy(G).sub(it).normalize();let ht=Math.PI;const ft=a.dot(l);Math.abs(ft)<1&&(ht=Math.abs(Math.acos(ft))),ht/=i,h.copy(et);for(let pt=0,K=i-1;pt<K;pt++)u.copy(h).rotateAround(it,ht),U(h,W,lt),U(u,W,lt),U(it,W,.5),h.copy(u);U(u,W,lt),U(G,W,lt),U(it,W,.5)}function tt(){U(g,E,1),U(p,E,0),U(y,T,0),U(g,E,1),U(y,T,1),U(z,T,0)}function Q(it,et,G){et?it?(U(g,E,1),U(p,E,0),U(y,T,0),U(g,E,1),U(y,T,0),U(X,T,1),U(y,G,0),U(M,G,0),U(X,G,.5)):(U(g,E,1),U(p,E,0),U(z,T,1),U(p,E,0),U(X,T,0),U(z,T,1),U(z,G,1),U(Y,G,0),U(X,G,.5)):it?(U(y,G,0),U(M,G,0),U(F,G,.5)):(U(z,G,1),U(Y,G,0),U(F,G,.5))}function nt(it,et){et&&(it?(U(g,E,1),U(p,E,0),U(y,T,0),U(g,E,1),U(y,T,0),U(X,T,1),U(y,E,0),U(F,T,.5),U(X,T,1),U(F,T,.5),U(M,E,0),U(X,T,1)):(U(g,E,1),U(p,E,0),U(z,T,1),U(p,E,0),U(X,T,0),U(z,T,1),U(z,E,1),U(X,T,0),U(F,T,.5),U(F,T,.5),U(X,T,0),U(Y,E,1)))}function H(it,et,G,W,lt,ht){switch(e.strokeLineCap){case"round":lt?q(it,G,et,ht,.5):q(it,et,G,ht,.5);break;case"square":if(lt)a.subVectors(et,it),l.set(a.y,-a.x),h.addVectors(a,l).add(it),u.subVectors(l,a).add(it),W?(h.toArray(s,1*3),u.toArray(s,0*3),u.toArray(s,3*3)):(h.toArray(s,1*3),h.toArray(s,3*3),u.toArray(s,0*3));else{a.subVectors(G,it),l.set(a.y,-a.x),h.addVectors(a,l).add(it),u.subVectors(l,a).add(it);const ft=s.length;W?(h.toArray(s,ft-1*3),u.toArray(s,ft-2*3),u.toArray(s,ft-4*3)):(h.toArray(s,ft-2*3),u.toArray(s,ft-1*3),u.toArray(s,ft-4*3))}break}}function j(it){let et=!1;for(let W=1,lt=it.length-1;W<lt;W++)if(it[W].distanceTo(it[W+1])<n){et=!0;break}if(!et)return it;const G=[];G.push(it[0]);for(let W=1,lt=it.length-1;W<lt;W++)it[W].distanceTo(it[W+1])>=n&&G.push(it[W]);return G.push(it[it.length-1]),G}}}var N1="/l00/static/glb/one-f83feb52.glb";const Pa=class{};let os=Pa;li(os,"agent",navigator.userAgent.toLowerCase()),li(os,"mobile",!!navigator.maxTouchPoints),li(os,"tablet",Pa.mobile&&Math.max(screen.width,screen.height)>1e3),li(os,"phone",Pa.mobile&&!Pa.tablet),li(os,"webgl",(()=>{if(typeof window=="undefined")return;const t={failIfMajorPerformanceCaveat:!0};let e=document.createElement("canvas"),i=e.getContext("webgl2",t);const n=!!i;return i=null,e=null,n})());class ki{}li(ki,"STATE_CHANGE","state_change"),li(ki,"VIEW_CHANGE","view_change"),li(ki,"KEY_DOWN","key_down"),li(ki,"KEY_UP","key_up"),li(ki,"KEY_PRESS","key_press"),li(ki,"RESIZE","resize"),li(ki,"VISIBILITY","visibility"),li(ki,"PROGRESS","progress"),li(ki,"COMPLETE","complete"),li(ki,"UPDATE","update"),li(ki,"HOVER","hover"),li(ki,"CLICK","click"),li(ki,"COLOR_PICKER","color_picker"),li(ki,"INVERT","invert"),li(ki,"SELECT","select");for(let c=0;c<256;c++)(c<16?"0":"")+c.toString(16);function F1(c,t){return c+Math.floor(Math.random()*(t-c+1))}function O1(c){return Math.pow(2,Math.floor(Math.log(c)/Math.LN2))}function U1(){return(Date.now()+F1(0,99999)).toString()}class Kn{static add(t,e){!this.cache||(this.files[t]=e)}static get(t){if(!!this.cache)return this.files[t]}static remove(t){delete this.files[t]}static clear(){this.files={}}static filter(t){return Object.keys(this.files).filter(t).reduce((i,n)=>(i[n]=this.files[n],i),{})}static getPath(t){return this.path+t}static loadImage(t,e){const i=new Image;i.crossOrigin=this.crossOrigin,i.src=this.getPath(t);const n=new Promise((s,o)=>{i.onload=()=>{s(i),i.onload=null},i.onerror=r=>{o(r),i.onerror=null}});return e&&n.then(e),n}static loadData(t,e){const i=fetch(`${this.getPath(t)}?${U1()}`,this.options).then(n=>n.json());return e&&i.then(e),i}}li(Kn,"path",""),li(Kn,"crossOrigin"),li(Kn,"options"),li(Kn,"cache",!1),li(Kn,"files",{});class G1{constructor(){this.callbacks={}}on(t,e){this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e)}off(t,e){if(!!this.callbacks[t])if(e){const i=this.callbacks[t].indexOf(e);~i&&this.callbacks[t].splice(i,1)}else delete this.callbacks[t]}emit(t,e={}){if(!this.callbacks[t])return;const i=this.callbacks[t].slice();for(let n=0,s=i.length;n<s;n++)i[n].call(this,e)}destroy(){for(const t in this)this[t]=null;return null}}/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Xl="140",H1=0,c_=1,W1=2,oc=1,j1=2,La=3,Da=0,Mn=1,ea=2,rc=1,Ln=0,Qs=1,u_=2,p_=3,m_=4,q1=5,Gs=100,J1=101,$1=102,f_=103,d_=104,K1=200,Q1=201,tu=202,eu=203,lc=204,_c=205,iu=206,nu=207,su=208,au=209,ou=210,ru=0,lu=1,_u=2,al=3,hu=4,cu=5,uu=6,pu=7,Jo=0,mu=1,fu=2,Fn=0,du=1,gu=2,xu=3,vu=4,bu=5,hc=300,ia=301,na=302,ol=303,rl=304,$o=306,ll=1e3,xn=1001,_l=1002,ji=1003,g_=1004,x_=1005,rn=1006,yu=1007,Ko=1008,ys=1009,Mu=1010,wu=1011,Na=1012,Xu=1013,Co=1014,ms=1015,Fa=1016,Iu=1017,zu=1018,ta=1020,Su=1021,Yu=1022,vn=1023,Zu=1024,Lu=1025,gs=1026,sa=1027,Au=1028,Tu=1029,Vu=1030,Eu=1031,Cu=1033,fr=33776,dr=33777,gr=33778,xr=33779,v_=35840,b_=35841,y_=35842,M_=35843,Pu=36196,w_=37492,X_=37496,I_=37808,z_=37809,S_=37810,Y_=37811,Z_=37812,L_=37813,A_=37814,T_=37815,V_=37816,E_=37817,C_=37818,P_=37819,R_=37820,k_=37821,B_=36492,Ru=2200,ku=2201,Bu=2202,ko=2300,Bo=2301,vr=2302,Hs=2400,Ws=2401,Do=2402,Il=2500,cc=2501,Du=0,es=3e3,Ci=3001,Nu=3200,Fu=3201,ra=0,Ou=1,Nn="srgb",fs="srgb-linear",br=7680,Uu=519,Oa=35044,No=35048,Fo="300 es",hl=1035;class ws{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const i=this._listeners;return i[t]!==void 0&&i[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const n=this._listeners[t];if(n!==void 0){const s=n.indexOf(e);s!==-1&&n.splice(s,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const i=this._listeners[t.type];if(i!==void 0){t.target=this;const n=i.slice(0);for(let s=0,o=n.length;s<o;s++)n[s].call(this,t);t.target=null}}}const Ki=[];for(let c=0;c<256;c++)Ki[c]=(c<16?"0":"")+c.toString(16);const yr=Math.PI/180,cl=180/Math.PI;function An(){const c=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Ki[c&255]+Ki[c>>8&255]+Ki[c>>16&255]+Ki[c>>24&255]+"-"+Ki[t&255]+Ki[t>>8&255]+"-"+Ki[t>>16&15|64]+Ki[t>>24&255]+"-"+Ki[e&63|128]+Ki[e>>8&255]+"-"+Ki[e>>16&255]+Ki[e>>24&255]+Ki[i&255]+Ki[i>>8&255]+Ki[i>>16&255]+Ki[i>>24&255]).toLowerCase()}function tn(c,t,e){return Math.max(t,Math.min(e,c))}function Gu(c,t){return(c%t+t)%t}function Mr(c,t,e){return(1-e)*c+e*t}function D_(c){return(c&c-1)===0&&c!==0}function ul(c){return Math.pow(2,Math.floor(Math.log(c)/Math.LN2))}class Ne{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return e!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return e!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,i){return i!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),s=this.x-t.x,o=this.y-t.y;return this.x=s*i-o*n+t.x,this.y=s*n+o*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}Ne.prototype.isVector2=!0;class qi{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,s,o,r,_,a){const l=this.elements;return l[0]=t,l[1]=n,l[2]=r,l[3]=e,l[4]=s,l[5]=_,l[6]=i,l[7]=o,l[8]=a,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,s=this.elements,o=i[0],r=i[3],_=i[6],a=i[1],l=i[4],h=i[7],u=i[2],f=i[5],m=i[8],d=n[0],p=n[3],g=n[6],x=n[1],b=n[4],y=n[7],z=n[2],M=n[5],Y=n[8];return s[0]=o*d+r*x+_*z,s[3]=o*p+r*b+_*M,s[6]=o*g+r*y+_*Y,s[1]=a*d+l*x+h*z,s[4]=a*p+l*b+h*M,s[7]=a*g+l*y+h*Y,s[2]=u*d+f*x+m*z,s[5]=u*p+f*b+m*M,s[8]=u*g+f*y+m*Y,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],o=t[4],r=t[5],_=t[6],a=t[7],l=t[8];return e*o*l-e*r*a-i*s*l+i*r*_+n*s*a-n*o*_}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],o=t[4],r=t[5],_=t[6],a=t[7],l=t[8],h=l*o-r*a,u=r*_-l*s,f=a*s-o*_,m=e*h+i*u+n*f;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const d=1/m;return t[0]=h*d,t[1]=(n*a-l*i)*d,t[2]=(r*i-n*o)*d,t[3]=u*d,t[4]=(l*e-n*_)*d,t[5]=(n*s-r*e)*d,t[6]=f*d,t[7]=(i*_-a*e)*d,t[8]=(o*e-i*s)*d,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,n,s,o,r){const _=Math.cos(s),a=Math.sin(s);return this.set(i*_,i*a,-i*(_*o+a*r)+o+t,-n*a,n*_,-n*(-a*o+_*r)+r+e,0,0,1),this}scale(t,e){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.elements,s=n[0],o=n[3],r=n[6],_=n[1],a=n[4],l=n[7];return n[0]=e*s+i*_,n[3]=e*o+i*a,n[6]=e*r+i*l,n[1]=-i*s+e*_,n[4]=-i*o+e*a,n[7]=-i*r+e*l,this}translate(t,e){const i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}equals(t){const e=this.elements,i=t.elements;for(let n=0;n<9;n++)if(e[n]!==i[n])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return new this.constructor().fromArray(this.elements)}}qi.prototype.isMatrix3=!0;function uc(c){for(let t=c.length-1;t>=0;--t)if(c[t]>65535)return!0;return!1}function Ua(c){return document.createElementNS("http://www.w3.org/1999/xhtml",c)}function xs(c){return c<.04045?c*.0773993808:Math.pow(c*.9478672986+.0521327014,2.4)}function Po(c){return c<.0031308?c*12.92:1.055*Math.pow(c,.41666)-.055}const wr={[Nn]:{[fs]:xs},[fs]:{[Nn]:Po}},mn={legacyMode:!0,get workingColorSpace(){return fs},set workingColorSpace(c){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(c,t,e){if(this.legacyMode||t===e||!t||!e)return c;if(wr[t]&&wr[t][e]!==void 0){const i=wr[t][e];return c.r=i(c.r),c.g=i(c.g),c.b=i(c.b),c}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(c,t){return this.convert(c,this.workingColorSpace,t)},toWorkingColorSpace:function(c,t){return this.convert(c,t,this.workingColorSpace)}},pc={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Oi={r:0,g:0,b:0},fn={h:0,s:0,l:0},to={h:0,s:0,l:0};function Xr(c,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?c+(t-c)*6*e:e<1/2?t:e<2/3?c+(t-c)*6*(2/3-e):c}function eo(c,t){return t.r=c.r,t.g=c.g,t.b=c.b,t}class fi{constructor(t,e,i){return e===void 0&&i===void 0?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=Nn){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,mn.toWorkingColorSpace(this,e),this}setRGB(t,e,i,n=fs){return this.r=t,this.g=e,this.b=i,mn.toWorkingColorSpace(this,n),this}setHSL(t,e,i,n=fs){if(t=Gu(t,1),e=tn(e,0,1),i=tn(i,0,1),e===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+e):i+e-i*e,o=2*i-s;this.r=Xr(o,s,t+1/3),this.g=Xr(o,s,t),this.b=Xr(o,s,t-1/3)}return mn.toWorkingColorSpace(this,n),this}setStyle(t,e=Nn){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let s;const o=n[1],r=n[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(s[1],10))/255,this.g=Math.min(255,parseInt(s[2],10))/255,this.b=Math.min(255,parseInt(s[3],10))/255,mn.toWorkingColorSpace(this,e),i(s[4]),this;if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(s[1],10))/100,this.g=Math.min(100,parseInt(s[2],10))/100,this.b=Math.min(100,parseInt(s[3],10))/100,mn.toWorkingColorSpace(this,e),i(s[4]),this;break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r)){const _=parseFloat(s[1])/360,a=parseInt(s[2],10)/100,l=parseInt(s[3],10)/100;return i(s[4]),this.setHSL(_,a,l,e)}break}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=n[1],o=s.length;if(o===3)return this.r=parseInt(s.charAt(0)+s.charAt(0),16)/255,this.g=parseInt(s.charAt(1)+s.charAt(1),16)/255,this.b=parseInt(s.charAt(2)+s.charAt(2),16)/255,mn.toWorkingColorSpace(this,e),this;if(o===6)return this.r=parseInt(s.charAt(0)+s.charAt(1),16)/255,this.g=parseInt(s.charAt(2)+s.charAt(3),16)/255,this.b=parseInt(s.charAt(4)+s.charAt(5),16)/255,mn.toWorkingColorSpace(this,e),this}return t&&t.length>0?this.setColorName(t,e):this}setColorName(t,e=Nn){const i=pc[t.toLowerCase()];return i!==void 0?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=xs(t.r),this.g=xs(t.g),this.b=xs(t.b),this}copyLinearToSRGB(t){return this.r=Po(t.r),this.g=Po(t.g),this.b=Po(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Nn){return mn.fromWorkingColorSpace(eo(this,Oi),t),tn(Oi.r*255,0,255)<<16^tn(Oi.g*255,0,255)<<8^tn(Oi.b*255,0,255)<<0}getHexString(t=Nn){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=fs){mn.fromWorkingColorSpace(eo(this,Oi),e);const i=Oi.r,n=Oi.g,s=Oi.b,o=Math.max(i,n,s),r=Math.min(i,n,s);let _,a;const l=(r+o)/2;if(r===o)_=0,a=0;else{const h=o-r;switch(a=l<=.5?h/(o+r):h/(2-o-r),o){case i:_=(n-s)/h+(n<s?6:0);break;case n:_=(s-i)/h+2;break;case s:_=(i-n)/h+4;break}_/=6}return t.h=_,t.s=a,t.l=l,t}getRGB(t,e=fs){return mn.fromWorkingColorSpace(eo(this,Oi),e),t.r=Oi.r,t.g=Oi.g,t.b=Oi.b,t}getStyle(t=Nn){return mn.fromWorkingColorSpace(eo(this,Oi),t),t!==Nn?`color(${t} ${Oi.r} ${Oi.g} ${Oi.b})`:`rgb(${Oi.r*255|0},${Oi.g*255|0},${Oi.b*255|0})`}offsetHSL(t,e,i){return this.getHSL(fn),fn.h+=t,fn.s+=e,fn.l+=i,this.setHSL(fn.h,fn.s,fn.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(fn),t.getHSL(to);const i=Mr(fn.h,to.h,e),n=Mr(fn.s,to.s,e),s=Mr(fn.l,to.l,e);return this.setHSL(i,n,s),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),t.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}fi.NAMES=pc;fi.prototype.isColor=!0;fi.prototype.r=1;fi.prototype.g=1;fi.prototype.b=1;let Ss;class Xs{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement=="undefined")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{Ss===void 0&&(Ss=Ua("canvas")),Ss.width=t.width,Ss.height=t.height;const i=Ss.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=Ss}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement!="undefined"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&t instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&t instanceof ImageBitmap){const e=Ua("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const n=i.getImageData(0,0,t.width,t.height),s=n.data;for(let o=0;o<s.length;o++)s[o]=xs(s[o]/255)*255;return i.putImageData(n,0,0),e}else if(t.data){const e=t.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(xs(e[i]/255)*255):e[i]=xs(e[i]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}class zl{constructor(t=null){this.uuid=An(),this.data=t,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(n!==null){let s;if(Array.isArray(n)){s=[];for(let o=0,r=n.length;o<r;o++)n[o].isDataTexture?s.push(Ir(n[o].image)):s.push(Ir(n[o]))}else s=Ir(n);i.url=s}return e||(t.images[this.uuid]=i),i}}function Ir(c){return typeof HTMLImageElement!="undefined"&&c instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&c instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&c instanceof ImageBitmap?Xs.getDataURL(c):c.data?{data:Array.prototype.slice.call(c.data),width:c.width,height:c.height,type:c.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}zl.prototype.isSource=!0;let Hu=0;class $i extends ws{constructor(t=$i.DEFAULT_IMAGE,e=$i.DEFAULT_MAPPING,i=xn,n=xn,s=rn,o=Ko,r=vn,_=ys,a=1,l=es){super(),Object.defineProperty(this,"id",{value:Hu++}),this.uuid=An(),this.name="",this.source=new zl(t),this.mipmaps=[],this.mapping=e,this.wrapS=i,this.wrapT=n,this.magFilter=s,this.minFilter=o,this.anisotropy=a,this.format=r,this.internalFormat=null,this.type=_,this.offset=new Ne(0,0),this.repeat=new Ne(1,1),this.center=new Ne(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new qi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=l,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==hc)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case ll:t.x=t.x-Math.floor(t.x);break;case xn:t.x=t.x<0?0:1;break;case _l:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case ll:t.y=t.y-Math.floor(t.y);break;case xn:t.y=t.y<0?0:1;break;case _l:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}}$i.DEFAULT_IMAGE=null;$i.DEFAULT_MAPPING=hc;$i.prototype.isTexture=!0;class Li{constructor(t=0,e=0,i=0,n=1){this.x=t,this.y=e,this.z=i,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t,e){return e!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return e!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,s=this.w,o=t.elements;return this.x=o[0]*e+o[4]*i+o[8]*n+o[12]*s,this.y=o[1]*e+o[5]*i+o[9]*n+o[13]*s,this.z=o[2]*e+o[6]*i+o[10]*n+o[14]*s,this.w=o[3]*e+o[7]*i+o[11]*n+o[15]*s,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,n,s;const _=t.elements,a=_[0],l=_[4],h=_[8],u=_[1],f=_[5],m=_[9],d=_[2],p=_[6],g=_[10];if(Math.abs(l-u)<.01&&Math.abs(h-d)<.01&&Math.abs(m-p)<.01){if(Math.abs(l+u)<.1&&Math.abs(h+d)<.1&&Math.abs(m+p)<.1&&Math.abs(a+f+g-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const b=(a+1)/2,y=(f+1)/2,z=(g+1)/2,M=(l+u)/4,Y=(h+d)/4,X=(m+p)/4;return b>y&&b>z?b<.01?(i=0,n=.707106781,s=.707106781):(i=Math.sqrt(b),n=M/i,s=Y/i):y>z?y<.01?(i=.707106781,n=0,s=.707106781):(n=Math.sqrt(y),i=M/n,s=X/n):z<.01?(i=.707106781,n=.707106781,s=0):(s=Math.sqrt(z),i=Y/s,n=X/s),this.set(i,n,s,e),this}let x=Math.sqrt((p-m)*(p-m)+(h-d)*(h-d)+(u-l)*(u-l));return Math.abs(x)<.001&&(x=1),this.x=(p-m)/x,this.y=(h-d)/x,this.z=(u-l)/x,this.w=Math.acos((a+f+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,i){return i!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Li.prototype.isVector4=!0;class ln extends ws{constructor(t,e,i={}){super(),this.width=t,this.height=e,this.depth=1,this.scissor=new Li(0,0,t,e),this.scissorTest=!1,this.viewport=new Li(0,0,t,e);const n={width:t,height:e,depth:1};this.texture=new $i(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:rn,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(t,e,i=1){(this.width!==t||this.height!==e||this.depth!==i)&&(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new zl(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}ln.prototype.isWebGLRenderTarget=!0;class Qo extends $i{constructor(t=null,e=1,i=1,n=1){super(null),this.image={data:t,width:e,height:i,depth:n},this.magFilter=ji,this.minFilter=ji,this.wrapR=xn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Qo.prototype.isDataArrayTexture=!0;class Wu extends ln{constructor(t,e,i){super(t,e),this.depth=i,this.texture=new Qo(null,t,e,i),this.texture.isRenderTargetTexture=!0}}Wu.prototype.isWebGLArrayRenderTarget=!0;class Sl extends $i{constructor(t=null,e=1,i=1,n=1){super(null),this.image={data:t,width:e,height:i,depth:n},this.magFilter=ji,this.minFilter=ji,this.wrapR=xn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Sl.prototype.isData3DTexture=!0;class ju extends ln{constructor(t,e,i){super(t,e),this.depth=i,this.texture=new Sl(null,t,e,i),this.texture.isRenderTargetTexture=!0}}ju.prototype.isWebGL3DRenderTarget=!0;class qu extends ln{constructor(t,e,i,n={}){super(t,e,n);const s=this.texture;this.texture=[];for(let o=0;o<i;o++)this.texture[o]=s.clone(),this.texture[o].isRenderTargetTexture=!0}setSize(t,e,i=1){if(this.width!==t||this.height!==e||this.depth!==i){this.width=t,this.height=e,this.depth=i;for(let n=0,s=this.texture.length;n<s;n++)this.texture[n].image.width=t,this.texture[n].image.height=e,this.texture[n].image.depth=i;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.texture.length=0;for(let e=0,i=t.texture.length;e<i;e++)this.texture[e]=t.texture[e].clone(),this.texture[e].isRenderTargetTexture=!0;return this}}qu.prototype.isWebGLMultipleRenderTargets=!0;class _n{constructor(t=0,e=0,i=0,n=1){this._x=t,this._y=e,this._z=i,this._w=n}static slerp(t,e,i,n){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(t,e,n)}static slerpFlat(t,e,i,n,s,o,r){let _=i[n+0],a=i[n+1],l=i[n+2],h=i[n+3];const u=s[o+0],f=s[o+1],m=s[o+2],d=s[o+3];if(r===0){t[e+0]=_,t[e+1]=a,t[e+2]=l,t[e+3]=h;return}if(r===1){t[e+0]=u,t[e+1]=f,t[e+2]=m,t[e+3]=d;return}if(h!==d||_!==u||a!==f||l!==m){let p=1-r;const g=_*u+a*f+l*m+h*d,x=g>=0?1:-1,b=1-g*g;if(b>Number.EPSILON){const z=Math.sqrt(b),M=Math.atan2(z,g*x);p=Math.sin(p*M)/z,r=Math.sin(r*M)/z}const y=r*x;if(_=_*p+u*y,a=a*p+f*y,l=l*p+m*y,h=h*p+d*y,p===1-r){const z=1/Math.sqrt(_*_+a*a+l*l+h*h);_*=z,a*=z,l*=z,h*=z}}t[e]=_,t[e+1]=a,t[e+2]=l,t[e+3]=h}static multiplyQuaternionsFlat(t,e,i,n,s,o){const r=i[n],_=i[n+1],a=i[n+2],l=i[n+3],h=s[o],u=s[o+1],f=s[o+2],m=s[o+3];return t[e]=r*m+l*h+_*f-a*u,t[e+1]=_*m+l*u+a*h-r*f,t[e+2]=a*m+l*f+r*u-_*h,t[e+3]=l*m-r*h-_*u-a*f,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!(t&&t.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,n=t._y,s=t._z,o=t._order,r=Math.cos,_=Math.sin,a=r(i/2),l=r(n/2),h=r(s/2),u=_(i/2),f=_(n/2),m=_(s/2);switch(o){case"XYZ":this._x=u*l*h+a*f*m,this._y=a*f*h-u*l*m,this._z=a*l*m+u*f*h,this._w=a*l*h-u*f*m;break;case"YXZ":this._x=u*l*h+a*f*m,this._y=a*f*h-u*l*m,this._z=a*l*m-u*f*h,this._w=a*l*h+u*f*m;break;case"ZXY":this._x=u*l*h-a*f*m,this._y=a*f*h+u*l*m,this._z=a*l*m+u*f*h,this._w=a*l*h-u*f*m;break;case"ZYX":this._x=u*l*h-a*f*m,this._y=a*f*h+u*l*m,this._z=a*l*m-u*f*h,this._w=a*l*h+u*f*m;break;case"YZX":this._x=u*l*h+a*f*m,this._y=a*f*h+u*l*m,this._z=a*l*m-u*f*h,this._w=a*l*h-u*f*m;break;case"XZY":this._x=u*l*h-a*f*m,this._y=a*f*h-u*l*m,this._z=a*l*m+u*f*h,this._w=a*l*h+u*f*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],n=e[4],s=e[8],o=e[1],r=e[5],_=e[9],a=e[2],l=e[6],h=e[10],u=i+r+h;if(u>0){const f=.5/Math.sqrt(u+1);this._w=.25/f,this._x=(l-_)*f,this._y=(s-a)*f,this._z=(o-n)*f}else if(i>r&&i>h){const f=2*Math.sqrt(1+i-r-h);this._w=(l-_)/f,this._x=.25*f,this._y=(n+o)/f,this._z=(s+a)/f}else if(r>h){const f=2*Math.sqrt(1+r-i-h);this._w=(s-a)/f,this._x=(n+o)/f,this._y=.25*f,this._z=(_+l)/f}else{const f=2*Math.sqrt(1+h-i-r);this._w=(o-n)/f,this._x=(s+a)/f,this._y=(_+l)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(tn(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(i===0)return this;const n=Math.min(1,e/i);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return e!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,n=t._y,s=t._z,o=t._w,r=e._x,_=e._y,a=e._z,l=e._w;return this._x=i*l+o*r+n*a-s*_,this._y=n*l+o*_+s*r-i*a,this._z=s*l+o*a+i*_-n*r,this._w=o*l-i*r-n*_-s*a,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const i=this._x,n=this._y,s=this._z,o=this._w;let r=o*t._w+i*t._x+n*t._y+s*t._z;if(r<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,r=-r):this.copy(t),r>=1)return this._w=o,this._x=i,this._y=n,this._z=s,this;const _=1-r*r;if(_<=Number.EPSILON){const f=1-e;return this._w=f*o+e*this._w,this._x=f*i+e*this._x,this._y=f*n+e*this._y,this._z=f*s+e*this._z,this.normalize(),this._onChangeCallback(),this}const a=Math.sqrt(_),l=Math.atan2(a,r),h=Math.sin((1-e)*l)/a,u=Math.sin(e*l)/a;return this._w=o*h+this._w*u,this._x=i*h+this._x*u,this._y=n*h+this._y*u,this._z=s*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),n=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(e*Math.cos(n),i*Math.sin(s),i*Math.cos(s),e*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}_n.prototype.isQuaternion=!0;class wt{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}set(t,e,i){return i===void 0&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return e!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return e!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return e!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(N_.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(N_.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6]*n,this.y=s[1]*e+s[4]*i+s[7]*n,this.z=s[2]*e+s[5]*i+s[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,s=t.elements,o=1/(s[3]*e+s[7]*i+s[11]*n+s[15]);return this.x=(s[0]*e+s[4]*i+s[8]*n+s[12])*o,this.y=(s[1]*e+s[5]*i+s[9]*n+s[13])*o,this.z=(s[2]*e+s[6]*i+s[10]*n+s[14])*o,this}applyQuaternion(t){const e=this.x,i=this.y,n=this.z,s=t.x,o=t.y,r=t.z,_=t.w,a=_*e+o*n-r*i,l=_*i+r*e-s*n,h=_*n+s*i-o*e,u=-s*e-o*i-r*n;return this.x=a*_+u*-s+l*-r-h*-o,this.y=l*_+u*-o+h*-s-a*-r,this.z=h*_+u*-r+a*-o-l*-s,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n,this.y=s[1]*e+s[5]*i+s[9]*n,this.z=s[2]*e+s[6]*i+s[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t,e){return e!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,n=t.y,s=t.z,o=e.x,r=e.y,_=e.z;return this.x=n*_-s*r,this.y=s*o-i*_,this.z=i*r-n*o,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return zr.copy(this).projectOnVector(t),this.sub(zr)}reflect(t){return this.sub(zr.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(tn(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,i){return i!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}wt.prototype.isVector3=!0;const zr=new wt,N_=new _n;class Xn{constructor(t=new wt(1/0,1/0,1/0),e=new wt(-1/0,-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,i=1/0,n=1/0,s=-1/0,o=-1/0,r=-1/0;for(let _=0,a=t.length;_<a;_+=3){const l=t[_],h=t[_+1],u=t[_+2];l<e&&(e=l),h<i&&(i=h),u<n&&(n=u),l>s&&(s=l),h>o&&(o=h),u>r&&(r=u)}return this.min.set(e,i,n),this.max.set(s,o,r),this}setFromBufferAttribute(t){let e=1/0,i=1/0,n=1/0,s=-1/0,o=-1/0,r=-1/0;for(let _=0,a=t.count;_<a;_++){const l=t.getX(_),h=t.getY(_),u=t.getZ(_);l<e&&(e=l),h<i&&(i=h),u<n&&(n=u),l>s&&(s=l),h>o&&(o=h),u>r&&(r=u)}return this.min.set(e,i,n),this.max.set(s,o,r),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=rs.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(i!==void 0)if(e&&i.attributes!=null&&i.attributes.position!==void 0){const s=i.attributes.position;for(let o=0,r=s.count;o<r;o++)rs.fromBufferAttribute(s,o).applyMatrix4(t.matrixWorld),this.expandByPoint(rs)}else i.boundingBox===null&&i.computeBoundingBox(),Sr.copy(i.boundingBox),Sr.applyMatrix4(t.matrixWorld),this.union(Sr);const n=t.children;for(let s=0,o=n.length;s<o;s++)this.expandByObject(n[s],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,rs),rs.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(ba),io.subVectors(this.max,ba),Ys.subVectors(t.a,ba),Zs.subVectors(t.b,ba),Ls.subVectors(t.c,ba),Un.subVectors(Zs,Ys),Gn.subVectors(Ls,Zs),ls.subVectors(Ys,Ls);let e=[0,-Un.z,Un.y,0,-Gn.z,Gn.y,0,-ls.z,ls.y,Un.z,0,-Un.x,Gn.z,0,-Gn.x,ls.z,0,-ls.x,-Un.y,Un.x,0,-Gn.y,Gn.x,0,-ls.y,ls.x,0];return!Yr(e,Ys,Zs,Ls,io)||(e=[1,0,0,0,1,0,0,0,1],!Yr(e,Ys,Zs,Ls,io))?!1:(no.crossVectors(Un,Gn),e=[no.x,no.y,no.z],Yr(e,Ys,Zs,Ls,io))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return rs.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=this.getSize(rs).length()*.5,t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(Cn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Cn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Cn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Cn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Cn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Cn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Cn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Cn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Cn),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}Xn.prototype.isBox3=!0;const Cn=[new wt,new wt,new wt,new wt,new wt,new wt,new wt,new wt],rs=new wt,Sr=new Xn,Ys=new wt,Zs=new wt,Ls=new wt,Un=new wt,Gn=new wt,ls=new wt,ba=new wt,io=new wt,no=new wt,_s=new wt;function Yr(c,t,e,i,n){for(let s=0,o=c.length-3;s<=o;s+=3){_s.fromArray(c,s);const r=n.x*Math.abs(_s.x)+n.y*Math.abs(_s.y)+n.z*Math.abs(_s.z),_=t.dot(_s),a=e.dot(_s),l=i.dot(_s);if(Math.max(-Math.max(_,a,l),Math.min(_,a,l))>r)return!1}return!0}const Ju=new Xn,F_=new wt,so=new wt,Zr=new wt;class la{constructor(t=new wt,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;e!==void 0?i.copy(e):Ju.setFromPoints(t).getCenter(i);let n=0;for(let s=0,o=t.length;s<o;s++)n=Math.max(n,i.distanceToSquared(t[s]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){Zr.subVectors(t,this.center);const e=Zr.lengthSq();if(e>this.radius*this.radius){const i=Math.sqrt(e),n=(i-this.radius)*.5;this.center.add(Zr.multiplyScalar(n/i)),this.radius+=n}return this}union(t){return this.center.equals(t.center)===!0?so.set(0,0,1).multiplyScalar(t.radius):so.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(F_.copy(t.center).add(so)),this.expandByPoint(F_.copy(t.center).sub(so)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Pn=new wt,Lr=new wt,ao=new wt,Hn=new wt,Ar=new wt,oo=new wt,Tr=new wt;class _a{constructor(t=new wt,e=new wt(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Pn)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Pn.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Pn.copy(this.direction).multiplyScalar(e).add(this.origin),Pn.distanceToSquared(t))}distanceSqToSegment(t,e,i,n){Lr.copy(t).add(e).multiplyScalar(.5),ao.copy(e).sub(t).normalize(),Hn.copy(this.origin).sub(Lr);const s=t.distanceTo(e)*.5,o=-this.direction.dot(ao),r=Hn.dot(this.direction),_=-Hn.dot(ao),a=Hn.lengthSq(),l=Math.abs(1-o*o);let h,u,f,m;if(l>0)if(h=o*_-r,u=o*r-_,m=s*l,h>=0)if(u>=-m)if(u<=m){const d=1/l;h*=d,u*=d,f=h*(h+o*u+2*r)+u*(o*h+u+2*_)+a}else u=s,h=Math.max(0,-(o*u+r)),f=-h*h+u*(u+2*_)+a;else u=-s,h=Math.max(0,-(o*u+r)),f=-h*h+u*(u+2*_)+a;else u<=-m?(h=Math.max(0,-(-o*s+r)),u=h>0?-s:Math.min(Math.max(-s,-_),s),f=-h*h+u*(u+2*_)+a):u<=m?(h=0,u=Math.min(Math.max(-s,-_),s),f=u*(u+2*_)+a):(h=Math.max(0,-(o*s+r)),u=h>0?s:Math.min(Math.max(-s,-_),s),f=-h*h+u*(u+2*_)+a);else u=o>0?-s:s,h=Math.max(0,-(o*u+r)),f=-h*h+u*(u+2*_)+a;return i&&i.copy(this.direction).multiplyScalar(h).add(this.origin),n&&n.copy(ao).multiplyScalar(u).add(Lr),f}intersectSphere(t,e){Pn.subVectors(t.center,this.origin);const i=Pn.dot(this.direction),n=Pn.dot(Pn)-i*i,s=t.radius*t.radius;if(n>s)return null;const o=Math.sqrt(s-n),r=i-o,_=i+o;return r<0&&_<0?null:r<0?this.at(_,e):this.at(r,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return i===null?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,n,s,o,r,_;const a=1/this.direction.x,l=1/this.direction.y,h=1/this.direction.z,u=this.origin;return a>=0?(i=(t.min.x-u.x)*a,n=(t.max.x-u.x)*a):(i=(t.max.x-u.x)*a,n=(t.min.x-u.x)*a),l>=0?(s=(t.min.y-u.y)*l,o=(t.max.y-u.y)*l):(s=(t.max.y-u.y)*l,o=(t.min.y-u.y)*l),i>o||s>n||((s>i||i!==i)&&(i=s),(o<n||n!==n)&&(n=o),h>=0?(r=(t.min.z-u.z)*h,_=(t.max.z-u.z)*h):(r=(t.max.z-u.z)*h,_=(t.min.z-u.z)*h),i>_||r>n)||((r>i||i!==i)&&(i=r),(_<n||n!==n)&&(n=_),n<0)?null:this.at(i>=0?i:n,e)}intersectsBox(t){return this.intersectBox(t,Pn)!==null}intersectTriangle(t,e,i,n,s){Ar.subVectors(e,t),oo.subVectors(i,t),Tr.crossVectors(Ar,oo);let o=this.direction.dot(Tr),r;if(o>0){if(n)return null;r=1}else if(o<0)r=-1,o=-o;else return null;Hn.subVectors(this.origin,t);const _=r*this.direction.dot(oo.crossVectors(Hn,oo));if(_<0)return null;const a=r*this.direction.dot(Ar.cross(Hn));if(a<0||_+a>o)return null;const l=-r*Hn.dot(Tr);return l<0?null:this.at(l/o,s)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class vi{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,s,o,r,_,a,l,h,u,f,m,d,p){const g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=n,g[1]=s,g[5]=o,g[9]=r,g[13]=_,g[2]=a,g[6]=l,g[10]=h,g[14]=u,g[3]=f,g[7]=m,g[11]=d,g[15]=p,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new vi().fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,n=1/As.setFromMatrixColumn(t,0).length(),s=1/As.setFromMatrixColumn(t,1).length(),o=1/As.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*s,e[5]=i[5]*s,e[6]=i[6]*s,e[7]=0,e[8]=i[8]*o,e[9]=i[9]*o,e[10]=i[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,i=t.x,n=t.y,s=t.z,o=Math.cos(i),r=Math.sin(i),_=Math.cos(n),a=Math.sin(n),l=Math.cos(s),h=Math.sin(s);if(t.order==="XYZ"){const u=o*l,f=o*h,m=r*l,d=r*h;e[0]=_*l,e[4]=-_*h,e[8]=a,e[1]=f+m*a,e[5]=u-d*a,e[9]=-r*_,e[2]=d-u*a,e[6]=m+f*a,e[10]=o*_}else if(t.order==="YXZ"){const u=_*l,f=_*h,m=a*l,d=a*h;e[0]=u+d*r,e[4]=m*r-f,e[8]=o*a,e[1]=o*h,e[5]=o*l,e[9]=-r,e[2]=f*r-m,e[6]=d+u*r,e[10]=o*_}else if(t.order==="ZXY"){const u=_*l,f=_*h,m=a*l,d=a*h;e[0]=u-d*r,e[4]=-o*h,e[8]=m+f*r,e[1]=f+m*r,e[5]=o*l,e[9]=d-u*r,e[2]=-o*a,e[6]=r,e[10]=o*_}else if(t.order==="ZYX"){const u=o*l,f=o*h,m=r*l,d=r*h;e[0]=_*l,e[4]=m*a-f,e[8]=u*a+d,e[1]=_*h,e[5]=d*a+u,e[9]=f*a-m,e[2]=-a,e[6]=r*_,e[10]=o*_}else if(t.order==="YZX"){const u=o*_,f=o*a,m=r*_,d=r*a;e[0]=_*l,e[4]=d-u*h,e[8]=m*h+f,e[1]=h,e[5]=o*l,e[9]=-r*l,e[2]=-a*l,e[6]=f*h+m,e[10]=u-d*h}else if(t.order==="XZY"){const u=o*_,f=o*a,m=r*_,d=r*a;e[0]=_*l,e[4]=-h,e[8]=a*l,e[1]=u*h+d,e[5]=o*l,e[9]=f*h-m,e[2]=m*h-f,e[6]=r*l,e[10]=d*h+u}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose($u,t,Ku)}lookAt(t,e,i){const n=this.elements;return hn.subVectors(t,e),hn.lengthSq()===0&&(hn.z=1),hn.normalize(),Wn.crossVectors(i,hn),Wn.lengthSq()===0&&(Math.abs(i.z)===1?hn.x+=1e-4:hn.z+=1e-4,hn.normalize(),Wn.crossVectors(i,hn)),Wn.normalize(),ro.crossVectors(hn,Wn),n[0]=Wn.x,n[4]=ro.x,n[8]=hn.x,n[1]=Wn.y,n[5]=ro.y,n[9]=hn.y,n[2]=Wn.z,n[6]=ro.z,n[10]=hn.z,this}multiply(t,e){return e!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,s=this.elements,o=i[0],r=i[4],_=i[8],a=i[12],l=i[1],h=i[5],u=i[9],f=i[13],m=i[2],d=i[6],p=i[10],g=i[14],x=i[3],b=i[7],y=i[11],z=i[15],M=n[0],Y=n[4],X=n[8],w=n[12],S=n[1],V=n[5],F=n[9],C=n[13],A=n[2],Z=n[6],L=n[10],E=n[14],T=n[3],P=n[7],N=n[11],R=n[15];return s[0]=o*M+r*S+_*A+a*T,s[4]=o*Y+r*V+_*Z+a*P,s[8]=o*X+r*F+_*L+a*N,s[12]=o*w+r*C+_*E+a*R,s[1]=l*M+h*S+u*A+f*T,s[5]=l*Y+h*V+u*Z+f*P,s[9]=l*X+h*F+u*L+f*N,s[13]=l*w+h*C+u*E+f*R,s[2]=m*M+d*S+p*A+g*T,s[6]=m*Y+d*V+p*Z+g*P,s[10]=m*X+d*F+p*L+g*N,s[14]=m*w+d*C+p*E+g*R,s[3]=x*M+b*S+y*A+z*T,s[7]=x*Y+b*V+y*Z+z*P,s[11]=x*X+b*F+y*L+z*N,s[15]=x*w+b*C+y*E+z*R,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],n=t[8],s=t[12],o=t[1],r=t[5],_=t[9],a=t[13],l=t[2],h=t[6],u=t[10],f=t[14],m=t[3],d=t[7],p=t[11],g=t[15];return m*(+s*_*h-n*a*h-s*r*u+i*a*u+n*r*f-i*_*f)+d*(+e*_*f-e*a*u+s*o*u-n*o*f+n*a*l-s*_*l)+p*(+e*a*h-e*r*f-s*o*h+i*o*f+s*r*l-i*a*l)+g*(-n*r*l-e*_*h+e*r*u+n*o*h-i*o*u+i*_*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],o=t[4],r=t[5],_=t[6],a=t[7],l=t[8],h=t[9],u=t[10],f=t[11],m=t[12],d=t[13],p=t[14],g=t[15],x=h*p*a-d*u*a+d*_*f-r*p*f-h*_*g+r*u*g,b=m*u*a-l*p*a-m*_*f+o*p*f+l*_*g-o*u*g,y=l*d*a-m*h*a+m*r*f-o*d*f-l*r*g+o*h*g,z=m*h*_-l*d*_-m*r*u+o*d*u+l*r*p-o*h*p,M=e*x+i*b+n*y+s*z;if(M===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Y=1/M;return t[0]=x*Y,t[1]=(d*u*s-h*p*s-d*n*f+i*p*f+h*n*g-i*u*g)*Y,t[2]=(r*p*s-d*_*s+d*n*a-i*p*a-r*n*g+i*_*g)*Y,t[3]=(h*_*s-r*u*s-h*n*a+i*u*a+r*n*f-i*_*f)*Y,t[4]=b*Y,t[5]=(l*p*s-m*u*s+m*n*f-e*p*f-l*n*g+e*u*g)*Y,t[6]=(m*_*s-o*p*s-m*n*a+e*p*a+o*n*g-e*_*g)*Y,t[7]=(o*u*s-l*_*s+l*n*a-e*u*a-o*n*f+e*_*f)*Y,t[8]=y*Y,t[9]=(m*h*s-l*d*s-m*i*f+e*d*f+l*i*g-e*h*g)*Y,t[10]=(o*d*s-m*r*s+m*i*a-e*d*a-o*i*g+e*r*g)*Y,t[11]=(l*r*s-o*h*s-l*i*a+e*h*a+o*i*f-e*r*f)*Y,t[12]=z*Y,t[13]=(l*d*n-m*h*n+m*i*u-e*d*u-l*i*p+e*h*p)*Y,t[14]=(m*r*n-o*d*n-m*i*_+e*d*_+o*i*p-e*r*p)*Y,t[15]=(o*h*n-l*r*n+l*i*_-e*h*_-o*i*u+e*r*u)*Y,this}scale(t){const e=this.elements,i=t.x,n=t.y,s=t.z;return e[0]*=i,e[4]*=n,e[8]*=s,e[1]*=i,e[5]*=n,e[9]*=s,e[2]*=i,e[6]*=n,e[10]*=s,e[3]*=i,e[7]*=n,e[11]*=s,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),n=Math.sin(e),s=1-i,o=t.x,r=t.y,_=t.z,a=s*o,l=s*r;return this.set(a*o+i,a*r-n*_,a*_+n*r,0,a*r+n*_,l*r+i,l*_-n*o,0,a*_-n*r,l*_+n*o,s*_*_+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,n,s,o){return this.set(1,i,s,0,t,1,o,0,e,n,1,0,0,0,0,1),this}compose(t,e,i){const n=this.elements,s=e._x,o=e._y,r=e._z,_=e._w,a=s+s,l=o+o,h=r+r,u=s*a,f=s*l,m=s*h,d=o*l,p=o*h,g=r*h,x=_*a,b=_*l,y=_*h,z=i.x,M=i.y,Y=i.z;return n[0]=(1-(d+g))*z,n[1]=(f+y)*z,n[2]=(m-b)*z,n[3]=0,n[4]=(f-y)*M,n[5]=(1-(u+g))*M,n[6]=(p+x)*M,n[7]=0,n[8]=(m+b)*Y,n[9]=(p-x)*Y,n[10]=(1-(u+d))*Y,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,i){const n=this.elements;let s=As.set(n[0],n[1],n[2]).length();const o=As.set(n[4],n[5],n[6]).length(),r=As.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),t.x=n[12],t.y=n[13],t.z=n[14],dn.copy(this);const a=1/s,l=1/o,h=1/r;return dn.elements[0]*=a,dn.elements[1]*=a,dn.elements[2]*=a,dn.elements[4]*=l,dn.elements[5]*=l,dn.elements[6]*=l,dn.elements[8]*=h,dn.elements[9]*=h,dn.elements[10]*=h,e.setFromRotationMatrix(dn),i.x=s,i.y=o,i.z=r,this}makePerspective(t,e,i,n,s,o){o===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const r=this.elements,_=2*s/(e-t),a=2*s/(i-n),l=(e+t)/(e-t),h=(i+n)/(i-n),u=-(o+s)/(o-s),f=-2*o*s/(o-s);return r[0]=_,r[4]=0,r[8]=l,r[12]=0,r[1]=0,r[5]=a,r[9]=h,r[13]=0,r[2]=0,r[6]=0,r[10]=u,r[14]=f,r[3]=0,r[7]=0,r[11]=-1,r[15]=0,this}makeOrthographic(t,e,i,n,s,o){const r=this.elements,_=1/(e-t),a=1/(i-n),l=1/(o-s),h=(e+t)*_,u=(i+n)*a,f=(o+s)*l;return r[0]=2*_,r[4]=0,r[8]=0,r[12]=-h,r[1]=0,r[5]=2*a,r[9]=0,r[13]=-u,r[2]=0,r[6]=0,r[10]=-2*l,r[14]=-f,r[3]=0,r[7]=0,r[11]=0,r[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let n=0;n<16;n++)if(e[n]!==i[n])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}vi.prototype.isMatrix4=!0;const As=new wt,dn=new vi,$u=new wt(0,0,0),Ku=new wt(1,1,1),Wn=new wt,ro=new wt,hn=new wt,O_=new vi,U_=new _n;class Is{constructor(t=0,e=0,i=0,n=Is.DefaultOrder){this._x=t,this._y=e,this._z=i,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,n=this._order){return this._x=t,this._y=e,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const n=t.elements,s=n[0],o=n[4],r=n[8],_=n[1],a=n[5],l=n[9],h=n[2],u=n[6],f=n[10];switch(e){case"XYZ":this._y=Math.asin(tn(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(-l,f),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(u,a),this._z=0);break;case"YXZ":this._x=Math.asin(-tn(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(r,f),this._z=Math.atan2(_,a)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(tn(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-o,a)):(this._y=0,this._z=Math.atan2(_,s));break;case"ZYX":this._y=Math.asin(-tn(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,f),this._z=Math.atan2(_,s)):(this._x=0,this._z=Math.atan2(-o,a));break;case"YZX":this._z=Math.asin(tn(_,-1,1)),Math.abs(_)<.9999999?(this._x=Math.atan2(-l,a),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(r,f));break;case"XZY":this._z=Math.asin(-tn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(u,a),this._y=Math.atan2(r,s)):(this._x=Math.atan2(-l,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,i===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return O_.makeRotationFromQuaternion(t),this.setFromRotationMatrix(O_,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return U_.setFromEuler(this),this.setFromQuaternion(U_,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Is.prototype.isEuler=!0;Is.DefaultOrder="XYZ";Is.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class mc{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let Qu=0;const G_=new wt,Ts=new _n,Rn=new vi,lo=new wt,ya=new wt,tp=new wt,ep=new _n,H_=new wt(1,0,0),W_=new wt(0,1,0),j_=new wt(0,0,1),ip={type:"added"},q_={type:"removed"};class Ti extends ws{constructor(){super(),Object.defineProperty(this,"id",{value:Qu++}),this.uuid=An(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ti.DefaultUp.clone();const t=new wt,e=new Is,i=new _n,n=new wt(1,1,1);function s(){i.setFromEuler(e,!1)}function o(){e.setFromQuaternion(i,void 0,!1)}e._onChange(s),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new vi},normalMatrix:{value:new qi}}),this.matrix=new vi,this.matrixWorld=new vi,this.matrixAutoUpdate=Ti.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new mc,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Ts.setFromAxisAngle(t,e),this.quaternion.multiply(Ts),this}rotateOnWorldAxis(t,e){return Ts.setFromAxisAngle(t,e),this.quaternion.premultiply(Ts),this}rotateX(t){return this.rotateOnAxis(H_,t)}rotateY(t){return this.rotateOnAxis(W_,t)}rotateZ(t){return this.rotateOnAxis(j_,t)}translateOnAxis(t,e){return G_.copy(t).applyQuaternion(this.quaternion),this.position.add(G_.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(H_,t)}translateY(t){return this.translateOnAxis(W_,t)}translateZ(t){return this.translateOnAxis(j_,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(Rn.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?lo.copy(t):lo.set(t,e,i);const n=this.parent;this.updateWorldMatrix(!0,!1),ya.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Rn.lookAt(ya,lo,this.up):Rn.lookAt(lo,ya,this.up),this.quaternion.setFromRotationMatrix(Rn),n&&(Rn.extractRotation(n.matrixWorld),Ts.setFromRotationMatrix(Rn),this.quaternion.premultiply(Ts.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(ip)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(q_)),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(q_)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Rn.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),Rn.multiply(t.parent.matrixWorld)),t.applyMatrix4(Rn),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,n=this.children.length;i<n;i++){const o=this.children[i].getObjectByProperty(t,e);if(o!==void 0)return o}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ya,t,tp),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ya,ep,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].updateMatrixWorld(t)}updateWorldMatrix(t,e){const i=this.parent;if(t===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){const n=this.children;for(let s=0,o=n.length;s<o;s++)n[s].updateWorldMatrix(!1,!0)}}toJSON(t){const e=t===void 0||typeof t=="string",i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON()));function s(r,_){return r[_.uuid]===void 0&&(r[_.uuid]=_.toJSON(t)),_.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=s(t.geometries,this.geometry);const r=this.geometry.parameters;if(r!==void 0&&r.shapes!==void 0){const _=r.shapes;if(Array.isArray(_))for(let a=0,l=_.length;a<l;a++){const h=_[a];s(t.shapes,h)}else s(t.shapes,_)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const r=[];for(let _=0,a=this.material.length;_<a;_++)r.push(s(t.materials,this.material[_]));n.material=r}else n.material=s(t.materials,this.material);if(this.children.length>0){n.children=[];for(let r=0;r<this.children.length;r++)n.children.push(this.children[r].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let r=0;r<this.animations.length;r++){const _=this.animations[r];n.animations.push(s(t.animations,_))}}if(e){const r=o(t.geometries),_=o(t.materials),a=o(t.textures),l=o(t.images),h=o(t.shapes),u=o(t.skeletons),f=o(t.animations),m=o(t.nodes);r.length>0&&(i.geometries=r),_.length>0&&(i.materials=_),a.length>0&&(i.textures=a),l.length>0&&(i.images=l),h.length>0&&(i.shapes=h),u.length>0&&(i.skeletons=u),f.length>0&&(i.animations=f),m.length>0&&(i.nodes=m)}return i.object=n,i;function o(r){const _=[];for(const a in r){const l=r[a];delete l.metadata,_.push(l)}return _}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let i=0;i<t.children.length;i++){const n=t.children[i];this.add(n.clone())}return this}}Ti.DefaultUp=new wt(0,1,0);Ti.DefaultMatrixAutoUpdate=!0;Ti.prototype.isObject3D=!0;const gn=new wt,kn=new wt,Vr=new wt,Bn=new wt,Vs=new wt,Es=new wt,J_=new wt,Er=new wt,Cr=new wt,Pr=new wt;class Fi{constructor(t=new wt,e=new wt,i=new wt){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,n){n.subVectors(i,e),gn.subVectors(t,e),n.cross(gn);const s=n.lengthSq();return s>0?n.multiplyScalar(1/Math.sqrt(s)):n.set(0,0,0)}static getBarycoord(t,e,i,n,s){gn.subVectors(n,e),kn.subVectors(i,e),Vr.subVectors(t,e);const o=gn.dot(gn),r=gn.dot(kn),_=gn.dot(Vr),a=kn.dot(kn),l=kn.dot(Vr),h=o*a-r*r;if(h===0)return s.set(-2,-1,-1);const u=1/h,f=(a*_-r*l)*u,m=(o*l-r*_)*u;return s.set(1-f-m,m,f)}static containsPoint(t,e,i,n){return this.getBarycoord(t,e,i,n,Bn),Bn.x>=0&&Bn.y>=0&&Bn.x+Bn.y<=1}static getUV(t,e,i,n,s,o,r,_){return this.getBarycoord(t,e,i,n,Bn),_.set(0,0),_.addScaledVector(s,Bn.x),_.addScaledVector(o,Bn.y),_.addScaledVector(r,Bn.z),_}static isFrontFacing(t,e,i,n){return gn.subVectors(i,e),kn.subVectors(t,e),gn.cross(kn).dot(n)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,e,i,n){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,n),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return gn.subVectors(this.c,this.b),kn.subVectors(this.a,this.b),gn.cross(kn).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Fi.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Fi.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,n,s){return Fi.getUV(t,this.a,this.b,this.c,e,i,n,s)}containsPoint(t){return Fi.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Fi.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,n=this.b,s=this.c;let o,r;Vs.subVectors(n,i),Es.subVectors(s,i),Er.subVectors(t,i);const _=Vs.dot(Er),a=Es.dot(Er);if(_<=0&&a<=0)return e.copy(i);Cr.subVectors(t,n);const l=Vs.dot(Cr),h=Es.dot(Cr);if(l>=0&&h<=l)return e.copy(n);const u=_*h-l*a;if(u<=0&&_>=0&&l<=0)return o=_/(_-l),e.copy(i).addScaledVector(Vs,o);Pr.subVectors(t,s);const f=Vs.dot(Pr),m=Es.dot(Pr);if(m>=0&&f<=m)return e.copy(s);const d=f*a-_*m;if(d<=0&&a>=0&&m<=0)return r=a/(a-m),e.copy(i).addScaledVector(Es,r);const p=l*m-f*h;if(p<=0&&h-l>=0&&f-m>=0)return J_.subVectors(s,n),r=(h-l)/(h-l+(f-m)),e.copy(n).addScaledVector(J_,r);const g=1/(p+d+u);return o=d*g,r=u*g,e.copy(i).addScaledVector(Vs,o).addScaledVector(Es,r)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let np=0;class Gi extends ws{constructor(){super(),Object.defineProperty(this,"id",{value:np++}),this.uuid=An(),this.name="",this.type="Material",this.blending=Qs,this.side=Da,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=lc,this.blendDst=_c,this.blendEquation=Gs,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=al,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Uu,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=br,this.stencilZFail=br,this.stencilZPass=br,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const i=t[e];if(i===void 0){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if(e==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===rc;continue}const n=this[e];if(n===void 0){console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.");continue}n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Qs&&(i.blending=this.blending),this.side!==Da&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData);function n(s){const o=[];for(const r in s){const _=s[r];delete _.metadata,o.push(_)}return o}if(e){const s=n(t.textures),o=n(t.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(e!==null){const n=e.length;i=new Array(n);for(let s=0;s!==n;++s)i[s]=e[s].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}}Gi.prototype.isMaterial=!0;Gi.fromType=function(){return null};class tr extends Gi{constructor(t){super(),this.type="MeshBasicMaterial",this.color=new fi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Jo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}tr.prototype.isMeshBasicMaterial=!0;const Ni=new wt,_o=new Ne;class Bi{constructor(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=i===!0,this.usage=Oa,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[t+n]=e.array[i+n];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){const e=this.array;let i=0;for(let n=0,s=t.length;n<s;n++){let o=t[n];o===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),o=new fi),e[i++]=o.r,e[i++]=o.g,e[i++]=o.b}return this}copyVector2sArray(t){const e=this.array;let i=0;for(let n=0,s=t.length;n<s;n++){let o=t[n];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),o=new Ne),e[i++]=o.x,e[i++]=o.y}return this}copyVector3sArray(t){const e=this.array;let i=0;for(let n=0,s=t.length;n<s;n++){let o=t[n];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),o=new wt),e[i++]=o.x,e[i++]=o.y,e[i++]=o.z}return this}copyVector4sArray(t){const e=this.array;let i=0;for(let n=0,s=t.length;n<s;n++){let o=t[n];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),o=new Li),e[i++]=o.x,e[i++]=o.y,e[i++]=o.z,e[i++]=o.w}return this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,i=this.count;e<i;e++)_o.fromBufferAttribute(this,e),_o.applyMatrix3(t),this.setXY(e,_o.x,_o.y);else if(this.itemSize===3)for(let e=0,i=this.count;e<i;e++)Ni.fromBufferAttribute(this,e),Ni.applyMatrix3(t),this.setXYZ(e,Ni.x,Ni.y,Ni.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)Ni.fromBufferAttribute(this,e),Ni.applyMatrix4(t),this.setXYZ(e,Ni.x,Ni.y,Ni.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)Ni.fromBufferAttribute(this,e),Ni.applyNormalMatrix(t),this.setXYZ(e,Ni.x,Ni.y,Ni.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)Ni.fromBufferAttribute(this,e),Ni.transformDirection(t),this.setXYZ(e,Ni.x,Ni.y,Ni.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this}setXYZW(t,e,i,n,s){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=s,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==Oa&&(t.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(t.updateRange=this.updateRange),t}}Bi.prototype.isBufferAttribute=!0;class fc extends Bi{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class dc extends Bi{constructor(t,e,i){super(new Uint32Array(t),e,i)}}class sp extends Bi{constructor(t,e,i){super(new Uint16Array(t),e,i)}}sp.prototype.isFloat16BufferAttribute=!0;class Ji extends Bi{constructor(t,e,i){super(new Float32Array(t),e,i)}}let ap=0;const un=new vi,Rr=new Ti,Cs=new wt,cn=new Xn,Ma=new Xn,Hi=new wt;class Ei extends ws{constructor(){super(),Object.defineProperty(this,"id",{value:ap++}),this.uuid=An(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(uc(t)?dc:fc)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const s=new qi().getNormalMatrix(t);i.applyNormalMatrix(s),i.needsUpdate=!0}const n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(t),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return un.makeRotationFromQuaternion(t),this.applyMatrix4(un),this}rotateX(t){return un.makeRotationX(t),this.applyMatrix4(un),this}rotateY(t){return un.makeRotationY(t),this.applyMatrix4(un),this}rotateZ(t){return un.makeRotationZ(t),this.applyMatrix4(un),this}translate(t,e,i){return un.makeTranslation(t,e,i),this.applyMatrix4(un),this}scale(t,e,i){return un.makeScale(t,e,i),this.applyMatrix4(un),this}lookAt(t){return Rr.lookAt(t),Rr.updateMatrix(),this.applyMatrix4(Rr.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Cs).negate(),this.translate(Cs.x,Cs.y,Cs.z),this}setFromPoints(t){const e=[];for(let i=0,n=t.length;i<n;i++){const s=t[i];e.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new Ji(e,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Xn);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new wt(-1/0,-1/0,-1/0),new wt(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let i=0,n=e.length;i<n;i++){const s=e[i];cn.setFromBufferAttribute(s),this.morphTargetsRelative?(Hi.addVectors(this.boundingBox.min,cn.min),this.boundingBox.expandByPoint(Hi),Hi.addVectors(this.boundingBox.max,cn.max),this.boundingBox.expandByPoint(Hi)):(this.boundingBox.expandByPoint(cn.min),this.boundingBox.expandByPoint(cn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new la);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new wt,1/0);return}if(t){const i=this.boundingSphere.center;if(cn.setFromBufferAttribute(t),e)for(let s=0,o=e.length;s<o;s++){const r=e[s];Ma.setFromBufferAttribute(r),this.morphTargetsRelative?(Hi.addVectors(cn.min,Ma.min),cn.expandByPoint(Hi),Hi.addVectors(cn.max,Ma.max),cn.expandByPoint(Hi)):(cn.expandByPoint(Ma.min),cn.expandByPoint(Ma.max))}cn.getCenter(i);let n=0;for(let s=0,o=t.count;s<o;s++)Hi.fromBufferAttribute(t,s),n=Math.max(n,i.distanceToSquared(Hi));if(e)for(let s=0,o=e.length;s<o;s++){const r=e[s],_=this.morphTargetsRelative;for(let a=0,l=r.count;a<l;a++)Hi.fromBufferAttribute(r,a),_&&(Cs.fromBufferAttribute(t,a),Hi.add(Cs)),n=Math.max(n,i.distanceToSquared(Hi))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.array,n=e.position.array,s=e.normal.array,o=e.uv.array,r=n.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Bi(new Float32Array(4*r),4));const _=this.getAttribute("tangent").array,a=[],l=[];for(let S=0;S<r;S++)a[S]=new wt,l[S]=new wt;const h=new wt,u=new wt,f=new wt,m=new Ne,d=new Ne,p=new Ne,g=new wt,x=new wt;function b(S,V,F){h.fromArray(n,S*3),u.fromArray(n,V*3),f.fromArray(n,F*3),m.fromArray(o,S*2),d.fromArray(o,V*2),p.fromArray(o,F*2),u.sub(h),f.sub(h),d.sub(m),p.sub(m);const C=1/(d.x*p.y-p.x*d.y);!isFinite(C)||(g.copy(u).multiplyScalar(p.y).addScaledVector(f,-d.y).multiplyScalar(C),x.copy(f).multiplyScalar(d.x).addScaledVector(u,-p.x).multiplyScalar(C),a[S].add(g),a[V].add(g),a[F].add(g),l[S].add(x),l[V].add(x),l[F].add(x))}let y=this.groups;y.length===0&&(y=[{start:0,count:i.length}]);for(let S=0,V=y.length;S<V;++S){const F=y[S],C=F.start,A=F.count;for(let Z=C,L=C+A;Z<L;Z+=3)b(i[Z+0],i[Z+1],i[Z+2])}const z=new wt,M=new wt,Y=new wt,X=new wt;function w(S){Y.fromArray(s,S*3),X.copy(Y);const V=a[S];z.copy(V),z.sub(Y.multiplyScalar(Y.dot(V))).normalize(),M.crossVectors(X,V);const C=M.dot(l[S])<0?-1:1;_[S*4]=z.x,_[S*4+1]=z.y,_[S*4+2]=z.z,_[S*4+3]=C}for(let S=0,V=y.length;S<V;++S){const F=y[S],C=F.start,A=F.count;for(let Z=C,L=C+A;Z<L;Z+=3)w(i[Z+0]),w(i[Z+1]),w(i[Z+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Bi(new Float32Array(e.count*3),3),this.setAttribute("normal",i);else for(let u=0,f=i.count;u<f;u++)i.setXYZ(u,0,0,0);const n=new wt,s=new wt,o=new wt,r=new wt,_=new wt,a=new wt,l=new wt,h=new wt;if(t)for(let u=0,f=t.count;u<f;u+=3){const m=t.getX(u+0),d=t.getX(u+1),p=t.getX(u+2);n.fromBufferAttribute(e,m),s.fromBufferAttribute(e,d),o.fromBufferAttribute(e,p),l.subVectors(o,s),h.subVectors(n,s),l.cross(h),r.fromBufferAttribute(i,m),_.fromBufferAttribute(i,d),a.fromBufferAttribute(i,p),r.add(l),_.add(l),a.add(l),i.setXYZ(m,r.x,r.y,r.z),i.setXYZ(d,_.x,_.y,_.z),i.setXYZ(p,a.x,a.y,a.z)}else for(let u=0,f=e.count;u<f;u+=3)n.fromBufferAttribute(e,u+0),s.fromBufferAttribute(e,u+1),o.fromBufferAttribute(e,u+2),l.subVectors(o,s),h.subVectors(n,s),l.cross(h),i.setXYZ(u+0,l.x,l.y,l.z),i.setXYZ(u+1,l.x,l.y,l.z),i.setXYZ(u+2,l.x,l.y,l.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(t,e){if(!(t&&t.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);return}e===void 0&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const n in i){if(t.attributes[n]===void 0)continue;const o=i[n].array,r=t.attributes[n],_=r.array,a=r.itemSize*e,l=Math.min(_.length,o.length-a);for(let h=0,u=a;h<l;h++,u++)o[u]=_[h]}return this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)Hi.fromBufferAttribute(t,e),Hi.normalize(),t.setXYZ(e,Hi.x,Hi.y,Hi.z)}toNonIndexed(){function t(r,_){const a=r.array,l=r.itemSize,h=r.normalized,u=new a.constructor(_.length*l);let f=0,m=0;for(let d=0,p=_.length;d<p;d++){r.isInterleavedBufferAttribute?f=_[d]*r.data.stride+r.offset:f=_[d]*l;for(let g=0;g<l;g++)u[m++]=a[f++]}return new Bi(u,l,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Ei,i=this.index.array,n=this.attributes;for(const r in n){const _=n[r],a=t(_,i);e.setAttribute(r,a)}const s=this.morphAttributes;for(const r in s){const _=[],a=s[r];for(let l=0,h=a.length;l<h;l++){const u=a[l],f=t(u,i);_.push(f)}e.morphAttributes[r]=_}e.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let r=0,_=o.length;r<_;r++){const a=o[r];e.addGroup(a.start,a.count,a.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const _=this.parameters;for(const a in _)_[a]!==void 0&&(t[a]=_[a]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const _ in i){const a=i[_];t.data.attributes[_]=a.toJSON(t.data)}const n={};let s=!1;for(const _ in this.morphAttributes){const a=this.morphAttributes[_],l=[];for(let h=0,u=a.length;h<u;h++){const f=a[h];l.push(f.toJSON(t.data))}l.length>0&&(n[_]=l,s=!0)}s&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(t.data.groups=JSON.parse(JSON.stringify(o)));const r=this.boundingSphere;return r!==null&&(t.data.boundingSphere={center:r.center.toArray(),radius:r.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;i!==null&&this.setIndex(i.clone(e));const n=t.attributes;for(const a in n){const l=n[a];this.setAttribute(a,l.clone(e))}const s=t.morphAttributes;for(const a in s){const l=[],h=s[a];for(let u=0,f=h.length;u<f;u++)l.push(h[u].clone(e));this.morphAttributes[a]=l}this.morphTargetsRelative=t.morphTargetsRelative;const o=t.groups;for(let a=0,l=o.length;a<l;a++){const h=o[a];this.addGroup(h.start,h.count,h.materialIndex)}const r=t.boundingBox;r!==null&&(this.boundingBox=r.clone());const _=t.boundingSphere;return _!==null&&(this.boundingSphere=_.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,t.parameters!==void 0&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}Ei.prototype.isBufferGeometry=!0;const $_=new vi,Ps=new _a,kr=new la,jn=new wt,qn=new wt,Jn=new wt,Br=new wt,Dr=new wt,Nr=new wt,ho=new wt,co=new wt,uo=new wt,po=new Ne,mo=new Ne,fo=new Ne,Fr=new wt,go=new wt;class sn extends Ti{constructor(t=new Ei,e=new tr){super(),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const n=e[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=n.length;s<o;s++){const r=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=s}}}}else{const e=t.morphTargets;e!==void 0&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(t,e){const i=this.geometry,n=this.material,s=this.matrixWorld;if(n===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),kr.copy(i.boundingSphere),kr.applyMatrix4(s),t.ray.intersectsSphere(kr)===!1)||($_.copy(s).invert(),Ps.copy(t.ray).applyMatrix4($_),i.boundingBox!==null&&Ps.intersectsBox(i.boundingBox)===!1))return;let o;if(i.isBufferGeometry){const r=i.index,_=i.attributes.position,a=i.morphAttributes.position,l=i.morphTargetsRelative,h=i.attributes.uv,u=i.attributes.uv2,f=i.groups,m=i.drawRange;if(r!==null)if(Array.isArray(n))for(let d=0,p=f.length;d<p;d++){const g=f[d],x=n[g.materialIndex],b=Math.max(g.start,m.start),y=Math.min(r.count,Math.min(g.start+g.count,m.start+m.count));for(let z=b,M=y;z<M;z+=3){const Y=r.getX(z),X=r.getX(z+1),w=r.getX(z+2);o=xo(this,x,t,Ps,_,a,l,h,u,Y,X,w),o&&(o.faceIndex=Math.floor(z/3),o.face.materialIndex=g.materialIndex,e.push(o))}}else{const d=Math.max(0,m.start),p=Math.min(r.count,m.start+m.count);for(let g=d,x=p;g<x;g+=3){const b=r.getX(g),y=r.getX(g+1),z=r.getX(g+2);o=xo(this,n,t,Ps,_,a,l,h,u,b,y,z),o&&(o.faceIndex=Math.floor(g/3),e.push(o))}}else if(_!==void 0)if(Array.isArray(n))for(let d=0,p=f.length;d<p;d++){const g=f[d],x=n[g.materialIndex],b=Math.max(g.start,m.start),y=Math.min(_.count,Math.min(g.start+g.count,m.start+m.count));for(let z=b,M=y;z<M;z+=3){const Y=z,X=z+1,w=z+2;o=xo(this,x,t,Ps,_,a,l,h,u,Y,X,w),o&&(o.faceIndex=Math.floor(z/3),o.face.materialIndex=g.materialIndex,e.push(o))}}else{const d=Math.max(0,m.start),p=Math.min(_.count,m.start+m.count);for(let g=d,x=p;g<x;g+=3){const b=g,y=g+1,z=g+2;o=xo(this,n,t,Ps,_,a,l,h,u,b,y,z),o&&(o.faceIndex=Math.floor(g/3),e.push(o))}}}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}sn.prototype.isMesh=!0;function op(c,t,e,i,n,s,o,r){let _;if(t.side===Mn?_=i.intersectTriangle(o,s,n,!0,r):_=i.intersectTriangle(n,s,o,t.side!==ea,r),_===null)return null;go.copy(r),go.applyMatrix4(c.matrixWorld);const a=e.ray.origin.distanceTo(go);return a<e.near||a>e.far?null:{distance:a,point:go.clone(),object:c}}function xo(c,t,e,i,n,s,o,r,_,a,l,h){jn.fromBufferAttribute(n,a),qn.fromBufferAttribute(n,l),Jn.fromBufferAttribute(n,h);const u=c.morphTargetInfluences;if(s&&u){ho.set(0,0,0),co.set(0,0,0),uo.set(0,0,0);for(let m=0,d=s.length;m<d;m++){const p=u[m],g=s[m];p!==0&&(Br.fromBufferAttribute(g,a),Dr.fromBufferAttribute(g,l),Nr.fromBufferAttribute(g,h),o?(ho.addScaledVector(Br,p),co.addScaledVector(Dr,p),uo.addScaledVector(Nr,p)):(ho.addScaledVector(Br.sub(jn),p),co.addScaledVector(Dr.sub(qn),p),uo.addScaledVector(Nr.sub(Jn),p)))}jn.add(ho),qn.add(co),Jn.add(uo)}c.isSkinnedMesh&&(c.boneTransform(a,jn),c.boneTransform(l,qn),c.boneTransform(h,Jn));const f=op(c,t,e,i,jn,qn,Jn,Fr);if(f){r&&(po.fromBufferAttribute(r,a),mo.fromBufferAttribute(r,l),fo.fromBufferAttribute(r,h),f.uv=Fi.getUV(Fr,jn,qn,Jn,po,mo,fo,new Ne)),_&&(po.fromBufferAttribute(_,a),mo.fromBufferAttribute(_,l),fo.fromBufferAttribute(_,h),f.uv2=Fi.getUV(Fr,jn,qn,Jn,po,mo,fo,new Ne));const m={a,b:l,c:h,normal:new wt,materialIndex:0};Fi.getNormal(jn,qn,Jn,m.normal),f.face=m}return f}class qa extends Ei{constructor(t=1,e=1,i=1,n=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:s,depthSegments:o};const r=this;n=Math.floor(n),s=Math.floor(s),o=Math.floor(o);const _=[],a=[],l=[],h=[];let u=0,f=0;m("z","y","x",-1,-1,i,e,t,o,s,0),m("z","y","x",1,-1,i,e,-t,o,s,1),m("x","z","y",1,1,t,i,e,n,o,2),m("x","z","y",1,-1,t,i,-e,n,o,3),m("x","y","z",1,-1,t,e,i,n,s,4),m("x","y","z",-1,-1,t,e,-i,n,s,5),this.setIndex(_),this.setAttribute("position",new Ji(a,3)),this.setAttribute("normal",new Ji(l,3)),this.setAttribute("uv",new Ji(h,2));function m(d,p,g,x,b,y,z,M,Y,X,w){const S=y/Y,V=z/X,F=y/2,C=z/2,A=M/2,Z=Y+1,L=X+1;let E=0,T=0;const P=new wt;for(let N=0;N<L;N++){const R=N*V-C;for(let k=0;k<Z;k++){const O=k*S-F;P[d]=O*x,P[p]=R*b,P[g]=A,a.push(P.x,P.y,P.z),P[d]=0,P[p]=0,P[g]=M>0?1:-1,l.push(P.x,P.y,P.z),h.push(k/Y),h.push(1-N/X),E+=1}}for(let N=0;N<X;N++)for(let R=0;R<Y;R++){const k=u+R+Z*N,O=u+R+Z*(N+1),v=u+(R+1)+Z*(N+1),D=u+(R+1)+Z*N;_.push(k,O,D),_.push(O,v,D),T+=6}r.addGroup(f,T,w),f+=T,u+=E}}static fromJSON(t){return new qa(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function aa(c){const t={};for(const e in c){t[e]={};for(const i in c[e]){const n=c[e][i];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?t[e][i]=n.clone():Array.isArray(n)?t[e][i]=n.slice():t[e][i]=n}}return t}function Qi(c){const t={};for(let e=0;e<c.length;e++){const i=aa(c[e]);for(const n in i)t[n]=i[n]}return t}const rp={clone:aa,merge:Qi};var lp=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,_p=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class wn extends Gi{constructor(t){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=lp,this.fragmentShader=_p,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&(t.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=aa(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const o=this.uniforms[n].value;o&&o.isTexture?e.uniforms[n]={type:"t",value:o.toJSON(t).uuid}:o&&o.isColor?e.uniforms[n]={type:"c",value:o.getHex()}:o&&o.isVector2?e.uniforms[n]={type:"v2",value:o.toArray()}:o&&o.isVector3?e.uniforms[n]={type:"v3",value:o.toArray()}:o&&o.isVector4?e.uniforms[n]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?e.uniforms[n]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?e.uniforms[n]={type:"m4",value:o.toArray()}:e.uniforms[n]={value:o}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const i={};for(const n in this.extensions)this.extensions[n]===!0&&(i[n]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}wn.prototype.isShaderMaterial=!0;class Yl extends Ti{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new vi,this.projectionMatrix=new vi,this.projectionMatrixInverse=new vi}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}Yl.prototype.isCamera=!0;class nn extends Yl{constructor(t=50,e=1,i=.1,n=2e3){super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=cl*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(yr*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return cl*2*Math.atan(Math.tan(yr*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,n,s,o){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(yr*.5*this.fov)/this.zoom,i=2*e,n=this.aspect*i,s=-.5*n;const o=this.view;if(this.view!==null&&this.view.enabled){const _=o.fullWidth,a=o.fullHeight;s+=o.offsetX*n/_,e-=o.offsetY*i/a,n*=o.width/_,i*=o.height/a}const r=this.filmOffset;r!==0&&(s+=t*r/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}nn.prototype.isPerspectiveCamera=!0;const Rs=90,ks=1;class Zl extends Ti{constructor(t,e,i){if(super(),this.type="CubeCamera",i.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=i;const n=new nn(Rs,ks,t,e);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new wt(1,0,0)),this.add(n);const s=new nn(Rs,ks,t,e);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new wt(-1,0,0)),this.add(s);const o=new nn(Rs,ks,t,e);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new wt(0,1,0)),this.add(o);const r=new nn(Rs,ks,t,e);r.layers=this.layers,r.up.set(0,0,-1),r.lookAt(new wt(0,-1,0)),this.add(r);const _=new nn(Rs,ks,t,e);_.layers=this.layers,_.up.set(0,-1,0),_.lookAt(new wt(0,0,1)),this.add(_);const a=new nn(Rs,ks,t,e);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new wt(0,0,-1)),this.add(a)}update(t,e){this.parent===null&&this.updateMatrixWorld();const i=this.renderTarget,[n,s,o,r,_,a]=this.children,l=t.getRenderTarget(),h=t.toneMapping,u=t.xr.enabled;t.toneMapping=Fn,t.xr.enabled=!1;const f=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,n),t.setRenderTarget(i,1),t.render(e,s),t.setRenderTarget(i,2),t.render(e,o),t.setRenderTarget(i,3),t.render(e,r),t.setRenderTarget(i,4),t.render(e,_),i.texture.generateMipmaps=f,t.setRenderTarget(i,5),t.render(e,a),t.setRenderTarget(l),t.toneMapping=h,t.xr.enabled=u,i.texture.needsPMREMUpdate=!0}}class er extends $i{constructor(t,e,i,n,s,o,r,_,a,l){t=t!==void 0?t:[],e=e!==void 0?e:ia,super(t,e,i,n,s,o,r,_,a,l),this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}er.prototype.isCubeTexture=!0;class gc extends ln{constructor(t,e={}){super(t,t,e);const i={width:t,height:t,depth:1},n=[i,i,i,i,i,i];this.texture=new er(n,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=e.generateMipmaps!==void 0?e.generateMipmaps:!1,this.texture.minFilter=e.minFilter!==void 0?e.minFilter:rn}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new qa(5,5,5),s=new wn({name:"CubemapFromEquirect",uniforms:aa(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Mn,blending:Ln});s.uniforms.tEquirect.value=e;const o=new sn(n,s),r=e.minFilter;return e.minFilter===Ko&&(e.minFilter=rn),new Zl(1,10,this).update(t,o),e.minFilter=r,o.geometry.dispose(),o.material.dispose(),this}clear(t,e,i,n){const s=t.getRenderTarget();for(let o=0;o<6;o++)t.setRenderTarget(this,o),t.clear(e,i,n);t.setRenderTarget(s)}}gc.prototype.isWebGLCubeRenderTarget=!0;const Or=new wt,hp=new wt,cp=new qi;class Sn{constructor(t=new wt(1,0,0),e=0){this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const n=Or.subVectors(i,e).cross(hp.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const i=t.delta(Or),n=this.normal.dot(i);if(n===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;const s=-(t.start.dot(this.normal)+this.constant)/n;return s<0||s>1?null:e.copy(i).multiplyScalar(s).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||cp.getNormalMatrix(t),n=this.coplanarPoint(Or).applyMatrix4(t),s=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(s),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}Sn.prototype.isPlane=!0;const Bs=new la,vo=new wt;class ir{constructor(t=new Sn,e=new Sn,i=new Sn,n=new Sn,s=new Sn,o=new Sn){this.planes=[t,e,i,n,s,o]}set(t,e,i,n,s,o){const r=this.planes;return r[0].copy(t),r[1].copy(e),r[2].copy(i),r[3].copy(n),r[4].copy(s),r[5].copy(o),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){const e=this.planes,i=t.elements,n=i[0],s=i[1],o=i[2],r=i[3],_=i[4],a=i[5],l=i[6],h=i[7],u=i[8],f=i[9],m=i[10],d=i[11],p=i[12],g=i[13],x=i[14],b=i[15];return e[0].setComponents(r-n,h-_,d-u,b-p).normalize(),e[1].setComponents(r+n,h+_,d+u,b+p).normalize(),e[2].setComponents(r+s,h+a,d+f,b+g).normalize(),e[3].setComponents(r-s,h-a,d-f,b-g).normalize(),e[4].setComponents(r-o,h-l,d-m,b-x).normalize(),e[5].setComponents(r+o,h+l,d+m,b+x).normalize(),this}intersectsObject(t){const e=t.geometry;return e.boundingSphere===null&&e.computeBoundingSphere(),Bs.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Bs)}intersectsSprite(t){return Bs.center.set(0,0,0),Bs.radius=.7071067811865476,Bs.applyMatrix4(t.matrixWorld),this.intersectsSphere(Bs)}intersectsSphere(t){const e=this.planes,i=t.center,n=-t.radius;for(let s=0;s<6;s++)if(e[s].distanceToPoint(i)<n)return!1;return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const n=e[i];if(vo.x=n.normal.x>0?t.max.x:t.min.x,vo.y=n.normal.y>0?t.max.y:t.min.y,vo.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(vo)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function xc(){let c=null,t=!1,e=null,i=null;function n(s,o){e(s,o),i=c.requestAnimationFrame(n)}return{start:function(){t!==!0&&e!==null&&(i=c.requestAnimationFrame(n),t=!0)},stop:function(){c.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(s){e=s},setContext:function(s){c=s}}}function up(c,t){const e=t.isWebGL2,i=new WeakMap;function n(a,l){const h=a.array,u=a.usage,f=c.createBuffer();c.bindBuffer(l,f),c.bufferData(l,h,u),a.onUploadCallback();let m;if(h instanceof Float32Array)m=5126;else if(h instanceof Uint16Array)if(a.isFloat16BufferAttribute)if(e)m=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else m=5123;else if(h instanceof Int16Array)m=5122;else if(h instanceof Uint32Array)m=5125;else if(h instanceof Int32Array)m=5124;else if(h instanceof Int8Array)m=5120;else if(h instanceof Uint8Array)m=5121;else if(h instanceof Uint8ClampedArray)m=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:f,type:m,bytesPerElement:h.BYTES_PER_ELEMENT,version:a.version}}function s(a,l,h){const u=l.array,f=l.updateRange;c.bindBuffer(h,a),f.count===-1?c.bufferSubData(h,0,u):(e?c.bufferSubData(h,f.offset*u.BYTES_PER_ELEMENT,u,f.offset,f.count):c.bufferSubData(h,f.offset*u.BYTES_PER_ELEMENT,u.subarray(f.offset,f.offset+f.count)),f.count=-1)}function o(a){return a.isInterleavedBufferAttribute&&(a=a.data),i.get(a)}function r(a){a.isInterleavedBufferAttribute&&(a=a.data);const l=i.get(a);l&&(c.deleteBuffer(l.buffer),i.delete(a))}function _(a,l){if(a.isGLBufferAttribute){const u=i.get(a);(!u||u.version<a.version)&&i.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}a.isInterleavedBufferAttribute&&(a=a.data);const h=i.get(a);h===void 0?i.set(a,n(a,l)):h.version<a.version&&(s(h.buffer,a,l),h.version=a.version)}return{get:o,remove:r,update:_}}class Ll extends Ei{constructor(t=1,e=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};const s=t/2,o=e/2,r=Math.floor(i),_=Math.floor(n),a=r+1,l=_+1,h=t/r,u=e/_,f=[],m=[],d=[],p=[];for(let g=0;g<l;g++){const x=g*u-o;for(let b=0;b<a;b++){const y=b*h-s;m.push(y,-x,0),d.push(0,0,1),p.push(b/r),p.push(1-g/_)}}for(let g=0;g<_;g++)for(let x=0;x<r;x++){const b=x+a*g,y=x+a*(g+1),z=x+1+a*(g+1),M=x+1+a*g;f.push(b,y,M),f.push(y,z,M)}this.setIndex(f),this.setAttribute("position",new Ji(m,3)),this.setAttribute("normal",new Ji(d,3)),this.setAttribute("uv",new Ji(p,2))}static fromJSON(t){return new Ll(t.width,t.height,t.widthSegments,t.heightSegments)}}var pp=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,mp=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,fp=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,dp=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,gp=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,xp=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,vp="vec3 transformed = vec3( position );",bp=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,yp=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,Mp=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,wp=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,Xp=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Ip=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,zp=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Sp=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Yp=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Zp=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,Lp=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Ap=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,Tp=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Vp=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Ep=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Cp=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,Pp=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Rp=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,kp="gl_FragColor = linearToOutputTexel( gl_FragColor );",Bp=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Dp=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Np=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Fp=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Op=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Up=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Gp=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Hp=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Wp=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,jp=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,qp=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,Jp=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,$p=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Kp=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointLightInfo( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotLightInfo( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
		#endif
	}
	#pragma unroll_loop_end
#endif`,Qp=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,tm=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,em=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,im=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,nm=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,sm=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,am=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,om=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,rm=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lm=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,_m=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,hm=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,cm=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,um=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,pm=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,mm=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,fm=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,dm=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,gm=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,xm=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,vm=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,bm=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,ym=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,Mm=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,wm=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,Xm=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,Im=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,zm=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Sm=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Ym=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Zm=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,Lm=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,Am=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,Tm=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,Vm=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Em=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,Cm=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Pm=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Rm=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,km=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Bm=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Dm=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Nm=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,Fm=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Om=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,Um=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Gm=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Hm=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,Wm=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,jm=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,qm=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Jm=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,$m=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Km=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Qm=`#ifdef USE_TRANSMISSION
	float transmissionAlpha = 1.0;
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationColor, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );
	transmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );
#endif`,tf=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,ef=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,nf=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,sf=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,af=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,of=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,rf=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,lf=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const _f=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,hf=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cf=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,uf=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,pf=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,mf=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,ff=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,df=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,gf=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,xf=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,vf=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,bf=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,yf=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,Mf=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,wf=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Xf=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,If=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,zf=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Sf=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Yf=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Zf=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Lf=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Af=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Tf=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Vf=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Ef=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Cf=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Pf=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Rf=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,kf=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Bf=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Df=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Ii={alphamap_fragment:pp,alphamap_pars_fragment:mp,alphatest_fragment:fp,alphatest_pars_fragment:dp,aomap_fragment:gp,aomap_pars_fragment:xp,begin_vertex:vp,beginnormal_vertex:bp,bsdfs:yp,bumpmap_pars_fragment:Mp,clipping_planes_fragment:wp,clipping_planes_pars_fragment:Xp,clipping_planes_pars_vertex:Ip,clipping_planes_vertex:zp,color_fragment:Sp,color_pars_fragment:Yp,color_pars_vertex:Zp,color_vertex:Lp,common:Ap,cube_uv_reflection_fragment:Tp,defaultnormal_vertex:Vp,displacementmap_pars_vertex:Ep,displacementmap_vertex:Cp,emissivemap_fragment:Pp,emissivemap_pars_fragment:Rp,encodings_fragment:kp,encodings_pars_fragment:Bp,envmap_fragment:Dp,envmap_common_pars_fragment:Np,envmap_pars_fragment:Fp,envmap_pars_vertex:Op,envmap_physical_pars_fragment:tm,envmap_vertex:Up,fog_vertex:Gp,fog_pars_vertex:Hp,fog_fragment:Wp,fog_pars_fragment:jp,gradientmap_pars_fragment:qp,lightmap_fragment:Jp,lightmap_pars_fragment:$p,lights_lambert_vertex:Kp,lights_pars_begin:Qp,lights_toon_fragment:em,lights_toon_pars_fragment:im,lights_phong_fragment:nm,lights_phong_pars_fragment:sm,lights_physical_fragment:am,lights_physical_pars_fragment:om,lights_fragment_begin:rm,lights_fragment_maps:lm,lights_fragment_end:_m,logdepthbuf_fragment:hm,logdepthbuf_pars_fragment:cm,logdepthbuf_pars_vertex:um,logdepthbuf_vertex:pm,map_fragment:mm,map_pars_fragment:fm,map_particle_fragment:dm,map_particle_pars_fragment:gm,metalnessmap_fragment:xm,metalnessmap_pars_fragment:vm,morphcolor_vertex:bm,morphnormal_vertex:ym,morphtarget_pars_vertex:Mm,morphtarget_vertex:wm,normal_fragment_begin:Xm,normal_fragment_maps:Im,normal_pars_fragment:zm,normal_pars_vertex:Sm,normal_vertex:Ym,normalmap_pars_fragment:Zm,clearcoat_normal_fragment_begin:Lm,clearcoat_normal_fragment_maps:Am,clearcoat_pars_fragment:Tm,output_fragment:Vm,packing:Em,premultiplied_alpha_fragment:Cm,project_vertex:Pm,dithering_fragment:Rm,dithering_pars_fragment:km,roughnessmap_fragment:Bm,roughnessmap_pars_fragment:Dm,shadowmap_pars_fragment:Nm,shadowmap_pars_vertex:Fm,shadowmap_vertex:Om,shadowmask_pars_fragment:Um,skinbase_vertex:Gm,skinning_pars_vertex:Hm,skinning_vertex:Wm,skinnormal_vertex:jm,specularmap_fragment:qm,specularmap_pars_fragment:Jm,tonemapping_fragment:$m,tonemapping_pars_fragment:Km,transmission_fragment:Qm,transmission_pars_fragment:tf,uv_pars_fragment:ef,uv_pars_vertex:nf,uv_vertex:sf,uv2_pars_fragment:af,uv2_pars_vertex:of,uv2_vertex:rf,worldpos_vertex:lf,background_vert:_f,background_frag:hf,cube_vert:cf,cube_frag:uf,depth_vert:pf,depth_frag:mf,distanceRGBA_vert:ff,distanceRGBA_frag:df,equirect_vert:gf,equirect_frag:xf,linedashed_vert:vf,linedashed_frag:bf,meshbasic_vert:yf,meshbasic_frag:Mf,meshlambert_vert:wf,meshlambert_frag:Xf,meshmatcap_vert:If,meshmatcap_frag:zf,meshnormal_vert:Sf,meshnormal_frag:Yf,meshphong_vert:Zf,meshphong_frag:Lf,meshphysical_vert:Af,meshphysical_frag:Tf,meshtoon_vert:Vf,meshtoon_frag:Ef,points_vert:Cf,points_frag:Pf,shadow_vert:Rf,shadow_frag:kf,sprite_vert:Bf,sprite_frag:Df},ni={common:{diffuse:{value:new fi(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new qi},uv2Transform:{value:new qi},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Ne(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new fi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new fi(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new qi}},sprite:{diffuse:{value:new fi(16777215)},opacity:{value:1},center:{value:new Ne(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new qi}}},Yn={basic:{uniforms:Qi([ni.common,ni.specularmap,ni.envmap,ni.aomap,ni.lightmap,ni.fog]),vertexShader:Ii.meshbasic_vert,fragmentShader:Ii.meshbasic_frag},lambert:{uniforms:Qi([ni.common,ni.specularmap,ni.envmap,ni.aomap,ni.lightmap,ni.emissivemap,ni.fog,ni.lights,{emissive:{value:new fi(0)}}]),vertexShader:Ii.meshlambert_vert,fragmentShader:Ii.meshlambert_frag},phong:{uniforms:Qi([ni.common,ni.specularmap,ni.envmap,ni.aomap,ni.lightmap,ni.emissivemap,ni.bumpmap,ni.normalmap,ni.displacementmap,ni.fog,ni.lights,{emissive:{value:new fi(0)},specular:{value:new fi(1118481)},shininess:{value:30}}]),vertexShader:Ii.meshphong_vert,fragmentShader:Ii.meshphong_frag},standard:{uniforms:Qi([ni.common,ni.envmap,ni.aomap,ni.lightmap,ni.emissivemap,ni.bumpmap,ni.normalmap,ni.displacementmap,ni.roughnessmap,ni.metalnessmap,ni.fog,ni.lights,{emissive:{value:new fi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ii.meshphysical_vert,fragmentShader:Ii.meshphysical_frag},toon:{uniforms:Qi([ni.common,ni.aomap,ni.lightmap,ni.emissivemap,ni.bumpmap,ni.normalmap,ni.displacementmap,ni.gradientmap,ni.fog,ni.lights,{emissive:{value:new fi(0)}}]),vertexShader:Ii.meshtoon_vert,fragmentShader:Ii.meshtoon_frag},matcap:{uniforms:Qi([ni.common,ni.bumpmap,ni.normalmap,ni.displacementmap,ni.fog,{matcap:{value:null}}]),vertexShader:Ii.meshmatcap_vert,fragmentShader:Ii.meshmatcap_frag},points:{uniforms:Qi([ni.points,ni.fog]),vertexShader:Ii.points_vert,fragmentShader:Ii.points_frag},dashed:{uniforms:Qi([ni.common,ni.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ii.linedashed_vert,fragmentShader:Ii.linedashed_frag},depth:{uniforms:Qi([ni.common,ni.displacementmap]),vertexShader:Ii.depth_vert,fragmentShader:Ii.depth_frag},normal:{uniforms:Qi([ni.common,ni.bumpmap,ni.normalmap,ni.displacementmap,{opacity:{value:1}}]),vertexShader:Ii.meshnormal_vert,fragmentShader:Ii.meshnormal_frag},sprite:{uniforms:Qi([ni.sprite,ni.fog]),vertexShader:Ii.sprite_vert,fragmentShader:Ii.sprite_frag},background:{uniforms:{uvTransform:{value:new qi},t2D:{value:null}},vertexShader:Ii.background_vert,fragmentShader:Ii.background_frag},cube:{uniforms:Qi([ni.envmap,{opacity:{value:1}}]),vertexShader:Ii.cube_vert,fragmentShader:Ii.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ii.equirect_vert,fragmentShader:Ii.equirect_frag},distanceRGBA:{uniforms:Qi([ni.common,ni.displacementmap,{referencePosition:{value:new wt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ii.distanceRGBA_vert,fragmentShader:Ii.distanceRGBA_frag},shadow:{uniforms:Qi([ni.lights,ni.fog,{color:{value:new fi(0)},opacity:{value:1}}]),vertexShader:Ii.shadow_vert,fragmentShader:Ii.shadow_frag}};Yn.physical={uniforms:Qi([Yn.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Ne(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new fi(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Ne},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new fi(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new fi(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Ii.meshphysical_vert,fragmentShader:Ii.meshphysical_frag};function Nf(c,t,e,i,n,s){const o=new fi(0);let r=n===!0?0:1,_,a,l=null,h=0,u=null;function f(d,p){let g=!1,x=p.isScene===!0?p.background:null;x&&x.isTexture&&(x=t.get(x));const b=c.xr,y=b.getSession&&b.getSession();y&&y.environmentBlendMode==="additive"&&(x=null),x===null?m(o,r):x&&x.isColor&&(m(x,1),g=!0),(c.autoClear||g)&&c.clear(c.autoClearColor,c.autoClearDepth,c.autoClearStencil),x&&(x.isCubeTexture||x.mapping===$o)?(a===void 0&&(a=new sn(new qa(1,1,1),new wn({name:"BackgroundCubeMaterial",uniforms:aa(Yn.cube.uniforms),vertexShader:Yn.cube.vertexShader,fragmentShader:Yn.cube.fragmentShader,side:Mn,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(z,M,Y){this.matrixWorld.copyPosition(Y.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(a)),a.material.uniforms.envMap.value=x,a.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,(l!==x||h!==x.version||u!==c.toneMapping)&&(a.material.needsUpdate=!0,l=x,h=x.version,u=c.toneMapping),a.layers.enableAll(),d.unshift(a,a.geometry,a.material,0,0,null)):x&&x.isTexture&&(_===void 0&&(_=new sn(new Ll(2,2),new wn({name:"BackgroundMaterial",uniforms:aa(Yn.background.uniforms),vertexShader:Yn.background.vertexShader,fragmentShader:Yn.background.fragmentShader,side:Da,depthTest:!1,depthWrite:!1,fog:!1})),_.geometry.deleteAttribute("normal"),Object.defineProperty(_.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(_)),_.material.uniforms.t2D.value=x,x.matrixAutoUpdate===!0&&x.updateMatrix(),_.material.uniforms.uvTransform.value.copy(x.matrix),(l!==x||h!==x.version||u!==c.toneMapping)&&(_.material.needsUpdate=!0,l=x,h=x.version,u=c.toneMapping),_.layers.enableAll(),d.unshift(_,_.geometry,_.material,0,0,null))}function m(d,p){e.buffers.color.setClear(d.r,d.g,d.b,p,s)}return{getClearColor:function(){return o},setClearColor:function(d,p=1){o.set(d),r=p,m(o,r)},getClearAlpha:function(){return r},setClearAlpha:function(d){r=d,m(o,r)},render:f}}function Ff(c,t,e,i){const n=c.getParameter(34921),s=i.isWebGL2?null:t.get("OES_vertex_array_object"),o=i.isWebGL2||s!==null,r={},_=p(null);let a=_,l=!1;function h(A,Z,L,E,T){let P=!1;if(o){const N=d(E,L,Z);a!==N&&(a=N,f(a.object)),P=g(A,E,L,T),P&&x(A,E,L,T)}else{const N=Z.wireframe===!0;(a.geometry!==E.id||a.program!==L.id||a.wireframe!==N)&&(a.geometry=E.id,a.program=L.id,a.wireframe=N,P=!0)}T!==null&&e.update(T,34963),(P||l)&&(l=!1,X(A,Z,L,E),T!==null&&c.bindBuffer(34963,e.get(T).buffer))}function u(){return i.isWebGL2?c.createVertexArray():s.createVertexArrayOES()}function f(A){return i.isWebGL2?c.bindVertexArray(A):s.bindVertexArrayOES(A)}function m(A){return i.isWebGL2?c.deleteVertexArray(A):s.deleteVertexArrayOES(A)}function d(A,Z,L){const E=L.wireframe===!0;let T=r[A.id];T===void 0&&(T={},r[A.id]=T);let P=T[Z.id];P===void 0&&(P={},T[Z.id]=P);let N=P[E];return N===void 0&&(N=p(u()),P[E]=N),N}function p(A){const Z=[],L=[],E=[];for(let T=0;T<n;T++)Z[T]=0,L[T]=0,E[T]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Z,enabledAttributes:L,attributeDivisors:E,object:A,attributes:{},index:null}}function g(A,Z,L,E){const T=a.attributes,P=Z.attributes;let N=0;const R=L.getAttributes();for(const k in R)if(R[k].location>=0){const v=T[k];let D=P[k];if(D===void 0&&(k==="instanceMatrix"&&A.instanceMatrix&&(D=A.instanceMatrix),k==="instanceColor"&&A.instanceColor&&(D=A.instanceColor)),v===void 0||v.attribute!==D||D&&v.data!==D.data)return!0;N++}return a.attributesNum!==N||a.index!==E}function x(A,Z,L,E){const T={},P=Z.attributes;let N=0;const R=L.getAttributes();for(const k in R)if(R[k].location>=0){let v=P[k];v===void 0&&(k==="instanceMatrix"&&A.instanceMatrix&&(v=A.instanceMatrix),k==="instanceColor"&&A.instanceColor&&(v=A.instanceColor));const D={};D.attribute=v,v&&v.data&&(D.data=v.data),T[k]=D,N++}a.attributes=T,a.attributesNum=N,a.index=E}function b(){const A=a.newAttributes;for(let Z=0,L=A.length;Z<L;Z++)A[Z]=0}function y(A){z(A,0)}function z(A,Z){const L=a.newAttributes,E=a.enabledAttributes,T=a.attributeDivisors;L[A]=1,E[A]===0&&(c.enableVertexAttribArray(A),E[A]=1),T[A]!==Z&&((i.isWebGL2?c:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](A,Z),T[A]=Z)}function M(){const A=a.newAttributes,Z=a.enabledAttributes;for(let L=0,E=Z.length;L<E;L++)Z[L]!==A[L]&&(c.disableVertexAttribArray(L),Z[L]=0)}function Y(A,Z,L,E,T,P){i.isWebGL2===!0&&(L===5124||L===5125)?c.vertexAttribIPointer(A,Z,L,T,P):c.vertexAttribPointer(A,Z,L,E,T,P)}function X(A,Z,L,E){if(i.isWebGL2===!1&&(A.isInstancedMesh||E.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;b();const T=E.attributes,P=L.getAttributes(),N=Z.defaultAttributeValues;for(const R in P){const k=P[R];if(k.location>=0){let O=T[R];if(O===void 0&&(R==="instanceMatrix"&&A.instanceMatrix&&(O=A.instanceMatrix),R==="instanceColor"&&A.instanceColor&&(O=A.instanceColor)),O!==void 0){const v=O.normalized,D=O.itemSize,B=e.get(O);if(B===void 0)continue;const U=B.buffer,q=B.type,tt=B.bytesPerElement;if(O.isInterleavedBufferAttribute){const Q=O.data,nt=Q.stride,H=O.offset;if(Q.isInstancedInterleavedBuffer){for(let j=0;j<k.locationSize;j++)z(k.location+j,Q.meshPerAttribute);A.isInstancedMesh!==!0&&E._maxInstanceCount===void 0&&(E._maxInstanceCount=Q.meshPerAttribute*Q.count)}else for(let j=0;j<k.locationSize;j++)y(k.location+j);c.bindBuffer(34962,U);for(let j=0;j<k.locationSize;j++)Y(k.location+j,D/k.locationSize,q,v,nt*tt,(H+D/k.locationSize*j)*tt)}else{if(O.isInstancedBufferAttribute){for(let Q=0;Q<k.locationSize;Q++)z(k.location+Q,O.meshPerAttribute);A.isInstancedMesh!==!0&&E._maxInstanceCount===void 0&&(E._maxInstanceCount=O.meshPerAttribute*O.count)}else for(let Q=0;Q<k.locationSize;Q++)y(k.location+Q);c.bindBuffer(34962,U);for(let Q=0;Q<k.locationSize;Q++)Y(k.location+Q,D/k.locationSize,q,v,D*tt,D/k.locationSize*Q*tt)}}else if(N!==void 0){const v=N[R];if(v!==void 0)switch(v.length){case 2:c.vertexAttrib2fv(k.location,v);break;case 3:c.vertexAttrib3fv(k.location,v);break;case 4:c.vertexAttrib4fv(k.location,v);break;default:c.vertexAttrib1fv(k.location,v)}}}}M()}function w(){F();for(const A in r){const Z=r[A];for(const L in Z){const E=Z[L];for(const T in E)m(E[T].object),delete E[T];delete Z[L]}delete r[A]}}function S(A){if(r[A.id]===void 0)return;const Z=r[A.id];for(const L in Z){const E=Z[L];for(const T in E)m(E[T].object),delete E[T];delete Z[L]}delete r[A.id]}function V(A){for(const Z in r){const L=r[Z];if(L[A.id]===void 0)continue;const E=L[A.id];for(const T in E)m(E[T].object),delete E[T];delete L[A.id]}}function F(){C(),l=!0,a!==_&&(a=_,f(a.object))}function C(){_.geometry=null,_.program=null,_.wireframe=!1}return{setup:h,reset:F,resetDefaultState:C,dispose:w,releaseStatesOfGeometry:S,releaseStatesOfProgram:V,initAttributes:b,enableAttribute:y,disableUnusedAttributes:M}}function Of(c,t,e,i){const n=i.isWebGL2;let s;function o(a){s=a}function r(a,l){c.drawArrays(s,a,l),e.update(l,s,1)}function _(a,l,h){if(h===0)return;let u,f;if(n)u=c,f="drawArraysInstanced";else if(u=t.get("ANGLE_instanced_arrays"),f="drawArraysInstancedANGLE",u===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}u[f](s,a,l,h),e.update(l,s,h)}this.setMode=o,this.render=r,this.renderInstances=_}function Uf(c,t,e){let i;function n(){if(i!==void 0)return i;if(t.has("EXT_texture_filter_anisotropic")===!0){const Y=t.get("EXT_texture_filter_anisotropic");i=c.getParameter(Y.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function s(Y){if(Y==="highp"){if(c.getShaderPrecisionFormat(35633,36338).precision>0&&c.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";Y="mediump"}return Y==="mediump"&&c.getShaderPrecisionFormat(35633,36337).precision>0&&c.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext!="undefined"&&c instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&c instanceof WebGL2ComputeRenderingContext;let r=e.precision!==void 0?e.precision:"highp";const _=s(r);_!==r&&(console.warn("THREE.WebGLRenderer:",r,"not supported, using",_,"instead."),r=_);const a=o||t.has("WEBGL_draw_buffers"),l=e.logarithmicDepthBuffer===!0,h=c.getParameter(34930),u=c.getParameter(35660),f=c.getParameter(3379),m=c.getParameter(34076),d=c.getParameter(34921),p=c.getParameter(36347),g=c.getParameter(36348),x=c.getParameter(36349),b=u>0,y=o||t.has("OES_texture_float"),z=b&&y,M=o?c.getParameter(36183):0;return{isWebGL2:o,drawBuffers:a,getMaxAnisotropy:n,getMaxPrecision:s,precision:r,logarithmicDepthBuffer:l,maxTextures:h,maxVertexTextures:u,maxTextureSize:f,maxCubemapSize:m,maxAttributes:d,maxVertexUniforms:p,maxVaryings:g,maxFragmentUniforms:x,vertexTextures:b,floatFragmentTextures:y,floatVertexTextures:z,maxSamples:M}}function Gf(c){const t=this;let e=null,i=0,n=!1,s=!1;const o=new Sn,r=new qi,_={value:null,needsUpdate:!1};this.uniform=_,this.numPlanes=0,this.numIntersection=0,this.init=function(h,u,f){const m=h.length!==0||u||i!==0||n;return n=u,e=l(h,f,0),i=h.length,m},this.beginShadows=function(){s=!0,l(null)},this.endShadows=function(){s=!1,a()},this.setState=function(h,u,f){const m=h.clippingPlanes,d=h.clipIntersection,p=h.clipShadows,g=c.get(h);if(!n||m===null||m.length===0||s&&!p)s?l(null):a();else{const x=s?0:i,b=x*4;let y=g.clippingState||null;_.value=y,y=l(m,u,b,f);for(let z=0;z!==b;++z)y[z]=e[z];g.clippingState=y,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=x}};function a(){_.value!==e&&(_.value=e,_.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function l(h,u,f,m){const d=h!==null?h.length:0;let p=null;if(d!==0){if(p=_.value,m!==!0||p===null){const g=f+d*4,x=u.matrixWorldInverse;r.getNormalMatrix(x),(p===null||p.length<g)&&(p=new Float32Array(g));for(let b=0,y=f;b!==d;++b,y+=4)o.copy(h[b]).applyMatrix4(x,r),o.normal.toArray(p,y),p[y+3]=o.constant}_.value=p,_.needsUpdate=!0}return t.numPlanes=d,t.numIntersection=0,p}}function Hf(c){let t=new WeakMap;function e(o,r){return r===ol?o.mapping=ia:r===rl&&(o.mapping=na),o}function i(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){const r=o.mapping;if(r===ol||r===rl)if(t.has(o)){const _=t.get(o).texture;return e(_,o.mapping)}else{const _=o.image;if(_&&_.height>0){const a=new gc(_.height/2);return a.fromEquirectangularTexture(c,o),t.set(o,a),o.addEventListener("dispose",n),e(a.texture,o.mapping)}else return null}}return o}function n(o){const r=o.target;r.removeEventListener("dispose",n);const _=t.get(r);_!==void 0&&(t.delete(r),_.dispose())}function s(){t=new WeakMap}return{get:i,dispose:s}}class nr extends Yl{constructor(t=-1,e=1,i=1,n=-1,s=.1,o=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=n,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,i,n,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=i-t,o=i+t,r=n+e,_=n-e;if(this.view!==null&&this.view.enabled){const a=(this.right-this.left)/this.view.fullWidth/this.zoom,l=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=a*this.view.offsetX,o=s+a*this.view.width,r-=l*this.view.offsetY,_=r-l*this.view.height}this.projectionMatrix.makeOrthographic(s,o,r,_,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}}nr.prototype.isOrthographicCamera=!0;const js=4,K_=[.125,.215,.35,.446,.526,.582],us=20,Ur=new nr,Q_=new fi;let Gr=null;const cs=(1+Math.sqrt(5))/2,Ds=1/cs,th=[new wt(1,1,1),new wt(-1,1,1),new wt(1,1,-1),new wt(-1,1,-1),new wt(0,cs,Ds),new wt(0,cs,-Ds),new wt(Ds,0,cs),new wt(-Ds,0,cs),new wt(cs,Ds,0),new wt(-cs,Ds,0)];class eh{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,n=100){Gr=this._renderer.getRenderTarget(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(t,i,n,s),e>0&&this._blur(s,0,0,e),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=sh(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=nh(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Gr),t.scissorTest=!1,bo(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===ia||t.mapping===na?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),Gr=this._renderer.getRenderTarget();const i=e||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:rn,minFilter:rn,generateMipmaps:!1,type:Fa,format:vn,encoding:es,depthBuffer:!1},n=ih(t,e,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=ih(t,e,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Wf(s)),this._blurMaterial=jf(s,t,e)}return n}_compileMaterial(t){const e=new sn(this._lodPlanes[0],t);this._renderer.compile(e,Ur)}_sceneToCubeUV(t,e,i,n){const r=new nn(90,1,e,i),_=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],l=this._renderer,h=l.autoClear,u=l.toneMapping;l.getClearColor(Q_),l.toneMapping=Fn,l.autoClear=!1;const f=new tr({name:"PMREM.Background",side:Mn,depthWrite:!1,depthTest:!1}),m=new sn(new qa,f);let d=!1;const p=t.background;p?p.isColor&&(f.color.copy(p),t.background=null,d=!0):(f.color.copy(Q_),d=!0);for(let g=0;g<6;g++){const x=g%3;x===0?(r.up.set(0,_[g],0),r.lookAt(a[g],0,0)):x===1?(r.up.set(0,0,_[g]),r.lookAt(0,a[g],0)):(r.up.set(0,_[g],0),r.lookAt(0,0,a[g]));const b=this._cubeSize;bo(n,x*b,g>2?b:0,b,b),l.setRenderTarget(n),d&&l.render(m,r),l.render(t,r)}m.geometry.dispose(),m.material.dispose(),l.toneMapping=u,l.autoClear=h,t.background=p}_textureToCubeUV(t,e){const i=this._renderer,n=t.mapping===ia||t.mapping===na;n?(this._cubemapMaterial===null&&(this._cubemapMaterial=sh()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=nh());const s=n?this._cubemapMaterial:this._equirectMaterial,o=new sn(this._lodPlanes[0],s),r=s.uniforms;r.envMap.value=t;const _=this._cubeSize;bo(e,0,0,3*_,2*_),i.setRenderTarget(e),i.render(o,Ur)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let n=1;n<this._lodPlanes.length;n++){const s=Math.sqrt(this._sigmas[n]*this._sigmas[n]-this._sigmas[n-1]*this._sigmas[n-1]),o=th[(n-1)%th.length];this._blur(t,n-1,n,s,o)}e.autoClear=i}_blur(t,e,i,n,s){const o=this._pingPongRenderTarget;this._halfBlur(t,o,e,i,n,"latitudinal",s),this._halfBlur(o,t,i,i,n,"longitudinal",s)}_halfBlur(t,e,i,n,s,o,r){const _=this._renderer,a=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const l=3,h=new sn(this._lodPlanes[n],a),u=a.uniforms,f=this._sizeLods[i]-1,m=isFinite(s)?Math.PI/(2*f):2*Math.PI/(2*us-1),d=s/m,p=isFinite(s)?1+Math.floor(l*d):us;p>us&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${p} samples when the maximum is set to ${us}`);const g=[];let x=0;for(let Y=0;Y<us;++Y){const X=Y/d,w=Math.exp(-X*X/2);g.push(w),Y===0?x+=w:Y<p&&(x+=2*w)}for(let Y=0;Y<g.length;Y++)g[Y]=g[Y]/x;u.envMap.value=t.texture,u.samples.value=p,u.weights.value=g,u.latitudinal.value=o==="latitudinal",r&&(u.poleAxis.value=r);const{_lodMax:b}=this;u.dTheta.value=m,u.mipInt.value=b-i;const y=this._sizeLods[n],z=3*y*(n>b-js?n-b+js:0),M=4*(this._cubeSize-y);bo(e,z,M,3*y,2*y),_.setRenderTarget(e),_.render(h,Ur)}}function Wf(c){const t=[],e=[],i=[];let n=c;const s=c-js+1+K_.length;for(let o=0;o<s;o++){const r=Math.pow(2,n);e.push(r);let _=1/r;o>c-js?_=K_[o-c+js-1]:o===0&&(_=0),i.push(_);const a=1/(r-2),l=-a,h=1+a,u=[l,l,h,l,h,h,l,l,h,h,l,h],f=6,m=6,d=3,p=2,g=1,x=new Float32Array(d*m*f),b=new Float32Array(p*m*f),y=new Float32Array(g*m*f);for(let M=0;M<f;M++){const Y=M%3*2/3-1,X=M>2?0:-1,w=[Y,X,0,Y+2/3,X,0,Y+2/3,X+1,0,Y,X,0,Y+2/3,X+1,0,Y,X+1,0];x.set(w,d*m*M),b.set(u,p*m*M);const S=[M,M,M,M,M,M];y.set(S,g*m*M)}const z=new Ei;z.setAttribute("position",new Bi(x,d)),z.setAttribute("uv",new Bi(b,p)),z.setAttribute("faceIndex",new Bi(y,g)),t.push(z),n>js&&n--}return{lodPlanes:t,sizeLods:e,sigmas:i}}function ih(c,t,e){const i=new ln(c,t,e);return i.texture.mapping=$o,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function bo(c,t,e,i,n){c.viewport.set(t,e,i,n),c.scissor.set(t,e,i,n)}function jf(c,t,e){const i=new Float32Array(us),n=new wt(0,1,0);return new wn({name:"SphericalGaussianBlur",defines:{n:us,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/e,CUBEUV_MAX_MIP:`${c}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:Al(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Ln,depthTest:!1,depthWrite:!1})}function nh(){return new wn({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Al(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Ln,depthTest:!1,depthWrite:!1})}function sh(){return new wn({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Al(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Ln,depthTest:!1,depthWrite:!1})}function Al(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function qf(c){let t=new WeakMap,e=null;function i(r){if(r&&r.isTexture){const _=r.mapping,a=_===ol||_===rl,l=_===ia||_===na;if(a||l)if(r.isRenderTargetTexture&&r.needsPMREMUpdate===!0){r.needsPMREMUpdate=!1;let h=t.get(r);return e===null&&(e=new eh(c)),h=a?e.fromEquirectangular(r,h):e.fromCubemap(r,h),t.set(r,h),h.texture}else{if(t.has(r))return t.get(r).texture;{const h=r.image;if(a&&h&&h.height>0||l&&h&&n(h)){e===null&&(e=new eh(c));const u=a?e.fromEquirectangular(r):e.fromCubemap(r);return t.set(r,u),r.addEventListener("dispose",s),u.texture}else return null}}}return r}function n(r){let _=0;const a=6;for(let l=0;l<a;l++)r[l]!==void 0&&_++;return _===a}function s(r){const _=r.target;_.removeEventListener("dispose",s);const a=t.get(_);a!==void 0&&(t.delete(_),a.dispose())}function o(){t=new WeakMap,e!==null&&(e.dispose(),e=null)}return{get:i,dispose:o}}function Jf(c){const t={};function e(i){if(t[i]!==void 0)return t[i];let n;switch(i){case"WEBGL_depth_texture":n=c.getExtension("WEBGL_depth_texture")||c.getExtension("MOZ_WEBGL_depth_texture")||c.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=c.getExtension("WEBGL_compressed_texture_s3tc")||c.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||c.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=c.getExtension("WEBGL_compressed_texture_pvrtc")||c.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=c.getExtension(i)}return t[i]=n,n}return{has:function(i){return e(i)!==null},init:function(i){i.isWebGL2?e("EXT_color_buffer_float"):(e("WEBGL_depth_texture"),e("OES_texture_float"),e("OES_texture_half_float"),e("OES_texture_half_float_linear"),e("OES_standard_derivatives"),e("OES_element_index_uint"),e("OES_vertex_array_object"),e("ANGLE_instanced_arrays")),e("OES_texture_float_linear"),e("EXT_color_buffer_half_float"),e("WEBGL_multisampled_render_to_texture")},get:function(i){const n=e(i);return n===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),n}}}function $f(c,t,e,i){const n={},s=new WeakMap;function o(h){const u=h.target;u.index!==null&&t.remove(u.index);for(const m in u.attributes)t.remove(u.attributes[m]);u.removeEventListener("dispose",o),delete n[u.id];const f=s.get(u);f&&(t.remove(f),s.delete(u)),i.releaseStatesOfGeometry(u),u.isInstancedBufferGeometry===!0&&delete u._maxInstanceCount,e.memory.geometries--}function r(h,u){return n[u.id]===!0||(u.addEventListener("dispose",o),n[u.id]=!0,e.memory.geometries++),u}function _(h){const u=h.attributes;for(const m in u)t.update(u[m],34962);const f=h.morphAttributes;for(const m in f){const d=f[m];for(let p=0,g=d.length;p<g;p++)t.update(d[p],34962)}}function a(h){const u=[],f=h.index,m=h.attributes.position;let d=0;if(f!==null){const x=f.array;d=f.version;for(let b=0,y=x.length;b<y;b+=3){const z=x[b+0],M=x[b+1],Y=x[b+2];u.push(z,M,M,Y,Y,z)}}else{const x=m.array;d=m.version;for(let b=0,y=x.length/3-1;b<y;b+=3){const z=b+0,M=b+1,Y=b+2;u.push(z,M,M,Y,Y,z)}}const p=new(uc(u)?dc:fc)(u,1);p.version=d;const g=s.get(h);g&&t.remove(g),s.set(h,p)}function l(h){const u=s.get(h);if(u){const f=h.index;f!==null&&u.version<f.version&&a(h)}else a(h);return s.get(h)}return{get:r,update:_,getWireframeAttribute:l}}function Kf(c,t,e,i){const n=i.isWebGL2;let s;function o(u){s=u}let r,_;function a(u){r=u.type,_=u.bytesPerElement}function l(u,f){c.drawElements(s,f,r,u*_),e.update(f,s,1)}function h(u,f,m){if(m===0)return;let d,p;if(n)d=c,p="drawElementsInstanced";else if(d=t.get("ANGLE_instanced_arrays"),p="drawElementsInstancedANGLE",d===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[p](s,f,r,u*_,m),e.update(f,s,m)}this.setMode=o,this.setIndex=a,this.render=l,this.renderInstances=h}function Qf(c){const t={geometries:0,textures:0},e={frame:0,calls:0,triangles:0,points:0,lines:0};function i(s,o,r){switch(e.calls++,o){case 4:e.triangles+=r*(s/3);break;case 1:e.lines+=r*(s/2);break;case 3:e.lines+=r*(s-1);break;case 2:e.lines+=r*s;break;case 0:e.points+=r*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function n(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0}return{memory:t,render:e,programs:null,autoReset:!0,reset:n,update:i}}function td(c,t){return c[0]-t[0]}function ed(c,t){return Math.abs(t[1])-Math.abs(c[1])}function Hr(c,t){let e=1;const i=t.isInterleavedBufferAttribute?t.data.array:t.array;i instanceof Int8Array?e=127:i instanceof Int16Array?e=32767:i instanceof Int32Array?e=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",i),c.divideScalar(e)}function id(c,t,e){const i={},n=new Float32Array(8),s=new WeakMap,o=new Li,r=[];for(let a=0;a<8;a++)r[a]=[a,0];function _(a,l,h,u){const f=a.morphTargetInfluences;if(t.isWebGL2===!0){const m=l.morphAttributes.position||l.morphAttributes.normal||l.morphAttributes.color,d=m!==void 0?m.length:0;let p=s.get(l);if(p===void 0||p.count!==d){let Z=function(){C.dispose(),s.delete(l),l.removeEventListener("dispose",Z)};p!==void 0&&p.texture.dispose();const b=l.morphAttributes.position!==void 0,y=l.morphAttributes.normal!==void 0,z=l.morphAttributes.color!==void 0,M=l.morphAttributes.position||[],Y=l.morphAttributes.normal||[],X=l.morphAttributes.color||[];let w=0;b===!0&&(w=1),y===!0&&(w=2),z===!0&&(w=3);let S=l.attributes.position.count*w,V=1;S>t.maxTextureSize&&(V=Math.ceil(S/t.maxTextureSize),S=t.maxTextureSize);const F=new Float32Array(S*V*4*d),C=new Qo(F,S,V,d);C.type=ms,C.needsUpdate=!0;const A=w*4;for(let L=0;L<d;L++){const E=M[L],T=Y[L],P=X[L],N=S*V*4*L;for(let R=0;R<E.count;R++){const k=R*A;b===!0&&(o.fromBufferAttribute(E,R),E.normalized===!0&&Hr(o,E),F[N+k+0]=o.x,F[N+k+1]=o.y,F[N+k+2]=o.z,F[N+k+3]=0),y===!0&&(o.fromBufferAttribute(T,R),T.normalized===!0&&Hr(o,T),F[N+k+4]=o.x,F[N+k+5]=o.y,F[N+k+6]=o.z,F[N+k+7]=0),z===!0&&(o.fromBufferAttribute(P,R),P.normalized===!0&&Hr(o,P),F[N+k+8]=o.x,F[N+k+9]=o.y,F[N+k+10]=o.z,F[N+k+11]=P.itemSize===4?o.w:1)}}p={count:d,texture:C,size:new Ne(S,V)},s.set(l,p),l.addEventListener("dispose",Z)}let g=0;for(let b=0;b<f.length;b++)g+=f[b];const x=l.morphTargetsRelative?1:1-g;u.getUniforms().setValue(c,"morphTargetBaseInfluence",x),u.getUniforms().setValue(c,"morphTargetInfluences",f),u.getUniforms().setValue(c,"morphTargetsTexture",p.texture,e),u.getUniforms().setValue(c,"morphTargetsTextureSize",p.size)}else{const m=f===void 0?0:f.length;let d=i[l.id];if(d===void 0||d.length!==m){d=[];for(let y=0;y<m;y++)d[y]=[y,0];i[l.id]=d}for(let y=0;y<m;y++){const z=d[y];z[0]=y,z[1]=f[y]}d.sort(ed);for(let y=0;y<8;y++)y<m&&d[y][1]?(r[y][0]=d[y][0],r[y][1]=d[y][1]):(r[y][0]=Number.MAX_SAFE_INTEGER,r[y][1]=0);r.sort(td);const p=l.morphAttributes.position,g=l.morphAttributes.normal;let x=0;for(let y=0;y<8;y++){const z=r[y],M=z[0],Y=z[1];M!==Number.MAX_SAFE_INTEGER&&Y?(p&&l.getAttribute("morphTarget"+y)!==p[M]&&l.setAttribute("morphTarget"+y,p[M]),g&&l.getAttribute("morphNormal"+y)!==g[M]&&l.setAttribute("morphNormal"+y,g[M]),n[y]=Y,x+=Y):(p&&l.hasAttribute("morphTarget"+y)===!0&&l.deleteAttribute("morphTarget"+y),g&&l.hasAttribute("morphNormal"+y)===!0&&l.deleteAttribute("morphNormal"+y),n[y]=0)}const b=l.morphTargetsRelative?1:1-x;u.getUniforms().setValue(c,"morphTargetBaseInfluence",b),u.getUniforms().setValue(c,"morphTargetInfluences",n)}}return{update:_}}function nd(c,t,e,i){let n=new WeakMap;function s(_){const a=i.render.frame,l=_.geometry,h=t.get(_,l);return n.get(h)!==a&&(t.update(h),n.set(h,a)),_.isInstancedMesh&&(_.hasEventListener("dispose",r)===!1&&_.addEventListener("dispose",r),e.update(_.instanceMatrix,34962),_.instanceColor!==null&&e.update(_.instanceColor,34962)),h}function o(){n=new WeakMap}function r(_){const a=_.target;a.removeEventListener("dispose",r),e.remove(a.instanceMatrix),a.instanceColor!==null&&e.remove(a.instanceColor)}return{update:s,dispose:o}}const vc=new $i,bc=new Qo,yc=new Sl,Mc=new er,ah=[],oh=[],rh=new Float32Array(16),lh=new Float32Array(9),_h=new Float32Array(4);function ha(c,t,e){const i=c[0];if(i<=0||i>0)return c;const n=t*e;let s=ah[n];if(s===void 0&&(s=new Float32Array(n),ah[n]=s),t!==0){i.toArray(s,0);for(let o=1,r=0;o!==t;++o)r+=e,c[o].toArray(s,r)}return s}function an(c,t){if(c.length!==t.length)return!1;for(let e=0,i=c.length;e<i;e++)if(c[e]!==t[e])return!1;return!0}function on(c,t){for(let e=0,i=t.length;e<i;e++)c[e]=t[e]}function sr(c,t){let e=oh[t];e===void 0&&(e=new Int32Array(t),oh[t]=e);for(let i=0;i!==t;++i)e[i]=c.allocateTextureUnit();return e}function sd(c,t){const e=this.cache;e[0]!==t&&(c.uniform1f(this.addr,t),e[0]=t)}function ad(c,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(c.uniform2f(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(an(e,t))return;c.uniform2fv(this.addr,t),on(e,t)}}function od(c,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(c.uniform3f(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else if(t.r!==void 0)(e[0]!==t.r||e[1]!==t.g||e[2]!==t.b)&&(c.uniform3f(this.addr,t.r,t.g,t.b),e[0]=t.r,e[1]=t.g,e[2]=t.b);else{if(an(e,t))return;c.uniform3fv(this.addr,t),on(e,t)}}function rd(c,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(c.uniform4f(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(an(e,t))return;c.uniform4fv(this.addr,t),on(e,t)}}function ld(c,t){const e=this.cache,i=t.elements;if(i===void 0){if(an(e,t))return;c.uniformMatrix2fv(this.addr,!1,t),on(e,t)}else{if(an(e,i))return;_h.set(i),c.uniformMatrix2fv(this.addr,!1,_h),on(e,i)}}function _d(c,t){const e=this.cache,i=t.elements;if(i===void 0){if(an(e,t))return;c.uniformMatrix3fv(this.addr,!1,t),on(e,t)}else{if(an(e,i))return;lh.set(i),c.uniformMatrix3fv(this.addr,!1,lh),on(e,i)}}function hd(c,t){const e=this.cache,i=t.elements;if(i===void 0){if(an(e,t))return;c.uniformMatrix4fv(this.addr,!1,t),on(e,t)}else{if(an(e,i))return;rh.set(i),c.uniformMatrix4fv(this.addr,!1,rh),on(e,i)}}function cd(c,t){const e=this.cache;e[0]!==t&&(c.uniform1i(this.addr,t),e[0]=t)}function ud(c,t){const e=this.cache;an(e,t)||(c.uniform2iv(this.addr,t),on(e,t))}function pd(c,t){const e=this.cache;an(e,t)||(c.uniform3iv(this.addr,t),on(e,t))}function md(c,t){const e=this.cache;an(e,t)||(c.uniform4iv(this.addr,t),on(e,t))}function fd(c,t){const e=this.cache;e[0]!==t&&(c.uniform1ui(this.addr,t),e[0]=t)}function dd(c,t){const e=this.cache;an(e,t)||(c.uniform2uiv(this.addr,t),on(e,t))}function gd(c,t){const e=this.cache;an(e,t)||(c.uniform3uiv(this.addr,t),on(e,t))}function xd(c,t){const e=this.cache;an(e,t)||(c.uniform4uiv(this.addr,t),on(e,t))}function vd(c,t,e){const i=this.cache,n=e.allocateTextureUnit();i[0]!==n&&(c.uniform1i(this.addr,n),i[0]=n),e.setTexture2D(t||vc,n)}function bd(c,t,e){const i=this.cache,n=e.allocateTextureUnit();i[0]!==n&&(c.uniform1i(this.addr,n),i[0]=n),e.setTexture3D(t||yc,n)}function yd(c,t,e){const i=this.cache,n=e.allocateTextureUnit();i[0]!==n&&(c.uniform1i(this.addr,n),i[0]=n),e.setTextureCube(t||Mc,n)}function Md(c,t,e){const i=this.cache,n=e.allocateTextureUnit();i[0]!==n&&(c.uniform1i(this.addr,n),i[0]=n),e.setTexture2DArray(t||bc,n)}function wd(c){switch(c){case 5126:return sd;case 35664:return ad;case 35665:return od;case 35666:return rd;case 35674:return ld;case 35675:return _d;case 35676:return hd;case 5124:case 35670:return cd;case 35667:case 35671:return ud;case 35668:case 35672:return pd;case 35669:case 35673:return md;case 5125:return fd;case 36294:return dd;case 36295:return gd;case 36296:return xd;case 35678:case 36198:case 36298:case 36306:case 35682:return vd;case 35679:case 36299:case 36307:return bd;case 35680:case 36300:case 36308:case 36293:return yd;case 36289:case 36303:case 36311:case 36292:return Md}}function Xd(c,t){c.uniform1fv(this.addr,t)}function Id(c,t){const e=ha(t,this.size,2);c.uniform2fv(this.addr,e)}function zd(c,t){const e=ha(t,this.size,3);c.uniform3fv(this.addr,e)}function Sd(c,t){const e=ha(t,this.size,4);c.uniform4fv(this.addr,e)}function Yd(c,t){const e=ha(t,this.size,4);c.uniformMatrix2fv(this.addr,!1,e)}function Zd(c,t){const e=ha(t,this.size,9);c.uniformMatrix3fv(this.addr,!1,e)}function Ld(c,t){const e=ha(t,this.size,16);c.uniformMatrix4fv(this.addr,!1,e)}function Ad(c,t){c.uniform1iv(this.addr,t)}function Td(c,t){c.uniform2iv(this.addr,t)}function Vd(c,t){c.uniform3iv(this.addr,t)}function Ed(c,t){c.uniform4iv(this.addr,t)}function Cd(c,t){c.uniform1uiv(this.addr,t)}function Pd(c,t){c.uniform2uiv(this.addr,t)}function Rd(c,t){c.uniform3uiv(this.addr,t)}function kd(c,t){c.uniform4uiv(this.addr,t)}function Bd(c,t,e){const i=t.length,n=sr(e,i);c.uniform1iv(this.addr,n);for(let s=0;s!==i;++s)e.setTexture2D(t[s]||vc,n[s])}function Dd(c,t,e){const i=t.length,n=sr(e,i);c.uniform1iv(this.addr,n);for(let s=0;s!==i;++s)e.setTexture3D(t[s]||yc,n[s])}function Nd(c,t,e){const i=t.length,n=sr(e,i);c.uniform1iv(this.addr,n);for(let s=0;s!==i;++s)e.setTextureCube(t[s]||Mc,n[s])}function Fd(c,t,e){const i=t.length,n=sr(e,i);c.uniform1iv(this.addr,n);for(let s=0;s!==i;++s)e.setTexture2DArray(t[s]||bc,n[s])}function Od(c){switch(c){case 5126:return Xd;case 35664:return Id;case 35665:return zd;case 35666:return Sd;case 35674:return Yd;case 35675:return Zd;case 35676:return Ld;case 5124:case 35670:return Ad;case 35667:case 35671:return Td;case 35668:case 35672:return Vd;case 35669:case 35673:return Ed;case 5125:return Cd;case 36294:return Pd;case 36295:return Rd;case 36296:return kd;case 35678:case 36198:case 36298:case 36306:case 35682:return Bd;case 35679:case 36299:case 36307:return Dd;case 35680:case 36300:case 36308:case 36293:return Nd;case 36289:case 36303:case 36311:case 36292:return Fd}}function Ud(c,t,e){this.id=c,this.addr=e,this.cache=[],this.setValue=wd(t.type)}function Gd(c,t,e){this.id=c,this.addr=e,this.cache=[],this.size=t.size,this.setValue=Od(t.type)}function wc(c){this.id=c,this.seq=[],this.map={}}wc.prototype.setValue=function(c,t,e){const i=this.seq;for(let n=0,s=i.length;n!==s;++n){const o=i[n];o.setValue(c,t[o.id],e)}};const Wr=/(\w+)(\])?(\[|\.)?/g;function hh(c,t){c.seq.push(t),c.map[t.id]=t}function Hd(c,t,e){const i=c.name,n=i.length;for(Wr.lastIndex=0;;){const s=Wr.exec(i),o=Wr.lastIndex;let r=s[1];const _=s[2]==="]",a=s[3];if(_&&(r=r|0),a===void 0||a==="["&&o+2===n){hh(e,a===void 0?new Ud(r,c,t):new Gd(r,c,t));break}else{let h=e.map[r];h===void 0&&(h=new wc(r),hh(e,h)),e=h}}}function Qn(c,t){this.seq=[],this.map={};const e=c.getProgramParameter(t,35718);for(let i=0;i<e;++i){const n=c.getActiveUniform(t,i),s=c.getUniformLocation(t,n.name);Hd(n,s,this)}}Qn.prototype.setValue=function(c,t,e,i){const n=this.map[t];n!==void 0&&n.setValue(c,e,i)};Qn.prototype.setOptional=function(c,t,e){const i=t[e];i!==void 0&&this.setValue(c,e,i)};Qn.upload=function(c,t,e,i){for(let n=0,s=t.length;n!==s;++n){const o=t[n],r=e[o.id];r.needsUpdate!==!1&&o.setValue(c,r.value,i)}};Qn.seqWithValue=function(c,t){const e=[];for(let i=0,n=c.length;i!==n;++i){const s=c[i];s.id in t&&e.push(s)}return e};function ch(c,t,e){const i=c.createShader(t);return c.shaderSource(i,e),c.compileShader(i),i}let Wd=0;function jd(c,t){const e=c.split(`
`),i=[],n=Math.max(t-6,0),s=Math.min(t+6,e.length);for(let o=n;o<s;o++)i.push(o+1+": "+e[o]);return i.join(`
`)}function qd(c){switch(c){case es:return["Linear","( value )"];case Ci:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",c),["Linear","( value )"]}}function uh(c,t,e){const i=c.getShaderParameter(t,35713),n=c.getShaderInfoLog(t).trim();if(i&&n==="")return"";const s=/ERROR: 0:(\d+)/.exec(n);if(s){const o=parseInt(s[0]);return e.toUpperCase()+`

`+n+`

`+jd(c.getShaderSource(t),o)}else return n}function Jd(c,t){const e=qd(t);return"vec4 "+c+"( vec4 value ) { return LinearTo"+e[0]+e[1]+"; }"}function $d(c,t){let e;switch(t){case du:e="Linear";break;case gu:e="Reinhard";break;case xu:e="OptimizedCineon";break;case vu:e="ACESFilmic";break;case bu:e="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),e="Linear"}return"vec3 "+c+"( vec3 color ) { return "+e+"ToneMapping( color ); }"}function Kd(c){return[c.extensionDerivatives||!!c.envMapCubeUVHeight||c.bumpMap||c.tangentSpaceNormalMap||c.clearcoatNormalMap||c.flatShading||c.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(c.extensionFragDepth||c.logarithmicDepthBuffer)&&c.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",c.extensionDrawBuffers&&c.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(c.extensionShaderTextureLOD||c.envMap||c.transmission)&&c.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Aa).join(`
`)}function Qd(c){const t=[];for(const e in c){const i=c[e];i!==!1&&t.push("#define "+e+" "+i)}return t.join(`
`)}function t2(c,t){const e={},i=c.getProgramParameter(t,35721);for(let n=0;n<i;n++){const s=c.getActiveAttrib(t,n),o=s.name;let r=1;s.type===35674&&(r=2),s.type===35675&&(r=3),s.type===35676&&(r=4),e[o]={type:s.type,location:c.getAttribLocation(t,o),locationSize:r}}return e}function Aa(c){return c!==""}function ph(c,t){return c.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function mh(c,t){return c.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const e2=/^[ \t]*#include +<([\w\d./]+)>/gm;function pl(c){return c.replace(e2,i2)}function i2(c,t){const e=Ii[t];if(e===void 0)throw new Error("Can not resolve #include <"+t+">");return pl(e)}const n2=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,s2=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function fh(c){return c.replace(s2,Xc).replace(n2,a2)}function a2(c,t,e,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Xc(c,t,e,i)}function Xc(c,t,e,i){let n="";for(let s=parseInt(t);s<parseInt(e);s++)n+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function dh(c){let t="precision "+c.precision+` float;
precision `+c.precision+" int;";return c.precision==="highp"?t+=`
#define HIGH_PRECISION`:c.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:c.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function o2(c){let t="SHADOWMAP_TYPE_BASIC";return c.shadowMapType===oc?t="SHADOWMAP_TYPE_PCF":c.shadowMapType===j1?t="SHADOWMAP_TYPE_PCF_SOFT":c.shadowMapType===La&&(t="SHADOWMAP_TYPE_VSM"),t}function r2(c){let t="ENVMAP_TYPE_CUBE";if(c.envMap)switch(c.envMapMode){case ia:case na:t="ENVMAP_TYPE_CUBE";break;case $o:t="ENVMAP_TYPE_CUBE_UV";break}return t}function l2(c){let t="ENVMAP_MODE_REFLECTION";if(c.envMap)switch(c.envMapMode){case na:t="ENVMAP_MODE_REFRACTION";break}return t}function _2(c){let t="ENVMAP_BLENDING_NONE";if(c.envMap)switch(c.combine){case Jo:t="ENVMAP_BLENDING_MULTIPLY";break;case mu:t="ENVMAP_BLENDING_MIX";break;case fu:t="ENVMAP_BLENDING_ADD";break}return t}function h2(c){const t=c.envMapCubeUVHeight;if(t===null)return null;const e=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:i,maxMip:e}}function c2(c,t,e,i){const n=c.getContext(),s=e.defines;let o=e.vertexShader,r=e.fragmentShader;const _=o2(e),a=r2(e),l=l2(e),h=_2(e),u=h2(e),f=e.isWebGL2?"":Kd(e),m=Qd(s),d=n.createProgram();let p,g,x=e.glslVersion?"#version "+e.glslVersion+`
`:"";e.isRawShaderMaterial?(p=[m].filter(Aa).join(`
`),p.length>0&&(p+=`
`),g=[f,m].filter(Aa).join(`
`),g.length>0&&(g+=`
`)):(p=[dh(e),"#define SHADER_NAME "+e.shaderName,m,e.instancing?"#define USE_INSTANCING":"",e.instancingColor?"#define USE_INSTANCING_COLOR":"",e.supportsVertexTextures?"#define VERTEX_TEXTURES":"",e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+l:"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMap&&e.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",e.normalMap&&e.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.displacementMap&&e.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",e.specularColorMap?"#define USE_SPECULARCOLORMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.sheenColorMap?"#define USE_SHEENCOLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",e.vertexTangents?"#define USE_TANGENT":"",e.vertexColors?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUvs?"#define USE_UV":"",e.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",e.flatShading?"#define FLAT_SHADED":"",e.skinning?"#define USE_SKINNING":"",e.morphTargets?"#define USE_MORPHTARGETS":"",e.morphNormals&&e.flatShading===!1?"#define USE_MORPHNORMALS":"",e.morphColors&&e.isWebGL2?"#define USE_MORPHCOLORS":"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+e.morphTextureStride:"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_COUNT "+e.morphTargetsCount:"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+_:"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Aa).join(`
`),g=[f,dh(e),"#define SHADER_NAME "+e.shaderName,m,e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.matcap?"#define USE_MATCAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+a:"",e.envMap?"#define "+l:"",e.envMap?"#define "+h:"",u?"#define CUBEUV_TEXEL_WIDTH "+u.texelWidth:"",u?"#define CUBEUV_TEXEL_HEIGHT "+u.texelHeight:"",u?"#define CUBEUV_MAX_MIP "+u.maxMip+".0":"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMap&&e.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",e.normalMap&&e.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",e.clearcoat?"#define USE_CLEARCOAT":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",e.specularColorMap?"#define USE_SPECULARCOLORMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.alphaTest?"#define USE_ALPHATEST":"",e.sheen?"#define USE_SHEEN":"",e.sheenColorMap?"#define USE_SHEENCOLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",e.vertexTangents?"#define USE_TANGENT":"",e.vertexColors||e.instancingColor?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUvs?"#define USE_UV":"",e.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",e.gradientMap?"#define USE_GRADIENTMAP":"",e.flatShading?"#define FLAT_SHADED":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+_:"",e.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",e.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",e.toneMapping!==Fn?"#define TONE_MAPPING":"",e.toneMapping!==Fn?Ii.tonemapping_pars_fragment:"",e.toneMapping!==Fn?$d("toneMapping",e.toneMapping):"",e.dithering?"#define DITHERING":"",e.opaque?"#define OPAQUE":"",Ii.encodings_pars_fragment,Jd("linearToOutputTexel",e.outputEncoding),e.useDepthPacking?"#define DEPTH_PACKING "+e.depthPacking:"",`
`].filter(Aa).join(`
`)),o=pl(o),o=ph(o,e),o=mh(o,e),r=pl(r),r=ph(r,e),r=mh(r,e),o=fh(o),r=fh(r),e.isWebGL2&&e.isRawShaderMaterial!==!0&&(x=`#version 300 es
`,p=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+p,g=["#define varying in",e.glslVersion===Fo?"":"layout(location = 0) out highp vec4 pc_fragColor;",e.glslVersion===Fo?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+g);const b=x+p+o,y=x+g+r,z=ch(n,35633,b),M=ch(n,35632,y);if(n.attachShader(d,z),n.attachShader(d,M),e.index0AttributeName!==void 0?n.bindAttribLocation(d,0,e.index0AttributeName):e.morphTargets===!0&&n.bindAttribLocation(d,0,"position"),n.linkProgram(d),c.debug.checkShaderErrors){const w=n.getProgramInfoLog(d).trim(),S=n.getShaderInfoLog(z).trim(),V=n.getShaderInfoLog(M).trim();let F=!0,C=!0;if(n.getProgramParameter(d,35714)===!1){F=!1;const A=uh(n,z,"vertex"),Z=uh(n,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(d,35715)+`

Program Info Log: `+w+`
`+A+`
`+Z)}else w!==""?console.warn("THREE.WebGLProgram: Program Info Log:",w):(S===""||V==="")&&(C=!1);C&&(this.diagnostics={runnable:F,programLog:w,vertexShader:{log:S,prefix:p},fragmentShader:{log:V,prefix:g}})}n.deleteShader(z),n.deleteShader(M);let Y;this.getUniforms=function(){return Y===void 0&&(Y=new Qn(n,d)),Y};let X;return this.getAttributes=function(){return X===void 0&&(X=t2(n,d)),X},this.destroy=function(){i.releaseStatesOfProgram(this),n.deleteProgram(d),this.program=void 0},this.name=e.shaderName,this.id=Wd++,this.cacheKey=t,this.usedTimes=1,this.program=d,this.vertexShader=z,this.fragmentShader=M,this}let u2=0;class p2{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,i=t.fragmentShader,n=this._getShaderStage(e),s=this._getShaderStage(i),o=this._getShaderCacheForMaterial(t);return o.has(n)===!1&&(o.add(n),n.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const i of e)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;return e.has(t)===!1&&e.set(t,new Set),e.get(t)}_getShaderStage(t){const e=this.shaderCache;if(e.has(t)===!1){const i=new m2(t);e.set(t,i)}return e.get(t)}}class m2{constructor(t){this.id=u2++,this.code=t,this.usedTimes=0}}function f2(c,t,e,i,n,s,o){const r=new mc,_=new p2,a=[],l=n.isWebGL2,h=n.logarithmicDepthBuffer,u=n.vertexTextures;let f=n.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function d(X,w,S,V,F){const C=V.fog,A=F.geometry,Z=X.isMeshStandardMaterial?V.environment:null,L=(X.isMeshStandardMaterial?e:t).get(X.envMap||Z),E=!!L&&L.mapping===$o?L.image.height:null,T=m[X.type];X.precision!==null&&(f=n.getMaxPrecision(X.precision),f!==X.precision&&console.warn("THREE.WebGLProgram.getParameters:",X.precision,"not supported, using",f,"instead."));const P=A.morphAttributes.position||A.morphAttributes.normal||A.morphAttributes.color,N=P!==void 0?P.length:0;let R=0;A.morphAttributes.position!==void 0&&(R=1),A.morphAttributes.normal!==void 0&&(R=2),A.morphAttributes.color!==void 0&&(R=3);let k,O,v,D;if(T){const Q=Yn[T];k=Q.vertexShader,O=Q.fragmentShader}else k=X.vertexShader,O=X.fragmentShader,_.update(X),v=_.getVertexShaderID(X),D=_.getFragmentShaderID(X);const B=c.getRenderTarget(),U=X.alphaTest>0,q=X.clearcoat>0;return{isWebGL2:l,shaderID:T,shaderName:X.type,vertexShader:k,fragmentShader:O,defines:X.defines,customVertexShaderID:v,customFragmentShaderID:D,isRawShaderMaterial:X.isRawShaderMaterial===!0,glslVersion:X.glslVersion,precision:f,instancing:F.isInstancedMesh===!0,instancingColor:F.isInstancedMesh===!0&&F.instanceColor!==null,supportsVertexTextures:u,outputEncoding:B===null?c.outputEncoding:B.isXRRenderTarget===!0?B.texture.encoding:es,map:!!X.map,matcap:!!X.matcap,envMap:!!L,envMapMode:L&&L.mapping,envMapCubeUVHeight:E,lightMap:!!X.lightMap,aoMap:!!X.aoMap,emissiveMap:!!X.emissiveMap,bumpMap:!!X.bumpMap,normalMap:!!X.normalMap,objectSpaceNormalMap:X.normalMapType===Ou,tangentSpaceNormalMap:X.normalMapType===ra,decodeVideoTexture:!!X.map&&X.map.isVideoTexture===!0&&X.map.encoding===Ci,clearcoat:q,clearcoatMap:q&&!!X.clearcoatMap,clearcoatRoughnessMap:q&&!!X.clearcoatRoughnessMap,clearcoatNormalMap:q&&!!X.clearcoatNormalMap,displacementMap:!!X.displacementMap,roughnessMap:!!X.roughnessMap,metalnessMap:!!X.metalnessMap,specularMap:!!X.specularMap,specularIntensityMap:!!X.specularIntensityMap,specularColorMap:!!X.specularColorMap,opaque:X.transparent===!1&&X.blending===Qs,alphaMap:!!X.alphaMap,alphaTest:U,gradientMap:!!X.gradientMap,sheen:X.sheen>0,sheenColorMap:!!X.sheenColorMap,sheenRoughnessMap:!!X.sheenRoughnessMap,transmission:X.transmission>0,transmissionMap:!!X.transmissionMap,thicknessMap:!!X.thicknessMap,combine:X.combine,vertexTangents:!!X.normalMap&&!!A.attributes.tangent,vertexColors:X.vertexColors,vertexAlphas:X.vertexColors===!0&&!!A.attributes.color&&A.attributes.color.itemSize===4,vertexUvs:!!X.map||!!X.bumpMap||!!X.normalMap||!!X.specularMap||!!X.alphaMap||!!X.emissiveMap||!!X.roughnessMap||!!X.metalnessMap||!!X.clearcoatMap||!!X.clearcoatRoughnessMap||!!X.clearcoatNormalMap||!!X.displacementMap||!!X.transmissionMap||!!X.thicknessMap||!!X.specularIntensityMap||!!X.specularColorMap||!!X.sheenColorMap||!!X.sheenRoughnessMap,uvsVertexOnly:!(!!X.map||!!X.bumpMap||!!X.normalMap||!!X.specularMap||!!X.alphaMap||!!X.emissiveMap||!!X.roughnessMap||!!X.metalnessMap||!!X.clearcoatNormalMap||X.transmission>0||!!X.transmissionMap||!!X.thicknessMap||!!X.specularIntensityMap||!!X.specularColorMap||X.sheen>0||!!X.sheenColorMap||!!X.sheenRoughnessMap)&&!!X.displacementMap,fog:!!C,useFog:X.fog===!0,fogExp2:C&&C.isFogExp2,flatShading:!!X.flatShading,sizeAttenuation:X.sizeAttenuation,logarithmicDepthBuffer:h,skinning:F.isSkinnedMesh===!0,morphTargets:A.morphAttributes.position!==void 0,morphNormals:A.morphAttributes.normal!==void 0,morphColors:A.morphAttributes.color!==void 0,morphTargetsCount:N,morphTextureStride:R,numDirLights:w.directional.length,numPointLights:w.point.length,numSpotLights:w.spot.length,numRectAreaLights:w.rectArea.length,numHemiLights:w.hemi.length,numDirLightShadows:w.directionalShadowMap.length,numPointLightShadows:w.pointShadowMap.length,numSpotLightShadows:w.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:X.dithering,shadowMapEnabled:c.shadowMap.enabled&&S.length>0,shadowMapType:c.shadowMap.type,toneMapping:X.toneMapped?c.toneMapping:Fn,physicallyCorrectLights:c.physicallyCorrectLights,premultipliedAlpha:X.premultipliedAlpha,doubleSided:X.side===ea,flipSided:X.side===Mn,useDepthPacking:!!X.depthPacking,depthPacking:X.depthPacking||0,index0AttributeName:X.index0AttributeName,extensionDerivatives:X.extensions&&X.extensions.derivatives,extensionFragDepth:X.extensions&&X.extensions.fragDepth,extensionDrawBuffers:X.extensions&&X.extensions.drawBuffers,extensionShaderTextureLOD:X.extensions&&X.extensions.shaderTextureLOD,rendererExtensionFragDepth:l||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:l||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:l||i.has("EXT_shader_texture_lod"),customProgramCacheKey:X.customProgramCacheKey()}}function p(X){const w=[];if(X.shaderID?w.push(X.shaderID):(w.push(X.customVertexShaderID),w.push(X.customFragmentShaderID)),X.defines!==void 0)for(const S in X.defines)w.push(S),w.push(X.defines[S]);return X.isRawShaderMaterial===!1&&(g(w,X),x(w,X),w.push(c.outputEncoding)),w.push(X.customProgramCacheKey),w.join()}function g(X,w){X.push(w.precision),X.push(w.outputEncoding),X.push(w.envMapMode),X.push(w.envMapCubeUVHeight),X.push(w.combine),X.push(w.vertexUvs),X.push(w.fogExp2),X.push(w.sizeAttenuation),X.push(w.morphTargetsCount),X.push(w.morphAttributeCount),X.push(w.numDirLights),X.push(w.numPointLights),X.push(w.numSpotLights),X.push(w.numHemiLights),X.push(w.numRectAreaLights),X.push(w.numDirLightShadows),X.push(w.numPointLightShadows),X.push(w.numSpotLightShadows),X.push(w.shadowMapType),X.push(w.toneMapping),X.push(w.numClippingPlanes),X.push(w.numClipIntersection),X.push(w.depthPacking)}function x(X,w){r.disableAll(),w.isWebGL2&&r.enable(0),w.supportsVertexTextures&&r.enable(1),w.instancing&&r.enable(2),w.instancingColor&&r.enable(3),w.map&&r.enable(4),w.matcap&&r.enable(5),w.envMap&&r.enable(6),w.lightMap&&r.enable(7),w.aoMap&&r.enable(8),w.emissiveMap&&r.enable(9),w.bumpMap&&r.enable(10),w.normalMap&&r.enable(11),w.objectSpaceNormalMap&&r.enable(12),w.tangentSpaceNormalMap&&r.enable(13),w.clearcoat&&r.enable(14),w.clearcoatMap&&r.enable(15),w.clearcoatRoughnessMap&&r.enable(16),w.clearcoatNormalMap&&r.enable(17),w.displacementMap&&r.enable(18),w.specularMap&&r.enable(19),w.roughnessMap&&r.enable(20),w.metalnessMap&&r.enable(21),w.gradientMap&&r.enable(22),w.alphaMap&&r.enable(23),w.alphaTest&&r.enable(24),w.vertexColors&&r.enable(25),w.vertexAlphas&&r.enable(26),w.vertexUvs&&r.enable(27),w.vertexTangents&&r.enable(28),w.uvsVertexOnly&&r.enable(29),w.fog&&r.enable(30),X.push(r.mask),r.disableAll(),w.useFog&&r.enable(0),w.flatShading&&r.enable(1),w.logarithmicDepthBuffer&&r.enable(2),w.skinning&&r.enable(3),w.morphTargets&&r.enable(4),w.morphNormals&&r.enable(5),w.morphColors&&r.enable(6),w.premultipliedAlpha&&r.enable(7),w.shadowMapEnabled&&r.enable(8),w.physicallyCorrectLights&&r.enable(9),w.doubleSided&&r.enable(10),w.flipSided&&r.enable(11),w.useDepthPacking&&r.enable(12),w.dithering&&r.enable(13),w.specularIntensityMap&&r.enable(14),w.specularColorMap&&r.enable(15),w.transmission&&r.enable(16),w.transmissionMap&&r.enable(17),w.thicknessMap&&r.enable(18),w.sheen&&r.enable(19),w.sheenColorMap&&r.enable(20),w.sheenRoughnessMap&&r.enable(21),w.decodeVideoTexture&&r.enable(22),w.opaque&&r.enable(23),X.push(r.mask)}function b(X){const w=m[X.type];let S;if(w){const V=Yn[w];S=rp.clone(V.uniforms)}else S=X.uniforms;return S}function y(X,w){let S;for(let V=0,F=a.length;V<F;V++){const C=a[V];if(C.cacheKey===w){S=C,++S.usedTimes;break}}return S===void 0&&(S=new c2(c,w,X,s),a.push(S)),S}function z(X){if(--X.usedTimes===0){const w=a.indexOf(X);a[w]=a[a.length-1],a.pop(),X.destroy()}}function M(X){_.remove(X)}function Y(){_.dispose()}return{getParameters:d,getProgramCacheKey:p,getUniforms:b,acquireProgram:y,releaseProgram:z,releaseShaderCache:M,programs:a,dispose:Y}}function d2(){let c=new WeakMap;function t(s){let o=c.get(s);return o===void 0&&(o={},c.set(s,o)),o}function e(s){c.delete(s)}function i(s,o,r){c.get(s)[o]=r}function n(){c=new WeakMap}return{get:t,remove:e,update:i,dispose:n}}function g2(c,t){return c.groupOrder!==t.groupOrder?c.groupOrder-t.groupOrder:c.renderOrder!==t.renderOrder?c.renderOrder-t.renderOrder:c.material.id!==t.material.id?c.material.id-t.material.id:c.z!==t.z?c.z-t.z:c.id-t.id}function gh(c,t){return c.groupOrder!==t.groupOrder?c.groupOrder-t.groupOrder:c.renderOrder!==t.renderOrder?c.renderOrder-t.renderOrder:c.z!==t.z?t.z-c.z:c.id-t.id}function xh(){const c=[];let t=0;const e=[],i=[],n=[];function s(){t=0,e.length=0,i.length=0,n.length=0}function o(h,u,f,m,d,p){let g=c[t];return g===void 0?(g={id:h.id,object:h,geometry:u,material:f,groupOrder:m,renderOrder:h.renderOrder,z:d,group:p},c[t]=g):(g.id=h.id,g.object=h,g.geometry=u,g.material=f,g.groupOrder=m,g.renderOrder=h.renderOrder,g.z=d,g.group=p),t++,g}function r(h,u,f,m,d,p){const g=o(h,u,f,m,d,p);f.transmission>0?i.push(g):f.transparent===!0?n.push(g):e.push(g)}function _(h,u,f,m,d,p){const g=o(h,u,f,m,d,p);f.transmission>0?i.unshift(g):f.transparent===!0?n.unshift(g):e.unshift(g)}function a(h,u){e.length>1&&e.sort(h||g2),i.length>1&&i.sort(u||gh),n.length>1&&n.sort(u||gh)}function l(){for(let h=t,u=c.length;h<u;h++){const f=c[h];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:e,transmissive:i,transparent:n,init:s,push:r,unshift:_,finish:l,sort:a}}function x2(){let c=new WeakMap;function t(i,n){let s;return c.has(i)===!1?(s=new xh,c.set(i,[s])):n>=c.get(i).length?(s=new xh,c.get(i).push(s)):s=c.get(i)[n],s}function e(){c=new WeakMap}return{get:t,dispose:e}}function v2(){const c={};return{get:function(t){if(c[t.id]!==void 0)return c[t.id];let e;switch(t.type){case"DirectionalLight":e={direction:new wt,color:new fi};break;case"SpotLight":e={position:new wt,direction:new wt,color:new fi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":e={position:new wt,color:new fi,distance:0,decay:0};break;case"HemisphereLight":e={direction:new wt,skyColor:new fi,groundColor:new fi};break;case"RectAreaLight":e={color:new fi,position:new wt,halfWidth:new wt,halfHeight:new wt};break}return c[t.id]=e,e}}}function b2(){const c={};return{get:function(t){if(c[t.id]!==void 0)return c[t.id];let e;switch(t.type){case"DirectionalLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ne};break;case"SpotLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ne};break;case"PointLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ne,shadowCameraNear:1,shadowCameraFar:1e3};break}return c[t.id]=e,e}}}let y2=0;function M2(c,t){return(t.castShadow?1:0)-(c.castShadow?1:0)}function w2(c,t){const e=new v2,i=b2(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let l=0;l<9;l++)n.probe.push(new wt);const s=new wt,o=new vi,r=new vi;function _(l,h){let u=0,f=0,m=0;for(let w=0;w<9;w++)n.probe[w].set(0,0,0);let d=0,p=0,g=0,x=0,b=0,y=0,z=0,M=0;l.sort(M2);const Y=h!==!0?Math.PI:1;for(let w=0,S=l.length;w<S;w++){const V=l[w],F=V.color,C=V.intensity,A=V.distance,Z=V.shadow&&V.shadow.map?V.shadow.map.texture:null;if(V.isAmbientLight)u+=F.r*C*Y,f+=F.g*C*Y,m+=F.b*C*Y;else if(V.isLightProbe)for(let L=0;L<9;L++)n.probe[L].addScaledVector(V.sh.coefficients[L],C);else if(V.isDirectionalLight){const L=e.get(V);if(L.color.copy(V.color).multiplyScalar(V.intensity*Y),V.castShadow){const E=V.shadow,T=i.get(V);T.shadowBias=E.bias,T.shadowNormalBias=E.normalBias,T.shadowRadius=E.radius,T.shadowMapSize=E.mapSize,n.directionalShadow[d]=T,n.directionalShadowMap[d]=Z,n.directionalShadowMatrix[d]=V.shadow.matrix,y++}n.directional[d]=L,d++}else if(V.isSpotLight){const L=e.get(V);if(L.position.setFromMatrixPosition(V.matrixWorld),L.color.copy(F).multiplyScalar(C*Y),L.distance=A,L.coneCos=Math.cos(V.angle),L.penumbraCos=Math.cos(V.angle*(1-V.penumbra)),L.decay=V.decay,V.castShadow){const E=V.shadow,T=i.get(V);T.shadowBias=E.bias,T.shadowNormalBias=E.normalBias,T.shadowRadius=E.radius,T.shadowMapSize=E.mapSize,n.spotShadow[g]=T,n.spotShadowMap[g]=Z,n.spotShadowMatrix[g]=V.shadow.matrix,M++}n.spot[g]=L,g++}else if(V.isRectAreaLight){const L=e.get(V);L.color.copy(F).multiplyScalar(C),L.halfWidth.set(V.width*.5,0,0),L.halfHeight.set(0,V.height*.5,0),n.rectArea[x]=L,x++}else if(V.isPointLight){const L=e.get(V);if(L.color.copy(V.color).multiplyScalar(V.intensity*Y),L.distance=V.distance,L.decay=V.decay,V.castShadow){const E=V.shadow,T=i.get(V);T.shadowBias=E.bias,T.shadowNormalBias=E.normalBias,T.shadowRadius=E.radius,T.shadowMapSize=E.mapSize,T.shadowCameraNear=E.camera.near,T.shadowCameraFar=E.camera.far,n.pointShadow[p]=T,n.pointShadowMap[p]=Z,n.pointShadowMatrix[p]=V.shadow.matrix,z++}n.point[p]=L,p++}else if(V.isHemisphereLight){const L=e.get(V);L.skyColor.copy(V.color).multiplyScalar(C*Y),L.groundColor.copy(V.groundColor).multiplyScalar(C*Y),n.hemi[b]=L,b++}}x>0&&(t.isWebGL2||c.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=ni.LTC_FLOAT_1,n.rectAreaLTC2=ni.LTC_FLOAT_2):c.has("OES_texture_half_float_linear")===!0?(n.rectAreaLTC1=ni.LTC_HALF_1,n.rectAreaLTC2=ni.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=u,n.ambient[1]=f,n.ambient[2]=m;const X=n.hash;(X.directionalLength!==d||X.pointLength!==p||X.spotLength!==g||X.rectAreaLength!==x||X.hemiLength!==b||X.numDirectionalShadows!==y||X.numPointShadows!==z||X.numSpotShadows!==M)&&(n.directional.length=d,n.spot.length=g,n.rectArea.length=x,n.point.length=p,n.hemi.length=b,n.directionalShadow.length=y,n.directionalShadowMap.length=y,n.pointShadow.length=z,n.pointShadowMap.length=z,n.spotShadow.length=M,n.spotShadowMap.length=M,n.directionalShadowMatrix.length=y,n.pointShadowMatrix.length=z,n.spotShadowMatrix.length=M,X.directionalLength=d,X.pointLength=p,X.spotLength=g,X.rectAreaLength=x,X.hemiLength=b,X.numDirectionalShadows=y,X.numPointShadows=z,X.numSpotShadows=M,n.version=y2++)}function a(l,h){let u=0,f=0,m=0,d=0,p=0;const g=h.matrixWorldInverse;for(let x=0,b=l.length;x<b;x++){const y=l[x];if(y.isDirectionalLight){const z=n.directional[u];z.direction.setFromMatrixPosition(y.matrixWorld),s.setFromMatrixPosition(y.target.matrixWorld),z.direction.sub(s),z.direction.transformDirection(g),u++}else if(y.isSpotLight){const z=n.spot[m];z.position.setFromMatrixPosition(y.matrixWorld),z.position.applyMatrix4(g),z.direction.setFromMatrixPosition(y.matrixWorld),s.setFromMatrixPosition(y.target.matrixWorld),z.direction.sub(s),z.direction.transformDirection(g),m++}else if(y.isRectAreaLight){const z=n.rectArea[d];z.position.setFromMatrixPosition(y.matrixWorld),z.position.applyMatrix4(g),r.identity(),o.copy(y.matrixWorld),o.premultiply(g),r.extractRotation(o),z.halfWidth.set(y.width*.5,0,0),z.halfHeight.set(0,y.height*.5,0),z.halfWidth.applyMatrix4(r),z.halfHeight.applyMatrix4(r),d++}else if(y.isPointLight){const z=n.point[f];z.position.setFromMatrixPosition(y.matrixWorld),z.position.applyMatrix4(g),f++}else if(y.isHemisphereLight){const z=n.hemi[p];z.direction.setFromMatrixPosition(y.matrixWorld),z.direction.transformDirection(g),p++}}}return{setup:_,setupView:a,state:n}}function vh(c,t){const e=new w2(c,t),i=[],n=[];function s(){i.length=0,n.length=0}function o(h){i.push(h)}function r(h){n.push(h)}function _(h){e.setup(i,h)}function a(h){e.setupView(i,h)}return{init:s,state:{lightsArray:i,shadowsArray:n,lights:e},setupLights:_,setupLightsView:a,pushLight:o,pushShadow:r}}function X2(c,t){let e=new WeakMap;function i(s,o=0){let r;return e.has(s)===!1?(r=new vh(c,t),e.set(s,[r])):o>=e.get(s).length?(r=new vh(c,t),e.get(s).push(r)):r=e.get(s)[o],r}function n(){e=new WeakMap}return{get:i,dispose:n}}class Tl extends Gi{constructor(t){super(),this.type="MeshDepthMaterial",this.depthPacking=Nu,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}Tl.prototype.isMeshDepthMaterial=!0;class Vl extends Gi{constructor(t){super(),this.type="MeshDistanceMaterial",this.referencePosition=new wt,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}Vl.prototype.isMeshDistanceMaterial=!0;const I2=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,z2=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Ic(c,t,e){let i=new ir;const n=new Ne,s=new Ne,o=new Li,r=new Tl({depthPacking:Fu}),_=new Vl,a={},l=e.maxTextureSize,h={0:Mn,1:Da,2:ea},u=new wn({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ne},radius:{value:4}},vertexShader:I2,fragmentShader:z2}),f=u.clone();f.defines.HORIZONTAL_PASS=1;const m=new Ei;m.setAttribute("position",new Bi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const d=new sn(m,u),p=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=oc,this.render=function(y,z,M){if(p.enabled===!1||p.autoUpdate===!1&&p.needsUpdate===!1||y.length===0)return;const Y=c.getRenderTarget(),X=c.getActiveCubeFace(),w=c.getActiveMipmapLevel(),S=c.state;S.setBlending(Ln),S.buffers.color.setClear(1,1,1,1),S.buffers.depth.setTest(!0),S.setScissorTest(!1);for(let V=0,F=y.length;V<F;V++){const C=y[V],A=C.shadow;if(A===void 0){console.warn("THREE.WebGLShadowMap:",C,"has no shadow.");continue}if(A.autoUpdate===!1&&A.needsUpdate===!1)continue;n.copy(A.mapSize);const Z=A.getFrameExtents();if(n.multiply(Z),s.copy(A.mapSize),(n.x>l||n.y>l)&&(n.x>l&&(s.x=Math.floor(l/Z.x),n.x=s.x*Z.x,A.mapSize.x=s.x),n.y>l&&(s.y=Math.floor(l/Z.y),n.y=s.y*Z.y,A.mapSize.y=s.y)),A.map===null&&!A.isPointLightShadow&&this.type===La&&(A.map=new ln(n.x,n.y),A.map.texture.name=C.name+".shadowMap",A.mapPass=new ln(n.x,n.y),A.camera.updateProjectionMatrix()),A.map===null){const E={minFilter:ji,magFilter:ji,format:vn};A.map=new ln(n.x,n.y,E),A.map.texture.name=C.name+".shadowMap",A.camera.updateProjectionMatrix()}c.setRenderTarget(A.map),c.clear();const L=A.getViewportCount();for(let E=0;E<L;E++){const T=A.getViewport(E);o.set(s.x*T.x,s.y*T.y,s.x*T.z,s.y*T.w),S.viewport(o),A.updateMatrices(C,E),i=A.getFrustum(),b(z,M,A.camera,C,this.type)}!A.isPointLightShadow&&this.type===La&&g(A,M),A.needsUpdate=!1}p.needsUpdate=!1,c.setRenderTarget(Y,X,w)};function g(y,z){const M=t.update(d);u.defines.VSM_SAMPLES!==y.blurSamples&&(u.defines.VSM_SAMPLES=y.blurSamples,f.defines.VSM_SAMPLES=y.blurSamples,u.needsUpdate=!0,f.needsUpdate=!0),u.uniforms.shadow_pass.value=y.map.texture,u.uniforms.resolution.value=y.mapSize,u.uniforms.radius.value=y.radius,c.setRenderTarget(y.mapPass),c.clear(),c.renderBufferDirect(z,null,M,u,d,null),f.uniforms.shadow_pass.value=y.mapPass.texture,f.uniforms.resolution.value=y.mapSize,f.uniforms.radius.value=y.radius,c.setRenderTarget(y.map),c.clear(),c.renderBufferDirect(z,null,M,f,d,null)}function x(y,z,M,Y,X,w){let S=null;const V=M.isPointLight===!0?y.customDistanceMaterial:y.customDepthMaterial;if(V!==void 0?S=V:S=M.isPointLight===!0?_:r,c.localClippingEnabled&&z.clipShadows===!0&&z.clippingPlanes.length!==0||z.displacementMap&&z.displacementScale!==0||z.alphaMap&&z.alphaTest>0){const F=S.uuid,C=z.uuid;let A=a[F];A===void 0&&(A={},a[F]=A);let Z=A[C];Z===void 0&&(Z=S.clone(),A[C]=Z),S=Z}return S.visible=z.visible,S.wireframe=z.wireframe,w===La?S.side=z.shadowSide!==null?z.shadowSide:z.side:S.side=z.shadowSide!==null?z.shadowSide:h[z.side],S.alphaMap=z.alphaMap,S.alphaTest=z.alphaTest,S.clipShadows=z.clipShadows,S.clippingPlanes=z.clippingPlanes,S.clipIntersection=z.clipIntersection,S.displacementMap=z.displacementMap,S.displacementScale=z.displacementScale,S.displacementBias=z.displacementBias,S.wireframeLinewidth=z.wireframeLinewidth,S.linewidth=z.linewidth,M.isPointLight===!0&&S.isMeshDistanceMaterial===!0&&(S.referencePosition.setFromMatrixPosition(M.matrixWorld),S.nearDistance=Y,S.farDistance=X),S}function b(y,z,M,Y,X){if(y.visible===!1)return;if(y.layers.test(z.layers)&&(y.isMesh||y.isLine||y.isPoints)&&(y.castShadow||y.receiveShadow&&X===La)&&(!y.frustumCulled||i.intersectsObject(y))){y.modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,y.matrixWorld);const V=t.update(y),F=y.material;if(Array.isArray(F)){const C=V.groups;for(let A=0,Z=C.length;A<Z;A++){const L=C[A],E=F[L.materialIndex];if(E&&E.visible){const T=x(y,E,Y,M.near,M.far,X);c.renderBufferDirect(M,null,V,T,y,L)}}}else if(F.visible){const C=x(y,F,Y,M.near,M.far,X);c.renderBufferDirect(M,null,V,C,y,null)}}const S=y.children;for(let V=0,F=S.length;V<F;V++)b(S[V],z,M,Y,X)}}function S2(c,t,e){const i=e.isWebGL2;function n(){let st=!1;const ct=new Li;let _t=null;const Vt=new Li(0,0,0,0);return{setMask:function(At){_t!==At&&!st&&(c.colorMask(At,At,At,At),_t=At)},setLocked:function(At){st=At},setClear:function(At,St,Xt,Ft,ie){ie===!0&&(At*=Ft,St*=Ft,Xt*=Ft),ct.set(At,St,Xt,Ft),Vt.equals(ct)===!1&&(c.clearColor(At,St,Xt,Ft),Vt.copy(ct))},reset:function(){st=!1,_t=null,Vt.set(-1,0,0,0)}}}function s(){let st=!1,ct=null,_t=null,Vt=null;return{setTest:function(At){At?D(2929):B(2929)},setMask:function(At){ct!==At&&!st&&(c.depthMask(At),ct=At)},setFunc:function(At){if(_t!==At){if(At)switch(At){case ru:c.depthFunc(512);break;case lu:c.depthFunc(519);break;case _u:c.depthFunc(513);break;case al:c.depthFunc(515);break;case hu:c.depthFunc(514);break;case cu:c.depthFunc(518);break;case uu:c.depthFunc(516);break;case pu:c.depthFunc(517);break;default:c.depthFunc(515)}else c.depthFunc(515);_t=At}},setLocked:function(At){st=At},setClear:function(At){Vt!==At&&(c.clearDepth(At),Vt=At)},reset:function(){st=!1,ct=null,_t=null,Vt=null}}}function o(){let st=!1,ct=null,_t=null,Vt=null,At=null,St=null,Xt=null,Ft=null,ie=null;return{setTest:function(ee){st||(ee?D(2960):B(2960))},setMask:function(ee){ct!==ee&&!st&&(c.stencilMask(ee),ct=ee)},setFunc:function(ee,Ye,Ie){(_t!==ee||Vt!==Ye||At!==Ie)&&(c.stencilFunc(ee,Ye,Ie),_t=ee,Vt=Ye,At=Ie)},setOp:function(ee,Ye,Ie){(St!==ee||Xt!==Ye||Ft!==Ie)&&(c.stencilOp(ee,Ye,Ie),St=ee,Xt=Ye,Ft=Ie)},setLocked:function(ee){st=ee},setClear:function(ee){ie!==ee&&(c.clearStencil(ee),ie=ee)},reset:function(){st=!1,ct=null,_t=null,Vt=null,At=null,St=null,Xt=null,Ft=null,ie=null}}}const r=new n,_=new s,a=new o;let l={},h={},u=new WeakMap,f=[],m=null,d=!1,p=null,g=null,x=null,b=null,y=null,z=null,M=null,Y=!1,X=null,w=null,S=null,V=null,F=null;const C=c.getParameter(35661);let A=!1,Z=0;const L=c.getParameter(7938);L.indexOf("WebGL")!==-1?(Z=parseFloat(/^WebGL (\d)/.exec(L)[1]),A=Z>=1):L.indexOf("OpenGL ES")!==-1&&(Z=parseFloat(/^OpenGL ES (\d)/.exec(L)[1]),A=Z>=2);let E=null,T={};const P=c.getParameter(3088),N=c.getParameter(2978),R=new Li().fromArray(P),k=new Li().fromArray(N);function O(st,ct,_t){const Vt=new Uint8Array(4),At=c.createTexture();c.bindTexture(st,At),c.texParameteri(st,10241,9728),c.texParameteri(st,10240,9728);for(let St=0;St<_t;St++)c.texImage2D(ct+St,0,6408,1,1,0,6408,5121,Vt);return At}const v={};v[3553]=O(3553,3553,1),v[34067]=O(34067,34069,6),r.setClear(0,0,0,1),_.setClear(1),a.setClear(0),D(2929),_.setFunc(al),it(!1),et(c_),D(2884),H(Ln);function D(st){l[st]!==!0&&(c.enable(st),l[st]=!0)}function B(st){l[st]!==!1&&(c.disable(st),l[st]=!1)}function U(st,ct){return h[st]!==ct?(c.bindFramebuffer(st,ct),h[st]=ct,i&&(st===36009&&(h[36160]=ct),st===36160&&(h[36009]=ct)),!0):!1}function q(st,ct){let _t=f,Vt=!1;if(st)if(_t=u.get(ct),_t===void 0&&(_t=[],u.set(ct,_t)),st.isWebGLMultipleRenderTargets){const At=st.texture;if(_t.length!==At.length||_t[0]!==36064){for(let St=0,Xt=At.length;St<Xt;St++)_t[St]=36064+St;_t.length=At.length,Vt=!0}}else _t[0]!==36064&&(_t[0]=36064,Vt=!0);else _t[0]!==1029&&(_t[0]=1029,Vt=!0);Vt&&(e.isWebGL2?c.drawBuffers(_t):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(_t))}function tt(st){return m!==st?(c.useProgram(st),m=st,!0):!1}const Q={[Gs]:32774,[J1]:32778,[$1]:32779};if(i)Q[f_]=32775,Q[d_]=32776;else{const st=t.get("EXT_blend_minmax");st!==null&&(Q[f_]=st.MIN_EXT,Q[d_]=st.MAX_EXT)}const nt={[K1]:0,[Q1]:1,[tu]:768,[lc]:770,[ou]:776,[su]:774,[iu]:772,[eu]:769,[_c]:771,[au]:775,[nu]:773};function H(st,ct,_t,Vt,At,St,Xt,Ft){if(st===Ln){d===!0&&(B(3042),d=!1);return}if(d===!1&&(D(3042),d=!0),st!==q1){if(st!==p||Ft!==Y){if((g!==Gs||y!==Gs)&&(c.blendEquation(32774),g=Gs,y=Gs),Ft)switch(st){case Qs:c.blendFuncSeparate(1,771,1,771);break;case u_:c.blendFunc(1,1);break;case p_:c.blendFuncSeparate(0,769,0,1);break;case m_:c.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",st);break}else switch(st){case Qs:c.blendFuncSeparate(770,771,1,771);break;case u_:c.blendFunc(770,1);break;case p_:c.blendFuncSeparate(0,769,0,1);break;case m_:c.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",st);break}x=null,b=null,z=null,M=null,p=st,Y=Ft}return}At=At||ct,St=St||_t,Xt=Xt||Vt,(ct!==g||At!==y)&&(c.blendEquationSeparate(Q[ct],Q[At]),g=ct,y=At),(_t!==x||Vt!==b||St!==z||Xt!==M)&&(c.blendFuncSeparate(nt[_t],nt[Vt],nt[St],nt[Xt]),x=_t,b=Vt,z=St,M=Xt),p=st,Y=null}function j(st,ct){st.side===ea?B(2884):D(2884);let _t=st.side===Mn;ct&&(_t=!_t),it(_t),st.blending===Qs&&st.transparent===!1?H(Ln):H(st.blending,st.blendEquation,st.blendSrc,st.blendDst,st.blendEquationAlpha,st.blendSrcAlpha,st.blendDstAlpha,st.premultipliedAlpha),_.setFunc(st.depthFunc),_.setTest(st.depthTest),_.setMask(st.depthWrite),r.setMask(st.colorWrite);const Vt=st.stencilWrite;a.setTest(Vt),Vt&&(a.setMask(st.stencilWriteMask),a.setFunc(st.stencilFunc,st.stencilRef,st.stencilFuncMask),a.setOp(st.stencilFail,st.stencilZFail,st.stencilZPass)),W(st.polygonOffset,st.polygonOffsetFactor,st.polygonOffsetUnits),st.alphaToCoverage===!0?D(32926):B(32926)}function it(st){X!==st&&(st?c.frontFace(2304):c.frontFace(2305),X=st)}function et(st){st!==H1?(D(2884),st!==w&&(st===c_?c.cullFace(1029):st===W1?c.cullFace(1028):c.cullFace(1032))):B(2884),w=st}function G(st){st!==S&&(A&&c.lineWidth(st),S=st)}function W(st,ct,_t){st?(D(32823),(V!==ct||F!==_t)&&(c.polygonOffset(ct,_t),V=ct,F=_t)):B(32823)}function lt(st){st?D(3089):B(3089)}function ht(st){st===void 0&&(st=33984+C-1),E!==st&&(c.activeTexture(st),E=st)}function ft(st,ct){E===null&&ht();let _t=T[E];_t===void 0&&(_t={type:void 0,texture:void 0},T[E]=_t),(_t.type!==st||_t.texture!==ct)&&(c.bindTexture(st,ct||v[st]),_t.type=st,_t.texture=ct)}function pt(){const st=T[E];st!==void 0&&st.type!==void 0&&(c.bindTexture(st.type,null),st.type=void 0,st.texture=void 0)}function K(){try{c.compressedTexImage2D.apply(c,arguments)}catch(st){console.error("THREE.WebGLState:",st)}}function J(){try{c.texSubImage2D.apply(c,arguments)}catch(st){console.error("THREE.WebGLState:",st)}}function rt(){try{c.texSubImage3D.apply(c,arguments)}catch(st){console.error("THREE.WebGLState:",st)}}function mt(){try{c.compressedTexSubImage2D.apply(c,arguments)}catch(st){console.error("THREE.WebGLState:",st)}}function xt(){try{c.texStorage2D.apply(c,arguments)}catch(st){console.error("THREE.WebGLState:",st)}}function vt(){try{c.texStorage3D.apply(c,arguments)}catch(st){console.error("THREE.WebGLState:",st)}}function Mt(){try{c.texImage2D.apply(c,arguments)}catch(st){console.error("THREE.WebGLState:",st)}}function ut(){try{c.texImage3D.apply(c,arguments)}catch(st){console.error("THREE.WebGLState:",st)}}function Zt(st){R.equals(st)===!1&&(c.scissor(st.x,st.y,st.z,st.w),R.copy(st))}function zt(st){k.equals(st)===!1&&(c.viewport(st.x,st.y,st.z,st.w),k.copy(st))}function dt(){c.disable(3042),c.disable(2884),c.disable(2929),c.disable(32823),c.disable(3089),c.disable(2960),c.disable(32926),c.blendEquation(32774),c.blendFunc(1,0),c.blendFuncSeparate(1,0,1,0),c.colorMask(!0,!0,!0,!0),c.clearColor(0,0,0,0),c.depthMask(!0),c.depthFunc(513),c.clearDepth(1),c.stencilMask(4294967295),c.stencilFunc(519,0,4294967295),c.stencilOp(7680,7680,7680),c.clearStencil(0),c.cullFace(1029),c.frontFace(2305),c.polygonOffset(0,0),c.activeTexture(33984),c.bindFramebuffer(36160,null),i===!0&&(c.bindFramebuffer(36009,null),c.bindFramebuffer(36008,null)),c.useProgram(null),c.lineWidth(1),c.scissor(0,0,c.canvas.width,c.canvas.height),c.viewport(0,0,c.canvas.width,c.canvas.height),l={},E=null,T={},h={},u=new WeakMap,f=[],m=null,d=!1,p=null,g=null,x=null,b=null,y=null,z=null,M=null,Y=!1,X=null,w=null,S=null,V=null,F=null,R.set(0,0,c.canvas.width,c.canvas.height),k.set(0,0,c.canvas.width,c.canvas.height),r.reset(),_.reset(),a.reset()}return{buffers:{color:r,depth:_,stencil:a},enable:D,disable:B,bindFramebuffer:U,drawBuffers:q,useProgram:tt,setBlending:H,setMaterial:j,setFlipSided:it,setCullFace:et,setLineWidth:G,setPolygonOffset:W,setScissorTest:lt,activeTexture:ht,bindTexture:ft,unbindTexture:pt,compressedTexImage2D:K,texImage2D:Mt,texImage3D:ut,texStorage2D:xt,texStorage3D:vt,texSubImage2D:J,texSubImage3D:rt,compressedTexSubImage2D:mt,scissor:Zt,viewport:zt,reset:dt}}function Y2(c,t,e,i,n,s,o){const r=n.isWebGL2,_=n.maxTextures,a=n.maxCubemapSize,l=n.maxTextureSize,h=n.maxSamples,u=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,f=/OculusBrowser/g.test(navigator.userAgent),m=new WeakMap;let d;const p=new WeakMap;let g=!1;try{g=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function x(K,J){return g?new OffscreenCanvas(K,J):Ua("canvas")}function b(K,J,rt,mt){let xt=1;if((K.width>mt||K.height>mt)&&(xt=mt/Math.max(K.width,K.height)),xt<1||J===!0)if(typeof HTMLImageElement!="undefined"&&K instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&K instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&K instanceof ImageBitmap){const vt=J?ul:Math.floor,Mt=vt(xt*K.width),ut=vt(xt*K.height);d===void 0&&(d=x(Mt,ut));const Zt=rt?x(Mt,ut):d;return Zt.width=Mt,Zt.height=ut,Zt.getContext("2d").drawImage(K,0,0,Mt,ut),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+K.width+"x"+K.height+") to ("+Mt+"x"+ut+")."),Zt}else return"data"in K&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+K.width+"x"+K.height+")."),K;return K}function y(K){return D_(K.width)&&D_(K.height)}function z(K){return r?!1:K.wrapS!==xn||K.wrapT!==xn||K.minFilter!==ji&&K.minFilter!==rn}function M(K,J){return K.generateMipmaps&&J&&K.minFilter!==ji&&K.minFilter!==rn}function Y(K){c.generateMipmap(K)}function X(K,J,rt,mt,xt=!1){if(r===!1)return J;if(K!==null){if(c[K]!==void 0)return c[K];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+K+"'")}let vt=J;return J===6403&&(rt===5126&&(vt=33326),rt===5131&&(vt=33325),rt===5121&&(vt=33321)),J===33319&&(rt===5126&&(vt=33328),rt===5131&&(vt=33327),rt===5121&&(vt=33323)),J===6408&&(rt===5126&&(vt=34836),rt===5131&&(vt=34842),rt===5121&&(vt=mt===Ci&&xt===!1?35907:32856),rt===32819&&(vt=32854),rt===32820&&(vt=32855)),(vt===33325||vt===33326||vt===33327||vt===33328||vt===34842||vt===34836)&&t.get("EXT_color_buffer_float"),vt}function w(K,J,rt){return M(K,rt)===!0||K.isFramebufferTexture&&K.minFilter!==ji&&K.minFilter!==rn?Math.log2(Math.max(J.width,J.height))+1:K.mipmaps!==void 0&&K.mipmaps.length>0?K.mipmaps.length:K.isCompressedTexture&&Array.isArray(K.image)?J.mipmaps.length:1}function S(K){return K===ji||K===g_||K===x_?9728:9729}function V(K){const J=K.target;J.removeEventListener("dispose",V),C(J),J.isVideoTexture&&m.delete(J)}function F(K){const J=K.target;J.removeEventListener("dispose",F),Z(J)}function C(K){const J=i.get(K);if(J.__webglInit===void 0)return;const rt=K.source,mt=p.get(rt);if(mt){const xt=mt[J.__cacheKey];xt.usedTimes--,xt.usedTimes===0&&A(K),Object.keys(mt).length===0&&p.delete(rt)}i.remove(K)}function A(K){const J=i.get(K);c.deleteTexture(J.__webglTexture);const rt=K.source,mt=p.get(rt);delete mt[J.__cacheKey],o.memory.textures--}function Z(K){const J=K.texture,rt=i.get(K),mt=i.get(J);if(mt.__webglTexture!==void 0&&(c.deleteTexture(mt.__webglTexture),o.memory.textures--),K.depthTexture&&K.depthTexture.dispose(),K.isWebGLCubeRenderTarget)for(let xt=0;xt<6;xt++)c.deleteFramebuffer(rt.__webglFramebuffer[xt]),rt.__webglDepthbuffer&&c.deleteRenderbuffer(rt.__webglDepthbuffer[xt]);else c.deleteFramebuffer(rt.__webglFramebuffer),rt.__webglDepthbuffer&&c.deleteRenderbuffer(rt.__webglDepthbuffer),rt.__webglMultisampledFramebuffer&&c.deleteFramebuffer(rt.__webglMultisampledFramebuffer),rt.__webglColorRenderbuffer&&c.deleteRenderbuffer(rt.__webglColorRenderbuffer),rt.__webglDepthRenderbuffer&&c.deleteRenderbuffer(rt.__webglDepthRenderbuffer);if(K.isWebGLMultipleRenderTargets)for(let xt=0,vt=J.length;xt<vt;xt++){const Mt=i.get(J[xt]);Mt.__webglTexture&&(c.deleteTexture(Mt.__webglTexture),o.memory.textures--),i.remove(J[xt])}i.remove(J),i.remove(K)}let L=0;function E(){L=0}function T(){const K=L;return K>=_&&console.warn("THREE.WebGLTextures: Trying to use "+K+" texture units while this GPU supports only "+_),L+=1,K}function P(K){const J=[];return J.push(K.wrapS),J.push(K.wrapT),J.push(K.magFilter),J.push(K.minFilter),J.push(K.anisotropy),J.push(K.internalFormat),J.push(K.format),J.push(K.type),J.push(K.generateMipmaps),J.push(K.premultiplyAlpha),J.push(K.flipY),J.push(K.unpackAlignment),J.push(K.encoding),J.join()}function N(K,J){const rt=i.get(K);if(K.isVideoTexture&&ft(K),K.isRenderTargetTexture===!1&&K.version>0&&rt.__version!==K.version){const mt=K.image;if(mt===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(mt.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{q(rt,K,J);return}}e.activeTexture(33984+J),e.bindTexture(3553,rt.__webglTexture)}function R(K,J){const rt=i.get(K);if(K.version>0&&rt.__version!==K.version){q(rt,K,J);return}e.activeTexture(33984+J),e.bindTexture(35866,rt.__webglTexture)}function k(K,J){const rt=i.get(K);if(K.version>0&&rt.__version!==K.version){q(rt,K,J);return}e.activeTexture(33984+J),e.bindTexture(32879,rt.__webglTexture)}function O(K,J){const rt=i.get(K);if(K.version>0&&rt.__version!==K.version){tt(rt,K,J);return}e.activeTexture(33984+J),e.bindTexture(34067,rt.__webglTexture)}const v={[ll]:10497,[xn]:33071,[_l]:33648},D={[ji]:9728,[g_]:9984,[x_]:9986,[rn]:9729,[yu]:9985,[Ko]:9987};function B(K,J,rt){if(rt?(c.texParameteri(K,10242,v[J.wrapS]),c.texParameteri(K,10243,v[J.wrapT]),(K===32879||K===35866)&&c.texParameteri(K,32882,v[J.wrapR]),c.texParameteri(K,10240,D[J.magFilter]),c.texParameteri(K,10241,D[J.minFilter])):(c.texParameteri(K,10242,33071),c.texParameteri(K,10243,33071),(K===32879||K===35866)&&c.texParameteri(K,32882,33071),(J.wrapS!==xn||J.wrapT!==xn)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),c.texParameteri(K,10240,S(J.magFilter)),c.texParameteri(K,10241,S(J.minFilter)),J.minFilter!==ji&&J.minFilter!==rn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),t.has("EXT_texture_filter_anisotropic")===!0){const mt=t.get("EXT_texture_filter_anisotropic");if(J.type===ms&&t.has("OES_texture_float_linear")===!1||r===!1&&J.type===Fa&&t.has("OES_texture_half_float_linear")===!1)return;(J.anisotropy>1||i.get(J).__currentAnisotropy)&&(c.texParameterf(K,mt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(J.anisotropy,n.getMaxAnisotropy())),i.get(J).__currentAnisotropy=J.anisotropy)}}function U(K,J){let rt=!1;K.__webglInit===void 0&&(K.__webglInit=!0,J.addEventListener("dispose",V));const mt=J.source;let xt=p.get(mt);xt===void 0&&(xt={},p.set(mt,xt));const vt=P(J);if(vt!==K.__cacheKey){xt[vt]===void 0&&(xt[vt]={texture:c.createTexture(),usedTimes:0},o.memory.textures++,rt=!0),xt[vt].usedTimes++;const Mt=xt[K.__cacheKey];Mt!==void 0&&(xt[K.__cacheKey].usedTimes--,Mt.usedTimes===0&&A(J)),K.__cacheKey=vt,K.__webglTexture=xt[vt].texture}return rt}function q(K,J,rt){let mt=3553;J.isDataArrayTexture&&(mt=35866),J.isData3DTexture&&(mt=32879);const xt=U(K,J),vt=J.source;if(e.activeTexture(33984+rt),e.bindTexture(mt,K.__webglTexture),vt.version!==vt.__currentVersion||xt===!0){c.pixelStorei(37440,J.flipY),c.pixelStorei(37441,J.premultiplyAlpha),c.pixelStorei(3317,J.unpackAlignment),c.pixelStorei(37443,0);const Mt=z(J)&&y(J.image)===!1;let ut=b(J.image,Mt,!1,l);ut=pt(J,ut);const Zt=y(ut)||r,zt=s.convert(J.format,J.encoding);let dt=s.convert(J.type),st=X(J.internalFormat,zt,dt,J.encoding,J.isVideoTexture);B(mt,J,Zt);let ct;const _t=J.mipmaps,Vt=r&&J.isVideoTexture!==!0,At=K.__version===void 0||xt===!0,St=w(J,ut,Zt);if(J.isDepthTexture)st=6402,r?J.type===ms?st=36012:J.type===Co?st=33190:J.type===ta?st=35056:st=33189:J.type===ms&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),J.format===gs&&st===6402&&J.type!==Na&&J.type!==Co&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),J.type=Na,dt=s.convert(J.type)),J.format===sa&&st===6402&&(st=34041,J.type!==ta&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),J.type=ta,dt=s.convert(J.type))),At&&(Vt?e.texStorage2D(3553,1,st,ut.width,ut.height):e.texImage2D(3553,0,st,ut.width,ut.height,0,zt,dt,null));else if(J.isDataTexture)if(_t.length>0&&Zt){Vt&&At&&e.texStorage2D(3553,St,st,_t[0].width,_t[0].height);for(let Xt=0,Ft=_t.length;Xt<Ft;Xt++)ct=_t[Xt],Vt?e.texSubImage2D(3553,Xt,0,0,ct.width,ct.height,zt,dt,ct.data):e.texImage2D(3553,Xt,st,ct.width,ct.height,0,zt,dt,ct.data);J.generateMipmaps=!1}else Vt?(At&&e.texStorage2D(3553,St,st,ut.width,ut.height),e.texSubImage2D(3553,0,0,0,ut.width,ut.height,zt,dt,ut.data)):e.texImage2D(3553,0,st,ut.width,ut.height,0,zt,dt,ut.data);else if(J.isCompressedTexture){Vt&&At&&e.texStorage2D(3553,St,st,_t[0].width,_t[0].height);for(let Xt=0,Ft=_t.length;Xt<Ft;Xt++)ct=_t[Xt],J.format!==vn?zt!==null?Vt?e.compressedTexSubImage2D(3553,Xt,0,0,ct.width,ct.height,zt,ct.data):e.compressedTexImage2D(3553,Xt,st,ct.width,ct.height,0,ct.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Vt?e.texSubImage2D(3553,Xt,0,0,ct.width,ct.height,zt,dt,ct.data):e.texImage2D(3553,Xt,st,ct.width,ct.height,0,zt,dt,ct.data)}else if(J.isDataArrayTexture)Vt?(At&&e.texStorage3D(35866,St,st,ut.width,ut.height,ut.depth),e.texSubImage3D(35866,0,0,0,0,ut.width,ut.height,ut.depth,zt,dt,ut.data)):e.texImage3D(35866,0,st,ut.width,ut.height,ut.depth,0,zt,dt,ut.data);else if(J.isData3DTexture)Vt?(At&&e.texStorage3D(32879,St,st,ut.width,ut.height,ut.depth),e.texSubImage3D(32879,0,0,0,0,ut.width,ut.height,ut.depth,zt,dt,ut.data)):e.texImage3D(32879,0,st,ut.width,ut.height,ut.depth,0,zt,dt,ut.data);else if(J.isFramebufferTexture){if(At)if(Vt)e.texStorage2D(3553,St,st,ut.width,ut.height);else{let Xt=ut.width,Ft=ut.height;for(let ie=0;ie<St;ie++)e.texImage2D(3553,ie,st,Xt,Ft,0,zt,dt,null),Xt>>=1,Ft>>=1}}else if(_t.length>0&&Zt){Vt&&At&&e.texStorage2D(3553,St,st,_t[0].width,_t[0].height);for(let Xt=0,Ft=_t.length;Xt<Ft;Xt++)ct=_t[Xt],Vt?e.texSubImage2D(3553,Xt,0,0,zt,dt,ct):e.texImage2D(3553,Xt,st,zt,dt,ct);J.generateMipmaps=!1}else Vt?(At&&e.texStorage2D(3553,St,st,ut.width,ut.height),e.texSubImage2D(3553,0,0,0,zt,dt,ut)):e.texImage2D(3553,0,st,zt,dt,ut);M(J,Zt)&&Y(mt),vt.__currentVersion=vt.version,J.onUpdate&&J.onUpdate(J)}K.__version=J.version}function tt(K,J,rt){if(J.image.length!==6)return;const mt=U(K,J),xt=J.source;if(e.activeTexture(33984+rt),e.bindTexture(34067,K.__webglTexture),xt.version!==xt.__currentVersion||mt===!0){c.pixelStorei(37440,J.flipY),c.pixelStorei(37441,J.premultiplyAlpha),c.pixelStorei(3317,J.unpackAlignment),c.pixelStorei(37443,0);const vt=J.isCompressedTexture||J.image[0].isCompressedTexture,Mt=J.image[0]&&J.image[0].isDataTexture,ut=[];for(let Xt=0;Xt<6;Xt++)!vt&&!Mt?ut[Xt]=b(J.image[Xt],!1,!0,a):ut[Xt]=Mt?J.image[Xt].image:J.image[Xt],ut[Xt]=pt(J,ut[Xt]);const Zt=ut[0],zt=y(Zt)||r,dt=s.convert(J.format,J.encoding),st=s.convert(J.type),ct=X(J.internalFormat,dt,st,J.encoding),_t=r&&J.isVideoTexture!==!0,Vt=K.__version===void 0;let At=w(J,Zt,zt);B(34067,J,zt);let St;if(vt){_t&&Vt&&e.texStorage2D(34067,At,ct,Zt.width,Zt.height);for(let Xt=0;Xt<6;Xt++){St=ut[Xt].mipmaps;for(let Ft=0;Ft<St.length;Ft++){const ie=St[Ft];J.format!==vn?dt!==null?_t?e.compressedTexSubImage2D(34069+Xt,Ft,0,0,ie.width,ie.height,dt,ie.data):e.compressedTexImage2D(34069+Xt,Ft,ct,ie.width,ie.height,0,ie.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):_t?e.texSubImage2D(34069+Xt,Ft,0,0,ie.width,ie.height,dt,st,ie.data):e.texImage2D(34069+Xt,Ft,ct,ie.width,ie.height,0,dt,st,ie.data)}}}else{St=J.mipmaps,_t&&Vt&&(St.length>0&&At++,e.texStorage2D(34067,At,ct,ut[0].width,ut[0].height));for(let Xt=0;Xt<6;Xt++)if(Mt){_t?e.texSubImage2D(34069+Xt,0,0,0,ut[Xt].width,ut[Xt].height,dt,st,ut[Xt].data):e.texImage2D(34069+Xt,0,ct,ut[Xt].width,ut[Xt].height,0,dt,st,ut[Xt].data);for(let Ft=0;Ft<St.length;Ft++){const ee=St[Ft].image[Xt].image;_t?e.texSubImage2D(34069+Xt,Ft+1,0,0,ee.width,ee.height,dt,st,ee.data):e.texImage2D(34069+Xt,Ft+1,ct,ee.width,ee.height,0,dt,st,ee.data)}}else{_t?e.texSubImage2D(34069+Xt,0,0,0,dt,st,ut[Xt]):e.texImage2D(34069+Xt,0,ct,dt,st,ut[Xt]);for(let Ft=0;Ft<St.length;Ft++){const ie=St[Ft];_t?e.texSubImage2D(34069+Xt,Ft+1,0,0,dt,st,ie.image[Xt]):e.texImage2D(34069+Xt,Ft+1,ct,dt,st,ie.image[Xt])}}}M(J,zt)&&Y(34067),xt.__currentVersion=xt.version,J.onUpdate&&J.onUpdate(J)}K.__version=J.version}function Q(K,J,rt,mt,xt){const vt=s.convert(rt.format,rt.encoding),Mt=s.convert(rt.type),ut=X(rt.internalFormat,vt,Mt,rt.encoding);i.get(J).__hasExternalTextures||(xt===32879||xt===35866?e.texImage3D(xt,0,ut,J.width,J.height,J.depth,0,vt,Mt,null):e.texImage2D(xt,0,ut,J.width,J.height,0,vt,Mt,null)),e.bindFramebuffer(36160,K),ht(J)?u.framebufferTexture2DMultisampleEXT(36160,mt,xt,i.get(rt).__webglTexture,0,lt(J)):c.framebufferTexture2D(36160,mt,xt,i.get(rt).__webglTexture,0),e.bindFramebuffer(36160,null)}function nt(K,J,rt){if(c.bindRenderbuffer(36161,K),J.depthBuffer&&!J.stencilBuffer){let mt=33189;if(rt||ht(J)){const xt=J.depthTexture;xt&&xt.isDepthTexture&&(xt.type===ms?mt=36012:xt.type===Co&&(mt=33190));const vt=lt(J);ht(J)?u.renderbufferStorageMultisampleEXT(36161,vt,mt,J.width,J.height):c.renderbufferStorageMultisample(36161,vt,mt,J.width,J.height)}else c.renderbufferStorage(36161,mt,J.width,J.height);c.framebufferRenderbuffer(36160,36096,36161,K)}else if(J.depthBuffer&&J.stencilBuffer){const mt=lt(J);rt&&ht(J)===!1?c.renderbufferStorageMultisample(36161,mt,35056,J.width,J.height):ht(J)?u.renderbufferStorageMultisampleEXT(36161,mt,35056,J.width,J.height):c.renderbufferStorage(36161,34041,J.width,J.height),c.framebufferRenderbuffer(36160,33306,36161,K)}else{const mt=J.isWebGLMultipleRenderTargets===!0?J.texture[0]:J.texture,xt=s.convert(mt.format,mt.encoding),vt=s.convert(mt.type),Mt=X(mt.internalFormat,xt,vt,mt.encoding),ut=lt(J);rt&&ht(J)===!1?c.renderbufferStorageMultisample(36161,ut,Mt,J.width,J.height):ht(J)?u.renderbufferStorageMultisampleEXT(36161,ut,Mt,J.width,J.height):c.renderbufferStorage(36161,Mt,J.width,J.height)}c.bindRenderbuffer(36161,null)}function H(K,J){if(J&&J.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,K),!(J.depthTexture&&J.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(J.depthTexture).__webglTexture||J.depthTexture.image.width!==J.width||J.depthTexture.image.height!==J.height)&&(J.depthTexture.image.width=J.width,J.depthTexture.image.height=J.height,J.depthTexture.needsUpdate=!0),N(J.depthTexture,0);const mt=i.get(J.depthTexture).__webglTexture,xt=lt(J);if(J.depthTexture.format===gs)ht(J)?u.framebufferTexture2DMultisampleEXT(36160,36096,3553,mt,0,xt):c.framebufferTexture2D(36160,36096,3553,mt,0);else if(J.depthTexture.format===sa)ht(J)?u.framebufferTexture2DMultisampleEXT(36160,33306,3553,mt,0,xt):c.framebufferTexture2D(36160,33306,3553,mt,0);else throw new Error("Unknown depthTexture format")}function j(K){const J=i.get(K),rt=K.isWebGLCubeRenderTarget===!0;if(K.depthTexture&&!J.__autoAllocateDepthBuffer){if(rt)throw new Error("target.depthTexture not supported in Cube render targets");H(J.__webglFramebuffer,K)}else if(rt){J.__webglDepthbuffer=[];for(let mt=0;mt<6;mt++)e.bindFramebuffer(36160,J.__webglFramebuffer[mt]),J.__webglDepthbuffer[mt]=c.createRenderbuffer(),nt(J.__webglDepthbuffer[mt],K,!1)}else e.bindFramebuffer(36160,J.__webglFramebuffer),J.__webglDepthbuffer=c.createRenderbuffer(),nt(J.__webglDepthbuffer,K,!1);e.bindFramebuffer(36160,null)}function it(K,J,rt){const mt=i.get(K);J!==void 0&&Q(mt.__webglFramebuffer,K,K.texture,36064,3553),rt!==void 0&&j(K)}function et(K){const J=K.texture,rt=i.get(K),mt=i.get(J);K.addEventListener("dispose",F),K.isWebGLMultipleRenderTargets!==!0&&(mt.__webglTexture===void 0&&(mt.__webglTexture=c.createTexture()),mt.__version=J.version,o.memory.textures++);const xt=K.isWebGLCubeRenderTarget===!0,vt=K.isWebGLMultipleRenderTargets===!0,Mt=y(K)||r;if(xt){rt.__webglFramebuffer=[];for(let ut=0;ut<6;ut++)rt.__webglFramebuffer[ut]=c.createFramebuffer()}else if(rt.__webglFramebuffer=c.createFramebuffer(),vt)if(n.drawBuffers){const ut=K.texture;for(let Zt=0,zt=ut.length;Zt<zt;Zt++){const dt=i.get(ut[Zt]);dt.__webglTexture===void 0&&(dt.__webglTexture=c.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(r&&K.samples>0&&ht(K)===!1){rt.__webglMultisampledFramebuffer=c.createFramebuffer(),rt.__webglColorRenderbuffer=c.createRenderbuffer(),c.bindRenderbuffer(36161,rt.__webglColorRenderbuffer);const ut=s.convert(J.format,J.encoding),Zt=s.convert(J.type),zt=X(J.internalFormat,ut,Zt,J.encoding),dt=lt(K);c.renderbufferStorageMultisample(36161,dt,zt,K.width,K.height),e.bindFramebuffer(36160,rt.__webglMultisampledFramebuffer),c.framebufferRenderbuffer(36160,36064,36161,rt.__webglColorRenderbuffer),c.bindRenderbuffer(36161,null),K.depthBuffer&&(rt.__webglDepthRenderbuffer=c.createRenderbuffer(),nt(rt.__webglDepthRenderbuffer,K,!0)),e.bindFramebuffer(36160,null)}if(xt){e.bindTexture(34067,mt.__webglTexture),B(34067,J,Mt);for(let ut=0;ut<6;ut++)Q(rt.__webglFramebuffer[ut],K,J,36064,34069+ut);M(J,Mt)&&Y(34067),e.unbindTexture()}else if(vt){const ut=K.texture;for(let Zt=0,zt=ut.length;Zt<zt;Zt++){const dt=ut[Zt],st=i.get(dt);e.bindTexture(3553,st.__webglTexture),B(3553,dt,Mt),Q(rt.__webglFramebuffer,K,dt,36064+Zt,3553),M(dt,Mt)&&Y(3553)}e.unbindTexture()}else{let ut=3553;(K.isWebGL3DRenderTarget||K.isWebGLArrayRenderTarget)&&(r?ut=K.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),e.bindTexture(ut,mt.__webglTexture),B(ut,J,Mt),Q(rt.__webglFramebuffer,K,J,36064,ut),M(J,Mt)&&Y(ut),e.unbindTexture()}K.depthBuffer&&j(K)}function G(K){const J=y(K)||r,rt=K.isWebGLMultipleRenderTargets===!0?K.texture:[K.texture];for(let mt=0,xt=rt.length;mt<xt;mt++){const vt=rt[mt];if(M(vt,J)){const Mt=K.isWebGLCubeRenderTarget?34067:3553,ut=i.get(vt).__webglTexture;e.bindTexture(Mt,ut),Y(Mt),e.unbindTexture()}}}function W(K){if(r&&K.samples>0&&ht(K)===!1){const J=K.width,rt=K.height;let mt=16384;const xt=[36064],vt=K.stencilBuffer?33306:36096;K.depthBuffer&&xt.push(vt);const Mt=i.get(K),ut=Mt.__ignoreDepthValues!==void 0?Mt.__ignoreDepthValues:!1;ut===!1&&(K.depthBuffer&&(mt|=256),K.stencilBuffer&&(mt|=1024)),e.bindFramebuffer(36008,Mt.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,Mt.__webglFramebuffer),ut===!0&&(c.invalidateFramebuffer(36008,[vt]),c.invalidateFramebuffer(36009,[vt])),c.blitFramebuffer(0,0,J,rt,0,0,J,rt,mt,9728),f&&c.invalidateFramebuffer(36008,xt),e.bindFramebuffer(36008,null),e.bindFramebuffer(36009,Mt.__webglMultisampledFramebuffer)}}function lt(K){return Math.min(h,K.samples)}function ht(K){const J=i.get(K);return r&&K.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&J.__useRenderToTexture!==!1}function ft(K){const J=o.render.frame;m.get(K)!==J&&(m.set(K,J),K.update())}function pt(K,J){const rt=K.encoding,mt=K.format,xt=K.type;return K.isCompressedTexture===!0||K.isVideoTexture===!0||K.format===hl||rt!==es&&(rt===Ci?r===!1?t.has("EXT_sRGB")===!0&&mt===vn?(K.format=hl,K.minFilter=rn,K.generateMipmaps=!1):J=Xs.sRGBToLinear(J):(mt!==vn||xt!==ys)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",rt)),J}this.allocateTextureUnit=T,this.resetTextureUnits=E,this.setTexture2D=N,this.setTexture2DArray=R,this.setTexture3D=k,this.setTextureCube=O,this.rebindTextures=it,this.setupRenderTarget=et,this.updateRenderTargetMipmap=G,this.updateMultisampleRenderTarget=W,this.setupDepthRenderbuffer=j,this.setupFrameBufferTexture=Q,this.useMultisampledRTT=ht}function Z2(c,t,e){const i=e.isWebGL2;function n(s,o=null){let r;if(s===ys)return 5121;if(s===Iu)return 32819;if(s===zu)return 32820;if(s===Mu)return 5120;if(s===wu)return 5122;if(s===Na)return 5123;if(s===Xu)return 5124;if(s===Co)return 5125;if(s===ms)return 5126;if(s===Fa)return i?5131:(r=t.get("OES_texture_half_float"),r!==null?r.HALF_FLOAT_OES:null);if(s===Su)return 6406;if(s===vn)return 6408;if(s===Zu)return 6409;if(s===Lu)return 6410;if(s===gs)return 6402;if(s===sa)return 34041;if(s===Au)return 6403;if(s===Yu)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(s===hl)return r=t.get("EXT_sRGB"),r!==null?r.SRGB_ALPHA_EXT:null;if(s===Tu)return 36244;if(s===Vu)return 33319;if(s===Eu)return 33320;if(s===Cu)return 36249;if(s===fr||s===dr||s===gr||s===xr)if(o===Ci)if(r=t.get("WEBGL_compressed_texture_s3tc_srgb"),r!==null){if(s===fr)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===dr)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===gr)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===xr)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(r=t.get("WEBGL_compressed_texture_s3tc"),r!==null){if(s===fr)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===dr)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===gr)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===xr)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===v_||s===b_||s===y_||s===M_)if(r=t.get("WEBGL_compressed_texture_pvrtc"),r!==null){if(s===v_)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===b_)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===y_)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===M_)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===Pu)return r=t.get("WEBGL_compressed_texture_etc1"),r!==null?r.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===w_||s===X_)if(r=t.get("WEBGL_compressed_texture_etc"),r!==null){if(s===w_)return o===Ci?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(s===X_)return o===Ci?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===I_||s===z_||s===S_||s===Y_||s===Z_||s===L_||s===A_||s===T_||s===V_||s===E_||s===C_||s===P_||s===R_||s===k_)if(r=t.get("WEBGL_compressed_texture_astc"),r!==null){if(s===I_)return o===Ci?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===z_)return o===Ci?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===S_)return o===Ci?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===Y_)return o===Ci?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===Z_)return o===Ci?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===L_)return o===Ci?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===A_)return o===Ci?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===T_)return o===Ci?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===V_)return o===Ci?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===E_)return o===Ci?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===C_)return o===Ci?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===P_)return o===Ci?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===R_)return o===Ci?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===k_)return o===Ci?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===B_)if(r=t.get("EXT_texture_compression_bptc"),r!==null){if(s===B_)return o===Ci?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;return s===ta?i?34042:(r=t.get("WEBGL_depth_texture"),r!==null?r.UNSIGNED_INT_24_8_WEBGL:null):c[s]!==void 0?c[s]:null}return{convert:n}}class zc extends nn{constructor(t=[]){super(),this.cameras=t}}zc.prototype.isArrayCamera=!0;class qs extends Ti{constructor(){super(),this.type="Group"}}qs.prototype.isGroup=!0;const L2={type:"move"};class jr{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new qs,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new qs,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new wt,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new wt),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new qs,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new wt,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new wt),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,e,i){let n=null,s=null,o=null;const r=this._targetRay,_=this._grip,a=this._hand;if(t&&e.session.visibilityState!=="visible-blurred")if(r!==null&&(n=e.getPose(t.targetRaySpace,i),n!==null&&(r.matrix.fromArray(n.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),n.linearVelocity?(r.hasLinearVelocity=!0,r.linearVelocity.copy(n.linearVelocity)):r.hasLinearVelocity=!1,n.angularVelocity?(r.hasAngularVelocity=!0,r.angularVelocity.copy(n.angularVelocity)):r.hasAngularVelocity=!1,this.dispatchEvent(L2))),a&&t.hand){o=!0;for(const d of t.hand.values()){const p=e.getJointPose(d,i);if(a.joints[d.jointName]===void 0){const x=new qs;x.matrixAutoUpdate=!1,x.visible=!1,a.joints[d.jointName]=x,a.add(x)}const g=a.joints[d.jointName];p!==null&&(g.matrix.fromArray(p.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.jointRadius=p.radius),g.visible=p!==null}const l=a.joints["index-finger-tip"],h=a.joints["thumb-tip"],u=l.position.distanceTo(h.position),f=.02,m=.005;a.inputState.pinching&&u>f+m?(a.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!a.inputState.pinching&&u<=f-m&&(a.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else _!==null&&t.gripSpace&&(s=e.getPose(t.gripSpace,i),s!==null&&(_.matrix.fromArray(s.transform.matrix),_.matrix.decompose(_.position,_.rotation,_.scale),s.linearVelocity?(_.hasLinearVelocity=!0,_.linearVelocity.copy(s.linearVelocity)):_.hasLinearVelocity=!1,s.angularVelocity?(_.hasAngularVelocity=!0,_.angularVelocity.copy(s.angularVelocity)):_.hasAngularVelocity=!1));return r!==null&&(r.visible=n!==null),_!==null&&(_.visible=s!==null),a!==null&&(a.visible=o!==null),this}}class Sc extends $i{constructor(t,e,i,n,s,o,r,_,a,l){if(l=l!==void 0?l:gs,l!==gs&&l!==sa)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&l===gs&&(i=Na),i===void 0&&l===sa&&(i=ta),super(null,n,s,o,r,_,l,i,a),this.image={width:t,height:e},this.magFilter=r!==void 0?r:ji,this.minFilter=_!==void 0?_:ji,this.flipY=!1,this.generateMipmaps=!1}}Sc.prototype.isDepthTexture=!0;class A2 extends ws{constructor(t,e){super();const i=this;let n=null,s=1,o=null,r="local-floor",_=null,a=null,l=null,h=null,u=null,f=null;const m=e.getContextAttributes();let d=null,p=null;const g=[],x=new Map,b=new nn;b.layers.enable(1),b.viewport=new Li;const y=new nn;y.layers.enable(2),y.viewport=new Li;const z=[b,y],M=new zc;M.layers.enable(1),M.layers.enable(2);let Y=null,X=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(P){let N=g[P];return N===void 0&&(N=new jr,g[P]=N),N.getTargetRaySpace()},this.getControllerGrip=function(P){let N=g[P];return N===void 0&&(N=new jr,g[P]=N),N.getGripSpace()},this.getHand=function(P){let N=g[P];return N===void 0&&(N=new jr,g[P]=N),N.getHandSpace()};function w(P){const N=x.get(P.inputSource);N&&N.dispatchEvent({type:P.type,data:P.inputSource})}function S(){x.forEach(function(P,N){P.disconnect(N)}),x.clear(),Y=null,X=null,t.setRenderTarget(d),u=null,h=null,l=null,n=null,p=null,T.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(P){s=P,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(P){r=P,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return _||o},this.setReferenceSpace=function(P){_=P},this.getBaseLayer=function(){return h!==null?h:u},this.getBinding=function(){return l},this.getFrame=function(){return f},this.getSession=function(){return n},this.setSession=async function(P){if(n=P,n!==null){if(d=t.getRenderTarget(),n.addEventListener("select",w),n.addEventListener("selectstart",w),n.addEventListener("selectend",w),n.addEventListener("squeeze",w),n.addEventListener("squeezestart",w),n.addEventListener("squeezeend",w),n.addEventListener("end",S),n.addEventListener("inputsourceschange",V),m.xrCompatible!==!0&&await e.makeXRCompatible(),n.renderState.layers===void 0||t.capabilities.isWebGL2===!1){const N={antialias:n.renderState.layers===void 0?m.antialias:!0,alpha:m.alpha,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:s};u=new XRWebGLLayer(n,e,N),n.updateRenderState({baseLayer:u}),p=new ln(u.framebufferWidth,u.framebufferHeight,{format:vn,type:ys,encoding:t.outputEncoding})}else{let N=null,R=null,k=null;m.depth&&(k=m.stencil?35056:33190,N=m.stencil?sa:gs,R=m.stencil?ta:Na);const O={colorFormat:t.outputEncoding===Ci?35907:32856,depthFormat:k,scaleFactor:s};l=new XRWebGLBinding(n,e),h=l.createProjectionLayer(O),n.updateRenderState({layers:[h]}),p=new ln(h.textureWidth,h.textureHeight,{format:vn,type:ys,depthTexture:new Sc(h.textureWidth,h.textureHeight,R,void 0,void 0,void 0,void 0,void 0,void 0,N),stencilBuffer:m.stencil,encoding:t.outputEncoding,samples:m.antialias?4:0});const v=t.properties.get(p);v.__ignoreDepthValues=h.ignoreDepthValues}p.isXRRenderTarget=!0,this.setFoveation(1),o=await n.requestReferenceSpace(r),T.setContext(n),T.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function V(P){const N=n.inputSources;for(let R=0;R<N.length;R++){const k=N[R].handedness==="right"?1:0;x.set(N[R],g[k])}for(let R=0;R<P.removed.length;R++){const k=P.removed[R],O=x.get(k);O&&(O.dispatchEvent({type:"disconnected",data:k}),x.delete(k))}for(let R=0;R<P.added.length;R++){const k=P.added[R],O=x.get(k);O&&O.dispatchEvent({type:"connected",data:k})}}const F=new wt,C=new wt;function A(P,N,R){F.setFromMatrixPosition(N.matrixWorld),C.setFromMatrixPosition(R.matrixWorld);const k=F.distanceTo(C),O=N.projectionMatrix.elements,v=R.projectionMatrix.elements,D=O[14]/(O[10]-1),B=O[14]/(O[10]+1),U=(O[9]+1)/O[5],q=(O[9]-1)/O[5],tt=(O[8]-1)/O[0],Q=(v[8]+1)/v[0],nt=D*tt,H=D*Q,j=k/(-tt+Q),it=j*-tt;N.matrixWorld.decompose(P.position,P.quaternion,P.scale),P.translateX(it),P.translateZ(j),P.matrixWorld.compose(P.position,P.quaternion,P.scale),P.matrixWorldInverse.copy(P.matrixWorld).invert();const et=D+j,G=B+j,W=nt-it,lt=H+(k-it),ht=U*B/G*et,ft=q*B/G*et;P.projectionMatrix.makePerspective(W,lt,ht,ft,et,G)}function Z(P,N){N===null?P.matrixWorld.copy(P.matrix):P.matrixWorld.multiplyMatrices(N.matrixWorld,P.matrix),P.matrixWorldInverse.copy(P.matrixWorld).invert()}this.updateCamera=function(P){if(n===null)return;M.near=y.near=b.near=P.near,M.far=y.far=b.far=P.far,(Y!==M.near||X!==M.far)&&(n.updateRenderState({depthNear:M.near,depthFar:M.far}),Y=M.near,X=M.far);const N=P.parent,R=M.cameras;Z(M,N);for(let O=0;O<R.length;O++)Z(R[O],N);M.matrixWorld.decompose(M.position,M.quaternion,M.scale),P.position.copy(M.position),P.quaternion.copy(M.quaternion),P.scale.copy(M.scale),P.matrix.copy(M.matrix),P.matrixWorld.copy(M.matrixWorld);const k=P.children;for(let O=0,v=k.length;O<v;O++)k[O].updateMatrixWorld(!0);R.length===2?A(M,b,y):M.projectionMatrix.copy(b.projectionMatrix)},this.getCamera=function(){return M},this.getFoveation=function(){if(h!==null)return h.fixedFoveation;if(u!==null)return u.fixedFoveation},this.setFoveation=function(P){h!==null&&(h.fixedFoveation=P),u!==null&&u.fixedFoveation!==void 0&&(u.fixedFoveation=P)};let L=null;function E(P,N){if(a=N.getViewerPose(_||o),f=N,a!==null){const k=a.views;u!==null&&(t.setRenderTargetFramebuffer(p,u.framebuffer),t.setRenderTarget(p));let O=!1;k.length!==M.cameras.length&&(M.cameras.length=0,O=!0);for(let v=0;v<k.length;v++){const D=k[v];let B=null;if(u!==null)B=u.getViewport(D);else{const q=l.getViewSubImage(h,D);B=q.viewport,v===0&&(t.setRenderTargetTextures(p,q.colorTexture,h.ignoreDepthValues?void 0:q.depthStencilTexture),t.setRenderTarget(p))}const U=z[v];U.matrix.fromArray(D.transform.matrix),U.projectionMatrix.fromArray(D.projectionMatrix),U.viewport.set(B.x,B.y,B.width,B.height),v===0&&M.matrix.copy(U.matrix),O===!0&&M.cameras.push(U)}}const R=n.inputSources;for(let k=0;k<g.length;k++){const O=R[k],v=x.get(O);v!==void 0&&v.update(O,N,_||o)}L&&L(P,N),f=null}const T=new xc;T.setAnimationLoop(E),this.setAnimationLoop=function(P){L=P},this.dispose=function(){}}}function T2(c,t){function e(d,p){d.fogColor.value.copy(p.color),p.isFog?(d.fogNear.value=p.near,d.fogFar.value=p.far):p.isFogExp2&&(d.fogDensity.value=p.density)}function i(d,p,g,x,b){p.isMeshBasicMaterial||p.isMeshLambertMaterial?n(d,p):p.isMeshToonMaterial?(n(d,p),l(d,p)):p.isMeshPhongMaterial?(n(d,p),a(d,p)):p.isMeshStandardMaterial?(n(d,p),h(d,p),p.isMeshPhysicalMaterial&&u(d,p,b)):p.isMeshMatcapMaterial?(n(d,p),f(d,p)):p.isMeshDepthMaterial?n(d,p):p.isMeshDistanceMaterial?(n(d,p),m(d,p)):p.isMeshNormalMaterial?n(d,p):p.isLineBasicMaterial?(s(d,p),p.isLineDashedMaterial&&o(d,p)):p.isPointsMaterial?r(d,p,g,x):p.isSpriteMaterial?_(d,p):p.isShadowMaterial?(d.color.value.copy(p.color),d.opacity.value=p.opacity):p.isShaderMaterial&&(p.uniformsNeedUpdate=!1)}function n(d,p){d.opacity.value=p.opacity,p.color&&d.diffuse.value.copy(p.color),p.emissive&&d.emissive.value.copy(p.emissive).multiplyScalar(p.emissiveIntensity),p.map&&(d.map.value=p.map),p.alphaMap&&(d.alphaMap.value=p.alphaMap),p.bumpMap&&(d.bumpMap.value=p.bumpMap,d.bumpScale.value=p.bumpScale,p.side===Mn&&(d.bumpScale.value*=-1)),p.displacementMap&&(d.displacementMap.value=p.displacementMap,d.displacementScale.value=p.displacementScale,d.displacementBias.value=p.displacementBias),p.emissiveMap&&(d.emissiveMap.value=p.emissiveMap),p.normalMap&&(d.normalMap.value=p.normalMap,d.normalScale.value.copy(p.normalScale),p.side===Mn&&d.normalScale.value.negate()),p.specularMap&&(d.specularMap.value=p.specularMap),p.alphaTest>0&&(d.alphaTest.value=p.alphaTest);const g=t.get(p).envMap;if(g&&(d.envMap.value=g,d.flipEnvMap.value=g.isCubeTexture&&g.isRenderTargetTexture===!1?-1:1,d.reflectivity.value=p.reflectivity,d.ior.value=p.ior,d.refractionRatio.value=p.refractionRatio),p.lightMap){d.lightMap.value=p.lightMap;const y=c.physicallyCorrectLights!==!0?Math.PI:1;d.lightMapIntensity.value=p.lightMapIntensity*y}p.aoMap&&(d.aoMap.value=p.aoMap,d.aoMapIntensity.value=p.aoMapIntensity);let x;p.map?x=p.map:p.specularMap?x=p.specularMap:p.displacementMap?x=p.displacementMap:p.normalMap?x=p.normalMap:p.bumpMap?x=p.bumpMap:p.roughnessMap?x=p.roughnessMap:p.metalnessMap?x=p.metalnessMap:p.alphaMap?x=p.alphaMap:p.emissiveMap?x=p.emissiveMap:p.clearcoatMap?x=p.clearcoatMap:p.clearcoatNormalMap?x=p.clearcoatNormalMap:p.clearcoatRoughnessMap?x=p.clearcoatRoughnessMap:p.specularIntensityMap?x=p.specularIntensityMap:p.specularColorMap?x=p.specularColorMap:p.transmissionMap?x=p.transmissionMap:p.thicknessMap?x=p.thicknessMap:p.sheenColorMap?x=p.sheenColorMap:p.sheenRoughnessMap&&(x=p.sheenRoughnessMap),x!==void 0&&(x.isWebGLRenderTarget&&(x=x.texture),x.matrixAutoUpdate===!0&&x.updateMatrix(),d.uvTransform.value.copy(x.matrix));let b;p.aoMap?b=p.aoMap:p.lightMap&&(b=p.lightMap),b!==void 0&&(b.isWebGLRenderTarget&&(b=b.texture),b.matrixAutoUpdate===!0&&b.updateMatrix(),d.uv2Transform.value.copy(b.matrix))}function s(d,p){d.diffuse.value.copy(p.color),d.opacity.value=p.opacity}function o(d,p){d.dashSize.value=p.dashSize,d.totalSize.value=p.dashSize+p.gapSize,d.scale.value=p.scale}function r(d,p,g,x){d.diffuse.value.copy(p.color),d.opacity.value=p.opacity,d.size.value=p.size*g,d.scale.value=x*.5,p.map&&(d.map.value=p.map),p.alphaMap&&(d.alphaMap.value=p.alphaMap),p.alphaTest>0&&(d.alphaTest.value=p.alphaTest);let b;p.map?b=p.map:p.alphaMap&&(b=p.alphaMap),b!==void 0&&(b.matrixAutoUpdate===!0&&b.updateMatrix(),d.uvTransform.value.copy(b.matrix))}function _(d,p){d.diffuse.value.copy(p.color),d.opacity.value=p.opacity,d.rotation.value=p.rotation,p.map&&(d.map.value=p.map),p.alphaMap&&(d.alphaMap.value=p.alphaMap),p.alphaTest>0&&(d.alphaTest.value=p.alphaTest);let g;p.map?g=p.map:p.alphaMap&&(g=p.alphaMap),g!==void 0&&(g.matrixAutoUpdate===!0&&g.updateMatrix(),d.uvTransform.value.copy(g.matrix))}function a(d,p){d.specular.value.copy(p.specular),d.shininess.value=Math.max(p.shininess,1e-4)}function l(d,p){p.gradientMap&&(d.gradientMap.value=p.gradientMap)}function h(d,p){d.roughness.value=p.roughness,d.metalness.value=p.metalness,p.roughnessMap&&(d.roughnessMap.value=p.roughnessMap),p.metalnessMap&&(d.metalnessMap.value=p.metalnessMap),t.get(p).envMap&&(d.envMapIntensity.value=p.envMapIntensity)}function u(d,p,g){d.ior.value=p.ior,p.sheen>0&&(d.sheenColor.value.copy(p.sheenColor).multiplyScalar(p.sheen),d.sheenRoughness.value=p.sheenRoughness,p.sheenColorMap&&(d.sheenColorMap.value=p.sheenColorMap),p.sheenRoughnessMap&&(d.sheenRoughnessMap.value=p.sheenRoughnessMap)),p.clearcoat>0&&(d.clearcoat.value=p.clearcoat,d.clearcoatRoughness.value=p.clearcoatRoughness,p.clearcoatMap&&(d.clearcoatMap.value=p.clearcoatMap),p.clearcoatRoughnessMap&&(d.clearcoatRoughnessMap.value=p.clearcoatRoughnessMap),p.clearcoatNormalMap&&(d.clearcoatNormalScale.value.copy(p.clearcoatNormalScale),d.clearcoatNormalMap.value=p.clearcoatNormalMap,p.side===Mn&&d.clearcoatNormalScale.value.negate())),p.transmission>0&&(d.transmission.value=p.transmission,d.transmissionSamplerMap.value=g.texture,d.transmissionSamplerSize.value.set(g.width,g.height),p.transmissionMap&&(d.transmissionMap.value=p.transmissionMap),d.thickness.value=p.thickness,p.thicknessMap&&(d.thicknessMap.value=p.thicknessMap),d.attenuationDistance.value=p.attenuationDistance,d.attenuationColor.value.copy(p.attenuationColor)),d.specularIntensity.value=p.specularIntensity,d.specularColor.value.copy(p.specularColor),p.specularIntensityMap&&(d.specularIntensityMap.value=p.specularIntensityMap),p.specularColorMap&&(d.specularColorMap.value=p.specularColorMap)}function f(d,p){p.matcap&&(d.matcap.value=p.matcap)}function m(d,p){d.referencePosition.value.copy(p.referencePosition),d.nearDistance.value=p.nearDistance,d.farDistance.value=p.farDistance}return{refreshFogUniforms:e,refreshMaterialUniforms:i}}function V2(){const c=Ua("canvas");return c.style.display="block",c}function Vi(c={}){const t=c.canvas!==void 0?c.canvas:V2(),e=c.context!==void 0?c.context:null,i=c.depth!==void 0?c.depth:!0,n=c.stencil!==void 0?c.stencil:!0,s=c.antialias!==void 0?c.antialias:!1,o=c.premultipliedAlpha!==void 0?c.premultipliedAlpha:!0,r=c.preserveDrawingBuffer!==void 0?c.preserveDrawingBuffer:!1,_=c.powerPreference!==void 0?c.powerPreference:"default",a=c.failIfMajorPerformanceCaveat!==void 0?c.failIfMajorPerformanceCaveat:!1;let l;e!==null?l=e.getContextAttributes().alpha:l=c.alpha!==void 0?c.alpha:!1;let h=null,u=null;const f=[],m=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=es,this.physicallyCorrectLights=!1,this.toneMapping=Fn,this.toneMappingExposure=1;const d=this;let p=!1,g=0,x=0,b=null,y=-1,z=null;const M=new Li,Y=new Li;let X=null,w=t.width,S=t.height,V=1,F=null,C=null;const A=new Li(0,0,w,S),Z=new Li(0,0,w,S);let L=!1;const E=new ir;let T=!1,P=!1,N=null;const R=new vi,k=new Ne,O=new wt,v={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function D(){return b===null?V:1}let B=e;function U(at,gt){for(let yt=0;yt<at.length;yt++){const bt=at[yt],ot=t.getContext(bt,gt);if(ot!==null)return ot}return null}try{const at={alpha:!0,depth:i,stencil:n,antialias:s,premultipliedAlpha:o,preserveDrawingBuffer:r,powerPreference:_,failIfMajorPerformanceCaveat:a};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Xl}`),t.addEventListener("webglcontextlost",st,!1),t.addEventListener("webglcontextrestored",ct,!1),B===null){const gt=["webgl2","webgl","experimental-webgl"];if(d.isWebGL1Renderer===!0&&gt.shift(),B=U(gt,at),B===null)throw U(gt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}B.getShaderPrecisionFormat===void 0&&(B.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(at){throw console.error("THREE.WebGLRenderer: "+at.message),at}let q,tt,Q,nt,H,j,it,et,G,W,lt,ht,ft,pt,K,J,rt,mt,xt,vt,Mt,ut,Zt;function zt(){q=new Jf(B),tt=new Uf(B,q,c),q.init(tt),ut=new Z2(B,q,tt),Q=new S2(B,q,tt),nt=new Qf(B),H=new d2,j=new Y2(B,q,Q,H,tt,ut,nt),it=new Hf(d),et=new qf(d),G=new up(B,tt),Zt=new Ff(B,q,G,tt),W=new $f(B,G,nt,Zt),lt=new nd(B,W,G,nt),xt=new id(B,tt,j),J=new Gf(H),ht=new f2(d,it,et,q,tt,Zt,J),ft=new T2(d,H),pt=new x2,K=new X2(q,tt),mt=new Nf(d,it,Q,lt,l,o),rt=new Ic(d,lt,tt),vt=new Of(B,q,nt,tt),Mt=new Kf(B,q,nt,tt),nt.programs=ht.programs,d.capabilities=tt,d.extensions=q,d.properties=H,d.renderLists=pt,d.shadowMap=rt,d.state=Q,d.info=nt}zt();const dt=new A2(d,B);this.xr=dt,this.getContext=function(){return B},this.getContextAttributes=function(){return B.getContextAttributes()},this.forceContextLoss=function(){const at=q.get("WEBGL_lose_context");at&&at.loseContext()},this.forceContextRestore=function(){const at=q.get("WEBGL_lose_context");at&&at.restoreContext()},this.getPixelRatio=function(){return V},this.setPixelRatio=function(at){at!==void 0&&(V=at,this.setSize(w,S,!1))},this.getSize=function(at){return at.set(w,S)},this.setSize=function(at,gt,yt){if(dt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}w=at,S=gt,t.width=Math.floor(at*V),t.height=Math.floor(gt*V),yt!==!1&&(t.style.width=at+"px",t.style.height=gt+"px"),this.setViewport(0,0,at,gt)},this.getDrawingBufferSize=function(at){return at.set(w*V,S*V).floor()},this.setDrawingBufferSize=function(at,gt,yt){w=at,S=gt,V=yt,t.width=Math.floor(at*yt),t.height=Math.floor(gt*yt),this.setViewport(0,0,at,gt)},this.getCurrentViewport=function(at){return at.copy(M)},this.getViewport=function(at){return at.copy(A)},this.setViewport=function(at,gt,yt,bt){at.isVector4?A.set(at.x,at.y,at.z,at.w):A.set(at,gt,yt,bt),Q.viewport(M.copy(A).multiplyScalar(V).floor())},this.getScissor=function(at){return at.copy(Z)},this.setScissor=function(at,gt,yt,bt){at.isVector4?Z.set(at.x,at.y,at.z,at.w):Z.set(at,gt,yt,bt),Q.scissor(Y.copy(Z).multiplyScalar(V).floor())},this.getScissorTest=function(){return L},this.setScissorTest=function(at){Q.setScissorTest(L=at)},this.setOpaqueSort=function(at){F=at},this.setTransparentSort=function(at){C=at},this.getClearColor=function(at){return at.copy(mt.getClearColor())},this.setClearColor=function(){mt.setClearColor.apply(mt,arguments)},this.getClearAlpha=function(){return mt.getClearAlpha()},this.setClearAlpha=function(){mt.setClearAlpha.apply(mt,arguments)},this.clear=function(at=!0,gt=!0,yt=!0){let bt=0;at&&(bt|=16384),gt&&(bt|=256),yt&&(bt|=1024),B.clear(bt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",st,!1),t.removeEventListener("webglcontextrestored",ct,!1),pt.dispose(),K.dispose(),H.dispose(),it.dispose(),et.dispose(),lt.dispose(),Zt.dispose(),ht.dispose(),dt.dispose(),dt.removeEventListener("sessionstart",Ft),dt.removeEventListener("sessionend",ie),N&&(N.dispose(),N=null),ee.stop()};function st(at){at.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),p=!0}function ct(){console.log("THREE.WebGLRenderer: Context Restored."),p=!1;const at=nt.autoReset,gt=rt.enabled,yt=rt.autoUpdate,bt=rt.needsUpdate,ot=rt.type;zt(),nt.autoReset=at,rt.enabled=gt,rt.autoUpdate=yt,rt.needsUpdate=bt,rt.type=ot}function _t(at){const gt=at.target;gt.removeEventListener("dispose",_t),Vt(gt)}function Vt(at){At(at),H.remove(at)}function At(at){const gt=H.get(at).programs;gt!==void 0&&(gt.forEach(function(yt){ht.releaseProgram(yt)}),at.isShaderMaterial&&ht.releaseShaderCache(at))}this.renderBufferDirect=function(at,gt,yt,bt,ot,Pt){gt===null&&(gt=v);const Dt=ot.isMesh&&ot.matrixWorld.determinant()<0,$=qe(at,gt,yt,bt,ot);Q.setMaterial(bt,Dt);let kt=yt.index;const Rt=yt.attributes.position;if(kt===null){if(Rt===void 0||Rt.count===0)return}else if(kt.count===0)return;let Ot=1;bt.wireframe===!0&&(kt=W.getWireframeAttribute(yt),Ot=2),Zt.setup(ot,bt,$,yt,kt);let Wt,Bt=vt;kt!==null&&(Wt=G.get(kt),Bt=Mt,Bt.setIndex(Wt));const re=kt!==null?kt.count:Rt.count,Ce=yt.drawRange.start*Ot,be=yt.drawRange.count*Ot,Tt=Pt!==null?Pt.start*Ot:0,Lt=Pt!==null?Pt.count*Ot:1/0,Yt=Math.max(Ce,Tt),pe=Math.min(re,Ce+be,Tt+Lt)-1,Me=Math.max(0,pe-Yt+1);if(Me!==0){if(ot.isMesh)bt.wireframe===!0?(Q.setLineWidth(bt.wireframeLinewidth*D()),Bt.setMode(1)):Bt.setMode(4);else if(ot.isLine){let fe=bt.linewidth;fe===void 0&&(fe=1),Q.setLineWidth(fe*D()),ot.isLineSegments?Bt.setMode(1):ot.isLineLoop?Bt.setMode(2):Bt.setMode(3)}else ot.isPoints?Bt.setMode(0):ot.isSprite&&Bt.setMode(4);if(ot.isInstancedMesh)Bt.renderInstances(Yt,Me,ot.count);else if(yt.isInstancedBufferGeometry){const fe=Math.min(yt.instanceCount,yt._maxInstanceCount);Bt.renderInstances(Yt,Me,fe)}else Bt.render(Yt,Me)}},this.compile=function(at,gt){u=K.get(at),u.init(),m.push(u),at.traverseVisible(function(yt){yt.isLight&&yt.layers.test(gt.layers)&&(u.pushLight(yt),yt.castShadow&&u.pushShadow(yt))}),u.setupLights(d.physicallyCorrectLights),at.traverse(function(yt){const bt=yt.material;if(bt)if(Array.isArray(bt))for(let ot=0;ot<bt.length;ot++){const Pt=bt[ot];me(Pt,at,yt)}else me(bt,at,yt)}),m.pop(),u=null};let St=null;function Xt(at){St&&St(at)}function Ft(){ee.stop()}function ie(){ee.start()}const ee=new xc;ee.setAnimationLoop(Xt),typeof self!="undefined"&&ee.setContext(self),this.setAnimationLoop=function(at){St=at,dt.setAnimationLoop(at),at===null?ee.stop():ee.start()},dt.addEventListener("sessionstart",Ft),dt.addEventListener("sessionend",ie),this.render=function(at,gt){if(gt!==void 0&&gt.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(p===!0)return;at.autoUpdate===!0&&at.updateMatrixWorld(),gt.parent===null&&gt.updateMatrixWorld(),dt.enabled===!0&&dt.isPresenting===!0&&(dt.cameraAutoUpdate===!0&&dt.updateCamera(gt),gt=dt.getCamera()),at.isScene===!0&&at.onBeforeRender(d,at,gt,b),u=K.get(at,m.length),u.init(),m.push(u),R.multiplyMatrices(gt.projectionMatrix,gt.matrixWorldInverse),E.setFromProjectionMatrix(R),P=this.localClippingEnabled,T=J.init(this.clippingPlanes,P,gt),h=pt.get(at,f.length),h.init(),f.push(h),Ye(at,gt,0,d.sortObjects),h.finish(),d.sortObjects===!0&&h.sort(F,C),T===!0&&J.beginShadows();const yt=u.state.shadowsArray;if(rt.render(yt,at,gt),T===!0&&J.endShadows(),this.info.autoReset===!0&&this.info.reset(),mt.render(h,at),u.setupLights(d.physicallyCorrectLights),gt.isArrayCamera){const bt=gt.cameras;for(let ot=0,Pt=bt.length;ot<Pt;ot++){const Dt=bt[ot];Ie(h,at,Dt,Dt.viewport)}}else Ie(h,at,gt);b!==null&&(j.updateMultisampleRenderTarget(b),j.updateRenderTargetMipmap(b)),at.isScene===!0&&at.onAfterRender(d,at,gt),Zt.resetDefaultState(),y=-1,z=null,m.pop(),m.length>0?u=m[m.length-1]:u=null,f.pop(),f.length>0?h=f[f.length-1]:h=null};function Ye(at,gt,yt,bt){if(at.visible===!1)return;if(at.layers.test(gt.layers)){if(at.isGroup)yt=at.renderOrder;else if(at.isLOD)at.autoUpdate===!0&&at.update(gt);else if(at.isLight)u.pushLight(at),at.castShadow&&u.pushShadow(at);else if(at.isSprite){if(!at.frustumCulled||E.intersectsSprite(at)){bt&&O.setFromMatrixPosition(at.matrixWorld).applyMatrix4(R);const Dt=lt.update(at),$=at.material;$.visible&&h.push(at,Dt,$,yt,O.z,null)}}else if((at.isMesh||at.isLine||at.isPoints)&&(at.isSkinnedMesh&&at.skeleton.frame!==nt.render.frame&&(at.skeleton.update(),at.skeleton.frame=nt.render.frame),!at.frustumCulled||E.intersectsObject(at))){bt&&O.setFromMatrixPosition(at.matrixWorld).applyMatrix4(R);const Dt=lt.update(at),$=at.material;if(Array.isArray($)){const kt=Dt.groups;for(let Rt=0,Ot=kt.length;Rt<Ot;Rt++){const Wt=kt[Rt],Bt=$[Wt.materialIndex];Bt&&Bt.visible&&h.push(at,Dt,Bt,yt,O.z,Wt)}}else $.visible&&h.push(at,Dt,$,yt,O.z,null)}}const Pt=at.children;for(let Dt=0,$=Pt.length;Dt<$;Dt++)Ye(Pt[Dt],gt,yt,bt)}function Ie(at,gt,yt,bt){const ot=at.opaque,Pt=at.transmissive,Dt=at.transparent;u.setupLightsView(yt),Pt.length>0&&ue(ot,gt,yt),bt&&Q.viewport(M.copy(bt)),ot.length>0&&$t(ot,gt,yt),Pt.length>0&&$t(Pt,gt,yt),Dt.length>0&&$t(Dt,gt,yt),Q.buffers.depth.setTest(!0),Q.buffers.depth.setMask(!0),Q.buffers.color.setMask(!0),Q.setPolygonOffset(!1)}function ue(at,gt,yt){const bt=tt.isWebGL2;N===null&&(N=new ln(1,1,{generateMipmaps:!0,type:q.has("EXT_color_buffer_half_float")?Fa:ys,minFilter:Ko,samples:bt&&s===!0?4:0})),d.getDrawingBufferSize(k),bt?N.setSize(k.x,k.y):N.setSize(ul(k.x),ul(k.y));const ot=d.getRenderTarget();d.setRenderTarget(N),d.clear();const Pt=d.toneMapping;d.toneMapping=Fn,$t(at,gt,yt),d.toneMapping=Pt,j.updateMultisampleRenderTarget(N),j.updateRenderTargetMipmap(N),d.setRenderTarget(ot)}function $t(at,gt,yt){const bt=gt.isScene===!0?gt.overrideMaterial:null;for(let ot=0,Pt=at.length;ot<Pt;ot++){const Dt=at[ot],$=Dt.object,kt=Dt.geometry,Rt=bt===null?Dt.material:bt,Ot=Dt.group;$.layers.test(yt.layers)&&Ht($,gt,yt,kt,Rt,Ot)}}function Ht(at,gt,yt,bt,ot,Pt){at.onBeforeRender(d,gt,yt,bt,ot,Pt),at.modelViewMatrix.multiplyMatrices(yt.matrixWorldInverse,at.matrixWorld),at.normalMatrix.getNormalMatrix(at.modelViewMatrix),ot.onBeforeRender(d,gt,yt,bt,at,Pt),ot.transparent===!0&&ot.side===ea?(ot.side=Mn,ot.needsUpdate=!0,d.renderBufferDirect(yt,gt,bt,ot,at,Pt),ot.side=Da,ot.needsUpdate=!0,d.renderBufferDirect(yt,gt,bt,ot,at,Pt),ot.side=ea):d.renderBufferDirect(yt,gt,bt,ot,at,Pt),at.onAfterRender(d,gt,yt,bt,ot,Pt)}function me(at,gt,yt){gt.isScene!==!0&&(gt=v);const bt=H.get(at),ot=u.state.lights,Pt=u.state.shadowsArray,Dt=ot.state.version,$=ht.getParameters(at,ot.state,Pt,gt,yt),kt=ht.getProgramCacheKey($);let Rt=bt.programs;bt.environment=at.isMeshStandardMaterial?gt.environment:null,bt.fog=gt.fog,bt.envMap=(at.isMeshStandardMaterial?et:it).get(at.envMap||bt.environment),Rt===void 0&&(at.addEventListener("dispose",_t),Rt=new Map,bt.programs=Rt);let Ot=Rt.get(kt);if(Ot!==void 0){if(bt.currentProgram===Ot&&bt.lightsStateVersion===Dt)return ze(at,$),Ot}else $.uniforms=ht.getUniforms(at),at.onBuild(yt,$,d),at.onBeforeCompile($,d),Ot=ht.acquireProgram($,kt),Rt.set(kt,Ot),bt.uniforms=$.uniforms;const Wt=bt.uniforms;(!at.isShaderMaterial&&!at.isRawShaderMaterial||at.clipping===!0)&&(Wt.clippingPlanes=J.uniform),ze(at,$),bt.needsLights=Ut(at),bt.lightsStateVersion=Dt,bt.needsLights&&(Wt.ambientLightColor.value=ot.state.ambient,Wt.lightProbe.value=ot.state.probe,Wt.directionalLights.value=ot.state.directional,Wt.directionalLightShadows.value=ot.state.directionalShadow,Wt.spotLights.value=ot.state.spot,Wt.spotLightShadows.value=ot.state.spotShadow,Wt.rectAreaLights.value=ot.state.rectArea,Wt.ltc_1.value=ot.state.rectAreaLTC1,Wt.ltc_2.value=ot.state.rectAreaLTC2,Wt.pointLights.value=ot.state.point,Wt.pointLightShadows.value=ot.state.pointShadow,Wt.hemisphereLights.value=ot.state.hemi,Wt.directionalShadowMap.value=ot.state.directionalShadowMap,Wt.directionalShadowMatrix.value=ot.state.directionalShadowMatrix,Wt.spotShadowMap.value=ot.state.spotShadowMap,Wt.spotShadowMatrix.value=ot.state.spotShadowMatrix,Wt.pointShadowMap.value=ot.state.pointShadowMap,Wt.pointShadowMatrix.value=ot.state.pointShadowMatrix);const Bt=Ot.getUniforms(),re=Qn.seqWithValue(Bt.seq,Wt);return bt.currentProgram=Ot,bt.uniformsList=re,Ot}function ze(at,gt){const yt=H.get(at);yt.outputEncoding=gt.outputEncoding,yt.instancing=gt.instancing,yt.skinning=gt.skinning,yt.morphTargets=gt.morphTargets,yt.morphNormals=gt.morphNormals,yt.morphColors=gt.morphColors,yt.morphTargetsCount=gt.morphTargetsCount,yt.numClippingPlanes=gt.numClippingPlanes,yt.numIntersection=gt.numClipIntersection,yt.vertexAlphas=gt.vertexAlphas,yt.vertexTangents=gt.vertexTangents,yt.toneMapping=gt.toneMapping}function qe(at,gt,yt,bt,ot){gt.isScene!==!0&&(gt=v),j.resetTextureUnits();const Pt=gt.fog,Dt=bt.isMeshStandardMaterial?gt.environment:null,$=b===null?d.outputEncoding:b.isXRRenderTarget===!0?b.texture.encoding:es,kt=(bt.isMeshStandardMaterial?et:it).get(bt.envMap||Dt),Rt=bt.vertexColors===!0&&!!yt.attributes.color&&yt.attributes.color.itemSize===4,Ot=!!bt.normalMap&&!!yt.attributes.tangent,Wt=!!yt.morphAttributes.position,Bt=!!yt.morphAttributes.normal,re=!!yt.morphAttributes.color,Ce=bt.toneMapped?d.toneMapping:Fn,be=yt.morphAttributes.position||yt.morphAttributes.normal||yt.morphAttributes.color,Tt=be!==void 0?be.length:0,Lt=H.get(bt),Yt=u.state.lights;if(T===!0&&(P===!0||at!==z)){const he=at===z&&bt.id===y;J.setState(bt,at,he)}let pe=!1;bt.version===Lt.__version?(Lt.needsLights&&Lt.lightsStateVersion!==Yt.state.version||Lt.outputEncoding!==$||ot.isInstancedMesh&&Lt.instancing===!1||!ot.isInstancedMesh&&Lt.instancing===!0||ot.isSkinnedMesh&&Lt.skinning===!1||!ot.isSkinnedMesh&&Lt.skinning===!0||Lt.envMap!==kt||bt.fog===!0&&Lt.fog!==Pt||Lt.numClippingPlanes!==void 0&&(Lt.numClippingPlanes!==J.numPlanes||Lt.numIntersection!==J.numIntersection)||Lt.vertexAlphas!==Rt||Lt.vertexTangents!==Ot||Lt.morphTargets!==Wt||Lt.morphNormals!==Bt||Lt.morphColors!==re||Lt.toneMapping!==Ce||tt.isWebGL2===!0&&Lt.morphTargetsCount!==Tt)&&(pe=!0):(pe=!0,Lt.__version=bt.version);let Me=Lt.currentProgram;pe===!0&&(Me=me(bt,gt,ot));let fe=!1,ti=!1,di=!1;const Le=Me.getUniforms(),_i=Lt.uniforms;if(Q.useProgram(Me.program)&&(fe=!0,ti=!0,di=!0),bt.id!==y&&(y=bt.id,ti=!0),fe||z!==at){if(Le.setValue(B,"projectionMatrix",at.projectionMatrix),tt.logarithmicDepthBuffer&&Le.setValue(B,"logDepthBufFC",2/(Math.log(at.far+1)/Math.LN2)),z!==at&&(z=at,ti=!0,di=!0),bt.isShaderMaterial||bt.isMeshPhongMaterial||bt.isMeshToonMaterial||bt.isMeshStandardMaterial||bt.envMap){const he=Le.map.cameraPosition;he!==void 0&&he.setValue(B,O.setFromMatrixPosition(at.matrixWorld))}(bt.isMeshPhongMaterial||bt.isMeshToonMaterial||bt.isMeshLambertMaterial||bt.isMeshBasicMaterial||bt.isMeshStandardMaterial||bt.isShaderMaterial)&&Le.setValue(B,"isOrthographic",at.isOrthographicCamera===!0),(bt.isMeshPhongMaterial||bt.isMeshToonMaterial||bt.isMeshLambertMaterial||bt.isMeshBasicMaterial||bt.isMeshStandardMaterial||bt.isShaderMaterial||bt.isShadowMaterial||ot.isSkinnedMesh)&&Le.setValue(B,"viewMatrix",at.matrixWorldInverse)}if(ot.isSkinnedMesh){Le.setOptional(B,ot,"bindMatrix"),Le.setOptional(B,ot,"bindMatrixInverse");const he=ot.skeleton;he&&(tt.floatVertexTextures?(he.boneTexture===null&&he.computeBoneTexture(),Le.setValue(B,"boneTexture",he.boneTexture,j),Le.setValue(B,"boneTextureSize",he.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const yi=yt.morphAttributes;return(yi.position!==void 0||yi.normal!==void 0||yi.color!==void 0&&tt.isWebGL2===!0)&&xt.update(ot,yt,bt,Me),(ti||Lt.receiveShadow!==ot.receiveShadow)&&(Lt.receiveShadow=ot.receiveShadow,Le.setValue(B,"receiveShadow",ot.receiveShadow)),ti&&(Le.setValue(B,"toneMappingExposure",d.toneMappingExposure),Lt.needsLights&&Ee(_i,di),Pt&&bt.fog===!0&&ft.refreshFogUniforms(_i,Pt),ft.refreshMaterialUniforms(_i,bt,V,S,N),Qn.upload(B,Lt.uniformsList,_i,j)),bt.isShaderMaterial&&bt.uniformsNeedUpdate===!0&&(Qn.upload(B,Lt.uniformsList,_i,j),bt.uniformsNeedUpdate=!1),bt.isSpriteMaterial&&Le.setValue(B,"center",ot.center),Le.setValue(B,"modelViewMatrix",ot.modelViewMatrix),Le.setValue(B,"normalMatrix",ot.normalMatrix),Le.setValue(B,"modelMatrix",ot.matrixWorld),Me}function Ee(at,gt){at.ambientLightColor.needsUpdate=gt,at.lightProbe.needsUpdate=gt,at.directionalLights.needsUpdate=gt,at.directionalLightShadows.needsUpdate=gt,at.pointLights.needsUpdate=gt,at.pointLightShadows.needsUpdate=gt,at.spotLights.needsUpdate=gt,at.spotLightShadows.needsUpdate=gt,at.rectAreaLights.needsUpdate=gt,at.hemisphereLights.needsUpdate=gt}function Ut(at){return at.isMeshLambertMaterial||at.isMeshToonMaterial||at.isMeshPhongMaterial||at.isMeshStandardMaterial||at.isShadowMaterial||at.isShaderMaterial&&at.lights===!0}this.getActiveCubeFace=function(){return g},this.getActiveMipmapLevel=function(){return x},this.getRenderTarget=function(){return b},this.setRenderTargetTextures=function(at,gt,yt){H.get(at.texture).__webglTexture=gt,H.get(at.depthTexture).__webglTexture=yt;const bt=H.get(at);bt.__hasExternalTextures=!0,bt.__hasExternalTextures&&(bt.__autoAllocateDepthBuffer=yt===void 0,bt.__autoAllocateDepthBuffer||q.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),bt.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(at,gt){const yt=H.get(at);yt.__webglFramebuffer=gt,yt.__useDefaultFramebuffer=gt===void 0},this.setRenderTarget=function(at,gt=0,yt=0){b=at,g=gt,x=yt;let bt=!0;if(at){const kt=H.get(at);kt.__useDefaultFramebuffer!==void 0?(Q.bindFramebuffer(36160,null),bt=!1):kt.__webglFramebuffer===void 0?j.setupRenderTarget(at):kt.__hasExternalTextures&&j.rebindTextures(at,H.get(at.texture).__webglTexture,H.get(at.depthTexture).__webglTexture)}let ot=null,Pt=!1,Dt=!1;if(at){const kt=at.texture;(kt.isData3DTexture||kt.isDataArrayTexture)&&(Dt=!0);const Rt=H.get(at).__webglFramebuffer;at.isWebGLCubeRenderTarget?(ot=Rt[gt],Pt=!0):tt.isWebGL2&&at.samples>0&&j.useMultisampledRTT(at)===!1?ot=H.get(at).__webglMultisampledFramebuffer:ot=Rt,M.copy(at.viewport),Y.copy(at.scissor),X=at.scissorTest}else M.copy(A).multiplyScalar(V).floor(),Y.copy(Z).multiplyScalar(V).floor(),X=L;if(Q.bindFramebuffer(36160,ot)&&tt.drawBuffers&&bt&&Q.drawBuffers(at,ot),Q.viewport(M),Q.scissor(Y),Q.setScissorTest(X),Pt){const kt=H.get(at.texture);B.framebufferTexture2D(36160,36064,34069+gt,kt.__webglTexture,yt)}else if(Dt){const kt=H.get(at.texture),Rt=gt||0;B.framebufferTextureLayer(36160,36064,kt.__webglTexture,yt||0,Rt)}y=-1},this.readRenderTargetPixels=function(at,gt,yt,bt,ot,Pt,Dt){if(!(at&&at.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let $=H.get(at).__webglFramebuffer;if(at.isWebGLCubeRenderTarget&&Dt!==void 0&&($=$[Dt]),$){Q.bindFramebuffer(36160,$);try{const kt=at.texture,Rt=kt.format,Ot=kt.type;if(Rt!==vn&&ut.convert(Rt)!==B.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Wt=Ot===Fa&&(q.has("EXT_color_buffer_half_float")||tt.isWebGL2&&q.has("EXT_color_buffer_float"));if(Ot!==ys&&ut.convert(Ot)!==B.getParameter(35738)&&!(Ot===ms&&(tt.isWebGL2||q.has("OES_texture_float")||q.has("WEBGL_color_buffer_float")))&&!Wt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}gt>=0&&gt<=at.width-bt&&yt>=0&&yt<=at.height-ot&&B.readPixels(gt,yt,bt,ot,ut.convert(Rt),ut.convert(Ot),Pt)}finally{const kt=b!==null?H.get(b).__webglFramebuffer:null;Q.bindFramebuffer(36160,kt)}}},this.copyFramebufferToTexture=function(at,gt,yt=0){if(gt.isFramebufferTexture!==!0){console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");return}const bt=Math.pow(2,-yt),ot=Math.floor(gt.image.width*bt),Pt=Math.floor(gt.image.height*bt);j.setTexture2D(gt,0),B.copyTexSubImage2D(3553,yt,0,0,at.x,at.y,ot,Pt),Q.unbindTexture()},this.copyTextureToTexture=function(at,gt,yt,bt=0){const ot=gt.image.width,Pt=gt.image.height,Dt=ut.convert(yt.format),$=ut.convert(yt.type);j.setTexture2D(yt,0),B.pixelStorei(37440,yt.flipY),B.pixelStorei(37441,yt.premultiplyAlpha),B.pixelStorei(3317,yt.unpackAlignment),gt.isDataTexture?B.texSubImage2D(3553,bt,at.x,at.y,ot,Pt,Dt,$,gt.image.data):gt.isCompressedTexture?B.compressedTexSubImage2D(3553,bt,at.x,at.y,gt.mipmaps[0].width,gt.mipmaps[0].height,Dt,gt.mipmaps[0].data):B.texSubImage2D(3553,bt,at.x,at.y,Dt,$,gt.image),bt===0&&yt.generateMipmaps&&B.generateMipmap(3553),Q.unbindTexture()},this.copyTextureToTexture3D=function(at,gt,yt,bt,ot=0){if(d.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const Pt=at.max.x-at.min.x+1,Dt=at.max.y-at.min.y+1,$=at.max.z-at.min.z+1,kt=ut.convert(bt.format),Rt=ut.convert(bt.type);let Ot;if(bt.isData3DTexture)j.setTexture3D(bt,0),Ot=32879;else if(bt.isDataArrayTexture)j.setTexture2DArray(bt,0),Ot=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}B.pixelStorei(37440,bt.flipY),B.pixelStorei(37441,bt.premultiplyAlpha),B.pixelStorei(3317,bt.unpackAlignment);const Wt=B.getParameter(3314),Bt=B.getParameter(32878),re=B.getParameter(3316),Ce=B.getParameter(3315),be=B.getParameter(32877),Tt=yt.isCompressedTexture?yt.mipmaps[0]:yt.image;B.pixelStorei(3314,Tt.width),B.pixelStorei(32878,Tt.height),B.pixelStorei(3316,at.min.x),B.pixelStorei(3315,at.min.y),B.pixelStorei(32877,at.min.z),yt.isDataTexture||yt.isData3DTexture?B.texSubImage3D(Ot,ot,gt.x,gt.y,gt.z,Pt,Dt,$,kt,Rt,Tt.data):yt.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),B.compressedTexSubImage3D(Ot,ot,gt.x,gt.y,gt.z,Pt,Dt,$,kt,Tt.data)):B.texSubImage3D(Ot,ot,gt.x,gt.y,gt.z,Pt,Dt,$,kt,Rt,Tt),B.pixelStorei(3314,Wt),B.pixelStorei(32878,Bt),B.pixelStorei(3316,re),B.pixelStorei(3315,Ce),B.pixelStorei(32877,be),ot===0&&bt.generateMipmaps&&B.generateMipmap(Ot),Q.unbindTexture()},this.initTexture=function(at){j.setTexture2D(at,0),Q.unbindTexture()},this.resetState=function(){g=0,x=0,b=null,Q.reset(),Zt.reset()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Vi.prototype.isWebGLRenderer=!0;class E2 extends Vi{}E2.prototype.isWebGL1Renderer=!0;class El extends Ti{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),e}}El.prototype.isScene=!0;class Ja{constructor(t,e){this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=Oa,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=An()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let n=0,s=this.stride;n<s;n++)this.array[t+n]=e.array[i+n];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=An()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=An()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}Ja.prototype.isInterleavedBuffer=!0;const en=new wt;class Ga{constructor(t,e,i,n=!1){this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=n===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)en.fromBufferAttribute(this,e),en.applyMatrix4(t),this.setXYZ(e,en.x,en.y,en.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)en.fromBufferAttribute(this,e),en.applyNormalMatrix(t),this.setXYZ(e,en.x,en.y,en.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)en.fromBufferAttribute(this,e),en.transformDirection(t),this.setXYZ(e,en.x,en.y,en.z);return this}setX(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this}setXYZW(t,e,i,n,s){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this.data.array[t+3]=s,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let i=0;i<this.count;i++){const n=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)e.push(this.data.array[n+s])}return new Bi(new this.array.constructor(e),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Ga(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let i=0;i<this.count;i++){const n=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)e.push(this.data.array[n+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}Ga.prototype.isInterleavedBufferAttribute=!0;class Cl extends Gi{constructor(t){super(),this.type="SpriteMaterial",this.color=new fi(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}Cl.prototype.isSpriteMaterial=!0;let Ns;const wa=new wt,Fs=new wt,Os=new wt,Us=new Ne,Xa=new Ne,Yc=new vi,yo=new wt,Ia=new wt,Mo=new wt,bh=new Ne,qr=new Ne,yh=new Ne;class C2 extends Ti{constructor(t){if(super(),this.type="Sprite",Ns===void 0){Ns=new Ei;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new Ja(e,5);Ns.setIndex([0,1,2,0,2,3]),Ns.setAttribute("position",new Ga(i,3,0,!1)),Ns.setAttribute("uv",new Ga(i,2,3,!1))}this.geometry=Ns,this.material=t!==void 0?t:new Cl,this.center=new Ne(.5,.5)}raycast(t,e){t.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Fs.setFromMatrixScale(this.matrixWorld),Yc.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Os.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Fs.multiplyScalar(-Os.z);const i=this.material.rotation;let n,s;i!==0&&(s=Math.cos(i),n=Math.sin(i));const o=this.center;wo(yo.set(-.5,-.5,0),Os,o,Fs,n,s),wo(Ia.set(.5,-.5,0),Os,o,Fs,n,s),wo(Mo.set(.5,.5,0),Os,o,Fs,n,s),bh.set(0,0),qr.set(1,0),yh.set(1,1);let r=t.ray.intersectTriangle(yo,Ia,Mo,!1,wa);if(r===null&&(wo(Ia.set(-.5,.5,0),Os,o,Fs,n,s),qr.set(0,1),r=t.ray.intersectTriangle(yo,Mo,Ia,!1,wa),r===null))return;const _=t.ray.origin.distanceTo(wa);_<t.near||_>t.far||e.push({distance:_,point:wa.clone(),uv:Fi.getUV(wa,yo,Ia,Mo,bh,qr,yh,new Ne),face:null,object:this})}copy(t){return super.copy(t),t.center!==void 0&&this.center.copy(t.center),this.material=t.material,this}}C2.prototype.isSprite=!0;function wo(c,t,e,i,n,s){Us.subVectors(c,e).addScalar(.5).multiply(i),n!==void 0?(Xa.x=s*Us.x-n*Us.y,Xa.y=n*Us.x+s*Us.y):Xa.copy(Us),c.copy(t),c.x+=Xa.x,c.y+=Xa.y,c.applyMatrix4(Yc)}const Mh=new wt,wh=new Li,Xh=new Li,P2=new wt,Ih=new vi;class Zc extends sn{constructor(t,e){super(t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new vi,this.bindMatrixInverse=new vi}copy(t){return super.copy(t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Li,e=this.geometry.attributes.skinWeight;for(let i=0,n=e.count;i<n;i++){t.fromBufferAttribute(e,i);const s=1/t.manhattanLength();s!==1/0?t.multiplyScalar(s):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,e){const i=this.skeleton,n=this.geometry;wh.fromBufferAttribute(n.attributes.skinIndex,t),Xh.fromBufferAttribute(n.attributes.skinWeight,t),Mh.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let s=0;s<4;s++){const o=Xh.getComponent(s);if(o!==0){const r=wh.getComponent(s);Ih.multiplyMatrices(i.bones[r].matrixWorld,i.boneInverses[r]),e.addScaledVector(P2.copy(Mh).applyMatrix4(Ih),o)}}return e.applyMatrix4(this.bindMatrixInverse)}}Zc.prototype.isSkinnedMesh=!0;class R2 extends Ti{constructor(){super(),this.type="Bone"}}R2.prototype.isBone=!0;class k2 extends $i{constructor(t=null,e=1,i=1,n,s,o,r,_,a=ji,l=ji,h,u){super(null,o,r,_,a,l,n,s,h,u),this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}k2.prototype.isDataTexture=!0;class ml extends Bi{constructor(t,e,i,n=1){typeof i=="number"&&(n=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(t,e,i),this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}ml.prototype.isInstancedBufferAttribute=!0;const zh=new vi,Sh=new vi,Xo=[],za=new sn;class B2 extends sn{constructor(t,e,i){super(t,e),this.instanceMatrix=new ml(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(t){return super.copy(t),this.instanceMatrix.copy(t.instanceMatrix),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,t*16)}raycast(t,e){const i=this.matrixWorld,n=this.count;if(za.geometry=this.geometry,za.material=this.material,za.material!==void 0)for(let s=0;s<n;s++){this.getMatrixAt(s,zh),Sh.multiplyMatrices(i,zh),za.matrixWorld=Sh,za.raycast(t,Xo);for(let o=0,r=Xo.length;o<r;o++){const _=Xo[o];_.instanceId=s,_.object=this,e.push(_)}Xo.length=0}}setColorAt(t,e){this.instanceColor===null&&(this.instanceColor=new ml(new Float32Array(this.instanceMatrix.count*3),3)),e.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,t*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}B2.prototype.isInstancedMesh=!0;class ca extends Gi{constructor(t){super(),this.type="LineBasicMaterial",this.color=new fi(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}ca.prototype.isLineBasicMaterial=!0;const Yh=new wt,Zh=new wt,Lh=new vi,Jr=new _a,Io=new la;class Pl extends Ti{constructor(t=new Ei,e=new ca){super(),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(t.index===null){const e=t.attributes.position,i=[0];for(let n=1,s=e.count;n<s;n++)Yh.fromBufferAttribute(e,n-1),Zh.fromBufferAttribute(e,n),i[n]=i[n-1],i[n]+=Yh.distanceTo(Zh);t.setAttribute("lineDistance",new Ji(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,s=t.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Io.copy(i.boundingSphere),Io.applyMatrix4(n),Io.radius+=s,t.ray.intersectsSphere(Io)===!1)return;Lh.copy(n).invert(),Jr.copy(t.ray).applyMatrix4(Lh);const r=s/((this.scale.x+this.scale.y+this.scale.z)/3),_=r*r,a=new wt,l=new wt,h=new wt,u=new wt,f=this.isLineSegments?2:1;if(i.isBufferGeometry){const m=i.index,p=i.attributes.position;if(m!==null){const g=Math.max(0,o.start),x=Math.min(m.count,o.start+o.count);for(let b=g,y=x-1;b<y;b+=f){const z=m.getX(b),M=m.getX(b+1);if(a.fromBufferAttribute(p,z),l.fromBufferAttribute(p,M),Jr.distanceSqToSegment(a,l,u,h)>_)continue;u.applyMatrix4(this.matrixWorld);const X=t.ray.origin.distanceTo(u);X<t.near||X>t.far||e.push({distance:X,point:h.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}else{const g=Math.max(0,o.start),x=Math.min(p.count,o.start+o.count);for(let b=g,y=x-1;b<y;b+=f){if(a.fromBufferAttribute(p,b),l.fromBufferAttribute(p,b+1),Jr.distanceSqToSegment(a,l,u,h)>_)continue;u.applyMatrix4(this.matrixWorld);const M=t.ray.origin.distanceTo(u);M<t.near||M>t.far||e.push({distance:M,point:h.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const n=e[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=n.length;s<o;s++){const r=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=s}}}}else{const e=t.morphTargets;e!==void 0&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Pl.prototype.isLine=!0;const Ah=new wt,Th=new wt;class Rl extends Pl{constructor(t,e){super(t,e),this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(t.index===null){const e=t.attributes.position,i=[];for(let n=0,s=e.count;n<s;n+=2)Ah.fromBufferAttribute(e,n),Th.fromBufferAttribute(e,n+1),i[n]=n===0?0:i[n-1],i[n+1]=i[n]+Ah.distanceTo(Th);t.setAttribute("lineDistance",new Ji(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}Rl.prototype.isLineSegments=!0;class D2 extends Pl{constructor(t,e){super(t,e),this.type="LineLoop"}}D2.prototype.isLineLoop=!0;class kl extends Gi{constructor(t){super(),this.type="PointsMaterial",this.color=new fi(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}kl.prototype.isPointsMaterial=!0;const Vh=new vi,fl=new _a,zo=new la,So=new wt;class N2 extends Ti{constructor(t=new Ei,e=new kl){super(),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,s=t.params.Points.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),zo.copy(i.boundingSphere),zo.applyMatrix4(n),zo.radius+=s,t.ray.intersectsSphere(zo)===!1)return;Vh.copy(n).invert(),fl.copy(t.ray).applyMatrix4(Vh);const r=s/((this.scale.x+this.scale.y+this.scale.z)/3),_=r*r;if(i.isBufferGeometry){const a=i.index,h=i.attributes.position;if(a!==null){const u=Math.max(0,o.start),f=Math.min(a.count,o.start+o.count);for(let m=u,d=f;m<d;m++){const p=a.getX(m);So.fromBufferAttribute(h,p),Eh(So,p,_,n,t,e,this)}}else{const u=Math.max(0,o.start),f=Math.min(h.count,o.start+o.count);for(let m=u,d=f;m<d;m++)So.fromBufferAttribute(h,m),Eh(So,m,_,n,t,e,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const n=e[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=n.length;s<o;s++){const r=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=s}}}}else{const e=t.morphTargets;e!==void 0&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}N2.prototype.isPoints=!0;function Eh(c,t,e,i,n,s,o){const r=fl.distanceSqToPoint(c);if(r<e){const _=new wt;fl.closestPointToPoint(c,_),_.applyMatrix4(i);const a=n.ray.origin.distanceTo(_);if(a<n.near||a>n.far)return;s.push({distance:a,distanceToRay:Math.sqrt(r),point:_,index:t,face:null,object:o})}}class F2 extends $i{constructor(t,e,i,n,s,o,r,_,a){super(t,e,i,n,s,o,r,_,a),this.minFilter=o!==void 0?o:rn,this.magFilter=s!==void 0?s:rn,this.generateMipmaps=!1;const l=this;function h(){l.needsUpdate=!0,t.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(h)}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;"requestVideoFrameCallback"in t===!1&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}F2.prototype.isVideoTexture=!0;class O2 extends $i{constructor(t,e,i){super({width:t,height:e}),this.format=i,this.magFilter=ji,this.minFilter=ji,this.generateMipmaps=!1,this.needsUpdate=!0}}O2.prototype.isFramebufferTexture=!0;class U2 extends $i{constructor(t,e,i,n,s,o,r,_,a,l,h,u){super(null,o,r,_,a,l,n,s,h,u),this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}U2.prototype.isCompressedTexture=!0;class G2 extends $i{constructor(t,e,i,n,s,o,r,_,a){super(t,e,i,n,s,o,r,_,a),this.needsUpdate=!0}}G2.prototype.isCanvasTexture=!0;class pn{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const i=this.getUtoTmapping(t);return this.getPoint(i,e)}getPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e}getSpacedPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let i,n=this.getPoint(0),s=0;e.push(0);for(let o=1;o<=t;o++)i=this.getPoint(o/t),s+=i.distanceTo(n),e.push(s),n=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const i=this.getLengths();let n=0;const s=i.length;let o;e?o=e:o=t*i[s-1];let r=0,_=s-1,a;for(;r<=_;)if(n=Math.floor(r+(_-r)/2),a=i[n]-o,a<0)r=n+1;else if(a>0)_=n-1;else{_=n;break}if(n=_,i[n]===o)return n/(s-1);const l=i[n],u=i[n+1]-l,f=(o-l)/u;return(n+f)/(s-1)}getTangent(t,e){let n=t-1e-4,s=t+1e-4;n<0&&(n=0),s>1&&(s=1);const o=this.getPoint(n),r=this.getPoint(s),_=e||(o.isVector2?new Ne:new wt);return _.copy(r).sub(o).normalize(),_}getTangentAt(t,e){const i=this.getUtoTmapping(t);return this.getTangent(i,e)}computeFrenetFrames(t,e){const i=new wt,n=[],s=[],o=[],r=new wt,_=new vi;for(let f=0;f<=t;f++){const m=f/t;n[f]=this.getTangentAt(m,new wt)}s[0]=new wt,o[0]=new wt;let a=Number.MAX_VALUE;const l=Math.abs(n[0].x),h=Math.abs(n[0].y),u=Math.abs(n[0].z);l<=a&&(a=l,i.set(1,0,0)),h<=a&&(a=h,i.set(0,1,0)),u<=a&&i.set(0,0,1),r.crossVectors(n[0],i).normalize(),s[0].crossVectors(n[0],r),o[0].crossVectors(n[0],s[0]);for(let f=1;f<=t;f++){if(s[f]=s[f-1].clone(),o[f]=o[f-1].clone(),r.crossVectors(n[f-1],n[f]),r.length()>Number.EPSILON){r.normalize();const m=Math.acos(tn(n[f-1].dot(n[f]),-1,1));s[f].applyMatrix4(_.makeRotationAxis(r,m))}o[f].crossVectors(n[f],s[f])}if(e===!0){let f=Math.acos(tn(s[0].dot(s[t]),-1,1));f/=t,n[0].dot(r.crossVectors(s[0],s[t]))>0&&(f=-f);for(let m=1;m<=t;m++)s[m].applyMatrix4(_.makeRotationAxis(n[m],f*m)),o[m].crossVectors(n[m],s[m])}return{tangents:n,normals:s,binormals:o}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class ar extends pn{constructor(t=0,e=0,i=1,n=1,s=0,o=Math.PI*2,r=!1,_=0){super(),this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=n,this.aStartAngle=s,this.aEndAngle=o,this.aClockwise=r,this.aRotation=_}getPoint(t,e){const i=e||new Ne,n=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const o=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=n;for(;s>n;)s-=n;s<Number.EPSILON&&(o?s=0:s=n),this.aClockwise===!0&&!o&&(s===n?s=-n:s=s-n);const r=this.aStartAngle+t*s;let _=this.aX+this.xRadius*Math.cos(r),a=this.aY+this.yRadius*Math.sin(r);if(this.aRotation!==0){const l=Math.cos(this.aRotation),h=Math.sin(this.aRotation),u=_-this.aX,f=a-this.aY;_=u*l-f*h+this.aX,a=u*h+f*l+this.aY}return i.set(_,a)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}ar.prototype.isEllipseCurve=!0;class Lc extends ar{constructor(t,e,i,n,s,o){super(t,e,i,i,n,s,o),this.type="ArcCurve"}}Lc.prototype.isArcCurve=!0;function Bl(){let c=0,t=0,e=0,i=0;function n(s,o,r,_){c=s,t=r,e=-3*s+3*o-2*r-_,i=2*s-2*o+r+_}return{initCatmullRom:function(s,o,r,_,a){n(o,r,a*(r-s),a*(_-o))},initNonuniformCatmullRom:function(s,o,r,_,a,l,h){let u=(o-s)/a-(r-s)/(a+l)+(r-o)/l,f=(r-o)/l-(_-o)/(l+h)+(_-r)/h;u*=l,f*=l,n(o,r,u,f)},calc:function(s){const o=s*s,r=o*s;return c+t*s+e*o+i*r}}}const Yo=new wt,$r=new Bl,Kr=new Bl,Qr=new Bl;class Ac extends pn{constructor(t=[],e=!1,i="centripetal",n=.5){super(),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=i,this.tension=n}getPoint(t,e=new wt){const i=e,n=this.points,s=n.length,o=(s-(this.closed?0:1))*t;let r=Math.floor(o),_=o-r;this.closed?r+=r>0?0:(Math.floor(Math.abs(r)/s)+1)*s:_===0&&r===s-1&&(r=s-2,_=1);let a,l;this.closed||r>0?a=n[(r-1)%s]:(Yo.subVectors(n[0],n[1]).add(n[0]),a=Yo);const h=n[r%s],u=n[(r+1)%s];if(this.closed||r+2<s?l=n[(r+2)%s]:(Yo.subVectors(n[s-1],n[s-2]).add(n[s-1]),l=Yo),this.curveType==="centripetal"||this.curveType==="chordal"){const f=this.curveType==="chordal"?.5:.25;let m=Math.pow(a.distanceToSquared(h),f),d=Math.pow(h.distanceToSquared(u),f),p=Math.pow(u.distanceToSquared(l),f);d<1e-4&&(d=1),m<1e-4&&(m=d),p<1e-4&&(p=d),$r.initNonuniformCatmullRom(a.x,h.x,u.x,l.x,m,d,p),Kr.initNonuniformCatmullRom(a.y,h.y,u.y,l.y,m,d,p),Qr.initNonuniformCatmullRom(a.z,h.z,u.z,l.z,m,d,p)}else this.curveType==="catmullrom"&&($r.initCatmullRom(a.x,h.x,u.x,l.x,this.tension),Kr.initCatmullRom(a.y,h.y,u.y,l.y,this.tension),Qr.initCatmullRom(a.z,h.z,u.z,l.z,this.tension));return i.set($r.calc(_),Kr.calc(_),Qr.calc(_)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const n=t.points[e];this.points.push(new wt().fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}Ac.prototype.isCatmullRomCurve3=!0;function Ch(c,t,e,i,n){const s=(i-t)*.5,o=(n-e)*.5,r=c*c,_=c*r;return(2*e-2*i+s+o)*_+(-3*e+3*i-2*s-o)*r+s*c+e}function H2(c,t){const e=1-c;return e*e*t}function W2(c,t){return 2*(1-c)*c*t}function j2(c,t){return c*c*t}function Va(c,t,e,i){return H2(c,t)+W2(c,e)+j2(c,i)}function q2(c,t){const e=1-c;return e*e*e*t}function J2(c,t){const e=1-c;return 3*e*e*c*t}function $2(c,t){return 3*(1-c)*c*c*t}function K2(c,t){return c*c*c*t}function Ea(c,t,e,i,n){return q2(c,t)+J2(c,e)+$2(c,i)+K2(c,n)}class Dl extends pn{constructor(t=new Ne,e=new Ne,i=new Ne,n=new Ne){super(),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new Ne){const i=e,n=this.v0,s=this.v1,o=this.v2,r=this.v3;return i.set(Ea(t,n.x,s.x,o.x,r.x),Ea(t,n.y,s.y,o.y,r.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Dl.prototype.isCubicBezierCurve=!0;class Tc extends pn{constructor(t=new wt,e=new wt,i=new wt,n=new wt){super(),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new wt){const i=e,n=this.v0,s=this.v1,o=this.v2,r=this.v3;return i.set(Ea(t,n.x,s.x,o.x,r.x),Ea(t,n.y,s.y,o.y,r.y),Ea(t,n.z,s.z,o.z,r.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Tc.prototype.isCubicBezierCurve3=!0;class or extends pn{constructor(t=new Ne,e=new Ne){super(),this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Ne){const i=e;return t===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const i=e||new Ne;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}or.prototype.isLineCurve=!0;class Q2 extends pn{constructor(t=new wt,e=new wt){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=t,this.v2=e}getPoint(t,e=new wt){const i=e;return t===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Nl extends pn{constructor(t=new Ne,e=new Ne,i=new Ne){super(),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new Ne){const i=e,n=this.v0,s=this.v1,o=this.v2;return i.set(Va(t,n.x,s.x,o.x),Va(t,n.y,s.y,o.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Nl.prototype.isQuadraticBezierCurve=!0;class Vc extends pn{constructor(t=new wt,e=new wt,i=new wt){super(),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new wt){const i=e,n=this.v0,s=this.v1,o=this.v2;return i.set(Va(t,n.x,s.x,o.x),Va(t,n.y,s.y,o.y),Va(t,n.z,s.z,o.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Vc.prototype.isQuadraticBezierCurve3=!0;class Fl extends pn{constructor(t=[]){super(),this.type="SplineCurve",this.points=t}getPoint(t,e=new Ne){const i=e,n=this.points,s=(n.length-1)*t,o=Math.floor(s),r=s-o,_=n[o===0?o:o-1],a=n[o],l=n[o>n.length-2?n.length-1:o+1],h=n[o>n.length-3?n.length-1:o+2];return i.set(Ch(r,_.x,a.x,l.x,h.x),Ch(r,_.y,a.y,l.y,h.y)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const n=t.points[e];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const n=this.points[e];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const n=t.points[e];this.points.push(new Ne().fromArray(n))}return this}}Fl.prototype.isSplineCurve=!0;var Ec=Object.freeze({__proto__:null,ArcCurve:Lc,CatmullRomCurve3:Ac,CubicBezierCurve:Dl,CubicBezierCurve3:Tc,EllipseCurve:ar,LineCurve:or,LineCurve3:Q2,QuadraticBezierCurve:Nl,QuadraticBezierCurve3:Vc,SplineCurve:Fl});class tg extends pn{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new or(e,t))}getPoint(t,e){const i=t*this.getLength(),n=this.getCurveLengths();let s=0;for(;s<n.length;){if(n[s]>=i){const o=n[s]-i,r=this.curves[s],_=r.getLength(),a=_===0?0:1-o/_;return r.getPointAt(a,e)}s++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let i=0,n=this.curves.length;i<n;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let i;for(let n=0,s=this.curves;n<s.length;n++){const o=s[n],r=o.isEllipseCurve?t*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?t*o.points.length:t,_=o.getPoints(r);for(let a=0;a<_.length;a++){const l=_[a];i&&i.equals(l)||(e.push(l),i=l)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,i=this.curves.length;e<i;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const n=t.curves[e];this.curves.push(new Ec[n.type]().fromJSON(n))}return this}}class dl extends tg{constructor(t){super(),this.type="Path",this.currentPoint=new Ne,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const i=new or(this.currentPoint.clone(),new Ne(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,i,n){const s=new Nl(this.currentPoint.clone(),new Ne(t,e),new Ne(i,n));return this.curves.push(s),this.currentPoint.set(i,n),this}bezierCurveTo(t,e,i,n,s,o){const r=new Dl(this.currentPoint.clone(),new Ne(t,e),new Ne(i,n),new Ne(s,o));return this.curves.push(r),this.currentPoint.set(s,o),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),i=new Fl(e);return this.curves.push(i),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,i,n,s,o){const r=this.currentPoint.x,_=this.currentPoint.y;return this.absarc(t+r,e+_,i,n,s,o),this}absarc(t,e,i,n,s,o){return this.absellipse(t,e,i,i,n,s,o),this}ellipse(t,e,i,n,s,o,r,_){const a=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(t+a,e+l,i,n,s,o,r,_),this}absellipse(t,e,i,n,s,o,r,_){const a=new ar(t,e,i,n,s,o,r,_);if(this.curves.length>0){const h=a.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(a);const l=a.getPoint(1);return this.currentPoint.copy(l),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}new wt;new wt;new wt;new Fi;class $a extends dl{constructor(t){super(t),this.uuid=An(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let i=0,n=this.holes.length;i<n;i++)e[i]=this.holes[i].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const n=t.holes[e];this.holes.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,i=this.holes.length;e<i;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const n=t.holes[e];this.holes.push(new dl().fromJSON(n))}return this}}const eg={triangulate:function(c,t,e=2){const i=t&&t.length,n=i?t[0]*e:c.length;let s=Cc(c,0,n,e,!0);const o=[];if(!s||s.next===s.prev)return o;let r,_,a,l,h,u,f;if(i&&(s=og(c,t,s,e)),c.length>80*e){r=a=c[0],_=l=c[1];for(let m=e;m<n;m+=e)h=c[m],u=c[m+1],h<r&&(r=h),u<_&&(_=u),h>a&&(a=h),u>l&&(l=u);f=Math.max(a-r,l-_),f=f!==0?1/f:0}return Ha(s,o,e,r,_,f),o}};function Cc(c,t,e,i,n){let s,o;if(n===gg(c,t,e,i)>0)for(s=t;s<e;s+=i)o=Ph(s,c[s],c[s+1],o);else for(s=e-i;s>=t;s-=i)o=Ph(s,c[s],c[s+1],o);return o&&rr(o,o.next)&&(ja(o),o=o.next),o}function is(c,t){if(!c)return c;t||(t=c);let e=c,i;do if(i=!1,!e.steiner&&(rr(e,e.next)||Ri(e.prev,e,e.next)===0)){if(ja(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function Ha(c,t,e,i,n,s,o){if(!c)return;!o&&s&&cg(c,i,n,s);let r=c,_,a;for(;c.prev!==c.next;){if(_=c.prev,a=c.next,s?ng(c,i,n,s):ig(c)){t.push(_.i/e),t.push(c.i/e),t.push(a.i/e),ja(c),c=a.next,r=a.next;continue}if(c=a,c===r){o?o===1?(c=sg(is(c),t,e),Ha(c,t,e,i,n,s,2)):o===2&&ag(c,t,e,i,n,s):Ha(is(c),t,e,i,n,s,1);break}}}function ig(c){const t=c.prev,e=c,i=c.next;if(Ri(t,e,i)>=0)return!1;let n=c.next.next;for(;n!==c.prev;){if(Js(t.x,t.y,e.x,e.y,i.x,i.y,n.x,n.y)&&Ri(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function ng(c,t,e,i){const n=c.prev,s=c,o=c.next;if(Ri(n,s,o)>=0)return!1;const r=n.x<s.x?n.x<o.x?n.x:o.x:s.x<o.x?s.x:o.x,_=n.y<s.y?n.y<o.y?n.y:o.y:s.y<o.y?s.y:o.y,a=n.x>s.x?n.x>o.x?n.x:o.x:s.x>o.x?s.x:o.x,l=n.y>s.y?n.y>o.y?n.y:o.y:s.y>o.y?s.y:o.y,h=gl(r,_,t,e,i),u=gl(a,l,t,e,i);let f=c.prevZ,m=c.nextZ;for(;f&&f.z>=h&&m&&m.z<=u;){if(f!==c.prev&&f!==c.next&&Js(n.x,n.y,s.x,s.y,o.x,o.y,f.x,f.y)&&Ri(f.prev,f,f.next)>=0||(f=f.prevZ,m!==c.prev&&m!==c.next&&Js(n.x,n.y,s.x,s.y,o.x,o.y,m.x,m.y)&&Ri(m.prev,m,m.next)>=0))return!1;m=m.nextZ}for(;f&&f.z>=h;){if(f!==c.prev&&f!==c.next&&Js(n.x,n.y,s.x,s.y,o.x,o.y,f.x,f.y)&&Ri(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;m&&m.z<=u;){if(m!==c.prev&&m!==c.next&&Js(n.x,n.y,s.x,s.y,o.x,o.y,m.x,m.y)&&Ri(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function sg(c,t,e){let i=c;do{const n=i.prev,s=i.next.next;!rr(n,s)&&Pc(n,i,i.next,s)&&Wa(n,s)&&Wa(s,n)&&(t.push(n.i/e),t.push(i.i/e),t.push(s.i/e),ja(i),ja(i.next),i=c=s),i=i.next}while(i!==c);return is(i)}function ag(c,t,e,i,n,s){let o=c;do{let r=o.next.next;for(;r!==o.prev;){if(o.i!==r.i&&mg(o,r)){let _=Rc(o,r);o=is(o,o.next),_=is(_,_.next),Ha(o,t,e,i,n,s),Ha(_,t,e,i,n,s);return}r=r.next}o=o.next}while(o!==c)}function og(c,t,e,i){const n=[];let s,o,r,_,a;for(s=0,o=t.length;s<o;s++)r=t[s]*i,_=s<o-1?t[s+1]*i:c.length,a=Cc(c,r,_,i,!1),a===a.next&&(a.steiner=!0),n.push(pg(a));for(n.sort(rg),s=0;s<n.length;s++)lg(n[s],e),e=is(e,e.next);return e}function rg(c,t){return c.x-t.x}function lg(c,t){if(t=_g(c,t),t){const e=Rc(t,c);is(t,t.next),is(e,e.next)}}function _g(c,t){let e=t;const i=c.x,n=c.y;let s=-1/0,o;do{if(n<=e.y&&n>=e.next.y&&e.next.y!==e.y){const u=e.x+(n-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(u<=i&&u>s){if(s=u,u===i){if(n===e.y)return e;if(n===e.next.y)return e.next}o=e.x<e.next.x?e:e.next}}e=e.next}while(e!==t);if(!o)return null;if(i===s)return o;const r=o,_=o.x,a=o.y;let l=1/0,h;e=o;do i>=e.x&&e.x>=_&&i!==e.x&&Js(n<a?i:s,n,_,a,n<a?s:i,n,e.x,e.y)&&(h=Math.abs(n-e.y)/(i-e.x),Wa(e,c)&&(h<l||h===l&&(e.x>o.x||e.x===o.x&&hg(o,e)))&&(o=e,l=h)),e=e.next;while(e!==r);return o}function hg(c,t){return Ri(c.prev,c,t.prev)<0&&Ri(t.next,c,c.next)<0}function cg(c,t,e,i){let n=c;do n.z===null&&(n.z=gl(n.x,n.y,t,e,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==c);n.prevZ.nextZ=null,n.prevZ=null,ug(n)}function ug(c){let t,e,i,n,s,o,r,_,a=1;do{for(e=c,c=null,s=null,o=0;e;){for(o++,i=e,r=0,t=0;t<a&&(r++,i=i.nextZ,!!i);t++);for(_=a;r>0||_>0&&i;)r!==0&&(_===0||!i||e.z<=i.z)?(n=e,e=e.nextZ,r--):(n=i,i=i.nextZ,_--),s?s.nextZ=n:c=n,n.prevZ=s,s=n;e=i}s.nextZ=null,a*=2}while(o>1);return c}function gl(c,t,e,i,n){return c=32767*(c-e)*n,t=32767*(t-i)*n,c=(c|c<<8)&16711935,c=(c|c<<4)&252645135,c=(c|c<<2)&858993459,c=(c|c<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,c|t<<1}function pg(c){let t=c,e=c;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==c);return e}function Js(c,t,e,i,n,s,o,r){return(n-o)*(t-r)-(c-o)*(s-r)>=0&&(c-o)*(i-r)-(e-o)*(t-r)>=0&&(e-o)*(s-r)-(n-o)*(i-r)>=0}function mg(c,t){return c.next.i!==t.i&&c.prev.i!==t.i&&!fg(c,t)&&(Wa(c,t)&&Wa(t,c)&&dg(c,t)&&(Ri(c.prev,c,t.prev)||Ri(c,t.prev,t))||rr(c,t)&&Ri(c.prev,c,c.next)>0&&Ri(t.prev,t,t.next)>0)}function Ri(c,t,e){return(t.y-c.y)*(e.x-t.x)-(t.x-c.x)*(e.y-t.y)}function rr(c,t){return c.x===t.x&&c.y===t.y}function Pc(c,t,e,i){const n=Lo(Ri(c,t,e)),s=Lo(Ri(c,t,i)),o=Lo(Ri(e,i,c)),r=Lo(Ri(e,i,t));return!!(n!==s&&o!==r||n===0&&Zo(c,e,t)||s===0&&Zo(c,i,t)||o===0&&Zo(e,c,i)||r===0&&Zo(e,t,i))}function Zo(c,t,e){return t.x<=Math.max(c.x,e.x)&&t.x>=Math.min(c.x,e.x)&&t.y<=Math.max(c.y,e.y)&&t.y>=Math.min(c.y,e.y)}function Lo(c){return c>0?1:c<0?-1:0}function fg(c,t){let e=c;do{if(e.i!==c.i&&e.next.i!==c.i&&e.i!==t.i&&e.next.i!==t.i&&Pc(e,e.next,c,t))return!0;e=e.next}while(e!==c);return!1}function Wa(c,t){return Ri(c.prev,c,c.next)<0?Ri(c,t,c.next)>=0&&Ri(c,c.prev,t)>=0:Ri(c,t,c.prev)<0||Ri(c,c.next,t)<0}function dg(c,t){let e=c,i=!1;const n=(c.x+t.x)/2,s=(c.y+t.y)/2;do e.y>s!=e.next.y>s&&e.next.y!==e.y&&n<(e.next.x-e.x)*(s-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==c);return i}function Rc(c,t){const e=new xl(c.i,c.x,c.y),i=new xl(t.i,t.x,t.y),n=c.next,s=t.prev;return c.next=t,t.prev=c,e.next=n,n.prev=e,i.next=e,e.prev=i,s.next=i,i.prev=s,i}function Ph(c,t,e,i){const n=new xl(c,t,e);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function ja(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function xl(c,t,e){this.i=c,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function gg(c,t,e,i){let n=0;for(let s=t,o=e-i;s<e;s+=i)n+=(c[o]-c[s])*(c[s+1]+c[o+1]),o=s;return n}class ts{static area(t){const e=t.length;let i=0;for(let n=e-1,s=0;s<e;n=s++)i+=t[n].x*t[s].y-t[s].x*t[n].y;return i*.5}static isClockWise(t){return ts.area(t)<0}static triangulateShape(t,e){const i=[],n=[],s=[];Rh(t),kh(i,t);let o=t.length;e.forEach(Rh);for(let _=0;_<e.length;_++)n.push(o),o+=e[_].length,kh(i,e[_]);const r=eg.triangulate(i,n);for(let _=0;_<r.length;_+=3)s.push(r.slice(_,_+3));return s}}function Rh(c){const t=c.length;t>2&&c[t-1].equals(c[0])&&c.pop()}function kh(c,t){for(let e=0;e<t.length;e++)c.push(t[e].x),c.push(t[e].y)}class ua extends Ei{constructor(t=new $a([new Ne(.5,.5),new Ne(-.5,.5),new Ne(-.5,-.5),new Ne(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const i=this,n=[],s=[];for(let r=0,_=t.length;r<_;r++){const a=t[r];o(a)}this.setAttribute("position",new Ji(n,3)),this.setAttribute("uv",new Ji(s,2)),this.computeVertexNormals();function o(r){const _=[],a=e.curveSegments!==void 0?e.curveSegments:12,l=e.steps!==void 0?e.steps:1;let h=e.depth!==void 0?e.depth:1,u=e.bevelEnabled!==void 0?e.bevelEnabled:!0,f=e.bevelThickness!==void 0?e.bevelThickness:.2,m=e.bevelSize!==void 0?e.bevelSize:f-.1,d=e.bevelOffset!==void 0?e.bevelOffset:0,p=e.bevelSegments!==void 0?e.bevelSegments:3;const g=e.extrudePath,x=e.UVGenerator!==void 0?e.UVGenerator:xg;e.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),h=e.amount);let b,y=!1,z,M,Y,X;g&&(b=g.getSpacedPoints(l),y=!0,u=!1,z=g.computeFrenetFrames(l,!1),M=new wt,Y=new wt,X=new wt),u||(p=0,f=0,m=0,d=0);const w=r.extractPoints(a);let S=w.shape;const V=w.holes;if(!ts.isClockWise(S)){S=S.reverse();for(let H=0,j=V.length;H<j;H++){const it=V[H];ts.isClockWise(it)&&(V[H]=it.reverse())}}const C=ts.triangulateShape(S,V),A=S;for(let H=0,j=V.length;H<j;H++){const it=V[H];S=S.concat(it)}function Z(H,j,it){return j||console.error("THREE.ExtrudeGeometry: vec does not exist"),j.clone().multiplyScalar(it).add(H)}const L=S.length,E=C.length;function T(H,j,it){let et,G,W;const lt=H.x-j.x,ht=H.y-j.y,ft=it.x-H.x,pt=it.y-H.y,K=lt*lt+ht*ht,J=lt*pt-ht*ft;if(Math.abs(J)>Number.EPSILON){const rt=Math.sqrt(K),mt=Math.sqrt(ft*ft+pt*pt),xt=j.x-ht/rt,vt=j.y+lt/rt,Mt=it.x-pt/mt,ut=it.y+ft/mt,Zt=((Mt-xt)*pt-(ut-vt)*ft)/(lt*pt-ht*ft);et=xt+lt*Zt-H.x,G=vt+ht*Zt-H.y;const zt=et*et+G*G;if(zt<=2)return new Ne(et,G);W=Math.sqrt(zt/2)}else{let rt=!1;lt>Number.EPSILON?ft>Number.EPSILON&&(rt=!0):lt<-Number.EPSILON?ft<-Number.EPSILON&&(rt=!0):Math.sign(ht)===Math.sign(pt)&&(rt=!0),rt?(et=-ht,G=lt,W=Math.sqrt(K)):(et=lt,G=ht,W=Math.sqrt(K/2))}return new Ne(et/W,G/W)}const P=[];for(let H=0,j=A.length,it=j-1,et=H+1;H<j;H++,it++,et++)it===j&&(it=0),et===j&&(et=0),P[H]=T(A[H],A[it],A[et]);const N=[];let R,k=P.concat();for(let H=0,j=V.length;H<j;H++){const it=V[H];R=[];for(let et=0,G=it.length,W=G-1,lt=et+1;et<G;et++,W++,lt++)W===G&&(W=0),lt===G&&(lt=0),R[et]=T(it[et],it[W],it[lt]);N.push(R),k=k.concat(R)}for(let H=0;H<p;H++){const j=H/p,it=f*Math.cos(j*Math.PI/2),et=m*Math.sin(j*Math.PI/2)+d;for(let G=0,W=A.length;G<W;G++){const lt=Z(A[G],P[G],et);U(lt.x,lt.y,-it)}for(let G=0,W=V.length;G<W;G++){const lt=V[G];R=N[G];for(let ht=0,ft=lt.length;ht<ft;ht++){const pt=Z(lt[ht],R[ht],et);U(pt.x,pt.y,-it)}}}const O=m+d;for(let H=0;H<L;H++){const j=u?Z(S[H],k[H],O):S[H];y?(Y.copy(z.normals[0]).multiplyScalar(j.x),M.copy(z.binormals[0]).multiplyScalar(j.y),X.copy(b[0]).add(Y).add(M),U(X.x,X.y,X.z)):U(j.x,j.y,0)}for(let H=1;H<=l;H++)for(let j=0;j<L;j++){const it=u?Z(S[j],k[j],O):S[j];y?(Y.copy(z.normals[H]).multiplyScalar(it.x),M.copy(z.binormals[H]).multiplyScalar(it.y),X.copy(b[H]).add(Y).add(M),U(X.x,X.y,X.z)):U(it.x,it.y,h/l*H)}for(let H=p-1;H>=0;H--){const j=H/p,it=f*Math.cos(j*Math.PI/2),et=m*Math.sin(j*Math.PI/2)+d;for(let G=0,W=A.length;G<W;G++){const lt=Z(A[G],P[G],et);U(lt.x,lt.y,h+it)}for(let G=0,W=V.length;G<W;G++){const lt=V[G];R=N[G];for(let ht=0,ft=lt.length;ht<ft;ht++){const pt=Z(lt[ht],R[ht],et);y?U(pt.x,pt.y+b[l-1].y,b[l-1].x+it):U(pt.x,pt.y,h+it)}}}v(),D();function v(){const H=n.length/3;if(u){let j=0,it=L*j;for(let et=0;et<E;et++){const G=C[et];q(G[2]+it,G[1]+it,G[0]+it)}j=l+p*2,it=L*j;for(let et=0;et<E;et++){const G=C[et];q(G[0]+it,G[1]+it,G[2]+it)}}else{for(let j=0;j<E;j++){const it=C[j];q(it[2],it[1],it[0])}for(let j=0;j<E;j++){const it=C[j];q(it[0]+L*l,it[1]+L*l,it[2]+L*l)}}i.addGroup(H,n.length/3-H,0)}function D(){const H=n.length/3;let j=0;B(A,j),j+=A.length;for(let it=0,et=V.length;it<et;it++){const G=V[it];B(G,j),j+=G.length}i.addGroup(H,n.length/3-H,1)}function B(H,j){let it=H.length;for(;--it>=0;){const et=it;let G=it-1;G<0&&(G=H.length-1);for(let W=0,lt=l+p*2;W<lt;W++){const ht=L*W,ft=L*(W+1),pt=j+et+ht,K=j+G+ht,J=j+G+ft,rt=j+et+ft;tt(pt,K,J,rt)}}}function U(H,j,it){_.push(H),_.push(j),_.push(it)}function q(H,j,it){Q(H),Q(j),Q(it);const et=n.length/3,G=x.generateTopUV(i,n,et-3,et-2,et-1);nt(G[0]),nt(G[1]),nt(G[2])}function tt(H,j,it,et){Q(H),Q(j),Q(et),Q(j),Q(it),Q(et);const G=n.length/3,W=x.generateSideWallUV(i,n,G-6,G-3,G-2,G-1);nt(W[0]),nt(W[1]),nt(W[3]),nt(W[1]),nt(W[2]),nt(W[3])}function Q(H){n.push(_[H*3+0]),n.push(_[H*3+1]),n.push(_[H*3+2])}function nt(H){s.push(H.x),s.push(H.y)}}}toJSON(){const t=super.toJSON(),e=this.parameters.shapes,i=this.parameters.options;return vg(e,i,t)}static fromJSON(t,e){const i=[];for(let s=0,o=t.shapes.length;s<o;s++){const r=e[t.shapes[s]];i.push(r)}const n=t.options.extrudePath;return n!==void 0&&(t.options.extrudePath=new Ec[n.type]().fromJSON(n)),new ua(i,t.options)}}const xg={generateTopUV:function(c,t,e,i,n){const s=t[e*3],o=t[e*3+1],r=t[i*3],_=t[i*3+1],a=t[n*3],l=t[n*3+1];return[new Ne(s,o),new Ne(r,_),new Ne(a,l)]},generateSideWallUV:function(c,t,e,i,n,s){const o=t[e*3],r=t[e*3+1],_=t[e*3+2],a=t[i*3],l=t[i*3+1],h=t[i*3+2],u=t[n*3],f=t[n*3+1],m=t[n*3+2],d=t[s*3],p=t[s*3+1],g=t[s*3+2];return Math.abs(r-l)<Math.abs(o-a)?[new Ne(o,1-_),new Ne(a,1-h),new Ne(u,1-m),new Ne(d,1-g)]:[new Ne(r,1-_),new Ne(l,1-h),new Ne(f,1-m),new Ne(p,1-g)]}};function vg(c,t,e){if(e.shapes=[],Array.isArray(c))for(let i=0,n=c.length;i<n;i++){const s=c[i];e.shapes.push(s.uuid)}else e.shapes.push(c.uuid);return t.extrudePath!==void 0&&(e.options.extrudePath=t.extrudePath.toJSON()),e}class Ol extends Ei{constructor(t=new $a([new Ne(0,.5),new Ne(-.5,-.5),new Ne(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const i=[],n=[],s=[],o=[];let r=0,_=0;if(Array.isArray(t)===!1)a(t);else for(let l=0;l<t.length;l++)a(t[l]),this.addGroup(r,_,l),r+=_,_=0;this.setIndex(i),this.setAttribute("position",new Ji(n,3)),this.setAttribute("normal",new Ji(s,3)),this.setAttribute("uv",new Ji(o,2));function a(l){const h=n.length/3,u=l.extractPoints(e);let f=u.shape;const m=u.holes;ts.isClockWise(f)===!1&&(f=f.reverse());for(let p=0,g=m.length;p<g;p++){const x=m[p];ts.isClockWise(x)===!0&&(m[p]=x.reverse())}const d=ts.triangulateShape(f,m);for(let p=0,g=m.length;p<g;p++){const x=m[p];f=f.concat(x)}for(let p=0,g=f.length;p<g;p++){const x=f[p];n.push(x.x,x.y,0),s.push(0,0,1),o.push(x.x,x.y)}for(let p=0,g=d.length;p<g;p++){const x=d[p],b=x[0]+h,y=x[1]+h,z=x[2]+h;i.push(b,y,z),_+=3}}}toJSON(){const t=super.toJSON(),e=this.parameters.shapes;return bg(e,t)}static fromJSON(t,e){const i=[];for(let n=0,s=t.shapes.length;n<s;n++){const o=e[t.shapes[n]];i.push(o)}return new Ol(i,t.curveSegments)}}function bg(c,t){if(t.shapes=[],Array.isArray(c))for(let e=0,i=c.length;e<i;e++){const n=c[e];t.shapes.push(n.uuid)}else t.shapes.push(c.uuid);return t}class kc extends Gi{constructor(t){super(),this.type="ShadowMaterial",this.color=new fi(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}kc.prototype.isShadowMaterial=!0;class lr extends wn{constructor(t){super(t),this.type="RawShaderMaterial"}}lr.prototype.isRawShaderMaterial=!0;class Ul extends Gi{constructor(t){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new fi(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new fi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ra,this.normalScale=new Ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}Ul.prototype.isMeshStandardMaterial=!0;class Bc extends Ul{constructor(t){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ne(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return tn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.sheenColor=new fi(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new fi(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new fi(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}Bc.prototype.isMeshPhysicalMaterial=!0;class Dc extends Gi{constructor(t){super(),this.type="MeshPhongMaterial",this.color=new fi(16777215),this.specular=new fi(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new fi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ra,this.normalScale=new Ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Jo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}Dc.prototype.isMeshPhongMaterial=!0;class Nc extends Gi{constructor(t){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new fi(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new fi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ra,this.normalScale=new Ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}Nc.prototype.isMeshToonMaterial=!0;class Fc extends Gi{constructor(t){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ra,this.normalScale=new Ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}Fc.prototype.isMeshNormalMaterial=!0;class Oc extends Gi{constructor(t){super(),this.type="MeshLambertMaterial",this.color=new fi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new fi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Jo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}Oc.prototype.isMeshLambertMaterial=!0;class Uc extends Gi{constructor(t){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new fi(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ra,this.normalScale=new Ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}Uc.prototype.isMeshMatcapMaterial=!0;class Gc extends ca{constructor(t){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}Gc.prototype.isLineDashedMaterial=!0;const yg={ShadowMaterial:kc,SpriteMaterial:Cl,RawShaderMaterial:lr,ShaderMaterial:wn,PointsMaterial:kl,MeshPhysicalMaterial:Bc,MeshStandardMaterial:Ul,MeshPhongMaterial:Dc,MeshToonMaterial:Nc,MeshNormalMaterial:Fc,MeshLambertMaterial:Oc,MeshDepthMaterial:Tl,MeshDistanceMaterial:Vl,MeshBasicMaterial:tr,MeshMatcapMaterial:Uc,LineDashedMaterial:Gc,LineBasicMaterial:ca,Material:Gi};Gi.fromType=function(c){return new yg[c]};const Pi={arraySlice:function(c,t,e){return Pi.isTypedArray(c)?new c.constructor(c.subarray(t,e!==void 0?e:c.length)):c.slice(t,e)},convertArray:function(c,t,e){return!c||!e&&c.constructor===t?c:typeof t.BYTES_PER_ELEMENT=="number"?new t(c):Array.prototype.slice.call(c)},isTypedArray:function(c){return ArrayBuffer.isView(c)&&!(c instanceof DataView)},getKeyframeOrder:function(c){function t(n,s){return c[n]-c[s]}const e=c.length,i=new Array(e);for(let n=0;n!==e;++n)i[n]=n;return i.sort(t),i},sortedArray:function(c,t,e){const i=c.length,n=new c.constructor(i);for(let s=0,o=0;o!==i;++s){const r=e[s]*t;for(let _=0;_!==t;++_)n[o++]=c[r+_]}return n},flattenJSON:function(c,t,e,i){let n=1,s=c[0];for(;s!==void 0&&s[i]===void 0;)s=c[n++];if(s===void 0)return;let o=s[i];if(o!==void 0)if(Array.isArray(o))do o=s[i],o!==void 0&&(t.push(s.time),e.push.apply(e,o)),s=c[n++];while(s!==void 0);else if(o.toArray!==void 0)do o=s[i],o!==void 0&&(t.push(s.time),o.toArray(e,e.length)),s=c[n++];while(s!==void 0);else do o=s[i],o!==void 0&&(t.push(s.time),e.push(o)),s=c[n++];while(s!==void 0)},subclip:function(c,t,e,i,n=30){const s=c.clone();s.name=t;const o=[];for(let _=0;_<s.tracks.length;++_){const a=s.tracks[_],l=a.getValueSize(),h=[],u=[];for(let f=0;f<a.times.length;++f){const m=a.times[f]*n;if(!(m<e||m>=i)){h.push(a.times[f]);for(let d=0;d<l;++d)u.push(a.values[f*l+d])}}h.length!==0&&(a.times=Pi.convertArray(h,a.times.constructor),a.values=Pi.convertArray(u,a.values.constructor),o.push(a))}s.tracks=o;let r=1/0;for(let _=0;_<s.tracks.length;++_)r>s.tracks[_].times[0]&&(r=s.tracks[_].times[0]);for(let _=0;_<s.tracks.length;++_)s.tracks[_].shift(-1*r);return s.resetDuration(),s},makeClipAdditive:function(c,t=0,e=c,i=30){i<=0&&(i=30);const n=e.tracks.length,s=t/i;for(let o=0;o<n;++o){const r=e.tracks[o],_=r.ValueTypeName;if(_==="bool"||_==="string")continue;const a=c.tracks.find(function(g){return g.name===r.name&&g.ValueTypeName===_});if(a===void 0)continue;let l=0;const h=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=h/3);let u=0;const f=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=f/3);const m=r.times.length-1;let d;if(s<=r.times[0]){const g=l,x=h-l;d=Pi.arraySlice(r.values,g,x)}else if(s>=r.times[m]){const g=m*h+l,x=g+h-l;d=Pi.arraySlice(r.values,g,x)}else{const g=r.createInterpolant(),x=l,b=h-l;g.evaluate(s),d=Pi.arraySlice(g.resultBuffer,x,b)}_==="quaternion"&&new _n().fromArray(d).normalize().conjugate().toArray(d);const p=a.times.length;for(let g=0;g<p;++g){const x=g*f+u;if(_==="quaternion")_n.multiplyQuaternionsFlat(a.values,x,d,0,a.values,x);else{const b=f-u*2;for(let y=0;y<b;++y)a.values[x+y]-=d[y]}}}return c.blendMode=cc,c}};class ns{constructor(t,e,i,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=n!==void 0?n:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let i=this._cachedIndex,n=e[i],s=e[i-1];t:{e:{let o;i:{n:if(!(t<n)){for(let r=i+2;;){if(n===void 0){if(t<s)break n;return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,t,s)}if(i===r)break;if(s=n,n=e[++i],t<n)break e}o=e.length;break i}if(!(t>=s)){const r=e[1];t<r&&(i=2,s=r);for(let _=i-2;;){if(s===void 0)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(i===_)break;if(n=s,s=e[--i-1],t>=s)break e}o=i,i=0;break i}break t}for(;i<o;){const r=i+o>>>1;t<e[r]?o=r:i=r+1}if(n=e[i],s=e[i-1],s===void 0)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(n===void 0)return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,s,t)}this._cachedIndex=i,this.intervalChanged_(i,s,n)}return this.interpolate_(i,s,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,s=t*n;for(let o=0;o!==n;++o)e[o]=i[s+o];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}ns.prototype.beforeStart_=ns.prototype.copySampleValue_;ns.prototype.afterEnd_=ns.prototype.copySampleValue_;class Mg extends ns{constructor(t,e,i,n){super(t,e,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Hs,endingEnd:Hs}}intervalChanged_(t,e,i){const n=this.parameterPositions;let s=t-2,o=t+1,r=n[s],_=n[o];if(r===void 0)switch(this.getSettings_().endingStart){case Ws:s=t,r=2*e-i;break;case Do:s=n.length-2,r=e+n[s]-n[s+1];break;default:s=t,r=i}if(_===void 0)switch(this.getSettings_().endingEnd){case Ws:o=t,_=2*i-e;break;case Do:o=1,_=i+n[1]-n[0];break;default:o=t-1,_=e}const a=(i-e)*.5,l=this.valueSize;this._weightPrev=a/(e-r),this._weightNext=a/(_-i),this._offsetPrev=s*l,this._offsetNext=o*l}interpolate_(t,e,i,n){const s=this.resultBuffer,o=this.sampleValues,r=this.valueSize,_=t*r,a=_-r,l=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,f=this._weightNext,m=(i-e)/(n-e),d=m*m,p=d*m,g=-u*p+2*u*d-u*m,x=(1+u)*p+(-1.5-2*u)*d+(-.5+u)*m+1,b=(-1-f)*p+(1.5+f)*d+.5*m,y=f*p-f*d;for(let z=0;z!==r;++z)s[z]=g*o[l+z]+x*o[a+z]+b*o[_+z]+y*o[h+z];return s}}class Hc extends ns{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const s=this.resultBuffer,o=this.sampleValues,r=this.valueSize,_=t*r,a=_-r,l=(i-e)/(n-e),h=1-l;for(let u=0;u!==r;++u)s[u]=o[a+u]*h+o[_+u]*l;return s}}class wg extends ns{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t){return this.copySampleValue_(t-1)}}class Vn{constructor(t,e,i,n){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Pi.convertArray(e,this.TimeBufferType),this.values=Pi.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:Pi.convertArray(t.times,Array),values:Pi.convertArray(t.values,Array)};const n=t.getInterpolation();n!==t.DefaultInterpolation&&(i.interpolation=n)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new wg(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Hc(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new Mg(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case ko:e=this.InterpolantFactoryMethodDiscrete;break;case Bo:e=this.InterpolantFactoryMethodLinear;break;case vr:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ko;case this.InterpolantFactoryMethodLinear:return Bo;case this.InterpolantFactoryMethodSmooth:return vr}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]+=t}return this}scale(t){if(t!==1){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]*=t}return this}trim(t,e){const i=this.times,n=i.length;let s=0,o=n-1;for(;s!==n&&i[s]<t;)++s;for(;o!==-1&&i[o]>e;)--o;if(++o,s!==0||o!==n){s>=o&&(o=Math.max(o,1),s=o-1);const r=this.getValueSize();this.times=Pi.arraySlice(i,s,o),this.values=Pi.arraySlice(this.values,s*r,o*r)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,n=this.values,s=i.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let o=null;for(let r=0;r!==s;r++){const _=i[r];if(typeof _=="number"&&isNaN(_)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,r,_),t=!1;break}if(o!==null&&o>_){console.error("THREE.KeyframeTrack: Out of order keys.",this,r,_,o),t=!1;break}o=_}if(n!==void 0&&Pi.isTypedArray(n))for(let r=0,_=n.length;r!==_;++r){const a=n[r];if(isNaN(a)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,r,a),t=!1;break}}return t}optimize(){const t=Pi.arraySlice(this.times),e=Pi.arraySlice(this.values),i=this.getValueSize(),n=this.getInterpolation()===vr,s=t.length-1;let o=1;for(let r=1;r<s;++r){let _=!1;const a=t[r],l=t[r+1];if(a!==l&&(r!==1||a!==t[0]))if(n)_=!0;else{const h=r*i,u=h-i,f=h+i;for(let m=0;m!==i;++m){const d=e[h+m];if(d!==e[u+m]||d!==e[f+m]){_=!0;break}}}if(_){if(r!==o){t[o]=t[r];const h=r*i,u=o*i;for(let f=0;f!==i;++f)e[u+f]=e[h+f]}++o}}if(s>0){t[o]=t[s];for(let r=s*i,_=o*i,a=0;a!==i;++a)e[_+a]=e[r+a];++o}return o!==t.length?(this.times=Pi.arraySlice(t,0,o),this.values=Pi.arraySlice(e,0,o*i)):(this.times=t,this.values=e),this}clone(){const t=Pi.arraySlice(this.times,0),e=Pi.arraySlice(this.values,0),i=this.constructor,n=new i(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}Vn.prototype.TimeBufferType=Float32Array;Vn.prototype.ValueBufferType=Float32Array;Vn.prototype.DefaultInterpolation=Bo;class pa extends Vn{}pa.prototype.ValueTypeName="bool";pa.prototype.ValueBufferType=Array;pa.prototype.DefaultInterpolation=ko;pa.prototype.InterpolantFactoryMethodLinear=void 0;pa.prototype.InterpolantFactoryMethodSmooth=void 0;class Wc extends Vn{}Wc.prototype.ValueTypeName="color";class Oo extends Vn{}Oo.prototype.ValueTypeName="number";class Xg extends ns{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const s=this.resultBuffer,o=this.sampleValues,r=this.valueSize,_=(i-e)/(n-e);let a=t*r;for(let l=a+r;a!==l;a+=4)_n.slerpFlat(s,0,o,a-r,o,a,_);return s}}class Ka extends Vn{InterpolantFactoryMethodLinear(t){return new Xg(this.times,this.values,this.getValueSize(),t)}}Ka.prototype.ValueTypeName="quaternion";Ka.prototype.DefaultInterpolation=Bo;Ka.prototype.InterpolantFactoryMethodSmooth=void 0;class ma extends Vn{}ma.prototype.ValueTypeName="string";ma.prototype.ValueBufferType=Array;ma.prototype.DefaultInterpolation=ko;ma.prototype.InterpolantFactoryMethodLinear=void 0;ma.prototype.InterpolantFactoryMethodSmooth=void 0;class Uo extends Vn{}Uo.prototype.ValueTypeName="vector";class Bh{constructor(t,e=-1,i,n=Il){this.name=t,this.tracks=i,this.duration=e,this.blendMode=n,this.uuid=An(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],i=t.tracks,n=1/(t.fps||1);for(let o=0,r=i.length;o!==r;++o)e.push(zg(i[o]).scale(n));const s=new this(t.name,t.duration,e,t.blendMode);return s.uuid=t.uuid,s}static toJSON(t){const e=[],i=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let s=0,o=i.length;s!==o;++s)e.push(Vn.toJSON(i[s]));return n}static CreateFromMorphTargetSequence(t,e,i,n){const s=e.length,o=[];for(let r=0;r<s;r++){let _=[],a=[];_.push((r+s-1)%s,r,(r+1)%s),a.push(0,1,0);const l=Pi.getKeyframeOrder(_);_=Pi.sortedArray(_,1,l),a=Pi.sortedArray(a,1,l),!n&&_[0]===0&&(_.push(s),a.push(a[0])),o.push(new Oo(".morphTargetInfluences["+e[r].name+"]",_,a).scale(1/i))}return new this(t,-1,o)}static findByName(t,e){let i=t;if(!Array.isArray(t)){const n=t;i=n.geometry&&n.geometry.animations||n.animations}for(let n=0;n<i.length;n++)if(i[n].name===e)return i[n];return null}static CreateClipsFromMorphTargetSequences(t,e,i){const n={},s=/^([\w-]*?)([\d]+)$/;for(let r=0,_=t.length;r<_;r++){const a=t[r],l=a.name.match(s);if(l&&l.length>1){const h=l[1];let u=n[h];u||(n[h]=u=[]),u.push(a)}}const o=[];for(const r in n)o.push(this.CreateFromMorphTargetSequence(r,n[r],e,i));return o}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(h,u,f,m,d){if(f.length!==0){const p=[],g=[];Pi.flattenJSON(f,p,g,m),p.length!==0&&d.push(new h(u,p,g))}},n=[],s=t.name||"default",o=t.fps||30,r=t.blendMode;let _=t.length||-1;const a=t.hierarchy||[];for(let h=0;h<a.length;h++){const u=a[h].keys;if(!(!u||u.length===0))if(u[0].morphTargets){const f={};let m;for(m=0;m<u.length;m++)if(u[m].morphTargets)for(let d=0;d<u[m].morphTargets.length;d++)f[u[m].morphTargets[d]]=-1;for(const d in f){const p=[],g=[];for(let x=0;x!==u[m].morphTargets.length;++x){const b=u[m];p.push(b.time),g.push(b.morphTarget===d?1:0)}n.push(new Oo(".morphTargetInfluence["+d+"]",p,g))}_=f.length*o}else{const f=".bones["+e[h].name+"]";i(Uo,f+".position",u,"pos",n),i(Ka,f+".quaternion",u,"rot",n),i(Uo,f+".scale",u,"scl",n)}}return n.length===0?null:new this(s,_,n,r)}resetDuration(){const t=this.tracks;let e=0;for(let i=0,n=t.length;i!==n;++i){const s=this.tracks[i];e=Math.max(e,s.times[s.times.length-1])}return this.duration=e,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Ig(c){switch(c.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Oo;case"vector":case"vector2":case"vector3":case"vector4":return Uo;case"color":return Wc;case"quaternion":return Ka;case"bool":case"boolean":return pa;case"string":return ma}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+c)}function zg(c){if(c.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=Ig(c.type);if(c.times===void 0){const e=[],i=[];Pi.flattenJSON(c.keys,e,i,"value"),c.times=e,c.values=i}return t.parse!==void 0?t.parse(c):new t(c.name,c.times,c.values,c.interpolation)}const oa={enabled:!1,files:{},add:function(c,t){this.enabled!==!1&&(this.files[c]=t)},get:function(c){if(this.enabled!==!1)return this.files[c]},remove:function(c){delete this.files[c]},clear:function(){this.files={}}};class Sg{constructor(t,e,i){const n=this;let s=!1,o=0,r=0,_;const a=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(l){r++,s===!1&&n.onStart!==void 0&&n.onStart(l,o,r),s=!0},this.itemEnd=function(l){o++,n.onProgress!==void 0&&n.onProgress(l,o,r),o===r&&(s=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(l){n.onError!==void 0&&n.onError(l)},this.resolveURL=function(l){return _?_(l):l},this.setURLModifier=function(l){return _=l,this},this.addHandler=function(l,h){return a.push(l,h),this},this.removeHandler=function(l){const h=a.indexOf(l);return h!==-1&&a.splice(h,2),this},this.getHandler=function(l){for(let h=0,u=a.length;h<u;h+=2){const f=a[h],m=a[h+1];if(f.global&&(f.lastIndex=0),f.test(l))return m}return null}}}const Yg=new Sg;class ss{constructor(t){this.manager=t!==void 0?t:Yg,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise(function(n,s){i.load(t,n,e,s)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const Dn={};class Zg extends ss{constructor(t){super(t)}load(t,e,i,n){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=oa.get(t);if(s!==void 0)return this.manager.itemStart(t),setTimeout(()=>{e&&e(s),this.manager.itemEnd(t)},0),s;if(Dn[t]!==void 0){Dn[t].push({onLoad:e,onProgress:i,onError:n});return}Dn[t]=[],Dn[t].push({onLoad:e,onProgress:i,onError:n});const o=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),r=this.mimeType,_=this.responseType;fetch(o).then(a=>{if(a.status===200||a.status===0){if(a.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream=="undefined"||a.body===void 0||a.body.getReader===void 0)return a;const l=Dn[t],h=a.body.getReader(),u=a.headers.get("Content-Length"),f=u?parseInt(u):0,m=f!==0;let d=0;const p=new ReadableStream({start(g){x();function x(){h.read().then(({done:b,value:y})=>{if(b)g.close();else{d+=y.byteLength;const z=new ProgressEvent("progress",{lengthComputable:m,loaded:d,total:f});for(let M=0,Y=l.length;M<Y;M++){const X=l[M];X.onProgress&&X.onProgress(z)}g.enqueue(y),x()}})}}});return new Response(p)}else throw Error(`fetch for "${a.url}" responded with ${a.status}: ${a.statusText}`)}).then(a=>{switch(_){case"arraybuffer":return a.arrayBuffer();case"blob":return a.blob();case"document":return a.text().then(l=>new DOMParser().parseFromString(l,r));case"json":return a.json();default:if(r===void 0)return a.text();{const h=/charset="?([^;"\s]*)"?/i.exec(r),u=h&&h[1]?h[1].toLowerCase():void 0,f=new TextDecoder(u);return a.arrayBuffer().then(m=>f.decode(m))}}}).then(a=>{oa.add(t,a);const l=Dn[t];delete Dn[t];for(let h=0,u=l.length;h<u;h++){const f=l[h];f.onLoad&&f.onLoad(a)}}).catch(a=>{const l=Dn[t];if(l===void 0)throw this.manager.itemError(t),a;delete Dn[t];for(let h=0,u=l.length;h<u;h++){const f=l[h];f.onError&&f.onError(a)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class jc extends ss{constructor(t){super(t)}load(t,e,i,n){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,o=oa.get(t);if(o!==void 0)return s.manager.itemStart(t),setTimeout(function(){e&&e(o),s.manager.itemEnd(t)},0),o;const r=Ua("img");function _(){l(),oa.add(t,this),e&&e(this),s.manager.itemEnd(t)}function a(h){l(),n&&n(h),s.manager.itemError(t),s.manager.itemEnd(t)}function l(){r.removeEventListener("load",_,!1),r.removeEventListener("error",a,!1)}return r.addEventListener("load",_,!1),r.addEventListener("error",a,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(r.crossOrigin=this.crossOrigin),s.manager.itemStart(t),r.src=t,r}}class Lg extends ss{constructor(t){super(t)}load(t,e,i,n){const s=new er,o=new jc(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let r=0;function _(a){o.load(t[a],function(l){s.images[a]=l,r++,r===6&&(s.needsUpdate=!0,e&&e(s))},void 0,n)}for(let a=0;a<t.length;++a)_(a);return s}}class Ag extends ss{constructor(t){super(t)}load(t,e,i,n){const s=new $i,o=new jc(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,function(r){s.image=r,s.needsUpdate=!0,e!==void 0&&e(s)},i,n),s}}class Tn extends Ti{constructor(t,e=1){super(),this.type="Light",this.color=new fi(t),this.intensity=e}dispose(){}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),e}}Tn.prototype.isLight=!0;class Tg extends Tn{constructor(t,e,i){super(t,i),this.type="HemisphereLight",this.position.copy(Ti.DefaultUp),this.updateMatrix(),this.groundColor=new fi(e)}copy(t){return Tn.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}Tg.prototype.isHemisphereLight=!0;const Dh=new vi,Nh=new wt,Fh=new wt;class Gl{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ne(512,512),this.map=null,this.mapPass=null,this.matrix=new vi,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ir,this._frameExtents=new Ne(1,1),this._viewportCount=1,this._viewports=[new Li(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,i=this.matrix;Nh.setFromMatrixPosition(t.matrixWorld),e.position.copy(Nh),Fh.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(Fh),e.updateMatrixWorld(),Dh.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Dh),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(e.projectionMatrix),i.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class qc extends Gl{constructor(){super(new nn(50,1,.5,500)),this.focus=1}updateMatrices(t){const e=this.camera,i=cl*2*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,s=t.distance||e.far;(i!==e.fov||n!==e.aspect||s!==e.far)&&(e.fov=i,e.aspect=n,e.far=s,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}qc.prototype.isSpotLightShadow=!0;class Vg extends Tn{constructor(t,e,i=0,n=Math.PI/3,s=0,o=1){super(t,e),this.type="SpotLight",this.position.copy(Ti.DefaultUp),this.updateMatrix(),this.target=new Ti,this.distance=i,this.angle=n,this.penumbra=s,this.decay=o,this.shadow=new qc}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}Vg.prototype.isSpotLight=!0;const Oh=new vi,Sa=new wt,tl=new wt;class Jc extends Gl{constructor(){super(new nn(90,1,.5,500)),this._frameExtents=new Ne(4,2),this._viewportCount=6,this._viewports=[new Li(2,1,1,1),new Li(0,1,1,1),new Li(3,1,1,1),new Li(1,1,1,1),new Li(3,0,1,1),new Li(1,0,1,1)],this._cubeDirections=[new wt(1,0,0),new wt(-1,0,0),new wt(0,0,1),new wt(0,0,-1),new wt(0,1,0),new wt(0,-1,0)],this._cubeUps=[new wt(0,1,0),new wt(0,1,0),new wt(0,1,0),new wt(0,1,0),new wt(0,0,1),new wt(0,0,-1)]}updateMatrices(t,e=0){const i=this.camera,n=this.matrix,s=t.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),Sa.setFromMatrixPosition(t.matrixWorld),i.position.copy(Sa),tl.copy(i.position),tl.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(tl),i.updateMatrixWorld(),n.makeTranslation(-Sa.x,-Sa.y,-Sa.z),Oh.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Oh)}}Jc.prototype.isPointLightShadow=!0;class Eg extends Tn{constructor(t,e,i=0,n=1){super(t,e),this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new Jc}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}Eg.prototype.isPointLight=!0;class $c extends Gl{constructor(){super(new nr(-5,5,5,-5,.5,500))}}$c.prototype.isDirectionalLightShadow=!0;class Cg extends Tn{constructor(t,e){super(t,e),this.type="DirectionalLight",this.position.copy(Ti.DefaultUp),this.updateMatrix(),this.target=new Ti,this.shadow=new $c}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}Cg.prototype.isDirectionalLight=!0;class Pg extends Tn{constructor(t,e){super(t,e),this.type="AmbientLight"}}Pg.prototype.isAmbientLight=!0;class Rg extends Tn{constructor(t,e,i=10,n=10){super(t,e),this.type="RectAreaLight",this.width=i,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}Rg.prototype.isRectAreaLight=!0;class Kc{constructor(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new wt)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const i=t.x,n=t.y,s=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.282095),e.addScaledVector(o[1],.488603*n),e.addScaledVector(o[2],.488603*s),e.addScaledVector(o[3],.488603*i),e.addScaledVector(o[4],1.092548*(i*n)),e.addScaledVector(o[5],1.092548*(n*s)),e.addScaledVector(o[6],.315392*(3*s*s-1)),e.addScaledVector(o[7],1.092548*(i*s)),e.addScaledVector(o[8],.546274*(i*i-n*n)),e}getIrradianceAt(t,e){const i=t.x,n=t.y,s=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.886227),e.addScaledVector(o[1],2*.511664*n),e.addScaledVector(o[2],2*.511664*s),e.addScaledVector(o[3],2*.511664*i),e.addScaledVector(o[4],2*.429043*i*n),e.addScaledVector(o[5],2*.429043*n*s),e.addScaledVector(o[6],.743125*s*s-.247708),e.addScaledVector(o[7],2*.429043*i*s),e.addScaledVector(o[8],.429043*(i*i-n*n)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(t.coefficients[i],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let i=0;i<9;i++)this.coefficients[i].lerp(t.coefficients[i],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(t,e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(t,e+n*3);return this}toArray(t=[],e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(t,e+n*3);return t}static getBasisAt(t,e){const i=t.x,n=t.y,s=t.z;e[0]=.282095,e[1]=.488603*n,e[2]=.488603*s,e[3]=.488603*i,e[4]=1.092548*i*n,e[5]=1.092548*n*s,e[6]=.315392*(3*s*s-1),e[7]=1.092548*i*s,e[8]=.546274*(i*i-n*n)}}Kc.prototype.isSphericalHarmonics3=!0;class Hl extends Tn{constructor(t=new Kc,e=1){super(void 0,e),this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}Hl.prototype.isLightProbe=!0;class kg{static decodeText(t){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(t);let e="";for(let i=0,n=t.length;i<n;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch{return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return e===-1?"./":t.slice(0,e+1)}static resolveURL(t,e){return typeof t!="string"||t===""?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class Bg extends Ei{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}Bg.prototype.isInstancedBufferGeometry=!0;class Dg extends ss{constructor(t){super(t),typeof createImageBitmap=="undefined"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch=="undefined"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,i,n){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,o=oa.get(t);if(o!==void 0)return s.manager.itemStart(t),setTimeout(function(){e&&e(o),s.manager.itemEnd(t)},0),o;const r={};r.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",r.headers=this.requestHeader,fetch(t,r).then(function(_){return _.blob()}).then(function(_){return createImageBitmap(_,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(_){oa.add(t,_),e&&e(_),s.manager.itemEnd(t)}).catch(function(_){n&&n(_),s.manager.itemError(t),s.manager.itemEnd(t)}),s.manager.itemStart(t)}}Dg.prototype.isImageBitmapLoader=!0;let Ao;const Ng={getContext:function(){return Ao===void 0&&(Ao=new(window.AudioContext||window.webkitAudioContext)),Ao},setContext:function(c){Ao=c}};class Fg extends ss{constructor(t){super(t)}load(t,e,i,n){const s=this,o=new Zg(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(r){try{const _=r.slice(0);Ng.getContext().decodeAudioData(_,function(l){e(l)})}catch(_){n?n(_):console.error(_),s.manager.itemError(t)}},i,n)}}class Og extends Hl{constructor(t,e,i=1){super(void 0,i);const n=new fi().set(t),s=new fi().set(e),o=new wt(n.r,n.g,n.b),r=new wt(s.r,s.g,s.b),_=Math.sqrt(Math.PI),a=_*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(r).multiplyScalar(_),this.sh.coefficients[1].copy(o).sub(r).multiplyScalar(a)}}Og.prototype.isHemisphereLightProbe=!0;class Ug extends Hl{constructor(t,e=1){super(void 0,e);const i=new fi().set(t);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}Ug.prototype.isAmbientLightProbe=!0;class Gg extends Ti{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),this._connected===!0?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=t,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=t,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}class Hg{constructor(t,e,i){this.binding=t,this.valueSize=i;let n,s,o;switch(e){case"quaternion":n=this._slerp,s=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":n=this._select,s=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:n=this._lerp,s=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=s,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const i=this.buffer,n=this.valueSize,s=t*n+n;let o=this.cumulativeWeight;if(o===0){for(let r=0;r!==n;++r)i[s+r]=i[r];o=e}else{o+=e;const r=e/o;this._mixBufferRegion(i,s,0,r,n)}this.cumulativeWeight=o}accumulateAdditive(t){const e=this.buffer,i=this.valueSize,n=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(e,n,0,t,i),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,i=this.buffer,n=t*e+e,s=this.cumulativeWeight,o=this.cumulativeWeightAdditive,r=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const _=e*this._origIndex;this._mixBufferRegion(i,n,_,1-s,e)}o>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*e,1,e);for(let _=e,a=e+e;_!==a;++_)if(i[_]!==i[_+e]){r.setValue(i,n);break}}saveOriginalState(){const t=this.binding,e=this.buffer,i=this.valueSize,n=i*this._origIndex;t.getValue(e,n);for(let s=i,o=n;s!==o;++s)e[s]=e[n+s%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=this.valueSize*3;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]}_select(t,e,i,n,s){if(n>=.5)for(let o=0;o!==s;++o)t[e+o]=t[i+o]}_slerp(t,e,i,n){_n.slerpFlat(t,e,t,e,t,i,n)}_slerpAdditive(t,e,i,n,s){const o=this._workIndex*s;_n.multiplyQuaternionsFlat(t,o,t,e,t,i),_n.slerpFlat(t,e,t,e,t,o,n)}_lerp(t,e,i,n,s){const o=1-n;for(let r=0;r!==s;++r){const _=e+r;t[_]=t[_]*o+t[i+r]*n}}_lerpAdditive(t,e,i,n,s){for(let o=0;o!==s;++o){const r=e+o;t[r]=t[r]+t[i+o]*n}}}const Wl="\\[\\]\\.:\\/",Wg=new RegExp("["+Wl+"]","g"),jl="[^"+Wl+"]",jg="[^"+Wl.replace("\\.","")+"]",qg=/((?:WC+[\/:])*)/.source.replace("WC",jl),Jg=/(WCOD+)?/.source.replace("WCOD",jg),$g=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",jl),Kg=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",jl),Qg=new RegExp("^"+qg+Jg+$g+Kg+"$"),tx=["material","materials","bones"];class ex{constructor(t,e,i){const n=i||Ai.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}getValue(t,e){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];n!==void 0&&n.getValue(t,e)}setValue(t,e){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,s=i.length;n!==s;++n)i[n].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}}class Ai{constructor(t,e,i){this.path=e,this.parsedPath=i||Ai.parseTrackName(e),this.node=Ai.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new Ai.Composite(t,e,i):new Ai(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(Wg,"")}static parseTrackName(t){const e=Qg.exec(t);if(e===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(n!==void 0&&n!==-1){const s=i.nodeName.substring(n+1);tx.indexOf(s)!==-1&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=s)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(e===void 0||e===""||e==="."||e===-1||e===t.name||e===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(e);if(i!==void 0)return i}if(t.children){const i=function(s){for(let o=0;o<s.length;o++){const r=s[o];if(r.name===e||r.uuid===e)return r;const _=i(r.children);if(_)return _}return null},n=i(t.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)t[e++]=i[n]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,i=e.objectName,n=e.propertyName;let s=e.propertyIndex;if(t||(t=Ai.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let a=e.objectIndex;switch(i){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let l=0;l<t.length;l++)if(t[l].name===a){a=l;break}break;default:if(t[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[i]}if(a!==void 0){if(t[a]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[a]}}const o=t[n];if(o===void 0){const a=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+a+"."+n+" but it wasn't found.",t);return}let r=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?r=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(r=this.Versioning.MatrixWorldNeedsUpdate);let _=this.BindingType.Direct;if(s!==void 0){if(n==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[s]!==void 0&&(s=t.morphTargetDictionary[s])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}_=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=s}else o.fromArray!==void 0&&o.toArray!==void 0?(_=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(_=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=n;this.getValue=this.GetterByBindingType[_],this.setValue=this.SetterByBindingTypeAndVersioning[_][r]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ai.Composite=ex;Ai.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Ai.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Ai.prototype.GetterByBindingType=[Ai.prototype._getValue_direct,Ai.prototype._getValue_array,Ai.prototype._getValue_arrayElement,Ai.prototype._getValue_toArray];Ai.prototype.SetterByBindingTypeAndVersioning=[[Ai.prototype._setValue_direct,Ai.prototype._setValue_direct_setNeedsUpdate,Ai.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ai.prototype._setValue_array,Ai.prototype._setValue_array_setNeedsUpdate,Ai.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ai.prototype._setValue_arrayElement,Ai.prototype._setValue_arrayElement_setNeedsUpdate,Ai.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ai.prototype._setValue_fromArray,Ai.prototype._setValue_fromArray_setNeedsUpdate,Ai.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class ix{constructor(t,e,i=null,n=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=n;const s=e.tracks,o=s.length,r=new Array(o),_={endingStart:Hs,endingEnd:Hs};for(let a=0;a!==o;++a){const l=s[a].createInterpolant(null);r[a]=l,l.settings=_}this._interpolantSettings=_,this._interpolants=r,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=ku,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){const n=this._clip.duration,s=t._clip.duration,o=s/n,r=n/s;t.warp(1,o,e),this.warp(r,1,e)}return this}crossFadeTo(t,e,i){return t.crossFadeFrom(this,e,i)}stopFading(){const t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){const n=this._mixer,s=n.time,o=this.timeScale;let r=this._timeScaleInterpolant;r===null&&(r=n._lendControlInterpolant(),this._timeScaleInterpolant=r);const _=r.parameterPositions,a=r.sampleValues;return _[0]=s,_[1]=s+i,a[0]=t/o,a[1]=e/o,this}stopWarping(){const t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,n){if(!this.enabled){this._updateWeight(t);return}const s=this._startTime;if(s!==null){const _=(t-s)*i;if(_<0||i===0)return;this._startTime=null,e=i*_}e*=this._updateTimeScale(t);const o=this._updateTime(e),r=this._updateWeight(t);if(r>0){const _=this._interpolants,a=this._propertyBindings;switch(this.blendMode){case cc:for(let l=0,h=_.length;l!==h;++l)_[l].evaluate(o),a[l].accumulateAdditive(r);break;case Il:default:for(let l=0,h=_.length;l!==h;++l)_[l].evaluate(o),a[l].accumulate(n,r)}}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const i=this._weightInterpolant;if(i!==null){const n=i.evaluate(t)[0];e*=n,t>i.parameterPositions[1]&&(this.stopFading(),n===0&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const i=this._timeScaleInterpolant;i!==null&&(e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),e===0?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,i=this.loop;let n=this.time+t,s=this._loopCount;const o=i===Bu;if(t===0)return s===-1?n:o&&(s&1)===1?e-n:n;if(i===Ru){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(n>=e)n=e;else if(n<0)n=0;else{this.time=n;break t}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(s===-1&&(t>=0?(s=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),n>=e||n<0){const r=Math.floor(n/e);n-=e*r,s+=Math.abs(r);const _=this.repetitions-s;if(_<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=t>0?e:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(_===1){const a=t<0;this._setEndings(a,!a,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:r})}}else this.time=n;if(o&&(s&1)===1)return e-n}return n}_setEndings(t,e,i){const n=this._interpolantSettings;i?(n.endingStart=Ws,n.endingEnd=Ws):(t?n.endingStart=this.zeroSlopeAtStart?Ws:Hs:n.endingStart=Do,e?n.endingEnd=this.zeroSlopeAtEnd?Ws:Hs:n.endingEnd=Do)}_scheduleFading(t,e,i){const n=this._mixer,s=n.time;let o=this._weightInterpolant;o===null&&(o=n._lendControlInterpolant(),this._weightInterpolant=o);const r=o.parameterPositions,_=o.sampleValues;return r[0]=s,_[0]=e,r[1]=s+t,_[1]=i,this}}class nx extends ws{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const i=t._localRoot||this._root,n=t._clip.tracks,s=n.length,o=t._propertyBindings,r=t._interpolants,_=i.uuid,a=this._bindingsByRootAndName;let l=a[_];l===void 0&&(l={},a[_]=l);for(let h=0;h!==s;++h){const u=n[h],f=u.name;let m=l[f];if(m!==void 0)++m.referenceCount,o[h]=m;else{if(m=o[h],m!==void 0){m._cacheIndex===null&&(++m.referenceCount,this._addInactiveBinding(m,_,f));continue}const d=e&&e._propertyBindings[h].binding.parsedPath;m=new Hg(Ai.create(i,f,d),u.ValueTypeName,u.getValueSize()),++m.referenceCount,this._addInactiveBinding(m,_,f),o[h]=m}r[h].resultBuffer=m.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){const i=(t._localRoot||this._root).uuid,n=t._clip.uuid,s=this._actionsByClip[n];this._bindAction(t,s&&s.knownActions[0]),this._addInactiveAction(t,n,i)}const e=t._propertyBindings;for(let i=0,n=e.length;i!==n;++i){const s=e[i];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let i=0,n=e.length;i!==n;++i){const s=e[i];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return e!==null&&e<this._nActiveActions}_addInactiveAction(t,e,i){const n=this._actions,s=this._actionsByClip;let o=s[e];if(o===void 0)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,s[e]=o;else{const r=o.knownActions;t._byClipCacheIndex=r.length,r.push(t)}t._cacheIndex=n.length,n.push(t),o.actionByRoot[i]=t}_removeInactiveAction(t){const e=this._actions,i=e[e.length-1],n=t._cacheIndex;i._cacheIndex=n,e[n]=i,e.pop(),t._cacheIndex=null;const s=t._clip.uuid,o=this._actionsByClip,r=o[s],_=r.knownActions,a=_[_.length-1],l=t._byClipCacheIndex;a._byClipCacheIndex=l,_[l]=a,_.pop(),t._byClipCacheIndex=null;const h=r.actionByRoot,u=(t._localRoot||this._root).uuid;delete h[u],_.length===0&&delete o[s],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let i=0,n=e.length;i!==n;++i){const s=e[i];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(t){const e=this._actions,i=t._cacheIndex,n=this._nActiveActions++,s=e[n];t._cacheIndex=n,e[n]=t,s._cacheIndex=i,e[i]=s}_takeBackAction(t){const e=this._actions,i=t._cacheIndex,n=--this._nActiveActions,s=e[n];t._cacheIndex=n,e[n]=t,s._cacheIndex=i,e[i]=s}_addInactiveBinding(t,e,i){const n=this._bindingsByRootAndName,s=this._bindings;let o=n[e];o===void 0&&(o={},n[e]=o),o[i]=t,t._cacheIndex=s.length,s.push(t)}_removeInactiveBinding(t){const e=this._bindings,i=t.binding,n=i.rootNode.uuid,s=i.path,o=this._bindingsByRootAndName,r=o[n],_=e[e.length-1],a=t._cacheIndex;_._cacheIndex=a,e[a]=_,e.pop(),delete r[s],Object.keys(r).length===0&&delete o[n]}_lendBinding(t){const e=this._bindings,i=t._cacheIndex,n=this._nActiveBindings++,s=e[n];t._cacheIndex=n,e[n]=t,s._cacheIndex=i,e[i]=s}_takeBackBinding(t){const e=this._bindings,i=t._cacheIndex,n=--this._nActiveBindings,s=e[n];t._cacheIndex=n,e[n]=t,s._cacheIndex=i,e[i]=s}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let i=t[e];return i===void 0&&(i=new Hc(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=e,t[e]=i),i}_takeBackControlInterpolant(t){const e=this._controlInterpolants,i=t.__cacheIndex,n=--this._nActiveControlInterpolants,s=e[n];t.__cacheIndex=n,e[n]=t,s.__cacheIndex=i,e[i]=s}clipAction(t,e,i){const n=e||this._root,s=n.uuid;let o=typeof t=="string"?Bh.findByName(n,t):t;const r=o!==null?o.uuid:t,_=this._actionsByClip[r];let a=null;if(i===void 0&&(o!==null?i=o.blendMode:i=Il),_!==void 0){const h=_.actionByRoot[s];if(h!==void 0&&h.blendMode===i)return h;a=_.knownActions[0],o===null&&(o=a._clip)}if(o===null)return null;const l=new ix(this,o,e,i);return this._bindAction(l,a),this._addInactiveAction(l,r,s),l}existingAction(t,e){const i=e||this._root,n=i.uuid,s=typeof t=="string"?Bh.findByName(i,t):t,o=s?s.uuid:t,r=this._actionsByClip[o];return r!==void 0&&r.actionByRoot[n]||null}stopAllAction(){const t=this._actions,e=this._nActiveActions;for(let i=e-1;i>=0;--i)t[i].stop();return this}update(t){t*=this.timeScale;const e=this._actions,i=this._nActiveActions,n=this.time+=t,s=Math.sign(t),o=this._accuIndex^=1;for(let a=0;a!==i;++a)e[a]._update(n,t,s,o);const r=this._bindings,_=this._nActiveBindings;for(let a=0;a!==_;++a)r[a].apply(o);return this}setTime(t){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,i=t.uuid,n=this._actionsByClip,s=n[i];if(s!==void 0){const o=s.knownActions;for(let r=0,_=o.length;r!==_;++r){const a=o[r];this._deactivateAction(a);const l=a._cacheIndex,h=e[e.length-1];a._cacheIndex=null,a._byClipCacheIndex=null,h._cacheIndex=l,e[l]=h,e.pop(),this._removeInactiveBindingsForAction(a)}delete n[i]}}uncacheRoot(t){const e=t.uuid,i=this._actionsByClip;for(const o in i){const r=i[o].actionByRoot,_=r[e];_!==void 0&&(this._deactivateAction(_),this._removeInactiveAction(_))}const n=this._bindingsByRootAndName,s=n[e];if(s!==void 0)for(const o in s){const r=s[o];r.restoreOriginalState(),this._removeInactiveBinding(r)}}uncacheAction(t,e){const i=this.existingAction(t,e);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}nx.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class Ui{constructor(t){typeof t=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new Ui(this.value.clone===void 0?this.value:this.value.clone())}}class sx extends Ja{constructor(t,e,i=1){super(t,e),this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}sx.prototype.isInstancedInterleavedBuffer=!0;const $n=new wt,To=new vi,el=new vi;class ax extends Rl{constructor(t){const e=Qc(t),i=new Ei,n=[],s=[],o=new fi(0,0,1),r=new fi(0,1,0);for(let a=0;a<e.length;a++){const l=e[a];l.parent&&l.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),s.push(o.r,o.g,o.b),s.push(r.r,r.g,r.b))}i.setAttribute("position",new Ji(n,3)),i.setAttribute("color",new Ji(s,3));const _=new ca({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,_),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,i=this.geometry,n=i.getAttribute("position");el.copy(this.root.matrixWorld).invert();for(let s=0,o=0;s<e.length;s++){const r=e[s];r.parent&&r.parent.isBone&&(To.multiplyMatrices(el,r.matrixWorld),$n.setFromMatrixPosition(To),n.setXYZ(o,$n.x,$n.y,$n.z),To.multiplyMatrices(el,r.parent.matrixWorld),$n.setFromMatrixPosition(To),n.setXYZ(o+1,$n.x,$n.y,$n.z),o+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}function Qc(c){const t=[];c.isBone===!0&&t.push(c);for(let e=0;e<c.children.length;e++)t.push.apply(t,Qc(c.children[e]));return t}class ox extends Rl{constructor(t=10,e=10,i=4473924,n=8947848){i=new fi(i),n=new fi(n);const s=e/2,o=t/e,r=t/2,_=[],a=[];for(let u=0,f=0,m=-r;u<=e;u++,m+=o){_.push(-r,0,m,r,0,m),_.push(m,0,-r,m,0,r);const d=u===s?i:n;d.toArray(a,f),f+=3,d.toArray(a,f),f+=3,d.toArray(a,f),f+=3,d.toArray(a,f),f+=3}const l=new Ei;l.setAttribute("position",new Ji(_,3)),l.setAttribute("color",new Ji(a,3));const h=new ca({vertexColors:!0,toneMapped:!1});super(l,h),this.type="GridHelper"}}const In=new Uint32Array(512),zn=new Uint32Array(512);for(let c=0;c<256;++c){const t=c-127;t<-27?(In[c]=0,In[c|256]=32768,zn[c]=24,zn[c|256]=24):t<-14?(In[c]=1024>>-t-14,In[c|256]=1024>>-t-14|32768,zn[c]=-t-1,zn[c|256]=-t-1):t<=15?(In[c]=t+15<<10,In[c|256]=t+15<<10|32768,zn[c]=13,zn[c|256]=13):t<128?(In[c]=31744,In[c|256]=64512,zn[c]=24,zn[c|256]=24):(In[c]=31744,In[c|256]=64512,zn[c]=13,zn[c|256]=13)}const t0=new Uint32Array(2048),Qa=new Uint32Array(64),rx=new Uint32Array(64);for(let c=1;c<1024;++c){let t=c<<13,e=0;for(;(t&8388608)===0;)t<<=1,e-=8388608;t&=-8388609,e+=947912704,t0[c]=t|e}for(let c=1024;c<2048;++c)t0[c]=939524096+(c-1024<<13);for(let c=1;c<31;++c)Qa[c]=c<<23;Qa[31]=1199570944;Qa[32]=2147483648;for(let c=33;c<63;++c)Qa[c]=2147483648+(c-32<<23);Qa[63]=3347054592;for(let c=1;c<64;++c)c!==32&&(rx[c]=1024);pn.create=function(c,t){return console.log("THREE.Curve.create() has been deprecated"),c.prototype=Object.create(pn.prototype),c.prototype.constructor=c,c.prototype.getPoint=t,c};dl.prototype.fromPoints=function(c){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(c)};ox.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};ax.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};ss.prototype.extractUrlBase=function(c){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),kg.extractUrlBase(c)};ss.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};Xn.prototype.center=function(c){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(c)};Xn.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()};Xn.prototype.isIntersectionBox=function(c){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(c)};Xn.prototype.isIntersectionSphere=function(c){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(c)};Xn.prototype.size=function(c){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(c)};Is.prototype.toVector3=function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")};la.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()};ir.prototype.setFromMatrix=function(c){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(c)};qi.prototype.flattenToArrayOffset=function(c,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(c,t)};qi.prototype.multiplyVector3=function(c){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),c.applyMatrix3(this)};qi.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")};qi.prototype.applyToBufferAttribute=function(c){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),c.applyMatrix3(this)};qi.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")};qi.prototype.getInverse=function(c){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(c).invert()};vi.prototype.extractPosition=function(c){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(c)};vi.prototype.flattenToArrayOffset=function(c,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(c,t)};vi.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new wt().setFromMatrixColumn(this,3)};vi.prototype.setRotationFromQuaternion=function(c){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(c)};vi.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")};vi.prototype.multiplyVector3=function(c){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),c.applyMatrix4(this)};vi.prototype.multiplyVector4=function(c){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),c.applyMatrix4(this)};vi.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")};vi.prototype.rotateAxis=function(c){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),c.transformDirection(this)};vi.prototype.crossVector=function(c){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),c.applyMatrix4(this)};vi.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")};vi.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")};vi.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")};vi.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")};vi.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")};vi.prototype.applyToBufferAttribute=function(c){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),c.applyMatrix4(this)};vi.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")};vi.prototype.makeFrustum=function(c,t,e,i,n,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(c,t,i,e,n,s)};vi.prototype.getInverse=function(c){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(c).invert()};Sn.prototype.isIntersectionLine=function(c){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(c)};_n.prototype.multiplyVector3=function(c){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),c.applyQuaternion(this)};_n.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()};_a.prototype.isIntersectionBox=function(c){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(c)};_a.prototype.isIntersectionPlane=function(c){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(c)};_a.prototype.isIntersectionSphere=function(c){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(c)};Fi.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()};Fi.prototype.barycoordFromPoint=function(c,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(c,t)};Fi.prototype.midpoint=function(c){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(c)};Fi.prototypenormal=function(c){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(c)};Fi.prototype.plane=function(c){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(c)};Fi.barycoordFromPoint=function(c,t,e,i,n){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Fi.getBarycoord(c,t,e,i,n)};Fi.normal=function(c,t,e,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Fi.getNormal(c,t,e,i)};$a.prototype.extractAllPoints=function(c){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(c)};$a.prototype.extrude=function(c){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ua(this,c)};$a.prototype.makeGeometry=function(c){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Ol(this,c)};Ne.prototype.fromAttribute=function(c,t,e){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(c,t,e)};Ne.prototype.distanceToManhattan=function(c){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(c)};Ne.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};wt.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")};wt.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")};wt.prototype.getPositionFromMatrix=function(c){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(c)};wt.prototype.getScaleFromMatrix=function(c){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(c)};wt.prototype.getColumnFromMatrix=function(c,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,c)};wt.prototype.applyProjection=function(c){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(c)};wt.prototype.fromAttribute=function(c,t,e){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(c,t,e)};wt.prototype.distanceToManhattan=function(c){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(c)};wt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Li.prototype.fromAttribute=function(c,t,e){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(c,t,e)};Li.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Ti.prototype.getChildByName=function(c){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(c)};Ti.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")};Ti.prototype.translate=function(c,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,c)};Ti.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")};Ti.prototype.applyMatrix=function(c){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(c)};Object.defineProperties(Ti.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(c){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=c}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});sn.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")};Object.defineProperties(sn.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),Du},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});Zc.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};nn.prototype.setLens=function(c,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),t!==void 0&&(this.filmGauge=t),this.setFocalLength(c)};Object.defineProperties(Tn.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(c){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=c}},shadowCameraLeft:{set:function(c){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=c}},shadowCameraRight:{set:function(c){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=c}},shadowCameraTop:{set:function(c){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=c}},shadowCameraBottom:{set:function(c){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=c}},shadowCameraNear:{set:function(c){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=c}},shadowCameraFar:{set:function(c){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=c}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(c){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=c}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(c){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=c}},shadowMapHeight:{set:function(c){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=c}}});Object.defineProperties(Bi.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===No},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(No)}}});Bi.prototype.setDynamic=function(c){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(c===!0?No:Oa),this};Bi.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Bi.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};Ei.prototype.addIndex=function(c){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(c)};Ei.prototype.addAttribute=function(c,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(t&&t.isBufferAttribute)&&!(t&&t.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(c,new Bi(arguments[1],arguments[2]))):c==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(c,t)};Ei.prototype.addDrawCall=function(c,t,e){e!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(c,t)};Ei.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()};Ei.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")};Ei.prototype.removeAttribute=function(c){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(c)};Ei.prototype.applyMatrix=function(c){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(c)};Object.defineProperties(Ei.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});Ja.prototype.setDynamic=function(c){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(c===!0?No:Oa),this};Ja.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};ua.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")};ua.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")};ua.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")};El.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")};Ui.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this};Object.defineProperties(Gi.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new fi}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(c){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=c===rc}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(c){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=c}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}});Object.defineProperties(wn.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(c){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=c}}});Vi.prototype.clearTarget=function(c,t,e,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(c),this.clear(t,e,i)};Vi.prototype.animate=function(c){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(c)};Vi.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()};Vi.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()};Vi.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision};Vi.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()};Vi.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")};Vi.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")};Vi.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")};Vi.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")};Vi.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")};Vi.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")};Vi.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures};Vi.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")};Vi.prototype.enableScissorTest=function(c){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(c)};Vi.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};Vi.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};Vi.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};Vi.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};Vi.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")};Vi.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")};Vi.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")};Vi.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")};Vi.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")};Vi.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()};Object.defineProperties(Vi.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(c){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=c}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(c){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=c}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(c){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=c===!0?Ci:es}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});Object.defineProperties(Ic.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(ln.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(c){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=c}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(c){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=c}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(c){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=c}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(c){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=c}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(c){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=c}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(c){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=c}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(c){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=c}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(c){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=c}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(c){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=c}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(c){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=c}}});Gg.prototype.load=function(c){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return new Fg().load(c,function(i){t.setBuffer(i)}),this};Zl.prototype.updateCubeMap=function(c,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(c,t)};Zl.prototype.clear=function(c,t,e,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(c,t,e,i)};Xs.crossOrigin=void 0;Xs.loadTexture=function(c,t,e,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const n=new Ag;n.setCrossOrigin(this.crossOrigin);const s=n.load(c,e,void 0,i);return t&&(s.mapping=t),s};Xs.loadTextureCube=function(c,t,e,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const n=new Lg;n.setCrossOrigin(this.crossOrigin);const s=n.load(c,e,void 0,i);return t&&(s.mapping=t),s};Xs.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};Xs.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Xl}}));typeof window!="undefined"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Xl);var Ca,Go;if(typeof window!="undefined")Ca=window.requestAnimationFrame,Go=window.cancelAnimationFrame;else{const c=performance.now(),t=1e3/60;Ca=e=>setTimeout(()=>{e(performance.now()-c)},t),Go=clearTimeout}class lx{constructor(){li(this,"onTick",t=>{this.isAnimating&&(this.requestId=Ca(this.onTick)),this.delta=Math.min(150,t-this.last),this.last=t,this.time=t*.001,this.frame++;for(let e=this.callbacks.length-1;e>=0;e--){const i=this.callbacks[e];if(!!i){if(i.fps){const n=t-i.last;if(n<1e3/i.fps)continue;i.last=t,i.frame++,i(this.time,n,i.frame);continue}i(this.time,this.delta,this.frame)}}});this.callbacks=[],this.last=performance.now(),this.time=0,this.delta=0,this.frame=0,this.isAnimating=!1}add(t,e){e&&(t.fps=e,t.last=performance.now(),t.frame=0),this.callbacks.unshift(t)}remove(t){const e=this.callbacks.indexOf(t);~e&&this.callbacks.splice(e,1)}start(){this.isAnimating||(this.isAnimating=!0,this.requestId=Ca(this.onTick))}stop(){!this.isAnimating||(this.isAnimating=!1,Go(this.requestId))}setRequestFrame(t){Ca=t}setCancelFrame(t){Go=t}}const vl=new lx,_x=4,hx=.001,cx=1e-7,ux=10,Ta=11,Vo=1/(Ta-1),px=typeof Float32Array=="function";function e0(c,t){return 1-3*t+3*c}function i0(c,t){return 3*t-6*c}function n0(c){return 3*c}function Ho(c,t,e){return((e0(t,e)*c+i0(t,e))*c+n0(t))*c}function s0(c,t,e){return 3*e0(t,e)*c*c+2*i0(t,e)*c+n0(t)}function mx(c,t,e,i,n){let s,o,r=0;do o=t+(e-t)/2,s=Ho(o,i,n)-c,s>0?e=o:t=o;while(Math.abs(s)>cx&&++r<ux);return o}function fx(c,t,e,i){for(let n=0;n<_x;n++){const s=s0(t,e,i);if(s===0)return t;t-=(Ho(t,e,i)-c)/s}return t}function dx(c){return c}function gx(c,t,e,i){if(!(0<=c&&c<=1&&0<=e&&e<=1))throw new Error("Bezier x values must be in [0, 1] range");if(c===t&&e===i)return dx;const n=px?new Float32Array(Ta):new Array(Ta);for(let o=0;o<Ta;o++)n[o]=Ho(o*Vo,c,e);function s(o){let r=0,_=1;const a=Ta-1;for(;_!==a&&n[_]<=o;_++)r+=Vo;_--;const l=(o-n[_])/(n[_+1]-n[_]),h=r+l*Vo,u=s0(h,c,e);return u>=hx?fx(o,h,c,e):u===0?h:mx(o,r,r+Vo,c,e)}return function(r){return r===0||r===1?r:Ho(s(r),t,i)}}class Uh{static linear(t){return t}static easeInQuad(t){return t*t}static easeOutQuad(t){return t*(2-t)}static easeInOutQuad(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}static easeInCubic(t){return t*t*t}static easeOutCubic(t){return--t*t*t+1}static easeInOutCubic(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}static easeInQuart(t){return t*t*t*t}static easeOutQuart(t){return 1- --t*t*t*t}static easeInOutQuart(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}static easeInQuint(t){return t*t*t*t*t}static easeOutQuint(t){return--t*t*t*t*t+1}static easeInOutQuint(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}static easeInSine(t){return 1-Math.sin((1-t)*Math.PI/2)}static easeOutSine(t){return Math.sin(t*Math.PI/2)}static easeInOutSine(t){return .5*(1-Math.sin(Math.PI*(.5-t)))}static easeInExpo(t){return t===0?0:Math.pow(1024,t-1)}static easeOutExpo(t){return t===1?1:1-Math.pow(2,-10*t)}static easeInOutExpo(t){return t===0||t===1?t:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)}static easeInCirc(t){return 1-Math.sqrt(1-t*t)}static easeOutCirc(t){return Math.sqrt(1- --t*t)}static easeInOutCirc(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}static easeInBack(t){return t===1?1:t*t*((1.70158+1)*t-1.70158)}static easeOutBack(t){return t===0?0:--t*t*((1.70158+1)*t+1.70158)+1}static easeInOutBack(t){const e=2.5949095;return(t*=2)<1?.5*(t*t*((e+1)*t-e)):.5*((t-=2)*t*((e+1)*t+e)+2)}static easeInElastic(t,e=1,i=.3){if(t===0||t===1)return t;const n=Math.PI*2,s=i/n*Math.asin(1/e);return-(e*Math.pow(2,10*--t)*Math.sin((t-s)*n/i))}static easeOutElastic(t,e=1,i=.3){if(t===0||t===1)return t;const n=Math.PI*2,s=i/n*Math.asin(1/e);return e*Math.pow(2,-10*t)*Math.sin((t-s)*n/i)+1}static easeInOutElastic(t,e=1,i=.3*1.5){if(t===0||t===1)return t;const n=Math.PI*2,s=i/n*Math.asin(1/e);return(t*=2)<1?-.5*(e*Math.pow(2,10*--t)*Math.sin((t-s)*n/i)):e*Math.pow(2,-10*--t)*Math.sin((t-s)*n/i)*.5+1}static easeInBounce(t){return 1-this.easeOutBounce(1-t)}static easeOutBounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}static easeInOutBounce(t){return t<.5?this.easeInBounce(t*2)*.5:this.easeOutBounce(t*2-1)*.5+.5}static addBezier(t,e,i,n,s){this[t]=gx(e,i,n,s)}}const ps=[];class ql{constructor(t,e,i,n,s=0,o,r){li(this,"onUpdate",(t,e)=>{this.elapsed+=e;const i=Math.max(0,Math.min(1,(this.elapsed-this.delay)/this.duration)),n=this.ease(i,this.spring,this.damping);for(const s in this.from)this.object[s]=this.from[s]+(this.to[s]-this.from[s])*n;this.update&&this.update(),i===1&&(Wo(this),this.complete&&this.complete())});typeof s!="number"&&(r=o,o=s,s=0),this.object=t,this.duration=i,this.elapsed=0,this.ease=typeof n=="function"?n:Uh[n]||Uh.easeOutCubic,this.delay=s,this.complete=o,this.update=r,this.isAnimating=!1,this.from={},this.to=Object.assign({},e),this.spring=this.to.spring,this.damping=this.to.damping,delete this.to.spring,delete this.to.damping;for(const _ in this.to)typeof this.to[_]=="number"&&typeof t[_]=="number"&&(this.from[_]=t[_]);this.start()}start(){this.isAnimating||(this.isAnimating=!0,vl.add(this.onUpdate))}stop(){!this.isAnimating||(this.isAnimating=!1,vl.remove(this.onUpdate))}}function xx(c,t){const e=new ql(t,null,c,"linear",0,t);return ps.push(e),e}function vx(c,t,e,i,n=0,s,o){typeof n!="number"&&(o=s,s=n,n=0);const r=new Promise(_=>{const a=new ql(c,t,e,i,n,_,o);ps.push(a)});return s&&r.then(s),r}function Wo(c){if(c instanceof ql){c.stop();const t=ps.indexOf(c);~t&&ps.splice(t,1)}else for(let t=ps.length-1;t>=0;t--)ps[t].object===c&&Wo(ps[t])}const Gh=["x","y","z","skewX","skewY","rotation","rotationX","rotationY","rotationZ","scale","scaleX","scaleY","scaleZ"],Hh=["blur","brightness","contrast","grayscale","hue","invert","saturate","sepia"],Wh=["opacity","zIndex","fontWeight","strokeWidth","strokeDashoffset","stopOpacity"],bx=["opacity","brightness","contrast","saturate","scale","stopOpacity"];class Jl{constructor(t,e="div",i){this.events=new G1,this.children=[],this.timeouts=[],this.style={},this.isTransform=!1,this.isFilter=!1,typeof t=="object"&&t!==null?this.element=t:e!==null&&(this.name=t,this.type=e,e==="svg"?this.element=document.createElementNS("http://www.w3.org/2000/svg",i||"svg"):this.element=document.createElement(e),typeof t=="string"&&(t.startsWith(".")?this.element.className=t.slice(1):this.element.id=t))}add(t){if(!!this.children)return this.children.push(t),t.parent=this,t.element?this.element.appendChild(t.element):t.nodeName&&this.element.appendChild(t),t}remove(t){if(!this.children)return;t.element?t.element.parentNode.removeChild(t.element):t.nodeName&&t.parentNode.removeChild(t);const e=this.children.indexOf(t);~e&&this.children.splice(e,1)}clone(){if(!!this.element)return new Jl(this.element.cloneNode(!0))}empty(){if(!!this.element){for(let t=this.children.length-1;t>=0;t--)this.children[t]&&this.children[t].destroy&&this.children[t].destroy();return this.children.length=0,this.element.innerHTML="",this}}attr(t){if(!!this.element){for(const e in t)this.element.setAttribute(e,t[e]);return this}}css(t){if(!this.element)return;const e=this.style;for(const i in t){if(~Gh.indexOf(i)){e[i]=t[i],this.isTransform=!0;continue}if(~Hh.indexOf(i)){e[i]=t[i],this.isFilter=!0;continue}let n;~Wh.indexOf(i)?(n=t[i],e[i]=n):n=typeof t[i]!="string"?t[i]+"px":t[i],this.element.style[i]=n}if(this.isTransform){let i="";if(typeof e.x!="undefined"||typeof e.y!="undefined"||typeof e.z!="undefined"){const n=typeof e.x!="undefined"?e.x:0,s=typeof e.y!="undefined"?e.y:0,o=typeof e.z!="undefined"?e.z:0;i+=`translate3d(${n}px, ${s}px, ${o}px)`}typeof e.skewX!="undefined"&&(i+=`skewX(${e.skewX}deg)`),typeof e.skewY!="undefined"&&(i+=`skewY(${e.skewY}deg)`),typeof e.rotation!="undefined"&&(i+=`rotate(${e.rotation}deg)`),typeof e.rotationX!="undefined"&&(i+=`rotateX(${e.rotationX}deg)`),typeof e.rotationY!="undefined"&&(i+=`rotateY(${e.rotationY}deg)`),typeof e.rotationZ!="undefined"&&(i+=`rotateZ(${e.rotationZ}deg)`),typeof e.scale!="undefined"&&(i+=`scale(${e.scale})`),typeof e.scaleX!="undefined"&&(i+=`scaleX(${e.scaleX})`),typeof e.scaleY!="undefined"&&(i+=`scaleY(${e.scaleY})`),typeof e.scaleZ!="undefined"&&(i+=`scaleZ(${e.scaleZ})`),this.element.style.transform=i}if(this.isFilter){let i="";typeof e.blur!="undefined"&&(i+=`blur(${e.blur}px)`),typeof e.brightness!="undefined"&&(i+=`brightness(${e.brightness})`),typeof e.contrast!="undefined"&&(i+=`contrast(${e.contrast})`),typeof e.grayscale!="undefined"&&(i+=`grayscale(${e.grayscale})`),typeof e.hue!="undefined"&&(i+=`hue-rotate(${e.hue}deg)`),typeof e.invert!="undefined"&&(i+=`invert(${e.invert})`),typeof e.saturate!="undefined"&&(i+=`saturate(${e.saturate})`),typeof e.sepia!="undefined"&&(i+=`sepia(${e.sepia})`),this.element.style.filter=i}return this}tween(t,e,i,n=0,s,o){if(!this.element)return;typeof n!="number"&&(o=s,s=n,n=0);const r=getComputedStyle(this.element);for(const a in t){let l;typeof this.style[a]!="undefined"?l=this.style[a]:~Gh.indexOf(a)||~Hh.indexOf(a)||~Wh.indexOf(a)?l=~bx.indexOf(a)?1:0:typeof r[a]=="string"&&(l=parseFloat(r[a])),isNaN(l)||(this.style[a]=l)}return vx(this.style,t,e,i,n,s,()=>{this.css(this.style),o&&o()})}clearTween(){return Wo(this.style),this}delayedCall(t,e){if(!this.timeouts)return;const i=xx(t,()=>{this.clearTimeout(i,!0),e&&e()});return this.timeouts.push(i),i}clearTimeout(t,e){if(!this.timeouts)return;e||Wo(t);const i=this.timeouts.indexOf(t);~i&&this.timeouts.splice(i,1)}clearTimeouts(){if(!!this.timeouts)for(let t=this.timeouts.length-1;t>=0;t--)this.clearTimeout(this.timeouts[t])}text(t){if(!!this.element)return typeof t=="undefined"?this.element.textContent:(this.element.textContent=t,this)}html(t){if(!!this.element)return typeof t=="undefined"?this.element.innerHTML:(this.element.innerHTML=t,this)}hide(){return this.css({display:"none"})}show(){return this.css({display:""})}invisible(){return this.css({visibility:"hidden"})}visible(){return this.css({visibility:""})}bg(t,e="contain",i="center",n="no-repeat"){const s={backgroundImage:`url(${Kn.getPath(t)})`,backgroundSize:e,backgroundPosition:i,backgroundRepeat:n};return this.css(s)}line(t=this.progress||0){const e=this.start||0,i=this.offset||0,n=this.element.getTotalLength(),s=n*t,o=n-s,r={strokeDasharray:`${s},${o}`,strokeDashoffset:-n*(e+i)};return this.css(r)}load(t){return fetch(Kn.getPath(t),Kn.options).then(i=>i.text()).then(i=>{this.html(i)})}destroy(){if(!!this.children){this.parent&&this.parent.remove&&this.parent.remove(this),this.clearTimeouts(),this.clearTween(),this.events.destroy();for(let t=this.children.length-1;t>=0;t--)this.children[t]&&this.children[t].destroy&&this.children[t].destroy();this.element.object=null;for(const t in this)this[t]=null;return null}}}var Wi;if(typeof window!="undefined"){let c=function(){window.addEventListener("popstate",t),window.addEventListener("keydown",e),window.addEventListener("keyup",i),window.addEventListener("keypress",n),window.addEventListener("resize",s),document.addEventListener("visibilitychange",o),vl.start()},t=function(r){Wi.path=location.pathname,Wi.events.emit(ki.STATE_CHANGE,r)},e=function(r){Wi.events.emit(ki.KEY_DOWN,r)},i=function(r){Wi.events.emit(ki.KEY_UP,r)},n=function(r){Wi.events.emit(ki.KEY_PRESS,r)},s=function(r){Wi.width=document.documentElement.clientWidth,Wi.height=document.documentElement.clientHeight,Wi.dpr=window.devicePixelRatio,Wi.aspect=Wi.width/Wi.height,Wi.events.emit(ki.RESIZE,r)},o=function(r){Wi.events.emit(ki.VISIBILITY,r)};Wi=new Jl(null,null),Wi.init=r=>{Wi.element=r,c(),t(),s()},Wi.setPath=r=>{r!==location.pathname&&(history.pushState(null,null,r),t())},Wi.setTitle=r=>{document.title=r}}function yx(){const c=new Ei,t=new Float32Array([-1,-1,3,-1,-1,3]),e=new Float32Array([0,0,2,0,0,2]);return c.setAttribute("position",new Bi(t,2)),c.setAttribute("uv",new Bi(e,2)),c}var Mx=`
in vec3 position;
in vec2 uv;

out vec2 vUv;

void main() {
    vUv = uv;

    gl_Position = vec4(position, 1.0);
}
`,wx=`
float smootherstep(float edge0, float edge1, float x) {
    x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
    return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);
}
`,Xx=`
vec4 blur13(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.411764705882353) * direction;
  vec2 off2 = vec2(3.2941176470588234) * direction;
  vec2 off3 = vec2(5.176470588235294) * direction;
  color += texture(image, uv) * 0.1964825501511404;
  color += texture(image, uv + (off1 / resolution)) * 0.2969069646728344;
  color += texture(image, uv - (off1 / resolution)) * 0.2969069646728344;
  color += texture(image, uv + (off2 / resolution)) * 0.09447039785044732;
  color += texture(image, uv - (off2 / resolution)) * 0.09447039785044732;
  color += texture(image, uv + (off3 / resolution)) * 0.010381362401148057;
  color += texture(image, uv - (off3 / resolution)) * 0.010381362401148057;
  return color;
}
`,Ix=`
precision highp float;

uniform sampler2D tMap;
uniform float uBluriness;
uniform vec2 uDirection;
uniform vec2 uResolution;

in vec2 vUv;

out vec4 FragColor;

${wx}
${Xx}

void main() {
    FragColor = blur13(tMap, vUv, uResolution, smootherstep(uBluriness, 0.0, vUv.y) * uDirection);
}
`;class zx extends lr{constructor(){super({glslVersion:Fo,uniforms:{tMap:new Ui(null),uBluriness:new Ui(1),uDirection:new Ui(new Ne(1,0)),uResolution:new Ui(new Ne)},vertexShader:Mx,fragmentShader:Ix,blending:Ln,depthWrite:!1,depthTest:!1})}}class jh extends qs{constructor({width:t=512,height:e=512,clipBias:i=0,blurIterations:n=8,blurFactor:s=1}={}){super(),this.clipBias=i,this.blurIterations=n,this.reflectorPlane=new Sn,this.normal=new wt,this.reflectorWorldPosition=new wt,this.cameraWorldPosition=new wt,this.rotationMatrix=new vi,this.lookAtPosition=new wt(0,0,-1),this.clipPlane=new Li,this.view=new wt,this.target=new wt,this.q=new Li,this.textureMatrix=new vi,this.virtualCamera=new nn,this.textureMatrixUniform=new Ui(this.textureMatrix),this.renderTarget=new ln(t,e,{depthBuffer:!1}),this.renderTargetRead=this.renderTarget.clone(),this.renderTargetWrite=this.renderTarget.clone(),this.renderTarget.depthBuffer=!0,this.renderTargetUniform=new Ui(this.blurIterations>0?this.renderTargetRead.texture:this.renderTarget.texture),this.blurMaterial=new zx,this.blurMaterial.uniforms.uBluriness.value=s,this.blurMaterial.uniforms.uResolution.value.set(t,e),this.screenScene=new El,this.screenCamera=new nr(-1,1,1,-1,0,1),this.screenTriangle=yx(),this.screen=new sn(this.screenTriangle,this.blurMaterial),this.screen.frustumCulled=!1,this.screenScene.add(this.screen)}setSize(t,e){this.renderTarget.setSize(t,e),this.renderTargetRead.setSize(t,e),this.renderTargetWrite.setSize(t,e),this.blurMaterial.uniforms.uResolution.value.set(t,e)}update(t,e,i){if(this.reflectorWorldPosition.setFromMatrixPosition(this.matrixWorld),this.cameraWorldPosition.setFromMatrixPosition(i.matrixWorld),this.rotationMatrix.extractRotation(this.matrixWorld),this.normal.set(0,0,1),this.normal.applyMatrix4(this.rotationMatrix),this.view.subVectors(this.reflectorWorldPosition,this.cameraWorldPosition),this.view.dot(this.normal)>0)return;this.view.reflect(this.normal).negate(),this.view.add(this.reflectorWorldPosition),this.rotationMatrix.extractRotation(i.matrixWorld),this.lookAtPosition.set(0,0,-1),this.lookAtPosition.applyMatrix4(this.rotationMatrix),this.lookAtPosition.add(this.cameraWorldPosition),this.target.subVectors(this.reflectorWorldPosition,this.lookAtPosition),this.target.reflect(this.normal).negate(),this.target.add(this.reflectorWorldPosition),this.virtualCamera.position.copy(this.view),this.virtualCamera.up.set(0,1,0),this.virtualCamera.up.applyMatrix4(this.rotationMatrix),this.virtualCamera.up.reflect(this.normal),this.virtualCamera.lookAt(this.target),this.virtualCamera.far=i.far,this.virtualCamera.updateMatrixWorld(),this.virtualCamera.projectionMatrix.copy(i.projectionMatrix),this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.virtualCamera.projectionMatrix),this.textureMatrix.multiply(this.virtualCamera.matrixWorldInverse),this.textureMatrix.multiply(this.matrixWorld),this.reflectorPlane.setFromNormalAndCoplanarPoint(this.normal,this.reflectorWorldPosition),this.reflectorPlane.applyMatrix4(this.virtualCamera.matrixWorldInverse),this.clipPlane.set(this.reflectorPlane.normal.x,this.reflectorPlane.normal.y,this.reflectorPlane.normal.z,this.reflectorPlane.constant);const n=this.virtualCamera.projectionMatrix;this.q.x=(Math.sign(this.clipPlane.x)+n.elements[8])/n.elements[0],this.q.y=(Math.sign(this.clipPlane.y)+n.elements[9])/n.elements[5],this.q.z=-1,this.q.w=(1+n.elements[10])/n.elements[14],this.clipPlane.multiplyScalar(2/this.clipPlane.dot(this.q)),n.elements[2]=this.clipPlane.x,n.elements[6]=this.clipPlane.y,n.elements[10]=this.clipPlane.z+1-this.clipBias,n.elements[14]=this.clipPlane.w;const s=t.getRenderTarget(),o=t.xr.enabled,r=t.shadowMap.autoUpdate;t.xr.enabled=!1,t.shadowMap.autoUpdate=!1,t.setRenderTarget(this.renderTarget),t.state.buffers.depth.setMask(!0),t.autoClear===!1&&t.clear(),t.render(e,this.virtualCamera);const _=this.blurIterations;for(let a=0;a<_;a++){a===0?this.blurMaterial.uniforms.tMap.value=this.renderTarget.texture:this.blurMaterial.uniforms.tMap.value=this.renderTargetRead.texture;const l=(_-a-1)*.5;this.blurMaterial.uniforms.uDirection.value.set(a%2===0?l:0,a%2===0?0:l),t.setRenderTarget(this.renderTargetWrite),t.autoClear===!1&&t.clear(),t.render(this.screenScene,this.screenCamera);const h=this.renderTargetRead;this.renderTargetRead=this.renderTargetWrite,this.renderTargetWrite=h,this.renderTargetUniform.value=this.renderTargetRead.texture}t.xr.enabled=o,t.shadowMap.autoUpdate=r,t.setRenderTarget(s)}destroy(){this.renderTargetWrite.dispose(),this.renderTargetRead.dispose(),this.renderTarget.dispose(),this.blurMaterial.dispose(),this.screenTriangle.dispose();for(const t in this)this[t]=null;return null}}var I=I||{};I.collision||(I.collision={});I.collision.broadphase||(I.collision.broadphase={});I.collision.broadphase.BroadPhase=class{constructor(t){this._type=t,this._numProxies=0,this._proxyList=null,this._proxyListLast=null,this._proxyPairList=null,this._incremental=!1,this._testCount=0,this._proxyPairPool=null,this._idCount=0,this._convexSweep=new I.collision.broadphase._BroadPhase.ConvexSweepGeometry,this._aabb=new I.collision.broadphase._BroadPhase.AabbGeometry,this.identity=new I.common.Transform,this.zero=new I.common.Vec3,this.rayCastHit=new I.collision.geometry.RayCastHit}createProxy(t,e){return null}destroyProxy(t){}moveProxy(t,e,i){}isOverlapping(t,e){return t._aabbMinX<e._aabbMaxX&&t._aabbMaxX>e._aabbMinX&&t._aabbMinY<e._aabbMaxY&&t._aabbMaxY>e._aabbMinY&&t._aabbMinZ<e._aabbMaxZ?t._aabbMaxZ>e._aabbMinZ:!1}collectPairs(){}getProxyPairList(){return this._proxyPairList}isIncremental(){return this._incremental}getTestCount(){return this._testCount}rayCast(t,e,i){}convexCast(t,e,i,n){}aabbTest(t,e){}};I.collision.geometry||(I.collision.geometry={});I.collision.geometry.Geometry=class{constructor(t){this._type=t,this._volume=0}_updateMass(){}_computeAabb(t,e){}_rayCastLocal(t,e,i,n,s,o,r){return!1}getType(){return this._type}getVolume(){return this._volume}rayCast(t,e,i,n){let s,o,r,_,a,l;s=t.x,o=t.y,r=t.z,_=e.x,a=e.y,l=e.z,s-=i._positionX,o-=i._positionY,r-=i._positionZ,_-=i._positionX,a-=i._positionY,l-=i._positionZ;let h,u,f;h=i._rotation00*s+i._rotation10*o+i._rotation20*r,u=i._rotation01*s+i._rotation11*o+i._rotation21*r,f=i._rotation02*s+i._rotation12*o+i._rotation22*r,s=h,o=u,r=f;let m,d,p;if(m=i._rotation00*_+i._rotation10*a+i._rotation20*l,d=i._rotation01*_+i._rotation11*a+i._rotation21*l,p=i._rotation02*_+i._rotation12*a+i._rotation22*l,_=m,a=d,l=p,this._rayCastLocal(s,o,r,_,a,l,n)){let g,x,b,y,z,M,Y=n.position;g=Y.x,x=Y.y,b=Y.z;let X=n.normal;y=X.x,z=X.y,M=X.z;let w,S,V;w=i._rotation00*g+i._rotation01*x+i._rotation02*b,S=i._rotation10*g+i._rotation11*x+i._rotation12*b,V=i._rotation20*g+i._rotation21*x+i._rotation22*b,g=w,x=S,b=V;let F,C,A;F=i._rotation00*y+i._rotation01*z+i._rotation02*M,C=i._rotation10*y+i._rotation11*z+i._rotation12*M,A=i._rotation20*y+i._rotation21*z+i._rotation22*M,y=F,z=C,M=A,g+=i._positionX,x+=i._positionY,b+=i._positionZ;let Z=n.position;Z.x=g,Z.y=x,Z.z=b;let L=n.normal;return L.x=y,L.y=z,L.z=M,!0}return!1}};I.collision.geometry.ConvexGeometry=class extends I.collision.geometry.Geometry{constructor(t){super(t),this._gjkMargin=I.common.Setting.defaultGJKMargin,this._useGjkRayCast=!1}getGjkMergin(){return this._gjkMargin}setGjkMergin(t){t<0&&(t=0),this._gjkMargin=t}computeLocalSupportingVertex(t,e){}rayCast(t,e,i,n){return this._useGjkRayCast?I.collision.narrowphase.detector.gjkepa.GjkEpa.instance.rayCast(this,i,t,e,n):super.rayCast(t,e,i,n)}};I.collision.broadphase._BroadPhase||(I.collision.broadphase._BroadPhase={});I.collision.broadphase._BroadPhase.ConvexSweepGeometry=class extends I.collision.geometry.ConvexGeometry{constructor(){super(-1)}init(t,e,i){this.c=t;let n,s,o;n=i.x,s=i.y,o=i.z;let r,_,a,l,h,u;l=e._rotation00*n+e._rotation10*s+e._rotation20*o,h=e._rotation01*n+e._rotation11*s+e._rotation21*o,u=e._rotation02*n+e._rotation12*s+e._rotation22*o,r=l,_=h,a=u,this.localTranslation=new I.common.Vec3;let f=this.localTranslation;f.x=r,f.y=_,f.z=a,this._gjkMargin=t._gjkMargin}computeLocalSupportingVertex(t,e){this.c.computeLocalSupportingVertex(t,e);let i=this.localTranslation;if(t.x*i.x+t.y*i.y+t.z*i.z>0){let n=this.localTranslation;e.x+=n.x,e.y+=n.y,e.z+=n.z}}};I.collision.broadphase._BroadPhase.AabbGeometry=class extends I.collision.geometry.ConvexGeometry{constructor(){super(-1),this.min=new I.common.Vec3,this.max=new I.common.Vec3}computeLocalSupportingVertex(t,e){e.x=t.x>0?this.max.x:this.min.x,e.y=t.y>0?this.max.y:this.min.y,e.z=t.z>0?this.max.z:this.min.z}};I.collision.broadphase.BroadPhaseProxyCallback=class{constructor(){}process(t){}};I.collision.broadphase.BroadPhaseType=class{};I.collision.broadphase.Proxy=class{constructor(t,e){this.userData=t,this._id=e,this._prev=null,this._next=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}getId(){return this._id}getFatAabb(){let t=new I.collision.geometry.Aabb;return t._minX=this._aabbMinX,t._minY=this._aabbMinY,t._minZ=this._aabbMinZ,t._maxX=this._aabbMaxX,t._maxY=this._aabbMaxY,t._maxZ=this._aabbMaxZ,t}getFatAabbTo(t){t._minX=this._aabbMinX,t._minY=this._aabbMinY,t._minZ=this._aabbMinZ,t._maxX=this._aabbMaxX,t._maxY=this._aabbMaxY,t._maxZ=this._aabbMaxZ}};I.collision.broadphase.ProxyPair=class{constructor(){this._p1=null,this._p2=null}getProxy1(){return this._p1}getProxy2(){return this._p2}getNext(){return this._next}};I.collision.broadphase.bruteforce||(I.collision.broadphase.bruteforce={});I.collision.broadphase.bruteforce.BruteForceBroadPhase=class extends I.collision.broadphase.BroadPhase{constructor(){super(1),this._incremental=!1}createProxy(t,e){let i=new I.collision.broadphase.Proxy(t,this._idCount++);return this._numProxies++,this._proxyList==null?(this._proxyList=i,this._proxyListLast=i):(this._proxyListLast._next=i,i._prev=this._proxyListLast,this._proxyListLast=i),i._aabbMinX=e._minX,i._aabbMinY=e._minY,i._aabbMinZ=e._minZ,i._aabbMaxX=e._maxX,i._aabbMaxY=e._maxY,i._aabbMaxZ=e._maxZ,i}destroyProxy(t){this._numProxies--;let e=t._prev,i=t._next;e!=null&&(e._next=i),i!=null&&(i._prev=e),t==this._proxyList&&(this._proxyList=this._proxyList._next),t==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),t._next=null,t._prev=null,t.userData=null}moveProxy(t,e,i){t._aabbMinX=e._minX,t._aabbMinY=e._minY,t._aabbMinZ=e._minZ,t._aabbMaxX=e._maxX,t._aabbMaxY=e._maxY,t._aabbMaxZ=e._maxZ}collectPairs(){let t=this._proxyPairList;if(t!=null){for(;t._p1=null,t._p2=null,t=t._next,t!=null;);this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}this._testCount=0;let e=this._proxyList;for(;e!=null;){let i=e._next,n=e._next;for(;n!=null;){let s=n._next;if(this._testCount++,e._aabbMinX<n._aabbMaxX&&e._aabbMaxX>n._aabbMinX&&e._aabbMinY<n._aabbMaxY&&e._aabbMaxY>n._aabbMinY&&e._aabbMinZ<n._aabbMaxZ&&e._aabbMaxZ>n._aabbMinZ){let o=this._proxyPairPool;o!=null?(this._proxyPairPool=o._next,o._next=null):o=new I.collision.broadphase.ProxyPair;let r=o;this._proxyPairList==null?this._proxyPairList=r:(r._next=this._proxyPairList,this._proxyPairList=r),r._p1=e,r._p2=n}n=s}e=i}}rayCast(t,e,i){let n,s,o,r,_,a;n=t.x,s=t.y,o=t.z,r=e.x,_=e.y,a=e.z;let l=this._proxyList;for(;l!=null;){let h=l._next,u=n,f=s,m=o,d=r,p=_,g=a,x=l._aabbMinX,b=l._aabbMinY,y=l._aabbMinZ,z=l._aabbMaxX,M=l._aabbMaxY,Y=l._aabbMaxZ,X;if(x>(u>d?u:d)||z<(u<d?u:d)||b>(f>p?f:p)||M<(f<p?f:p)||y>(m>g?m:g)||Y<(m<g?m:g))X=!1;else{let w=d-u,S=p-f,V=g-m,F=w<0?-w:w,C=S<0?-S:S,A=V<0?-V:V,Z=(z-x)*.5,L=(M-b)*.5,E=(Y-y)*.5,T=u-(z+x)*.5,P=f-(M+b)*.5,N=m-(Y+y)*.5,R,k,O=P*V-N*S;if((O<0?-O:O)-(L*A+E*C)>0)k=!0;else{let v=N*w-T*V;k=(v<0?-v:v)-(E*F+Z*A)>0}if(k)R=!0;else{let v=T*S-P*w;R=(v<0?-v:v)-(Z*C+L*F)>0}X=!R}X&&i.process(l),l=h}}convexCast(t,e,i,n){let s=this._proxyList;for(;s!=null;){let o=s._next,r=this._aabb.min;r.x=s._aabbMinX,r.y=s._aabbMinY,r.z=s._aabbMinZ;let _=this._aabb.max;_.x=s._aabbMaxX,_.y=s._aabbMaxY,_.z=s._aabbMaxZ,this._convexSweep.init(t,e,i);let a=I.collision.narrowphase.detector.gjkepa.GjkEpa.instance;a.computeClosestPointsImpl(this._convexSweep,this._aabb,e,this.identity,null,!1)==0&&a.distance<=0&&n.process(s),s=o}}aabbTest(t,e){let i=this._proxyList;for(;i!=null;){let n=i._next;t._minX<i._aabbMaxX&&t._maxX>i._aabbMinX&&t._minY<i._aabbMaxY&&t._maxY>i._aabbMinY&&t._minZ<i._aabbMaxZ&&t._maxZ>i._aabbMinZ&&e.process(i),i=n}}};I.collision.broadphase.bvh||(I.collision.broadphase.bvh={});I.collision.broadphase.bvh.BvhBroadPhase=class extends I.collision.broadphase.BroadPhase{constructor(){super(2),this._incremental=!0,this._tree=new I.collision.broadphase.bvh.BvhTree,this.movedProxies=new Array(1024),this.numMovedProxies=0}collide(t,e){this._testCount++;let i=t._height==0,n=e._height==0;if(t==e){if(i)return;this.collide(t._children[0],e),this.collide(t._children[1],e);return}if(t._aabbMinX<e._aabbMaxX&&t._aabbMaxX>e._aabbMinX&&t._aabbMinY<e._aabbMaxY&&t._aabbMaxY>e._aabbMinY&&t._aabbMinZ<e._aabbMaxZ&&t._aabbMaxZ>e._aabbMinZ){if(i&&n){let s=this._proxyPairPool;s!=null?(this._proxyPairPool=s._next,s._next=null):s=new I.collision.broadphase.ProxyPair;let o=s;this._proxyPairList==null?this._proxyPairList=o:(o._next=this._proxyPairList,this._proxyPairList=o),o._p1=t._proxy,o._p2=e._proxy;return}n||t._height>e._height?(this.collide(t._children[0],e),this.collide(t._children[1],e)):(this.collide(e._children[0],t),this.collide(e._children[1],t))}}rayCastRecursive(t,e,i,n,s,o,r,_){let a=e,l=i,h=n,u=s,f=o,m=r,d=t._aabbMinX,p=t._aabbMinY,g=t._aabbMinZ,x=t._aabbMaxX,b=t._aabbMaxY,y=t._aabbMaxZ,z;if(d>(a>u?a:u)||x<(a<u?a:u)||p>(l>f?l:f)||b<(l<f?l:f)||g>(h>m?h:m)||y<(h<m?h:m))z=!1;else{let M=u-a,Y=f-l,X=m-h,w=M<0?-M:M,S=Y<0?-Y:Y,V=X<0?-X:X,F=(x-d)*.5,C=(b-p)*.5,A=(y-g)*.5,Z=a-(x+d)*.5,L=l-(b+p)*.5,E=h-(y+g)*.5,T,P,N=L*X-E*Y;if((N<0?-N:N)-(C*V+A*S)>0)P=!0;else{let R=E*M-Z*X;P=(R<0?-R:R)-(A*w+F*V)>0}if(P)T=!0;else{let R=Z*Y-L*M;T=(R<0?-R:R)-(F*S+C*w)>0}z=!T}if(!!z){if(t._height==0){_.process(t._proxy);return}this.rayCastRecursive(t._children[0],e,i,n,s,o,r,_),this.rayCastRecursive(t._children[1],e,i,n,s,o,r,_)}}convexCastRecursive(t,e,i,n,s){let o=this._aabb.min;o.x=t._aabbMinX,o.y=t._aabbMinY,o.z=t._aabbMinZ;let r=this._aabb.max;r.x=t._aabbMaxX,r.y=t._aabbMaxY,r.z=t._aabbMaxZ,this._convexSweep.init(e,i,n);let _=I.collision.narrowphase.detector.gjkepa.GjkEpa.instance;if(_.computeClosestPointsImpl(this._convexSweep,this._aabb,i,this.identity,null,!1)==0&&_.distance<=0){if(t._height==0){s.process(t._proxy);return}this.convexCastRecursive(t._children[0],e,i,n,s),this.convexCastRecursive(t._children[1],e,i,n,s)}}aabbTestRecursive(t,e,i){if(t._aabbMinX<e._maxX&&t._aabbMaxX>e._minX&&t._aabbMinY<e._maxY&&t._aabbMaxY>e._minY&&t._aabbMinZ<e._maxZ&&t._aabbMaxZ>e._minZ){if(t._height==0){i.process(t._proxy);return}this.aabbTestRecursive(t._children[0],e,i),this.aabbTestRecursive(t._children[1],e,i)}}createProxy(t,e){let i=new I.collision.broadphase.bvh.BvhProxy(t,this._idCount++);this._numProxies++,this._proxyList==null?(this._proxyList=i,this._proxyListLast=i):(this._proxyListLast._next=i,i._prev=this._proxyListLast,this._proxyListLast=i),i._aabbMinX=e._minX,i._aabbMinY=e._minY,i._aabbMinZ=e._minZ,i._aabbMaxX=e._maxX,i._aabbMaxY=e._maxY,i._aabbMaxZ=e._maxZ;let n=I.common.Setting.bvhProxyPadding;i._aabbMinX-=n,i._aabbMinY-=n,i._aabbMinZ-=n,i._aabbMaxX+=n,i._aabbMaxY+=n,i._aabbMaxZ+=n;let s=this._tree,o=s._nodePool;o!=null?(s._nodePool=o._next,o._next=null):o=new I.collision.broadphase.bvh.BvhNode;let r=o;if(r._proxy=i,i._leaf=r,r._aabbMinX=i._aabbMinX,r._aabbMinY=i._aabbMinY,r._aabbMinZ=i._aabbMinZ,r._aabbMaxX=i._aabbMaxX,r._aabbMaxY=i._aabbMaxY,r._aabbMaxZ=i._aabbMaxZ,s._numLeaves++,s.leafList==null?(s.leafList=r,s.leafListLast=r):(s.leafListLast._nextLeaf=r,r._prevLeaf=s.leafListLast,s.leafListLast=r),s._root==null)s._root=r;else{let _=s._root;for(;_._height>0;){let m=s._strategy._decideInsertion(_,r);if(m==-1)break;_=_._children[m]}let a=_._parent,l=s._nodePool;l!=null?(s._nodePool=l._next,l._next=null):l=new I.collision.broadphase.bvh.BvhNode;let h=l;if(a==null)s._root=h;else{let m=_._childIndex;a._children[m]=h,h._parent=a,h._childIndex=m}let u=_._childIndex;h._children[u]=_,_._parent=h,_._childIndex=u;let f=_._childIndex^1;for(h._children[f]=r,r._parent=h,r._childIndex=f;h!=null;){if(s._strategy._balancingEnabled&&h._height>=2){let x=h._parent,b=h._children[0],y=h._children[1],z=b._height-y._height,M=h._childIndex;if(z>1){let Y=b._children[0],X=b._children[1];if(Y._height>X._height){b._children[1]=h,h._parent=b,h._childIndex=1,h._children[0]=X,X._parent=h,X._childIndex=0;let w=b._children[0],S=b._children[1];b._aabbMinX=w._aabbMinX<S._aabbMinX?w._aabbMinX:S._aabbMinX,b._aabbMinY=w._aabbMinY<S._aabbMinY?w._aabbMinY:S._aabbMinY,b._aabbMinZ=w._aabbMinZ<S._aabbMinZ?w._aabbMinZ:S._aabbMinZ,b._aabbMaxX=w._aabbMaxX>S._aabbMaxX?w._aabbMaxX:S._aabbMaxX,b._aabbMaxY=w._aabbMaxY>S._aabbMaxY?w._aabbMaxY:S._aabbMaxY,b._aabbMaxZ=w._aabbMaxZ>S._aabbMaxZ?w._aabbMaxZ:S._aabbMaxZ;let V=b._children[0]._height,F=b._children[1]._height;b._height=(V>F?V:F)+1;let C=h._children[0],A=h._children[1];h._aabbMinX=C._aabbMinX<A._aabbMinX?C._aabbMinX:A._aabbMinX,h._aabbMinY=C._aabbMinY<A._aabbMinY?C._aabbMinY:A._aabbMinY,h._aabbMinZ=C._aabbMinZ<A._aabbMinZ?C._aabbMinZ:A._aabbMinZ,h._aabbMaxX=C._aabbMaxX>A._aabbMaxX?C._aabbMaxX:A._aabbMaxX,h._aabbMaxY=C._aabbMaxY>A._aabbMaxY?C._aabbMaxY:A._aabbMaxY,h._aabbMaxZ=C._aabbMaxZ>A._aabbMaxZ?C._aabbMaxZ:A._aabbMaxZ;let Z=h._children[0]._height,L=h._children[1]._height;h._height=(Z>L?Z:L)+1}else{b._children[0]=h,h._parent=b,h._childIndex=0,h._children[0]=Y,Y._parent=h,Y._childIndex=0;let w=b._children[0],S=b._children[1];b._aabbMinX=w._aabbMinX<S._aabbMinX?w._aabbMinX:S._aabbMinX,b._aabbMinY=w._aabbMinY<S._aabbMinY?w._aabbMinY:S._aabbMinY,b._aabbMinZ=w._aabbMinZ<S._aabbMinZ?w._aabbMinZ:S._aabbMinZ,b._aabbMaxX=w._aabbMaxX>S._aabbMaxX?w._aabbMaxX:S._aabbMaxX,b._aabbMaxY=w._aabbMaxY>S._aabbMaxY?w._aabbMaxY:S._aabbMaxY,b._aabbMaxZ=w._aabbMaxZ>S._aabbMaxZ?w._aabbMaxZ:S._aabbMaxZ;let V=b._children[0]._height,F=b._children[1]._height;b._height=(V>F?V:F)+1;let C=h._children[0],A=h._children[1];h._aabbMinX=C._aabbMinX<A._aabbMinX?C._aabbMinX:A._aabbMinX,h._aabbMinY=C._aabbMinY<A._aabbMinY?C._aabbMinY:A._aabbMinY,h._aabbMinZ=C._aabbMinZ<A._aabbMinZ?C._aabbMinZ:A._aabbMinZ,h._aabbMaxX=C._aabbMaxX>A._aabbMaxX?C._aabbMaxX:A._aabbMaxX,h._aabbMaxY=C._aabbMaxY>A._aabbMaxY?C._aabbMaxY:A._aabbMaxY,h._aabbMaxZ=C._aabbMaxZ>A._aabbMaxZ?C._aabbMaxZ:A._aabbMaxZ;let Z=h._children[0]._height,L=h._children[1]._height;h._height=(Z>L?Z:L)+1}x!=null?(x._children[M]=b,b._parent=x,b._childIndex=M):(s._root=b,b._parent=null),h=b}else if(z<-1){let Y=y._children[0],X=y._children[1];if(Y._height>X._height){y._children[1]=h,h._parent=y,h._childIndex=1,h._children[1]=X,X._parent=h,X._childIndex=1;let w=y._children[0],S=y._children[1];y._aabbMinX=w._aabbMinX<S._aabbMinX?w._aabbMinX:S._aabbMinX,y._aabbMinY=w._aabbMinY<S._aabbMinY?w._aabbMinY:S._aabbMinY,y._aabbMinZ=w._aabbMinZ<S._aabbMinZ?w._aabbMinZ:S._aabbMinZ,y._aabbMaxX=w._aabbMaxX>S._aabbMaxX?w._aabbMaxX:S._aabbMaxX,y._aabbMaxY=w._aabbMaxY>S._aabbMaxY?w._aabbMaxY:S._aabbMaxY,y._aabbMaxZ=w._aabbMaxZ>S._aabbMaxZ?w._aabbMaxZ:S._aabbMaxZ;let V=y._children[0]._height,F=y._children[1]._height;y._height=(V>F?V:F)+1;let C=h._children[0],A=h._children[1];h._aabbMinX=C._aabbMinX<A._aabbMinX?C._aabbMinX:A._aabbMinX,h._aabbMinY=C._aabbMinY<A._aabbMinY?C._aabbMinY:A._aabbMinY,h._aabbMinZ=C._aabbMinZ<A._aabbMinZ?C._aabbMinZ:A._aabbMinZ,h._aabbMaxX=C._aabbMaxX>A._aabbMaxX?C._aabbMaxX:A._aabbMaxX,h._aabbMaxY=C._aabbMaxY>A._aabbMaxY?C._aabbMaxY:A._aabbMaxY,h._aabbMaxZ=C._aabbMaxZ>A._aabbMaxZ?C._aabbMaxZ:A._aabbMaxZ;let Z=h._children[0]._height,L=h._children[1]._height;h._height=(Z>L?Z:L)+1}else{y._children[0]=h,h._parent=y,h._childIndex=0,h._children[1]=Y,Y._parent=h,Y._childIndex=1;let w=y._children[0],S=y._children[1];y._aabbMinX=w._aabbMinX<S._aabbMinX?w._aabbMinX:S._aabbMinX,y._aabbMinY=w._aabbMinY<S._aabbMinY?w._aabbMinY:S._aabbMinY,y._aabbMinZ=w._aabbMinZ<S._aabbMinZ?w._aabbMinZ:S._aabbMinZ,y._aabbMaxX=w._aabbMaxX>S._aabbMaxX?w._aabbMaxX:S._aabbMaxX,y._aabbMaxY=w._aabbMaxY>S._aabbMaxY?w._aabbMaxY:S._aabbMaxY,y._aabbMaxZ=w._aabbMaxZ>S._aabbMaxZ?w._aabbMaxZ:S._aabbMaxZ;let V=y._children[0]._height,F=y._children[1]._height;y._height=(V>F?V:F)+1;let C=h._children[0],A=h._children[1];h._aabbMinX=C._aabbMinX<A._aabbMinX?C._aabbMinX:A._aabbMinX,h._aabbMinY=C._aabbMinY<A._aabbMinY?C._aabbMinY:A._aabbMinY,h._aabbMinZ=C._aabbMinZ<A._aabbMinZ?C._aabbMinZ:A._aabbMinZ,h._aabbMaxX=C._aabbMaxX>A._aabbMaxX?C._aabbMaxX:A._aabbMaxX,h._aabbMaxY=C._aabbMaxY>A._aabbMaxY?C._aabbMaxY:A._aabbMaxY,h._aabbMaxZ=C._aabbMaxZ>A._aabbMaxZ?C._aabbMaxZ:A._aabbMaxZ;let Z=h._children[0]._height,L=h._children[1]._height;h._height=(Z>L?Z:L)+1}x!=null?(x._children[M]=y,y._parent=x,y._childIndex=M):(s._root=y,y._parent=null),h=y}}let m=h._children[0]._height,d=h._children[1]._height;h._height=(m>d?m:d)+1;let p=h._children[0],g=h._children[1];h._aabbMinX=p._aabbMinX<g._aabbMinX?p._aabbMinX:g._aabbMinX,h._aabbMinY=p._aabbMinY<g._aabbMinY?p._aabbMinY:g._aabbMinY,h._aabbMinZ=p._aabbMinZ<g._aabbMinZ?p._aabbMinZ:g._aabbMinZ,h._aabbMaxX=p._aabbMaxX>g._aabbMaxX?p._aabbMaxX:g._aabbMaxX,h._aabbMaxY=p._aabbMaxY>g._aabbMaxY?p._aabbMaxY:g._aabbMaxY,h._aabbMaxZ=p._aabbMaxZ>g._aabbMaxZ?p._aabbMaxZ:g._aabbMaxZ,h=h._parent}}if(!i._moved){if(i._moved=!0,this.movedProxies.length==this.numMovedProxies){let _=new Array(this.numMovedProxies<<1),a=0,l=this.numMovedProxies;for(;a<l;){let h=a++;_[h]=this.movedProxies[h],this.movedProxies[h]=null}this.movedProxies=_}this.movedProxies[this.numMovedProxies++]=i}return i}destroyProxy(t){this._numProxies--;let e=t._prev,i=t._next;e!=null&&(e._next=i),i!=null&&(i._prev=e),t==this._proxyList&&(this._proxyList=this._proxyList._next),t==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),t._next=null,t._prev=null;let n=t,s=this._tree,o=n._leaf;s._numLeaves--;let r=o._prevLeaf,_=o._nextLeaf;if(r!=null&&(r._nextLeaf=_),_!=null&&(_._prevLeaf=r),o==s.leafList&&(s.leafList=s.leafList._nextLeaf),o==s.leafListLast&&(s.leafListLast=s.leafListLast._prevLeaf),o._nextLeaf=null,o._prevLeaf=null,s._root==o)s._root=null;else{let a=o._parent,l=a._children[o._childIndex^1],h=a._parent;if(h==null)l._parent=null,l._childIndex=0,s._root=l,a._next=null,a._childIndex=0,a._children[0]=null,a._children[1]=null,a._childIndex=0,a._parent=null,a._height=0,a._proxy=null,a._next=s._nodePool,s._nodePool=a;else{l._parent=h;let u=a._childIndex;h._children[u]=l,l._parent=h,l._childIndex=u,a._next=null,a._childIndex=0,a._children[0]=null,a._children[1]=null,a._childIndex=0,a._parent=null,a._height=0,a._proxy=null,a._next=s._nodePool,s._nodePool=a;let f=h;for(;f!=null;){if(s._strategy._balancingEnabled&&f._height>=2){let x=f._parent,b=f._children[0],y=f._children[1],z=b._height-y._height,M=f._childIndex;if(z>1){let Y=b._children[0],X=b._children[1];if(Y._height>X._height){b._children[1]=f,f._parent=b,f._childIndex=1,f._children[0]=X,X._parent=f,X._childIndex=0;let w=b._children[0],S=b._children[1];b._aabbMinX=w._aabbMinX<S._aabbMinX?w._aabbMinX:S._aabbMinX,b._aabbMinY=w._aabbMinY<S._aabbMinY?w._aabbMinY:S._aabbMinY,b._aabbMinZ=w._aabbMinZ<S._aabbMinZ?w._aabbMinZ:S._aabbMinZ,b._aabbMaxX=w._aabbMaxX>S._aabbMaxX?w._aabbMaxX:S._aabbMaxX,b._aabbMaxY=w._aabbMaxY>S._aabbMaxY?w._aabbMaxY:S._aabbMaxY,b._aabbMaxZ=w._aabbMaxZ>S._aabbMaxZ?w._aabbMaxZ:S._aabbMaxZ;let V=b._children[0]._height,F=b._children[1]._height;b._height=(V>F?V:F)+1;let C=f._children[0],A=f._children[1];f._aabbMinX=C._aabbMinX<A._aabbMinX?C._aabbMinX:A._aabbMinX,f._aabbMinY=C._aabbMinY<A._aabbMinY?C._aabbMinY:A._aabbMinY,f._aabbMinZ=C._aabbMinZ<A._aabbMinZ?C._aabbMinZ:A._aabbMinZ,f._aabbMaxX=C._aabbMaxX>A._aabbMaxX?C._aabbMaxX:A._aabbMaxX,f._aabbMaxY=C._aabbMaxY>A._aabbMaxY?C._aabbMaxY:A._aabbMaxY,f._aabbMaxZ=C._aabbMaxZ>A._aabbMaxZ?C._aabbMaxZ:A._aabbMaxZ;let Z=f._children[0]._height,L=f._children[1]._height;f._height=(Z>L?Z:L)+1}else{b._children[0]=f,f._parent=b,f._childIndex=0,f._children[0]=Y,Y._parent=f,Y._childIndex=0;let w=b._children[0],S=b._children[1];b._aabbMinX=w._aabbMinX<S._aabbMinX?w._aabbMinX:S._aabbMinX,b._aabbMinY=w._aabbMinY<S._aabbMinY?w._aabbMinY:S._aabbMinY,b._aabbMinZ=w._aabbMinZ<S._aabbMinZ?w._aabbMinZ:S._aabbMinZ,b._aabbMaxX=w._aabbMaxX>S._aabbMaxX?w._aabbMaxX:S._aabbMaxX,b._aabbMaxY=w._aabbMaxY>S._aabbMaxY?w._aabbMaxY:S._aabbMaxY,b._aabbMaxZ=w._aabbMaxZ>S._aabbMaxZ?w._aabbMaxZ:S._aabbMaxZ;let V=b._children[0]._height,F=b._children[1]._height;b._height=(V>F?V:F)+1;let C=f._children[0],A=f._children[1];f._aabbMinX=C._aabbMinX<A._aabbMinX?C._aabbMinX:A._aabbMinX,f._aabbMinY=C._aabbMinY<A._aabbMinY?C._aabbMinY:A._aabbMinY,f._aabbMinZ=C._aabbMinZ<A._aabbMinZ?C._aabbMinZ:A._aabbMinZ,f._aabbMaxX=C._aabbMaxX>A._aabbMaxX?C._aabbMaxX:A._aabbMaxX,f._aabbMaxY=C._aabbMaxY>A._aabbMaxY?C._aabbMaxY:A._aabbMaxY,f._aabbMaxZ=C._aabbMaxZ>A._aabbMaxZ?C._aabbMaxZ:A._aabbMaxZ;let Z=f._children[0]._height,L=f._children[1]._height;f._height=(Z>L?Z:L)+1}x!=null?(x._children[M]=b,b._parent=x,b._childIndex=M):(s._root=b,b._parent=null),f=b}else if(z<-1){let Y=y._children[0],X=y._children[1];if(Y._height>X._height){y._children[1]=f,f._parent=y,f._childIndex=1,f._children[1]=X,X._parent=f,X._childIndex=1;let w=y._children[0],S=y._children[1];y._aabbMinX=w._aabbMinX<S._aabbMinX?w._aabbMinX:S._aabbMinX,y._aabbMinY=w._aabbMinY<S._aabbMinY?w._aabbMinY:S._aabbMinY,y._aabbMinZ=w._aabbMinZ<S._aabbMinZ?w._aabbMinZ:S._aabbMinZ,y._aabbMaxX=w._aabbMaxX>S._aabbMaxX?w._aabbMaxX:S._aabbMaxX,y._aabbMaxY=w._aabbMaxY>S._aabbMaxY?w._aabbMaxY:S._aabbMaxY,y._aabbMaxZ=w._aabbMaxZ>S._aabbMaxZ?w._aabbMaxZ:S._aabbMaxZ;let V=y._children[0]._height,F=y._children[1]._height;y._height=(V>F?V:F)+1;let C=f._children[0],A=f._children[1];f._aabbMinX=C._aabbMinX<A._aabbMinX?C._aabbMinX:A._aabbMinX,f._aabbMinY=C._aabbMinY<A._aabbMinY?C._aabbMinY:A._aabbMinY,f._aabbMinZ=C._aabbMinZ<A._aabbMinZ?C._aabbMinZ:A._aabbMinZ,f._aabbMaxX=C._aabbMaxX>A._aabbMaxX?C._aabbMaxX:A._aabbMaxX,f._aabbMaxY=C._aabbMaxY>A._aabbMaxY?C._aabbMaxY:A._aabbMaxY,f._aabbMaxZ=C._aabbMaxZ>A._aabbMaxZ?C._aabbMaxZ:A._aabbMaxZ;let Z=f._children[0]._height,L=f._children[1]._height;f._height=(Z>L?Z:L)+1}else{y._children[0]=f,f._parent=y,f._childIndex=0,f._children[1]=Y,Y._parent=f,Y._childIndex=1;let w=y._children[0],S=y._children[1];y._aabbMinX=w._aabbMinX<S._aabbMinX?w._aabbMinX:S._aabbMinX,y._aabbMinY=w._aabbMinY<S._aabbMinY?w._aabbMinY:S._aabbMinY,y._aabbMinZ=w._aabbMinZ<S._aabbMinZ?w._aabbMinZ:S._aabbMinZ,y._aabbMaxX=w._aabbMaxX>S._aabbMaxX?w._aabbMaxX:S._aabbMaxX,y._aabbMaxY=w._aabbMaxY>S._aabbMaxY?w._aabbMaxY:S._aabbMaxY,y._aabbMaxZ=w._aabbMaxZ>S._aabbMaxZ?w._aabbMaxZ:S._aabbMaxZ;let V=y._children[0]._height,F=y._children[1]._height;y._height=(V>F?V:F)+1;let C=f._children[0],A=f._children[1];f._aabbMinX=C._aabbMinX<A._aabbMinX?C._aabbMinX:A._aabbMinX,f._aabbMinY=C._aabbMinY<A._aabbMinY?C._aabbMinY:A._aabbMinY,f._aabbMinZ=C._aabbMinZ<A._aabbMinZ?C._aabbMinZ:A._aabbMinZ,f._aabbMaxX=C._aabbMaxX>A._aabbMaxX?C._aabbMaxX:A._aabbMaxX,f._aabbMaxY=C._aabbMaxY>A._aabbMaxY?C._aabbMaxY:A._aabbMaxY,f._aabbMaxZ=C._aabbMaxZ>A._aabbMaxZ?C._aabbMaxZ:A._aabbMaxZ;let Z=f._children[0]._height,L=f._children[1]._height;f._height=(Z>L?Z:L)+1}x!=null?(x._children[M]=y,y._parent=x,y._childIndex=M):(s._root=y,y._parent=null),f=y}}let m=f._children[0]._height,d=f._children[1]._height;f._height=(m>d?m:d)+1;let p=f._children[0],g=f._children[1];f._aabbMinX=p._aabbMinX<g._aabbMinX?p._aabbMinX:g._aabbMinX,f._aabbMinY=p._aabbMinY<g._aabbMinY?p._aabbMinY:g._aabbMinY,f._aabbMinZ=p._aabbMinZ<g._aabbMinZ?p._aabbMinZ:g._aabbMinZ,f._aabbMaxX=p._aabbMaxX>g._aabbMaxX?p._aabbMaxX:g._aabbMaxX,f._aabbMaxY=p._aabbMaxY>g._aabbMaxY?p._aabbMaxY:g._aabbMaxY,f._aabbMaxZ=p._aabbMaxZ>g._aabbMaxZ?p._aabbMaxZ:g._aabbMaxZ,f=f._parent}}}n._leaf=null,o._next=null,o._childIndex=0,o._children[0]=null,o._children[1]=null,o._childIndex=0,o._parent=null,o._height=0,o._proxy=null,o._next=s._nodePool,s._nodePool=o,n.userData=null,n._next=null,n._prev=null,n._moved&&(n._moved=!1)}moveProxy(t,e,i){let n=t;if(n._aabbMinX<=e._minX&&n._aabbMaxX>=e._maxX&&n._aabbMinY<=e._minY&&n._aabbMaxY>=e._maxY&&n._aabbMinZ<=e._minZ&&n._aabbMaxZ>=e._maxZ)return;n._aabbMinX=e._minX,n._aabbMinY=e._minY,n._aabbMinZ=e._minZ,n._aabbMaxX=e._maxX,n._aabbMaxY=e._maxY,n._aabbMaxZ=e._maxZ;let s=I.common.Setting.bvhProxyPadding;if(n._aabbMinX-=s,n._aabbMinY-=s,n._aabbMinZ-=s,n._aabbMaxX+=s,n._aabbMaxY+=s,n._aabbMaxZ+=s,i!=null){let o,r,_,a,l,h,u,f,m,d,p,g;a=0,l=0,h=0,o=i.x,r=i.y,_=i.z,u=a<o?a:o,f=l<r?l:r,m=h<_?h:_,d=a>o?a:o,p=l>r?l:r,g=h>_?h:_,n._aabbMinX+=u,n._aabbMinY+=f,n._aabbMinZ+=m,n._aabbMaxX+=d,n._aabbMaxY+=p,n._aabbMaxZ+=g}if(!n._moved){if(n._moved=!0,this.movedProxies.length==this.numMovedProxies){let o=new Array(this.numMovedProxies<<1),r=0,_=this.numMovedProxies;for(;r<_;){let a=r++;o[a]=this.movedProxies[a],this.movedProxies[a]=null}this.movedProxies=o}this.movedProxies[this.numMovedProxies++]=n}}collectPairs(){let t=this._proxyPairList;if(t!=null){for(;t._p1=null,t._p2=null,t=t._next,t!=null;);this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}if(this._testCount=0,this._numProxies<2)return;let e=this.numMovedProxies/this._numProxies<I.common.Setting.bvhIncrementalCollisionThreshold,i=0,n=this.numMovedProxies;for(;i<n;){let s=i++,o=this.movedProxies[s];if(o._moved){let r=this._tree,_=o._leaf;r._numLeaves--;let a=_._prevLeaf,l=_._nextLeaf;if(a!=null&&(a._nextLeaf=l),l!=null&&(l._prevLeaf=a),_==r.leafList&&(r.leafList=r.leafList._nextLeaf),_==r.leafListLast&&(r.leafListLast=r.leafListLast._prevLeaf),_._nextLeaf=null,_._prevLeaf=null,r._root==_)r._root=null;else{let m=_._parent,d=m._children[_._childIndex^1],p=m._parent;if(p==null)d._parent=null,d._childIndex=0,r._root=d,m._next=null,m._childIndex=0,m._children[0]=null,m._children[1]=null,m._childIndex=0,m._parent=null,m._height=0,m._proxy=null,m._next=r._nodePool,r._nodePool=m;else{d._parent=p;let g=m._childIndex;p._children[g]=d,d._parent=p,d._childIndex=g,m._next=null,m._childIndex=0,m._children[0]=null,m._children[1]=null,m._childIndex=0,m._parent=null,m._height=0,m._proxy=null,m._next=r._nodePool,r._nodePool=m;let x=p;for(;x!=null;){if(r._strategy._balancingEnabled&&x._height>=2){let Y=x._parent,X=x._children[0],w=x._children[1],S=X._height-w._height,V=x._childIndex;if(S>1){let F=X._children[0],C=X._children[1];if(F._height>C._height){X._children[1]=x,x._parent=X,x._childIndex=1,x._children[0]=C,C._parent=x,C._childIndex=0;let A=X._children[0],Z=X._children[1];X._aabbMinX=A._aabbMinX<Z._aabbMinX?A._aabbMinX:Z._aabbMinX,X._aabbMinY=A._aabbMinY<Z._aabbMinY?A._aabbMinY:Z._aabbMinY,X._aabbMinZ=A._aabbMinZ<Z._aabbMinZ?A._aabbMinZ:Z._aabbMinZ,X._aabbMaxX=A._aabbMaxX>Z._aabbMaxX?A._aabbMaxX:Z._aabbMaxX,X._aabbMaxY=A._aabbMaxY>Z._aabbMaxY?A._aabbMaxY:Z._aabbMaxY,X._aabbMaxZ=A._aabbMaxZ>Z._aabbMaxZ?A._aabbMaxZ:Z._aabbMaxZ;let L=X._children[0]._height,E=X._children[1]._height;X._height=(L>E?L:E)+1;let T=x._children[0],P=x._children[1];x._aabbMinX=T._aabbMinX<P._aabbMinX?T._aabbMinX:P._aabbMinX,x._aabbMinY=T._aabbMinY<P._aabbMinY?T._aabbMinY:P._aabbMinY,x._aabbMinZ=T._aabbMinZ<P._aabbMinZ?T._aabbMinZ:P._aabbMinZ,x._aabbMaxX=T._aabbMaxX>P._aabbMaxX?T._aabbMaxX:P._aabbMaxX,x._aabbMaxY=T._aabbMaxY>P._aabbMaxY?T._aabbMaxY:P._aabbMaxY,x._aabbMaxZ=T._aabbMaxZ>P._aabbMaxZ?T._aabbMaxZ:P._aabbMaxZ;let N=x._children[0]._height,R=x._children[1]._height;x._height=(N>R?N:R)+1}else{X._children[0]=x,x._parent=X,x._childIndex=0,x._children[0]=F,F._parent=x,F._childIndex=0;let A=X._children[0],Z=X._children[1];X._aabbMinX=A._aabbMinX<Z._aabbMinX?A._aabbMinX:Z._aabbMinX,X._aabbMinY=A._aabbMinY<Z._aabbMinY?A._aabbMinY:Z._aabbMinY,X._aabbMinZ=A._aabbMinZ<Z._aabbMinZ?A._aabbMinZ:Z._aabbMinZ,X._aabbMaxX=A._aabbMaxX>Z._aabbMaxX?A._aabbMaxX:Z._aabbMaxX,X._aabbMaxY=A._aabbMaxY>Z._aabbMaxY?A._aabbMaxY:Z._aabbMaxY,X._aabbMaxZ=A._aabbMaxZ>Z._aabbMaxZ?A._aabbMaxZ:Z._aabbMaxZ;let L=X._children[0]._height,E=X._children[1]._height;X._height=(L>E?L:E)+1;let T=x._children[0],P=x._children[1];x._aabbMinX=T._aabbMinX<P._aabbMinX?T._aabbMinX:P._aabbMinX,x._aabbMinY=T._aabbMinY<P._aabbMinY?T._aabbMinY:P._aabbMinY,x._aabbMinZ=T._aabbMinZ<P._aabbMinZ?T._aabbMinZ:P._aabbMinZ,x._aabbMaxX=T._aabbMaxX>P._aabbMaxX?T._aabbMaxX:P._aabbMaxX,x._aabbMaxY=T._aabbMaxY>P._aabbMaxY?T._aabbMaxY:P._aabbMaxY,x._aabbMaxZ=T._aabbMaxZ>P._aabbMaxZ?T._aabbMaxZ:P._aabbMaxZ;let N=x._children[0]._height,R=x._children[1]._height;x._height=(N>R?N:R)+1}Y!=null?(Y._children[V]=X,X._parent=Y,X._childIndex=V):(r._root=X,X._parent=null),x=X}else if(S<-1){let F=w._children[0],C=w._children[1];if(F._height>C._height){w._children[1]=x,x._parent=w,x._childIndex=1,x._children[1]=C,C._parent=x,C._childIndex=1;let A=w._children[0],Z=w._children[1];w._aabbMinX=A._aabbMinX<Z._aabbMinX?A._aabbMinX:Z._aabbMinX,w._aabbMinY=A._aabbMinY<Z._aabbMinY?A._aabbMinY:Z._aabbMinY,w._aabbMinZ=A._aabbMinZ<Z._aabbMinZ?A._aabbMinZ:Z._aabbMinZ,w._aabbMaxX=A._aabbMaxX>Z._aabbMaxX?A._aabbMaxX:Z._aabbMaxX,w._aabbMaxY=A._aabbMaxY>Z._aabbMaxY?A._aabbMaxY:Z._aabbMaxY,w._aabbMaxZ=A._aabbMaxZ>Z._aabbMaxZ?A._aabbMaxZ:Z._aabbMaxZ;let L=w._children[0]._height,E=w._children[1]._height;w._height=(L>E?L:E)+1;let T=x._children[0],P=x._children[1];x._aabbMinX=T._aabbMinX<P._aabbMinX?T._aabbMinX:P._aabbMinX,x._aabbMinY=T._aabbMinY<P._aabbMinY?T._aabbMinY:P._aabbMinY,x._aabbMinZ=T._aabbMinZ<P._aabbMinZ?T._aabbMinZ:P._aabbMinZ,x._aabbMaxX=T._aabbMaxX>P._aabbMaxX?T._aabbMaxX:P._aabbMaxX,x._aabbMaxY=T._aabbMaxY>P._aabbMaxY?T._aabbMaxY:P._aabbMaxY,x._aabbMaxZ=T._aabbMaxZ>P._aabbMaxZ?T._aabbMaxZ:P._aabbMaxZ;let N=x._children[0]._height,R=x._children[1]._height;x._height=(N>R?N:R)+1}else{w._children[0]=x,x._parent=w,x._childIndex=0,x._children[1]=F,F._parent=x,F._childIndex=1;let A=w._children[0],Z=w._children[1];w._aabbMinX=A._aabbMinX<Z._aabbMinX?A._aabbMinX:Z._aabbMinX,w._aabbMinY=A._aabbMinY<Z._aabbMinY?A._aabbMinY:Z._aabbMinY,w._aabbMinZ=A._aabbMinZ<Z._aabbMinZ?A._aabbMinZ:Z._aabbMinZ,w._aabbMaxX=A._aabbMaxX>Z._aabbMaxX?A._aabbMaxX:Z._aabbMaxX,w._aabbMaxY=A._aabbMaxY>Z._aabbMaxY?A._aabbMaxY:Z._aabbMaxY,w._aabbMaxZ=A._aabbMaxZ>Z._aabbMaxZ?A._aabbMaxZ:Z._aabbMaxZ;let L=w._children[0]._height,E=w._children[1]._height;w._height=(L>E?L:E)+1;let T=x._children[0],P=x._children[1];x._aabbMinX=T._aabbMinX<P._aabbMinX?T._aabbMinX:P._aabbMinX,x._aabbMinY=T._aabbMinY<P._aabbMinY?T._aabbMinY:P._aabbMinY,x._aabbMinZ=T._aabbMinZ<P._aabbMinZ?T._aabbMinZ:P._aabbMinZ,x._aabbMaxX=T._aabbMaxX>P._aabbMaxX?T._aabbMaxX:P._aabbMaxX,x._aabbMaxY=T._aabbMaxY>P._aabbMaxY?T._aabbMaxY:P._aabbMaxY,x._aabbMaxZ=T._aabbMaxZ>P._aabbMaxZ?T._aabbMaxZ:P._aabbMaxZ;let N=x._children[0]._height,R=x._children[1]._height;x._height=(N>R?N:R)+1}Y!=null?(Y._children[V]=w,w._parent=Y,w._childIndex=V):(r._root=w,w._parent=null),x=w}}let b=x._children[0]._height,y=x._children[1]._height;x._height=(b>y?b:y)+1;let z=x._children[0],M=x._children[1];x._aabbMinX=z._aabbMinX<M._aabbMinX?z._aabbMinX:M._aabbMinX,x._aabbMinY=z._aabbMinY<M._aabbMinY?z._aabbMinY:M._aabbMinY,x._aabbMinZ=z._aabbMinZ<M._aabbMinZ?z._aabbMinZ:M._aabbMinZ,x._aabbMaxX=z._aabbMaxX>M._aabbMaxX?z._aabbMaxX:M._aabbMaxX,x._aabbMaxY=z._aabbMaxY>M._aabbMaxY?z._aabbMaxY:M._aabbMaxY,x._aabbMaxZ=z._aabbMaxZ>M._aabbMaxZ?z._aabbMaxZ:M._aabbMaxZ,x=x._parent}}}o._leaf=null,_._next=null,_._childIndex=0,_._children[0]=null,_._children[1]=null,_._childIndex=0,_._parent=null,_._height=0,_._proxy=null,_._next=r._nodePool,r._nodePool=_;let h=this._tree,u=h._nodePool;u!=null?(h._nodePool=u._next,u._next=null):u=new I.collision.broadphase.bvh.BvhNode;let f=u;if(f._proxy=o,o._leaf=f,f._aabbMinX=o._aabbMinX,f._aabbMinY=o._aabbMinY,f._aabbMinZ=o._aabbMinZ,f._aabbMaxX=o._aabbMaxX,f._aabbMaxY=o._aabbMaxY,f._aabbMaxZ=o._aabbMaxZ,h._numLeaves++,h.leafList==null?(h.leafList=f,h.leafListLast=f):(h.leafListLast._nextLeaf=f,f._prevLeaf=h.leafListLast,h.leafListLast=f),h._root==null)h._root=f;else{let m=h._root;for(;m._height>0;){let y=h._strategy._decideInsertion(m,f);if(y==-1)break;m=m._children[y]}let d=m._parent,p=h._nodePool;p!=null?(h._nodePool=p._next,p._next=null):p=new I.collision.broadphase.bvh.BvhNode;let g=p;if(d==null)h._root=g;else{let y=m._childIndex;d._children[y]=g,g._parent=d,g._childIndex=y}let x=m._childIndex;g._children[x]=m,m._parent=g,m._childIndex=x;let b=m._childIndex^1;for(g._children[b]=f,f._parent=g,f._childIndex=b;g!=null;){if(h._strategy._balancingEnabled&&g._height>=2){let X=g._parent,w=g._children[0],S=g._children[1],V=w._height-S._height,F=g._childIndex;if(V>1){let C=w._children[0],A=w._children[1];if(C._height>A._height){w._children[1]=g,g._parent=w,g._childIndex=1,g._children[0]=A,A._parent=g,A._childIndex=0;let Z=w._children[0],L=w._children[1];w._aabbMinX=Z._aabbMinX<L._aabbMinX?Z._aabbMinX:L._aabbMinX,w._aabbMinY=Z._aabbMinY<L._aabbMinY?Z._aabbMinY:L._aabbMinY,w._aabbMinZ=Z._aabbMinZ<L._aabbMinZ?Z._aabbMinZ:L._aabbMinZ,w._aabbMaxX=Z._aabbMaxX>L._aabbMaxX?Z._aabbMaxX:L._aabbMaxX,w._aabbMaxY=Z._aabbMaxY>L._aabbMaxY?Z._aabbMaxY:L._aabbMaxY,w._aabbMaxZ=Z._aabbMaxZ>L._aabbMaxZ?Z._aabbMaxZ:L._aabbMaxZ;let E=w._children[0]._height,T=w._children[1]._height;w._height=(E>T?E:T)+1;let P=g._children[0],N=g._children[1];g._aabbMinX=P._aabbMinX<N._aabbMinX?P._aabbMinX:N._aabbMinX,g._aabbMinY=P._aabbMinY<N._aabbMinY?P._aabbMinY:N._aabbMinY,g._aabbMinZ=P._aabbMinZ<N._aabbMinZ?P._aabbMinZ:N._aabbMinZ,g._aabbMaxX=P._aabbMaxX>N._aabbMaxX?P._aabbMaxX:N._aabbMaxX,g._aabbMaxY=P._aabbMaxY>N._aabbMaxY?P._aabbMaxY:N._aabbMaxY,g._aabbMaxZ=P._aabbMaxZ>N._aabbMaxZ?P._aabbMaxZ:N._aabbMaxZ;let R=g._children[0]._height,k=g._children[1]._height;g._height=(R>k?R:k)+1}else{w._children[0]=g,g._parent=w,g._childIndex=0,g._children[0]=C,C._parent=g,C._childIndex=0;let Z=w._children[0],L=w._children[1];w._aabbMinX=Z._aabbMinX<L._aabbMinX?Z._aabbMinX:L._aabbMinX,w._aabbMinY=Z._aabbMinY<L._aabbMinY?Z._aabbMinY:L._aabbMinY,w._aabbMinZ=Z._aabbMinZ<L._aabbMinZ?Z._aabbMinZ:L._aabbMinZ,w._aabbMaxX=Z._aabbMaxX>L._aabbMaxX?Z._aabbMaxX:L._aabbMaxX,w._aabbMaxY=Z._aabbMaxY>L._aabbMaxY?Z._aabbMaxY:L._aabbMaxY,w._aabbMaxZ=Z._aabbMaxZ>L._aabbMaxZ?Z._aabbMaxZ:L._aabbMaxZ;let E=w._children[0]._height,T=w._children[1]._height;w._height=(E>T?E:T)+1;let P=g._children[0],N=g._children[1];g._aabbMinX=P._aabbMinX<N._aabbMinX?P._aabbMinX:N._aabbMinX,g._aabbMinY=P._aabbMinY<N._aabbMinY?P._aabbMinY:N._aabbMinY,g._aabbMinZ=P._aabbMinZ<N._aabbMinZ?P._aabbMinZ:N._aabbMinZ,g._aabbMaxX=P._aabbMaxX>N._aabbMaxX?P._aabbMaxX:N._aabbMaxX,g._aabbMaxY=P._aabbMaxY>N._aabbMaxY?P._aabbMaxY:N._aabbMaxY,g._aabbMaxZ=P._aabbMaxZ>N._aabbMaxZ?P._aabbMaxZ:N._aabbMaxZ;let R=g._children[0]._height,k=g._children[1]._height;g._height=(R>k?R:k)+1}X!=null?(X._children[F]=w,w._parent=X,w._childIndex=F):(h._root=w,w._parent=null),g=w}else if(V<-1){let C=S._children[0],A=S._children[1];if(C._height>A._height){S._children[1]=g,g._parent=S,g._childIndex=1,g._children[1]=A,A._parent=g,A._childIndex=1;let Z=S._children[0],L=S._children[1];S._aabbMinX=Z._aabbMinX<L._aabbMinX?Z._aabbMinX:L._aabbMinX,S._aabbMinY=Z._aabbMinY<L._aabbMinY?Z._aabbMinY:L._aabbMinY,S._aabbMinZ=Z._aabbMinZ<L._aabbMinZ?Z._aabbMinZ:L._aabbMinZ,S._aabbMaxX=Z._aabbMaxX>L._aabbMaxX?Z._aabbMaxX:L._aabbMaxX,S._aabbMaxY=Z._aabbMaxY>L._aabbMaxY?Z._aabbMaxY:L._aabbMaxY,S._aabbMaxZ=Z._aabbMaxZ>L._aabbMaxZ?Z._aabbMaxZ:L._aabbMaxZ;let E=S._children[0]._height,T=S._children[1]._height;S._height=(E>T?E:T)+1;let P=g._children[0],N=g._children[1];g._aabbMinX=P._aabbMinX<N._aabbMinX?P._aabbMinX:N._aabbMinX,g._aabbMinY=P._aabbMinY<N._aabbMinY?P._aabbMinY:N._aabbMinY,g._aabbMinZ=P._aabbMinZ<N._aabbMinZ?P._aabbMinZ:N._aabbMinZ,g._aabbMaxX=P._aabbMaxX>N._aabbMaxX?P._aabbMaxX:N._aabbMaxX,g._aabbMaxY=P._aabbMaxY>N._aabbMaxY?P._aabbMaxY:N._aabbMaxY,g._aabbMaxZ=P._aabbMaxZ>N._aabbMaxZ?P._aabbMaxZ:N._aabbMaxZ;let R=g._children[0]._height,k=g._children[1]._height;g._height=(R>k?R:k)+1}else{S._children[0]=g,g._parent=S,g._childIndex=0,g._children[1]=C,C._parent=g,C._childIndex=1;let Z=S._children[0],L=S._children[1];S._aabbMinX=Z._aabbMinX<L._aabbMinX?Z._aabbMinX:L._aabbMinX,S._aabbMinY=Z._aabbMinY<L._aabbMinY?Z._aabbMinY:L._aabbMinY,S._aabbMinZ=Z._aabbMinZ<L._aabbMinZ?Z._aabbMinZ:L._aabbMinZ,S._aabbMaxX=Z._aabbMaxX>L._aabbMaxX?Z._aabbMaxX:L._aabbMaxX,S._aabbMaxY=Z._aabbMaxY>L._aabbMaxY?Z._aabbMaxY:L._aabbMaxY,S._aabbMaxZ=Z._aabbMaxZ>L._aabbMaxZ?Z._aabbMaxZ:L._aabbMaxZ;let E=S._children[0]._height,T=S._children[1]._height;S._height=(E>T?E:T)+1;let P=g._children[0],N=g._children[1];g._aabbMinX=P._aabbMinX<N._aabbMinX?P._aabbMinX:N._aabbMinX,g._aabbMinY=P._aabbMinY<N._aabbMinY?P._aabbMinY:N._aabbMinY,g._aabbMinZ=P._aabbMinZ<N._aabbMinZ?P._aabbMinZ:N._aabbMinZ,g._aabbMaxX=P._aabbMaxX>N._aabbMaxX?P._aabbMaxX:N._aabbMaxX,g._aabbMaxY=P._aabbMaxY>N._aabbMaxY?P._aabbMaxY:N._aabbMaxY,g._aabbMaxZ=P._aabbMaxZ>N._aabbMaxZ?P._aabbMaxZ:N._aabbMaxZ;let R=g._children[0]._height,k=g._children[1]._height;g._height=(R>k?R:k)+1}X!=null?(X._children[F]=S,S._parent=X,S._childIndex=F):(h._root=S,S._parent=null),g=S}}let y=g._children[0]._height,z=g._children[1]._height;g._height=(y>z?y:z)+1;let M=g._children[0],Y=g._children[1];g._aabbMinX=M._aabbMinX<Y._aabbMinX?M._aabbMinX:Y._aabbMinX,g._aabbMinY=M._aabbMinY<Y._aabbMinY?M._aabbMinY:Y._aabbMinY,g._aabbMinZ=M._aabbMinZ<Y._aabbMinZ?M._aabbMinZ:Y._aabbMinZ,g._aabbMaxX=M._aabbMaxX>Y._aabbMaxX?M._aabbMaxX:Y._aabbMaxX,g._aabbMaxY=M._aabbMaxY>Y._aabbMaxY?M._aabbMaxY:Y._aabbMaxY,g._aabbMaxZ=M._aabbMaxZ>Y._aabbMaxZ?M._aabbMaxZ:Y._aabbMaxZ,g=g._parent}}e&&this.collide(this._tree._root,o._leaf),o._moved=!1}this.movedProxies[s]=null}e||this.collide(this._tree._root,this._tree._root),this.numMovedProxies=0}rayCast(t,e,i){if(this._tree._root==null)return;let n,s,o,r,_,a;n=t.x,s=t.y,o=t.z,r=e.x,_=e.y,a=e.z,this.rayCastRecursive(this._tree._root,n,s,o,r,_,a,i)}convexCast(t,e,i,n){this._tree._root!=null&&this.convexCastRecursive(this._tree._root,t,e,i,n)}aabbTest(t,e){this._tree._root!=null&&this.aabbTestRecursive(this._tree._root,t,e)}getTreeBalance(){return this._tree._getBalance()}};I.collision.broadphase.bvh.BvhInsertionStrategy=class{};I.collision.broadphase.bvh.BvhNode=class{constructor(){this._next=null,this._prevLeaf=null,this._nextLeaf=null,this._children=new Array(2),this._childIndex=0,this._parent=null,this._height=0,this._proxy=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}};I.collision.broadphase.bvh.BvhProxy=class extends I.collision.broadphase.Proxy{constructor(t,e){super(t,e),this._leaf=null,this._moved=!1}};I.collision.broadphase.bvh.BvhStrategy=class{constructor(){this._insertionStrategy=0,this._balancingEnabled=!1}_decideInsertion(t,e){switch(this._insertionStrategy){case 0:let i,n,s;i=e._aabbMinX+e._aabbMaxX,n=e._aabbMinY+e._aabbMaxY,s=e._aabbMinZ+e._aabbMaxZ;let o=t._children[0],r=t._children[1],_,a,l,h,u,f;return _=o._aabbMinX+o._aabbMaxX,a=o._aabbMinY+o._aabbMaxY,l=o._aabbMinZ+o._aabbMaxZ,h=r._aabbMinX+r._aabbMaxX,u=r._aabbMinY+r._aabbMaxY,f=r._aabbMinZ+r._aabbMaxZ,_-=i,a-=n,l-=s,h-=i,u-=n,f-=s,_*_+a*a+l*l<h*h+u*u+f*f?0:1;case 1:let m=t._children[0],d=t._children[1],p=t._aabbMaxY-t._aabbMinY,g=t._aabbMaxZ-t._aabbMinZ,x,b,y,z,M,Y;x=t._aabbMinX<e._aabbMinX?t._aabbMinX:e._aabbMinX,b=t._aabbMinY<e._aabbMinY?t._aabbMinY:e._aabbMinY,y=t._aabbMinZ<e._aabbMinZ?t._aabbMinZ:e._aabbMinZ,z=t._aabbMaxX>e._aabbMaxX?t._aabbMaxX:e._aabbMaxX,M=t._aabbMaxY>e._aabbMaxY?t._aabbMaxY:e._aabbMaxY,Y=t._aabbMaxZ>e._aabbMaxZ?t._aabbMaxZ:e._aabbMaxZ;let X=M-b,w=Y-y,S=((z-x)*(X+w)+X*w)*2,V=S*2,F=(S-((t._aabbMaxX-t._aabbMinX)*(p+g)+p*g)*2)*2,C;if(x=m._aabbMinX<e._aabbMinX?m._aabbMinX:e._aabbMinX,b=m._aabbMinY<e._aabbMinY?m._aabbMinY:e._aabbMinY,y=m._aabbMinZ<e._aabbMinZ?m._aabbMinZ:e._aabbMinZ,z=m._aabbMaxX>e._aabbMaxX?m._aabbMaxX:e._aabbMaxX,M=m._aabbMaxY>e._aabbMaxY?m._aabbMaxY:e._aabbMaxY,Y=m._aabbMaxZ>e._aabbMaxZ?m._aabbMaxZ:e._aabbMaxZ,m._height==0){let Z=M-b,L=Y-y;C=F+((z-x)*(Z+L)+Z*L)*2}else{let Z=M-b,L=Y-y,E=m._aabbMaxY-m._aabbMinY,T=m._aabbMaxZ-m._aabbMinZ;C=F+(((z-x)*(Z+L)+Z*L)*2-((m._aabbMaxX-m._aabbMinX)*(E+T)+E*T)*2)}let A;if(x=d._aabbMinX<e._aabbMinX?d._aabbMinX:e._aabbMinX,b=d._aabbMinY<e._aabbMinY?d._aabbMinY:e._aabbMinY,y=d._aabbMinZ<e._aabbMinZ?d._aabbMinZ:e._aabbMinZ,z=d._aabbMaxX>e._aabbMaxX?d._aabbMaxX:e._aabbMaxX,M=d._aabbMaxY>e._aabbMaxY?d._aabbMaxY:e._aabbMaxY,Y=d._aabbMaxZ>e._aabbMaxZ?d._aabbMaxZ:e._aabbMaxZ,d._height==0){let Z=M-b,L=Y-y;A=F+((z-x)*(Z+L)+Z*L)*2}else{let Z=M-b,L=Y-y,E=d._aabbMaxY-d._aabbMinY,T=d._aabbMaxZ-d._aabbMinZ;A=F+(((z-x)*(Z+L)+Z*L)*2-((d._aabbMaxX-d._aabbMinX)*(E+T)+E*T)*2)}return V<C?V<A?-1:1:C<A?0:1;default:return console.log("src/oimo/collision/broadphase/bvh/BvhStrategy.hx:37:","invalid BVH insertion strategy: "+this._insertionStrategy),-1}}_splitLeaves(t,e,i){let n=1/(i-e),s,o,r;s=0,o=0,r=0;let _=e;for(;_<i;){let x=t[_++];x._tmpX=x._aabbMaxX+x._aabbMinX,x._tmpY=x._aabbMaxY+x._aabbMinY,x._tmpZ=x._aabbMaxZ+x._aabbMinZ,s+=x._tmpX,o+=x._tmpY,r+=x._tmpZ}s*=n,o*=n,r*=n;let a,l,h;a=0,l=0,h=0;let u=e;for(;u<i;){let x=t[u++],b,y,z;b=x._tmpX-s,y=x._tmpY-o,z=x._tmpZ-r,b*=b,y*=y,z*=z,a+=b,l+=y,h+=z}let f=a,m=l,d=h,p=e,g=i-1;if(f>m)if(f>d){let x=s;for(;;){for(;!(t[p]._tmpX<=x);)++p;for(;!(t[g]._tmpX>=x);)--g;if(p>=g)break;let b=t[p];t[p]=t[g],t[g]=b,++p,--g}}else{let x=r;for(;;){for(;!(t[p]._tmpZ<=x);)++p;for(;!(t[g]._tmpZ>=x);)--g;if(p>=g)break;let b=t[p];t[p]=t[g],t[g]=b,++p,--g}}else if(m>d){let x=o;for(;;){for(;!(t[p]._tmpY<=x);)++p;for(;!(t[g]._tmpY>=x);)--g;if(p>=g)break;let b=t[p];t[p]=t[g],t[g]=b,++p,--g}}else{let x=r;for(;;){for(;!(t[p]._tmpZ<=x);)++p;for(;!(t[g]._tmpZ>=x);)--g;if(p>=g)break;let b=t[p];t[p]=t[g],t[g]=b,++p,--g}}return p}};I.collision.broadphase.bvh.BvhTree=class{constructor(){this._root=null,this._numLeaves=0,this._strategy=new I.collision.broadphase.bvh.BvhStrategy,this._nodePool=null,this.leafList=null,this.leafListLast=null,this.tmp=new Array(1024)}_print(t,e){if(e==null&&(e=""),t!=null)if(t._height==0)console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:39:",e+t._proxy._id);else{this._print(t._children[0],e+"  ");let i,n,s,o;n=t._aabbMaxX-t._aabbMinX,s=t._aabbMaxY-t._aabbMinY,o=t._aabbMaxZ-t._aabbMinZ;let r=s,_=o;if(n*(r+_)+r*_>0){let a,l,h;a=t._aabbMaxX-t._aabbMinX,l=t._aabbMaxY-t._aabbMinY,h=t._aabbMaxZ-t._aabbMinZ;let u=l,f=h;i=((a*(u+f)+u*f)*1e3+.5|0)/1e3}else{let a,l,h;a=t._aabbMaxX-t._aabbMinX,l=t._aabbMaxY-t._aabbMinY,h=t._aabbMaxZ-t._aabbMinZ;let u=l,f=h;i=((a*(u+f)+u*f)*1e3-.5|0)/1e3}console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:42:",e+"#"+t._height+", "+i),this._print(t._children[1],e+"  ")}}_getBalance(){return this.getBalanceRecursive(this._root)}deleteRecursive(t){if(t._height==0){let e=t._prevLeaf,i=t._nextLeaf;e!=null&&(e._nextLeaf=i),i!=null&&(i._prevLeaf=e),t==this.leafList&&(this.leafList=this.leafList._nextLeaf),t==this.leafListLast&&(this.leafListLast=this.leafListLast._prevLeaf),t._nextLeaf=null,t._prevLeaf=null,t._proxy._leaf=null,t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t;return}this.deleteRecursive(t._children[0]),this.deleteRecursive(t._children[1]),t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t}decomposeRecursive(t){if(t._height==0){t._childIndex=0,t._parent=null;return}this.decomposeRecursive(t._children[0]),this.decomposeRecursive(t._children[1]),t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t}buildTopDownRecursive(t,e,i){if(i-e==1){let f=t[e],m=f._proxy;return f._aabbMinX=m._aabbMinX,f._aabbMinY=m._aabbMinY,f._aabbMinZ=m._aabbMinZ,f._aabbMaxX=m._aabbMaxX,f._aabbMaxY=m._aabbMaxY,f._aabbMaxZ=m._aabbMaxZ,f}let n=this._strategy._splitLeaves(t,e,i),s=this.buildTopDownRecursive(t,e,n),o=this.buildTopDownRecursive(t,n,i),r=this._nodePool;r!=null?(this._nodePool=r._next,r._next=null):r=new I.collision.broadphase.bvh.BvhNode;let _=r;_._children[0]=s,s._parent=_,s._childIndex=0,_._children[1]=o,o._parent=_,o._childIndex=1;let a=_._children[0],l=_._children[1];_._aabbMinX=a._aabbMinX<l._aabbMinX?a._aabbMinX:l._aabbMinX,_._aabbMinY=a._aabbMinY<l._aabbMinY?a._aabbMinY:l._aabbMinY,_._aabbMinZ=a._aabbMinZ<l._aabbMinZ?a._aabbMinZ:l._aabbMinZ,_._aabbMaxX=a._aabbMaxX>l._aabbMaxX?a._aabbMaxX:l._aabbMaxX,_._aabbMaxY=a._aabbMaxY>l._aabbMaxY?a._aabbMaxY:l._aabbMaxY,_._aabbMaxZ=a._aabbMaxZ>l._aabbMaxZ?a._aabbMaxZ:l._aabbMaxZ;let h=_._children[0]._height,u=_._children[1]._height;return _._height=(h>u?h:u)+1,_}getBalanceRecursive(t){if(t==null||t._height==0)return 0;let e=t._children[0]._height-t._children[1]._height;return e<0&&(e=-e),e+this.getBalanceRecursive(t._children[0])+this.getBalanceRecursive(t._children[1])}};I.collision.geometry.Aabb=class{constructor(){this._minX=0,this._minY=0,this._minZ=0,this._maxX=0,this._maxY=0,this._maxZ=0}init(t,e){return this._minX=t.x,this._minY=t.y,this._minZ=t.z,this._maxX=e.x,this._maxY=e.y,this._maxZ=e.z,this}getMin(){let t=new I.common.Vec3;return t.x=this._minX,t.y=this._minY,t.z=this._minZ,t}getMinTo(t){t.x=this._minX,t.y=this._minY,t.z=this._minZ}setMin(t){return this._minX=t.x,this._minY=t.y,this._minZ=t.z,this}getMax(){let t=new I.common.Vec3;return t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ,t}getMaxTo(t){t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ}setMax(t){return this._maxX=t.x,this._maxY=t.y,this._maxZ=t.z,this}getCenter(){let t=new I.common.Vec3,e,i,n;return e=this._minX+this._maxX,i=this._minY+this._maxY,n=this._minZ+this._maxZ,e*=.5,i*=.5,n*=.5,t.x=e,t.y=i,t.z=n,t}getCenterTo(t){let e,i,n;e=this._minX+this._maxX,i=this._minY+this._maxY,n=this._minZ+this._maxZ,e*=.5,i*=.5,n*=.5,t.x=e,t.y=i,t.z=n}getExtents(){let t=new I.common.Vec3,e,i,n;return e=this._maxX-this._minX,i=this._maxY-this._minY,n=this._maxZ-this._minZ,e*=.5,i*=.5,n*=.5,t.x=e,t.y=i,t.z=n,t}getExtentsTo(t){let e,i,n;e=this._maxX-this._minX,i=this._maxY-this._minY,n=this._maxZ-this._minZ,e*=.5,i*=.5,n*=.5,t.x=e,t.y=i,t.z=n}combine(t){return this._minX=this._minX<t._minX?this._minX:t._minX,this._minY=this._minY<t._minY?this._minY:t._minY,this._minZ=this._minZ<t._minZ?this._minZ:t._minZ,this._maxX=this._maxX>t._maxX?this._maxX:t._maxX,this._maxY=this._maxY>t._maxY?this._maxY:t._maxY,this._maxZ=this._maxZ>t._maxZ?this._maxZ:t._maxZ,this}combined(t){let e=new I.collision.geometry.Aabb;return e._minX=this._minX<t._minX?this._minX:t._minX,e._minY=this._minY<t._minY?this._minY:t._minY,e._minZ=this._minZ<t._minZ?this._minZ:t._minZ,e._maxX=this._maxX>t._maxX?this._maxX:t._maxX,e._maxY=this._maxY>t._maxY?this._maxY:t._maxY,e._maxZ=this._maxZ>t._maxZ?this._maxZ:t._maxZ,e}overlap(t){return this._minX<t._maxX&&this._maxX>t._minX&&this._minY<t._maxY&&this._maxY>t._minY&&this._minZ<t._maxZ?this._maxZ>t._minZ:!1}getIntersection(t){let e=new I.collision.geometry.Aabb;return e._minX=this._minX>t._minX?this._minX:t._minX,e._minY=this._minY>t._minY?this._minY:t._minY,e._minZ=this._minZ>t._minZ?this._minZ:t._minZ,e._maxX=this._maxX<t._maxX?this._maxX:t._maxX,e._maxY=this._maxY<t._maxY?this._maxY:t._maxY,e._maxZ=this._maxZ<t._maxZ?this._maxZ:t._maxZ,e}getIntersectionTo(t,e){e._minX=this._minX>t._minX?this._minX:t._minX,e._minY=this._minY>t._minY?this._minY:t._minY,e._minZ=this._minZ>t._minZ?this._minZ:t._minZ,e._maxX=this._maxX<t._maxX?this._maxX:t._maxX,e._maxY=this._maxY<t._maxY?this._maxY:t._maxY,e._maxZ=this._maxZ<t._maxZ?this._maxZ:t._maxZ}copyFrom(t){return this._minX=t._minX,this._minY=t._minY,this._minZ=t._minZ,this._maxX=t._maxX,this._maxY=t._maxY,this._maxZ=t._maxZ,this}clone(){let t=new I.collision.geometry.Aabb;return t._minX=this._minX,t._minY=this._minY,t._minZ=this._minZ,t._maxX=this._maxX,t._maxY=this._maxY,t._maxZ=this._maxZ,t}};I.collision.geometry.BoxGeometry=class extends I.collision.geometry.ConvexGeometry{constructor(t){super(1),this._halfExtentsX=t.x,this._halfExtentsY=t.y,this._halfExtentsZ=t.z,this._halfAxisXX=t.x,this._halfAxisXY=0,this._halfAxisXZ=0,this._halfAxisYX=0,this._halfAxisYY=t.y,this._halfAxisYZ=0,this._halfAxisZX=0,this._halfAxisZY=0,this._halfAxisZZ=t.z,this._updateMass();let e=t.x<t.y?t.z<t.x?t.z:t.x:t.z<t.y?t.z:t.y;this._gjkMargin>e*.2&&(this._gjkMargin=e*.2)}getHalfExtents(){let t=new I.common.Vec3;return t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ,t}getHalfExtentsTo(t){t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ}_updateMass(){this._volume=8*(this._halfExtentsX*this._halfExtentsY*this._halfExtentsZ);let t,e,i;t=this._halfExtentsX*this._halfExtentsX,e=this._halfExtentsY*this._halfExtentsY,i=this._halfExtentsZ*this._halfExtentsZ,this._inertiaCoeff00=.3333333333333333*(e+i),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(i+t),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(t+e)}_computeAabb(t,e){let i,n,s,o,r,_,a,l,h,u,f,m;u=e._rotation00*this._halfAxisXX+e._rotation01*this._halfAxisXY+e._rotation02*this._halfAxisXZ,f=e._rotation10*this._halfAxisXX+e._rotation11*this._halfAxisXY+e._rotation12*this._halfAxisXZ,m=e._rotation20*this._halfAxisXX+e._rotation21*this._halfAxisXY+e._rotation22*this._halfAxisXZ,i=u,n=f,s=m;let d,p,g;d=e._rotation00*this._halfAxisYX+e._rotation01*this._halfAxisYY+e._rotation02*this._halfAxisYZ,p=e._rotation10*this._halfAxisYX+e._rotation11*this._halfAxisYY+e._rotation12*this._halfAxisYZ,g=e._rotation20*this._halfAxisYX+e._rotation21*this._halfAxisYY+e._rotation22*this._halfAxisYZ,o=d,r=p,_=g;let x,b,y;x=e._rotation00*this._halfAxisZX+e._rotation01*this._halfAxisZY+e._rotation02*this._halfAxisZZ,b=e._rotation10*this._halfAxisZX+e._rotation11*this._halfAxisZY+e._rotation12*this._halfAxisZZ,y=e._rotation20*this._halfAxisZX+e._rotation21*this._halfAxisZY+e._rotation22*this._halfAxisZZ,a=x,l=b,h=y,i<0&&(i=-i),n<0&&(n=-n),s<0&&(s=-s),o<0&&(o=-o),r<0&&(r=-r),_<0&&(_=-_),a<0&&(a=-a),l<0&&(l=-l),h<0&&(h=-h);let z,M,Y;z=i+o,M=n+r,Y=s+_,z+=a,M+=l,Y+=h,t._minX=e._positionX-z,t._minY=e._positionY-M,t._minZ=e._positionZ-Y,t._maxX=e._positionX+z,t._maxY=e._positionY+M,t._maxZ=e._positionZ+Y}computeLocalSupportingVertex(t,e){let i,n,s,o,r,_;i=this._gjkMargin,n=this._gjkMargin,s=this._gjkMargin,i<this._halfExtentsX||(i=this._halfExtentsX),n<this._halfExtentsY||(n=this._halfExtentsY),s<this._halfExtentsZ||(s=this._halfExtentsZ),o=this._halfExtentsX-i,r=this._halfExtentsY-n,_=this._halfExtentsZ-s,e.x=t.x>0?o:-o,e.y=t.y>0?r:-r,e.z=t.z>0?_:-_}_rayCastLocal(t,e,i,n,s,o,r){let _=this._halfExtentsX,a=this._halfExtentsY,l=this._halfExtentsZ,h=n-t,u=s-e,f=o-i,m=0,d=0,p=0,g=1,x=1,b=1;if(h>-1e-6&&h<1e-6){if(t<=-_||t>=_)return!1}else{let Y=1/h,X=(-_-t)*Y,w=(_-t)*Y;if(X>w){let S=X;X=w,w=S}X>0&&(m=X),w<1&&(g=w)}if(u>-1e-6&&u<1e-6){if(e<=-a||e>=a)return!1}else{let Y=1/u,X=(-a-e)*Y,w=(a-e)*Y;if(X>w){let S=X;X=w,w=S}X>0&&(d=X),w<1&&(x=w)}if(f>-1e-6&&f<1e-6){if(i<=-l||i>=l)return!1}else{let Y=1/f,X=(-l-i)*Y,w=(l-i)*Y;if(X>w){let S=X;X=w,w=S}X>0&&(p=X),w<1&&(b=w)}if(m>=1||d>=1||p>=1||g<=0||x<=0||b<=0)return!1;let y=m,z=g,M=0;if(d>y&&(y=d,M=1),p>y&&(y=p,M=2),x<z&&(z=x),b<z&&(z=b),y>z||y==0)return!1;switch(M){case 0:r.normal.init(h>0?-1:1,0,0);break;case 1:r.normal.init(0,u>0?-1:1,0);break;case 2:r.normal.init(0,0,f>0?-1:1);break}return r.position.init(t+y*h,e+y*u,i+y*f),r.fraction=y,!0}};I.collision.geometry.CapsuleGeometry=class extends I.collision.geometry.ConvexGeometry{constructor(t,e){super(4),this._radius=t,this._halfHeight=e,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){let t=this._radius*this._radius,e=this._halfHeight*this._halfHeight,i=6.28318530717958*t*this._halfHeight,n=3.14159265358979*t*this._radius*4/3;this._volume=i+n;let s=this._volume==0?0:1/this._volume,o=s*(i*(t*.25+e/3)+n*(t*.4+this._halfHeight*this._radius*.75+e));this._inertiaCoeff00=o,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=s*(i*t*.5+n*t*.4),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=o}_computeAabb(t,e){let i,n,s;i=this._radius,n=this._radius,s=this._radius;let o,r,_;o=e._rotation01,r=e._rotation11,_=e._rotation21,o<0&&(o=-o),r<0&&(r=-r),_<0&&(_=-_),o*=this._halfHeight,r*=this._halfHeight,_*=this._halfHeight,i+=o,n+=r,s+=_,t._minX=e._positionX-i,t._minY=e._positionY-n,t._minZ=e._positionZ-s,t._maxX=e._positionX+i,t._maxY=e._positionY+n,t._maxZ=e._positionZ+s}computeLocalSupportingVertex(t,e){t.y>0?e.init(0,this._halfHeight,0):e.init(0,-this._halfHeight,0)}_rayCastLocal(t,e,i,n,s,o,r){let _=this._halfHeight,a=n-t,l=o-i,h=0,u,f=a*a+l*l,m=t*a+i*l,d=t*t+i*i-this._radius*this._radius,p=m*m-f*d;if(p<0)return!1;if(f>0){let k=Math.sqrt(p);if(h=(-m-k)/f,u=(-m+k)/f,h>=1||u<=0)return!1}else{if(d>=0)return!1;h=0}let g=e+(s-e)*h,x;if(g>-_&&g<_){if(h>0){x=h;let k=r.normal.init(t+a*x,0,i+l*x),O=Math.sqrt(k.x*k.x+k.y*k.y+k.z*k.z);return O>0&&(O=1/O),k.x*=O,k.y*=O,k.z*=O,r.position.init(t+x*a,g,i+x*l),r.fraction=x,!0}return!1}let b,y,z,M,Y,X;b=0,y=g<0?-_:_,z=0,M=t-b,Y=e-y,X=i-z;let w,S,V;if(w=n-t,S=s-e,V=o-i,f=w*w+S*S+V*V,m=M*w+Y*S+X*V,d=M*M+Y*Y+X*X-this._radius*this._radius,p=m*m-f*d,p<0)return!1;let F=(-m-Math.sqrt(p))/f;if(F<0||F>1)return!1;let C,A,Z,L,E,T;C=M+w*F,A=Y+S*F,Z=X+V*F;let P=C*C+A*A+Z*Z;P>0&&(P=1/Math.sqrt(P)),L=C*P,E=A*P,T=Z*P,C+=b,A+=y,Z+=z;let N=r.position;N.x=C,N.y=A,N.z=Z;let R=r.normal;return R.x=L,R.y=E,R.z=T,r.fraction=F,!0}};I.collision.geometry.ConeGeometry=class extends I.collision.geometry.ConvexGeometry{constructor(t,e){super(3),this._radius=t,this._halfHeight=e,this.sinTheta=t/Math.sqrt(t*t+4*e*e),this.cosTheta=2*e/Math.sqrt(t*t+4*e*e),this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){let t=this._radius*this._radius,e=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2/3,this._inertiaCoeff00=.05*(3*t+2*e),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3*t,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.05*(3*t+2*e)}_computeAabb(t,e){let i,n,s,o,r,_,a,l,h,u,f,m;i=e._rotation01,n=e._rotation11,s=e._rotation21,o=i*i,r=n*n,_=s*s,u=Math.sqrt(1-o),f=Math.sqrt(1-r),m=Math.sqrt(1-_),u*=this._radius,f*=this._radius,m*=this._radius,a=i*this._halfHeight,l=n*this._halfHeight,h=s*this._halfHeight;let d,p,g,x,b,y;d=-a,p=-l,g=-h,d-=u,p-=f,g-=m,x=-a,b=-l,y=-h,x+=u,b+=f,y+=m;let z,M,Y,X,w,S;z=d>x?d:x,M=p>b?p:b,Y=g>y?g:y,z>a||(z=a),M>l||(M=l),Y>h||(Y=h),X=d<x?d:x,w=p<b?p:b,S=g<y?g:y,X<a||(X=a),w<l||(w=l),S<h||(S=h),t._minX=e._positionX+X,t._minY=e._positionY+w,t._minZ=e._positionZ+S,t._maxX=e._positionX+z,t._maxY=e._positionY+M,t._maxZ=e._positionZ+Y}computeLocalSupportingVertex(t,e){let i=t.x,n=t.y,s=t.z;if(n>0&&n*n>this.sinTheta*this.sinTheta*(i*i+n*n+s*s)){e.init(0,this._halfHeight-this._gjkMargin/this.sinTheta,0),e.y<0&&(e.y=0);return}let o=t.x,r=t.z,_=o*o+r*r,a=2*this._halfHeight,l=(a-this._gjkMargin)/a*this._radius-this._gjkMargin/this.cosTheta;l<0&&(l=0);let h=_>0?l/Math.sqrt(_):0,u=this._halfHeight-this._gjkMargin;u<0&&(u=0),e.x=o*h,e.y=-u,e.z=r*h}_rayCastLocal(t,e,i,n,s,o,r){let _,a=this._halfHeight,l=n-t,h=s-e,u=o-i,f=0,m=1;if(h>-1e-6&&h<1e-6){if(e<=-a||e>=a)return!1}else{let Y=1/h,X=(-a-e)*Y,w=(a-e)*Y;if(X>w){let S=X;X=w,w=S}X>0&&(f=X),w<1&&(m=w)}if(f>=1||m<=0)return!1;let d=0,p=0;_=e-a;let g=this.cosTheta*this.cosTheta,x=g*(l*l+h*h+u*u)-h*h,b=g*(t*l+_*h+i*u)-_*h,y=g*(t*t+_*_+i*i)-_*_,z=b*b-x*y;if(x!=0){if(z<0)return!1;let Y=Math.sqrt(z);if(x<0){if(h>0){if(d=0,p=(-b+Y)/x,p<=0)return!1}else if(d=(-b-Y)/x,p=1,d>=1)return!1}else if(d=(-b-Y)/x,p=(-b+Y)/x,d>=1||p<=0)return!1}else{let Y=-y/(2*b);if(b>0){if(d=0,p=Y,Y<=0)return!1}else if(d=Y,p=1,Y>=1)return!1}_+=a;let M;if(p<=f||m<=d)return!1;if(d<f){if(M=f,M==0)return!1;r.normal.init(0,h>0?-1:1,0)}else{if(M=d,M==0)return!1;let Y=r.normal.init(t+l*M,0,i+u*M),X=Math.sqrt(Y.x*Y.x+Y.y*Y.y+Y.z*Y.z);X>0&&(X=1/X),Y.x*=X,Y.y*=X,Y.z*=X;let w=this.cosTheta;Y.x*=w,Y.y*=w,Y.z*=w,r.normal.y+=this.sinTheta}return r.position.init(t+M*l,_+M*h,i+M*u),r.fraction=M,!0}};I.collision.geometry.ConvexHullGeometry=class extends I.collision.geometry.ConvexGeometry{constructor(t){super(5),this._numVertices=t.length,this._vertices=new Array(this._numVertices),this._tmpVertices=new Array(this._numVertices);let e=0,i=this._numVertices;for(;e<i;){let n=e++;this._vertices[n]=t[n],this._tmpVertices[n]=new I.common.Vec3}this._useGjkRayCast=!0,this._updateMass()}getVertices(){return this._vertices}_updateMass(){this._volume=1,this._inertiaCoeff00=1,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=1,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=1;let t=this._vertices[0].x,e=this._vertices[0].y,i=this._vertices[0].z,n=this._vertices[0].x,s=this._vertices[0].y,o=this._vertices[0].z,r=1,_=this._numVertices;for(;r<_;){let f=r++,m=this._vertices[f].x,d=this._vertices[f].y,p=this._vertices[f].z;m<t?t=m:m>n&&(n=m),d<e?e=d:d>s&&(s=d),p<i?i=p:p>o&&(o=p)}let a=n-t,l=s-e,h=o-i;this._volume=a*l*h;let u=((t+n)*(t+n)+(e+s)*(e+s)+(i+o)*(i+o))*.25;a=a*a*.25,l=l*l*.25,h=h*h*.25,this._inertiaCoeff00=.3333333333333333*(l+h)+u,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(h+a)+u,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(a+l)+u}_computeAabb(t,e){let i,n,s,o,r,_,a,l,h;a=this._gjkMargin,l=this._gjkMargin,h=this._gjkMargin;let u,f,m,d=this._vertices[0];u=d.x,f=d.y,m=d.z;let p,g,x,b,y,z;b=e._rotation00*u+e._rotation01*f+e._rotation02*m,y=e._rotation10*u+e._rotation11*f+e._rotation12*m,z=e._rotation20*u+e._rotation21*f+e._rotation22*m,p=b,g=y,x=z,p+=e._positionX,g+=e._positionY,x+=e._positionZ,i=p,n=g,s=x,o=p,r=g,_=x;let M=1,Y=this._numVertices;for(;M<Y;){let X=this._vertices[M++];u=X.x,f=X.y,m=X.z;let w,S,V;w=e._rotation00*u+e._rotation01*f+e._rotation02*m,S=e._rotation10*u+e._rotation11*f+e._rotation12*m,V=e._rotation20*u+e._rotation21*f+e._rotation22*m,p=w,g=S,x=V,p+=e._positionX,g+=e._positionY,x+=e._positionZ,i<p||(i=p),n<g||(n=g),s<x||(s=x),o>p||(o=p),r>g||(r=g),_>x||(_=x)}t._minX=i-a,t._minY=n-l,t._minZ=s-h,t._maxX=o+a,t._maxY=r+l,t._maxZ=_+h}computeLocalSupportingVertex(t,e){let i=this._vertices[0],n=i.x*t.x+i.y*t.y+i.z*t.z,s=0,o=1,r=this._numVertices;for(;o<r;){let a=o++,l=this._vertices[a],h=l.x*t.x+l.y*t.y+l.z*t.z;h>n&&(n=h,s=a)}let _=this._vertices[s];e.x=_.x,e.y=_.y,e.z=_.z}};I.collision.geometry.CylinderGeometry=class extends I.collision.geometry.ConvexGeometry{constructor(t,e){super(2),this._radius=t,this._halfHeight=e,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){let t=this._radius*this._radius,e=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2,this._inertiaCoeff00=.08333333333333333*(3*t+e),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.5*t,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.08333333333333333*(3*t+e)}_computeAabb(t,e){let i,n,s,o,r,_,a,l,h,u,f,m;i=e._rotation01,n=e._rotation11,s=e._rotation21,i<0&&(i=-i),n<0&&(n=-n),s<0&&(s=-s),o=i*i,r=n*n,_=s*s,u=Math.sqrt(1-o),f=Math.sqrt(1-r),m=Math.sqrt(1-_),u*=this._radius,f*=this._radius,m*=this._radius,a=i*this._halfHeight,l=n*this._halfHeight,h=s*this._halfHeight;let d,p,g;d=u+a,p=f+l,g=m+h,t._minX=e._positionX-d,t._minY=e._positionY-p,t._minZ=e._positionZ-g,t._maxX=e._positionX+d,t._maxY=e._positionY+p,t._maxZ=e._positionZ+g}computeLocalSupportingVertex(t,e){let i=t.x,n=t.z,s=i*i+n*n,o=this._radius-this._gjkMargin;o<0&&(o=0);let r=s>0?o/Math.sqrt(s):0,_=this._halfHeight-this._gjkMargin;_<0&&(_=0),e.x=i*r,e.y=t.y>0?_:-_,e.z=n*r}_rayCastLocal(t,e,i,n,s,o,r){let _=this._halfHeight,a=n-t,l=s-e,h=o-i,u=0,f=1;if(l>-1e-6&&l<1e-6){if(e<=-_||e>=_)return!1}else{let z=1/l,M=(-_-e)*z,Y=(_-e)*z;if(M>Y){let X=M;M=Y,Y=X}M>0&&(u=M),Y<1&&(f=Y)}if(u>=1||f<=0)return!1;let m=0,d,p=a*a+h*h,g=t*a+i*h,x=t*t+i*i-this._radius*this._radius,b=g*g-p*x;if(b<0)return!1;if(p>0){let z=Math.sqrt(b);if(m=(-g-z)/p,d=(-g+z)/p,m>=1||d<=0)return!1}else{if(x>=0)return!1;m=0,d=1}let y;if(d<=u||f<=m)return!1;if(m<u){if(y=u,y==0)return!1;r.normal.init(0,l>0?-1:1,0)}else{if(y=m,y==0)return!1;let z=r.normal.init(t+a*y,0,i+h*y),M=Math.sqrt(z.x*z.x+z.y*z.y+z.z*z.z);M>0&&(M=1/M),z.x*=M,z.y*=M,z.z*=M}return r.position.init(t+y*a,e+y*l,i+y*h),r.fraction=y,!0}};I.collision.geometry.GeometryType=class{};I.collision.geometry.RayCastHit=class{constructor(){this.position=new I.common.Vec3,this.normal=new I.common.Vec3,this.fraction=0}};I.collision.geometry.SphereGeometry=class extends I.collision.geometry.ConvexGeometry{constructor(t){super(0),this._radius=t,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}_updateMass(){this._volume=4.188790204786386*this._radius*this._radius*this._radius,this._inertiaCoeff00=.4*this._radius*this._radius,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.4*this._radius*this._radius,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.4*this._radius*this._radius}_computeAabb(t,e){let i,n,s;i=this._radius,n=this._radius,s=this._radius,t._minX=e._positionX-i,t._minY=e._positionY-n,t._minZ=e._positionZ-s,t._maxX=e._positionX+i,t._maxY=e._positionY+n,t._maxZ=e._positionZ+s}computeLocalSupportingVertex(t,e){e.zero()}_rayCastLocal(t,e,i,n,s,o,r){let _,a,l;_=n-t,a=s-e,l=o-i;let h=_*_+a*a+l*l,u=t*_+e*a+i*l,f=u*u-h*(t*t+e*e+i*i-this._radius*this._radius);if(f<0)return!1;let m=(-u-Math.sqrt(f))/h;if(m<0||m>1)return!1;let d,p,g,x,b,y;d=t+_*m,p=e+a*m,g=i+l*m;let z=d*d+p*p+g*g;z>0&&(z=1/Math.sqrt(z)),x=d*z,b=p*z,y=g*z;let M=r.position;M.x=d,M.y=p,M.z=g;let Y=r.normal;return Y.x=x,Y.y=b,Y.z=y,r.fraction=m,!0}};I.collision.narrowphase||(I.collision.narrowphase={});I.collision.narrowphase.CollisionMatrix=class{constructor(){this.detectors=new Array(8),this.detectors[0]=new Array(8),this.detectors[1]=new Array(8),this.detectors[2]=new Array(8),this.detectors[3]=new Array(8),this.detectors[4]=new Array(8),this.detectors[5]=new Array(8);let t=new I.collision.narrowphase.detector.GjkEpaDetector;this.detectors[0][0]=new I.collision.narrowphase.detector.SphereSphereDetector,this.detectors[0][1]=new I.collision.narrowphase.detector.SphereBoxDetector(!1),this.detectors[0][2]=t,this.detectors[0][3]=t,this.detectors[0][4]=new I.collision.narrowphase.detector.SphereCapsuleDetector(!1),this.detectors[0][5]=t,this.detectors[1][0]=new I.collision.narrowphase.detector.SphereBoxDetector(!0),this.detectors[1][1]=new I.collision.narrowphase.detector.BoxBoxDetector,this.detectors[1][2]=t,this.detectors[1][3]=t,this.detectors[1][4]=t,this.detectors[1][5]=t,this.detectors[2][0]=t,this.detectors[2][1]=t,this.detectors[2][2]=t,this.detectors[2][3]=t,this.detectors[2][4]=t,this.detectors[2][5]=t,this.detectors[3][0]=t,this.detectors[3][1]=t,this.detectors[3][2]=t,this.detectors[3][3]=t,this.detectors[3][4]=t,this.detectors[3][5]=t,this.detectors[4][0]=new I.collision.narrowphase.detector.SphereCapsuleDetector(!0),this.detectors[4][1]=t,this.detectors[4][2]=t,this.detectors[4][3]=t,this.detectors[4][4]=new I.collision.narrowphase.detector.CapsuleCapsuleDetector,this.detectors[4][5]=t,this.detectors[5][0]=t,this.detectors[5][1]=t,this.detectors[5][2]=t,this.detectors[5][3]=t,this.detectors[5][4]=t,this.detectors[5][5]=t}getDetector(t,e){return this.detectors[t][e]}};I.collision.narrowphase.DetectorResult=class{constructor(){this.numPoints=0,this.normal=new I.common.Vec3,this.points=new Array(I.common.Setting.maxManifoldPoints),this.incremental=!1;let t=0,e=I.common.Setting.maxManifoldPoints;for(;t<e;)this.points[t++]=new I.collision.narrowphase.DetectorResultPoint}getMaxDepth(){let t=0,e=0,i=this.numPoints;for(;e<i;){let n=e++;this.points[n].depth>t&&(t=this.points[n].depth)}return t}clear(){this.numPoints=0;let t=0,e=this.points;for(;t<e.length;){let i=e[t];++t,i.position1.zero(),i.position2.zero(),i.depth=0,i.id=0}this.normal.zero()}};I.collision.narrowphase.DetectorResultPoint=class{constructor(){this.position1=new I.common.Vec3,this.position2=new I.common.Vec3,this.depth=0,this.id=0}};I.collision.narrowphase.detector||(I.collision.narrowphase.detector={});I.collision.narrowphase.detector.Detector=class{constructor(t){this.swapped=t}setNormal(t,e,i,n){let s=t.normal;if(s.x=e,s.y=i,s.z=n,this.swapped){let o=t.normal;o.x=-o.x,o.y=-o.y,o.z=-o.z}}addPoint(t,e,i,n,s,o,r,_,a){let l=t.points[t.numPoints++];if(l.depth=_,l.id=a,this.swapped){let h=l.position1;h.x=s,h.y=o,h.z=r;let u=l.position2;u.x=e,u.y=i,u.z=n}else{let h=l.position1;h.x=e,h.y=i,h.z=n;let u=l.position2;u.x=s,u.y=o,u.z=r}}detectImpl(t,e,i,n,s,o){}detect(t,e,i,n,s,o){t.numPoints=0;let r=0,_=t.points;for(;r<_.length;){let a=_[r];++r,a.position1.zero(),a.position2.zero(),a.depth=0,a.id=0}t.normal.zero(),this.swapped?this.detectImpl(t,i,e,s,n,o):this.detectImpl(t,e,i,n,s,o)}};I.collision.narrowphase.detector.BoxBoxDetector=class extends I.collision.narrowphase.detector.Detector{constructor(){super(!1),this.clipper=new I.collision.narrowphase.detector._BoxBoxDetector.FaceClipper}detectImpl(t,e,i,n,s,o){let r=e,_=i;t.incremental=!1;let a,l,h,u,f,m,d,p,g;a=n._positionX,l=n._positionY,h=n._positionZ,u=s._positionX,f=s._positionY,m=s._positionZ,d=u-a,p=f-l,g=m-h;let x,b,y,z,M,Y,X,w,S,V,F,C,A,Z,L,E,T,P;x=n._rotation00,b=n._rotation10,y=n._rotation20,z=n._rotation01,M=n._rotation11,Y=n._rotation21,X=n._rotation02,w=n._rotation12,S=n._rotation22,V=s._rotation00,F=s._rotation10,C=s._rotation20,A=s._rotation01,Z=s._rotation11,L=s._rotation21,E=s._rotation02,T=s._rotation12,P=s._rotation22;let N=r._halfExtentsX,R=r._halfExtentsY,k=r._halfExtentsZ,O=_._halfExtentsX,v=_._halfExtentsY,D=_._halfExtentsZ,B,U,q,tt,Q,nt,H,j,it,et,G,W,lt,ht,ft,pt,K,J;B=x*N,U=b*N,q=y*N,tt=z*R,Q=M*R,nt=Y*R,H=X*k,j=w*k,it=S*k,et=V*O,G=F*O,W=C*O,lt=A*v,ht=Z*v,ft=L*v,pt=E*D,K=T*D,J=P*D;let rt=1/0,mt=-1,xt=0,vt,Mt,ut;vt=0,Mt=0,ut=0;let Zt=N,zt=x*et+b*G+y*W,dt=x*lt+b*ht+y*ft,st=x*pt+b*K+y*J;zt<0&&(zt=-zt),dt<0&&(dt=-dt),st<0&&(st=-st);let ct=zt+dt+st,_t=x*d+b*p+y*g,Vt=Zt+ct,At=_t<0,St=At?-_t:_t;if(St<Vt){let Jt=Vt-St;Jt<1/0&&(rt=Jt,mt=0,vt=x,Mt=b,ut=y,xt=At?-1:1)}else return;Zt=R;let Xt=z*et+M*G+Y*W,Ft=z*lt+M*ht+Y*ft,ie=z*pt+M*K+Y*J;Xt<0&&(Xt=-Xt),Ft<0&&(Ft=-Ft),ie<0&&(ie=-ie),ct=Xt+Ft+ie,_t=z*d+M*p+Y*g;let ee=Zt+ct,Ye=_t<0,Ie=Ye?-_t:_t;if(Ie<ee){let Jt=ee-Ie;Jt<rt&&(rt=Jt,mt=1,vt=z,Mt=M,ut=Y,xt=Ye?-1:1)}else return;Zt=k;let ue=X*et+w*G+S*W,$t=X*lt+w*ht+S*ft,Ht=X*pt+w*K+S*J;ue<0&&(ue=-ue),$t<0&&($t=-$t),Ht<0&&(Ht=-Ht),ct=ue+$t+Ht,_t=X*d+w*p+S*g;let me=Zt+ct,ze=_t<0,qe=ze?-_t:_t;if(qe<me){let Jt=me-qe;Jt<rt&&(rt=Jt,mt=2,vt=X,Mt=w,ut=S,xt=ze?-1:1)}else return;rt>I.common.Setting.linearSlop?rt-=I.common.Setting.linearSlop:rt=0;let Ee=V*B+F*U+C*q,Ut=V*tt+F*Q+C*nt,at=V*H+F*j+C*it;Ee<0&&(Ee=-Ee),Ut<0&&(Ut=-Ut),at<0&&(at=-at),Zt=Ee+Ut+at,ct=O,_t=V*d+F*p+C*g;let gt=Zt+ct,yt=_t<0,bt=yt?-_t:_t;if(bt<gt){let Jt=gt-bt;Jt<rt&&(rt=Jt,mt=3,vt=V,Mt=F,ut=C,xt=yt?-1:1)}else return;let ot=A*B+Z*U+L*q,Pt=A*tt+Z*Q+L*nt,Dt=A*H+Z*j+L*it;ot<0&&(ot=-ot),Pt<0&&(Pt=-Pt),Dt<0&&(Dt=-Dt),Zt=ot+Pt+Dt,ct=v,_t=A*d+Z*p+L*g;let $=Zt+ct,kt=_t<0,Rt=kt?-_t:_t;if(Rt<$){let Jt=$-Rt;Jt<rt&&(rt=Jt,mt=4,vt=A,Mt=Z,ut=L,xt=kt?-1:1)}else return;let Ot=E*B+T*U+P*q,Wt=E*tt+T*Q+P*nt,Bt=E*H+T*j+P*it;Ot<0&&(Ot=-Ot),Wt<0&&(Wt=-Wt),Bt<0&&(Bt=-Bt),Zt=Ot+Wt+Bt,ct=D,_t=E*d+T*p+P*g;let re=Zt+ct,Ce=_t<0,be=Ce?-_t:_t;if(be<re){let Jt=re-be;Jt<rt&&(rt=Jt,mt=5,vt=E,Mt=T,ut=P,xt=Ce?-1:1)}else return;rt>I.common.Setting.linearSlop?rt-=I.common.Setting.linearSlop:rt=0;let Tt,Lt,Yt;if(Tt=b*C-y*F,Lt=y*V-x*C,Yt=x*F-b*V,!(Tt==0&&Lt==0&&Yt==0)){let Jt=Tt*Tt+Lt*Lt+Yt*Yt;Jt>0&&(Jt=1/Math.sqrt(Jt)),Tt*=Jt,Lt*=Jt,Yt*=Jt;let xe=Tt*tt+Lt*Q+Yt*nt,Kt=Tt*H+Lt*j+Yt*it;xe<0&&(xe=-xe),Kt<0&&(Kt=-Kt),Zt=xe+Kt;let It=Tt*lt+Lt*ht+Yt*ft,Et=Tt*pt+Lt*K+Yt*J;It<0&&(It=-It),Et<0&&(Et=-Et),ct=It+Et,_t=Tt*d+Lt*p+Yt*g;let Qt=Zt+ct,te=_t<0,ne=te?-_t:_t;if(ne<Qt){let _e=Qt-ne;_e<rt&&(rt=_e,mt=6,vt=Tt,Mt=Lt,ut=Yt,xt=te?-1:1)}else return}if(Tt=b*L-y*Z,Lt=y*A-x*L,Yt=x*Z-b*A,!(Tt==0&&Lt==0&&Yt==0)){let Jt=Tt*Tt+Lt*Lt+Yt*Yt;Jt>0&&(Jt=1/Math.sqrt(Jt)),Tt*=Jt,Lt*=Jt,Yt*=Jt;let xe=Tt*tt+Lt*Q+Yt*nt,Kt=Tt*H+Lt*j+Yt*it;xe<0&&(xe=-xe),Kt<0&&(Kt=-Kt),Zt=xe+Kt;let It=Tt*et+Lt*G+Yt*W,Et=Tt*pt+Lt*K+Yt*J;It<0&&(It=-It),Et<0&&(Et=-Et),ct=It+Et,_t=Tt*d+Lt*p+Yt*g;let Qt=Zt+ct,te=_t<0,ne=te?-_t:_t;if(ne<Qt){let _e=Qt-ne;_e<rt&&(rt=_e,mt=7,vt=Tt,Mt=Lt,ut=Yt,xt=te?-1:1)}else return}if(Tt=b*P-y*T,Lt=y*E-x*P,Yt=x*T-b*E,!(Tt==0&&Lt==0&&Yt==0)){let Jt=Tt*Tt+Lt*Lt+Yt*Yt;Jt>0&&(Jt=1/Math.sqrt(Jt)),Tt*=Jt,Lt*=Jt,Yt*=Jt;let xe=Tt*tt+Lt*Q+Yt*nt,Kt=Tt*H+Lt*j+Yt*it;xe<0&&(xe=-xe),Kt<0&&(Kt=-Kt),Zt=xe+Kt;let It=Tt*et+Lt*G+Yt*W,Et=Tt*lt+Lt*ht+Yt*ft;It<0&&(It=-It),Et<0&&(Et=-Et),ct=It+Et,_t=Tt*d+Lt*p+Yt*g;let Qt=Zt+ct,te=_t<0,ne=te?-_t:_t;if(ne<Qt){let _e=Qt-ne;_e<rt&&(rt=_e,mt=8,vt=Tt,Mt=Lt,ut=Yt,xt=te?-1:1)}else return}if(Tt=M*C-Y*F,Lt=Y*V-z*C,Yt=z*F-M*V,!(Tt==0&&Lt==0&&Yt==0)){let Jt=Tt*Tt+Lt*Lt+Yt*Yt;Jt>0&&(Jt=1/Math.sqrt(Jt)),Tt*=Jt,Lt*=Jt,Yt*=Jt;let xe=Tt*B+Lt*U+Yt*q,Kt=Tt*H+Lt*j+Yt*it;xe<0&&(xe=-xe),Kt<0&&(Kt=-Kt),Zt=xe+Kt;let It=Tt*lt+Lt*ht+Yt*ft,Et=Tt*pt+Lt*K+Yt*J;It<0&&(It=-It),Et<0&&(Et=-Et),ct=It+Et,_t=Tt*d+Lt*p+Yt*g;let Qt=Zt+ct,te=_t<0,ne=te?-_t:_t;if(ne<Qt){let _e=Qt-ne;_e<rt&&(rt=_e,mt=9,vt=Tt,Mt=Lt,ut=Yt,xt=te?-1:1)}else return}if(Tt=M*L-Y*Z,Lt=Y*A-z*L,Yt=z*Z-M*A,!(Tt==0&&Lt==0&&Yt==0)){let Jt=Tt*Tt+Lt*Lt+Yt*Yt;Jt>0&&(Jt=1/Math.sqrt(Jt)),Tt*=Jt,Lt*=Jt,Yt*=Jt;let xe=Tt*B+Lt*U+Yt*q,Kt=Tt*H+Lt*j+Yt*it;xe<0&&(xe=-xe),Kt<0&&(Kt=-Kt),Zt=xe+Kt;let It=Tt*et+Lt*G+Yt*W,Et=Tt*pt+Lt*K+Yt*J;It<0&&(It=-It),Et<0&&(Et=-Et),ct=It+Et,_t=Tt*d+Lt*p+Yt*g;let Qt=Zt+ct,te=_t<0,ne=te?-_t:_t;if(ne<Qt){let _e=Qt-ne;_e<rt&&(rt=_e,mt=10,vt=Tt,Mt=Lt,ut=Yt,xt=te?-1:1)}else return}if(Tt=M*P-Y*T,Lt=Y*E-z*P,Yt=z*T-M*E,!(Tt==0&&Lt==0&&Yt==0)){let Jt=Tt*Tt+Lt*Lt+Yt*Yt;Jt>0&&(Jt=1/Math.sqrt(Jt)),Tt*=Jt,Lt*=Jt,Yt*=Jt;let xe=Tt*B+Lt*U+Yt*q,Kt=Tt*H+Lt*j+Yt*it;xe<0&&(xe=-xe),Kt<0&&(Kt=-Kt),Zt=xe+Kt;let It=Tt*et+Lt*G+Yt*W,Et=Tt*lt+Lt*ht+Yt*ft;It<0&&(It=-It),Et<0&&(Et=-Et),ct=It+Et,_t=Tt*d+Lt*p+Yt*g;let Qt=Zt+ct,te=_t<0,ne=te?-_t:_t;if(ne<Qt){let _e=Qt-ne;_e<rt&&(rt=_e,mt=11,vt=Tt,Mt=Lt,ut=Yt,xt=te?-1:1)}else return}if(Tt=w*C-S*F,Lt=S*V-X*C,Yt=X*F-w*V,!(Tt==0&&Lt==0&&Yt==0)){let Jt=Tt*Tt+Lt*Lt+Yt*Yt;Jt>0&&(Jt=1/Math.sqrt(Jt)),Tt*=Jt,Lt*=Jt,Yt*=Jt;let xe=Tt*B+Lt*U+Yt*q,Kt=Tt*tt+Lt*Q+Yt*nt;xe<0&&(xe=-xe),Kt<0&&(Kt=-Kt),Zt=xe+Kt;let It=Tt*lt+Lt*ht+Yt*ft,Et=Tt*pt+Lt*K+Yt*J;It<0&&(It=-It),Et<0&&(Et=-Et),ct=It+Et,_t=Tt*d+Lt*p+Yt*g;let Qt=Zt+ct,te=_t<0,ne=te?-_t:_t;if(ne<Qt){let _e=Qt-ne;_e<rt&&(rt=_e,mt=12,vt=Tt,Mt=Lt,ut=Yt,xt=te?-1:1)}else return}if(Tt=w*L-S*Z,Lt=S*A-X*L,Yt=X*Z-w*A,!(Tt==0&&Lt==0&&Yt==0)){let Jt=Tt*Tt+Lt*Lt+Yt*Yt;Jt>0&&(Jt=1/Math.sqrt(Jt)),Tt*=Jt,Lt*=Jt,Yt*=Jt;let xe=Tt*B+Lt*U+Yt*q,Kt=Tt*tt+Lt*Q+Yt*nt;xe<0&&(xe=-xe),Kt<0&&(Kt=-Kt),Zt=xe+Kt;let It=Tt*et+Lt*G+Yt*W,Et=Tt*pt+Lt*K+Yt*J;It<0&&(It=-It),Et<0&&(Et=-Et),ct=It+Et,_t=Tt*d+Lt*p+Yt*g;let Qt=Zt+ct,te=_t<0,ne=te?-_t:_t;if(ne<Qt){let _e=Qt-ne;_e<rt&&(rt=_e,mt=13,vt=Tt,Mt=Lt,ut=Yt,xt=te?-1:1)}else return}if(Tt=w*P-S*T,Lt=S*E-X*P,Yt=X*T-w*E,!(Tt==0&&Lt==0&&Yt==0)){let Jt=Tt*Tt+Lt*Lt+Yt*Yt;Jt>0&&(Jt=1/Math.sqrt(Jt)),Tt*=Jt,Lt*=Jt,Yt*=Jt;let xe=Tt*B+Lt*U+Yt*q,Kt=Tt*tt+Lt*Q+Yt*nt;xe<0&&(xe=-xe),Kt<0&&(Kt=-Kt),Zt=xe+Kt;let It=Tt*et+Lt*G+Yt*W,Et=Tt*lt+Lt*ht+Yt*ft;It<0&&(It=-It),Et<0&&(Et=-Et),ct=It+Et,_t=Tt*d+Lt*p+Yt*g;let Qt=Zt+ct,te=_t<0,ne=te?-_t:_t;if(ne<Qt){let _e=Qt-ne;_e<rt&&(rt=_e,mt=14,vt=Tt,Mt=Lt,ut=Yt,xt=te?-1:1)}else return}if(mt>=6){vt*=xt,Mt*=xt,ut*=xt;let Jt=(mt-6)/3|0,xe=mt-6-Jt*3,Kt,It,Et,Qt,te,ne,_e,de,Se,ye,oe,Nt;switch(Jt){case 0:_e=x,de=b,Se=y;let fa=H*vt+j*Mt+it*ut>0;tt*vt+Q*Mt+nt*ut>0?fa?(Kt=tt+H,It=Q+j,Et=nt+it):(Kt=tt-H,It=Q-j,Et=nt-it):fa?(Kt=H-tt,It=j-Q,Et=it-nt):(Kt=tt+H,It=Q+j,Et=nt+it,Kt=-Kt,It=-It,Et=-Et);break;case 1:_e=z,de=M,Se=Y;let da=H*vt+j*Mt+it*ut>0;B*vt+U*Mt+q*ut>0?da?(Kt=B+H,It=U+j,Et=q+it):(Kt=B-H,It=U-j,Et=q-it):da?(Kt=H-B,It=j-U,Et=it-q):(Kt=B+H,It=U+j,Et=q+it,Kt=-Kt,It=-It,Et=-Et);break;default:_e=X,de=w,Se=S;let ga=tt*vt+Q*Mt+nt*ut>0;B*vt+U*Mt+q*ut>0?ga?(Kt=B+tt,It=U+Q,Et=q+nt):(Kt=B-tt,It=U-Q,Et=q-nt):ga?(Kt=tt-B,It=Q-U,Et=nt-q):(Kt=B+tt,It=U+Q,Et=q+nt,Kt=-Kt,It=-It,Et=-Et)}switch(Kt=a+Kt,It=l+It,Et=h+Et,xe){case 0:ye=V,oe=F,Nt=C;let fa=pt*vt+K*Mt+J*ut>0;lt*vt+ht*Mt+ft*ut>0?fa?(Qt=lt+pt,te=ht+K,ne=ft+J):(Qt=lt-pt,te=ht-K,ne=ft-J):fa?(Qt=pt-lt,te=K-ht,ne=J-ft):(Qt=lt+pt,te=ht+K,ne=ft+J,Qt=-Qt,te=-te,ne=-ne);break;case 1:ye=A,oe=Z,Nt=L;let da=pt*vt+K*Mt+J*ut>0;et*vt+G*Mt+W*ut>0?da?(Qt=et+pt,te=G+K,ne=W+J):(Qt=et-pt,te=G-K,ne=W-J):da?(Qt=pt-et,te=K-G,ne=J-W):(Qt=et+pt,te=G+K,ne=W+J,Qt=-Qt,te=-te,ne=-ne);break;default:ye=E,oe=T,Nt=P;let ga=lt*vt+ht*Mt+ft*ut>0;et*vt+G*Mt+W*ut>0?ga?(Qt=et+lt,te=G+ht,ne=W+ft):(Qt=et-lt,te=G-ht,ne=W-ft):ga?(Qt=lt-et,te=ht-G,ne=ft-W):(Qt=et+lt,te=G+ht,ne=W+ft,Qt=-Qt,te=-te,ne=-ne)}Qt=u-Qt,te=f-te,ne=m-ne;let ae,Xe,Oe;ae=Kt-Qt,Xe=It-te,Oe=Et-ne;let oi=_e*ye+de*oe+Se*Nt,ui=_e*ae+de*Xe+Se*Oe,$e=ye*ae+oe*Xe+Nt*Oe,si=1/(1-oi*oi),je=(oi*$e-ui)*si,De=($e-oi*ui)*si,pi,wi,Xi,Yi,Di,$l;pi=Kt+_e*je,wi=It+de*je,Xi=Et+Se*je,Yi=Qt+ye*De,Di=te+oe*De,$l=ne+Nt*De;let Kl,Ql,t_;Kl=-vt,Ql=-Mt,t_=-ut,this.setNormal(t,Kl,Ql,t_),this.addPoint(t,pi,wi,Xi,Yi,Di,$l,rt,4);return}let pe,Me,fe,ti;mt>=3?(xt=-xt,d=-d,p=-p,g=-g,N=O,R=v,k=D,a=u,l=f,h=m,pe=x,Me=b,fe=y,x=V,b=F,y=C,V=pe,F=Me,C=fe,pe=z,Me=M,fe=Y,z=A,M=Z,Y=L,A=pe,Z=Me,L=fe,pe=X,Me=w,fe=S,X=E,w=T,S=P,E=pe,T=Me,P=fe,pe=B,Me=U,fe=q,B=et,U=G,q=W,et=pe,G=Me,W=fe,pe=tt,Me=Q,fe=nt,tt=lt,Q=ht,nt=ft,lt=pe,ht=Me,ft=fe,pe=H,Me=j,fe=it,H=pt,j=K,it=J,pt=pe,K=Me,J=fe,mt-=3,ti=!0):ti=!1;let di,Le,_i,yi,he,gi,bi,Mi,Si,He,Je,Qe,ci,hi;switch(mt){case 0:di=B,Le=U,_i=q,yi=x,he=b,gi=y,bi=z,Mi=M,Si=Y,He=X,Je=w,Qe=S,ci=R,hi=k;break;case 1:di=tt,Le=Q,_i=nt,yi=z,he=M,gi=Y,bi=X,Mi=w,Si=S,He=x,Je=b,Qe=y,ci=k,hi=N;break;default:di=H,Le=j,_i=it,yi=X,he=w,gi=S,bi=x,Mi=b,Si=y,He=z,Je=M,Qe=Y,ci=N,hi=R}if(xt<0){di=-di,Le=-Le,_i=-_i,yi=-yi,he=-he,gi=-gi,pe=bi,Me=Mi,fe=Si,bi=He,Mi=Je,Si=Qe,He=pe,Je=Me,Qe=fe;let Jt=ci;ci=hi,hi=Jt}di+=a,Le+=l,_i+=h;let ei=1,ai=0,Ke=yi*V+he*F+gi*C;Ke<ei&&(ei=Ke,ai=0),-Ke<ei&&(ei=-Ke,ai=1),Ke=yi*A+he*Z+gi*L,Ke<ei&&(ei=Ke,ai=2),-Ke<ei&&(ei=-Ke,ai=3),Ke=yi*E+he*T+gi*P,Ke<ei&&(ei=Ke,ai=4),-Ke<ei&&(ai=5);let We,ke,le,ge,jt,Ae,Ze,Re,Te,Fe,se,Ct;switch(ai){case 0:We=et+lt,ke=G+ht,le=W+ft,We+=pt,ke+=K,le+=J,ge=et-lt,jt=G-ht,Ae=W-ft,ge+=pt,jt+=K,Ae+=J,Ze=et-lt,Re=G-ht,Te=W-ft,Ze-=pt,Re-=K,Te-=J,Fe=et+lt,se=G+ht,Ct=W+ft,Fe-=pt,se-=K,Ct-=J;break;case 1:We=lt-et,ke=ht-G,le=ft-W,We+=pt,ke+=K,le+=J,ge=lt-et,jt=ht-G,Ae=ft-W,ge-=pt,jt-=K,Ae-=J,Ze=et+lt,Re=G+ht,Te=W+ft,Ze=-Ze,Re=-Re,Te=-Te,Ze-=pt,Re-=K,Te-=J,Fe=et+lt,se=G+ht,Ct=W+ft,Fe=-Fe,se=-se,Ct=-Ct,Fe+=pt,se+=K,Ct+=J;break;case 2:We=et+lt,ke=G+ht,le=W+ft,We+=pt,ke+=K,le+=J,ge=et+lt,jt=G+ht,Ae=W+ft,ge-=pt,jt-=K,Ae-=J,Ze=lt-et,Re=ht-G,Te=ft-W,Ze-=pt,Re-=K,Te-=J,Fe=lt-et,se=ht-G,Ct=ft-W,Fe+=pt,se+=K,Ct+=J;break;case 3:We=et-lt,ke=G-ht,le=W-ft,We+=pt,ke+=K,le+=J,ge=et+lt,jt=G+ht,Ae=W+ft,ge=-ge,jt=-jt,Ae=-Ae,ge+=pt,jt+=K,Ae+=J,Ze=et+lt,Re=G+ht,Te=W+ft,Ze=-Ze,Re=-Re,Te=-Te,Ze-=pt,Re-=K,Te-=J,Fe=et-lt,se=G-ht,Ct=W-ft,Fe-=pt,se-=K,Ct-=J;break;case 4:We=et+lt,ke=G+ht,le=W+ft,We+=pt,ke+=K,le+=J,ge=lt-et,jt=ht-G,Ae=ft-W,ge+=pt,jt+=K,Ae+=J,Ze=et+lt,Re=G+ht,Te=W+ft,Ze=-Ze,Re=-Re,Te=-Te,Ze+=pt,Re+=K,Te+=J,Fe=et-lt,se=G-ht,Ct=W-ft,Fe+=pt,se+=K,Ct+=J;break;default:We=et+lt,ke=G+ht,le=W+ft,We-=pt,ke-=K,le-=J,ge=et-lt,jt=G-ht,Ae=W-ft,ge-=pt,jt-=K,Ae-=J,Ze=et+lt,Re=G+ht,Te=W+ft,Ze=-Ze,Re=-Re,Te=-Te,Ze-=pt,Re-=K,Te-=J,Fe=lt-et,se=ht-G,Ct=ft-W,Fe-=pt,se-=K,Ct-=J}We+=d,ke+=p,le+=g,ge+=d,jt+=p,Ae+=g,Ze+=d,Re+=p,Te+=g,Fe+=d,se+=p,Ct+=g;let Gt=this.clipper;Gt.w=ci,Gt.h=hi,Gt.numVertices=0,Gt.numTmpVertices=0;let Pe=this.clipper,Ve=Pe.vertices[Pe.numVertices++];Ve.x=We*bi+ke*Mi+le*Si,Ve.y=We*He+ke*Je+le*Qe,Ve.wx=We,Ve.wy=ke,Ve.wz=le;let Ue=this.clipper,ii=Ue.vertices[Ue.numVertices++];ii.x=ge*bi+jt*Mi+Ae*Si,ii.y=ge*He+jt*Je+Ae*Qe,ii.wx=ge,ii.wy=jt,ii.wz=Ae;let ri=this.clipper,mi=ri.vertices[ri.numVertices++];mi.x=Ze*bi+Re*Mi+Te*Si,mi.y=Ze*He+Re*Je+Te*Qe,mi.wx=Ze,mi.wy=Re,mi.wz=Te;let xi=this.clipper,ce=xi.vertices[xi.numVertices++];ce.x=Fe*bi+se*Mi+Ct*Si,ce.y=Fe*He+se*Je+Ct*Qe,ce.wx=Fe,ce.wy=se,ce.wz=Ct,this.clipper.clip(),this.clipper.reduce();let Ge,we,Be;ti?(Ge=yi,we=he,Be=gi):(Ge=-yi,we=-he,Be=-gi),this.setNormal(t,Ge,we,Be);let ve=0,qt=this.clipper.numVertices;for(;ve<qt;){let Jt=ve++,xe=this.clipper.vertices[Jt],Kt,It,Et;Kt=xe.wx,It=xe.wy,Et=xe.wz,Kt+=a,It+=l,Et+=h;let Qt,te,ne;Qt=di-Kt,te=Le-It,ne=_i-Et;let _e=Qt*yi+te*he+ne*gi,de,Se,ye;de=Kt+yi*_e,Se=It+he*_e,ye=Et+gi*_e,_e>-I.common.Setting.contactPersistenceThreshold&&(ti?this.addPoint(t,Kt,It,Et,de,Se,ye,_e,Jt):this.addPoint(t,de,Se,ye,Kt,It,Et,_e,Jt))}}};I.collision.narrowphase.detector._BoxBoxDetector||(I.collision.narrowphase.detector._BoxBoxDetector={});I.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex=class{constructor(){this.x=0,this.y=0,this.wx=0,this.wy=0,this.wz=0}};I.collision.narrowphase.detector._BoxBoxDetector.FaceClipper=class{constructor(){this.w=0,this.h=0,this.numVertices=0,this.numTmpVertices=0,this.vertices=new Array(8),this.tmpVertices=new Array(8),this.vertices[0]=new I.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[0]=new I.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[1]=new I.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[1]=new I.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[2]=new I.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[2]=new I.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[3]=new I.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[3]=new I.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[4]=new I.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[4]=new I.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[5]=new I.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[5]=new I.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[6]=new I.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[6]=new I.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[7]=new I.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[7]=new I.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex}clip(){let t=0,e=this.numVertices;for(;t<e;){let f=t++,m=this.vertices[f],d=this.vertices[(f+1)%this.numVertices],p=this.w+m.x,g=this.w+d.x;if(p>0&&g>0){let x=this.tmpVertices[this.numTmpVertices++];x.x=m.x,x.y=m.y,x.wx=m.wx,x.wy=m.wy,x.wz=m.wz}else if(p>0&&g<=0){let x=this.tmpVertices[this.numTmpVertices++];x.x=m.x,x.y=m.y,x.wx=m.wx,x.wy=m.wy,x.wz=m.wz;let b=p/(p-g),y=this.tmpVertices[this.numTmpVertices++];y.x=m.x+(d.x-m.x)*b,y.y=m.y+(d.y-m.y)*b,y.wx=m.wx+(d.wx-m.wx)*b,y.wy=m.wy+(d.wy-m.wy)*b,y.wz=m.wz+(d.wz-m.wz)*b}else if(p<=0&&g>0){let x=p/(p-g),b=this.tmpVertices[this.numTmpVertices++];b.x=m.x+(d.x-m.x)*x,b.y=m.y+(d.y-m.y)*x,b.wx=m.wx+(d.wx-m.wx)*x,b.wy=m.wy+(d.wy-m.wy)*x,b.wz=m.wz+(d.wz-m.wz)*x}}let i=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=i,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;let n=0,s=this.numVertices;for(;n<s;){let f=n++,m=this.vertices[f],d=this.vertices[(f+1)%this.numVertices],p=this.w-m.x,g=this.w-d.x;if(p>0&&g>0){let x=this.tmpVertices[this.numTmpVertices++];x.x=m.x,x.y=m.y,x.wx=m.wx,x.wy=m.wy,x.wz=m.wz}else if(p>0&&g<=0){let x=this.tmpVertices[this.numTmpVertices++];x.x=m.x,x.y=m.y,x.wx=m.wx,x.wy=m.wy,x.wz=m.wz;let b=p/(p-g),y=this.tmpVertices[this.numTmpVertices++];y.x=m.x+(d.x-m.x)*b,y.y=m.y+(d.y-m.y)*b,y.wx=m.wx+(d.wx-m.wx)*b,y.wy=m.wy+(d.wy-m.wy)*b,y.wz=m.wz+(d.wz-m.wz)*b}else if(p<=0&&g>0){let x=p/(p-g),b=this.tmpVertices[this.numTmpVertices++];b.x=m.x+(d.x-m.x)*x,b.y=m.y+(d.y-m.y)*x,b.wx=m.wx+(d.wx-m.wx)*x,b.wy=m.wy+(d.wy-m.wy)*x,b.wz=m.wz+(d.wz-m.wz)*x}}let o=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=o,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;let r=0,_=this.numVertices;for(;r<_;){let f=r++,m=this.vertices[f],d=this.vertices[(f+1)%this.numVertices],p=this.h+m.y,g=this.h+d.y;if(p>0&&g>0){let x=this.tmpVertices[this.numTmpVertices++];x.x=m.x,x.y=m.y,x.wx=m.wx,x.wy=m.wy,x.wz=m.wz}else if(p>0&&g<=0){let x=this.tmpVertices[this.numTmpVertices++];x.x=m.x,x.y=m.y,x.wx=m.wx,x.wy=m.wy,x.wz=m.wz;let b=p/(p-g),y=this.tmpVertices[this.numTmpVertices++];y.x=m.x+(d.x-m.x)*b,y.y=m.y+(d.y-m.y)*b,y.wx=m.wx+(d.wx-m.wx)*b,y.wy=m.wy+(d.wy-m.wy)*b,y.wz=m.wz+(d.wz-m.wz)*b}else if(p<=0&&g>0){let x=p/(p-g),b=this.tmpVertices[this.numTmpVertices++];b.x=m.x+(d.x-m.x)*x,b.y=m.y+(d.y-m.y)*x,b.wx=m.wx+(d.wx-m.wx)*x,b.wy=m.wy+(d.wy-m.wy)*x,b.wz=m.wz+(d.wz-m.wz)*x}}let a=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=a,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;let l=0,h=this.numVertices;for(;l<h;){let f=l++,m=this.vertices[f],d=this.vertices[(f+1)%this.numVertices],p=this.h-m.y,g=this.h-d.y;if(p>0&&g>0){let x=this.tmpVertices[this.numTmpVertices++];x.x=m.x,x.y=m.y,x.wx=m.wx,x.wy=m.wy,x.wz=m.wz}else if(p>0&&g<=0){let x=this.tmpVertices[this.numTmpVertices++];x.x=m.x,x.y=m.y,x.wx=m.wx,x.wy=m.wy,x.wz=m.wz;let b=p/(p-g),y=this.tmpVertices[this.numTmpVertices++];y.x=m.x+(d.x-m.x)*b,y.y=m.y+(d.y-m.y)*b,y.wx=m.wx+(d.wx-m.wx)*b,y.wy=m.wy+(d.wy-m.wy)*b,y.wz=m.wz+(d.wz-m.wz)*b}else if(p<=0&&g>0){let x=p/(p-g),b=this.tmpVertices[this.numTmpVertices++];b.x=m.x+(d.x-m.x)*x,b.y=m.y+(d.y-m.y)*x,b.wx=m.wx+(d.wx-m.wx)*x,b.wy=m.wy+(d.wy-m.wy)*x,b.wz=m.wz+(d.wz-m.wz)*x}}let u=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=u,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}reduce(){if(this.numVertices<4)return;let t=-1/0,e=1/0,i=-1/0,n=1/0,s=null,o=null,r=null,_=null,a=1,l=1,h=-1,u=1,f=0,m=this.numVertices;for(;f<m;){let y=f++,z=this.vertices[y],M=z.x*a+z.y*l,Y=z.x*h+z.y*u;y==0?(t=M,s=z,e=M,o=z,i=Y,r=z,n=Y,_=z):(M>t&&(t=M,s=z),M<e&&(e=M,o=z),Y>i&&(i=Y,r=z),Y<n&&(n=Y,_=z))}let d=this.tmpVertices[this.numTmpVertices++];d.x=s.x,d.y=s.y,d.wx=s.wx,d.wy=s.wy,d.wz=s.wz;let p=this.tmpVertices[this.numTmpVertices++];p.x=r.x,p.y=r.y,p.wx=r.wx,p.wy=r.wy,p.wz=r.wz;let g=this.tmpVertices[this.numTmpVertices++];g.x=o.x,g.y=o.y,g.wx=o.wx,g.wy=o.wy,g.wz=o.wz;let x=this.tmpVertices[this.numTmpVertices++];x.x=_.x,x.y=_.y,x.wx=_.wx,x.wy=_.wy,x.wz=_.wz;let b=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=b,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}};I.collision.narrowphase.detector.BoxBoxDetectorMacro=class{};I.collision.narrowphase.detector.CachedDetectorData=class{constructor(){}_clear(){this._gjkCache!=null&&this._gjkCache.clear()}};I.collision.narrowphase.detector.CapsuleCapsuleDetector=class extends I.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,e,i,n,s,o){let r=e,_=i;t.incremental=!1;let a,l,h,u,f,m;a=n._rotation01,l=n._rotation11,h=n._rotation21,u=s._rotation01,f=s._rotation11,m=s._rotation21;let d=r._halfHeight,p=_._halfHeight,g=r._radius,x=_._radius,b,y,z,M,Y,X,w,S,V,F,C,A;b=n._positionX+a*-d,y=n._positionY+l*-d,z=n._positionZ+h*-d,M=n._positionX+a*d,Y=n._positionY+l*d,X=n._positionZ+h*d,w=s._positionX+u*-p,S=s._positionY+f*-p,V=s._positionZ+m*-p,F=s._positionX+u*p,C=s._positionY+f*p,A=s._positionZ+m*p;let Z,L,E;Z=b-w,L=y-S,E=z-V;let T,P,N,R,k,O;T=M-b,P=Y-y,N=X-z,R=F-w,k=C-S,O=A-V;let v=-(Z*T+L*P+E*N),D=Z*R+L*k+E*O,B=d*d*4,U=T*R+P*k+N*O,q=p*p*4,tt,Q;if(B==0&&q==0)tt=0,Q=0;else if(B==0)tt=0,D<0?Q=0:D>q?Q=1:Q=D/q;else if(q==0)Q=0,v<0?tt=0:v>B?tt=1:tt=v/B;else{let zt=B*q-U*U;zt==0?tt=0:(tt=U*D+q*v,tt<0?tt=0:tt>zt?tt=1:tt/=zt),Q=tt*U+D,Q<0?(Q=0,v<0?tt=0:v>B?tt=1:tt=v/B):Q>q?(Q=1,tt=U+v,tt<0?tt=0:tt>B?tt=1:tt/=B):Q/=q}let nt,H,j,it,et,G;nt=b+T*tt,H=y+P*tt,j=z+N*tt,it=w+R*Q,et=S+k*Q,G=V+O*Q;let W,lt,ht;W=nt-it,lt=H-et,ht=j-G;let ft=W*W+lt*lt+ht*ht;if(ft>=(g+x)*(g+x))return;let pt=Math.sqrt(ft),K,J,rt;pt>0?(K=W*(1/pt),J=lt*(1/pt),rt=ht*(1/pt)):(K=1,J=0,rt=0),this.setNormal(t,K,J,rt);let mt,xt,vt,Mt,ut,Zt;mt=nt+K*-g,xt=H+J*-g,vt=j+rt*-g,Mt=it+K*x,ut=et+J*x,Zt=G+rt*x,this.addPoint(t,mt,xt,vt,Mt,ut,Zt,g+x-pt,0)}};I.collision.narrowphase.detector.GjkEpaDetector=class extends I.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,e,i,n,s,o){let r=I.collision.narrowphase.detector.gjkepa.GjkEpa.instance,_=e,a=i,l=r.computeClosestPointsImpl(_,a,n,s,I.common.Setting.enableGJKCaching?o:null,!0);if(t.incremental=!0,l!=I.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED){console.log("src/oimo/collision/narrowphase/detector/GjkEpaDetector.hx:28:","GJK/EPA failed: status="+l);return}if(r.distance>_._gjkMargin+a._gjkMargin)return;let h,u,f,m,d,p,g=r.closestPoint1;h=g.x,u=g.y,f=g.z;let x=r.closestPoint2;m=x.x,d=x.y,p=x.z;let b,y,z;if(b=h-m,y=u-d,z=f-p,b*b+y*y+z*z==0)return;r.distance<0&&(b=-b,y=-y,z=-z);let M=b*b+y*y+z*z;M>0&&(M=1/Math.sqrt(M)),b*=M,y*=M,z*=M,this.setNormal(t,b,y,z),h+=b*-_._gjkMargin,u+=y*-_._gjkMargin,f+=z*-_._gjkMargin,m+=b*a._gjkMargin,d+=y*a._gjkMargin,p+=z*a._gjkMargin,this.addPoint(t,h,u,f,m,d,p,_._gjkMargin+a._gjkMargin-r.distance,0)}};I.collision.narrowphase.detector.SphereBoxDetector=class extends I.collision.narrowphase.detector.Detector{constructor(t){super(t)}detectImpl(t,e,i,n,s,o){let r=i;t.incremental=!1;let _,a,l,h,u,f;_=r._halfExtentsX,a=r._halfExtentsY,l=r._halfExtentsZ,h=-_,u=-a,f=-l;let m=e._radius,d,p,g;d=n._positionX-s._positionX,p=n._positionY-s._positionY,g=n._positionZ-s._positionZ;let x,b,y,z,M,Y;if(z=s._rotation00*d+s._rotation10*p+s._rotation20*g,M=s._rotation01*d+s._rotation11*p+s._rotation21*g,Y=s._rotation02*d+s._rotation12*p+s._rotation22*g,x=z,b=M,y=Y,h<x&&_>x&&u<b&&a>b&&f<y&&l>y){let W,lt,ht;W=x<0?-x:x,lt=b<0?-b:b,ht=y<0?-y:y,W=_-W,lt=a-lt,ht=l-ht;let ft,pt,K,J=W,rt=lt,mt=ht,xt,vt,Mt,ut;J<rt?J<mt?(x>0?(ft=1,pt=0,K=0):(ft=-1,pt=0,K=0),vt=0,Mt=1,ut=1,xt=J):(y>0?(ft=0,pt=0,K=1):(ft=0,pt=0,K=-1),vt=1,Mt=1,ut=0,xt=mt):rt<mt?(b>0?(ft=0,pt=1,K=0):(ft=0,pt=-1,K=0),vt=1,Mt=0,ut=1,xt=rt):(y>0?(ft=0,pt=0,K=1):(ft=0,pt=0,K=-1),vt=1,Mt=1,ut=0,xt=mt);let Zt,zt,dt;Zt=vt*x,zt=Mt*b,dt=ut*y;let st,ct,_t;st=ft*_,ct=pt*a,_t=K*l,st+=Zt,ct+=zt,_t+=dt;let Vt,At,St,Xt,Ft,ie,ee,Ye,Ie;ee=s._rotation00*st+s._rotation01*ct+s._rotation02*_t,Ye=s._rotation10*st+s._rotation11*ct+s._rotation12*_t,Ie=s._rotation20*st+s._rotation21*ct+s._rotation22*_t,Vt=ee,At=Ye,St=Ie;let ue,$t,Ht;ue=s._rotation00*ft+s._rotation01*pt+s._rotation02*K,$t=s._rotation10*ft+s._rotation11*pt+s._rotation12*K,Ht=s._rotation20*ft+s._rotation21*pt+s._rotation22*K,Xt=ue,Ft=$t,ie=Ht,this.setNormal(t,Xt,Ft,ie);let me,ze,qe,Ee,Ut,at;me=n._positionX+Xt*-m,ze=n._positionY+Ft*-m,qe=n._positionZ+ie*-m,Ee=s._positionX+Vt,Ut=s._positionY+At,at=s._positionZ+St,this.addPoint(t,me,ze,qe,Ee,Ut,at,xt,0);return}let X,w,S;_-=1e-9,a-=1e-9,l-=1e-9,h+=1e-9,u+=1e-9,f+=1e-9,X=x<_?x:_,w=b<a?b:a,S=y<l?y:l,X>h||(X=h),w>u||(w=u),S>f||(S=f);let V,F,C;V=x-X,F=b-w,C=y-S;let A=V*V+F*F+C*C;if(A>=m*m)return;A=Math.sqrt(A);let Z,L,E,T,P,N,R,k,O;R=s._rotation00*X+s._rotation01*w+s._rotation02*S,k=s._rotation10*X+s._rotation11*w+s._rotation12*S,O=s._rotation20*X+s._rotation21*w+s._rotation22*S,Z=R,L=k,E=O;let v,D,B;v=s._rotation00*V+s._rotation01*F+s._rotation02*C,D=s._rotation10*V+s._rotation11*F+s._rotation12*C,B=s._rotation20*V+s._rotation21*F+s._rotation22*C,T=v,P=D,N=B;let U,q,tt,Q=T*T+P*P+N*N;Q>0&&(Q=1/Math.sqrt(Q)),U=T*Q,q=P*Q,tt=N*Q,this.setNormal(t,U,q,tt);let nt,H,j,it,et,G;nt=n._positionX+U*-m,H=n._positionY+q*-m,j=n._positionZ+tt*-m,it=s._positionX+Z,et=s._positionY+L,G=s._positionZ+E,this.addPoint(t,nt,H,j,it,et,G,m-A,0)}};I.collision.narrowphase.detector.SphereCapsuleDetector=class extends I.collision.narrowphase.detector.Detector{constructor(t){super(t)}detectImpl(t,e,i,n,s,o){let r=i;t.incremental=!1;let _=r._halfHeight,a=e._radius,l=r._radius,h,u,f;h=s._rotation01,u=s._rotation11,f=s._rotation21;let m,d,p;m=n._positionX,d=n._positionY,p=n._positionZ;let g,x,b,y,z,M;g=s._positionX+h*-_,x=s._positionY+u*-_,b=s._positionZ+f*-_,y=s._positionX+h*_,z=s._positionY+u*_,M=s._positionZ+f*_;let Y,X,w;Y=m-g,X=d-x,w=p-b;let S,V,F;S=y-g,V=z-x,F=M-b;let C=_*_*4,A=Y*S+X*V+w*F;A<0?A=0:A>C?A=1:A/=C;let Z,L,E;Z=g+S*A,L=x+V*A,E=b+F*A;let T,P,N;T=m-Z,P=d-L,N=p-E;let R=T*T+P*P+N*N;if(R>=(a+l)*(a+l))return;let k=Math.sqrt(R),O,v,D;k>0?(O=T*(1/k),v=P*(1/k),D=N*(1/k)):(O=1,v=0,D=0),this.setNormal(t,O,v,D);let B,U,q,tt,Q,nt;B=m+O*-a,U=d+v*-a,q=p+D*-a,tt=Z+O*l,Q=L+v*l,nt=E+D*l,this.addPoint(t,B,U,q,tt,Q,nt,a+l-k,0)}};I.collision.narrowphase.detector.SphereSphereDetector=class extends I.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,e,i,n,s,o){t.incremental=!1;let r,_,a;r=n._positionX-s._positionX,_=n._positionY-s._positionY,a=n._positionZ-s._positionZ;let l=e._radius,h=i._radius,u=r*r+_*_+a*a;if(u>=(l+h)*(l+h))return;let f=Math.sqrt(u),m,d,p;f>0?(m=r*(1/f),d=_*(1/f),p=a*(1/f)):(m=1,d=0,p=0),this.setNormal(t,m,d,p);let g,x,b,y,z,M;g=n._positionX+m*-l,x=n._positionY+d*-l,b=n._positionZ+p*-l,y=s._positionX+m*h,z=s._positionY+d*h,M=s._positionZ+p*h,this.addPoint(t,g,x,b,y,z,M,l+h-f,0)}};I.collision.narrowphase.detector.gjkepa||(I.collision.narrowphase.detector.gjkepa={});I.collision.narrowphase.detector.gjkepa.EpaPolyhedron=class{constructor(){this._vertices=new Array(I.common.Setting.maxEPAVertices),this._center=new I.common.Vec3,this._numVertices=0,this._triangleList=null,this._triangleListLast=null,this._numTriangles=0,this._trianglePool=null,this._vertexPool=null}dumpHoleEdge(t){}validate(){let t=this._triangleList;for(;t!=null;){if(t._vertices[0]._tmpEdgeLoopOuterTriangle=null,t._vertices[0]._tmpEdgeLoopNext=null,t._adjacentPairIndex[0]==-1)return this._status=2,!1;if(t._adjacentTriangles[0]==null)return this._status=3,!1;if(t._vertices[1]._tmpEdgeLoopOuterTriangle=null,t._vertices[1]._tmpEdgeLoopNext=null,t._adjacentPairIndex[1]==-1)return this._status=2,!1;if(t._adjacentTriangles[1]==null)return this._status=3,!1;if(t._vertices[2]._tmpEdgeLoopOuterTriangle=null,t._vertices[2]._tmpEdgeLoopNext=null,t._adjacentPairIndex[2]==-1)return this._status=2,!1;if(t._adjacentTriangles[2]==null)return this._status=3,!1;t=t._next}return!0}findEdgeLoop(t,e,i){if(e._tmpDfsId==t)return;e._tmpDfsId=t;let n=e.tmp;n.x=i.x,n.y=i.y,n.z=i.z;let s=e._vertices[0].v;n.x-=s.x,n.y-=s.y,n.z-=s.z;let o=e.tmp,r=e._normal;if(e._tmpDfsVisible=o.x*r.x+o.y*r.y+o.z*r.z>0,!e._tmpDfsVisible){this._status=6;return}let _=0;for(;_<3;){let m=_++,d=e._adjacentTriangles[m];if(d==null)continue;let p=d.tmp;p.x=i.x,p.y=i.y,p.z=i.z;let g=d._vertices[0].v;p.x-=g.x,p.y-=g.y,p.z-=g.z;let x=d.tmp,b=d._normal;if(d._tmpDfsVisible=x.x*b.x+x.y*b.y+x.z*b.z>0,d._tmpDfsVisible)this.findEdgeLoop(t,d,i);else{let y=e._vertices[m];y._tmpEdgeLoopNext=e._vertices[e._nextIndex[m]],y._tmpEdgeLoopOuterTriangle=d}}let a=e._adjacentTriangles[0];if(a!=null){let m=e._adjacentPairIndex[0];a._adjacentTriangles[m]=null,a._adjacentPairIndex[m]=-1,e._adjacentTriangles[0]=null,e._adjacentPairIndex[0]=-1}let l=e._adjacentTriangles[1];if(l!=null){let m=e._adjacentPairIndex[1];l._adjacentTriangles[m]=null,l._adjacentPairIndex[m]=-1,e._adjacentTriangles[1]=null,e._adjacentPairIndex[1]=-1}let h=e._adjacentTriangles[2];if(h!=null){let m=e._adjacentPairIndex[2];h._adjacentTriangles[m]=null,h._adjacentPairIndex[m]=-1,e._adjacentTriangles[2]=null,e._adjacentPairIndex[2]=-1}this._numTriangles--;let u=e._prev,f=e._next;u!=null&&(u._next=f),f!=null&&(f._prev=u),e==this._triangleList&&(this._triangleList=this._triangleList._next),e==this._triangleListLast&&(this._triangleListLast=this._triangleListLast._prev),e._next=null,e._prev=null,e.removeReferences(),e._next=this._trianglePool,this._trianglePool=e}_init(t,e,i,n){this._status=0,this._numVertices=4,this._vertices[0]=t,this._vertices[1]=e,this._vertices[2]=i,this._vertices[3]=n;let s=this._center,o=t.v;s.x=o.x,s.y=o.y,s.z=o.z;let r=e.v;s.x+=r.x,s.y+=r.y,s.z+=r.z;let _=i.v;s.x+=_.x,s.y+=_.y,s.z+=_.z;let a=n.v;s.x+=a.x,s.y+=a.y,s.z+=a.z,s.x*=.25,s.y*=.25,s.z*=.25;let l=this._trianglePool;l!=null?(this._trianglePool=l._next,l._next=null):l=new I.collision.narrowphase.detector.gjkepa.EpaTriangle;let h=l,u=this._trianglePool;u!=null?(this._trianglePool=u._next,u._next=null):u=new I.collision.narrowphase.detector.gjkepa.EpaTriangle;let f=u,m=this._trianglePool;m!=null?(this._trianglePool=m._next,m._next=null):m=new I.collision.narrowphase.detector.gjkepa.EpaTriangle;let d=m,p=this._trianglePool;p!=null?(this._trianglePool=p._next,p._next=null):p=new I.collision.narrowphase.detector.gjkepa.EpaTriangle;let g=p;return h.init(t,e,i,this._center,!0)||(this._status=1),f.init(t,e,n,this._center,!0)||(this._status=1),d.init(t,i,n,this._center,!0)||(this._status=1),g.init(e,i,n,this._center,!0)||(this._status=1),h.setAdjacentTriangle(f)||(this._status=1),h.setAdjacentTriangle(d)||(this._status=1),h.setAdjacentTriangle(g)||(this._status=1),f.setAdjacentTriangle(d)||(this._status=1),f.setAdjacentTriangle(g)||(this._status=1),d.setAdjacentTriangle(g)||(this._status=1),this._numTriangles++,this._triangleList==null?(this._triangleList=h,this._triangleListLast=h):(this._triangleListLast._next=h,h._prev=this._triangleListLast,this._triangleListLast=h),this._numTriangles++,this._triangleList==null?(this._triangleList=f,this._triangleListLast=f):(this._triangleListLast._next=f,f._prev=this._triangleListLast,this._triangleListLast=f),this._numTriangles++,this._triangleList==null?(this._triangleList=d,this._triangleListLast=d):(this._triangleListLast._next=d,d._prev=this._triangleListLast,this._triangleListLast=d),this._numTriangles++,this._triangleList==null?(this._triangleList=g,this._triangleListLast=g):(this._triangleListLast._next=g,g._prev=this._triangleListLast,this._triangleListLast=g),this._status==0}_addVertex(t,e){this._vertices[this._numVertices++]=t;let i=e._vertices[0];if(this.findEdgeLoop(this._numVertices,e,t.v),this._status!=0)return!1;let n=i,s=null,o=null;for(;;){if(n._tmpEdgeLoopNext==null)return this._dumpAsObjModel(),this._status=4,!1;if(n._tmpEdgeLoopOuterTriangle==null)return this._status=5,!1;let r=this._trianglePool;r!=null?(this._trianglePool=r._next,r._next=null):r=new I.collision.narrowphase.detector.gjkepa.EpaTriangle;let _=r;if(o==null&&(o=_),_.init(n,n._tmpEdgeLoopNext,t,this._center,!1)||(this._status=1),this._status!=0)return!1;if(this._numTriangles++,this._triangleList==null?(this._triangleList=_,this._triangleListLast=_):(this._triangleListLast._next=_,_._prev=this._triangleListLast,this._triangleListLast=_),_.setAdjacentTriangle(n._tmpEdgeLoopOuterTriangle)||(this._status=1),s!=null&&(_.setAdjacentTriangle(s)||(this._status=1)),s=_,n=n._tmpEdgeLoopNext,n==i)break}return s.setAdjacentTriangle(o)||(this._status=1),this._status==0?this.validate():!1}_dumpAsObjModel(){}};I.collision.narrowphase.detector.gjkepa.EpaPolyhedronState=class{};I.collision.narrowphase.detector.gjkepa.EpaTriangle=class{constructor(){this.id=++I.collision.narrowphase.detector.gjkepa.EpaTriangle.count,this._next=null,this._prev=null,this._normal=new I.common.Vec3,this._distanceSq=0,this._tmpDfsId=0,this._tmpDfsVisible=!1,this._vertices=new Array(3),this._adjacentTriangles=new Array(3),this._adjacentPairIndex=new Array(3),this.tmp=new I.common.Vec3,this._nextIndex=new Array(3),this._nextIndex[0]=1,this._nextIndex[1]=2,this._nextIndex[2]=0}init(t,e,i,n,s){s==null&&(s=!1);let o,r,_,a,l,h,u,f,m,d,p,g,x=t.v;o=x.x,r=x.y,_=x.z;let b=e.v;a=b.x,l=b.y,h=b.z;let y=i.v;u=y.x,f=y.y,m=y.z,d=n.x,p=n.y,g=n.z;let z,M,Y,X,w,S,V,F,C;z=a-o,M=l-r,Y=h-_,X=u-o,w=f-r,S=m-_,V=o-d,F=r-p,C=_-g;let A,Z,L;A=M*S-Y*w,Z=Y*X-z*S,L=z*w-M*X;let E=!1;if(V*A+F*Z+C*L<0)if(s){let St=e;e=i,i=St,A*=-1,Z*=-1,L*=-1}else E=!0;this._vertices[0]=t,this._vertices[1]=e,this._vertices[2]=i;let T=this._normal;T.x=A,T.y=Z,T.z=L;let P=t.v,N=e.v,R=i.v,k=this.tmp,O,v,D,B,U,q,tt,Q,nt,H,j,it,et,G,W,lt,ht,ft;O=P.x,v=P.y,D=P.z,B=N.x,U=N.y,q=N.z,tt=R.x,Q=R.y,nt=R.z,H=B-O,j=U-v,it=q-D,et=tt-B,G=Q-U,W=nt-q,lt=O-tt,ht=v-Q,ft=D-nt;let pt,K,J;pt=j*W-it*G,K=it*et-H*W,J=H*G-j*et;let rt,mt,xt,vt,Mt,ut,Zt,zt,dt;rt=j*J-it*K,mt=it*pt-H*J,xt=H*K-j*pt,vt=G*J-W*K,Mt=W*pt-et*J,ut=et*K-G*pt,Zt=ht*J-ft*K,zt=ft*pt-lt*J,dt=lt*K-ht*pt;let st=-1,ct,_t,Vt;if(ct=0,_t=0,Vt=0,O*rt+v*mt+D*xt<0){let St,Xt,Ft,ie,ee,Ye;St=P.x,Xt=P.y,Ft=P.z,ie=N.x,ee=N.y,Ye=N.z;let Ie,ue,$t;Ie=ie-St,ue=ee-Xt,$t=Ye-Ft;let Ht=Ie*St+ue*Xt+$t*Ft;if(Ht=-Ht/(Ie*Ie+ue*ue+$t*$t),Ht<0)k.x=St,k.y=Xt,k.z=Ft;else if(Ht>1)k.x=ie,k.y=ee,k.z=Ye;else{let me,ze,qe;me=St+Ie*Ht,ze=Xt+ue*Ht,qe=Ft+$t*Ht,k.x=me,k.y=ze,k.z=qe}st=k.x*k.x+k.y*k.y+k.z*k.z,ct=k.x,_t=k.y,Vt=k.z}if(B*vt+U*Mt+q*ut<0){let St,Xt,Ft,ie,ee,Ye;St=N.x,Xt=N.y,Ft=N.z,ie=R.x,ee=R.y,Ye=R.z;let Ie,ue,$t;Ie=ie-St,ue=ee-Xt,$t=Ye-Ft;let Ht=Ie*St+ue*Xt+$t*Ft;if(Ht=-Ht/(Ie*Ie+ue*ue+$t*$t),Ht<0)k.x=St,k.y=Xt,k.z=Ft;else if(Ht>1)k.x=ie,k.y=ee,k.z=Ye;else{let ze,qe,Ee;ze=St+Ie*Ht,qe=Xt+ue*Ht,Ee=Ft+$t*Ht,k.x=ze,k.y=qe,k.z=Ee}let me=k.x*k.x+k.y*k.y+k.z*k.z;(st<0||me<st)&&(st=me,ct=k.x,_t=k.y,Vt=k.z)}if(tt*Zt+Q*zt+nt*dt<0){let St,Xt,Ft,ie,ee,Ye;St=P.x,Xt=P.y,Ft=P.z,ie=R.x,ee=R.y,Ye=R.z;let Ie,ue,$t;Ie=ie-St,ue=ee-Xt,$t=Ye-Ft;let Ht=Ie*St+ue*Xt+$t*Ft;if(Ht=-Ht/(Ie*Ie+ue*ue+$t*$t),Ht<0)k.x=St,k.y=Xt,k.z=Ft;else if(Ht>1)k.x=ie,k.y=ee,k.z=Ye;else{let ze,qe,Ee;ze=St+Ie*Ht,qe=Xt+ue*Ht,Ee=Ft+$t*Ht,k.x=ze,k.y=qe,k.z=Ee}let me=k.x*k.x+k.y*k.y+k.z*k.z;(st<0||me<st)&&(st=me,ct=k.x,_t=k.y,Vt=k.z)}if(st>0)k.x=ct,k.y=_t,k.z=Vt;else{let St=pt*pt+K*K+J*J;St>0&&(St=1/Math.sqrt(St)),pt*=St,K*=St,J*=St;let Xt=pt*pt+K*K+J*J;Xt=(O*pt+v*K+D*J)/Xt,ct=pt*Xt,_t=K*Xt,Vt=J*Xt,k.x=ct,k.y=_t,k.z=Vt}let At=this.tmp;return this._distanceSq=At.x*At.x+At.y*At.y+At.z*At.z,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=-1,this._adjacentPairIndex[1]=-1,this._adjacentPairIndex[2]=-1,!E}setAdjacentTriangle(t){let e=0;return this._vertices[0]==t._vertices[this._nextIndex[0]]&&this._vertices[this._nextIndex[0]]==t._vertices[0]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=0,e=1),this._vertices[0]==t._vertices[this._nextIndex[1]]&&this._vertices[this._nextIndex[0]]==t._vertices[1]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=0,++e),this._vertices[0]==t._vertices[this._nextIndex[2]]&&this._vertices[this._nextIndex[0]]==t._vertices[2]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=0,++e),this._vertices[1]==t._vertices[this._nextIndex[0]]&&this._vertices[this._nextIndex[1]]==t._vertices[0]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=1,++e),this._vertices[1]==t._vertices[this._nextIndex[1]]&&this._vertices[this._nextIndex[1]]==t._vertices[1]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=1,++e),this._vertices[1]==t._vertices[this._nextIndex[2]]&&this._vertices[this._nextIndex[1]]==t._vertices[2]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=1,++e),this._vertices[2]==t._vertices[this._nextIndex[0]]&&this._vertices[this._nextIndex[2]]==t._vertices[0]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=2,++e),this._vertices[2]==t._vertices[this._nextIndex[1]]&&this._vertices[this._nextIndex[2]]==t._vertices[1]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=2,++e),this._vertices[2]==t._vertices[this._nextIndex[2]]&&this._vertices[this._nextIndex[2]]==t._vertices[2]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=2,++e),e==1}removeAdjacentTriangles(){let t=this._adjacentTriangles[0];if(t!=null){let n=this._adjacentPairIndex[0];t._adjacentTriangles[n]=null,t._adjacentPairIndex[n]=-1,this._adjacentTriangles[0]=null,this._adjacentPairIndex[0]=-1}let e=this._adjacentTriangles[1];if(e!=null){let n=this._adjacentPairIndex[1];e._adjacentTriangles[n]=null,e._adjacentPairIndex[n]=-1,this._adjacentTriangles[1]=null,this._adjacentPairIndex[1]=-1}let i=this._adjacentTriangles[2];if(i!=null){let n=this._adjacentPairIndex[2];i._adjacentTriangles[n]=null,i._adjacentPairIndex[n]=-1,this._adjacentTriangles[2]=null,this._adjacentPairIndex[2]=-1}}removeReferences(){this._next=null,this._prev=null,this._tmpDfsId=0,this._tmpDfsVisible=!1,this._distanceSq=0,this._vertices[0]=null,this._vertices[1]=null,this._vertices[2]=null,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=0,this._adjacentPairIndex[1]=0,this._adjacentPairIndex[2]=0}dump(){}};I.collision.narrowphase.detector.gjkepa.EpaVertex=class{constructor(){this.randId=Math.random()*1e5|0,this.v=new I.common.Vec3,this.w1=new I.common.Vec3,this.w2=new I.common.Vec3}init(t,e,i){let n=this.v;n.x=t.x,n.y=t.y,n.z=t.z;let s=this.w1;s.x=e.x,s.y=e.y,s.z=e.z;let o=this.w2;return o.x=i.x,o.y=i.y,o.z=i.z,this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null,this}removeReferences(){this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null}};I.collision.narrowphase.detector.gjkepa.GjkCache=class{constructor(){this.prevClosestDir=new I.common.Vec3}clear(){this.prevClosestDir.zero()}};I.common||(I.common={});I.common.Vec3=class{constructor(t,e,i){i==null&&(i=0),e==null&&(e=0),t==null&&(t=0),this.x=t,this.y=e,this.z=i,I.common.Vec3.numCreations++}init(t,e,i){return this.x=t,this.y=e,this.z=i,this}zero(){return this.x=0,this.y=0,this.z=0,this}add(t){return new I.common.Vec3(this.x+t.x,this.y+t.y,this.z+t.z)}add3(t,e,i){return new I.common.Vec3(this.x+t,this.y+e,this.z+i)}addScaled(t,e){return new I.common.Vec3(this.x+t.x*e,this.y+t.y*e,this.z+t.z*e)}sub(t){return new I.common.Vec3(this.x-t.x,this.y-t.y,this.z-t.z)}sub3(t,e,i){return new I.common.Vec3(this.x-t,this.y-e,this.z-i)}scale(t){return new I.common.Vec3(this.x*t,this.y*t,this.z*t)}scale3(t,e,i){return new I.common.Vec3(this.x*t,this.y*e,this.z*i)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return new I.common.Vec3(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}addEq(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}add3Eq(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this}addScaledEq(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}subEq(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}sub3Eq(t,e,i){return this.x-=t,this.y-=e,this.z-=i,this}scaleEq(t){return this.x*=t,this.y*=t,this.z*=t,this}scale3Eq(t,e,i){return this.x*=t,this.y*=e,this.z*=i,this}crossEq(t){let e=this.z*t.x-this.x*t.z,i=this.x*t.y-this.y*t.x;return this.x=this.y*t.z-this.z*t.y,this.y=e,this.z=i,this}mulMat3(t){return new I.common.Vec3(this.x*t.e00+this.y*t.e01+this.z*t.e02,this.x*t.e10+this.y*t.e11+this.z*t.e12,this.x*t.e20+this.y*t.e21+this.z*t.e22)}mulMat4(t){return new I.common.Vec3(this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23)}mulTransform(t){let e,i,n;e=this.x,i=this.y,n=this.z;let s,o,r;s=t._rotation00*e+t._rotation01*i+t._rotation02*n,o=t._rotation10*e+t._rotation11*i+t._rotation12*n,r=t._rotation20*e+t._rotation21*i+t._rotation22*n,e=s,i=o,n=r,e+=t._positionX,i+=t._positionY,n+=t._positionZ;let _=new I.common.Vec3;return _.x=e,_.y=i,_.z=n,_}mulMat3Eq(t){let e=this.x*t.e10+this.y*t.e11+this.z*t.e12,i=this.x*t.e20+this.y*t.e21+this.z*t.e22;return this.x=this.x*t.e00+this.y*t.e01+this.z*t.e02,this.y=e,this.z=i,this}mulMat4Eq(t){let e=this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,i=this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23;return this.x=this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,this.y=e,this.z=i,this}mulTransformEq(t){let e,i,n;e=this.x,i=this.y,n=this.z;let s,o,r;return s=t._rotation00*e+t._rotation01*i+t._rotation02*n,o=t._rotation10*e+t._rotation11*i+t._rotation12*n,r=t._rotation20*e+t._rotation21*i+t._rotation22*n,e=s,i=o,n=r,e+=t._positionX,i+=t._positionY,n+=t._positionZ,this.x=e,this.y=i,this.z=n,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}normalized(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>0&&(t=1/t),new I.common.Vec3(this.x*t,this.y*t,this.z*t)}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>0&&(t=1/t),this.x*=t,this.y*=t,this.z*=t,this}negate(){return new I.common.Vec3(-this.x,-this.y,-this.z)}negateEq(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}clone(){return new I.common.Vec3(this.x,this.y,this.z)}toString(){return"Vec3["+(this.x>0?(this.x*1e7+.5|0)/1e7:(this.x*1e7-.5|0)/1e7)+", "+(this.y>0?(this.y*1e7+.5|0)/1e7:(this.y*1e7-.5|0)/1e7)+", "+(this.z>0?(this.z*1e7+.5|0)/1e7:(this.z*1e7-.5|0)/1e7)+"]"}};I.common.Transform=class{constructor(){this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1}identity(){return this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1,this}getPosition(){let t=new I.common.Vec3;return t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ,t}getPositionTo(t){t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ}setPosition(t){return this._positionX=t.x,this._positionY=t.y,this._positionZ=t.z,this}translate(t){let e,i,n;e=t.x,i=t.y,n=t.z,this._positionX+=e,this._positionY+=i,this._positionZ+=n}getRotation(){let t=new I.common.Mat3;return t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22,t}getRotationTo(t){t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22}setRotation(t){return this._rotation00=t.e00,this._rotation01=t.e01,this._rotation02=t.e02,this._rotation10=t.e10,this._rotation11=t.e11,this._rotation12=t.e12,this._rotation20=t.e20,this._rotation21=t.e21,this._rotation22=t.e22,this}setRotationXyz(t){let e,i,n;e=t.x,i=t.y,n=t.z;let s=Math.sin(e),o=Math.sin(i),r=Math.sin(n),_=Math.cos(e),a=Math.cos(i),l=Math.cos(n);this._rotation00=a*l,this._rotation01=-a*r,this._rotation02=o,this._rotation10=_*r+l*s*o,this._rotation11=_*l-s*o*r,this._rotation12=-a*s,this._rotation20=s*r-_*l*o,this._rotation21=l*s+_*o*r,this._rotation22=_*a}rotate(t){let e,i,n,s,o,r,_,a,l;e=t.e00,i=t.e01,n=t.e02,s=t.e10,o=t.e11,r=t.e12,_=t.e20,a=t.e21,l=t.e22;let h,u,f,m,d,p,g,x,b;h=e*this._rotation00+i*this._rotation10+n*this._rotation20,u=e*this._rotation01+i*this._rotation11+n*this._rotation21,f=e*this._rotation02+i*this._rotation12+n*this._rotation22,m=s*this._rotation00+o*this._rotation10+r*this._rotation20,d=s*this._rotation01+o*this._rotation11+r*this._rotation21,p=s*this._rotation02+o*this._rotation12+r*this._rotation22,g=_*this._rotation00+a*this._rotation10+l*this._rotation20,x=_*this._rotation01+a*this._rotation11+l*this._rotation21,b=_*this._rotation02+a*this._rotation12+l*this._rotation22,this._rotation00=h,this._rotation01=u,this._rotation02=f,this._rotation10=m,this._rotation11=d,this._rotation12=p,this._rotation20=g,this._rotation21=x,this._rotation22=b}rotateXyz(t){let e,i,n,s,o,r,_,a,l,h,u,f;e=t.x,i=t.y,n=t.z;let m=Math.sin(e),d=Math.sin(i),p=Math.sin(n),g=Math.cos(e),x=Math.cos(i),b=Math.cos(n);s=x*b,o=-x*p,r=d,_=g*p+b*m*d,a=g*b-m*d*p,l=-x*m,h=m*p-g*b*d,u=b*m+g*d*p,f=g*x;let y,z,M,Y,X,w,S,V,F;y=s*this._rotation00+o*this._rotation10+r*this._rotation20,z=s*this._rotation01+o*this._rotation11+r*this._rotation21,M=s*this._rotation02+o*this._rotation12+r*this._rotation22,Y=_*this._rotation00+a*this._rotation10+l*this._rotation20,X=_*this._rotation01+a*this._rotation11+l*this._rotation21,w=_*this._rotation02+a*this._rotation12+l*this._rotation22,S=h*this._rotation00+u*this._rotation10+f*this._rotation20,V=h*this._rotation01+u*this._rotation11+f*this._rotation21,F=h*this._rotation02+u*this._rotation12+f*this._rotation22,this._rotation00=y,this._rotation01=z,this._rotation02=M,this._rotation10=Y,this._rotation11=X,this._rotation12=w,this._rotation20=S,this._rotation21=V,this._rotation22=F}getOrientation(){let t=new I.common.Quat,e,i,n,s,o=this._rotation00,r=this._rotation11,_=this._rotation22,a=o+r+_,l;return a>0?(l=Math.sqrt(a+1),s=.5*l,l=.5/l,e=(this._rotation21-this._rotation12)*l,i=(this._rotation02-this._rotation20)*l,n=(this._rotation10-this._rotation01)*l):o>r?o>_?(l=Math.sqrt(o-r-_+1),e=.5*l,l=.5/l,i=(this._rotation01+this._rotation10)*l,n=(this._rotation02+this._rotation20)*l,s=(this._rotation21-this._rotation12)*l):(l=Math.sqrt(_-o-r+1),n=.5*l,l=.5/l,e=(this._rotation02+this._rotation20)*l,i=(this._rotation12+this._rotation21)*l,s=(this._rotation10-this._rotation01)*l):r>_?(l=Math.sqrt(r-_-o+1),i=.5*l,l=.5/l,e=(this._rotation01+this._rotation10)*l,n=(this._rotation12+this._rotation21)*l,s=(this._rotation02-this._rotation20)*l):(l=Math.sqrt(_-o-r+1),n=.5*l,l=.5/l,e=(this._rotation02+this._rotation20)*l,i=(this._rotation12+this._rotation21)*l,s=(this._rotation10-this._rotation01)*l),t.x=e,t.y=i,t.z=n,t.w=s,t}getOrientationTo(t){let e,i,n,s,o=this._rotation00,r=this._rotation11,_=this._rotation22,a=o+r+_,l;a>0?(l=Math.sqrt(a+1),s=.5*l,l=.5/l,e=(this._rotation21-this._rotation12)*l,i=(this._rotation02-this._rotation20)*l,n=(this._rotation10-this._rotation01)*l):o>r?o>_?(l=Math.sqrt(o-r-_+1),e=.5*l,l=.5/l,i=(this._rotation01+this._rotation10)*l,n=(this._rotation02+this._rotation20)*l,s=(this._rotation21-this._rotation12)*l):(l=Math.sqrt(_-o-r+1),n=.5*l,l=.5/l,e=(this._rotation02+this._rotation20)*l,i=(this._rotation12+this._rotation21)*l,s=(this._rotation10-this._rotation01)*l):r>_?(l=Math.sqrt(r-_-o+1),i=.5*l,l=.5/l,e=(this._rotation01+this._rotation10)*l,n=(this._rotation12+this._rotation21)*l,s=(this._rotation02-this._rotation20)*l):(l=Math.sqrt(_-o-r+1),n=.5*l,l=.5/l,e=(this._rotation02+this._rotation20)*l,i=(this._rotation12+this._rotation21)*l,s=(this._rotation10-this._rotation01)*l),t.x=e,t.y=i,t.z=n,t.w=s}setOrientation(t){let e,i,n,s;e=t.x,i=t.y,n=t.z,s=t.w;let o=e,r=i,_=n,a=s,l=2*o,h=2*r,u=2*_,f=o*l,m=r*h,d=_*u,p=o*h,g=r*u,x=o*u,b=a*l,y=a*h,z=a*u;return this._rotation00=1-m-d,this._rotation01=p-z,this._rotation02=x+y,this._rotation10=p+z,this._rotation11=1-f-d,this._rotation12=g-b,this._rotation20=x-y,this._rotation21=g+b,this._rotation22=1-f-m,this}clone(){let t=new I.common.Transform;return t._positionX=this._positionX,t._positionY=this._positionY,t._positionZ=this._positionZ,t._rotation00=this._rotation00,t._rotation01=this._rotation01,t._rotation02=this._rotation02,t._rotation10=this._rotation10,t._rotation11=this._rotation11,t._rotation12=this._rotation12,t._rotation20=this._rotation20,t._rotation21=this._rotation21,t._rotation22=this._rotation22,t}copyFrom(t){return this._positionX=t._positionX,this._positionY=t._positionY,this._positionZ=t._positionZ,this._rotation00=t._rotation00,this._rotation01=t._rotation01,this._rotation02=t._rotation02,this._rotation10=t._rotation10,this._rotation11=t._rotation11,this._rotation12=t._rotation12,this._rotation20=t._rotation20,this._rotation21=t._rotation21,this._rotation22=t._rotation22,this}};I.common.Setting=class{};I.collision.narrowphase.detector.gjkepa.GjkEpa=class{constructor(){this.s=new Array(4),this.w1=new Array(4),this.w2=new Array(4),this.baseDirs=new Array(3),this.baseDirs[0]=new I.common.Vec3(1,0,0),this.baseDirs[1]=new I.common.Vec3(0,1,0),this.baseDirs[2]=new I.common.Vec3(0,0,1),this.tl1=new I.common.Vec3,this.tl2=new I.common.Vec3,this.rayX=new I.common.Vec3,this.rayR=new I.common.Vec3,this.tempTransform=new I.common.Transform,this.s[0]=new I.common.Vec3,this.w1[0]=new I.common.Vec3,this.w2[0]=new I.common.Vec3,this.s[1]=new I.common.Vec3,this.w1[1]=new I.common.Vec3,this.w2[1]=new I.common.Vec3,this.s[2]=new I.common.Vec3,this.w1[2]=new I.common.Vec3,this.w2[2]=new I.common.Vec3,this.s[3]=new I.common.Vec3,this.w1[3]=new I.common.Vec3,this.w2[3]=new I.common.Vec3,this.dir=new I.common.Vec3,this.closest=new I.common.Vec3,this.closestPoint1=new I.common.Vec3,this.closestPoint2=new I.common.Vec3,this.polyhedron=new I.collision.narrowphase.detector.gjkepa.EpaPolyhedron}computeClosestPointsImpl(t,e,i,n,s,o){this.c1=t,this.c2=e,this.tf1=i,this.tf2=n;let r=this.s,_=this.w1,a=this.w2,l=this.closest,h=this.dir;if(s!=null?(s._gjkCache==null&&(s._gjkCache=new I.collision.narrowphase.detector.gjkepa.GjkCache),this.loadCache(s._gjkCache)):h.zero(),h.x*h.x+h.y*h.y+h.z*h.z==0){let p,g,x;p=n._positionX-i._positionX,g=n._positionY-i._positionY,x=n._positionZ-i._positionZ,h.x=p,h.y=g,h.z=x,h.x*h.x+h.y*h.y+h.z*h.z<1e-6&&h.init(1,0,0)}this.simplexSize=0,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let u=this.s[this.simplexSize],f=this.w1[this.simplexSize];u.x=f.x,u.y=f.y,u.z=f.z;let m=this.w2[this.simplexSize];u.x-=m.x,u.y-=m.y,u.z-=m.z,this.simplexSize=1;let d=0;for(;d<40;){let p=0;switch(this.simplexSize){case 1:let z=r[0];l.x=z.x,l.y=z.y,l.z=z.z,p=1;break;case 2:let M,Y,X,w,S,V,F=r[0];M=F.x,Y=F.y,X=F.z;let C=r[1];w=C.x,S=C.y,V=C.z;let A,Z,L;A=w-M,Z=S-Y,L=V-X;let E=A*M+Z*Y+L*X;if(E=-E/(A*A+Z*Z+L*L),E<0)l.x=M,l.y=Y,l.z=X,p=1;else if(E>1)l.x=w,l.y=S,l.z=V,p=2;else{let He,Je,Qe;He=M+A*E,Je=Y+Z*E,Qe=X+L*E,l.x=He,l.y=Je,l.z=Qe,p=3}break;case 3:let T=r[0],P=r[1],N=r[2],R,k,O,v,D,B,U,q,tt,Q,nt,H,j,it,et,G,W,lt;R=T.x,k=T.y,O=T.z,v=P.x,D=P.y,B=P.z,U=N.x,q=N.y,tt=N.z,Q=v-R,nt=D-k,H=B-O,j=U-v,it=q-D,et=tt-B,G=R-U,W=k-q,lt=O-tt;let ht,ft,pt;ht=nt*et-H*it,ft=H*j-Q*et,pt=Q*it-nt*j;let K,J,rt,mt,xt,vt,Mt,ut,Zt;K=nt*pt-H*ft,J=H*ht-Q*pt,rt=Q*ft-nt*ht,mt=it*pt-et*ft,xt=et*ht-j*pt,vt=j*ft-it*ht,Mt=W*pt-lt*ft,ut=lt*ht-G*pt,Zt=G*ft-W*ht;let zt=-1,dt,st,ct,_t=0;if(dt=0,st=0,ct=0,R*K+k*J+O*rt<0){let He,Je,Qe,ci,hi,ei;He=T.x,Je=T.y,Qe=T.z,ci=P.x,hi=P.y,ei=P.z;let ai,Ke,We;ai=ci-He,Ke=hi-Je,We=ei-Qe;let ke=ai*He+Ke*Je+We*Qe;ke=-ke/(ai*ai+Ke*Ke+We*We);let le;if(ke<0)l.x=He,l.y=Je,l.z=Qe,le=1;else if(ke>1)l.x=ci,l.y=hi,l.z=ei,le=2;else{let ge,jt,Ae;ge=He+ai*ke,jt=Je+Ke*ke,Ae=Qe+We*ke,l.x=ge,l.y=jt,l.z=Ae,le=3}_t=le,zt=l.x*l.x+l.y*l.y+l.z*l.z,dt=l.x,st=l.y,ct=l.z}if(v*mt+D*xt+B*vt<0){let He,Je,Qe,ci,hi,ei;He=P.x,Je=P.y,Qe=P.z,ci=N.x,hi=N.y,ei=N.z;let ai,Ke,We;ai=ci-He,Ke=hi-Je,We=ei-Qe;let ke=ai*He+Ke*Je+We*Qe;ke=-ke/(ai*ai+Ke*Ke+We*We);let le;if(ke<0)l.x=He,l.y=Je,l.z=Qe,le=1;else if(ke>1)l.x=ci,l.y=hi,l.z=ei,le=2;else{let jt,Ae,Ze;jt=He+ai*ke,Ae=Je+Ke*ke,Ze=Qe+We*ke,l.x=jt,l.y=Ae,l.z=Ze,le=3}let ge=l.x*l.x+l.y*l.y+l.z*l.z;(zt<0||ge<zt)&&(_t=le<<1,zt=ge,dt=l.x,st=l.y,ct=l.z)}if(U*Mt+q*ut+tt*Zt<0){let He,Je,Qe,ci,hi,ei;He=T.x,Je=T.y,Qe=T.z,ci=N.x,hi=N.y,ei=N.z;let ai,Ke,We;ai=ci-He,Ke=hi-Je,We=ei-Qe;let ke=ai*He+Ke*Je+We*Qe;ke=-ke/(ai*ai+Ke*Ke+We*We);let le;if(ke<0)l.x=He,l.y=Je,l.z=Qe,le=1;else if(ke>1)l.x=ci,l.y=hi,l.z=ei,le=2;else{let jt,Ae,Ze;jt=He+ai*ke,Ae=Je+Ke*ke,Ze=Qe+We*ke,l.x=jt,l.y=Ae,l.z=Ze,le=3}let ge=l.x*l.x+l.y*l.y+l.z*l.z;(zt<0||ge<zt)&&(_t=le&1|(le&2)<<1,zt=ge,dt=l.x,st=l.y,ct=l.z)}if(zt>0)l.x=dt,l.y=st,l.z=ct,p=_t;else{let He=ht*ht+ft*ft+pt*pt;He>0&&(He=1/Math.sqrt(He)),ht*=He,ft*=He,pt*=He;let Je=ht*ht+ft*ft+pt*pt;Je=(R*ht+k*ft+O*pt)/Je,dt=ht*Je,st=ft*Je,ct=pt*Je,l.x=dt,l.y=st,l.z=ct,p=7}break;case 4:let Vt=r[0],At=r[1],St=r[2],Xt=r[3],Ft,ie,ee,Ye,Ie,ue,$t,Ht,me,ze,qe,Ee,Ut,at,gt,yt,bt,ot,Pt,Dt,$,kt,Rt,Ot,Wt,Bt,re;Ft=Vt.x,ie=Vt.y,ee=Vt.z,Ye=At.x,Ie=At.y,ue=At.z,$t=St.x,Ht=St.y,me=St.z,ze=Xt.x,qe=Xt.y,Ee=Xt.z,Ut=Ye-Ft,at=Ie-ie,gt=ue-ee,yt=$t-Ft,bt=Ht-ie,ot=me-ee,Pt=ze-Ft,Dt=qe-ie,$=Ee-ee,kt=$t-Ye,Rt=Ht-Ie,Ot=me-ue,Wt=ze-Ye,Bt=qe-Ie,re=Ee-ue;let Ce,be,Tt,Lt,Yt,pe,Me,fe,ti,di,Le,_i;Ce=at*ot-gt*bt,be=gt*yt-Ut*ot,Tt=Ut*bt-at*yt,Lt=bt*$-ot*Dt,Yt=ot*Pt-yt*$,pe=yt*Dt-bt*Pt,Me=Dt*gt-$*at,fe=$*Ut-Pt*gt,ti=Pt*at-Dt*Ut,di=Bt*Ot-re*Rt,Le=re*kt-Wt*Ot,_i=Wt*Rt-Bt*kt;let yi=Ut*di+at*Le+gt*_i>0?1:-1,he=-1,gi,bi,Mi,Si=0;if(gi=0,bi=0,Mi=0,(Ft*Ce+ie*be+ee*Tt)*yi<0){let He,Je,Qe,ci,hi,ei,ai,Ke,We,ke,le,ge,jt,Ae,Ze,Re,Te,Fe;He=Vt.x,Je=Vt.y,Qe=Vt.z,ci=At.x,hi=At.y,ei=At.z,ai=St.x,Ke=St.y,We=St.z,ke=ci-He,le=hi-Je,ge=ei-Qe,jt=ai-ci,Ae=Ke-hi,Ze=We-ei,Re=He-ai,Te=Je-Ke,Fe=Qe-We;let se,Ct,Gt;se=le*Ze-ge*Ae,Ct=ge*jt-ke*Ze,Gt=ke*Ae-le*jt;let Pe,Ve,Ue,ii,ri,mi,xi,ce,Ge;Pe=le*Gt-ge*Ct,Ve=ge*se-ke*Gt,Ue=ke*Ct-le*se,ii=Ae*Gt-Ze*Ct,ri=Ze*se-jt*Gt,mi=jt*Ct-Ae*se,xi=Te*Gt-Fe*Ct,ce=Fe*se-Re*Gt,Ge=Re*Ct-Te*se;let we=-1,Be,ve,qt,Jt=0;if(Be=0,ve=0,qt=0,He*Pe+Je*Ve+Qe*Ue<0){let Kt,It,Et,Qt,te,ne;Kt=Vt.x,It=Vt.y,Et=Vt.z,Qt=At.x,te=At.y,ne=At.z;let _e,de,Se;_e=Qt-Kt,de=te-It,Se=ne-Et;let ye=_e*Kt+de*It+Se*Et;ye=-ye/(_e*_e+de*de+Se*Se);let oe;if(ye<0)l.x=Kt,l.y=It,l.z=Et,oe=1;else if(ye>1)l.x=Qt,l.y=te,l.z=ne,oe=2;else{let Nt,ae,Xe;Nt=Kt+_e*ye,ae=It+de*ye,Xe=Et+Se*ye,l.x=Nt,l.y=ae,l.z=Xe,oe=3}Jt=oe,we=l.x*l.x+l.y*l.y+l.z*l.z,Be=l.x,ve=l.y,qt=l.z}if(ci*ii+hi*ri+ei*mi<0){let Kt,It,Et,Qt,te,ne;Kt=At.x,It=At.y,Et=At.z,Qt=St.x,te=St.y,ne=St.z;let _e,de,Se;_e=Qt-Kt,de=te-It,Se=ne-Et;let ye=_e*Kt+de*It+Se*Et;ye=-ye/(_e*_e+de*de+Se*Se);let oe;if(ye<0)l.x=Kt,l.y=It,l.z=Et,oe=1;else if(ye>1)l.x=Qt,l.y=te,l.z=ne,oe=2;else{let ae,Xe,Oe;ae=Kt+_e*ye,Xe=It+de*ye,Oe=Et+Se*ye,l.x=ae,l.y=Xe,l.z=Oe,oe=3}let Nt=l.x*l.x+l.y*l.y+l.z*l.z;(we<0||Nt<we)&&(Jt=oe<<1,we=Nt,Be=l.x,ve=l.y,qt=l.z)}if(ai*xi+Ke*ce+We*Ge<0){let Kt,It,Et,Qt,te,ne;Kt=Vt.x,It=Vt.y,Et=Vt.z,Qt=St.x,te=St.y,ne=St.z;let _e,de,Se;_e=Qt-Kt,de=te-It,Se=ne-Et;let ye=_e*Kt+de*It+Se*Et;ye=-ye/(_e*_e+de*de+Se*Se);let oe;if(ye<0)l.x=Kt,l.y=It,l.z=Et,oe=1;else if(ye>1)l.x=Qt,l.y=te,l.z=ne,oe=2;else{let ae,Xe,Oe;ae=Kt+_e*ye,Xe=It+de*ye,Oe=Et+Se*ye,l.x=ae,l.y=Xe,l.z=Oe,oe=3}let Nt=l.x*l.x+l.y*l.y+l.z*l.z;(we<0||Nt<we)&&(Jt=oe&1|(oe&2)<<1,we=Nt,Be=l.x,ve=l.y,qt=l.z)}let xe;if(we>0)l.x=Be,l.y=ve,l.z=qt,xe=Jt;else{let Kt=se*se+Ct*Ct+Gt*Gt;Kt>0&&(Kt=1/Math.sqrt(Kt)),se*=Kt,Ct*=Kt,Gt*=Kt;let It=se*se+Ct*Ct+Gt*Gt;It=(He*se+Je*Ct+Qe*Gt)/It,Be=se*It,ve=Ct*It,qt=Gt*It,l.x=Be,l.y=ve,l.z=qt,xe=7}Si=xe,he=l.x*l.x+l.y*l.y+l.z*l.z,gi=l.x,bi=l.y,Mi=l.z}if((Ft*Lt+ie*Yt+ee*pe)*yi<0){let He,Je,Qe,ci,hi,ei,ai,Ke,We,ke,le,ge,jt,Ae,Ze,Re,Te,Fe;He=Vt.x,Je=Vt.y,Qe=Vt.z,ci=St.x,hi=St.y,ei=St.z,ai=Xt.x,Ke=Xt.y,We=Xt.z,ke=ci-He,le=hi-Je,ge=ei-Qe,jt=ai-ci,Ae=Ke-hi,Ze=We-ei,Re=He-ai,Te=Je-Ke,Fe=Qe-We;let se,Ct,Gt;se=le*Ze-ge*Ae,Ct=ge*jt-ke*Ze,Gt=ke*Ae-le*jt;let Pe,Ve,Ue,ii,ri,mi,xi,ce,Ge;Pe=le*Gt-ge*Ct,Ve=ge*se-ke*Gt,Ue=ke*Ct-le*se,ii=Ae*Gt-Ze*Ct,ri=Ze*se-jt*Gt,mi=jt*Ct-Ae*se,xi=Te*Gt-Fe*Ct,ce=Fe*se-Re*Gt,Ge=Re*Ct-Te*se;let we=-1,Be,ve,qt,Jt=0;if(Be=0,ve=0,qt=0,He*Pe+Je*Ve+Qe*Ue<0){let It,Et,Qt,te,ne,_e;It=Vt.x,Et=Vt.y,Qt=Vt.z,te=St.x,ne=St.y,_e=St.z;let de,Se,ye;de=te-It,Se=ne-Et,ye=_e-Qt;let oe=de*It+Se*Et+ye*Qt;oe=-oe/(de*de+Se*Se+ye*ye);let Nt;if(oe<0)l.x=It,l.y=Et,l.z=Qt,Nt=1;else if(oe>1)l.x=te,l.y=ne,l.z=_e,Nt=2;else{let ae,Xe,Oe;ae=It+de*oe,Xe=Et+Se*oe,Oe=Qt+ye*oe,l.x=ae,l.y=Xe,l.z=Oe,Nt=3}Jt=Nt,we=l.x*l.x+l.y*l.y+l.z*l.z,Be=l.x,ve=l.y,qt=l.z}if(ci*ii+hi*ri+ei*mi<0){let It,Et,Qt,te,ne,_e;It=St.x,Et=St.y,Qt=St.z,te=Xt.x,ne=Xt.y,_e=Xt.z;let de,Se,ye;de=te-It,Se=ne-Et,ye=_e-Qt;let oe=de*It+Se*Et+ye*Qt;oe=-oe/(de*de+Se*Se+ye*ye);let Nt;if(oe<0)l.x=It,l.y=Et,l.z=Qt,Nt=1;else if(oe>1)l.x=te,l.y=ne,l.z=_e,Nt=2;else{let Xe,Oe,oi;Xe=It+de*oe,Oe=Et+Se*oe,oi=Qt+ye*oe,l.x=Xe,l.y=Oe,l.z=oi,Nt=3}let ae=l.x*l.x+l.y*l.y+l.z*l.z;(we<0||ae<we)&&(Jt=Nt<<1,we=ae,Be=l.x,ve=l.y,qt=l.z)}if(ai*xi+Ke*ce+We*Ge<0){let It,Et,Qt,te,ne,_e;It=Vt.x,Et=Vt.y,Qt=Vt.z,te=Xt.x,ne=Xt.y,_e=Xt.z;let de,Se,ye;de=te-It,Se=ne-Et,ye=_e-Qt;let oe=de*It+Se*Et+ye*Qt;oe=-oe/(de*de+Se*Se+ye*ye);let Nt;if(oe<0)l.x=It,l.y=Et,l.z=Qt,Nt=1;else if(oe>1)l.x=te,l.y=ne,l.z=_e,Nt=2;else{let Xe,Oe,oi;Xe=It+de*oe,Oe=Et+Se*oe,oi=Qt+ye*oe,l.x=Xe,l.y=Oe,l.z=oi,Nt=3}let ae=l.x*l.x+l.y*l.y+l.z*l.z;(we<0||ae<we)&&(Jt=Nt&1|(Nt&2)<<1,we=ae,Be=l.x,ve=l.y,qt=l.z)}let xe;if(we>0)l.x=Be,l.y=ve,l.z=qt,xe=Jt;else{let It=se*se+Ct*Ct+Gt*Gt;It>0&&(It=1/Math.sqrt(It)),se*=It,Ct*=It,Gt*=It;let Et=se*se+Ct*Ct+Gt*Gt;Et=(He*se+Je*Ct+Qe*Gt)/Et,Be=se*Et,ve=Ct*Et,qt=Gt*Et,l.x=Be,l.y=ve,l.z=qt,xe=7}let Kt=l.x*l.x+l.y*l.y+l.z*l.z;(he<0||Kt<he)&&(Si=xe&1|(xe&6)<<1,he=Kt,gi=l.x,bi=l.y,Mi=l.z)}if((Ft*Me+ie*fe+ee*ti)*yi<0){let He,Je,Qe,ci,hi,ei,ai,Ke,We,ke,le,ge,jt,Ae,Ze,Re,Te,Fe;He=Vt.x,Je=Vt.y,Qe=Vt.z,ci=At.x,hi=At.y,ei=At.z,ai=Xt.x,Ke=Xt.y,We=Xt.z,ke=ci-He,le=hi-Je,ge=ei-Qe,jt=ai-ci,Ae=Ke-hi,Ze=We-ei,Re=He-ai,Te=Je-Ke,Fe=Qe-We;let se,Ct,Gt;se=le*Ze-ge*Ae,Ct=ge*jt-ke*Ze,Gt=ke*Ae-le*jt;let Pe,Ve,Ue,ii,ri,mi,xi,ce,Ge;Pe=le*Gt-ge*Ct,Ve=ge*se-ke*Gt,Ue=ke*Ct-le*se,ii=Ae*Gt-Ze*Ct,ri=Ze*se-jt*Gt,mi=jt*Ct-Ae*se,xi=Te*Gt-Fe*Ct,ce=Fe*se-Re*Gt,Ge=Re*Ct-Te*se;let we=-1,Be,ve,qt,Jt=0;if(Be=0,ve=0,qt=0,He*Pe+Je*Ve+Qe*Ue<0){let It,Et,Qt,te,ne,_e;It=Vt.x,Et=Vt.y,Qt=Vt.z,te=At.x,ne=At.y,_e=At.z;let de,Se,ye;de=te-It,Se=ne-Et,ye=_e-Qt;let oe=de*It+Se*Et+ye*Qt;oe=-oe/(de*de+Se*Se+ye*ye);let Nt;if(oe<0)l.x=It,l.y=Et,l.z=Qt,Nt=1;else if(oe>1)l.x=te,l.y=ne,l.z=_e,Nt=2;else{let ae,Xe,Oe;ae=It+de*oe,Xe=Et+Se*oe,Oe=Qt+ye*oe,l.x=ae,l.y=Xe,l.z=Oe,Nt=3}Jt=Nt,we=l.x*l.x+l.y*l.y+l.z*l.z,Be=l.x,ve=l.y,qt=l.z}if(ci*ii+hi*ri+ei*mi<0){let It,Et,Qt,te,ne,_e;It=At.x,Et=At.y,Qt=At.z,te=Xt.x,ne=Xt.y,_e=Xt.z;let de,Se,ye;de=te-It,Se=ne-Et,ye=_e-Qt;let oe=de*It+Se*Et+ye*Qt;oe=-oe/(de*de+Se*Se+ye*ye);let Nt;if(oe<0)l.x=It,l.y=Et,l.z=Qt,Nt=1;else if(oe>1)l.x=te,l.y=ne,l.z=_e,Nt=2;else{let Xe,Oe,oi;Xe=It+de*oe,Oe=Et+Se*oe,oi=Qt+ye*oe,l.x=Xe,l.y=Oe,l.z=oi,Nt=3}let ae=l.x*l.x+l.y*l.y+l.z*l.z;(we<0||ae<we)&&(Jt=Nt<<1,we=ae,Be=l.x,ve=l.y,qt=l.z)}if(ai*xi+Ke*ce+We*Ge<0){let It,Et,Qt,te,ne,_e;It=Vt.x,Et=Vt.y,Qt=Vt.z,te=Xt.x,ne=Xt.y,_e=Xt.z;let de,Se,ye;de=te-It,Se=ne-Et,ye=_e-Qt;let oe=de*It+Se*Et+ye*Qt;oe=-oe/(de*de+Se*Se+ye*ye);let Nt;if(oe<0)l.x=It,l.y=Et,l.z=Qt,Nt=1;else if(oe>1)l.x=te,l.y=ne,l.z=_e,Nt=2;else{let Xe,Oe,oi;Xe=It+de*oe,Oe=Et+Se*oe,oi=Qt+ye*oe,l.x=Xe,l.y=Oe,l.z=oi,Nt=3}let ae=l.x*l.x+l.y*l.y+l.z*l.z;(we<0||ae<we)&&(Jt=Nt&1|(Nt&2)<<1,we=ae,Be=l.x,ve=l.y,qt=l.z)}let xe;if(we>0)l.x=Be,l.y=ve,l.z=qt,xe=Jt;else{let It=se*se+Ct*Ct+Gt*Gt;It>0&&(It=1/Math.sqrt(It)),se*=It,Ct*=It,Gt*=It;let Et=se*se+Ct*Ct+Gt*Gt;Et=(He*se+Je*Ct+Qe*Gt)/Et,Be=se*Et,ve=Ct*Et,qt=Gt*Et,l.x=Be,l.y=ve,l.z=qt,xe=7}let Kt=l.x*l.x+l.y*l.y+l.z*l.z;(he<0||Kt<he)&&(Si=xe&3|(xe&4)<<1,he=Kt,gi=l.x,bi=l.y,Mi=l.z)}if((Ye*di+Ie*Le+ue*_i)*yi<0){let He,Je,Qe,ci,hi,ei,ai,Ke,We,ke,le,ge,jt,Ae,Ze,Re,Te,Fe;He=At.x,Je=At.y,Qe=At.z,ci=St.x,hi=St.y,ei=St.z,ai=Xt.x,Ke=Xt.y,We=Xt.z,ke=ci-He,le=hi-Je,ge=ei-Qe,jt=ai-ci,Ae=Ke-hi,Ze=We-ei,Re=He-ai,Te=Je-Ke,Fe=Qe-We;let se,Ct,Gt;se=le*Ze-ge*Ae,Ct=ge*jt-ke*Ze,Gt=ke*Ae-le*jt;let Pe,Ve,Ue,ii,ri,mi,xi,ce,Ge;Pe=le*Gt-ge*Ct,Ve=ge*se-ke*Gt,Ue=ke*Ct-le*se,ii=Ae*Gt-Ze*Ct,ri=Ze*se-jt*Gt,mi=jt*Ct-Ae*se,xi=Te*Gt-Fe*Ct,ce=Fe*se-Re*Gt,Ge=Re*Ct-Te*se;let we=-1,Be,ve,qt,Jt=0;if(Be=0,ve=0,qt=0,He*Pe+Je*Ve+Qe*Ue<0){let It,Et,Qt,te,ne,_e;It=At.x,Et=At.y,Qt=At.z,te=St.x,ne=St.y,_e=St.z;let de,Se,ye;de=te-It,Se=ne-Et,ye=_e-Qt;let oe=de*It+Se*Et+ye*Qt;oe=-oe/(de*de+Se*Se+ye*ye);let Nt;if(oe<0)l.x=It,l.y=Et,l.z=Qt,Nt=1;else if(oe>1)l.x=te,l.y=ne,l.z=_e,Nt=2;else{let ae,Xe,Oe;ae=It+de*oe,Xe=Et+Se*oe,Oe=Qt+ye*oe,l.x=ae,l.y=Xe,l.z=Oe,Nt=3}Jt=Nt,we=l.x*l.x+l.y*l.y+l.z*l.z,Be=l.x,ve=l.y,qt=l.z}if(ci*ii+hi*ri+ei*mi<0){let It,Et,Qt,te,ne,_e;It=St.x,Et=St.y,Qt=St.z,te=Xt.x,ne=Xt.y,_e=Xt.z;let de,Se,ye;de=te-It,Se=ne-Et,ye=_e-Qt;let oe=de*It+Se*Et+ye*Qt;oe=-oe/(de*de+Se*Se+ye*ye);let Nt;if(oe<0)l.x=It,l.y=Et,l.z=Qt,Nt=1;else if(oe>1)l.x=te,l.y=ne,l.z=_e,Nt=2;else{let Xe,Oe,oi;Xe=It+de*oe,Oe=Et+Se*oe,oi=Qt+ye*oe,l.x=Xe,l.y=Oe,l.z=oi,Nt=3}let ae=l.x*l.x+l.y*l.y+l.z*l.z;(we<0||ae<we)&&(Jt=Nt<<1,we=ae,Be=l.x,ve=l.y,qt=l.z)}if(ai*xi+Ke*ce+We*Ge<0){let It,Et,Qt,te,ne,_e;It=At.x,Et=At.y,Qt=At.z,te=Xt.x,ne=Xt.y,_e=Xt.z;let de,Se,ye;de=te-It,Se=ne-Et,ye=_e-Qt;let oe=de*It+Se*Et+ye*Qt;oe=-oe/(de*de+Se*Se+ye*ye);let Nt;if(oe<0)l.x=It,l.y=Et,l.z=Qt,Nt=1;else if(oe>1)l.x=te,l.y=ne,l.z=_e,Nt=2;else{let Xe,Oe,oi;Xe=It+de*oe,Oe=Et+Se*oe,oi=Qt+ye*oe,l.x=Xe,l.y=Oe,l.z=oi,Nt=3}let ae=l.x*l.x+l.y*l.y+l.z*l.z;(we<0||ae<we)&&(Jt=Nt&1|(Nt&2)<<1,we=ae,Be=l.x,ve=l.y,qt=l.z)}let xe;if(we>0)l.x=Be,l.y=ve,l.z=qt,xe=Jt;else{let It=se*se+Ct*Ct+Gt*Gt;It>0&&(It=1/Math.sqrt(It)),se*=It,Ct*=It,Gt*=It;let Et=se*se+Ct*Ct+Gt*Gt;Et=(He*se+Je*Ct+Qe*Gt)/Et,Be=se*Et,ve=Ct*Et,qt=Gt*Et,l.x=Be,l.y=ve,l.z=qt,xe=7}let Kt=l.x*l.x+l.y*l.y+l.z*l.z;(he<0||Kt<he)&&(Si=xe<<1,he=Kt,gi=l.x,bi=l.y,Mi=l.z)}he>0?(l.x=gi,l.y=bi,l.z=Mi,p=Si):(l.zero(),p=15);break}if(l.x*l.x+l.y*l.y+l.z*l.z<1e-8){if(!o)return this.distance=0,0;switch(this.simplexSize){case 1:this.pointToTetrahedron();break;case 2:this.lineToTetrahedron();break;case 3:this.triangleToTetrahedron();break}if(this.simplexSize==4){let z=this.computeDepth(t,e,i,n,r,_,a);return z!=0?(this.distance=0,z):(this.distance=-this.depth,0)}return this.distance=0,1}this.shrinkSimplex(p),h.x=l.x,h.y=l.y,h.z=l.z,h.x=-h.x,h.y=-h.y,h.z=-h.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let g=this.s[this.simplexSize],x=this.w1[this.simplexSize];g.x=x.x,g.y=x.y,g.z=x.z;let b=this.w2[this.simplexSize];if(g.x-=b.x,g.y-=b.y,g.z-=b.z,h.x*h.x+h.y*h.y+h.z*h.z<1e-8)throw new Error("!?");let y=r[this.simplexSize];if(y.x*h.x+y.y*h.y+y.z*h.z-(l.x*h.x+l.y*h.y+l.z*h.z)<1e-8)return this.interpolateClosestPoints(),this.distance=Math.sqrt(l.x*l.x+l.y*l.y+l.z*l.z),s!=null&&s._gjkCache!=null&&this.saveCache(s._gjkCache),0;this.simplexSize++,++d}return 2}convexCastImpl(t,e,i,n,s,o,r){this.c1=t,this.c2=e,this.tf1=i,this.tf2=n;let _=this.s,a=this.closest,l=this.dir,h,u,f;if(h=n._positionX-i._positionX,u=n._positionY-i._positionY,f=n._positionZ-i._positionZ,l.x=h,l.y=u,l.z=f,l.x*l.x+l.y*l.y+l.z*l.z<1e-6&&l.init(1,0,0),this.simplexSize=0,this.c1!=null)this.computeWitnessPoint1(!0);else{let z=this.w1[this.simplexSize];z.x=this.tf1._positionX,z.y=this.tf1._positionY,z.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);let m=this.s[this.simplexSize],d=this.w1[this.simplexSize];m.x=d.x,m.y=d.y,m.z=d.z;let p=this.w2[this.simplexSize];m.x-=p.x,m.y-=p.y,m.z-=p.z,this.simplexSize=1;let g=0,x=0,b=this.rayX,y=this.rayR;for(b.zero(),y.x=o.x,y.y=o.y,y.z=o.z,y.x-=s.x,y.y-=s.y,y.z-=s.z;g<40;){let z=0;switch(this.simplexSize){case 1:let Z=_[0];a.x=Z.x,a.y=Z.y,a.z=Z.z,z=1;break;case 2:let L,E,T,P,N,R,k=_[0];L=k.x,E=k.y,T=k.z;let O=_[1];P=O.x,N=O.y,R=O.z;let v,D,B;v=P-L,D=N-E,B=R-T;let U=v*L+D*E+B*T;if(U=-U/(v*v+D*D+B*B),U<0)a.x=L,a.y=E,a.z=T,z=1;else if(U>1)a.x=P,a.y=N,a.z=R,z=2;else{let le,ge,jt;le=L+v*U,ge=E+D*U,jt=T+B*U,a.x=le,a.y=ge,a.z=jt,z=3}break;case 3:let q=_[0],tt=_[1],Q=_[2],nt,H,j,it,et,G,W,lt,ht,ft,pt,K,J,rt,mt,xt,vt,Mt;nt=q.x,H=q.y,j=q.z,it=tt.x,et=tt.y,G=tt.z,W=Q.x,lt=Q.y,ht=Q.z,ft=it-nt,pt=et-H,K=G-j,J=W-it,rt=lt-et,mt=ht-G,xt=nt-W,vt=H-lt,Mt=j-ht;let ut,Zt,zt;ut=pt*mt-K*rt,Zt=K*J-ft*mt,zt=ft*rt-pt*J;let dt,st,ct,_t,Vt,At,St,Xt,Ft;dt=pt*zt-K*Zt,st=K*ut-ft*zt,ct=ft*Zt-pt*ut,_t=rt*zt-mt*Zt,Vt=mt*ut-J*zt,At=J*Zt-rt*ut,St=vt*zt-Mt*Zt,Xt=Mt*ut-xt*zt,Ft=xt*Zt-vt*ut;let ie=-1,ee,Ye,Ie,ue=0;if(ee=0,Ye=0,Ie=0,nt*dt+H*st+j*ct<0){let le,ge,jt,Ae,Ze,Re;le=q.x,ge=q.y,jt=q.z,Ae=tt.x,Ze=tt.y,Re=tt.z;let Te,Fe,se;Te=Ae-le,Fe=Ze-ge,se=Re-jt;let Ct=Te*le+Fe*ge+se*jt;Ct=-Ct/(Te*Te+Fe*Fe+se*se);let Gt;if(Ct<0)a.x=le,a.y=ge,a.z=jt,Gt=1;else if(Ct>1)a.x=Ae,a.y=Ze,a.z=Re,Gt=2;else{let Pe,Ve,Ue;Pe=le+Te*Ct,Ve=ge+Fe*Ct,Ue=jt+se*Ct,a.x=Pe,a.y=Ve,a.z=Ue,Gt=3}ue=Gt,ie=a.x*a.x+a.y*a.y+a.z*a.z,ee=a.x,Ye=a.y,Ie=a.z}if(it*_t+et*Vt+G*At<0){let le,ge,jt,Ae,Ze,Re;le=tt.x,ge=tt.y,jt=tt.z,Ae=Q.x,Ze=Q.y,Re=Q.z;let Te,Fe,se;Te=Ae-le,Fe=Ze-ge,se=Re-jt;let Ct=Te*le+Fe*ge+se*jt;Ct=-Ct/(Te*Te+Fe*Fe+se*se);let Gt;if(Ct<0)a.x=le,a.y=ge,a.z=jt,Gt=1;else if(Ct>1)a.x=Ae,a.y=Ze,a.z=Re,Gt=2;else{let Ve,Ue,ii;Ve=le+Te*Ct,Ue=ge+Fe*Ct,ii=jt+se*Ct,a.x=Ve,a.y=Ue,a.z=ii,Gt=3}let Pe=a.x*a.x+a.y*a.y+a.z*a.z;(ie<0||Pe<ie)&&(ue=Gt<<1,ie=Pe,ee=a.x,Ye=a.y,Ie=a.z)}if(W*St+lt*Xt+ht*Ft<0){let le,ge,jt,Ae,Ze,Re;le=q.x,ge=q.y,jt=q.z,Ae=Q.x,Ze=Q.y,Re=Q.z;let Te,Fe,se;Te=Ae-le,Fe=Ze-ge,se=Re-jt;let Ct=Te*le+Fe*ge+se*jt;Ct=-Ct/(Te*Te+Fe*Fe+se*se);let Gt;if(Ct<0)a.x=le,a.y=ge,a.z=jt,Gt=1;else if(Ct>1)a.x=Ae,a.y=Ze,a.z=Re,Gt=2;else{let Ve,Ue,ii;Ve=le+Te*Ct,Ue=ge+Fe*Ct,ii=jt+se*Ct,a.x=Ve,a.y=Ue,a.z=ii,Gt=3}let Pe=a.x*a.x+a.y*a.y+a.z*a.z;(ie<0||Pe<ie)&&(ue=Gt&1|(Gt&2)<<1,ie=Pe,ee=a.x,Ye=a.y,Ie=a.z)}if(ie>0)a.x=ee,a.y=Ye,a.z=Ie,z=ue;else{let le=ut*ut+Zt*Zt+zt*zt;le>0&&(le=1/Math.sqrt(le)),ut*=le,Zt*=le,zt*=le;let ge=ut*ut+Zt*Zt+zt*zt;ge=(nt*ut+H*Zt+j*zt)/ge,ee=ut*ge,Ye=Zt*ge,Ie=zt*ge,a.x=ee,a.y=Ye,a.z=Ie,z=7}break;case 4:let $t=_[0],Ht=_[1],me=_[2],ze=_[3],qe,Ee,Ut,at,gt,yt,bt,ot,Pt,Dt,$,kt,Rt,Ot,Wt,Bt,re,Ce,be,Tt,Lt,Yt,pe,Me,fe,ti,di;qe=$t.x,Ee=$t.y,Ut=$t.z,at=Ht.x,gt=Ht.y,yt=Ht.z,bt=me.x,ot=me.y,Pt=me.z,Dt=ze.x,$=ze.y,kt=ze.z,Rt=at-qe,Ot=gt-Ee,Wt=yt-Ut,Bt=bt-qe,re=ot-Ee,Ce=Pt-Ut,be=Dt-qe,Tt=$-Ee,Lt=kt-Ut,Yt=bt-at,pe=ot-gt,Me=Pt-yt,fe=Dt-at,ti=$-gt,di=kt-yt;let Le,_i,yi,he,gi,bi,Mi,Si,He,Je,Qe,ci;Le=Ot*Ce-Wt*re,_i=Wt*Bt-Rt*Ce,yi=Rt*re-Ot*Bt,he=re*Lt-Ce*Tt,gi=Ce*be-Bt*Lt,bi=Bt*Tt-re*be,Mi=Tt*Wt-Lt*Ot,Si=Lt*Rt-be*Wt,He=be*Ot-Tt*Rt,Je=ti*Me-di*pe,Qe=di*Yt-fe*Me,ci=fe*pe-ti*Yt;let hi=Rt*Je+Ot*Qe+Wt*ci>0?1:-1,ei=-1,ai,Ke,We,ke=0;if(ai=0,Ke=0,We=0,(qe*Le+Ee*_i+Ut*yi)*hi<0){let le,ge,jt,Ae,Ze,Re,Te,Fe,se,Ct,Gt,Pe,Ve,Ue,ii,ri,mi,xi;le=$t.x,ge=$t.y,jt=$t.z,Ae=Ht.x,Ze=Ht.y,Re=Ht.z,Te=me.x,Fe=me.y,se=me.z,Ct=Ae-le,Gt=Ze-ge,Pe=Re-jt,Ve=Te-Ae,Ue=Fe-Ze,ii=se-Re,ri=le-Te,mi=ge-Fe,xi=jt-se;let ce,Ge,we;ce=Gt*ii-Pe*Ue,Ge=Pe*Ve-Ct*ii,we=Ct*Ue-Gt*Ve;let Be,ve,qt,Jt,xe,Kt,It,Et,Qt;Be=Gt*we-Pe*Ge,ve=Pe*ce-Ct*we,qt=Ct*Ge-Gt*ce,Jt=Ue*we-ii*Ge,xe=ii*ce-Ve*we,Kt=Ve*Ge-Ue*ce,It=mi*we-xi*Ge,Et=xi*ce-ri*we,Qt=ri*Ge-mi*ce;let te=-1,ne,_e,de,Se=0;if(ne=0,_e=0,de=0,le*Be+ge*ve+jt*qt<0){let oe,Nt,ae,Xe,Oe,oi;oe=$t.x,Nt=$t.y,ae=$t.z,Xe=Ht.x,Oe=Ht.y,oi=Ht.z;let ui,$e,si;ui=Xe-oe,$e=Oe-Nt,si=oi-ae;let je=ui*oe+$e*Nt+si*ae;je=-je/(ui*ui+$e*$e+si*si);let De;if(je<0)a.x=oe,a.y=Nt,a.z=ae,De=1;else if(je>1)a.x=Xe,a.y=Oe,a.z=oi,De=2;else{let pi,wi,Xi;pi=oe+ui*je,wi=Nt+$e*je,Xi=ae+si*je,a.x=pi,a.y=wi,a.z=Xi,De=3}Se=De,te=a.x*a.x+a.y*a.y+a.z*a.z,ne=a.x,_e=a.y,de=a.z}if(Ae*Jt+Ze*xe+Re*Kt<0){let oe,Nt,ae,Xe,Oe,oi;oe=Ht.x,Nt=Ht.y,ae=Ht.z,Xe=me.x,Oe=me.y,oi=me.z;let ui,$e,si;ui=Xe-oe,$e=Oe-Nt,si=oi-ae;let je=ui*oe+$e*Nt+si*ae;je=-je/(ui*ui+$e*$e+si*si);let De;if(je<0)a.x=oe,a.y=Nt,a.z=ae,De=1;else if(je>1)a.x=Xe,a.y=Oe,a.z=oi,De=2;else{let wi,Xi,Yi;wi=oe+ui*je,Xi=Nt+$e*je,Yi=ae+si*je,a.x=wi,a.y=Xi,a.z=Yi,De=3}let pi=a.x*a.x+a.y*a.y+a.z*a.z;(te<0||pi<te)&&(Se=De<<1,te=pi,ne=a.x,_e=a.y,de=a.z)}if(Te*It+Fe*Et+se*Qt<0){let oe,Nt,ae,Xe,Oe,oi;oe=$t.x,Nt=$t.y,ae=$t.z,Xe=me.x,Oe=me.y,oi=me.z;let ui,$e,si;ui=Xe-oe,$e=Oe-Nt,si=oi-ae;let je=ui*oe+$e*Nt+si*ae;je=-je/(ui*ui+$e*$e+si*si);let De;if(je<0)a.x=oe,a.y=Nt,a.z=ae,De=1;else if(je>1)a.x=Xe,a.y=Oe,a.z=oi,De=2;else{let wi,Xi,Yi;wi=oe+ui*je,Xi=Nt+$e*je,Yi=ae+si*je,a.x=wi,a.y=Xi,a.z=Yi,De=3}let pi=a.x*a.x+a.y*a.y+a.z*a.z;(te<0||pi<te)&&(Se=De&1|(De&2)<<1,te=pi,ne=a.x,_e=a.y,de=a.z)}let ye;if(te>0)a.x=ne,a.y=_e,a.z=de,ye=Se;else{let oe=ce*ce+Ge*Ge+we*we;oe>0&&(oe=1/Math.sqrt(oe)),ce*=oe,Ge*=oe,we*=oe;let Nt=ce*ce+Ge*Ge+we*we;Nt=(le*ce+ge*Ge+jt*we)/Nt,ne=ce*Nt,_e=Ge*Nt,de=we*Nt,a.x=ne,a.y=_e,a.z=de,ye=7}ke=ye,ei=a.x*a.x+a.y*a.y+a.z*a.z,ai=a.x,Ke=a.y,We=a.z}if((qe*he+Ee*gi+Ut*bi)*hi<0){let le,ge,jt,Ae,Ze,Re,Te,Fe,se,Ct,Gt,Pe,Ve,Ue,ii,ri,mi,xi;le=$t.x,ge=$t.y,jt=$t.z,Ae=me.x,Ze=me.y,Re=me.z,Te=ze.x,Fe=ze.y,se=ze.z,Ct=Ae-le,Gt=Ze-ge,Pe=Re-jt,Ve=Te-Ae,Ue=Fe-Ze,ii=se-Re,ri=le-Te,mi=ge-Fe,xi=jt-se;let ce,Ge,we;ce=Gt*ii-Pe*Ue,Ge=Pe*Ve-Ct*ii,we=Ct*Ue-Gt*Ve;let Be,ve,qt,Jt,xe,Kt,It,Et,Qt;Be=Gt*we-Pe*Ge,ve=Pe*ce-Ct*we,qt=Ct*Ge-Gt*ce,Jt=Ue*we-ii*Ge,xe=ii*ce-Ve*we,Kt=Ve*Ge-Ue*ce,It=mi*we-xi*Ge,Et=xi*ce-ri*we,Qt=ri*Ge-mi*ce;let te=-1,ne,_e,de,Se=0;if(ne=0,_e=0,de=0,le*Be+ge*ve+jt*qt<0){let Nt,ae,Xe,Oe,oi,ui;Nt=$t.x,ae=$t.y,Xe=$t.z,Oe=me.x,oi=me.y,ui=me.z;let $e,si,je;$e=Oe-Nt,si=oi-ae,je=ui-Xe;let De=$e*Nt+si*ae+je*Xe;De=-De/($e*$e+si*si+je*je);let pi;if(De<0)a.x=Nt,a.y=ae,a.z=Xe,pi=1;else if(De>1)a.x=Oe,a.y=oi,a.z=ui,pi=2;else{let wi,Xi,Yi;wi=Nt+$e*De,Xi=ae+si*De,Yi=Xe+je*De,a.x=wi,a.y=Xi,a.z=Yi,pi=3}Se=pi,te=a.x*a.x+a.y*a.y+a.z*a.z,ne=a.x,_e=a.y,de=a.z}if(Ae*Jt+Ze*xe+Re*Kt<0){let Nt,ae,Xe,Oe,oi,ui;Nt=me.x,ae=me.y,Xe=me.z,Oe=ze.x,oi=ze.y,ui=ze.z;let $e,si,je;$e=Oe-Nt,si=oi-ae,je=ui-Xe;let De=$e*Nt+si*ae+je*Xe;De=-De/($e*$e+si*si+je*je);let pi;if(De<0)a.x=Nt,a.y=ae,a.z=Xe,pi=1;else if(De>1)a.x=Oe,a.y=oi,a.z=ui,pi=2;else{let Xi,Yi,Di;Xi=Nt+$e*De,Yi=ae+si*De,Di=Xe+je*De,a.x=Xi,a.y=Yi,a.z=Di,pi=3}let wi=a.x*a.x+a.y*a.y+a.z*a.z;(te<0||wi<te)&&(Se=pi<<1,te=wi,ne=a.x,_e=a.y,de=a.z)}if(Te*It+Fe*Et+se*Qt<0){let Nt,ae,Xe,Oe,oi,ui;Nt=$t.x,ae=$t.y,Xe=$t.z,Oe=ze.x,oi=ze.y,ui=ze.z;let $e,si,je;$e=Oe-Nt,si=oi-ae,je=ui-Xe;let De=$e*Nt+si*ae+je*Xe;De=-De/($e*$e+si*si+je*je);let pi;if(De<0)a.x=Nt,a.y=ae,a.z=Xe,pi=1;else if(De>1)a.x=Oe,a.y=oi,a.z=ui,pi=2;else{let Xi,Yi,Di;Xi=Nt+$e*De,Yi=ae+si*De,Di=Xe+je*De,a.x=Xi,a.y=Yi,a.z=Di,pi=3}let wi=a.x*a.x+a.y*a.y+a.z*a.z;(te<0||wi<te)&&(Se=pi&1|(pi&2)<<1,te=wi,ne=a.x,_e=a.y,de=a.z)}let ye;if(te>0)a.x=ne,a.y=_e,a.z=de,ye=Se;else{let Nt=ce*ce+Ge*Ge+we*we;Nt>0&&(Nt=1/Math.sqrt(Nt)),ce*=Nt,Ge*=Nt,we*=Nt;let ae=ce*ce+Ge*Ge+we*we;ae=(le*ce+ge*Ge+jt*we)/ae,ne=ce*ae,_e=Ge*ae,de=we*ae,a.x=ne,a.y=_e,a.z=de,ye=7}let oe=a.x*a.x+a.y*a.y+a.z*a.z;(ei<0||oe<ei)&&(ke=ye&1|(ye&6)<<1,ei=oe,ai=a.x,Ke=a.y,We=a.z)}if((qe*Mi+Ee*Si+Ut*He)*hi<0){let le,ge,jt,Ae,Ze,Re,Te,Fe,se,Ct,Gt,Pe,Ve,Ue,ii,ri,mi,xi;le=$t.x,ge=$t.y,jt=$t.z,Ae=Ht.x,Ze=Ht.y,Re=Ht.z,Te=ze.x,Fe=ze.y,se=ze.z,Ct=Ae-le,Gt=Ze-ge,Pe=Re-jt,Ve=Te-Ae,Ue=Fe-Ze,ii=se-Re,ri=le-Te,mi=ge-Fe,xi=jt-se;let ce,Ge,we;ce=Gt*ii-Pe*Ue,Ge=Pe*Ve-Ct*ii,we=Ct*Ue-Gt*Ve;let Be,ve,qt,Jt,xe,Kt,It,Et,Qt;Be=Gt*we-Pe*Ge,ve=Pe*ce-Ct*we,qt=Ct*Ge-Gt*ce,Jt=Ue*we-ii*Ge,xe=ii*ce-Ve*we,Kt=Ve*Ge-Ue*ce,It=mi*we-xi*Ge,Et=xi*ce-ri*we,Qt=ri*Ge-mi*ce;let te=-1,ne,_e,de,Se=0;if(ne=0,_e=0,de=0,le*Be+ge*ve+jt*qt<0){let Nt,ae,Xe,Oe,oi,ui;Nt=$t.x,ae=$t.y,Xe=$t.z,Oe=Ht.x,oi=Ht.y,ui=Ht.z;let $e,si,je;$e=Oe-Nt,si=oi-ae,je=ui-Xe;let De=$e*Nt+si*ae+je*Xe;De=-De/($e*$e+si*si+je*je);let pi;if(De<0)a.x=Nt,a.y=ae,a.z=Xe,pi=1;else if(De>1)a.x=Oe,a.y=oi,a.z=ui,pi=2;else{let wi,Xi,Yi;wi=Nt+$e*De,Xi=ae+si*De,Yi=Xe+je*De,a.x=wi,a.y=Xi,a.z=Yi,pi=3}Se=pi,te=a.x*a.x+a.y*a.y+a.z*a.z,ne=a.x,_e=a.y,de=a.z}if(Ae*Jt+Ze*xe+Re*Kt<0){let Nt,ae,Xe,Oe,oi,ui;Nt=Ht.x,ae=Ht.y,Xe=Ht.z,Oe=ze.x,oi=ze.y,ui=ze.z;let $e,si,je;$e=Oe-Nt,si=oi-ae,je=ui-Xe;let De=$e*Nt+si*ae+je*Xe;De=-De/($e*$e+si*si+je*je);let pi;if(De<0)a.x=Nt,a.y=ae,a.z=Xe,pi=1;else if(De>1)a.x=Oe,a.y=oi,a.z=ui,pi=2;else{let Xi,Yi,Di;Xi=Nt+$e*De,Yi=ae+si*De,Di=Xe+je*De,a.x=Xi,a.y=Yi,a.z=Di,pi=3}let wi=a.x*a.x+a.y*a.y+a.z*a.z;(te<0||wi<te)&&(Se=pi<<1,te=wi,ne=a.x,_e=a.y,de=a.z)}if(Te*It+Fe*Et+se*Qt<0){let Nt,ae,Xe,Oe,oi,ui;Nt=$t.x,ae=$t.y,Xe=$t.z,Oe=ze.x,oi=ze.y,ui=ze.z;let $e,si,je;$e=Oe-Nt,si=oi-ae,je=ui-Xe;let De=$e*Nt+si*ae+je*Xe;De=-De/($e*$e+si*si+je*je);let pi;if(De<0)a.x=Nt,a.y=ae,a.z=Xe,pi=1;else if(De>1)a.x=Oe,a.y=oi,a.z=ui,pi=2;else{let Xi,Yi,Di;Xi=Nt+$e*De,Yi=ae+si*De,Di=Xe+je*De,a.x=Xi,a.y=Yi,a.z=Di,pi=3}let wi=a.x*a.x+a.y*a.y+a.z*a.z;(te<0||wi<te)&&(Se=pi&1|(pi&2)<<1,te=wi,ne=a.x,_e=a.y,de=a.z)}let ye;if(te>0)a.x=ne,a.y=_e,a.z=de,ye=Se;else{let Nt=ce*ce+Ge*Ge+we*we;Nt>0&&(Nt=1/Math.sqrt(Nt)),ce*=Nt,Ge*=Nt,we*=Nt;let ae=ce*ce+Ge*Ge+we*we;ae=(le*ce+ge*Ge+jt*we)/ae,ne=ce*ae,_e=Ge*ae,de=we*ae,a.x=ne,a.y=_e,a.z=de,ye=7}let oe=a.x*a.x+a.y*a.y+a.z*a.z;(ei<0||oe<ei)&&(ke=ye&3|(ye&4)<<1,ei=oe,ai=a.x,Ke=a.y,We=a.z)}if((at*Je+gt*Qe+yt*ci)*hi<0){let le,ge,jt,Ae,Ze,Re,Te,Fe,se,Ct,Gt,Pe,Ve,Ue,ii,ri,mi,xi;le=Ht.x,ge=Ht.y,jt=Ht.z,Ae=me.x,Ze=me.y,Re=me.z,Te=ze.x,Fe=ze.y,se=ze.z,Ct=Ae-le,Gt=Ze-ge,Pe=Re-jt,Ve=Te-Ae,Ue=Fe-Ze,ii=se-Re,ri=le-Te,mi=ge-Fe,xi=jt-se;let ce,Ge,we;ce=Gt*ii-Pe*Ue,Ge=Pe*Ve-Ct*ii,we=Ct*Ue-Gt*Ve;let Be,ve,qt,Jt,xe,Kt,It,Et,Qt;Be=Gt*we-Pe*Ge,ve=Pe*ce-Ct*we,qt=Ct*Ge-Gt*ce,Jt=Ue*we-ii*Ge,xe=ii*ce-Ve*we,Kt=Ve*Ge-Ue*ce,It=mi*we-xi*Ge,Et=xi*ce-ri*we,Qt=ri*Ge-mi*ce;let te=-1,ne,_e,de,Se=0;if(ne=0,_e=0,de=0,le*Be+ge*ve+jt*qt<0){let Nt,ae,Xe,Oe,oi,ui;Nt=Ht.x,ae=Ht.y,Xe=Ht.z,Oe=me.x,oi=me.y,ui=me.z;let $e,si,je;$e=Oe-Nt,si=oi-ae,je=ui-Xe;let De=$e*Nt+si*ae+je*Xe;De=-De/($e*$e+si*si+je*je);let pi;if(De<0)a.x=Nt,a.y=ae,a.z=Xe,pi=1;else if(De>1)a.x=Oe,a.y=oi,a.z=ui,pi=2;else{let wi,Xi,Yi;wi=Nt+$e*De,Xi=ae+si*De,Yi=Xe+je*De,a.x=wi,a.y=Xi,a.z=Yi,pi=3}Se=pi,te=a.x*a.x+a.y*a.y+a.z*a.z,ne=a.x,_e=a.y,de=a.z}if(Ae*Jt+Ze*xe+Re*Kt<0){let Nt,ae,Xe,Oe,oi,ui;Nt=me.x,ae=me.y,Xe=me.z,Oe=ze.x,oi=ze.y,ui=ze.z;let $e,si,je;$e=Oe-Nt,si=oi-ae,je=ui-Xe;let De=$e*Nt+si*ae+je*Xe;De=-De/($e*$e+si*si+je*je);let pi;if(De<0)a.x=Nt,a.y=ae,a.z=Xe,pi=1;else if(De>1)a.x=Oe,a.y=oi,a.z=ui,pi=2;else{let Xi,Yi,Di;Xi=Nt+$e*De,Yi=ae+si*De,Di=Xe+je*De,a.x=Xi,a.y=Yi,a.z=Di,pi=3}let wi=a.x*a.x+a.y*a.y+a.z*a.z;(te<0||wi<te)&&(Se=pi<<1,te=wi,ne=a.x,_e=a.y,de=a.z)}if(Te*It+Fe*Et+se*Qt<0){let Nt,ae,Xe,Oe,oi,ui;Nt=Ht.x,ae=Ht.y,Xe=Ht.z,Oe=ze.x,oi=ze.y,ui=ze.z;let $e,si,je;$e=Oe-Nt,si=oi-ae,je=ui-Xe;let De=$e*Nt+si*ae+je*Xe;De=-De/($e*$e+si*si+je*je);let pi;if(De<0)a.x=Nt,a.y=ae,a.z=Xe,pi=1;else if(De>1)a.x=Oe,a.y=oi,a.z=ui,pi=2;else{let Xi,Yi,Di;Xi=Nt+$e*De,Yi=ae+si*De,Di=Xe+je*De,a.x=Xi,a.y=Yi,a.z=Di,pi=3}let wi=a.x*a.x+a.y*a.y+a.z*a.z;(te<0||wi<te)&&(Se=pi&1|(pi&2)<<1,te=wi,ne=a.x,_e=a.y,de=a.z)}let ye;if(te>0)a.x=ne,a.y=_e,a.z=de,ye=Se;else{let Nt=ce*ce+Ge*Ge+we*we;Nt>0&&(Nt=1/Math.sqrt(Nt)),ce*=Nt,Ge*=Nt,we*=Nt;let ae=ce*ce+Ge*Ge+we*we;ae=(le*ce+ge*Ge+jt*we)/ae,ne=ce*ae,_e=Ge*ae,de=we*ae,a.x=ne,a.y=_e,a.z=de,ye=7}let oe=a.x*a.x+a.y*a.y+a.z*a.z;(ei<0||oe<ei)&&(ke=ye<<1,ei=oe,ai=a.x,Ke=a.y,We=a.z)}ei>0?(a.x=ai,a.y=Ke,a.z=We,z=ke):(a.zero(),z=15);break}if(this.shrinkSimplex(z),a.x*a.x+a.y*a.y+a.z*a.z<1e-8){if(x==0||this.simplexSize==4)return r.fraction=x,!1;this.interpolateClosestPoints(),r.fraction=x;let Z=r.normal;Z.x=l.x,Z.y=l.y,Z.z=l.z;let L=Math.sqrt(Z.x*Z.x+Z.y*Z.y+Z.z*Z.z);L>0&&(L=1/L),Z.x*=L,Z.y*=L,Z.z*=L;let E=r.position,T=this.closestPoint1;return E.x=T.x,E.y=T.y,E.z=T.z,E.x+=s.x*x,E.y+=s.y*x,E.z+=s.z*x,!0}if(l.x=a.x,l.y=a.y,l.z=a.z,l.x=-l.x,l.y=-l.y,l.z=-l.z,this.c1!=null)this.computeWitnessPoint1(!0);else{let Z=this.w1[this.simplexSize];Z.x=this.tf1._positionX,Z.y=this.tf1._positionY,Z.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);let M=this.s[this.simplexSize],Y=this.w1[this.simplexSize];M.x=Y.x,M.y=Y.y,M.z=Y.z;let X=this.w2[this.simplexSize];M.x-=X.x,M.y-=X.y,M.z-=X.z;let w=_[this.simplexSize];if(w.x-=b.x,w.y-=b.y,w.z-=b.z,l.x*l.x+l.y*l.y+l.z*l.z<1e-8)throw new Error("!?");let S=_[this.simplexSize],V=S.x*l.x+S.y*l.y+S.z*l.z;if(V<0){if(y.x*l.x+y.y*l.y+y.z*l.z>=0)return!1;let Z=V/(y.x*l.x+y.y*l.y+y.z*l.z);if(x+=Z,x>=1)return!1;b.x+=y.x*Z,b.y+=y.y*Z,b.z+=y.z*Z;let L=0,E=this.simplexSize+1;for(;L<E;){let T=_[L++],P=-Z;T.x+=y.x*P,T.y+=y.y*P,T.z+=y.z*P}}let F=!1,C=0,A=this.simplexSize;for(;C<A;){let Z=C++,L=_[Z].x-_[this.simplexSize].x,E=_[Z].y-_[this.simplexSize].y,T=_[Z].z-_[this.simplexSize].z;if(L*L+E*E+T*T<1e-8){F=!0;break}}F||this.simplexSize++,++g}return!1}interpolateClosestPoints(){switch(this.simplexSize){case 1:let t=this.closestPoint1,e=this.w1[0];t.x=e.x,t.y=e.y,t.z=e.z;let i=this.closestPoint2,n=this.w2[0];i.x=n.x,i.y=n.y,i.z=n.z;break;case 2:let s,o,r,_=this.closest;s=_.x,o=_.y,r=_.z;let a,l,h,u,f,m,d,p,g,x,b,y,z,M,Y,X,w,S,V=this.s[0];a=V.x,l=V.y,h=V.z;let F=this.w1[0];u=F.x,f=F.y,m=F.z;let C=this.w2[0];d=C.x,p=C.y,g=C.z;let A=this.s[1];x=A.x,b=A.y,y=A.z;let Z=this.w1[1];z=Z.x,M=Z.y,Y=Z.z;let L=this.w2[1];X=L.x,w=L.y,S=L.z;let E,T,P;E=x-a,T=b-l,P=y-h;let N=E*E+T*T+P*P;N!=0&&(N=1/N);let R,k,O;R=s-a,k=o-l,O=r-h;let v=(R*E+k*T+O*P)*N,D,B,U,q,tt,Q,nt,H,j;D=z-u,B=M-f,U=Y-m,q=u+D*v,tt=f+B*v,Q=m+U*v,D=X-d,B=w-p,U=S-g,nt=d+D*v,H=p+B*v,j=g+U*v;let it=this.closestPoint1;it.x=q,it.y=tt,it.z=Q;let et=this.closestPoint2;et.x=nt,et.y=H,et.z=j;break;case 3:let G,W,lt,ht=this.closest;G=ht.x,W=ht.y,lt=ht.z;let ft,pt,K,J,rt,mt,xt,vt,Mt,ut,Zt,zt,dt,st,ct,_t,Vt,At,St,Xt,Ft,ie,ee,Ye,Ie,ue,$t,Ht=this.s[0];ft=Ht.x,pt=Ht.y,K=Ht.z;let me=this.w1[0];J=me.x,rt=me.y,mt=me.z;let ze=this.w2[0];xt=ze.x,vt=ze.y,Mt=ze.z;let qe=this.s[1];ut=qe.x,Zt=qe.y,zt=qe.z;let Ee=this.w1[1];dt=Ee.x,st=Ee.y,ct=Ee.z;let Ut=this.w2[1];_t=Ut.x,Vt=Ut.y,At=Ut.z;let at=this.s[2];St=at.x,Xt=at.y,Ft=at.z;let gt=this.w1[2];ie=gt.x,ee=gt.y,Ye=gt.z;let yt=this.w2[2];Ie=yt.x,ue=yt.y,$t=yt.z;let bt,ot,Pt,Dt,$,kt,Rt,Ot,Wt;bt=ut-ft,ot=Zt-pt,Pt=zt-K,Dt=St-ft,$=Xt-pt,kt=Ft-K,Rt=G-ft,Ot=W-pt,Wt=lt-K;let Bt=bt*bt+ot*ot+Pt*Pt,re=bt*Dt+ot*$+Pt*kt,Ce=Dt*Dt+$*$+kt*kt,be=bt*Rt+ot*Ot+Pt*Wt,Tt=Dt*Rt+$*Ot+kt*Wt,Lt=Bt*Ce-re*re;Lt!=0&&(Lt=1/Lt);let Yt=(be*Ce-Tt*re)*Lt,pe=(-be*re+Tt*Bt)*Lt,Me,fe,ti,di,Le,_i,yi,he,gi;Me=dt-J,fe=st-rt,ti=ct-mt,di=J+Me*Yt,Le=rt+fe*Yt,_i=mt+ti*Yt,Me=ie-J,fe=ee-rt,ti=Ye-mt,di+=Me*pe,Le+=fe*pe,_i+=ti*pe,Me=_t-xt,fe=Vt-vt,ti=At-Mt,yi=xt+Me*Yt,he=vt+fe*Yt,gi=Mt+ti*Yt,Me=Ie-xt,fe=ue-vt,ti=$t-Mt,yi+=Me*pe,he+=fe*pe,gi+=ti*pe;let bi=this.closestPoint1;bi.x=di,bi.y=Le,bi.z=_i;let Mi=this.closestPoint2;Mi.x=yi,Mi.y=he,Mi.z=gi;break;default:throw new Error("!?")}}loadCache(t){let e=this.dir,i=t.prevClosestDir;e.x=i.x,e.y=i.y,e.z=i.z}saveCache(t){let e=t.prevClosestDir,i=this.closest;e.x=i.x,e.y=i.y,e.z=i.z,e.x=-e.x,e.y=-e.y,e.z=-e.z}shrinkSimplex(t){switch(this.simplexSize=t,this.simplexSize=(this.simplexSize&5)+(this.simplexSize>>1&5),this.simplexSize=(this.simplexSize&3)+(this.simplexSize>>2&3),t){case 2:let e=this.s[0],i=this.s[1];e.x=i.x,e.y=i.y,e.z=i.z;let n=this.w1[0],s=this.w1[1];n.x=s.x,n.y=s.y,n.z=s.z;let o=this.w2[0],r=this.w2[1];o.x=r.x,o.y=r.y,o.z=r.z;break;case 4:let _=this.s[0],a=this.s[2];_.x=a.x,_.y=a.y,_.z=a.z;let l=this.w1[0],h=this.w1[2];l.x=h.x,l.y=h.y,l.z=h.z;let u=this.w2[0],f=this.w2[2];u.x=f.x,u.y=f.y,u.z=f.z;break;case 5:let m=this.s[1],d=this.s[2];m.x=d.x,m.y=d.y,m.z=d.z;let p=this.w1[1],g=this.w1[2];p.x=g.x,p.y=g.y,p.z=g.z;let x=this.w2[1],b=this.w2[2];x.x=b.x,x.y=b.y,x.z=b.z;break;case 6:let y=this.s[0],z=this.s[2];y.x=z.x,y.y=z.y,y.z=z.z;let M=this.w1[0],Y=this.w1[2];M.x=Y.x,M.y=Y.y,M.z=Y.z;let X=this.w2[0],w=this.w2[2];X.x=w.x,X.y=w.y,X.z=w.z;break;case 8:let S=this.s[0],V=this.s[3];S.x=V.x,S.y=V.y,S.z=V.z;let F=this.w1[0],C=this.w1[3];F.x=C.x,F.y=C.y,F.z=C.z;let A=this.w2[0],Z=this.w2[3];A.x=Z.x,A.y=Z.y,A.z=Z.z;break;case 9:let L=this.s[1],E=this.s[3];L.x=E.x,L.y=E.y,L.z=E.z;let T=this.w1[1],P=this.w1[3];T.x=P.x,T.y=P.y,T.z=P.z;let N=this.w2[1],R=this.w2[3];N.x=R.x,N.y=R.y,N.z=R.z;break;case 10:let k=this.s[0],O=this.s[3];k.x=O.x,k.y=O.y,k.z=O.z;let v=this.w1[0],D=this.w1[3];v.x=D.x,v.y=D.y,v.z=D.z;let B=this.w2[0],U=this.w2[3];B.x=U.x,B.y=U.y,B.z=U.z;break;case 11:let q=this.s[2],tt=this.s[3];q.x=tt.x,q.y=tt.y,q.z=tt.z;let Q=this.w1[2],nt=this.w1[3];Q.x=nt.x,Q.y=nt.y,Q.z=nt.z;let H=this.w2[2],j=this.w2[3];H.x=j.x,H.y=j.y,H.z=j.z;break;case 12:let it=this.s[0],et=this.s[2];it.x=et.x,it.y=et.y,it.z=et.z;let G=this.w1[0],W=this.w1[2];G.x=W.x,G.y=W.y,G.z=W.z;let lt=this.w2[0],ht=this.w2[2];lt.x=ht.x,lt.y=ht.y,lt.z=ht.z;let ft=this.s[1],pt=this.s[3];ft.x=pt.x,ft.y=pt.y,ft.z=pt.z;let K=this.w1[1],J=this.w1[3];K.x=J.x,K.y=J.y,K.z=J.z;let rt=this.w2[1],mt=this.w2[3];rt.x=mt.x,rt.y=mt.y,rt.z=mt.z;break;case 13:let xt=this.s[1],vt=this.s[3];xt.x=vt.x,xt.y=vt.y,xt.z=vt.z;let Mt=this.w1[1],ut=this.w1[3];Mt.x=ut.x,Mt.y=ut.y,Mt.z=ut.z;let Zt=this.w2[1],zt=this.w2[3];Zt.x=zt.x,Zt.y=zt.y,Zt.z=zt.z;break;case 14:let dt=this.s[0],st=this.s[3];dt.x=st.x,dt.y=st.y,dt.z=st.z;let ct=this.w1[0],_t=this.w1[3];ct.x=_t.x,ct.y=_t.y,ct.z=_t.z;let Vt=this.w2[0],At=this.w2[3];Vt.x=At.x,Vt.y=At.y,Vt.z=At.z;break}}computeWitnessPoint1(t){let e,i,n,s,o,r,_=this.dir;s=_.x,o=_.y,r=_.z;let a,l,h,u,f,m;u=this.tf1._rotation00*s+this.tf1._rotation10*o+this.tf1._rotation20*r,f=this.tf1._rotation01*s+this.tf1._rotation11*o+this.tf1._rotation21*r,m=this.tf1._rotation02*s+this.tf1._rotation12*o+this.tf1._rotation22*r,a=u,l=f,h=m;let d,p,g,x=this.dir;if(x.x=a,x.y=l,x.z=h,this.c1.computeLocalSupportingVertex(this.dir,this.w1[this.simplexSize]),t){let w=this.dir,S=Math.sqrt(w.x*w.x+w.y*w.y+w.z*w.z);S>0&&(S=1/S),w.x*=S,w.y*=S,w.z*=S;let V=this.w1[this.simplexSize],F=this.dir,C=this.c1._gjkMargin;V.x+=F.x*C,V.y+=F.y*C,V.z+=F.z*C}let b=this.w1[this.simplexSize];e=b.x,i=b.y,n=b.z;let y,z,M;y=this.tf1._rotation00*e+this.tf1._rotation01*i+this.tf1._rotation02*n,z=this.tf1._rotation10*e+this.tf1._rotation11*i+this.tf1._rotation12*n,M=this.tf1._rotation20*e+this.tf1._rotation21*i+this.tf1._rotation22*n,d=y,p=z,g=M,d+=this.tf1._positionX,p+=this.tf1._positionY,g+=this.tf1._positionZ;let Y=this.w1[this.simplexSize];Y.x=d,Y.y=p,Y.z=g;let X=this.dir;X.x=s,X.y=o,X.z=r}computeWitnessPoint2(t){let e,i,n,s,o,r,_=this.dir;s=_.x,o=_.y,r=_.z;let a,l,h,u,f,m;u=this.tf2._rotation00*s+this.tf2._rotation10*o+this.tf2._rotation20*r,f=this.tf2._rotation01*s+this.tf2._rotation11*o+this.tf2._rotation21*r,m=this.tf2._rotation02*s+this.tf2._rotation12*o+this.tf2._rotation22*r,a=u,l=f,h=m,a=-a,l=-l,h=-h;let d,p,g,x=this.dir;if(x.x=a,x.y=l,x.z=h,this.c2.computeLocalSupportingVertex(this.dir,this.w2[this.simplexSize]),t){let w=this.dir,S=Math.sqrt(w.x*w.x+w.y*w.y+w.z*w.z);S>0&&(S=1/S),w.x*=S,w.y*=S,w.z*=S;let V=this.w2[this.simplexSize],F=this.dir,C=this.c2._gjkMargin;V.x+=F.x*C,V.y+=F.y*C,V.z+=F.z*C}let b=this.w2[this.simplexSize];e=b.x,i=b.y,n=b.z;let y,z,M;y=this.tf2._rotation00*e+this.tf2._rotation01*i+this.tf2._rotation02*n,z=this.tf2._rotation10*e+this.tf2._rotation11*i+this.tf2._rotation12*n,M=this.tf2._rotation20*e+this.tf2._rotation21*i+this.tf2._rotation22*n,d=y,p=z,g=M,d+=this.tf2._positionX,p+=this.tf2._positionY,g+=this.tf2._positionZ;let Y=this.w2[this.simplexSize];Y.x=d,Y.y=p,Y.z=g;let X=this.dir;X.x=s,X.y=o,X.z=r}pointToTetrahedron(){let t=0;for(;t<3;){let e=this.dir,i=this.baseDirs[t++];e.x=i.x,e.y=i.y,e.z=i.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let n=this.s[this.simplexSize],s=this.w1[this.simplexSize];n.x=s.x,n.y=s.y,n.z=s.z;let o=this.w2[this.simplexSize];if(n.x-=o.x,n.y-=o.y,n.z-=o.z,this.simplexSize++,this.lineToTetrahedron(),this.simplexSize==4)break;this.simplexSize--;let r=this.dir;r.x=-r.x,r.y=-r.y,r.z=-r.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let _=this.s[this.simplexSize],a=this.w1[this.simplexSize];_.x=a.x,_.y=a.y,_.z=a.z;let l=this.w2[this.simplexSize];if(_.x-=l.x,_.y-=l.y,_.z-=l.z,this.simplexSize++,this.lineToTetrahedron(),this.simplexSize==4)break;this.simplexSize--}}lineToTetrahedron(){let t,e,i,n=this.dir;t=n.x,e=n.y,i=n.z;let s,o,r,_,a,l,h,u,f,m=this.s[0];s=m.x,o=m.y,r=m.z;let d=this.s[1];_=d.x,a=d.y,l=d.z,h=s-_,u=o-a,f=r-l;let p=0;for(;p<3;){let x,b,y,z=this.baseDirs[p++];x=z.x,b=z.y,y=z.z;let M,Y,X;M=u*y-f*b,Y=f*x-h*y,X=h*b-u*x;let w=this.dir;w.x=M,w.y=Y,w.z=X,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let S=this.s[this.simplexSize],V=this.w1[this.simplexSize];S.x=V.x,S.y=V.y,S.z=V.z;let F=this.w2[this.simplexSize];if(S.x-=F.x,S.y-=F.y,S.z-=F.z,this.simplexSize++,this.triangleToTetrahedron(),this.simplexSize==4)break;this.simplexSize--;let C=this.dir;C.x=-C.x,C.y=-C.y,C.z=-C.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let A=this.s[this.simplexSize],Z=this.w1[this.simplexSize];A.x=Z.x,A.y=Z.y,A.z=Z.z;let L=this.w2[this.simplexSize];if(A.x-=L.x,A.y-=L.y,A.z-=L.z,this.simplexSize++,this.triangleToTetrahedron(),this.simplexSize==4)break;this.simplexSize--}let g=this.dir;g.x=t,g.y=e,g.z=i}triangleToTetrahedron(){let t,e,i,n=this.dir;for(t=n.x,e=n.y,i=n.z;;){let o,r,_,a,l,h,u,f,m,d,p,g,x,b,y,z=this.s[0];o=z.x,r=z.y,_=z.z;let M=this.s[1];a=M.x,l=M.y,h=M.z;let Y=this.s[2];u=Y.x,f=Y.y,m=Y.z,d=a-o,p=l-r,g=h-_,x=u-o,b=f-r,y=m-_;let X,w,S;X=p*y-g*b,w=g*x-d*y,S=d*b-p*x;let V=this.dir;V.x=X,V.y=w,V.z=S,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let F=this.s[this.simplexSize],C=this.w1[this.simplexSize];F.x=C.x,F.y=C.y,F.z=C.z;let A=this.w2[this.simplexSize];if(F.x-=A.x,F.y-=A.y,F.z-=A.z,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;let Z=this.dir;Z.x=-Z.x,Z.y=-Z.y,Z.z=-Z.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let L=this.s[this.simplexSize],E=this.w1[this.simplexSize];L.x=E.x,L.y=E.y,L.z=E.z;let T=this.w2[this.simplexSize];if(L.x-=T.x,L.y-=T.y,L.z-=T.z,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;break}let s=this.dir;s.x=t,s.y=e,s.z=i}isValidTetrahedron(){let t=this.s[2].x-this.s[0].x,e=this.s[2].y-this.s[0].y,i=this.s[2].z-this.s[0].z,n=this.s[3].x-this.s[0].x,s=this.s[3].y-this.s[0].y,o=this.s[3].z-this.s[0].z,r=(this.s[1].x-this.s[0].x)*(e*o-i*s)-(this.s[1].y-this.s[0].y)*(t*o-i*n)+(this.s[1].z-this.s[0].z)*(t*s-e*n);return r>1e-12?!0:r<-1e-12}computeDepth(t,e,i,n,s,o,r){let _=this.polyhedron;for(;_._numTriangles>0;){let w=_._triangleList;_._numTriangles--;let S=w._prev,V=w._next;S!=null&&(S._next=V),V!=null&&(V._prev=S),w==_._triangleList&&(_._triangleList=_._triangleList._next),w==_._triangleListLast&&(_._triangleListLast=_._triangleListLast._prev),w._next=null,w._prev=null,w.removeReferences(),w._next=_._trianglePool,_._trianglePool=w}for(;_._numVertices>0;){let w=_._vertices[--_._numVertices];w.removeReferences(),w._next=_._vertexPool,_._vertexPool=w}let a=this.polyhedron,l=this.polyhedron,h=l._vertexPool;h!=null?(l._vertexPool=h._next,h._next=null):h=new I.collision.narrowphase.detector.gjkepa.EpaVertex;let u=h.init(s[0],o[0],r[0]),f=this.polyhedron,m=f._vertexPool;m!=null?(f._vertexPool=m._next,m._next=null):m=new I.collision.narrowphase.detector.gjkepa.EpaVertex;let d=m.init(s[1],o[1],r[1]),p=this.polyhedron,g=p._vertexPool;g!=null?(p._vertexPool=g._next,g._next=null):g=new I.collision.narrowphase.detector.gjkepa.EpaVertex;let x=g.init(s[2],o[2],r[2]),b=this.polyhedron,y=b._vertexPool;if(y!=null?(b._vertexPool=y._next,y._next=null):y=new I.collision.narrowphase.detector.gjkepa.EpaVertex,!a._init(u,d,x,y.init(s[3],o[3],r[3])))return I.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT;this.simplexSize=0;let z=this.s[0],M=this.w1[0],Y=this.w2[0],X=0;for(;X<40;){let w=this.polyhedron._triangleList,S=1/0,V=null;for(;w!=null;)w._distanceSq<S&&(S=w._distanceSq,V=w),w=w._next;let F=V,C=this.dir,A=F._normal;C.x=A.x,C.y=A.y,C.z=A.z;let Z=Math.sqrt(C.x*C.x+C.y*C.y+C.z*C.z);Z>0&&(Z=1/Z),C.x*=Z,C.y*=Z,C.z*=Z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let L=this.s[this.simplexSize],E=this.w1[this.simplexSize];L.x=E.x,L.y=E.y,L.z=E.z;let T=this.w2[this.simplexSize];L.x-=T.x,L.y-=T.y,L.z-=T.z;let P=F._vertices[0],N=F._vertices[1],R=F._vertices[2],k=P.v,O=this.dir,v=this.dir;if(z.x*v.x+z.y*v.y+z.z*v.z-(k.x*O.x+k.y*O.y+k.z*O.z)<1e-6||X==39){let q=this.closest,tt=this.dir;q.x=tt.x,q.y=tt.y,q.z=tt.z;let Q=this.dir,nt=P.v,H=this.dir,j=(Q.x*nt.x+Q.y*nt.y+Q.z*nt.z)/(H.x*H.x+H.y*H.y+H.z*H.z);q.x*=j,q.y*=j,q.z*=j;let it,et,G,W=this.closest;it=W.x,et=W.y,G=W.z;let lt,ht,ft,pt,K,J,rt,mt,xt,vt,Mt,ut,Zt,zt,dt,st,ct,_t,Vt,At,St,Xt,Ft,ie,ee,Ye,Ie,ue=P.v;lt=ue.x,ht=ue.y,ft=ue.z;let $t=P.w1;pt=$t.x,K=$t.y,J=$t.z;let Ht=P.w2;rt=Ht.x,mt=Ht.y,xt=Ht.z;let me=N.v;vt=me.x,Mt=me.y,ut=me.z;let ze=N.w1;Zt=ze.x,zt=ze.y,dt=ze.z;let qe=N.w2;st=qe.x,ct=qe.y,_t=qe.z;let Ee=R.v;Vt=Ee.x,At=Ee.y,St=Ee.z;let Ut=R.w1;Xt=Ut.x,Ft=Ut.y,ie=Ut.z;let at=R.w2;ee=at.x,Ye=at.y,Ie=at.z;let gt,yt,bt,ot,Pt,Dt,$,kt,Rt;gt=vt-lt,yt=Mt-ht,bt=ut-ft,ot=Vt-lt,Pt=At-ht,Dt=St-ft,$=it-lt,kt=et-ht,Rt=G-ft;let Ot=gt*gt+yt*yt+bt*bt,Wt=gt*ot+yt*Pt+bt*Dt,Bt=ot*ot+Pt*Pt+Dt*Dt,re=gt*$+yt*kt+bt*Rt,Ce=ot*$+Pt*kt+Dt*Rt,be=Ot*Bt-Wt*Wt;be!=0&&(be=1/be);let Tt=(re*Bt-Ce*Wt)*be,Lt=(-re*Wt+Ce*Ot)*be,Yt,pe,Me,fe,ti,di,Le,_i,yi;Yt=Zt-pt,pe=zt-K,Me=dt-J,fe=pt+Yt*Tt,ti=K+pe*Tt,di=J+Me*Tt,Yt=Xt-pt,pe=Ft-K,Me=ie-J,fe+=Yt*Lt,ti+=pe*Lt,di+=Me*Lt,Yt=st-rt,pe=ct-mt,Me=_t-xt,Le=rt+Yt*Tt,_i=mt+pe*Tt,yi=xt+Me*Tt,Yt=ee-rt,pe=Ye-mt,Me=Ie-xt,Le+=Yt*Lt,_i+=pe*Lt,yi+=Me*Lt;let he=this.closestPoint1;he.x=fe,he.y=ti,he.z=di;let gi=this.closestPoint2;gi.x=Le,gi.y=_i,gi.z=yi;let bi=this.closest;return this.depth=Math.sqrt(bi.x*bi.x+bi.y*bi.y+bi.z*bi.z),I.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED}let D=this.polyhedron,B=D._vertexPool;B!=null?(D._vertexPool=B._next,B._next=null):B=new I.collision.narrowphase.detector.gjkepa.EpaVertex;let U=B.init(z,M,Y);if(!this.polyhedron._addVertex(U,F))return I.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX;++X}return I.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE}computeClosestPoints(t,e,i,n,s){return this.computeClosestPointsImpl(t,e,i,n,s,!0)}computeDistance(t,e,i,n,s){return this.computeClosestPointsImpl(t,e,i,n,s,!1)}convexCast(t,e,i,n,s,o,r){return this.convexCastImpl(t,e,i,n,s,o,r)}rayCast(t,e,i,n,s){let o=this.tempTransform;o._positionX=i.x,o._positionY=i.y,o._positionZ=i.z;let r=this.tl1,_=this.tl2;return r.x=n.x,r.y=n.y,r.z=n.z,r.x-=i.x,r.y-=i.y,r.z-=i.z,_.zero(),this.convexCastImpl(null,t,o,e,r,_,s)}static getInstance(){return I.collision.narrowphase.detector.gjkepa.GjkEpa.instance}};I.collision.narrowphase.detector.gjkepa.GjkEpaLog=class{};I.collision.narrowphase.detector.gjkepa.GjkEpaResultState=class{};I.collision.narrowphase.detector.gjkepa.SimplexUtil=class{static projectOrigin2(t,e,i){let n,s,o,r,_,a;n=t.x,s=t.y,o=t.z,r=e.x,_=e.y,a=e.z;let l,h,u;l=r-n,h=_-s,u=a-o;let f=l*n+h*s+u*o;if(f=-f/(l*l+h*h+u*u),f<0)return i.x=n,i.y=s,i.z=o,1;if(f>1)return i.x=r,i.y=_,i.z=a,2;let m,d,p;return m=n+l*f,d=s+h*f,p=o+u*f,i.x=m,i.y=d,i.z=p,3}static projectOrigin3(t,e,i,n){let s,o,r,_,a,l,h,u,f,m,d,p,g,x,b,y,z,M;s=t.x,o=t.y,r=t.z,_=e.x,a=e.y,l=e.z,h=i.x,u=i.y,f=i.z,m=_-s,d=a-o,p=l-r,g=h-_,x=u-a,b=f-l,y=s-h,z=o-u,M=r-f;let Y,X,w;Y=d*b-p*x,X=p*g-m*b,w=m*x-d*g;let S,V,F,C,A,Z,L,E,T;S=d*w-p*X,V=p*Y-m*w,F=m*X-d*Y,C=x*w-b*X,A=b*Y-g*w,Z=g*X-x*Y,L=z*w-M*X,E=M*Y-y*w,T=y*X-z*Y;let P=-1,N,R,k,O=0;if(N=0,R=0,k=0,s*S+o*V+r*F<0){let B,U,q,tt,Q,nt;B=t.x,U=t.y,q=t.z,tt=e.x,Q=e.y,nt=e.z;let H,j,it;H=tt-B,j=Q-U,it=nt-q;let et=H*B+j*U+it*q;et=-et/(H*H+j*j+it*it);let G;if(et<0)n.x=B,n.y=U,n.z=q,G=1;else if(et>1)n.x=tt,n.y=Q,n.z=nt,G=2;else{let W,lt,ht;W=B+H*et,lt=U+j*et,ht=q+it*et,n.x=W,n.y=lt,n.z=ht,G=3}O=G,P=n.x*n.x+n.y*n.y+n.z*n.z,N=n.x,R=n.y,k=n.z}if(_*C+a*A+l*Z<0){let B,U,q,tt,Q,nt;B=e.x,U=e.y,q=e.z,tt=i.x,Q=i.y,nt=i.z;let H,j,it;H=tt-B,j=Q-U,it=nt-q;let et=H*B+j*U+it*q;et=-et/(H*H+j*j+it*it);let G;if(et<0)n.x=B,n.y=U,n.z=q,G=1;else if(et>1)n.x=tt,n.y=Q,n.z=nt,G=2;else{let lt,ht,ft;lt=B+H*et,ht=U+j*et,ft=q+it*et,n.x=lt,n.y=ht,n.z=ft,G=3}let W=n.x*n.x+n.y*n.y+n.z*n.z;(P<0||W<P)&&(O=G<<1,P=W,N=n.x,R=n.y,k=n.z)}if(h*L+u*E+f*T<0){let B,U,q,tt,Q,nt;B=t.x,U=t.y,q=t.z,tt=i.x,Q=i.y,nt=i.z;let H,j,it;H=tt-B,j=Q-U,it=nt-q;let et=H*B+j*U+it*q;et=-et/(H*H+j*j+it*it);let G;if(et<0)n.x=B,n.y=U,n.z=q,G=1;else if(et>1)n.x=tt,n.y=Q,n.z=nt,G=2;else{let lt,ht,ft;lt=B+H*et,ht=U+j*et,ft=q+it*et,n.x=lt,n.y=ht,n.z=ft,G=3}let W=n.x*n.x+n.y*n.y+n.z*n.z;(P<0||W<P)&&(O=G&1|(G&2)<<1,P=W,N=n.x,R=n.y,k=n.z)}if(P>0)return n.x=N,n.y=R,n.z=k,O;let v=Y*Y+X*X+w*w;v>0&&(v=1/Math.sqrt(v)),Y*=v,X*=v,w*=v;let D=Y*Y+X*X+w*w;return D=(s*Y+o*X+r*w)/D,N=Y*D,R=X*D,k=w*D,n.x=N,n.y=R,n.z=k,7}static projectOrigin4(t,e,i,n,s){let o,r,_,a,l,h,u,f,m,d,p,g,x,b,y,z,M,Y,X,w,S,V,F,C,A,Z,L;o=t.x,r=t.y,_=t.z,a=e.x,l=e.y,h=e.z,u=i.x,f=i.y,m=i.z,d=n.x,p=n.y,g=n.z,x=a-o,b=l-r,y=h-_,z=u-o,M=f-r,Y=m-_,X=d-o,w=p-r,S=g-_,V=u-a,F=f-l,C=m-h,A=d-a,Z=p-l,L=g-h;let E,T,P,N,R,k,O,v,D,B,U,q;E=b*Y-y*M,T=y*z-x*Y,P=x*M-b*z,N=M*S-Y*w,R=Y*X-z*S,k=z*w-M*X,O=w*y-S*b,v=S*x-X*y,D=X*b-w*x,B=Z*C-L*F,U=L*V-A*C,q=A*F-Z*V;let tt=x*B+b*U+y*q>0?1:-1,Q=-1,nt,H,j,it=0;if(nt=0,H=0,j=0,(o*E+r*T+_*P)*tt<0){let et,G,W,lt,ht,ft,pt,K,J,rt,mt,xt,vt,Mt,ut,Zt,zt,dt;et=t.x,G=t.y,W=t.z,lt=e.x,ht=e.y,ft=e.z,pt=i.x,K=i.y,J=i.z,rt=lt-et,mt=ht-G,xt=ft-W,vt=pt-lt,Mt=K-ht,ut=J-ft,Zt=et-pt,zt=G-K,dt=W-J;let st,ct,_t;st=mt*ut-xt*Mt,ct=xt*vt-rt*ut,_t=rt*Mt-mt*vt;let Vt,At,St,Xt,Ft,ie,ee,Ye,Ie;Vt=mt*_t-xt*ct,At=xt*st-rt*_t,St=rt*ct-mt*st,Xt=Mt*_t-ut*ct,Ft=ut*st-vt*_t,ie=vt*ct-Mt*st,ee=zt*_t-dt*ct,Ye=dt*st-Zt*_t,Ie=Zt*ct-zt*st;let ue=-1,$t,Ht,me,ze=0;if($t=0,Ht=0,me=0,et*Vt+G*At+W*St<0){let Ee,Ut,at,gt,yt,bt;Ee=t.x,Ut=t.y,at=t.z,gt=e.x,yt=e.y,bt=e.z;let ot,Pt,Dt;ot=gt-Ee,Pt=yt-Ut,Dt=bt-at;let $=ot*Ee+Pt*Ut+Dt*at;$=-$/(ot*ot+Pt*Pt+Dt*Dt);let kt;if($<0)s.x=Ee,s.y=Ut,s.z=at,kt=1;else if($>1)s.x=gt,s.y=yt,s.z=bt,kt=2;else{let Rt,Ot,Wt;Rt=Ee+ot*$,Ot=Ut+Pt*$,Wt=at+Dt*$,s.x=Rt,s.y=Ot,s.z=Wt,kt=3}ze=kt,ue=s.x*s.x+s.y*s.y+s.z*s.z,$t=s.x,Ht=s.y,me=s.z}if(lt*Xt+ht*Ft+ft*ie<0){let Ee,Ut,at,gt,yt,bt;Ee=e.x,Ut=e.y,at=e.z,gt=i.x,yt=i.y,bt=i.z;let ot,Pt,Dt;ot=gt-Ee,Pt=yt-Ut,Dt=bt-at;let $=ot*Ee+Pt*Ut+Dt*at;$=-$/(ot*ot+Pt*Pt+Dt*Dt);let kt;if($<0)s.x=Ee,s.y=Ut,s.z=at,kt=1;else if($>1)s.x=gt,s.y=yt,s.z=bt,kt=2;else{let Ot,Wt,Bt;Ot=Ee+ot*$,Wt=Ut+Pt*$,Bt=at+Dt*$,s.x=Ot,s.y=Wt,s.z=Bt,kt=3}let Rt=s.x*s.x+s.y*s.y+s.z*s.z;(ue<0||Rt<ue)&&(ze=kt<<1,ue=Rt,$t=s.x,Ht=s.y,me=s.z)}if(pt*ee+K*Ye+J*Ie<0){let Ee,Ut,at,gt,yt,bt;Ee=t.x,Ut=t.y,at=t.z,gt=i.x,yt=i.y,bt=i.z;let ot,Pt,Dt;ot=gt-Ee,Pt=yt-Ut,Dt=bt-at;let $=ot*Ee+Pt*Ut+Dt*at;$=-$/(ot*ot+Pt*Pt+Dt*Dt);let kt;if($<0)s.x=Ee,s.y=Ut,s.z=at,kt=1;else if($>1)s.x=gt,s.y=yt,s.z=bt,kt=2;else{let Ot,Wt,Bt;Ot=Ee+ot*$,Wt=Ut+Pt*$,Bt=at+Dt*$,s.x=Ot,s.y=Wt,s.z=Bt,kt=3}let Rt=s.x*s.x+s.y*s.y+s.z*s.z;(ue<0||Rt<ue)&&(ze=kt&1|(kt&2)<<1,ue=Rt,$t=s.x,Ht=s.y,me=s.z)}let qe;if(ue>0)s.x=$t,s.y=Ht,s.z=me,qe=ze;else{let Ee=st*st+ct*ct+_t*_t;Ee>0&&(Ee=1/Math.sqrt(Ee)),st*=Ee,ct*=Ee,_t*=Ee;let Ut=st*st+ct*ct+_t*_t;Ut=(et*st+G*ct+W*_t)/Ut,$t=st*Ut,Ht=ct*Ut,me=_t*Ut,s.x=$t,s.y=Ht,s.z=me,qe=7}it=qe,Q=s.x*s.x+s.y*s.y+s.z*s.z,nt=s.x,H=s.y,j=s.z}if((o*N+r*R+_*k)*tt<0){let et,G,W,lt,ht,ft,pt,K,J,rt,mt,xt,vt,Mt,ut,Zt,zt,dt;et=t.x,G=t.y,W=t.z,lt=i.x,ht=i.y,ft=i.z,pt=n.x,K=n.y,J=n.z,rt=lt-et,mt=ht-G,xt=ft-W,vt=pt-lt,Mt=K-ht,ut=J-ft,Zt=et-pt,zt=G-K,dt=W-J;let st,ct,_t;st=mt*ut-xt*Mt,ct=xt*vt-rt*ut,_t=rt*Mt-mt*vt;let Vt,At,St,Xt,Ft,ie,ee,Ye,Ie;Vt=mt*_t-xt*ct,At=xt*st-rt*_t,St=rt*ct-mt*st,Xt=Mt*_t-ut*ct,Ft=ut*st-vt*_t,ie=vt*ct-Mt*st,ee=zt*_t-dt*ct,Ye=dt*st-Zt*_t,Ie=Zt*ct-zt*st;let ue=-1,$t,Ht,me,ze=0;if($t=0,Ht=0,me=0,et*Vt+G*At+W*St<0){let Ut,at,gt,yt,bt,ot;Ut=t.x,at=t.y,gt=t.z,yt=i.x,bt=i.y,ot=i.z;let Pt,Dt,$;Pt=yt-Ut,Dt=bt-at,$=ot-gt;let kt=Pt*Ut+Dt*at+$*gt;kt=-kt/(Pt*Pt+Dt*Dt+$*$);let Rt;if(kt<0)s.x=Ut,s.y=at,s.z=gt,Rt=1;else if(kt>1)s.x=yt,s.y=bt,s.z=ot,Rt=2;else{let Ot,Wt,Bt;Ot=Ut+Pt*kt,Wt=at+Dt*kt,Bt=gt+$*kt,s.x=Ot,s.y=Wt,s.z=Bt,Rt=3}ze=Rt,ue=s.x*s.x+s.y*s.y+s.z*s.z,$t=s.x,Ht=s.y,me=s.z}if(lt*Xt+ht*Ft+ft*ie<0){let Ut,at,gt,yt,bt,ot;Ut=i.x,at=i.y,gt=i.z,yt=n.x,bt=n.y,ot=n.z;let Pt,Dt,$;Pt=yt-Ut,Dt=bt-at,$=ot-gt;let kt=Pt*Ut+Dt*at+$*gt;kt=-kt/(Pt*Pt+Dt*Dt+$*$);let Rt;if(kt<0)s.x=Ut,s.y=at,s.z=gt,Rt=1;else if(kt>1)s.x=yt,s.y=bt,s.z=ot,Rt=2;else{let Wt,Bt,re;Wt=Ut+Pt*kt,Bt=at+Dt*kt,re=gt+$*kt,s.x=Wt,s.y=Bt,s.z=re,Rt=3}let Ot=s.x*s.x+s.y*s.y+s.z*s.z;(ue<0||Ot<ue)&&(ze=Rt<<1,ue=Ot,$t=s.x,Ht=s.y,me=s.z)}if(pt*ee+K*Ye+J*Ie<0){let Ut,at,gt,yt,bt,ot;Ut=t.x,at=t.y,gt=t.z,yt=n.x,bt=n.y,ot=n.z;let Pt,Dt,$;Pt=yt-Ut,Dt=bt-at,$=ot-gt;let kt=Pt*Ut+Dt*at+$*gt;kt=-kt/(Pt*Pt+Dt*Dt+$*$);let Rt;if(kt<0)s.x=Ut,s.y=at,s.z=gt,Rt=1;else if(kt>1)s.x=yt,s.y=bt,s.z=ot,Rt=2;else{let Wt,Bt,re;Wt=Ut+Pt*kt,Bt=at+Dt*kt,re=gt+$*kt,s.x=Wt,s.y=Bt,s.z=re,Rt=3}let Ot=s.x*s.x+s.y*s.y+s.z*s.z;(ue<0||Ot<ue)&&(ze=Rt&1|(Rt&2)<<1,ue=Ot,$t=s.x,Ht=s.y,me=s.z)}let qe;if(ue>0)s.x=$t,s.y=Ht,s.z=me,qe=ze;else{let Ut=st*st+ct*ct+_t*_t;Ut>0&&(Ut=1/Math.sqrt(Ut)),st*=Ut,ct*=Ut,_t*=Ut;let at=st*st+ct*ct+_t*_t;at=(et*st+G*ct+W*_t)/at,$t=st*at,Ht=ct*at,me=_t*at,s.x=$t,s.y=Ht,s.z=me,qe=7}let Ee=s.x*s.x+s.y*s.y+s.z*s.z;(Q<0||Ee<Q)&&(it=qe&1|(qe&6)<<1,Q=Ee,nt=s.x,H=s.y,j=s.z)}if((o*O+r*v+_*D)*tt<0){let et,G,W,lt,ht,ft,pt,K,J,rt,mt,xt,vt,Mt,ut,Zt,zt,dt;et=t.x,G=t.y,W=t.z,lt=e.x,ht=e.y,ft=e.z,pt=n.x,K=n.y,J=n.z,rt=lt-et,mt=ht-G,xt=ft-W,vt=pt-lt,Mt=K-ht,ut=J-ft,Zt=et-pt,zt=G-K,dt=W-J;let st,ct,_t;st=mt*ut-xt*Mt,ct=xt*vt-rt*ut,_t=rt*Mt-mt*vt;let Vt,At,St,Xt,Ft,ie,ee,Ye,Ie;Vt=mt*_t-xt*ct,At=xt*st-rt*_t,St=rt*ct-mt*st,Xt=Mt*_t-ut*ct,Ft=ut*st-vt*_t,ie=vt*ct-Mt*st,ee=zt*_t-dt*ct,Ye=dt*st-Zt*_t,Ie=Zt*ct-zt*st;let ue=-1,$t,Ht,me,ze=0;if($t=0,Ht=0,me=0,et*Vt+G*At+W*St<0){let Ut,at,gt,yt,bt,ot;Ut=t.x,at=t.y,gt=t.z,yt=e.x,bt=e.y,ot=e.z;let Pt,Dt,$;Pt=yt-Ut,Dt=bt-at,$=ot-gt;let kt=Pt*Ut+Dt*at+$*gt;kt=-kt/(Pt*Pt+Dt*Dt+$*$);let Rt;if(kt<0)s.x=Ut,s.y=at,s.z=gt,Rt=1;else if(kt>1)s.x=yt,s.y=bt,s.z=ot,Rt=2;else{let Ot,Wt,Bt;Ot=Ut+Pt*kt,Wt=at+Dt*kt,Bt=gt+$*kt,s.x=Ot,s.y=Wt,s.z=Bt,Rt=3}ze=Rt,ue=s.x*s.x+s.y*s.y+s.z*s.z,$t=s.x,Ht=s.y,me=s.z}if(lt*Xt+ht*Ft+ft*ie<0){let Ut,at,gt,yt,bt,ot;Ut=e.x,at=e.y,gt=e.z,yt=n.x,bt=n.y,ot=n.z;let Pt,Dt,$;Pt=yt-Ut,Dt=bt-at,$=ot-gt;let kt=Pt*Ut+Dt*at+$*gt;kt=-kt/(Pt*Pt+Dt*Dt+$*$);let Rt;if(kt<0)s.x=Ut,s.y=at,s.z=gt,Rt=1;else if(kt>1)s.x=yt,s.y=bt,s.z=ot,Rt=2;else{let Wt,Bt,re;Wt=Ut+Pt*kt,Bt=at+Dt*kt,re=gt+$*kt,s.x=Wt,s.y=Bt,s.z=re,Rt=3}let Ot=s.x*s.x+s.y*s.y+s.z*s.z;(ue<0||Ot<ue)&&(ze=Rt<<1,ue=Ot,$t=s.x,Ht=s.y,me=s.z)}if(pt*ee+K*Ye+J*Ie<0){let Ut,at,gt,yt,bt,ot;Ut=t.x,at=t.y,gt=t.z,yt=n.x,bt=n.y,ot=n.z;let Pt,Dt,$;Pt=yt-Ut,Dt=bt-at,$=ot-gt;let kt=Pt*Ut+Dt*at+$*gt;kt=-kt/(Pt*Pt+Dt*Dt+$*$);let Rt;if(kt<0)s.x=Ut,s.y=at,s.z=gt,Rt=1;else if(kt>1)s.x=yt,s.y=bt,s.z=ot,Rt=2;else{let Wt,Bt,re;Wt=Ut+Pt*kt,Bt=at+Dt*kt,re=gt+$*kt,s.x=Wt,s.y=Bt,s.z=re,Rt=3}let Ot=s.x*s.x+s.y*s.y+s.z*s.z;(ue<0||Ot<ue)&&(ze=Rt&1|(Rt&2)<<1,ue=Ot,$t=s.x,Ht=s.y,me=s.z)}let qe;if(ue>0)s.x=$t,s.y=Ht,s.z=me,qe=ze;else{let Ut=st*st+ct*ct+_t*_t;Ut>0&&(Ut=1/Math.sqrt(Ut)),st*=Ut,ct*=Ut,_t*=Ut;let at=st*st+ct*ct+_t*_t;at=(et*st+G*ct+W*_t)/at,$t=st*at,Ht=ct*at,me=_t*at,s.x=$t,s.y=Ht,s.z=me,qe=7}let Ee=s.x*s.x+s.y*s.y+s.z*s.z;(Q<0||Ee<Q)&&(it=qe&3|(qe&4)<<1,Q=Ee,nt=s.x,H=s.y,j=s.z)}if((a*B+l*U+h*q)*tt<0){let et,G,W,lt,ht,ft,pt,K,J,rt,mt,xt,vt,Mt,ut,Zt,zt,dt;et=e.x,G=e.y,W=e.z,lt=i.x,ht=i.y,ft=i.z,pt=n.x,K=n.y,J=n.z,rt=lt-et,mt=ht-G,xt=ft-W,vt=pt-lt,Mt=K-ht,ut=J-ft,Zt=et-pt,zt=G-K,dt=W-J;let st,ct,_t;st=mt*ut-xt*Mt,ct=xt*vt-rt*ut,_t=rt*Mt-mt*vt;let Vt,At,St,Xt,Ft,ie,ee,Ye,Ie;Vt=mt*_t-xt*ct,At=xt*st-rt*_t,St=rt*ct-mt*st,Xt=Mt*_t-ut*ct,Ft=ut*st-vt*_t,ie=vt*ct-Mt*st,ee=zt*_t-dt*ct,Ye=dt*st-Zt*_t,Ie=Zt*ct-zt*st;let ue=-1,$t,Ht,me,ze=0;if($t=0,Ht=0,me=0,et*Vt+G*At+W*St<0){let Ut,at,gt,yt,bt,ot;Ut=e.x,at=e.y,gt=e.z,yt=i.x,bt=i.y,ot=i.z;let Pt,Dt,$;Pt=yt-Ut,Dt=bt-at,$=ot-gt;let kt=Pt*Ut+Dt*at+$*gt;kt=-kt/(Pt*Pt+Dt*Dt+$*$);let Rt;if(kt<0)s.x=Ut,s.y=at,s.z=gt,Rt=1;else if(kt>1)s.x=yt,s.y=bt,s.z=ot,Rt=2;else{let Ot,Wt,Bt;Ot=Ut+Pt*kt,Wt=at+Dt*kt,Bt=gt+$*kt,s.x=Ot,s.y=Wt,s.z=Bt,Rt=3}ze=Rt,ue=s.x*s.x+s.y*s.y+s.z*s.z,$t=s.x,Ht=s.y,me=s.z}if(lt*Xt+ht*Ft+ft*ie<0){let Ut,at,gt,yt,bt,ot;Ut=i.x,at=i.y,gt=i.z,yt=n.x,bt=n.y,ot=n.z;let Pt,Dt,$;Pt=yt-Ut,Dt=bt-at,$=ot-gt;let kt=Pt*Ut+Dt*at+$*gt;kt=-kt/(Pt*Pt+Dt*Dt+$*$);let Rt;if(kt<0)s.x=Ut,s.y=at,s.z=gt,Rt=1;else if(kt>1)s.x=yt,s.y=bt,s.z=ot,Rt=2;else{let Wt,Bt,re;Wt=Ut+Pt*kt,Bt=at+Dt*kt,re=gt+$*kt,s.x=Wt,s.y=Bt,s.z=re,Rt=3}let Ot=s.x*s.x+s.y*s.y+s.z*s.z;(ue<0||Ot<ue)&&(ze=Rt<<1,ue=Ot,$t=s.x,Ht=s.y,me=s.z)}if(pt*ee+K*Ye+J*Ie<0){let Ut,at,gt,yt,bt,ot;Ut=e.x,at=e.y,gt=e.z,yt=n.x,bt=n.y,ot=n.z;let Pt,Dt,$;Pt=yt-Ut,Dt=bt-at,$=ot-gt;let kt=Pt*Ut+Dt*at+$*gt;kt=-kt/(Pt*Pt+Dt*Dt+$*$);let Rt;if(kt<0)s.x=Ut,s.y=at,s.z=gt,Rt=1;else if(kt>1)s.x=yt,s.y=bt,s.z=ot,Rt=2;else{let Wt,Bt,re;Wt=Ut+Pt*kt,Bt=at+Dt*kt,re=gt+$*kt,s.x=Wt,s.y=Bt,s.z=re,Rt=3}let Ot=s.x*s.x+s.y*s.y+s.z*s.z;(ue<0||Ot<ue)&&(ze=Rt&1|(Rt&2)<<1,ue=Ot,$t=s.x,Ht=s.y,me=s.z)}let qe;if(ue>0)s.x=$t,s.y=Ht,s.z=me,qe=ze;else{let Ut=st*st+ct*ct+_t*_t;Ut>0&&(Ut=1/Math.sqrt(Ut)),st*=Ut,ct*=Ut,_t*=Ut;let at=st*st+ct*ct+_t*_t;at=(et*st+G*ct+W*_t)/at,$t=st*at,Ht=ct*at,me=_t*at,s.x=$t,s.y=Ht,s.z=me,qe=7}let Ee=s.x*s.x+s.y*s.y+s.z*s.z;(Q<0||Ee<Q)&&(it=qe<<1,Q=Ee,nt=s.x,H=s.y,j=s.z)}return Q>0?(s.x=nt,s.y=H,s.z=j,it):(s.zero(),15)}};I.common.Mat3=class{constructor(t,e,i,n,s,o,r,_,a){a==null&&(a=1),_==null&&(_=0),r==null&&(r=0),o==null&&(o=0),s==null&&(s=1),n==null&&(n=0),i==null&&(i=0),e==null&&(e=0),t==null&&(t=1),this.e00=t,this.e01=e,this.e02=i,this.e10=n,this.e11=s,this.e12=o,this.e20=r,this.e21=_,this.e22=a,I.common.Mat3.numCreations++}init(t,e,i,n,s,o,r,_,a){return this.e00=t,this.e01=e,this.e02=i,this.e10=n,this.e11=s,this.e12=o,this.e20=r,this.e21=_,this.e22=a,this}identity(){return this.e00=1,this.e01=0,this.e02=0,this.e10=0,this.e11=1,this.e12=0,this.e20=0,this.e21=0,this.e22=1,this}add(t){return new I.common.Mat3(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22)}sub(t){return new I.common.Mat3(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22)}scale(t){return new I.common.Mat3(this.e00*t,this.e01*t,this.e02*t,this.e10*t,this.e11*t,this.e12*t,this.e20*t,this.e21*t,this.e22*t)}mul(t){return new I.common.Mat3(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22)}addEq(t){return this.e00+=t.e00,this.e01+=t.e01,this.e02+=t.e02,this.e10+=t.e10,this.e11+=t.e11,this.e12+=t.e12,this.e20+=t.e20,this.e21+=t.e21,this.e22+=t.e22,this}subEq(t){return this.e00-=t.e00,this.e01-=t.e01,this.e02-=t.e02,this.e10-=t.e10,this.e11-=t.e11,this.e12-=t.e12,this.e20-=t.e20,this.e21-=t.e21,this.e22-=t.e22,this}scaleEq(t){return this.e00*=t,this.e01*=t,this.e02*=t,this.e10*=t,this.e11*=t,this.e12*=t,this.e20*=t,this.e21*=t,this.e22*=t,this}mulEq(t){let e=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,i=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,n=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,s=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,o=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,r=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,_=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,a=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22;return this.e00=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,this.e01=e,this.e02=i,this.e10=n,this.e11=s,this.e12=o,this.e20=r,this.e21=_,this.e22=a,this}prependScale(t,e,i){return new I.common.Mat3(this.e00*t,this.e01*t,this.e02*t,this.e10*e,this.e11*e,this.e12*e,this.e20*i,this.e21*i,this.e22*i)}appendScale(t,e,i){return new I.common.Mat3(this.e00*t,this.e01*e,this.e02*i,this.e10*t,this.e11*e,this.e12*i,this.e20*t,this.e21*e,this.e22*i)}prependRotation(t,e,i,n){let s=Math.sin(t),o=Math.cos(t),r=1-o,_=e*e*r+o,a=e*i*r-n*s,l=e*n*r+i*s,h=i*e*r+n*s,u=i*i*r+o,f=i*n*r-e*s,m=n*e*r-i*s,d=n*i*r+e*s,p=n*n*r+o;return new I.common.Mat3(_*this.e00+a*this.e10+l*this.e20,_*this.e01+a*this.e11+l*this.e21,_*this.e02+a*this.e12+l*this.e22,h*this.e00+u*this.e10+f*this.e20,h*this.e01+u*this.e11+f*this.e21,h*this.e02+u*this.e12+f*this.e22,m*this.e00+d*this.e10+p*this.e20,m*this.e01+d*this.e11+p*this.e21,m*this.e02+d*this.e12+p*this.e22)}appendRotation(t,e,i,n){let s=Math.sin(t),o=Math.cos(t),r=1-o,_=e*e*r+o,a=e*i*r-n*s,l=e*n*r+i*s,h=i*e*r+n*s,u=i*i*r+o,f=i*n*r-e*s,m=n*e*r-i*s,d=n*i*r+e*s,p=n*n*r+o;return new I.common.Mat3(this.e00*_+this.e01*h+this.e02*m,this.e00*a+this.e01*u+this.e02*d,this.e00*l+this.e01*f+this.e02*p,this.e10*_+this.e11*h+this.e12*m,this.e10*a+this.e11*u+this.e12*d,this.e10*l+this.e11*f+this.e12*p,this.e20*_+this.e21*h+this.e22*m,this.e20*a+this.e21*u+this.e22*d,this.e20*l+this.e21*f+this.e22*p)}prependScaleEq(t,e,i){return this.e00*=t,this.e01*=t,this.e02*=t,this.e10*=e,this.e11*=e,this.e12*=e,this.e20*=i,this.e21*=i,this.e22*=i,this}appendScaleEq(t,e,i){return this.e00*=t,this.e01*=e,this.e02*=i,this.e10*=t,this.e11*=e,this.e12*=i,this.e20*=t,this.e21*=e,this.e22*=i,this}prependRotationEq(t,e,i,n){let s=Math.sin(t),o=Math.cos(t),r=1-o,_=e*e*r+o,a=e*i*r-n*s,l=e*n*r+i*s,h=i*e*r+n*s,u=i*i*r+o,f=i*n*r-e*s,m=n*e*r-i*s,d=n*i*r+e*s,p=n*n*r+o,g=h*this.e00+u*this.e10+f*this.e20,x=h*this.e01+u*this.e11+f*this.e21,b=h*this.e02+u*this.e12+f*this.e22,y=m*this.e00+d*this.e10+p*this.e20,z=m*this.e01+d*this.e11+p*this.e21,M=m*this.e02+d*this.e12+p*this.e22;return this.e00=_*this.e00+a*this.e10+l*this.e20,this.e01=_*this.e01+a*this.e11+l*this.e21,this.e02=_*this.e02+a*this.e12+l*this.e22,this.e10=g,this.e11=x,this.e12=b,this.e20=y,this.e21=z,this.e22=M,this}appendRotationEq(t,e,i,n){let s=Math.sin(t),o=Math.cos(t),r=1-o,_=e*e*r+o,a=e*i*r-n*s,l=e*n*r+i*s,h=i*e*r+n*s,u=i*i*r+o,f=i*n*r-e*s,m=n*e*r-i*s,d=n*i*r+e*s,p=n*n*r+o,g=this.e00*a+this.e01*u+this.e02*d,x=this.e00*l+this.e01*f+this.e02*p,b=this.e10*a+this.e11*u+this.e12*d,y=this.e10*l+this.e11*f+this.e12*p,z=this.e20*a+this.e21*u+this.e22*d,M=this.e20*l+this.e21*f+this.e22*p;return this.e00=this.e00*_+this.e01*h+this.e02*m,this.e01=g,this.e02=x,this.e10=this.e10*_+this.e11*h+this.e12*m,this.e11=b,this.e12=y,this.e20=this.e20*_+this.e21*h+this.e22*m,this.e21=z,this.e22=M,this}transpose(){return new I.common.Mat3(this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22)}transposeEq(){let t=this.e01,e=this.e02,i=this.e12;return this.e01=this.e10,this.e02=this.e20,this.e10=t,this.e12=this.e21,this.e20=e,this.e21=i,this}determinant(){return this.e00*(this.e11*this.e22-this.e12*this.e21)-this.e01*(this.e10*this.e22-this.e12*this.e20)+this.e02*(this.e10*this.e21-this.e11*this.e20)}trace(){return this.e00+this.e11+this.e22}inverse(){let t=this.e11*this.e22-this.e12*this.e21,e=this.e10*this.e22-this.e12*this.e20,i=this.e10*this.e21-this.e11*this.e20,n=this.e00*t-this.e01*e+this.e02*i;return n!=0&&(n=1/n),new I.common.Mat3(t*n,-(this.e01*this.e22-this.e02*this.e21)*n,(this.e01*this.e12-this.e02*this.e11)*n,-e*n,(this.e00*this.e22-this.e02*this.e20)*n,-(this.e00*this.e12-this.e02*this.e10)*n,i*n,-(this.e00*this.e21-this.e01*this.e20)*n,(this.e00*this.e11-this.e01*this.e10)*n)}inverseEq(){let t=this.e11*this.e22-this.e12*this.e21,e=this.e10*this.e22-this.e12*this.e20,i=this.e10*this.e21-this.e11*this.e20,n=this.e00*t-this.e01*e+this.e02*i;n!=0&&(n=1/n);let s=(this.e01*this.e12-this.e02*this.e11)*n,o=(this.e00*this.e22-this.e02*this.e20)*n,r=-(this.e00*this.e12-this.e02*this.e10)*n,_=-(this.e00*this.e21-this.e01*this.e20)*n,a=(this.e00*this.e11-this.e01*this.e10)*n;return this.e00=t*n,this.e01=-(this.e01*this.e22-this.e02*this.e21)*n,this.e02=s,this.e10=-e*n,this.e11=o,this.e12=r,this.e20=i*n,this.e21=_,this.e22=a,this}toArray(t){return t==null&&(t=!1),t?[this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22]:[this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22]}copyFrom(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this}clone(){return new I.common.Mat3(this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22)}fromQuat(t){let e=t.x,i=t.y,n=t.z,s=t.w,o=2*e,r=2*i,_=2*n,a=e*o,l=i*r,h=n*_,u=e*r,f=i*_,m=e*_,d=s*o,p=s*r,g=s*_;return this.e00=1-l-h,this.e01=u-g,this.e02=m+p,this.e10=u+g,this.e11=1-a-h,this.e12=f-d,this.e20=m-p,this.e21=f+d,this.e22=1-a-l,this}toQuat(){let t=new I.common.Quat,e=this.e00,i=this.e11,n=this.e22,s=e+i+n,o;return s>0?(o=Math.sqrt(s+1),t.w=.5*o,o=.5/o,t.x=(this.e21-this.e12)*o,t.y=(this.e02-this.e20)*o,t.z=(this.e10-this.e01)*o):e>i?e>n?(o=Math.sqrt(e-i-n+1),t.x=.5*o,o=.5/o,t.y=(this.e01+this.e10)*o,t.z=(this.e02+this.e20)*o,t.w=(this.e21-this.e12)*o):(o=Math.sqrt(n-e-i+1),t.z=.5*o,o=.5/o,t.x=(this.e02+this.e20)*o,t.y=(this.e12+this.e21)*o,t.w=(this.e10-this.e01)*o):i>n?(o=Math.sqrt(i-n-e+1),t.y=.5*o,o=.5/o,t.x=(this.e01+this.e10)*o,t.z=(this.e12+this.e21)*o,t.w=(this.e02-this.e20)*o):(o=Math.sqrt(n-e-i+1),t.z=.5*o,o=.5/o,t.x=(this.e02+this.e20)*o,t.y=(this.e12+this.e21)*o,t.w=(this.e10-this.e01)*o),t}fromEulerXyz(t){let e=Math.sin(t.x),i=Math.sin(t.y),n=Math.sin(t.z),s=Math.cos(t.x),o=Math.cos(t.y),r=Math.cos(t.z);return this.e00=o*r,this.e01=-o*n,this.e02=i,this.e10=s*n+r*e*i,this.e11=s*r-e*i*n,this.e12=-o*e,this.e20=e*n-s*r*i,this.e21=r*e+s*i*n,this.e22=s*o,this}toEulerXyz(){let t=this.e02;if(t<=-1){let e=Math.atan2(this.e21,this.e11);return new I.common.Vec3(e*.5,-1.570796326794895,-e*.5)}if(t>=1){let e=Math.atan2(this.e21,this.e11);return new I.common.Vec3(e*.5,1.570796326794895,e*.5)}return new I.common.Vec3(Math.atan2(-this.e12,this.e22),Math.asin(t),Math.atan2(-this.e01,this.e00))}getRow(t){return t==0?new I.common.Vec3(this.e00,this.e01,this.e02):t==1?new I.common.Vec3(this.e10,this.e11,this.e12):t==2?new I.common.Vec3(this.e20,this.e21,this.e22):null}getCol(t){return t==0?new I.common.Vec3(this.e00,this.e10,this.e20):t==1?new I.common.Vec3(this.e01,this.e11,this.e21):t==2?new I.common.Vec3(this.e02,this.e12,this.e22):null}getRowTo(t,e){t==0?e.init(this.e00,this.e01,this.e02):t==1?e.init(this.e10,this.e11,this.e12):t==2?e.init(this.e20,this.e21,this.e22):e.zero()}getColTo(t,e){t==0?e.init(this.e00,this.e10,this.e20):t==1?e.init(this.e01,this.e11,this.e21):t==2?e.init(this.e02,this.e12,this.e22):e.zero()}fromRows(t,e,i){return this.e00=t.x,this.e01=t.y,this.e02=t.z,this.e10=e.x,this.e11=e.y,this.e12=e.z,this.e20=i.x,this.e21=i.y,this.e22=i.z,this}fromCols(t,e,i){return this.e00=t.x,this.e01=e.x,this.e02=i.x,this.e10=t.y,this.e11=e.y,this.e12=i.y,this.e20=t.z,this.e21=e.z,this.e22=i.z,this}toString(){return"Mat3["+(this.e00>0?(this.e00*1e7+.5|0)/1e7:(this.e00*1e7-.5|0)/1e7)+", "+(this.e01>0?(this.e01*1e7+.5|0)/1e7:(this.e01*1e7-.5|0)/1e7)+", "+(this.e02>0?(this.e02*1e7+.5|0)/1e7:(this.e02*1e7-.5|0)/1e7)+`,
     `+(this.e10>0?(this.e10*1e7+.5|0)/1e7:(this.e10*1e7-.5|0)/1e7)+", "+(this.e11>0?(this.e11*1e7+.5|0)/1e7:(this.e11*1e7-.5|0)/1e7)+", "+(this.e12>0?(this.e12*1e7+.5|0)/1e7:(this.e12*1e7-.5|0)/1e7)+`,
     `+(this.e20>0?(this.e20*1e7+.5|0)/1e7:(this.e20*1e7-.5|0)/1e7)+", "+(this.e21>0?(this.e21*1e7+.5|0)/1e7:(this.e21*1e7-.5|0)/1e7)+", "+(this.e22>0?(this.e22*1e7+.5|0)/1e7:(this.e22*1e7-.5|0)/1e7)+"]"}};I.common.Mat4=class{constructor(t,e,i,n,s,o,r,_,a,l,h,u,f,m,d,p){p==null&&(p=1),d==null&&(d=0),m==null&&(m=0),f==null&&(f=0),u==null&&(u=0),h==null&&(h=1),l==null&&(l=0),a==null&&(a=0),_==null&&(_=0),r==null&&(r=0),o==null&&(o=1),s==null&&(s=0),n==null&&(n=0),i==null&&(i=0),e==null&&(e=0),t==null&&(t=1),this.e00=t,this.e01=e,this.e02=i,this.e03=n,this.e10=s,this.e11=o,this.e12=r,this.e13=_,this.e20=a,this.e21=l,this.e22=h,this.e23=u,this.e30=f,this.e31=m,this.e32=d,this.e33=p,I.common.Mat4.numCreations++}init(t,e,i,n,s,o,r,_,a,l,h,u,f,m,d,p){return this.e00=t,this.e01=e,this.e02=i,this.e03=n,this.e10=s,this.e11=o,this.e12=r,this.e13=_,this.e20=a,this.e21=l,this.e22=h,this.e23=u,this.e30=f,this.e31=m,this.e32=d,this.e33=p,this}identity(){return this.e00=1,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=1,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=1,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}add(t){return new I.common.Mat4(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e03+t.e03,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e13+t.e13,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22,this.e23+t.e23,this.e30+t.e30,this.e31+t.e31,this.e32+t.e32,this.e33+t.e33)}sub(t){return new I.common.Mat4(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e03-t.e03,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e13-t.e13,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22,this.e23-t.e23,this.e30-t.e30,this.e31-t.e31,this.e32-t.e32,this.e33-t.e33)}scale(t){return new I.common.Mat4(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*t,this.e11*t,this.e12*t,this.e13*t,this.e20*t,this.e21*t,this.e22*t,this.e23*t,this.e30*t,this.e31*t,this.e32*t,this.e33*t)}mul(t){return new I.common.Mat4(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33)}addEq(t){return this.e00+=t.e00,this.e01+=t.e01,this.e02+=t.e02,this.e03+=t.e03,this.e10+=t.e10,this.e11+=t.e11,this.e12+=t.e12,this.e13+=t.e13,this.e20+=t.e20,this.e21+=t.e21,this.e22+=t.e22,this.e23+=t.e23,this.e30+=t.e30,this.e31+=t.e31,this.e32+=t.e32,this.e33+=t.e33,this}subEq(t){return this.e00-=t.e00,this.e01-=t.e01,this.e02-=t.e02,this.e03-=t.e03,this.e10-=t.e10,this.e11-=t.e11,this.e12-=t.e12,this.e13-=t.e13,this.e20-=t.e20,this.e21-=t.e21,this.e22-=t.e22,this.e23-=t.e23,this.e30-=t.e30,this.e31-=t.e31,this.e32-=t.e32,this.e33-=t.e33,this}scaleEq(t){return this.e00*=t,this.e01*=t,this.e02*=t,this.e03*=t,this.e10*=t,this.e11*=t,this.e12*=t,this.e13*=t,this.e20*=t,this.e21*=t,this.e22*=t,this.e23*=t,this.e30*=t,this.e31*=t,this.e32*=t,this.e33*=t,this}mulEq(t){let e=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,i=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,n=this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,s=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,o=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,r=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,_=this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,a=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,l=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,h=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,u=this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,f=this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,m=this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,d=this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,p=this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33;return this.e00=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,this.e01=e,this.e02=i,this.e03=n,this.e10=s,this.e11=o,this.e12=r,this.e13=_,this.e20=a,this.e21=l,this.e22=h,this.e23=u,this.e30=f,this.e31=m,this.e32=d,this.e33=p,this}prependScale(t,e,i){return new I.common.Mat4(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*e,this.e11*e,this.e12*e,this.e13*e,this.e20*i,this.e21*i,this.e22*i,this.e23*i,this.e30,this.e31,this.e32,this.e33)}appendScale(t,e,i){return new I.common.Mat4(this.e00*t,this.e01*e,this.e02*i,this.e03,this.e10*t,this.e11*e,this.e12*i,this.e13,this.e20*t,this.e21*e,this.e22*i,this.e23,this.e30*t,this.e31*e,this.e32*i,this.e33)}prependRotation(t,e,i,n){let s=Math.sin(t),o=Math.cos(t),r=1-o,_=e*e*r+o,a=e*i*r-n*s,l=e*n*r+i*s,h=i*e*r+n*s,u=i*i*r+o,f=i*n*r-e*s,m=n*e*r-i*s,d=n*i*r+e*s,p=n*n*r+o;return new I.common.Mat4(_*this.e00+a*this.e10+l*this.e20,_*this.e01+a*this.e11+l*this.e21,_*this.e02+a*this.e12+l*this.e22,_*this.e03+a*this.e13+l*this.e23,h*this.e00+u*this.e10+f*this.e20,h*this.e01+u*this.e11+f*this.e21,h*this.e02+u*this.e12+f*this.e22,h*this.e03+u*this.e13+f*this.e23,m*this.e00+d*this.e10+p*this.e20,m*this.e01+d*this.e11+p*this.e21,m*this.e02+d*this.e12+p*this.e22,m*this.e03+d*this.e13+p*this.e23,this.e30,this.e31,this.e32,this.e33)}appendRotation(t,e,i,n){let s=Math.sin(t),o=Math.cos(t),r=1-o,_=e*e*r+o,a=e*i*r-n*s,l=e*n*r+i*s,h=i*e*r+n*s,u=i*i*r+o,f=i*n*r-e*s,m=n*e*r-i*s,d=n*i*r+e*s,p=n*n*r+o;return new I.common.Mat4(this.e00*_+this.e01*h+this.e02*m,this.e00*a+this.e01*u+this.e02*d,this.e00*l+this.e01*f+this.e02*p,this.e03,this.e10*_+this.e11*h+this.e12*m,this.e10*a+this.e11*u+this.e12*d,this.e10*l+this.e11*f+this.e12*p,this.e13,this.e20*_+this.e21*h+this.e22*m,this.e20*a+this.e21*u+this.e22*d,this.e20*l+this.e21*f+this.e22*p,this.e23,this.e30*_+this.e31*h+this.e32*m,this.e30*a+this.e31*u+this.e32*d,this.e30*l+this.e31*f+this.e32*p,this.e33)}prependTranslation(t,e,i){return new I.common.Mat4(this.e00+t*this.e30,this.e01+t*this.e31,this.e02+t*this.e32,this.e03+t*this.e33,this.e10+e*this.e30,this.e11+e*this.e31,this.e12+e*this.e32,this.e13+e*this.e33,this.e20+i*this.e30,this.e21+i*this.e31,this.e22+i*this.e32,this.e23+i*this.e33,this.e30,this.e31,this.e32,this.e33)}appendTranslation(t,e,i){return new I.common.Mat4(this.e00,this.e01,this.e02,this.e00*t+this.e01*e+this.e02*i+this.e03,this.e10,this.e11,this.e12,this.e10*t+this.e11*e+this.e12*i+this.e13,this.e20,this.e21,this.e22,this.e20*t+this.e21*e+this.e22*i+this.e23,this.e30,this.e31,this.e32,this.e30*t+this.e31*e+this.e32*i+this.e33)}prependScaleEq(t,e,i){return this.e00*=t,this.e01*=t,this.e02*=t,this.e03*=t,this.e10*=e,this.e11*=e,this.e12*=e,this.e13*=e,this.e20*=i,this.e21*=i,this.e22*=i,this.e23*=i,this}appendScaleEq(t,e,i){return this.e00*=t,this.e01*=e,this.e02*=i,this.e10*=t,this.e11*=e,this.e12*=i,this.e20*=t,this.e21*=e,this.e22*=i,this.e30*=t,this.e31*=e,this.e32*=i,this}prependRotationEq(t,e,i,n){let s=Math.sin(t),o=Math.cos(t),r=1-o,_=e*e*r+o,a=e*i*r-n*s,l=e*n*r+i*s,h=i*e*r+n*s,u=i*i*r+o,f=i*n*r-e*s,m=n*e*r-i*s,d=n*i*r+e*s,p=n*n*r+o,g=h*this.e00+u*this.e10+f*this.e20,x=h*this.e01+u*this.e11+f*this.e21,b=h*this.e02+u*this.e12+f*this.e22,y=h*this.e03+u*this.e13+f*this.e23,z=m*this.e00+d*this.e10+p*this.e20,M=m*this.e01+d*this.e11+p*this.e21,Y=m*this.e02+d*this.e12+p*this.e22,X=m*this.e03+d*this.e13+p*this.e23;return this.e00=_*this.e00+a*this.e10+l*this.e20,this.e01=_*this.e01+a*this.e11+l*this.e21,this.e02=_*this.e02+a*this.e12+l*this.e22,this.e03=_*this.e03+a*this.e13+l*this.e23,this.e10=g,this.e11=x,this.e12=b,this.e13=y,this.e20=z,this.e21=M,this.e22=Y,this.e23=X,this}appendRotationEq(t,e,i,n){let s=Math.sin(t),o=Math.cos(t),r=1-o,_=e*e*r+o,a=e*i*r-n*s,l=e*n*r+i*s,h=i*e*r+n*s,u=i*i*r+o,f=i*n*r-e*s,m=n*e*r-i*s,d=n*i*r+e*s,p=n*n*r+o,g=this.e00*a+this.e01*u+this.e02*d,x=this.e00*l+this.e01*f+this.e02*p,b=this.e10*a+this.e11*u+this.e12*d,y=this.e10*l+this.e11*f+this.e12*p,z=this.e20*a+this.e21*u+this.e22*d,M=this.e20*l+this.e21*f+this.e22*p,Y=this.e30*a+this.e31*u+this.e32*d,X=this.e30*l+this.e31*f+this.e32*p;return this.e00=this.e00*_+this.e01*h+this.e02*m,this.e01=g,this.e02=x,this.e10=this.e10*_+this.e11*h+this.e12*m,this.e11=b,this.e12=y,this.e20=this.e20*_+this.e21*h+this.e22*m,this.e21=z,this.e22=M,this.e30=this.e30*_+this.e31*h+this.e32*m,this.e31=Y,this.e32=X,this}prependTranslationEq(t,e,i){return this.e00+=t*this.e30,this.e01+=t*this.e31,this.e02+=t*this.e32,this.e03+=t*this.e33,this.e10+=e*this.e30,this.e11+=e*this.e31,this.e12+=e*this.e32,this.e13+=e*this.e33,this.e20+=i*this.e30,this.e21+=i*this.e31,this.e22+=i*this.e32,this.e23+=i*this.e33,this}appendTranslationEq(t,e,i){let n=this.e00*t+this.e01*e+this.e02*i+this.e03,s=this.e10*t+this.e11*e+this.e12*i+this.e13,o=this.e20*t+this.e21*e+this.e22*i+this.e23,r=this.e30*t+this.e31*e+this.e32*i+this.e33;return this.e03=n,this.e13=s,this.e23=o,this.e33=r,this}transpose(){return new I.common.Mat4(this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33)}transposeEq(){let t=this.e01,e=this.e02,i=this.e12,n=this.e03,s=this.e13,o=this.e23;return this.e01=this.e10,this.e02=this.e20,this.e03=this.e30,this.e10=t,this.e12=this.e21,this.e13=this.e31,this.e20=e,this.e21=i,this.e23=this.e32,this.e30=n,this.e31=s,this.e32=o,this}determinant(){let t=this.e20*this.e31-this.e21*this.e30,e=this.e20*this.e32-this.e22*this.e30,i=this.e20*this.e33-this.e23*this.e30,n=this.e21*this.e32-this.e22*this.e31,s=this.e21*this.e33-this.e23*this.e31,o=this.e22*this.e33-this.e23*this.e32;return this.e00*(this.e11*o-this.e12*s+this.e13*n)-this.e01*(this.e10*o-this.e12*i+this.e13*e)+this.e02*(this.e10*s-this.e11*i+this.e13*t)-this.e03*(this.e10*n-this.e11*e+this.e12*t)}trace(){return this.e00+this.e11+this.e22+this.e33}inverse(){let t=this.e00*this.e11-this.e01*this.e10,e=this.e00*this.e12-this.e02*this.e10,i=this.e00*this.e13-this.e03*this.e10,n=this.e01*this.e12-this.e02*this.e11,s=this.e01*this.e13-this.e03*this.e11,o=this.e02*this.e13-this.e03*this.e12,r=this.e20*this.e31-this.e21*this.e30,_=this.e20*this.e32-this.e22*this.e30,a=this.e20*this.e33-this.e23*this.e30,l=this.e21*this.e32-this.e22*this.e31,h=this.e21*this.e33-this.e23*this.e31,u=this.e22*this.e33-this.e23*this.e32,f=this.e11*u-this.e12*h+this.e13*l,m=this.e10*u-this.e12*a+this.e13*_,d=this.e10*h-this.e11*a+this.e13*r,p=this.e10*l-this.e11*_+this.e12*r,g=this.e00*f-this.e01*m+this.e02*d-this.e03*p;return g!=0&&(g=1/g),new I.common.Mat4(f*g,-(this.e01*u-this.e02*h+this.e03*l)*g,(this.e31*o-this.e32*s+this.e33*n)*g,-(this.e21*o-this.e22*s+this.e23*n)*g,-m*g,(this.e00*u-this.e02*a+this.e03*_)*g,-(this.e30*o-this.e32*i+this.e33*e)*g,(this.e20*o-this.e22*i+this.e23*e)*g,d*g,-(this.e00*h-this.e01*a+this.e03*r)*g,(this.e30*s-this.e31*i+this.e33*t)*g,-(this.e20*s-this.e21*i+this.e23*t)*g,-p*g,(this.e00*l-this.e01*_+this.e02*r)*g,-(this.e30*n-this.e31*e+this.e32*t)*g,(this.e20*n-this.e21*e+this.e22*t)*g)}inverseEq(){let t=this.e00*this.e11-this.e01*this.e10,e=this.e00*this.e12-this.e02*this.e10,i=this.e00*this.e13-this.e03*this.e10,n=this.e01*this.e12-this.e02*this.e11,s=this.e01*this.e13-this.e03*this.e11,o=this.e02*this.e13-this.e03*this.e12,r=this.e20*this.e31-this.e21*this.e30,_=this.e20*this.e32-this.e22*this.e30,a=this.e20*this.e33-this.e23*this.e30,l=this.e21*this.e32-this.e22*this.e31,h=this.e21*this.e33-this.e23*this.e31,u=this.e22*this.e33-this.e23*this.e32,f=this.e11*u-this.e12*h+this.e13*l,m=this.e10*u-this.e12*a+this.e13*_,d=this.e10*h-this.e11*a+this.e13*r,p=this.e10*l-this.e11*_+this.e12*r,g=this.e00*f-this.e01*m+this.e02*d-this.e03*p;g!=0&&(g=1/g);let x=(this.e00*u-this.e02*a+this.e03*_)*g,b=-(this.e00*h-this.e01*a+this.e03*r)*g,y=-(this.e20*s-this.e21*i+this.e23*t)*g,z=(this.e00*l-this.e01*_+this.e02*r)*g,M=-(this.e30*n-this.e31*e+this.e32*t)*g,Y=(this.e20*n-this.e21*e+this.e22*t)*g;return this.e00=f*g,this.e01=-(this.e01*u-this.e02*h+this.e03*l)*g,this.e02=(this.e31*o-this.e32*s+this.e33*n)*g,this.e03=-(this.e21*o-this.e22*s+this.e23*n)*g,this.e10=-m*g,this.e11=x,this.e12=-(this.e30*o-this.e32*i+this.e33*e)*g,this.e13=(this.e20*o-this.e22*i+this.e23*e)*g,this.e20=d*g,this.e21=b,this.e22=(this.e30*s-this.e31*i+this.e33*t)*g,this.e23=y,this.e30=-p*g,this.e31=z,this.e32=M,this.e33=Y,this}lookAt(t,e,i,n,s,o,r,_,a){let l=t-n,h=e-s,u=i-o,f=1/Math.sqrt(l*l+h*h+u*u);l*=f,h*=f,u*=f;let m=_*u-a*h,d=a*l-r*u,p=r*h-_*l;f=1/Math.sqrt(m*m+d*d+p*p),m*=f,d*=f,p*=f;let g=h*p-u*d,x=u*m-l*p,b=l*d-h*m;return this.e00=m,this.e01=d,this.e02=p,this.e03=-(m*t+d*e+p*i),this.e10=g,this.e11=x,this.e12=b,this.e13=-(g*t+x*e+b*i),this.e20=l,this.e21=h,this.e22=u,this.e23=-(l*t+h*e+u*i),this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}perspective(t,e,i,n){let s=1/Math.tan(t*.5),o=n/(i-n);return this.e00=s/e,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=s,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=o,this.e23=i*o,this.e30=0,this.e31=0,this.e32=-1,this.e33=0,this}ortho(t,e,i,n){let s=1/(i-n);return this.e00=2/t,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=2/e,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=s,this.e23=i*s,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}toArray(t){return t==null&&(t=!1),t?[this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33]:[this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33]}copyFrom(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e03=t.e03,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e13=t.e13,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this.e23=t.e23,this.e30=t.e30,this.e31=t.e31,this.e32=t.e32,this.e33=t.e33,this}fromMat3(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e03=0,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e13=0,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}fromTransform(t){return this.e00=t._rotation00,this.e01=t._rotation01,this.e02=t._rotation02,this.e10=t._rotation10,this.e11=t._rotation11,this.e12=t._rotation12,this.e20=t._rotation20,this.e21=t._rotation21,this.e22=t._rotation22,this.e03=t._positionX,this.e13=t._positionY,this.e23=t._positionZ,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}clone(){return new I.common.Mat4(this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33)}toString(){return"Mat4["+(this.e00>0?(this.e00*1e7+.5|0)/1e7:(this.e00*1e7-.5|0)/1e7)+", "+(this.e01>0?(this.e01*1e7+.5|0)/1e7:(this.e01*1e7-.5|0)/1e7)+", "+(this.e02>0?(this.e02*1e7+.5|0)/1e7:(this.e02*1e7-.5|0)/1e7)+", "+(this.e03>0?(this.e03*1e7+.5|0)/1e7:(this.e03*1e7-.5|0)/1e7)+`,
    `+(this.e10>0?(this.e10*1e7+.5|0)/1e7:(this.e10*1e7-.5|0)/1e7)+", "+(this.e11>0?(this.e11*1e7+.5|0)/1e7:(this.e11*1e7-.5|0)/1e7)+", "+(this.e12>0?(this.e12*1e7+.5|0)/1e7:(this.e12*1e7-.5|0)/1e7)+", "+(this.e13>0?(this.e13*1e7+.5|0)/1e7:(this.e13*1e7-.5|0)/1e7)+`,
    `+(this.e20>0?(this.e20*1e7+.5|0)/1e7:(this.e20*1e7-.5|0)/1e7)+", "+(this.e21>0?(this.e21*1e7+.5|0)/1e7:(this.e21*1e7-.5|0)/1e7)+", "+(this.e22>0?(this.e22*1e7+.5|0)/1e7:(this.e22*1e7-.5|0)/1e7)+", "+(this.e23>0?(this.e23*1e7+.5|0)/1e7:(this.e23*1e7-.5|0)/1e7)+`,
    `+(this.e30>0?(this.e30*1e7+.5|0)/1e7:(this.e30*1e7-.5|0)/1e7)+", "+(this.e31>0?(this.e31*1e7+.5|0)/1e7:(this.e31*1e7-.5|0)/1e7)+", "+(this.e32>0?(this.e32*1e7+.5|0)/1e7:(this.e32*1e7-.5|0)/1e7)+", "+(this.e33>0?(this.e33*1e7+.5|0)/1e7:(this.e33*1e7-.5|0)/1e7)+"]"}};I.common.MathUtil=class{static abs(t){return t>0?t:-t}static sin(t){return Math.sin(t)}static cos(t){return Math.cos(t)}static tan(t){return Math.tan(t)}static asin(t){return Math.asin(t)}static acos(t){return Math.acos(t)}static atan(t){return Math.atan(t)}static safeAsin(t){return t<=-1?-1.570796326794895:t>=1?1.570796326794895:Math.asin(t)}static safeAcos(t){return t<=-1?3.14159265358979:t>=1?0:Math.acos(t)}static atan2(t,e){return Math.atan2(t,e)}static sqrt(t){return Math.sqrt(t)}static clamp(t,e,i){return t<e?e:t>i?i:t}static rand(){return Math.random()}static randIn(t,e){return t+Math.random()*(e-t)}static randVec3In(t,e){return new I.common.Vec3(t+Math.random()*(e-t),t+Math.random()*(e-t),t+Math.random()*(e-t))}static randVec3(){return new I.common.Vec3(-1+Math.random()*2,-1+Math.random()*2,-1+Math.random()*2)}};I.common.Pool=class{constructor(){this.stackVec3=new Array(256),this.sizeVec3=0,this.stackMat3=new Array(256),this.sizeMat3=0,this.stackMat4=new Array(256),this.sizeMat4=0,this.stackQuat=new Array(256),this.sizeQuat=0}vec3(){return this.sizeVec3==0?new I.common.Vec3:this.stackVec3[--this.sizeVec3]}mat3(){return this.sizeMat3==0?new I.common.Mat3:this.stackMat3[--this.sizeMat3]}mat4(){return this.sizeMat4==0?new I.common.Mat4:this.stackMat4[--this.sizeMat4]}quat(){return this.sizeQuat==0?new I.common.Quat:this.stackQuat[--this.sizeQuat]}dispose(t,e,i,n){if(t!=null){if(t.zero(),this.sizeVec3==this.stackVec3.length){let s=new Array(this.sizeVec3<<1),o=0,r=this.sizeVec3;for(;o<r;){let _=o++;s[_]=this.stackVec3[_],this.stackVec3[_]=null}this.stackVec3=s}this.stackVec3[this.sizeVec3++]=t}if(e!=null){if(e.e00=1,e.e01=0,e.e02=0,e.e10=0,e.e11=1,e.e12=0,e.e20=0,e.e21=0,e.e22=1,this.sizeMat3==this.stackMat3.length){let s=new Array(this.sizeMat3<<1),o=0,r=this.sizeMat3;for(;o<r;){let _=o++;s[_]=this.stackMat3[_],this.stackMat3[_]=null}this.stackMat3=s}this.stackMat3[this.sizeMat3++]=e}if(i!=null){if(i.e00=1,i.e01=0,i.e02=0,i.e03=0,i.e10=0,i.e11=1,i.e12=0,i.e13=0,i.e20=0,i.e21=0,i.e22=1,i.e23=0,i.e30=0,i.e31=0,i.e32=0,i.e33=1,this.sizeMat4==this.stackMat4.length){let s=new Array(this.sizeMat4<<1),o=0,r=this.sizeMat4;for(;o<r;){let _=o++;s[_]=this.stackMat4[_],this.stackMat4[_]=null}this.stackMat4=s}this.stackMat4[this.sizeMat4++]=i}if(n!=null){if(n.x=0,n.y=0,n.z=0,n.w=1,this.sizeQuat==this.stackQuat.length){let s=new Array(this.sizeQuat<<1),o=0,r=this.sizeQuat;for(;o<r;){let _=o++;s[_]=this.stackQuat[_],this.stackQuat[_]=null}this.stackQuat=s}this.stackQuat[this.sizeQuat++]=n}}disposeVec3(t){if(t.zero(),this.sizeVec3==this.stackVec3.length){let e=new Array(this.sizeVec3<<1),i=0,n=this.sizeVec3;for(;i<n;){let s=i++;e[s]=this.stackVec3[s],this.stackVec3[s]=null}this.stackVec3=e}this.stackVec3[this.sizeVec3++]=t}disposeMat3(t){if(t.e00=1,t.e01=0,t.e02=0,t.e10=0,t.e11=1,t.e12=0,t.e20=0,t.e21=0,t.e22=1,this.sizeMat3==this.stackMat3.length){let e=new Array(this.sizeMat3<<1),i=0,n=this.sizeMat3;for(;i<n;){let s=i++;e[s]=this.stackMat3[s],this.stackMat3[s]=null}this.stackMat3=e}this.stackMat3[this.sizeMat3++]=t}disposeMat4(t){if(t.e00=1,t.e01=0,t.e02=0,t.e03=0,t.e10=0,t.e11=1,t.e12=0,t.e13=0,t.e20=0,t.e21=0,t.e22=1,t.e23=0,t.e30=0,t.e31=0,t.e32=0,t.e33=1,this.sizeMat4==this.stackMat4.length){let e=new Array(this.sizeMat4<<1),i=0,n=this.sizeMat4;for(;i<n;){let s=i++;e[s]=this.stackMat4[s],this.stackMat4[s]=null}this.stackMat4=e}this.stackMat4[this.sizeMat4++]=t}disposeQuat(t){if(t.x=0,t.y=0,t.z=0,t.w=1,this.sizeQuat==this.stackQuat.length){let e=new Array(this.sizeQuat<<1),i=0,n=this.sizeQuat;for(;i<n;){let s=i++;e[s]=this.stackQuat[s],this.stackQuat[s]=null}this.stackQuat=e}this.stackQuat[this.sizeQuat++]=t}};I.common.Quat=class{constructor(t,e,i,n){n==null&&(n=1),i==null&&(i=0),e==null&&(e=0),t==null&&(t=0),this.x=t,this.y=e,this.z=i,this.w=n,I.common.Quat.numCreations++}identity(){return this.x=0,this.y=0,this.z=0,this.w=1,this}init(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}add(t){return new I.common.Quat(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}sub(t){return new I.common.Quat(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)}scale(t){return new I.common.Quat(this.x*t,this.y*t,this.z*t,this.w*t)}addEq(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}subEq(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}scaleEq(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}normalized(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t>0&&(t=1/t),new I.common.Quat(this.x*t,this.y*t,this.z*t,this.w*t)}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t>0&&(t=1/t),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}setArc(t,e){let i=t.x,n=t.y,s=t.z,o=e.x,r=e.y,_=e.z,a=i*o+n*r+s*_;return this.w=Math.sqrt((1+a)*.5),this.w==0?(o=i*i,r=n*n,_=s*s,o<r?o<_?(a=1/Math.sqrt(r+_),this.x=0,this.y=s*a,this.z=-n*a):(a=1/Math.sqrt(o+r),this.z=0,this.x=n*a,this.y=-i*a):r<_?(a=1/Math.sqrt(_+o),this.y=0,this.z=i*a,this.x=-s*a):(a=1/Math.sqrt(o+r),this.z=0,this.x=n*a,this.y=-i*a),this):(a=.5/this.w,this.x=(n*_-s*r)*a,this.y=(s*o-i*_)*a,this.z=(i*r-n*o)*a,this)}slerp(t,e){let i,n,s,o,r=this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w;if(r<0?(r=-r,i=-t.x,n=-t.y,s=-t.z,o=-t.w):(i=t.x,n=t.y,s=t.z,o=t.w),r>.999999){let u=new I.common.Quat(this.x+(i-this.x)*e,this.y+(n-this.y)*e,this.z+(s-this.z)*e,this.w+(o-this.w)*e),f=Math.sqrt(u.x*u.x+u.y*u.y+u.z*u.z+u.w*u.w);return f>0&&(f=1/f),u.x*=f,u.y*=f,u.z*=f,u.w*=f,u}let _=e*Math.acos(r);i-=this.x*r,n-=this.y*r,s-=this.z*r,o-=this.w*r;let a=1/Math.sqrt(i*i+n*n+s*s+o*o);i*=a,n*=a,s*=a,o*=a;let l=Math.sin(_),h=Math.cos(_);return new I.common.Quat(this.x*h+i*l,this.y*h+n*l,this.z*h+s*l,this.w*h+o*l)}copyFrom(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}clone(){return new I.common.Quat(this.x,this.y,this.z,this.w)}fromMat3(t){let e=t.e00,i=t.e11,n=t.e22,s=e+i+n,o;return s>0?(o=Math.sqrt(s+1),this.w=.5*o,o=.5/o,this.x=(t.e21-t.e12)*o,this.y=(t.e02-t.e20)*o,this.z=(t.e10-t.e01)*o):e>i?e>n?(o=Math.sqrt(e-i-n+1),this.x=.5*o,o=.5/o,this.y=(t.e01+t.e10)*o,this.z=(t.e02+t.e20)*o,this.w=(t.e21-t.e12)*o):(o=Math.sqrt(n-e-i+1),this.z=.5*o,o=.5/o,this.x=(t.e02+t.e20)*o,this.y=(t.e12+t.e21)*o,this.w=(t.e10-t.e01)*o):i>n?(o=Math.sqrt(i-n-e+1),this.y=.5*o,o=.5/o,this.x=(t.e01+t.e10)*o,this.z=(t.e12+t.e21)*o,this.w=(t.e02-t.e20)*o):(o=Math.sqrt(n-e-i+1),this.z=.5*o,o=.5/o,this.x=(t.e02+t.e20)*o,this.y=(t.e12+t.e21)*o,this.w=(t.e10-t.e01)*o),this}toMat3(){let t=new I.common.Mat3,e=this.x,i=this.y,n=this.z,s=this.w,o=2*e,r=2*i,_=2*n,a=e*o,l=i*r,h=n*_,u=e*r,f=i*_,m=e*_,d=s*o,p=s*r,g=s*_;return t.e00=1-l-h,t.e01=u-g,t.e02=m+p,t.e10=u+g,t.e11=1-a-h,t.e12=f-d,t.e20=m-p,t.e21=f+d,t.e22=1-a-l,t}toString(){return"Quat["+(this.x>0?(this.x*1e7+.5|0)/1e7:(this.x*1e7-.5|0)/1e7)+` i,
    `+(this.y>0?(this.y*1e7+.5|0)/1e7:(this.y*1e7-.5|0)/1e7)+` j,
    `+(this.z>0?(this.z*1e7+.5|0)/1e7:(this.z*1e7-.5|0)/1e7)+` k,
    `+(this.w>0?(this.w*1e7+.5|0)/1e7:(this.w*1e7-.5|0)/1e7)+"]"}};I.dynamics||(I.dynamics={});I.dynamics.Contact=class{constructor(){this._next=null,this._prev=null,this._link1=new I.dynamics.ContactLink,this._link2=new I.dynamics.ContactLink,this._s1=null,this._s2=null,this._b1=null,this._b2=null,this._detector=null,this._cachedDetectorData=new I.collision.narrowphase.detector.CachedDetectorData,this._detectorResult=new I.collision.narrowphase.DetectorResult,this._latest=!1,this._shouldBeSkipped=!1,this._manifold=new I.dynamics.constraint.contact.Manifold,this._updater=new I.dynamics.constraint.contact.ManifoldUpdater(this._manifold),this._contactConstraint=new I.dynamics.constraint.contact.ContactConstraint(this._manifold),this._touching=!1}_updateManifold(){if(this._detector==null)return;let t=this._touching,e=this._detectorResult;if(this._detector.detect(e,this._s1._geom,this._s2._geom,this._s1._transform,this._s2._transform,this._cachedDetectorData),this._touching=e.numPoints>0,this._touching?(this._manifold._buildBasis(e.normal),e.getMaxDepth()>I.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold?this._contactConstraint._positionCorrectionAlgorithm=I.common.Setting.alternativeContactPositionCorrectionAlgorithm:this._contactConstraint._positionCorrectionAlgorithm=I.common.Setting.defaultContactPositionCorrectionAlgorithm,e.incremental?this._updater.incrementalUpdate(e,this._b1._transform,this._b2._transform):this._updater.totalUpdate(e,this._b1._transform,this._b2._transform)):this._manifold._clear(),this._touching&&!t){let i=this._s1._contactCallback,n=this._s2._contactCallback;i==n&&(n=null),i!=null&&i.beginContact(this),n!=null&&n.beginContact(this)}if(!this._touching&&t){let i=this._s1._contactCallback,n=this._s2._contactCallback;i==n&&(n=null),i!=null&&i.endContact(this),n!=null&&n.endContact(this)}if(this._touching){let i=this._s1._contactCallback,n=this._s2._contactCallback;i==n&&(n=null),i!=null&&i.preSolve(this),n!=null&&n.preSolve(this)}}_postSolve(){let t=this._s1._contactCallback,e=this._s2._contactCallback;t==e&&(e=null),t!=null&&t.postSolve(this),e!=null&&e.postSolve(this)}getShape1(){return this._s1}getShape2(){return this._s2}isTouching(){return this._touching}getManifold(){return this._manifold}getContactConstraint(){return this._contactConstraint}getPrev(){return this._prev}getNext(){return this._next}};I.dynamics.ContactLink=class{constructor(){this._prev=null,this._next=null,this._contact=null,this._other=null}getContact(){return this._contact}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}};I.dynamics.ContactManager=class{constructor(t){this._broadPhase=t,this._collisionMatrix=new I.collision.narrowphase.CollisionMatrix,this._numContacts=0}createContacts(){let t=this._broadPhase._proxyPairList;for(;t!=null;){let e=t._next;for(;;){let i,n;if(t._p1._id<t._p2._id?(i=t._p1.userData,n=t._p2.userData):(i=t._p2.userData,n=t._p1.userData),!this.shouldCollide(i,n))break;let s=i._rigidBody,o=n._rigidBody,r;s._numContactLinks<o._numContactLinks?r=s._contactLinkList:r=o._contactLinkList;let _=i._id,a=n._id,l=!1;for(;r!=null;){let h=r._contact;if(h._s1._id==_&&h._s2._id==a){h._latest=!0,l=!0;break}r=r._next}if(!l){let h=this._contactPool;h!=null?(this._contactPool=h._next,h._next=null):h=new I.dynamics.Contact;let u=h;this._contactList==null?(this._contactList=u,this._contactListLast=u):(this._contactListLast._next=u,u._prev=this._contactListLast,this._contactListLast=u),u._latest=!0;let f=this._collisionMatrix.detectors[i._geom._type][n._geom._type];u._s1=i,u._s2=n,u._b1=i._rigidBody,u._b2=n._rigidBody,u._touching=!1,u._b1._contactLinkList==null?(u._b1._contactLinkList=u._link1,u._b1._contactLinkListLast=u._link1):(u._b1._contactLinkListLast._next=u._link1,u._link1._prev=u._b1._contactLinkListLast,u._b1._contactLinkListLast=u._link1),u._b2._contactLinkList==null?(u._b2._contactLinkList=u._link2,u._b2._contactLinkListLast=u._link2):(u._b2._contactLinkListLast._next=u._link2,u._link2._prev=u._b2._contactLinkListLast,u._b2._contactLinkListLast=u._link2),u._b1._numContactLinks++,u._b2._numContactLinks++,u._link1._other=u._b2,u._link2._other=u._b1,u._link1._contact=u,u._link2._contact=u,u._detector=f;let m=u._contactConstraint;m._s1=i,m._s2=n,m._b1=m._s1._rigidBody,m._b2=m._s2._rigidBody,m._tf1=m._b1._transform,m._tf2=m._b2._transform,this._numContacts++}break}t=e}}destroyOutdatedContacts(){let t=this._broadPhase._incremental,e=this._contactList;for(;e!=null;){let i=e._next;for(;;){if(e._latest){e._latest=!1,e._shouldBeSkipped=!1;break}if(!t){let u=e._prev,f=e._next;if(u!=null&&(u._next=f),f!=null&&(f._prev=u),e==this._contactList&&(this._contactList=this._contactList._next),e==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),e._next=null,e._prev=null,e._touching){let b=e._s1._contactCallback,y=e._s2._contactCallback;b==y&&(y=null),b!=null&&b.endContact(e),y!=null&&y.endContact(e)}let m=e._link1._prev,d=e._link1._next;m!=null&&(m._next=d),d!=null&&(d._prev=m),e._link1==e._b1._contactLinkList&&(e._b1._contactLinkList=e._b1._contactLinkList._next),e._link1==e._b1._contactLinkListLast&&(e._b1._contactLinkListLast=e._b1._contactLinkListLast._prev),e._link1._next=null,e._link1._prev=null;let p=e._link2._prev,g=e._link2._next;p!=null&&(p._next=g),g!=null&&(g._prev=p),e._link2==e._b2._contactLinkList&&(e._b2._contactLinkList=e._b2._contactLinkList._next),e._link2==e._b2._contactLinkListLast&&(e._b2._contactLinkListLast=e._b2._contactLinkListLast._prev),e._link2._next=null,e._link2._prev=null,e._b1._numContactLinks--,e._b2._numContactLinks--,e._link1._other=null,e._link2._other=null,e._link1._contact=null,e._link2._contact=null,e._s1=null,e._s2=null,e._b1=null,e._b2=null,e._touching=!1,e._cachedDetectorData._clear(),e._manifold._clear(),e._detector=null;let x=e._contactConstraint;x._s1=null,x._s2=null,x._b1=null,x._b2=null,x._tf1=null,x._tf2=null,e._next=this._contactPool,this._contactPool=e,this._numContacts--;break}let n=e._s1,s=e._s2,o=n._rigidBody,r=s._rigidBody;if(!(!o._sleeping&&o._type!=1)&&!(!r._sleeping&&r._type!=1)){e._shouldBeSkipped=!0;break}let _=n._aabb,a=s._aabb,l=n._proxy,h=s._proxy;if(!(l._aabbMinX<h._aabbMaxX&&l._aabbMaxX>h._aabbMinX&&l._aabbMinY<h._aabbMaxY&&l._aabbMaxY>h._aabbMinY&&l._aabbMinZ<h._aabbMaxZ&&l._aabbMaxZ>h._aabbMinZ)||!this.shouldCollide(n,s)){let u=e._prev,f=e._next;if(u!=null&&(u._next=f),f!=null&&(f._prev=u),e==this._contactList&&(this._contactList=this._contactList._next),e==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),e._next=null,e._prev=null,e._touching){let b=e._s1._contactCallback,y=e._s2._contactCallback;b==y&&(y=null),b!=null&&b.endContact(e),y!=null&&y.endContact(e)}let m=e._link1._prev,d=e._link1._next;m!=null&&(m._next=d),d!=null&&(d._prev=m),e._link1==e._b1._contactLinkList&&(e._b1._contactLinkList=e._b1._contactLinkList._next),e._link1==e._b1._contactLinkListLast&&(e._b1._contactLinkListLast=e._b1._contactLinkListLast._prev),e._link1._next=null,e._link1._prev=null;let p=e._link2._prev,g=e._link2._next;p!=null&&(p._next=g),g!=null&&(g._prev=p),e._link2==e._b2._contactLinkList&&(e._b2._contactLinkList=e._b2._contactLinkList._next),e._link2==e._b2._contactLinkListLast&&(e._b2._contactLinkListLast=e._b2._contactLinkListLast._prev),e._link2._next=null,e._link2._prev=null,e._b1._numContactLinks--,e._b2._numContactLinks--,e._link1._other=null,e._link2._other=null,e._link1._contact=null,e._link2._contact=null,e._s1=null,e._s2=null,e._b1=null,e._b2=null,e._touching=!1,e._cachedDetectorData._clear(),e._manifold._clear(),e._detector=null;let x=e._contactConstraint;x._s1=null,x._s2=null,x._b1=null,x._b2=null,x._tf1=null,x._tf2=null,e._next=this._contactPool,this._contactPool=e,this._numContacts--;break}e._shouldBeSkipped=!(_._minX<a._maxX&&_._maxX>a._minX&&_._minY<a._maxY&&_._maxY>a._minY&&_._minZ<a._maxZ&&_._maxZ>a._minZ);break}e=i}}shouldCollide(t,e){let i=t._rigidBody,n=e._rigidBody;if(i==n||i._type!=0&&n._type!=0||(t._collisionGroup&e._collisionMask)==0||(e._collisionGroup&t._collisionMask)==0)return!1;let s,o;for(i._numJointLinks<n._numJointLinks?(s=i._jointLinkList,o=n):(s=n._jointLinkList,o=i);s!=null;){if(s._other==o&&!s._joint._allowCollision)return!1;s=s._next}return!0}_updateContacts(){this._broadPhase.collectPairs(),this.createContacts(),this.destroyOutdatedContacts()}_postSolve(){let t=this._contactList;for(;t!=null;){let e=t._next;t._touching&&t._postSolve(),t=e}}getNumContacts(){return this._numContacts}getContactList(){return this._contactList}};I.dynamics.Island=class{constructor(){this.rigidBodies=new Array(I.common.Setting.islandInitialRigidBodyArraySize),this.solvers=new Array(I.common.Setting.islandInitialConstraintArraySize),this.solversSi=new Array(I.common.Setting.islandInitialConstraintArraySize),this.solversNgs=new Array(I.common.Setting.islandInitialConstraintArraySize),this.numRigidBodies=0,this.numSolvers=0,this.numSolversSi=0,this.numSolversNgs=0}_clear(){for(;this.numRigidBodies>0;)this.rigidBodies[--this.numRigidBodies]=null;for(;this.numSolvers>0;)this.solvers[--this.numSolvers]=null;for(;this.numSolversSi>0;)this.solversSi[--this.numSolversSi]=null;for(;this.numSolversNgs>0;)this.solversNgs[--this.numSolversNgs]=null}_addRigidBody(t){if(this.numRigidBodies==this.rigidBodies.length){let e=new Array(this.numRigidBodies<<1),i=0,n=this.numRigidBodies;for(;i<n;){let s=i++;e[s]=this.rigidBodies[s],this.rigidBodies[s]=null}this.rigidBodies=e}t._addedToIsland=!0,this.rigidBodies[this.numRigidBodies++]=t}_addConstraintSolver(t,e){if(this.numSolvers==this.solvers.length){let i=new Array(this.numSolvers<<1),n=0,s=this.numSolvers;for(;n<s;){let o=n++;i[o]=this.solvers[o],this.solvers[o]=null}this.solvers=i}if(t._addedToIsland=!0,this.solvers[this.numSolvers++]=t,e==I.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE){if(this.numSolversSi==this.solversSi.length){let i=new Array(this.numSolversSi<<1),n=0,s=this.numSolversSi;for(;n<s;){let o=n++;i[o]=this.solversSi[o],this.solversSi[o]=null}this.solversSi=i}this.solversSi[this.numSolversSi++]=t}if(e==I.dynamics.constraint.PositionCorrectionAlgorithm.NGS){if(this.numSolversNgs==this.solversNgs.length){let i=new Array(this.numSolversNgs<<1),n=0,s=this.numSolversNgs;for(;n<s;){let o=n++;i[o]=this.solversNgs[o],this.solversNgs[o]=null}this.solversNgs=i}this.solversNgs[this.numSolversNgs++]=t}}_stepSingleRigidBody(t,e){let i=t.dt,n=e._ptransform,s=e._transform;if(n._positionX=s._positionX,n._positionY=s._positionY,n._positionZ=s._positionZ,n._rotation00=s._rotation00,n._rotation01=s._rotation01,n._rotation02=s._rotation02,n._rotation10=s._rotation10,n._rotation11=s._rotation11,n._rotation12=s._rotation12,n._rotation20=s._rotation20,n._rotation21=s._rotation21,n._rotation22=s._rotation22,e._linearContactImpulseX=0,e._linearContactImpulseY=0,e._linearContactImpulseZ=0,e._angularContactImpulseX=0,e._angularContactImpulseY=0,e._angularContactImpulseZ=0,e._autoSleep&&e._velX*e._velX+e._velY*e._velY+e._velZ*e._velZ<I.common.Setting.sleepingVelocityThreshold*I.common.Setting.sleepingVelocityThreshold&&e._angVelX*e._angVelX+e._angVelY*e._angVelY+e._angVelZ*e._angVelZ<I.common.Setting.sleepingAngularVelocityThreshold*I.common.Setting.sleepingAngularVelocityThreshold?(e._sleepTime+=i,e._sleepTime>I.common.Setting.sleepingTimeThreshold&&(e._sleeping=!0,e._sleepTime=0)):e._sleepTime=0,!e._sleeping){if(e._type==0){let r=i*e._linearDamping,_=r*r,a=1/(1+r+_*(.5+r*.16666666666666666+_*.041666666666666664)),l=i*e._angularDamping,h=l*l,u=1/(1+l+h*(.5+l*.16666666666666666+h*.041666666666666664)),f,m,d,p,g,x;f=this.gravityX*e._gravityScale,m=this.gravityY*e._gravityScale,d=this.gravityZ*e._gravityScale,f+=e._forceX*e._invMass,m+=e._forceY*e._invMass,d+=e._forceZ*e._invMass;let b,y,z;b=e._invInertia00*e._torqueX+e._invInertia01*e._torqueY+e._invInertia02*e._torqueZ,y=e._invInertia10*e._torqueX+e._invInertia11*e._torqueY+e._invInertia12*e._torqueZ,z=e._invInertia20*e._torqueX+e._invInertia21*e._torqueY+e._invInertia22*e._torqueZ,p=b,g=y,x=z,e._velX+=f*i,e._velY+=m*i,e._velZ+=d*i,e._velX*=a,e._velY*=a,e._velZ*=a,e._angVelX+=p*i,e._angVelY+=g*i,e._angVelZ+=x*i,e._angVelX*=u,e._angVelY*=u,e._angVelZ*=u}e._integrate(i);let o=e._shapeList;for(;o!=null;){let r=o._next,_=e._ptransform,a=e._transform,l=o._ptransform,h=o._localTransform,u,f,m,d,p,g,x,b,y;u=_._rotation00*h._rotation00+_._rotation01*h._rotation10+_._rotation02*h._rotation20,f=_._rotation00*h._rotation01+_._rotation01*h._rotation11+_._rotation02*h._rotation21,m=_._rotation00*h._rotation02+_._rotation01*h._rotation12+_._rotation02*h._rotation22,d=_._rotation10*h._rotation00+_._rotation11*h._rotation10+_._rotation12*h._rotation20,p=_._rotation10*h._rotation01+_._rotation11*h._rotation11+_._rotation12*h._rotation21,g=_._rotation10*h._rotation02+_._rotation11*h._rotation12+_._rotation12*h._rotation22,x=_._rotation20*h._rotation00+_._rotation21*h._rotation10+_._rotation22*h._rotation20,b=_._rotation20*h._rotation01+_._rotation21*h._rotation11+_._rotation22*h._rotation21,y=_._rotation20*h._rotation02+_._rotation21*h._rotation12+_._rotation22*h._rotation22,l._rotation00=u,l._rotation01=f,l._rotation02=m,l._rotation10=d,l._rotation11=p,l._rotation12=g,l._rotation20=x,l._rotation21=b,l._rotation22=y;let z,M,Y;z=_._rotation00*h._positionX+_._rotation01*h._positionY+_._rotation02*h._positionZ,M=_._rotation10*h._positionX+_._rotation11*h._positionY+_._rotation12*h._positionZ,Y=_._rotation20*h._positionX+_._rotation21*h._positionY+_._rotation22*h._positionZ,l._positionX=z,l._positionY=M,l._positionZ=Y,l._positionX+=_._positionX,l._positionY+=_._positionY,l._positionZ+=_._positionZ;let X=o._transform,w=o._localTransform,S,V,F,C,A,Z,L,E,T;S=a._rotation00*w._rotation00+a._rotation01*w._rotation10+a._rotation02*w._rotation20,V=a._rotation00*w._rotation01+a._rotation01*w._rotation11+a._rotation02*w._rotation21,F=a._rotation00*w._rotation02+a._rotation01*w._rotation12+a._rotation02*w._rotation22,C=a._rotation10*w._rotation00+a._rotation11*w._rotation10+a._rotation12*w._rotation20,A=a._rotation10*w._rotation01+a._rotation11*w._rotation11+a._rotation12*w._rotation21,Z=a._rotation10*w._rotation02+a._rotation11*w._rotation12+a._rotation12*w._rotation22,L=a._rotation20*w._rotation00+a._rotation21*w._rotation10+a._rotation22*w._rotation20,E=a._rotation20*w._rotation01+a._rotation21*w._rotation11+a._rotation22*w._rotation21,T=a._rotation20*w._rotation02+a._rotation21*w._rotation12+a._rotation22*w._rotation22,X._rotation00=S,X._rotation01=V,X._rotation02=F,X._rotation10=C,X._rotation11=A,X._rotation12=Z,X._rotation20=L,X._rotation21=E,X._rotation22=T;let P,N,R;P=a._rotation00*w._positionX+a._rotation01*w._positionY+a._rotation02*w._positionZ,N=a._rotation10*w._positionX+a._rotation11*w._positionY+a._rotation12*w._positionZ,R=a._rotation20*w._positionX+a._rotation21*w._positionY+a._rotation22*w._positionZ,X._positionX=P,X._positionY=N,X._positionZ=R,X._positionX+=a._positionX,X._positionY+=a._positionY,X._positionZ+=a._positionZ;let k,O,v,D,B,U;if(o._geom._computeAabb(o._aabb,o._ptransform),k=o._aabb._minX,O=o._aabb._minY,v=o._aabb._minZ,D=o._aabb._maxX,B=o._aabb._maxY,U=o._aabb._maxZ,o._geom._computeAabb(o._aabb,o._transform),o._aabb._minX=k<o._aabb._minX?k:o._aabb._minX,o._aabb._minY=O<o._aabb._minY?O:o._aabb._minY,o._aabb._minZ=v<o._aabb._minZ?v:o._aabb._minZ,o._aabb._maxX=D>o._aabb._maxX?D:o._aabb._maxX,o._aabb._maxY=B>o._aabb._maxY?B:o._aabb._maxY,o._aabb._maxZ=U>o._aabb._maxZ?U:o._aabb._maxZ,o._proxy!=null){let q,tt,Q;q=o._transform._positionX-o._ptransform._positionX,tt=o._transform._positionY-o._ptransform._positionY,Q=o._transform._positionZ-o._ptransform._positionZ;let nt=o.displacement;nt.x=q,nt.y=tt,nt.z=Q,o._rigidBody._world._broadPhase.moveProxy(o._proxy,o._aabb,o.displacement)}o=r}}}_step(t,e,i){let n=t.dt,s=!0,o=0,r=this.numRigidBodies;for(;o<r;){let C=this.rigidBodies[o++],A=C._ptransform,Z=C._transform;if(A._positionX=Z._positionX,A._positionY=Z._positionY,A._positionZ=Z._positionZ,A._rotation00=Z._rotation00,A._rotation01=Z._rotation01,A._rotation02=Z._rotation02,A._rotation10=Z._rotation10,A._rotation11=Z._rotation11,A._rotation12=Z._rotation12,A._rotation20=Z._rotation20,A._rotation21=Z._rotation21,A._rotation22=Z._rotation22,C._linearContactImpulseX=0,C._linearContactImpulseY=0,C._linearContactImpulseZ=0,C._angularContactImpulseX=0,C._angularContactImpulseY=0,C._angularContactImpulseZ=0,C._sleeping=!1,C._autoSleep&&C._velX*C._velX+C._velY*C._velY+C._velZ*C._velZ<I.common.Setting.sleepingVelocityThreshold*I.common.Setting.sleepingVelocityThreshold&&C._angVelX*C._angVelX+C._angVelY*C._angVelY+C._angVelZ*C._angVelZ<I.common.Setting.sleepingAngularVelocityThreshold*I.common.Setting.sleepingAngularVelocityThreshold?C._sleepTime+=n:C._sleepTime=0,C._sleepTime<I.common.Setting.sleepingTimeThreshold&&(s=!1),C._type==0){let L=n*C._linearDamping,E=L*L,T=1/(1+L+E*(.5+L*.16666666666666666+E*.041666666666666664)),P=n*C._angularDamping,N=P*P,R=1/(1+P+N*(.5+P*.16666666666666666+N*.041666666666666664)),k,O,v,D,B,U;k=this.gravityX*C._gravityScale,O=this.gravityY*C._gravityScale,v=this.gravityZ*C._gravityScale,k+=C._forceX*C._invMass,O+=C._forceY*C._invMass,v+=C._forceZ*C._invMass;let q,tt,Q;q=C._invInertia00*C._torqueX+C._invInertia01*C._torqueY+C._invInertia02*C._torqueZ,tt=C._invInertia10*C._torqueX+C._invInertia11*C._torqueY+C._invInertia12*C._torqueZ,Q=C._invInertia20*C._torqueX+C._invInertia21*C._torqueY+C._invInertia22*C._torqueZ,D=q,B=tt,U=Q,C._velX+=k*n,C._velY+=O*n,C._velZ+=v*n,C._velX*=T,C._velY*=T,C._velZ*=T,C._angVelX+=D*n,C._angVelY+=B*n,C._angVelZ+=U*n,C._angVelX*=R,C._angVelY*=R,C._angVelZ*=R}}if(s){let C=0,A=this.numRigidBodies;for(;C<A;){let Z=this.rigidBodies[C++];Z._sleeping=!0,Z._sleepTime=0}return}let _=0,a=this.numSolvers;for(;_<a;)this.solvers[_++].preSolveVelocity(t);let l=0,h=this.numSolvers;for(;l<h;)this.solvers[l++].warmStart(t);let u=0;for(;u<e;){++u;let C=0,A=this.numSolvers;for(;C<A;)this.solvers[C++].solveVelocity()}let f=0,m=this.numSolvers;for(;f<m;)this.solvers[f++].postSolveVelocity(t);let d=0,p=this.numRigidBodies;for(;d<p;)this.rigidBodies[d++]._integrate(n);let g=0,x=this.numSolversSi;for(;g<x;)this.solversSi[g++].preSolvePosition(t);let b=0;for(;b<i;){++b;let C=0,A=this.numSolversSi;for(;C<A;)this.solversSi[C++].solvePositionSplitImpulse()}let y=0,z=this.numRigidBodies;for(;y<z;)this.rigidBodies[y++]._integratePseudoVelocity();let M=0,Y=this.numSolversNgs;for(;M<Y;)this.solversNgs[M++].preSolvePosition(t);let X=0;for(;X<i;){++X;let C=0,A=this.numSolversNgs;for(;C<A;)this.solversNgs[C++].solvePositionNgs(t)}let w=0,S=this.numSolvers;for(;w<S;)this.solvers[w++].postSolve();let V=0,F=this.numRigidBodies;for(;V<F;){let C=this.rigidBodies[V++],A=C._shapeList;for(;A!=null;){let Z=A._next,L=C._ptransform,E=C._transform,T=A._ptransform,P=A._localTransform,N,R,k,O,v,D,B,U,q;N=L._rotation00*P._rotation00+L._rotation01*P._rotation10+L._rotation02*P._rotation20,R=L._rotation00*P._rotation01+L._rotation01*P._rotation11+L._rotation02*P._rotation21,k=L._rotation00*P._rotation02+L._rotation01*P._rotation12+L._rotation02*P._rotation22,O=L._rotation10*P._rotation00+L._rotation11*P._rotation10+L._rotation12*P._rotation20,v=L._rotation10*P._rotation01+L._rotation11*P._rotation11+L._rotation12*P._rotation21,D=L._rotation10*P._rotation02+L._rotation11*P._rotation12+L._rotation12*P._rotation22,B=L._rotation20*P._rotation00+L._rotation21*P._rotation10+L._rotation22*P._rotation20,U=L._rotation20*P._rotation01+L._rotation21*P._rotation11+L._rotation22*P._rotation21,q=L._rotation20*P._rotation02+L._rotation21*P._rotation12+L._rotation22*P._rotation22,T._rotation00=N,T._rotation01=R,T._rotation02=k,T._rotation10=O,T._rotation11=v,T._rotation12=D,T._rotation20=B,T._rotation21=U,T._rotation22=q;let tt,Q,nt;tt=L._rotation00*P._positionX+L._rotation01*P._positionY+L._rotation02*P._positionZ,Q=L._rotation10*P._positionX+L._rotation11*P._positionY+L._rotation12*P._positionZ,nt=L._rotation20*P._positionX+L._rotation21*P._positionY+L._rotation22*P._positionZ,T._positionX=tt,T._positionY=Q,T._positionZ=nt,T._positionX+=L._positionX,T._positionY+=L._positionY,T._positionZ+=L._positionZ;let H=A._transform,j=A._localTransform,it,et,G,W,lt,ht,ft,pt,K;it=E._rotation00*j._rotation00+E._rotation01*j._rotation10+E._rotation02*j._rotation20,et=E._rotation00*j._rotation01+E._rotation01*j._rotation11+E._rotation02*j._rotation21,G=E._rotation00*j._rotation02+E._rotation01*j._rotation12+E._rotation02*j._rotation22,W=E._rotation10*j._rotation00+E._rotation11*j._rotation10+E._rotation12*j._rotation20,lt=E._rotation10*j._rotation01+E._rotation11*j._rotation11+E._rotation12*j._rotation21,ht=E._rotation10*j._rotation02+E._rotation11*j._rotation12+E._rotation12*j._rotation22,ft=E._rotation20*j._rotation00+E._rotation21*j._rotation10+E._rotation22*j._rotation20,pt=E._rotation20*j._rotation01+E._rotation21*j._rotation11+E._rotation22*j._rotation21,K=E._rotation20*j._rotation02+E._rotation21*j._rotation12+E._rotation22*j._rotation22,H._rotation00=it,H._rotation01=et,H._rotation02=G,H._rotation10=W,H._rotation11=lt,H._rotation12=ht,H._rotation20=ft,H._rotation21=pt,H._rotation22=K;let J,rt,mt;J=E._rotation00*j._positionX+E._rotation01*j._positionY+E._rotation02*j._positionZ,rt=E._rotation10*j._positionX+E._rotation11*j._positionY+E._rotation12*j._positionZ,mt=E._rotation20*j._positionX+E._rotation21*j._positionY+E._rotation22*j._positionZ,H._positionX=J,H._positionY=rt,H._positionZ=mt,H._positionX+=E._positionX,H._positionY+=E._positionY,H._positionZ+=E._positionZ;let xt,vt,Mt,ut,Zt,zt;if(A._geom._computeAabb(A._aabb,A._ptransform),xt=A._aabb._minX,vt=A._aabb._minY,Mt=A._aabb._minZ,ut=A._aabb._maxX,Zt=A._aabb._maxY,zt=A._aabb._maxZ,A._geom._computeAabb(A._aabb,A._transform),A._aabb._minX=xt<A._aabb._minX?xt:A._aabb._minX,A._aabb._minY=vt<A._aabb._minY?vt:A._aabb._minY,A._aabb._minZ=Mt<A._aabb._minZ?Mt:A._aabb._minZ,A._aabb._maxX=ut>A._aabb._maxX?ut:A._aabb._maxX,A._aabb._maxY=Zt>A._aabb._maxY?Zt:A._aabb._maxY,A._aabb._maxZ=zt>A._aabb._maxZ?zt:A._aabb._maxZ,A._proxy!=null){let dt,st,ct;dt=A._transform._positionX-A._ptransform._positionX,st=A._transform._positionY-A._ptransform._positionY,ct=A._transform._positionZ-A._ptransform._positionZ;let _t=A.displacement;_t.x=dt,_t.y=st,_t.z=ct,A._rigidBody._world._broadPhase.moveProxy(A._proxy,A._aabb,A.displacement)}A=Z}}}};I.dynamics.TimeStep=class{constructor(){this.dt=0,this.invDt=0,this.dtRatio=1}};I.dynamics.World=class{constructor(t,e){switch(t==null&&(t=2),t){case 1:this._broadPhase=new I.collision.broadphase.bruteforce.BruteForceBroadPhase;break;case 2:this._broadPhase=new I.collision.broadphase.bvh.BvhBroadPhase;break}this._contactManager=new I.dynamics.ContactManager(this._broadPhase),e==null&&(e=new I.common.Vec3(0,-9.80665,0)),this._gravity=new I.common.Vec3(e.x,e.y,e.z),this._rigidBodyList=null,this._rigidBodyListLast=null,this._jointList=null,this._jointListLast=null,this._numRigidBodies=0,this._numShapes=0,this._numJoints=0,this._numIslands=0,this._numVelocityIterations=10,this._numPositionIterations=5,this._rayCastWrapper=new I.dynamics._World.RayCastWrapper,this._convexCastWrapper=new I.dynamics._World.ConvexCastWrapper,this._aabbTestWrapper=new I.dynamics._World.AabbTestWrapper,this._island=new I.dynamics.Island,this._solversInIslands=new Array(I.common.Setting.islandInitialConstraintArraySize),this._rigidBodyStack=new Array(I.common.Setting.islandInitialRigidBodyArraySize),this._timeStep=new I.dynamics.TimeStep,this._pool=new I.common.Pool,this._shapeIdCount=0}_updateContacts(){let t=Date.now()/1e3;this._contactManager._updateContacts(),I.dynamics.common.Performance.broadPhaseCollisionTime=(Date.now()/1e3-t)*1e3;let e=Date.now()/1e3,i=this._contactManager._contactList;for(;i!=null;){let n=i._next;i._shouldBeSkipped||i._updateManifold(),i=n}I.dynamics.common.Performance.narrowPhaseCollisionTime=(Date.now()/1e3-e)*1e3}_solveIslands(){let t=Date.now()/1e3;if(I.common.Setting.disableSleeping){let s=this._rigidBodyList;for(;s!=null;)s._sleeping=!1,s._sleepTime=0,s=s._next}if(this._rigidBodyStack.length<this._numRigidBodies){let s=this._rigidBodyStack.length<<1;for(;s<this._numRigidBodies;)s<<=1;this._rigidBodyStack=new Array(s)}this._numIslands=0;let e=this._island,i=this._gravity;e.gravityX=i.x,e.gravityY=i.y,e.gravityZ=i.z;let n=this._rigidBodyList;for(this._numSolversInIslands=0;n!=null;){let s=n._next;for(;!(n._addedToIsland||n._sleeping||n._type==1);){if(n._numContactLinks==0&&n._numJointLinks==0){this._island._stepSingleRigidBody(this._timeStep,n),this._numIslands++;break}this.buildIsland(n),this._island._step(this._timeStep,this._numVelocityIterations,this._numPositionIterations),this._island._clear(),this._numIslands++;break}n=s}for(this._contactManager._postSolve(),n=this._rigidBodyList;n!=null;)n._addedToIsland=!1,n=n._next;for(n=this._rigidBodyList;n!=null;)n._forceX=0,n._forceY=0,n._forceZ=0,n._torqueX=0,n._torqueY=0,n._torqueZ=0,n=n._next;for(;this._numSolversInIslands>0;)this._solversInIslands[--this._numSolversInIslands]._addedToIsland=!1,this._solversInIslands[this._numSolversInIslands]=null;I.dynamics.common.Performance.dynamicsTime=(Date.now()/1e3-t)*1e3}buildIsland(t){let e=1;for(this._island._addRigidBody(t),this._rigidBodyStack[0]=t;e>0;){let i=this._rigidBodyStack[--e];if(this._rigidBodyStack[e]=null,i._type==1)continue;let n=i._contactLinkList;for(;n!=null;){let o=n._next,r=n._contact._contactConstraint,_=n._contact._contactConstraint._solver;if(r.isTouching()&&!_._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){let l=new Array(this._numSolversInIslands<<1),h=0,u=this._numSolversInIslands;for(;h<u;){let f=h++;l[f]=this._solversInIslands[f],this._solversInIslands[f]=null}this._solversInIslands=l}this._solversInIslands[this._numSolversInIslands++]=_,this._island._addConstraintSolver(_,r._positionCorrectionAlgorithm);let a=n._other;a._addedToIsland||(this._island._addRigidBody(a),this._rigidBodyStack[e++]=a)}n=o}let s=i._jointLinkList;for(;s!=null;){let o=s._next,r=s._joint,_=r._solver;if(!_._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){let l=new Array(this._numSolversInIslands<<1),h=0,u=this._numSolversInIslands;for(;h<u;){let f=h++;l[f]=this._solversInIslands[f],this._solversInIslands[f]=null}this._solversInIslands=l}this._solversInIslands[this._numSolversInIslands++]=_,this._island._addConstraintSolver(_,r._positionCorrectionAlgorithm);let a=s._other;a._addedToIsland||(this._island._addRigidBody(a),this._rigidBodyStack[e++]=a)}s=o}}}_drawBvh(t,e){t.drawBvh&&this._drawBvhNode(t,e._root,0,t.style.bvhNodeColor)}_drawBvhNode(t,e,i,n){if(e!=null){if(i>=t.drawBvhMinLevel&&i<=t.drawBvhMaxLevel){let s=this._pool,o=s.sizeVec3==0?new I.common.Vec3:s.stackVec3[--s.sizeVec3],r=this._pool,_=r.sizeVec3==0?new I.common.Vec3:r.stackVec3[--r.sizeVec3],a=o;a.x=e._aabbMinX,a.y=e._aabbMinY,a.z=e._aabbMinZ;let l=_;l.x=e._aabbMaxX,l.y=e._aabbMaxY,l.z=e._aabbMaxZ,t.aabb(o,_,n);let h=this._pool;if(o!=null){if(o.zero(),h.sizeVec3==h.stackVec3.length){let f=new Array(h.sizeVec3<<1),m=0,d=h.sizeVec3;for(;m<d;){let p=m++;f[p]=h.stackVec3[p],h.stackVec3[p]=null}h.stackVec3=f}h.stackVec3[h.sizeVec3++]=o}let u=this._pool;if(_!=null){if(_.zero(),u.sizeVec3==u.stackVec3.length){let f=new Array(u.sizeVec3<<1),m=0,d=u.sizeVec3;for(;m<d;){let p=m++;f[p]=u.stackVec3[p],u.stackVec3[p]=null}u.stackVec3=f}u.stackVec3[u.sizeVec3++]=_}}this._drawBvhNode(t,e._children[0],i+1,n),this._drawBvhNode(t,e._children[1],i+1,n)}}_drawRigidBodies(t){let e=t.style,i=this._rigidBodyList;for(;i!=null;){let n=i._next;if(t.drawBases){let _=t.style;t.basis(i._transform,_.basisLength,_.basisColorX,_.basisColorY,_.basisColorZ)}let s=null,o=i._type==0;o||(s=i._type==2?e.kinematicShapeColor:e.staticShapeColor);let r=i._shapeList;for(;r!=null;){let _=r._next;if(o&&((r._id&1)==0?s=i._sleeping?e.sleepingShapeColor1:i._sleepTime>I.common.Setting.sleepingTimeThreshold?e.sleepyShapeColor1:e.shapeColor1:s=i._sleeping?e.sleepingShapeColor2:i._sleepTime>I.common.Setting.sleepingTimeThreshold?e.sleepyShapeColor2:e.shapeColor2),t.drawShapes){let a=r._geom,l=r._transform;switch(a._type){case 0:t.sphere(l,a._radius,s);break;case 1:let h=a,u=this._pool,f=u.sizeVec3==0?new I.common.Vec3:u.stackVec3[--u.sizeVec3],m=f;m.x=h._halfExtentsX,m.y=h._halfExtentsY,m.z=h._halfExtentsZ,t.box(l,f,s);let d=this._pool;if(f!=null){if(f.zero(),d.sizeVec3==d.stackVec3.length){let H=new Array(d.sizeVec3<<1),j=0,it=d.sizeVec3;for(;j<it;){let et=j++;H[et]=d.stackVec3[et],d.stackVec3[et]=null}d.stackVec3=H}d.stackVec3[d.sizeVec3++]=f}break;case 2:let p=a;t.cylinder(l,p._radius,p._halfHeight,s);break;case 3:let g=a;t.cone(l,g._radius,g._halfHeight,s);break;case 4:let x=a;t.capsule(l,x._radius,x._halfHeight,s);break;case 5:let b=a,y=b._numVertices,z=this._pool,M=z.sizeVec3==0?new I.common.Vec3:z.stackVec3[--z.sizeVec3],Y=this._pool,X=Y.sizeVec3==0?new I.common.Vec3:Y.stackVec3[--Y.sizeVec3],w=this._pool,S=w.sizeVec3==0?new I.common.Vec3:w.stackVec3[--w.sizeVec3],V=this._pool,F=V.sizeVec3==0?new I.common.Vec3:V.stackVec3[--V.sizeVec3],C=this._pool,A=C.sizeVec3==0?new I.common.Vec3:C.stackVec3[--C.sizeVec3],Z=this._pool,L=Z.sizeVec3==0?new I.common.Vec3:Z.stackVec3[--Z.sizeVec3],E=this._pool,T=E.sizeMat3==0?new I.common.Mat3:E.stackMat3[--E.sizeMat3],P=this._pool,N=P.sizeVec3==0?new I.common.Vec3:P.stackVec3[--P.sizeVec3],R=T;R.e00=l._rotation00,R.e01=l._rotation01,R.e02=l._rotation02,R.e10=l._rotation10,R.e11=l._rotation11,R.e12=l._rotation12,R.e20=l._rotation20,R.e21=l._rotation21,R.e22=l._rotation22;let k=N;k.x=l._positionX,k.y=l._positionY,k.z=l._positionZ;let O=0;for(;O<y;){let H=O++,j=b._tmpVertices[H],it=b._vertices[H];j.x=it.x,j.y=it.y,j.z=it.z;let et=j.x*T.e10+j.y*T.e11+j.z*T.e12,G=j.x*T.e20+j.y*T.e21+j.z*T.e22;j.x=j.x*T.e00+j.y*T.e01+j.z*T.e02,j.y=et,j.z=G,j.x+=N.x,j.y+=N.y,j.z+=N.z}if(y>30){let H=0;for(;H<y;){let j=H++,it=b._tmpVertices[j];M.x=it.x,M.y=it.y,M.z=it.z;let et=b._tmpVertices[(j+1)%y];X.x=et.x,X.y=et.y,X.z=et.z,t.line(M,X,s)}}else if(this._debugDraw.wireframe||y>10){let H=0;for(;H<y;){let j=H++,it=b._tmpVertices[j];M.x=it.x,M.y=it.y,M.z=it.z;let et=0;for(;et<j;){let G=b._tmpVertices[et++];X.x=G.x,X.y=G.y,X.z=G.z,t.line(M,X,s)}}}else{let H=0;for(;H<y;){let j=H++,it=b._tmpVertices[j];M.x=it.x,M.y=it.y,M.z=it.z;let et=0;for(;et<j;){let G=et++,W=b._tmpVertices[G];X.x=W.x,X.y=W.y,X.z=W.z;let lt=0;for(;lt<G;){let ht=b._tmpVertices[lt++];S.x=ht.x,S.y=ht.y,S.z=ht.z,F.x=X.x,F.y=X.y,F.z=X.z;let ft=F;ft.x-=M.x,ft.y-=M.y,ft.z-=M.z,A.x=S.x,A.y=S.y,A.z=S.z;let pt=A;pt.x-=M.x,pt.y-=M.y,pt.z-=M.z,L.x=F.x,L.y=F.y,L.z=F.z;let K=L,J=K.z*A.x-K.x*A.z,rt=K.x*A.y-K.y*A.x;K.x=K.y*A.z-K.z*A.y,K.y=J,K.z=rt;let mt=Math.sqrt(K.x*K.x+K.y*K.y+K.z*K.z);mt>0&&(mt=1/mt),K.x*=mt,K.y*=mt,K.z*=mt,t.triangle(M,X,S,L,L,L,s),L.x=-L.x,L.y=-L.y,L.z=-L.z,t.triangle(M,S,X,L,L,L,s)}}}}let v=this._pool;if(M!=null){if(M.zero(),v.sizeVec3==v.stackVec3.length){let H=new Array(v.sizeVec3<<1),j=0,it=v.sizeVec3;for(;j<it;){let et=j++;H[et]=v.stackVec3[et],v.stackVec3[et]=null}v.stackVec3=H}v.stackVec3[v.sizeVec3++]=M}let D=this._pool;if(X!=null){if(X.zero(),D.sizeVec3==D.stackVec3.length){let H=new Array(D.sizeVec3<<1),j=0,it=D.sizeVec3;for(;j<it;){let et=j++;H[et]=D.stackVec3[et],D.stackVec3[et]=null}D.stackVec3=H}D.stackVec3[D.sizeVec3++]=X}let B=this._pool;if(S!=null){if(S.zero(),B.sizeVec3==B.stackVec3.length){let H=new Array(B.sizeVec3<<1),j=0,it=B.sizeVec3;for(;j<it;){let et=j++;H[et]=B.stackVec3[et],B.stackVec3[et]=null}B.stackVec3=H}B.stackVec3[B.sizeVec3++]=S}let U=this._pool;if(F!=null){if(F.zero(),U.sizeVec3==U.stackVec3.length){let H=new Array(U.sizeVec3<<1),j=0,it=U.sizeVec3;for(;j<it;){let et=j++;H[et]=U.stackVec3[et],U.stackVec3[et]=null}U.stackVec3=H}U.stackVec3[U.sizeVec3++]=F}let q=this._pool;if(A!=null){if(A.zero(),q.sizeVec3==q.stackVec3.length){let H=new Array(q.sizeVec3<<1),j=0,it=q.sizeVec3;for(;j<it;){let et=j++;H[et]=q.stackVec3[et],q.stackVec3[et]=null}q.stackVec3=H}q.stackVec3[q.sizeVec3++]=A}let tt=this._pool;if(L!=null){if(L.zero(),tt.sizeVec3==tt.stackVec3.length){let H=new Array(tt.sizeVec3<<1),j=0,it=tt.sizeVec3;for(;j<it;){let et=j++;H[et]=tt.stackVec3[et],tt.stackVec3[et]=null}tt.stackVec3=H}tt.stackVec3[tt.sizeVec3++]=L}let Q=this._pool;if(T!=null){if(T.e00=1,T.e01=0,T.e02=0,T.e10=0,T.e11=1,T.e12=0,T.e20=0,T.e21=0,T.e22=1,Q.sizeMat3==Q.stackMat3.length){let H=new Array(Q.sizeMat3<<1),j=0,it=Q.sizeMat3;for(;j<it;){let et=j++;H[et]=Q.stackMat3[et],Q.stackMat3[et]=null}Q.stackMat3=H}Q.stackMat3[Q.sizeMat3++]=T}let nt=this._pool;if(N!=null){if(N.zero(),nt.sizeVec3==nt.stackVec3.length){let H=new Array(nt.sizeVec3<<1),j=0,it=nt.sizeVec3;for(;j<it;){let et=j++;H[et]=nt.stackVec3[et],nt.stackVec3[et]=null}nt.stackVec3=H}nt.stackVec3[nt.sizeVec3++]=N}break}}if(t.drawAabbs){let a=r._aabb,l=e.aabbColor,h=this._pool,u=h.sizeVec3==0?new I.common.Vec3:h.stackVec3[--h.sizeVec3],f=this._pool,m=f.sizeVec3==0?new I.common.Vec3:f.stackVec3[--f.sizeVec3],d=u;d.x=a._minX,d.y=a._minY,d.z=a._minZ;let p=m;p.x=a._maxX,p.y=a._maxY,p.z=a._maxZ,t.aabb(u,m,l);let g=this._pool;if(u!=null){if(u.zero(),g.sizeVec3==g.stackVec3.length){let b=new Array(g.sizeVec3<<1),y=0,z=g.sizeVec3;for(;y<z;){let M=y++;b[M]=g.stackVec3[M],g.stackVec3[M]=null}g.stackVec3=b}g.stackVec3[g.sizeVec3++]=u}let x=this._pool;if(m!=null){if(m.zero(),x.sizeVec3==x.stackVec3.length){let b=new Array(x.sizeVec3<<1),y=0,z=x.sizeVec3;for(;y<z;){let M=y++;b[M]=x.stackVec3[M],x.stackVec3[M]=null}x.stackVec3=b}x.stackVec3[x.sizeVec3++]=m}}r=_}i=n}}_drawConstraints(t){let e=t.style;if(t.drawPairs||t.drawContacts){let i=this._contactManager._contactList;for(;i!=null;){let n=i._next;if(t.drawPairs){let s=e.pairColor,o=this._pool,r=o.sizeVec3==0?new I.common.Vec3:o.stackVec3[--o.sizeVec3],_=this._pool,a=_.sizeVec3==0?new I.common.Vec3:_.stackVec3[--_.sizeVec3],l=r;l.x=i._s1._transform._positionX,l.y=i._s1._transform._positionY,l.z=i._s1._transform._positionZ;let h=a;h.x=i._s2._transform._positionX,h.y=i._s2._transform._positionY,h.z=i._s2._transform._positionZ,t.line(r,a,s);let u=this._pool;if(r!=null){if(r.zero(),u.sizeVec3==u.stackVec3.length){let m=new Array(u.sizeVec3<<1),d=0,p=u.sizeVec3;for(;d<p;){let g=d++;m[g]=u.stackVec3[g],u.stackVec3[g]=null}u.stackVec3=m}u.stackVec3[u.sizeVec3++]=r}let f=this._pool;if(a!=null){if(a.zero(),f.sizeVec3==f.stackVec3.length){let m=new Array(f.sizeVec3<<1),d=0,p=f.sizeVec3;for(;d<p;){let g=d++;m[g]=f.stackVec3[g],f.stackVec3[g]=null}f.stackVec3=m}f.stackVec3[f.sizeVec3++]=a}}if(t.drawContacts){let s=i._contactConstraint,o=i._contactConstraint._manifold._points,r=0,_=i._contactConstraint._manifold._numPoints;for(;r<_;){let a=o[r++],l=t.style,h=this._pool,u=h.sizeVec3==0?new I.common.Vec3:h.stackVec3[--h.sizeVec3],f=this._pool,m=f.sizeVec3==0?new I.common.Vec3:f.stackVec3[--f.sizeVec3],d=this._pool,p=d.sizeVec3==0?new I.common.Vec3:d.stackVec3[--d.sizeVec3],g=this._pool,x=g.sizeVec3==0?new I.common.Vec3:g.stackVec3[--g.sizeVec3],b=this._pool,y=b.sizeVec3==0?new I.common.Vec3:b.stackVec3[--b.sizeVec3],z=u;z.x=a._pos1X,z.y=a._pos1Y,z.z=a._pos1Z;let M=m;M.x=a._pos2X,M.y=a._pos2Y,M.z=a._pos2Z;let Y=p;Y.x=s._manifold._normalX,Y.y=s._manifold._normalY,Y.z=s._manifold._normalZ;let X=x;X.x=s._manifold._tangentX,X.y=s._manifold._tangentY,X.z=s._manifold._tangentZ;let w=y;if(w.x=s._manifold._binormalX,w.y=s._manifold._binormalY,w.z=s._manifold._binormalZ,a._disabled)t.point(u,l.disabledContactColor),t.point(m,l.disabledContactColor),t.line(u,m,l.disabledContactColor);else if(a._warmStarted){let E;switch(a._id&3){case 0:E=l.contactColor;break;case 1:E=l.contactColor2;break;case 2:E=l.contactColor3;break;default:E=l.contactColor4}t.point(u,E),t.point(m,E),t.line(u,m,l.contactColor)}else t.point(u,l.newContactColor),t.point(m,l.newContactColor),t.line(u,m,l.newContactColor);m.x=u.x,m.y=u.y,m.z=u.z;let S=m,V=l.contactNormalLength;if(S.x+=p.x*V,S.y+=p.y*V,S.z+=p.z*V,t.line(u,m,l.contactNormalColor),t.drawContactBases){m.x=u.x,m.y=u.y,m.z=u.z;let E=m,T=l.contactTangentLength;E.x+=x.x*T,E.y+=x.y*T,E.z+=x.z*T,t.line(u,m,l.contactTangentColor),m.x=u.x,m.y=u.y,m.z=u.z;let P=m,N=l.contactBinormalLength;P.x+=y.x*N,P.y+=y.y*N,P.z+=y.z*N,t.line(u,m,l.contactBinormalColor)}let F=this._pool;if(u!=null){if(u.zero(),F.sizeVec3==F.stackVec3.length){let E=new Array(F.sizeVec3<<1),T=0,P=F.sizeVec3;for(;T<P;){let N=T++;E[N]=F.stackVec3[N],F.stackVec3[N]=null}F.stackVec3=E}F.stackVec3[F.sizeVec3++]=u}let C=this._pool;if(m!=null){if(m.zero(),C.sizeVec3==C.stackVec3.length){let E=new Array(C.sizeVec3<<1),T=0,P=C.sizeVec3;for(;T<P;){let N=T++;E[N]=C.stackVec3[N],C.stackVec3[N]=null}C.stackVec3=E}C.stackVec3[C.sizeVec3++]=m}let A=this._pool;if(p!=null){if(p.zero(),A.sizeVec3==A.stackVec3.length){let E=new Array(A.sizeVec3<<1),T=0,P=A.sizeVec3;for(;T<P;){let N=T++;E[N]=A.stackVec3[N],A.stackVec3[N]=null}A.stackVec3=E}A.stackVec3[A.sizeVec3++]=p}let Z=this._pool;if(x!=null){if(x.zero(),Z.sizeVec3==Z.stackVec3.length){let E=new Array(Z.sizeVec3<<1),T=0,P=Z.sizeVec3;for(;T<P;){let N=T++;E[N]=Z.stackVec3[N],Z.stackVec3[N]=null}Z.stackVec3=E}Z.stackVec3[Z.sizeVec3++]=x}let L=this._pool;if(y!=null){if(y.zero(),L.sizeVec3==L.stackVec3.length){let E=new Array(L.sizeVec3<<1),T=0,P=L.sizeVec3;for(;T<P;){let N=T++;E[N]=L.stackVec3[N],L.stackVec3[N]=null}L.stackVec3=E}L.stackVec3[L.sizeVec3++]=y}}}i=n}}if(t.drawJoints){let i=this._jointList;for(;i!=null;){let n=i._next,s=this._pool,o=s.sizeVec3==0?new I.common.Vec3:s.stackVec3[--s.sizeVec3],r=this._pool,_=r.sizeVec3==0?new I.common.Vec3:r.stackVec3[--r.sizeVec3],a=o;a.x=i._b1._transform._positionX,a.y=i._b1._transform._positionY,a.z=i._b1._transform._positionZ;let l=_;l.x=i._b2._transform._positionX,l.y=i._b2._transform._positionY,l.z=i._b2._transform._positionZ;let h=this._pool,u=h.sizeVec3==0?new I.common.Vec3:h.stackVec3[--h.sizeVec3],f=this._pool,m=f.sizeVec3==0?new I.common.Vec3:f.stackVec3[--f.sizeVec3],d=this._pool,p=d.sizeVec3==0?new I.common.Vec3:d.stackVec3[--d.sizeVec3],g=this._pool,x=g.sizeVec3==0?new I.common.Vec3:g.stackVec3[--g.sizeVec3],b=this._pool,y=b.sizeVec3==0?new I.common.Vec3:b.stackVec3[--b.sizeVec3],z=this._pool,M=z.sizeVec3==0?new I.common.Vec3:z.stackVec3[--z.sizeVec3],Y=this._pool,X=Y.sizeVec3==0?new I.common.Vec3:Y.stackVec3[--Y.sizeVec3],w=this._pool,S=w.sizeVec3==0?new I.common.Vec3:w.stackVec3[--w.sizeVec3],V=u;V.x=i._anchor1X,V.y=i._anchor1Y,V.z=i._anchor1Z;let F=m;F.x=i._anchor2X,F.y=i._anchor2Y,F.z=i._anchor2Z;let C=p;C.x=i._basisX1X,C.y=i._basisX1Y,C.z=i._basisX1Z;let A=x;A.x=i._basisY1X,A.y=i._basisY1Y,A.z=i._basisY1Z;let Z=y;Z.x=i._basisZ1X,Z.y=i._basisZ1Y,Z.z=i._basisZ1Z;let L=M;L.x=i._basisX2X,L.y=i._basisX2Y,L.z=i._basisX2Z;let E=X;E.x=i._basisY2X,E.y=i._basisY2Y,E.z=i._basisY2Z;let T=S;if(T.x=i._basisZ2X,T.y=i._basisZ2Y,T.z=i._basisZ2Z,t.line(o,u,t.style.jointLineColor),t.line(_,m,t.style.jointLineColor),t.drawJointLimits)switch(i._type){case 0:break;case 1:let tt=i._lm;this._drawRotationalLimit(t,u,x,y,X,t.style.jointRotationalConstraintRadius,tt.lowerLimit,tt.upperLimit,t.style.jointLineColor);break;case 2:let Q=i,nt=t.style.jointLineColor,H=Q._rotLm,j=Q._translLm;this._drawRotationalLimit(t,m,x,y,X,t.style.jointRotationalConstraintRadius,H.lowerLimit,H.upperLimit,nt),this._drawTranslationalLimit(t,u,p,j.lowerLimit,j.upperLimit,nt);break;case 3:let it=i._lm;this._drawTranslationalLimit(t,u,p,it.lowerLimit,it.upperLimit,t.style.jointLineColor);break;case 4:let et=i,G=t.style.jointRotationalConstraintRadius,W=t.style.jointLineColor,lt=et._lm1,ht=et._lm2;this._drawRotationalLimit(t,u,x,y,x,G,et._angleX-lt.upperLimit,et._angleX-lt.lowerLimit,W),this._drawRotationalLimit(t,m,M,X,M,G,ht.lowerLimit-et._angleZ,ht.upperLimit-et._angleZ,W);break;case 5:let ft=i,pt=t.style.jointRotationalConstraintRadius,K=t.style.jointLineColor,J=ft._twistLm;this._drawRotationalLimit(t,m,X,S,X,pt,J.lowerLimit-ft._twistAngle,J.upperLimit-ft._twistAngle,K),this._drawEllipseOnSphere(t,u,p,x,y,ft._maxSwingAngle1,ft._maxSwingAngle2,pt,K);let rt=this._pool,mt=rt.sizeVec3==0?new I.common.Vec3:rt.stackVec3[--rt.sizeVec3];mt.x=m.x,mt.y=m.y,mt.z=m.z;let xt=mt;xt.x+=M.x*pt,xt.y+=M.y*pt,xt.z+=M.z*pt,t.line(m,xt,K);let vt=this._pool;if(xt!=null){if(xt.zero(),vt.sizeVec3==vt.stackVec3.length){let ue=new Array(vt.sizeVec3<<1),$t=0,Ht=vt.sizeVec3;for(;$t<Ht;){let me=$t++;ue[me]=vt.stackVec3[me],vt.stackVec3[me]=null}vt.stackVec3=ue}vt.stackVec3[vt.sizeVec3++]=xt}break;case 6:let Mt=i,ut=t.style.jointRotationalConstraintRadius,Zt=t.style.jointLineColor,zt=Mt._rotLms[0],dt=Mt._rotLms[1],st=Mt._rotLms[2];this._drawTranslationalLimit3D(t,u,p,x,y,Mt._translLms[0],Mt._translLms[1],Mt._translLms[2],Zt);let ct=this._pool,_t=ct.sizeVec3==0?new I.common.Vec3:ct.stackVec3[--ct.sizeVec3],Vt=_t;Vt.x=Mt._axisYX,Vt.y=Mt._axisYY,Vt.z=Mt._axisYZ;let At=this._pool,St=At.sizeVec3==0?new I.common.Vec3:At.stackVec3[--At.sizeVec3];St.x=p.x,St.y=p.y,St.z=p.z;let Xt=St,Ft=this._pool,ie=Ft.sizeVec3==0?new I.common.Vec3:Ft.stackVec3[--Ft.sizeVec3];ie.x=p.x,ie.y=p.y,ie.z=p.z;let ee=ie,Ye=ee.z*_t.x-ee.x*_t.z,Ie=ee.x*_t.y-ee.y*_t.x;ee.x=ee.y*_t.z-ee.z*_t.y,ee.y=Ye,ee.z=Ie,this._drawRotationalLimit(t,m,x,y,x,ut,Mt._angleX-zt.upperLimit,Mt._angleX-zt.lowerLimit,Zt),this._drawRotationalLimit(t,m,Xt,ee,Xt,ut,dt.lowerLimit-Mt._angleY,dt.upperLimit-Mt._angleY,Zt),this._drawRotationalLimit(t,m,M,X,M,ut,st.lowerLimit-Mt._angleZ,st.upperLimit-Mt._angleZ,Zt);break}t.line(u,m,t.style.jointErrorColor);let P=this._pool;if(o!=null){if(o.zero(),P.sizeVec3==P.stackVec3.length){let tt=new Array(P.sizeVec3<<1),Q=0,nt=P.sizeVec3;for(;Q<nt;){let H=Q++;tt[H]=P.stackVec3[H],P.stackVec3[H]=null}P.stackVec3=tt}P.stackVec3[P.sizeVec3++]=o}let N=this._pool;if(_!=null){if(_.zero(),N.sizeVec3==N.stackVec3.length){let tt=new Array(N.sizeVec3<<1),Q=0,nt=N.sizeVec3;for(;Q<nt;){let H=Q++;tt[H]=N.stackVec3[H],N.stackVec3[H]=null}N.stackVec3=tt}N.stackVec3[N.sizeVec3++]=_}let R=this._pool;if(u!=null){if(u.zero(),R.sizeVec3==R.stackVec3.length){let tt=new Array(R.sizeVec3<<1),Q=0,nt=R.sizeVec3;for(;Q<nt;){let H=Q++;tt[H]=R.stackVec3[H],R.stackVec3[H]=null}R.stackVec3=tt}R.stackVec3[R.sizeVec3++]=u}let k=this._pool;if(m!=null){if(m.zero(),k.sizeVec3==k.stackVec3.length){let tt=new Array(k.sizeVec3<<1),Q=0,nt=k.sizeVec3;for(;Q<nt;){let H=Q++;tt[H]=k.stackVec3[H],k.stackVec3[H]=null}k.stackVec3=tt}k.stackVec3[k.sizeVec3++]=m}let O=this._pool;if(p!=null){if(p.zero(),O.sizeVec3==O.stackVec3.length){let tt=new Array(O.sizeVec3<<1),Q=0,nt=O.sizeVec3;for(;Q<nt;){let H=Q++;tt[H]=O.stackVec3[H],O.stackVec3[H]=null}O.stackVec3=tt}O.stackVec3[O.sizeVec3++]=p}let v=this._pool;if(x!=null){if(x.zero(),v.sizeVec3==v.stackVec3.length){let tt=new Array(v.sizeVec3<<1),Q=0,nt=v.sizeVec3;for(;Q<nt;){let H=Q++;tt[H]=v.stackVec3[H],v.stackVec3[H]=null}v.stackVec3=tt}v.stackVec3[v.sizeVec3++]=x}let D=this._pool;if(y!=null){if(y.zero(),D.sizeVec3==D.stackVec3.length){let tt=new Array(D.sizeVec3<<1),Q=0,nt=D.sizeVec3;for(;Q<nt;){let H=Q++;tt[H]=D.stackVec3[H],D.stackVec3[H]=null}D.stackVec3=tt}D.stackVec3[D.sizeVec3++]=y}let B=this._pool;if(M!=null){if(M.zero(),B.sizeVec3==B.stackVec3.length){let tt=new Array(B.sizeVec3<<1),Q=0,nt=B.sizeVec3;for(;Q<nt;){let H=Q++;tt[H]=B.stackVec3[H],B.stackVec3[H]=null}B.stackVec3=tt}B.stackVec3[B.sizeVec3++]=M}let U=this._pool;if(X!=null){if(X.zero(),U.sizeVec3==U.stackVec3.length){let tt=new Array(U.sizeVec3<<1),Q=0,nt=U.sizeVec3;for(;Q<nt;){let H=Q++;tt[H]=U.stackVec3[H],U.stackVec3[H]=null}U.stackVec3=tt}U.stackVec3[U.sizeVec3++]=X}let q=this._pool;if(S!=null){if(S.zero(),q.sizeVec3==q.stackVec3.length){let tt=new Array(q.sizeVec3<<1),Q=0,nt=q.sizeVec3;for(;Q<nt;){let H=Q++;tt[H]=q.stackVec3[H],q.stackVec3[H]=null}q.stackVec3=tt}q.stackVec3[q.sizeVec3++]=S}i=n}}}_drawRotationalLimit(t,e,i,n,s,o,r,_,a){if(r!=_){let l=this._pool,h=l.sizeVec3==0?new I.common.Vec3:l.stackVec3[--l.sizeVec3];h.x=e.x,h.y=e.y,h.z=e.z;let u=h;u.x+=s.x*o,u.y+=s.y*o,u.z+=s.z*o,t.line(e,u,a);let f=this._pool;if(u!=null){if(u.zero(),f.sizeVec3==f.stackVec3.length){let m=new Array(f.sizeVec3<<1),d=0,p=f.sizeVec3;for(;d<p;){let g=d++;m[g]=f.stackVec3[g],f.stackVec3[g]=null}f.stackVec3=m}f.stackVec3[f.sizeVec3++]=u}r>_?t.ellipse(e,i,n,o,o,a):t.arc(e,i,n,o,o,r,_,!0,a)}}_drawTranslationalLimit(t,e,i,n,s,o){if(n<s){let r=this._pool,_=r.sizeVec3==0?new I.common.Vec3:r.stackVec3[--r.sizeVec3];_.x=e.x,_.y=e.y,_.z=e.z;let a=_;a.x+=i.x*n,a.y+=i.y*n,a.z+=i.z*n;let l=this._pool,h=l.sizeVec3==0?new I.common.Vec3:l.stackVec3[--l.sizeVec3];h.x=e.x,h.y=e.y,h.z=e.z;let u=h;u.x+=i.x*s,u.y+=i.y*s,u.z+=i.z*s,t.line(a,u,o);let f=this._pool;if(a!=null){if(a.zero(),f.sizeVec3==f.stackVec3.length){let d=new Array(f.sizeVec3<<1),p=0,g=f.sizeVec3;for(;p<g;){let x=p++;d[x]=f.stackVec3[x],f.stackVec3[x]=null}f.stackVec3=d}f.stackVec3[f.sizeVec3++]=a}let m=this._pool;if(u!=null){if(u.zero(),m.sizeVec3==m.stackVec3.length){let d=new Array(m.sizeVec3<<1),p=0,g=m.sizeVec3;for(;p<g;){let x=p++;d[x]=m.stackVec3[x],m.stackVec3[x]=null}m.stackVec3=d}m.stackVec3[m.sizeVec3++]=u}}}_drawTranslationalLimit3D(t,e,i,n,s,o,r,_,a){let l=o.lowerLimit,h=o.upperLimit,u=r.lowerLimit,f=r.upperLimit,m=_.lowerLimit,d=_.upperLimit,p=this._pool;p.sizeVec3==0?new I.common.Vec3:--p.sizeVec3;let g=this._pool;g.sizeVec3==0?new I.common.Vec3:--g.sizeVec3;let x=this._pool,b=x.sizeVec3==0?new I.common.Vec3:x.stackVec3[--x.sizeVec3];b.x=e.x,b.y=e.y,b.z=e.z;let y=b;y.x+=i.x*l,y.y+=i.y*l,y.z+=i.z*l,y.x+=n.x*u,y.y+=n.y*u,y.z+=n.z*u,y.x+=s.x*m,y.y+=s.y*m,y.z+=s.z*m;let z=this._pool,M=z.sizeVec3==0?new I.common.Vec3:z.stackVec3[--z.sizeVec3];M.x=e.x,M.y=e.y,M.z=e.z;let Y=M;Y.x+=i.x*l,Y.y+=i.y*l,Y.z+=i.z*l,Y.x+=n.x*u,Y.y+=n.y*u,Y.z+=n.z*u,Y.x+=s.x*d,Y.y+=s.y*d,Y.z+=s.z*d;let X=this._pool,w=X.sizeVec3==0?new I.common.Vec3:X.stackVec3[--X.sizeVec3];w.x=e.x,w.y=e.y,w.z=e.z;let S=w;S.x+=i.x*l,S.y+=i.y*l,S.z+=i.z*l,S.x+=n.x*f,S.y+=n.y*f,S.z+=n.z*f,S.x+=s.x*m,S.y+=s.y*m,S.z+=s.z*m;let V=this._pool,F=V.sizeVec3==0?new I.common.Vec3:V.stackVec3[--V.sizeVec3];F.x=e.x,F.y=e.y,F.z=e.z;let C=F;C.x+=i.x*l,C.y+=i.y*l,C.z+=i.z*l,C.x+=n.x*f,C.y+=n.y*f,C.z+=n.z*f,C.x+=s.x*d,C.y+=s.y*d,C.z+=s.z*d;let A=this._pool,Z=A.sizeVec3==0?new I.common.Vec3:A.stackVec3[--A.sizeVec3];Z.x=e.x,Z.y=e.y,Z.z=e.z;let L=Z;L.x+=i.x*h,L.y+=i.y*h,L.z+=i.z*h,L.x+=n.x*u,L.y+=n.y*u,L.z+=n.z*u,L.x+=s.x*m,L.y+=s.y*m,L.z+=s.z*m;let E=this._pool,T=E.sizeVec3==0?new I.common.Vec3:E.stackVec3[--E.sizeVec3];T.x=e.x,T.y=e.y,T.z=e.z;let P=T;P.x+=i.x*h,P.y+=i.y*h,P.z+=i.z*h,P.x+=n.x*u,P.y+=n.y*u,P.z+=n.z*u,P.x+=s.x*d,P.y+=s.y*d,P.z+=s.z*d;let N=this._pool,R=N.sizeVec3==0?new I.common.Vec3:N.stackVec3[--N.sizeVec3];R.x=e.x,R.y=e.y,R.z=e.z;let k=R;k.x+=i.x*h,k.y+=i.y*h,k.z+=i.z*h,k.x+=n.x*f,k.y+=n.y*f,k.z+=n.z*f,k.x+=s.x*m,k.y+=s.y*m,k.z+=s.z*m;let O=this._pool,v=O.sizeVec3==0?new I.common.Vec3:O.stackVec3[--O.sizeVec3];v.x=e.x,v.y=e.y,v.z=e.z;let D=v;D.x+=i.x*h,D.y+=i.y*h,D.z+=i.z*h,D.x+=n.x*f,D.y+=n.y*f,D.z+=n.z*f,D.x+=s.x*d,D.y+=s.y*d,D.z+=s.z*d,t.line(y,L,a),t.line(S,k,a),t.line(Y,P,a),t.line(C,D,a),t.line(y,S,a),t.line(L,k,a),t.line(Y,C,a),t.line(P,D,a),t.line(y,Y,a),t.line(L,P,a),t.line(S,C,a),t.line(k,D,a);let B=this._pool;if(y!=null){if(y.zero(),B.sizeVec3==B.stackVec3.length){let it=new Array(B.sizeVec3<<1),et=0,G=B.sizeVec3;for(;et<G;){let W=et++;it[W]=B.stackVec3[W],B.stackVec3[W]=null}B.stackVec3=it}B.stackVec3[B.sizeVec3++]=y}let U=this._pool;if(Y!=null){if(Y.zero(),U.sizeVec3==U.stackVec3.length){let it=new Array(U.sizeVec3<<1),et=0,G=U.sizeVec3;for(;et<G;){let W=et++;it[W]=U.stackVec3[W],U.stackVec3[W]=null}U.stackVec3=it}U.stackVec3[U.sizeVec3++]=Y}let q=this._pool;if(S!=null){if(S.zero(),q.sizeVec3==q.stackVec3.length){let it=new Array(q.sizeVec3<<1),et=0,G=q.sizeVec3;for(;et<G;){let W=et++;it[W]=q.stackVec3[W],q.stackVec3[W]=null}q.stackVec3=it}q.stackVec3[q.sizeVec3++]=S}let tt=this._pool;if(C!=null){if(C.zero(),tt.sizeVec3==tt.stackVec3.length){let it=new Array(tt.sizeVec3<<1),et=0,G=tt.sizeVec3;for(;et<G;){let W=et++;it[W]=tt.stackVec3[W],tt.stackVec3[W]=null}tt.stackVec3=it}tt.stackVec3[tt.sizeVec3++]=C}let Q=this._pool;if(L!=null){if(L.zero(),Q.sizeVec3==Q.stackVec3.length){let it=new Array(Q.sizeVec3<<1),et=0,G=Q.sizeVec3;for(;et<G;){let W=et++;it[W]=Q.stackVec3[W],Q.stackVec3[W]=null}Q.stackVec3=it}Q.stackVec3[Q.sizeVec3++]=L}let nt=this._pool;if(P!=null){if(P.zero(),nt.sizeVec3==nt.stackVec3.length){let it=new Array(nt.sizeVec3<<1),et=0,G=nt.sizeVec3;for(;et<G;){let W=et++;it[W]=nt.stackVec3[W],nt.stackVec3[W]=null}nt.stackVec3=it}nt.stackVec3[nt.sizeVec3++]=P}let H=this._pool;if(k!=null){if(k.zero(),H.sizeVec3==H.stackVec3.length){let it=new Array(H.sizeVec3<<1),et=0,G=H.sizeVec3;for(;et<G;){let W=et++;it[W]=H.stackVec3[W],H.stackVec3[W]=null}H.stackVec3=it}H.stackVec3[H.sizeVec3++]=k}let j=this._pool;if(D!=null){if(D.zero(),j.sizeVec3==j.stackVec3.length){let it=new Array(j.sizeVec3<<1),et=0,G=j.sizeVec3;for(;et<G;){let W=et++;it[W]=j.stackVec3[W],j.stackVec3[W]=null}j.stackVec3=it}j.stackVec3[j.sizeVec3++]=D}}_drawEllipseOnSphere(t,e,i,n,s,o,r,_,a){let l=0,h=this._pool,u=h.sizeVec3==0?new I.common.Vec3:h.stackVec3[--h.sizeVec3],f=this._pool,m=f.sizeQuat==0?new I.common.Quat:f.stackQuat[--f.sizeQuat],d=this._pool,p=d.sizeMat3==0?new I.common.Mat3:d.stackMat3[--d.sizeMat3],g=this._pool,x=g.sizeVec3==0?new I.common.Vec3:g.stackVec3[--g.sizeVec3],b=0;for(;b<17;){let X=b++,w=Math.cos(l)*o,S=Math.sin(l)*r,V=Math.sqrt(w*w+S*S),F=Math.sin(V*.5),C=Math.cos(V*.5),A=u.zero();A.x+=n.x*w,A.y+=n.y*w,A.z+=n.z*w,A.x+=s.x*S,A.y+=s.y*S,A.z+=s.z*S;let Z=1/V*F;u.x*=Z,u.y*=Z,u.z*=Z,m.x=u.x,m.y=u.y,m.z=u.z,m.w=C;let L=m.x,E=m.y,T=m.z,P=m.w,N=2*L,R=2*E,k=2*T,O=L*N,v=E*R,D=T*k,B=L*R,U=E*k,q=L*k,tt=P*N,Q=P*R,nt=P*k;p.e00=1-v-D,p.e01=B-nt,p.e02=q+Q,p.e10=B+nt,p.e11=1-O-D,p.e12=U-tt,p.e20=q-Q,p.e21=U+tt,p.e22=1-O-v;let H=this._pool,j=H.sizeVec3==0?new I.common.Vec3:H.stackVec3[--H.sizeVec3];j.x+=i.x*_,j.y+=i.y*_,j.z+=i.z*_;let it=j,et=it.x*p.e10+it.y*p.e11+it.z*p.e12,G=it.x*p.e20+it.y*p.e21+it.z*p.e22;it.x=it.x*p.e00+it.y*p.e01+it.z*p.e02,it.y=et,it.z=G,it.x+=e.x,it.y+=e.y,it.z+=e.z,X>=1&&t.line(x,it,a);let W=this._pool;if(x!=null){if(x.zero(),W.sizeVec3==W.stackVec3.length){let lt=new Array(W.sizeVec3<<1),ht=0,ft=W.sizeVec3;for(;ht<ft;){let pt=ht++;lt[pt]=W.stackVec3[pt],W.stackVec3[pt]=null}W.stackVec3=lt}W.stackVec3[W.sizeVec3++]=x}x=it,l+=.39269908169872375}let y=this._pool;if(u!=null){if(u.zero(),y.sizeVec3==y.stackVec3.length){let X=new Array(y.sizeVec3<<1),w=0,S=y.sizeVec3;for(;w<S;){let V=w++;X[V]=y.stackVec3[V],y.stackVec3[V]=null}y.stackVec3=X}y.stackVec3[y.sizeVec3++]=u}let z=this._pool;if(m!=null){if(m.x=0,m.y=0,m.z=0,m.w=1,z.sizeQuat==z.stackQuat.length){let X=new Array(z.sizeQuat<<1),w=0,S=z.sizeQuat;for(;w<S;){let V=w++;X[V]=z.stackQuat[V],z.stackQuat[V]=null}z.stackQuat=X}z.stackQuat[z.sizeQuat++]=m}let M=this._pool;if(p!=null){if(p.e00=1,p.e01=0,p.e02=0,p.e10=0,p.e11=1,p.e12=0,p.e20=0,p.e21=0,p.e22=1,M.sizeMat3==M.stackMat3.length){let X=new Array(M.sizeMat3<<1),w=0,S=M.sizeMat3;for(;w<S;){let V=w++;X[V]=M.stackMat3[V],M.stackMat3[V]=null}M.stackMat3=X}M.stackMat3[M.sizeMat3++]=p}let Y=this._pool;if(x!=null){if(x.zero(),Y.sizeVec3==Y.stackVec3.length){let X=new Array(Y.sizeVec3<<1),w=0,S=Y.sizeVec3;for(;w<S;){let V=w++;X[V]=Y.stackVec3[V],Y.stackVec3[V]=null}Y.stackVec3=X}Y.stackVec3[Y.sizeVec3++]=x}}step(t){this._timeStep.dt>0&&(this._timeStep.dtRatio=t/this._timeStep.dt),this._timeStep.dt=t,this._timeStep.invDt=1/t;let e=Date.now()/1e3;this._updateContacts(),this._solveIslands(),I.dynamics.common.Performance.totalTime=(Date.now()/1e3-e)*1e3}addRigidBody(t){if(t._world!=null)throw new Error("A rigid body cannot belong to multiple worlds.");this._rigidBodyList==null?(this._rigidBodyList=t,this._rigidBodyListLast=t):(this._rigidBodyListLast._next=t,t._prev=this._rigidBodyListLast,this._rigidBodyListLast=t),t._world=this;let e=t._shapeList;for(;e!=null;){let i=e._next;e._proxy=this._broadPhase.createProxy(e,e._aabb),e._id=this._shapeIdCount++,this._numShapes++,e=i}this._numRigidBodies++}removeRigidBody(t){if(t._world!=this)throw new Error("The rigid body doesn't belong to the world.");let e=t._prev,i=t._next;e!=null&&(e._next=i),i!=null&&(i._prev=e),t==this._rigidBodyList&&(this._rigidBodyList=this._rigidBodyList._next),t==this._rigidBodyListLast&&(this._rigidBodyListLast=this._rigidBodyListLast._prev),t._next=null,t._prev=null,t._world=null;let n=t._shapeList;for(;n!=null;){let s=n._next;this._broadPhase.destroyProxy(n._proxy),n._proxy=null,n._id=-1;let o=n._rigidBody._contactLinkList;for(;o!=null;){let r=o._next,_=o._contact;if(_._s1==n||_._s2==n){let a=o._other;a._sleeping=!1,a._sleepTime=0;let l=this._contactManager,h=_._prev,u=_._next;if(h!=null&&(h._next=u),u!=null&&(u._prev=h),_==l._contactList&&(l._contactList=l._contactList._next),_==l._contactListLast&&(l._contactListLast=l._contactListLast._prev),_._next=null,_._prev=null,_._touching){let x=_._s1._contactCallback,b=_._s2._contactCallback;x==b&&(b=null),x!=null&&x.endContact(_),b!=null&&b.endContact(_)}let f=_._link1._prev,m=_._link1._next;f!=null&&(f._next=m),m!=null&&(m._prev=f),_._link1==_._b1._contactLinkList&&(_._b1._contactLinkList=_._b1._contactLinkList._next),_._link1==_._b1._contactLinkListLast&&(_._b1._contactLinkListLast=_._b1._contactLinkListLast._prev),_._link1._next=null,_._link1._prev=null;let d=_._link2._prev,p=_._link2._next;d!=null&&(d._next=p),p!=null&&(p._prev=d),_._link2==_._b2._contactLinkList&&(_._b2._contactLinkList=_._b2._contactLinkList._next),_._link2==_._b2._contactLinkListLast&&(_._b2._contactLinkListLast=_._b2._contactLinkListLast._prev),_._link2._next=null,_._link2._prev=null,_._b1._numContactLinks--,_._b2._numContactLinks--,_._link1._other=null,_._link2._other=null,_._link1._contact=null,_._link2._contact=null,_._s1=null,_._s2=null,_._b1=null,_._b2=null,_._touching=!1,_._cachedDetectorData._clear(),_._manifold._clear(),_._detector=null;let g=_._contactConstraint;g._s1=null,g._s2=null,g._b1=null,g._b2=null,g._tf1=null,g._tf2=null,_._next=l._contactPool,l._contactPool=_,l._numContacts--}o=r}this._numShapes--,n=s}this._numRigidBodies--}addJoint(t){if(t._world!=null)throw new Error("A joint cannot belong to multiple worlds.");this._jointList==null?(this._jointList=t,this._jointListLast=t):(this._jointListLast._next=t,t._prev=this._jointListLast,this._jointListLast=t),t._world=this,t._link1._other=t._b2,t._link2._other=t._b1,t._b1._jointLinkList==null?(t._b1._jointLinkList=t._link1,t._b1._jointLinkListLast=t._link1):(t._b1._jointLinkListLast._next=t._link1,t._link1._prev=t._b1._jointLinkListLast,t._b1._jointLinkListLast=t._link1),t._b2._jointLinkList==null?(t._b2._jointLinkList=t._link2,t._b2._jointLinkListLast=t._link2):(t._b2._jointLinkListLast._next=t._link2,t._link2._prev=t._b2._jointLinkListLast,t._b2._jointLinkListLast=t._link2),t._b1._numJointLinks++,t._b2._numJointLinks++;let e=t._b1;e._sleeping=!1,e._sleepTime=0;let i=t._b2;i._sleeping=!1,i._sleepTime=0,t._syncAnchors(),this._numJoints++}removeJoint(t){if(t._world!=this)throw new Error("The joint doesn't belong to the world.");let e=t._prev,i=t._next;e!=null&&(e._next=i),i!=null&&(i._prev=e),t==this._jointList&&(this._jointList=this._jointList._next),t==this._jointListLast&&(this._jointListLast=this._jointListLast._prev),t._next=null,t._prev=null,t._world=null;let n=t._link1._prev,s=t._link1._next;n!=null&&(n._next=s),s!=null&&(s._prev=n),t._link1==t._b1._jointLinkList&&(t._b1._jointLinkList=t._b1._jointLinkList._next),t._link1==t._b1._jointLinkListLast&&(t._b1._jointLinkListLast=t._b1._jointLinkListLast._prev),t._link1._next=null,t._link1._prev=null;let o=t._link2._prev,r=t._link2._next;o!=null&&(o._next=r),r!=null&&(r._prev=o),t._link2==t._b2._jointLinkList&&(t._b2._jointLinkList=t._b2._jointLinkList._next),t._link2==t._b2._jointLinkListLast&&(t._b2._jointLinkListLast=t._b2._jointLinkListLast._prev),t._link2._next=null,t._link2._prev=null,t._link1._other=null,t._link2._other=null,t._b1._numJointLinks--,t._b2._numJointLinks--;let _=t._b1;_._sleeping=!1,_._sleepTime=0;let a=t._b2;a._sleeping=!1,a._sleepTime=0,this._numJoints--}setDebugDraw(t){this._debugDraw=t}getDebugDraw(){return this._debugDraw}debugDraw(){this._debugDraw!=null&&(this._broadPhase._type==2&&this._drawBvh(this._debugDraw,this._broadPhase._tree),this._drawRigidBodies(this._debugDraw),this._drawConstraints(this._debugDraw))}rayCast(t,e,i){let n=this._rayCastWrapper.begin;n.x=t.x,n.y=t.y,n.z=t.z;let s=this._rayCastWrapper.end;s.x=e.x,s.y=e.y,s.z=e.z,this._rayCastWrapper.callback=i,this._broadPhase.rayCast(t,e,this._rayCastWrapper)}convexCast(t,e,i,n){this._convexCastWrapper.convex=t;let s=this._convexCastWrapper.begin;s._positionX=e._positionX,s._positionY=e._positionY,s._positionZ=e._positionZ,s._rotation00=e._rotation00,s._rotation01=e._rotation01,s._rotation02=e._rotation02,s._rotation10=e._rotation10,s._rotation11=e._rotation11,s._rotation12=e._rotation12,s._rotation20=e._rotation20,s._rotation21=e._rotation21,s._rotation22=e._rotation22;let o=this._convexCastWrapper.translation;o.x=i.x,o.y=i.y,o.z=i.z,this._convexCastWrapper.callback=n,this._broadPhase.convexCast(t,e,i,this._convexCastWrapper)}aabbTest(t,e){this._aabbTestWrapper._aabb.copyFrom(t),this._aabbTestWrapper._callback=e,this._broadPhase.aabbTest(t,this._aabbTestWrapper)}getRigidBodyList(){return this._rigidBodyList}getJointList(){return this._jointList}getBroadPhase(){return this._broadPhase}getContactManager(){return this._contactManager}getNumRigidBodies(){return this._numRigidBodies}getNumJoints(){return this._numJoints}getNumShapes(){return this._numShapes}getNumIslands(){return this._numIslands}getNumVelocityIterations(){return this._numVelocityIterations}setNumVelocityIterations(t){this._numVelocityIterations=t}getNumPositionIterations(){return this._numPositionIterations}setNumPositionIterations(t){this._numPositionIterations=t}getGravity(){return this._gravity}setGravity(t){let e=this._gravity;e.x=t.x,e.y=t.y,e.z=t.z}};I.dynamics._World||(I.dynamics._World={});I.dynamics._World.RayCastWrapper=class extends I.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new I.collision.geometry.RayCastHit,this.begin=new I.common.Vec3,this.end=new I.common.Vec3,this.callback=null}process(t){let e=t.userData;e._geom.rayCast(this.begin,this.end,e._transform,this.rayCastHit)&&this.callback.process(e,this.rayCastHit)}};I.dynamics._World.ConvexCastWrapper=class extends I.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new I.collision.geometry.RayCastHit,this.begin=new I.common.Transform,this.translation=new I.common.Vec3,this.zero=new I.common.Vec3,this.callback=null,this.convex=null}process(t){let e=t.userData,i=e._geom._type;i<0||i>5||I.collision.narrowphase.detector.gjkepa.GjkEpa.instance.convexCast(this.convex,e._geom,this.begin,e._transform,this.translation,this.zero,this.rayCastHit)&&this.callback.process(e,this.rayCastHit)}};I.dynamics._World.AabbTestWrapper=class extends I.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this._aabb=new I.collision.geometry.Aabb,this._callback=null}process(t){let e=t.userData,i=e._aabb;i._minX<this._aabb._maxX&&i._maxX>this._aabb._minX&&i._minY<this._aabb._maxY&&i._maxY>this._aabb._minY&&i._minZ<this._aabb._maxZ&&i._maxZ>this._aabb._minZ&&this._callback.process(e)}};I.dynamics.callback||(I.dynamics.callback={});I.dynamics.callback.AabbTestCallback=class{constructor(){}process(t){}};I.dynamics.callback.ContactCallback=class{constructor(){}beginContact(t){}preSolve(t){}postSolve(t){}endContact(t){}};I.dynamics.callback.RayCastCallback=class{constructor(){}process(t,e){}};I.dynamics.callback.RayCastClosest=class extends I.dynamics.callback.RayCastCallback{constructor(){super(),this.position=new I.common.Vec3,this.normal=new I.common.Vec3,this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}clear(){this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}process(t,e){if(e.fraction<this.fraction){this.shape=t,this.hit=!0,this.fraction=e.fraction;let i=this.position,n=e.position;i.x=n.x,i.y=n.y,i.z=n.z;let s=this.normal,o=e.normal;s.x=o.x,s.y=o.y,s.z=o.z}}};I.dynamics.common||(I.dynamics.common={});I.dynamics.common.DebugDraw=class{constructor(){this.p=new I.common.Pool,this.wireframe=!1,this.drawShapes=!0,this.drawBvh=!1,this.drawBvhMinLevel=0,this.drawBvhMaxLevel=65536,this.drawAabbs=!1,this.drawBases=!1,this.drawPairs=!1,this.drawContacts=!1,this.drawJoints=!0,this.drawJointLimits=!1,this.sphereCoords=new Array(5),this.tmpSphereVerts=new Array(5),this.tmpSphereNorms=new Array(5);let t=0;for(;t<5;){let i=t++,n=i==0||i==4?1:8;this.sphereCoords[i]=new Array(n),this.tmpSphereVerts[i]=new Array(n),this.tmpSphereNorms[i]=new Array(n);let s=0;for(;s<8;){let o=s++,r=i*.7853981633974475,_=o*.7853981633974475;this.sphereCoords[i][o]=new I.common.Vec3(Math.sin(r)*Math.cos(_),Math.cos(r),-Math.sin(r)*Math.sin(_)),this.tmpSphereVerts[i][o]=new I.common.Vec3,this.tmpSphereNorms[i][o]=new I.common.Vec3}}this.circleCoords=new Array(8),this.circleCoordsShift=new Array(8),this.tmpCircleVerts1=new Array(8),this.tmpCircleVerts2=new Array(8),this.tmpCircleNorms=new Array(8);let e=0;for(;e<8;){let i=e++;this.circleCoords[i]=new I.common.Vec3(Math.cos(i*.7853981633974475),0,-Math.sin(i*.7853981633974475)),this.circleCoordsShift[i]=new I.common.Vec3(Math.cos((i+.5)*.7853981633974475),0,-Math.sin((i+.5)*.7853981633974475)),this.tmpCircleVerts1[i]=new I.common.Vec3,this.tmpCircleVerts2[i]=new I.common.Vec3,this.tmpCircleNorms[i]=new I.common.Vec3}this.style=new I.dynamics.common.DebugDrawStyle}aabb(t,e,i){let n=this.p,s=(n.sizeVec3==0?new I.common.Vec3:n.stackVec3[--n.sizeVec3]).init(t.x,t.y,t.z),o=this.p,r=(o.sizeVec3==0?new I.common.Vec3:o.stackVec3[--o.sizeVec3]).init(t.x,t.y,e.z),_=this.p,a=(_.sizeVec3==0?new I.common.Vec3:_.stackVec3[--_.sizeVec3]).init(t.x,e.y,t.z),l=this.p,h=(l.sizeVec3==0?new I.common.Vec3:l.stackVec3[--l.sizeVec3]).init(t.x,e.y,e.z),u=this.p,f=(u.sizeVec3==0?new I.common.Vec3:u.stackVec3[--u.sizeVec3]).init(e.x,t.y,t.z),m=this.p,d=(m.sizeVec3==0?new I.common.Vec3:m.stackVec3[--m.sizeVec3]).init(e.x,t.y,e.z),p=this.p,g=(p.sizeVec3==0?new I.common.Vec3:p.stackVec3[--p.sizeVec3]).init(e.x,e.y,t.z),x=this.p,b=(x.sizeVec3==0?new I.common.Vec3:x.stackVec3[--x.sizeVec3]).init(e.x,e.y,e.z);this.line(s,r,i),this.line(a,h,i),this.line(f,d,i),this.line(g,b,i),this.line(s,a,i),this.line(r,h,i),this.line(f,g,i),this.line(d,b,i),this.line(s,f,i),this.line(r,d,i),this.line(a,g,i),this.line(h,b,i);let y=this.p;if(s!=null){if(s.zero(),y.sizeVec3==y.stackVec3.length){let F=new Array(y.sizeVec3<<1),C=0,A=y.sizeVec3;for(;C<A;){let Z=C++;F[Z]=y.stackVec3[Z],y.stackVec3[Z]=null}y.stackVec3=F}y.stackVec3[y.sizeVec3++]=s}let z=this.p;if(r!=null){if(r.zero(),z.sizeVec3==z.stackVec3.length){let F=new Array(z.sizeVec3<<1),C=0,A=z.sizeVec3;for(;C<A;){let Z=C++;F[Z]=z.stackVec3[Z],z.stackVec3[Z]=null}z.stackVec3=F}z.stackVec3[z.sizeVec3++]=r}let M=this.p;if(a!=null){if(a.zero(),M.sizeVec3==M.stackVec3.length){let F=new Array(M.sizeVec3<<1),C=0,A=M.sizeVec3;for(;C<A;){let Z=C++;F[Z]=M.stackVec3[Z],M.stackVec3[Z]=null}M.stackVec3=F}M.stackVec3[M.sizeVec3++]=a}let Y=this.p;if(h!=null){if(h.zero(),Y.sizeVec3==Y.stackVec3.length){let F=new Array(Y.sizeVec3<<1),C=0,A=Y.sizeVec3;for(;C<A;){let Z=C++;F[Z]=Y.stackVec3[Z],Y.stackVec3[Z]=null}Y.stackVec3=F}Y.stackVec3[Y.sizeVec3++]=h}let X=this.p;if(f!=null){if(f.zero(),X.sizeVec3==X.stackVec3.length){let F=new Array(X.sizeVec3<<1),C=0,A=X.sizeVec3;for(;C<A;){let Z=C++;F[Z]=X.stackVec3[Z],X.stackVec3[Z]=null}X.stackVec3=F}X.stackVec3[X.sizeVec3++]=f}let w=this.p;if(d!=null){if(d.zero(),w.sizeVec3==w.stackVec3.length){let F=new Array(w.sizeVec3<<1),C=0,A=w.sizeVec3;for(;C<A;){let Z=C++;F[Z]=w.stackVec3[Z],w.stackVec3[Z]=null}w.stackVec3=F}w.stackVec3[w.sizeVec3++]=d}let S=this.p;if(g!=null){if(g.zero(),S.sizeVec3==S.stackVec3.length){let F=new Array(S.sizeVec3<<1),C=0,A=S.sizeVec3;for(;C<A;){let Z=C++;F[Z]=S.stackVec3[Z],S.stackVec3[Z]=null}S.stackVec3=F}S.stackVec3[S.sizeVec3++]=g}let V=this.p;if(b!=null){if(b.zero(),V.sizeVec3==V.stackVec3.length){let F=new Array(V.sizeVec3<<1),C=0,A=V.sizeVec3;for(;C<A;){let Z=C++;F[Z]=V.stackVec3[Z],V.stackVec3[Z]=null}V.stackVec3=F}V.stackVec3[V.sizeVec3++]=b}}basis(t,e,i,n,s){let o=this.p,r=o.sizeVec3==0?new I.common.Vec3:o.stackVec3[--o.sizeVec3],_=this.p,a=_.sizeMat3==0?new I.common.Mat3:_.stackMat3[--_.sizeMat3],l=this.p,h=l.sizeVec3==0?new I.common.Vec3:l.stackVec3[--l.sizeVec3],u=this.p,f=u.sizeVec3==0?new I.common.Vec3:u.stackVec3[--u.sizeVec3],m=this.p,d=m.sizeVec3==0?new I.common.Vec3:m.stackVec3[--m.sizeVec3],p=r;p.x=t._positionX,p.y=t._positionY,p.z=t._positionZ;let g=a;g.e00=t._rotation00,g.e01=t._rotation01,g.e02=t._rotation02,g.e10=t._rotation10,g.e11=t._rotation11,g.e12=t._rotation12,g.e20=t._rotation20,g.e21=t._rotation21,g.e22=t._rotation22,h.init(a.e00,a.e10,a.e20),f.init(a.e01,a.e11,a.e21),d.init(a.e02,a.e12,a.e22),h.x*=e,h.y*=e,h.z*=e;let x=h;x.x+=r.x,x.y+=r.y,x.z+=r.z,f.x*=e,f.y*=e,f.z*=e;let b=f;b.x+=r.x,b.y+=r.y,b.z+=r.z,d.x*=e,d.y*=e,d.z*=e;let y=d;y.x+=r.x,y.y+=r.y,y.z+=r.z,this.line(r,h,i),this.line(r,f,n),this.line(r,d,s);let z=this.p;if(r!=null){if(r.zero(),z.sizeVec3==z.stackVec3.length){let S=new Array(z.sizeVec3<<1),V=0,F=z.sizeVec3;for(;V<F;){let C=V++;S[C]=z.stackVec3[C],z.stackVec3[C]=null}z.stackVec3=S}z.stackVec3[z.sizeVec3++]=r}let M=this.p;if(a!=null){if(a.e00=1,a.e01=0,a.e02=0,a.e10=0,a.e11=1,a.e12=0,a.e20=0,a.e21=0,a.e22=1,M.sizeMat3==M.stackMat3.length){let S=new Array(M.sizeMat3<<1),V=0,F=M.sizeMat3;for(;V<F;){let C=V++;S[C]=M.stackMat3[C],M.stackMat3[C]=null}M.stackMat3=S}M.stackMat3[M.sizeMat3++]=a}let Y=this.p;if(h!=null){if(h.zero(),Y.sizeVec3==Y.stackVec3.length){let S=new Array(Y.sizeVec3<<1),V=0,F=Y.sizeVec3;for(;V<F;){let C=V++;S[C]=Y.stackVec3[C],Y.stackVec3[C]=null}Y.stackVec3=S}Y.stackVec3[Y.sizeVec3++]=h}let X=this.p;if(f!=null){if(f.zero(),X.sizeVec3==X.stackVec3.length){let S=new Array(X.sizeVec3<<1),V=0,F=X.sizeVec3;for(;V<F;){let C=V++;S[C]=X.stackVec3[C],X.stackVec3[C]=null}X.stackVec3=S}X.stackVec3[X.sizeVec3++]=f}let w=this.p;if(d!=null){if(d.zero(),w.sizeVec3==w.stackVec3.length){let S=new Array(w.sizeVec3<<1),V=0,F=w.sizeVec3;for(;V<F;){let C=V++;S[C]=w.stackVec3[C],w.stackVec3[C]=null}w.stackVec3=S}w.stackVec3[w.sizeVec3++]=d}}ellipse(t,e,i,n,s,o){this.arc(t,e,i,n,s,0,6.28318530717958,!1,o)}arc(t,e,i,n,s,o,r,_,a){let l=this.p,h=l.sizeVec3==0?new I.common.Vec3:l.stackVec3[--l.sizeVec3];h.x=e.x,h.y=e.y,h.z=e.z;let u=h;u.x*=n,u.y*=n,u.z*=n;let f=this.p,m=f.sizeVec3==0?new I.common.Vec3:f.stackVec3[--f.sizeVec3];m.x=i.x,m.y=i.y,m.z=i.z;let d=m;d.x*=s,d.y*=s,d.z*=s;let p=r-o;p<0&&(p=-p);let g=p/.5235987755982984+.5|0;g==0&&(g=1);let x=o,b=(r-o)/g,y=this.p,z=y.sizeVec3==0?new I.common.Vec3:y.stackVec3[--y.sizeVec3];z.x=t.x,z.y=t.y,z.z=t.z;let M=z,Y=Math.cos(o);M.x+=u.x*Y,M.y+=u.y*Y,M.z+=u.z*Y;let X=Math.sin(o);M.x+=d.x*X,M.y+=d.y*X,M.z+=d.z*X;let w=M;_&&this.line(t,M,a);let S=0,V=g;for(;S<V;){++S,x+=b;let Z=this.p,L=Z.sizeVec3==0?new I.common.Vec3:Z.stackVec3[--Z.sizeVec3];L.x=t.x,L.y=t.y,L.z=t.z;let E=L,T=Math.cos(x);E.x+=u.x*T,E.y+=u.y*T,E.z+=u.z*T;let P=Math.sin(x);E.x+=d.x*P,E.y+=d.y*P,E.z+=d.z*P,this.line(w,E,a);let N=this.p;if(w!=null){if(w.zero(),N.sizeVec3==N.stackVec3.length){let R=new Array(N.sizeVec3<<1),k=0,O=N.sizeVec3;for(;k<O;){let v=k++;R[v]=N.stackVec3[v],N.stackVec3[v]=null}N.stackVec3=R}N.stackVec3[N.sizeVec3++]=w}w=E}_&&this.line(t,w,a);let F=this.p;if(w!=null){if(w.zero(),F.sizeVec3==F.stackVec3.length){let Z=new Array(F.sizeVec3<<1),L=0,E=F.sizeVec3;for(;L<E;){let T=L++;Z[T]=F.stackVec3[T],F.stackVec3[T]=null}F.stackVec3=Z}F.stackVec3[F.sizeVec3++]=w}let C=this.p;if(u!=null){if(u.zero(),C.sizeVec3==C.stackVec3.length){let Z=new Array(C.sizeVec3<<1),L=0,E=C.sizeVec3;for(;L<E;){let T=L++;Z[T]=C.stackVec3[T],C.stackVec3[T]=null}C.stackVec3=Z}C.stackVec3[C.sizeVec3++]=u}let A=this.p;if(d!=null){if(d.zero(),A.sizeVec3==A.stackVec3.length){let Z=new Array(A.sizeVec3<<1),L=0,E=A.sizeVec3;for(;L<E;){let T=L++;Z[T]=A.stackVec3[T],A.stackVec3[T]=null}A.stackVec3=Z}A.stackVec3[A.sizeVec3++]=d}}cone(t,e,i,n){let s=this.p,o=s.sizeVec3==0?new I.common.Vec3:s.stackVec3[--s.sizeVec3],r=this.p,_=r.sizeVec3==0?new I.common.Vec3:r.stackVec3[--r.sizeVec3],a=this.p,l=a.sizeVec3==0?new I.common.Vec3:a.stackVec3[--a.sizeVec3],h=this.p,u=h.sizeVec3==0?new I.common.Vec3:h.stackVec3[--h.sizeVec3],f=this.p,m=f.sizeMat3==0?new I.common.Mat3:f.stackMat3[--f.sizeMat3],d=u;d.x=t._positionX,d.y=t._positionY,d.z=t._positionZ;let p=m;p.e00=t._rotation00,p.e01=t._rotation01,p.e02=t._rotation02,p.e10=t._rotation10,p.e11=t._rotation11,p.e12=t._rotation12,p.e20=t._rotation20,p.e21=t._rotation21,p.e22=t._rotation22,o.init(m.e00,m.e10,m.e20),_.init(m.e01,m.e11,m.e21),l.init(m.e02,m.e12,m.e22);let g=this.p,x=g.sizeVec3==0?new I.common.Vec3:g.stackVec3[--g.sizeVec3];x.x=u.x,x.y=u.y,x.z=u.z;let b=x;b.x+=_.x*i,b.y+=_.y*i,b.z+=_.z*i;let y=this.p,z=y.sizeVec3==0?new I.common.Vec3:y.stackVec3[--y.sizeVec3];z.x=u.x,z.y=u.y,z.z=u.z;let M=z,Y=-i;if(M.x+=_.x*Y,M.y+=_.y*Y,M.z+=_.z*Y,this.wireframe){let Z=this.p,L=Z.sizeVec3==0?new I.common.Vec3:Z.stackVec3[--Z.sizeVec3];L.x=M.x,L.y=M.y,L.z=M.z;let E=L,T=-e;E.x+=o.x*T,E.y+=o.y*T,E.z+=o.z*T,E.x+=l.x*0,E.y+=l.y*0,E.z+=l.z*0;let P=this.p,N=P.sizeVec3==0?new I.common.Vec3:P.stackVec3[--P.sizeVec3];N.x=M.x,N.y=M.y,N.z=M.z;let R=N;R.x+=o.x*e,R.y+=o.y*e,R.z+=o.z*e,R.x+=l.x*0,R.y+=l.y*0,R.z+=l.z*0;let k=this.p,O=k.sizeVec3==0?new I.common.Vec3:k.stackVec3[--k.sizeVec3];O.x=M.x,O.y=M.y,O.z=M.z;let v=O;v.x+=o.x*0,v.y+=o.y*0,v.z+=o.z*0;let D=-e;v.x+=l.x*D,v.y+=l.y*D,v.z+=l.z*D;let B=this.p,U=B.sizeVec3==0?new I.common.Vec3:B.stackVec3[--B.sizeVec3];U.x=M.x,U.y=M.y,U.z=M.z;let q=U;q.x+=o.x*0,q.y+=o.y*0,q.z+=o.z*0,q.x+=l.x*e,q.y+=l.y*e,q.z+=l.z*e,this.ellipse(M,o,l,e,e,n),this.line(b,E,n),this.line(b,R,n),this.line(b,v,n),this.line(b,q,n);let tt=this.p;if(E!=null){if(E.zero(),tt.sizeVec3==tt.stackVec3.length){let j=new Array(tt.sizeVec3<<1),it=0,et=tt.sizeVec3;for(;it<et;){let G=it++;j[G]=tt.stackVec3[G],tt.stackVec3[G]=null}tt.stackVec3=j}tt.stackVec3[tt.sizeVec3++]=E}let Q=this.p;if(R!=null){if(R.zero(),Q.sizeVec3==Q.stackVec3.length){let j=new Array(Q.sizeVec3<<1),it=0,et=Q.sizeVec3;for(;it<et;){let G=it++;j[G]=Q.stackVec3[G],Q.stackVec3[G]=null}Q.stackVec3=j}Q.stackVec3[Q.sizeVec3++]=R}let nt=this.p;if(v!=null){if(v.zero(),nt.sizeVec3==nt.stackVec3.length){let j=new Array(nt.sizeVec3<<1),it=0,et=nt.sizeVec3;for(;it<et;){let G=it++;j[G]=nt.stackVec3[G],nt.stackVec3[G]=null}nt.stackVec3=j}nt.stackVec3[nt.sizeVec3++]=v}let H=this.p;if(q!=null){if(q.zero(),H.sizeVec3==H.stackVec3.length){let j=new Array(H.sizeVec3<<1),it=0,et=H.sizeVec3;for(;it<et;){let G=it++;j[G]=H.stackVec3[G],H.stackVec3[G]=null}H.stackVec3=j}H.stackVec3[H.sizeVec3++]=q}}else{let Z=1/Math.sqrt(e*e+4*i*i),L=2*i*Z,E=e*Z,T=0;for(;T<8;){let N=T++,R=this.tmpCircleNorms[N],k=this.circleCoords[N];R.x=k.x,R.y=k.y,R.z=k.z,R.x*=L,R.y*=L,R.z*=L,R.y+=E;let O=this.tmpCircleNorms[N],v=O.x*m.e10+O.y*m.e11+O.z*m.e12,D=O.x*m.e20+O.y*m.e21+O.z*m.e22;O.x=O.x*m.e00+O.y*m.e01+O.z*m.e02,O.y=v,O.z=D;let B=this.tmpCircleVerts1[N],U=this.circleCoordsShift[N];B.x=U.x,B.y=U.y,B.z=U.z,B.x*=L,B.y*=L,B.z*=L,B.y+=E;let q=this.tmpCircleVerts1[N],tt=q.x*m.e10+q.y*m.e11+q.z*m.e12,Q=q.x*m.e20+q.y*m.e21+q.z*m.e22;q.x=q.x*m.e00+q.y*m.e01+q.z*m.e02,q.y=tt,q.z=Q;let nt=this.tmpCircleVerts2[N],H=this.circleCoords[N];nt.x=H.x,nt.y=H.y,nt.z=H.z;let j=nt.x*m.e10+nt.y*m.e11+nt.z*m.e12,it=nt.x*m.e20+nt.y*m.e21+nt.z*m.e22;nt.x=nt.x*m.e00+nt.y*m.e01+nt.z*m.e02,nt.y=j,nt.z=it,nt.x*=e,nt.y*=e,nt.z*=e,nt.x+=u.x,nt.y+=u.y,nt.z+=u.z;let et=this.tmpCircleVerts2[N],G=-i;et.x+=_.x*G,et.y+=_.y*G,et.z+=_.z*G}let P=0;for(;P<8;){let N=P++,R=this.tmpCircleVerts2[N],k=this.tmpCircleVerts2[(N+1)%8],O=this.tmpCircleVerts1[N];this.triangle(b,R,k,O,this.tmpCircleNorms[N],this.tmpCircleNorms[(N+1)%8],n),R=this.tmpCircleVerts2[(N+1)%8],k=this.tmpCircleVerts2[N];let v=this.p,D=v.sizeVec3==0?new I.common.Vec3:v.stackVec3[--v.sizeVec3];D.x=_.x,D.y=_.y,D.z=_.z;let B=D;B.x=-B.x,B.y=-B.y,B.z=-B.z,this.triangle(M,R,k,B,B,B,n);let U=this.p;if(B!=null){if(B.zero(),U.sizeVec3==U.stackVec3.length){let q=new Array(U.sizeVec3<<1),tt=0,Q=U.sizeVec3;for(;tt<Q;){let nt=tt++;q[nt]=U.stackVec3[nt],U.stackVec3[nt]=null}U.stackVec3=q}U.stackVec3[U.sizeVec3++]=B}}}let X=this.p;if(b!=null){if(b.zero(),X.sizeVec3==X.stackVec3.length){let Z=new Array(X.sizeVec3<<1),L=0,E=X.sizeVec3;for(;L<E;){let T=L++;Z[T]=X.stackVec3[T],X.stackVec3[T]=null}X.stackVec3=Z}X.stackVec3[X.sizeVec3++]=b}let w=this.p;if(M!=null){if(M.zero(),w.sizeVec3==w.stackVec3.length){let Z=new Array(w.sizeVec3<<1),L=0,E=w.sizeVec3;for(;L<E;){let T=L++;Z[T]=w.stackVec3[T],w.stackVec3[T]=null}w.stackVec3=Z}w.stackVec3[w.sizeVec3++]=M}let S=this.p;if(u!=null){if(u.zero(),S.sizeVec3==S.stackVec3.length){let Z=new Array(S.sizeVec3<<1),L=0,E=S.sizeVec3;for(;L<E;){let T=L++;Z[T]=S.stackVec3[T],S.stackVec3[T]=null}S.stackVec3=Z}S.stackVec3[S.sizeVec3++]=u}let V=this.p;if(m!=null){if(m.e00=1,m.e01=0,m.e02=0,m.e10=0,m.e11=1,m.e12=0,m.e20=0,m.e21=0,m.e22=1,V.sizeMat3==V.stackMat3.length){let Z=new Array(V.sizeMat3<<1),L=0,E=V.sizeMat3;for(;L<E;){let T=L++;Z[T]=V.stackMat3[T],V.stackMat3[T]=null}V.stackMat3=Z}V.stackMat3[V.sizeMat3++]=m}let F=this.p;if(o!=null){if(o.zero(),F.sizeVec3==F.stackVec3.length){let Z=new Array(F.sizeVec3<<1),L=0,E=F.sizeVec3;for(;L<E;){let T=L++;Z[T]=F.stackVec3[T],F.stackVec3[T]=null}F.stackVec3=Z}F.stackVec3[F.sizeVec3++]=o}let C=this.p;if(_!=null){if(_.zero(),C.sizeVec3==C.stackVec3.length){let Z=new Array(C.sizeVec3<<1),L=0,E=C.sizeVec3;for(;L<E;){let T=L++;Z[T]=C.stackVec3[T],C.stackVec3[T]=null}C.stackVec3=Z}C.stackVec3[C.sizeVec3++]=_}let A=this.p;if(l!=null){if(l.zero(),A.sizeVec3==A.stackVec3.length){let Z=new Array(A.sizeVec3<<1),L=0,E=A.sizeVec3;for(;L<E;){let T=L++;Z[T]=A.stackVec3[T],A.stackVec3[T]=null}A.stackVec3=Z}A.stackVec3[A.sizeVec3++]=l}}cylinder(t,e,i,n){let s=this.p,o=s.sizeVec3==0?new I.common.Vec3:s.stackVec3[--s.sizeVec3],r=this.p,_=r.sizeVec3==0?new I.common.Vec3:r.stackVec3[--r.sizeVec3],a=this.p,l=a.sizeVec3==0?new I.common.Vec3:a.stackVec3[--a.sizeVec3],h=this.p,u=h.sizeVec3==0?new I.common.Vec3:h.stackVec3[--h.sizeVec3],f=this.p,m=f.sizeMat3==0?new I.common.Mat3:f.stackMat3[--f.sizeMat3],d=u;d.x=t._positionX,d.y=t._positionY,d.z=t._positionZ;let p=m;p.e00=t._rotation00,p.e01=t._rotation01,p.e02=t._rotation02,p.e10=t._rotation10,p.e11=t._rotation11,p.e12=t._rotation12,p.e20=t._rotation20,p.e21=t._rotation21,p.e22=t._rotation22,o.init(m.e00,m.e10,m.e20),_.init(m.e01,m.e11,m.e21),l.init(m.e02,m.e12,m.e22);let g=this.p,x=g.sizeVec3==0?new I.common.Vec3:g.stackVec3[--g.sizeVec3];x.x=u.x,x.y=u.y,x.z=u.z;let b=x;b.x+=_.x*i,b.y+=_.y*i,b.z+=_.z*i;let y=this.p,z=y.sizeVec3==0?new I.common.Vec3:y.stackVec3[--y.sizeVec3];z.x=u.x,z.y=u.y,z.z=u.z;let M=z,Y=-i;if(M.x+=_.x*Y,M.y+=_.y*Y,M.z+=_.z*Y,this.wireframe){let Z=this.p,L=Z.sizeVec3==0?new I.common.Vec3:Z.stackVec3[--Z.sizeVec3];L.x=b.x,L.y=b.y,L.z=b.z;let E=L,T=-e;E.x+=o.x*T,E.y+=o.y*T,E.z+=o.z*T,E.x+=l.x*0,E.y+=l.y*0,E.z+=l.z*0;let P=this.p,N=P.sizeVec3==0?new I.common.Vec3:P.stackVec3[--P.sizeVec3];N.x=b.x,N.y=b.y,N.z=b.z;let R=N;R.x+=o.x*e,R.y+=o.y*e,R.z+=o.z*e,R.x+=l.x*0,R.y+=l.y*0,R.z+=l.z*0;let k=this.p,O=k.sizeVec3==0?new I.common.Vec3:k.stackVec3[--k.sizeVec3];O.x=b.x,O.y=b.y,O.z=b.z;let v=O;v.x+=o.x*0,v.y+=o.y*0,v.z+=o.z*0;let D=-e;v.x+=l.x*D,v.y+=l.y*D,v.z+=l.z*D;let B=this.p,U=B.sizeVec3==0?new I.common.Vec3:B.stackVec3[--B.sizeVec3];U.x=b.x,U.y=b.y,U.z=b.z;let q=U;q.x+=o.x*0,q.y+=o.y*0,q.z+=o.z*0,q.x+=l.x*e,q.y+=l.y*e,q.z+=l.z*e;let tt=this.p,Q=tt.sizeVec3==0?new I.common.Vec3:tt.stackVec3[--tt.sizeVec3];Q.x=M.x,Q.y=M.y,Q.z=M.z;let nt=Q,H=-e;nt.x+=o.x*H,nt.y+=o.y*H,nt.z+=o.z*H,nt.x+=l.x*0,nt.y+=l.y*0,nt.z+=l.z*0;let j=this.p,it=j.sizeVec3==0?new I.common.Vec3:j.stackVec3[--j.sizeVec3];it.x=M.x,it.y=M.y,it.z=M.z;let et=it;et.x+=o.x*e,et.y+=o.y*e,et.z+=o.z*e,et.x+=l.x*0,et.y+=l.y*0,et.z+=l.z*0;let G=this.p,W=G.sizeVec3==0?new I.common.Vec3:G.stackVec3[--G.sizeVec3];W.x=M.x,W.y=M.y,W.z=M.z;let lt=W;lt.x+=o.x*0,lt.y+=o.y*0,lt.z+=o.z*0;let ht=-e;lt.x+=l.x*ht,lt.y+=l.y*ht,lt.z+=l.z*ht;let ft=this.p,pt=ft.sizeVec3==0?new I.common.Vec3:ft.stackVec3[--ft.sizeVec3];pt.x=M.x,pt.y=M.y,pt.z=M.z;let K=pt;K.x+=o.x*0,K.y+=o.y*0,K.z+=o.z*0,K.x+=l.x*e,K.y+=l.y*e,K.z+=l.z*e,this.ellipse(b,o,l,e,e,n),this.ellipse(M,o,l,e,e,n),this.line(E,nt,n),this.line(R,et,n),this.line(v,lt,n),this.line(q,K,n);let J=this.p;if(E!=null){if(E.zero(),J.sizeVec3==J.stackVec3.length){let zt=new Array(J.sizeVec3<<1),dt=0,st=J.sizeVec3;for(;dt<st;){let ct=dt++;zt[ct]=J.stackVec3[ct],J.stackVec3[ct]=null}J.stackVec3=zt}J.stackVec3[J.sizeVec3++]=E}let rt=this.p;if(R!=null){if(R.zero(),rt.sizeVec3==rt.stackVec3.length){let zt=new Array(rt.sizeVec3<<1),dt=0,st=rt.sizeVec3;for(;dt<st;){let ct=dt++;zt[ct]=rt.stackVec3[ct],rt.stackVec3[ct]=null}rt.stackVec3=zt}rt.stackVec3[rt.sizeVec3++]=R}let mt=this.p;if(v!=null){if(v.zero(),mt.sizeVec3==mt.stackVec3.length){let zt=new Array(mt.sizeVec3<<1),dt=0,st=mt.sizeVec3;for(;dt<st;){let ct=dt++;zt[ct]=mt.stackVec3[ct],mt.stackVec3[ct]=null}mt.stackVec3=zt}mt.stackVec3[mt.sizeVec3++]=v}let xt=this.p;if(q!=null){if(q.zero(),xt.sizeVec3==xt.stackVec3.length){let zt=new Array(xt.sizeVec3<<1),dt=0,st=xt.sizeVec3;for(;dt<st;){let ct=dt++;zt[ct]=xt.stackVec3[ct],xt.stackVec3[ct]=null}xt.stackVec3=zt}xt.stackVec3[xt.sizeVec3++]=q}let vt=this.p;if(nt!=null){if(nt.zero(),vt.sizeVec3==vt.stackVec3.length){let zt=new Array(vt.sizeVec3<<1),dt=0,st=vt.sizeVec3;for(;dt<st;){let ct=dt++;zt[ct]=vt.stackVec3[ct],vt.stackVec3[ct]=null}vt.stackVec3=zt}vt.stackVec3[vt.sizeVec3++]=nt}let Mt=this.p;if(et!=null){if(et.zero(),Mt.sizeVec3==Mt.stackVec3.length){let zt=new Array(Mt.sizeVec3<<1),dt=0,st=Mt.sizeVec3;for(;dt<st;){let ct=dt++;zt[ct]=Mt.stackVec3[ct],Mt.stackVec3[ct]=null}Mt.stackVec3=zt}Mt.stackVec3[Mt.sizeVec3++]=et}let ut=this.p;if(lt!=null){if(lt.zero(),ut.sizeVec3==ut.stackVec3.length){let zt=new Array(ut.sizeVec3<<1),dt=0,st=ut.sizeVec3;for(;dt<st;){let ct=dt++;zt[ct]=ut.stackVec3[ct],ut.stackVec3[ct]=null}ut.stackVec3=zt}ut.stackVec3[ut.sizeVec3++]=lt}let Zt=this.p;if(K!=null){if(K.zero(),Zt.sizeVec3==Zt.stackVec3.length){let zt=new Array(Zt.sizeVec3<<1),dt=0,st=Zt.sizeVec3;for(;dt<st;){let ct=dt++;zt[ct]=Zt.stackVec3[ct],Zt.stackVec3[ct]=null}Zt.stackVec3=zt}Zt.stackVec3[Zt.sizeVec3++]=K}}else{let Z=0;for(;Z<8;){let E=Z++,T=this.tmpCircleNorms[E],P=this.circleCoords[E];T.x=P.x,T.y=P.y,T.z=P.z;let N=T.x*m.e10+T.y*m.e11+T.z*m.e12,R=T.x*m.e20+T.y*m.e21+T.z*m.e22;T.x=T.x*m.e00+T.y*m.e01+T.z*m.e02,T.y=N,T.z=R;let k=this.tmpCircleVerts1[E],O=this.tmpCircleNorms[E];k.x=O.x,k.y=O.y,k.z=O.z,k.x*=e,k.y*=e,k.z*=e,k.x+=u.x,k.y+=u.y,k.z+=u.z;let v=this.tmpCircleVerts2[E],D=this.tmpCircleVerts1[E];v.x=D.x,v.y=D.y,v.z=D.z;let B=this.tmpCircleVerts1[E];B.x+=_.x*i,B.y+=_.y*i,B.z+=_.z*i;let U=this.tmpCircleVerts2[E],q=-i;U.x+=_.x*q,U.y+=_.y*q,U.z+=_.z*q}let L=0;for(;L<8;){let E=L++,T,P=this.tmpCircleVerts1[E],N=this.tmpCircleVerts1[(E+1)%8],R=_;this.triangle(b,P,N,R,R,R,n),P=this.tmpCircleVerts2[(E+1)%8],N=this.tmpCircleVerts2[E];let k=this.p,O=k.sizeVec3==0?new I.common.Vec3:k.stackVec3[--k.sizeVec3];O.x=_.x,O.y=_.y,O.z=_.z;let v=O;v.x=-v.x,v.y=-v.y,v.z=-v.z,this.triangle(M,P,N,v,v,v,n);let D=this.p;if(v!=null){if(v.zero(),D.sizeVec3==D.stackVec3.length){let U=new Array(D.sizeVec3<<1),q=0,tt=D.sizeVec3;for(;q<tt;){let Q=q++;U[Q]=D.stackVec3[Q],D.stackVec3[Q]=null}D.stackVec3=U}D.stackVec3[D.sizeVec3++]=v}T=this.tmpCircleVerts1[E],P=this.tmpCircleVerts2[E],N=this.tmpCircleVerts2[(E+1)%8],R=this.tmpCircleNorms[E];let B=this.tmpCircleNorms[(E+1)%8];this.rect(T,P,N,this.tmpCircleVerts1[(E+1)%8],R,R,B,B,n)}}let X=this.p;if(b!=null){if(b.zero(),X.sizeVec3==X.stackVec3.length){let Z=new Array(X.sizeVec3<<1),L=0,E=X.sizeVec3;for(;L<E;){let T=L++;Z[T]=X.stackVec3[T],X.stackVec3[T]=null}X.stackVec3=Z}X.stackVec3[X.sizeVec3++]=b}let w=this.p;if(M!=null){if(M.zero(),w.sizeVec3==w.stackVec3.length){let Z=new Array(w.sizeVec3<<1),L=0,E=w.sizeVec3;for(;L<E;){let T=L++;Z[T]=w.stackVec3[T],w.stackVec3[T]=null}w.stackVec3=Z}w.stackVec3[w.sizeVec3++]=M}let S=this.p;if(u!=null){if(u.zero(),S.sizeVec3==S.stackVec3.length){let Z=new Array(S.sizeVec3<<1),L=0,E=S.sizeVec3;for(;L<E;){let T=L++;Z[T]=S.stackVec3[T],S.stackVec3[T]=null}S.stackVec3=Z}S.stackVec3[S.sizeVec3++]=u}let V=this.p;if(m!=null){if(m.e00=1,m.e01=0,m.e02=0,m.e10=0,m.e11=1,m.e12=0,m.e20=0,m.e21=0,m.e22=1,V.sizeMat3==V.stackMat3.length){let Z=new Array(V.sizeMat3<<1),L=0,E=V.sizeMat3;for(;L<E;){let T=L++;Z[T]=V.stackMat3[T],V.stackMat3[T]=null}V.stackMat3=Z}V.stackMat3[V.sizeMat3++]=m}let F=this.p;if(o!=null){if(o.zero(),F.sizeVec3==F.stackVec3.length){let Z=new Array(F.sizeVec3<<1),L=0,E=F.sizeVec3;for(;L<E;){let T=L++;Z[T]=F.stackVec3[T],F.stackVec3[T]=null}F.stackVec3=Z}F.stackVec3[F.sizeVec3++]=o}let C=this.p;if(_!=null){if(_.zero(),C.sizeVec3==C.stackVec3.length){let Z=new Array(C.sizeVec3<<1),L=0,E=C.sizeVec3;for(;L<E;){let T=L++;Z[T]=C.stackVec3[T],C.stackVec3[T]=null}C.stackVec3=Z}C.stackVec3[C.sizeVec3++]=_}let A=this.p;if(l!=null){if(l.zero(),A.sizeVec3==A.stackVec3.length){let Z=new Array(A.sizeVec3<<1),L=0,E=A.sizeVec3;for(;L<E;){let T=L++;Z[T]=A.stackVec3[T],A.stackVec3[T]=null}A.stackVec3=Z}A.stackVec3[A.sizeVec3++]=l}}capsule(t,e,i,n){let s=this.p,o=s.sizeVec3==0?new I.common.Vec3:s.stackVec3[--s.sizeVec3],r=this.p,_=r.sizeVec3==0?new I.common.Vec3:r.stackVec3[--r.sizeVec3],a=this.p,l=a.sizeVec3==0?new I.common.Vec3:a.stackVec3[--a.sizeVec3],h=this.p,u=h.sizeVec3==0?new I.common.Vec3:h.stackVec3[--h.sizeVec3],f=this.p,m=f.sizeMat3==0?new I.common.Mat3:f.stackMat3[--f.sizeMat3],d=u;d.x=t._positionX,d.y=t._positionY,d.z=t._positionZ;let p=m;p.e00=t._rotation00,p.e01=t._rotation01,p.e02=t._rotation02,p.e10=t._rotation10,p.e11=t._rotation11,p.e12=t._rotation12,p.e20=t._rotation20,p.e21=t._rotation21,p.e22=t._rotation22,o.init(m.e00,m.e10,m.e20),_.init(m.e01,m.e11,m.e21),l.init(m.e02,m.e12,m.e22);let g=this.tmpSphereVerts,x=this.tmpSphereNorms,b=0;for(;b<5;){let P=b++,N=this.tmpSphereVerts[P].length,R=0;for(;R<N;){let k=R++,O=x[P][k],v=this.sphereCoords[P][k];O.x=v.x,O.y=v.y,O.z=v.z;let D=O.x*m.e10+O.y*m.e11+O.z*m.e12,B=O.x*m.e20+O.y*m.e21+O.z*m.e22;O.x=O.x*m.e00+O.y*m.e01+O.z*m.e02,O.y=D,O.z=B}}let y=0;for(;y<4;){let P=y++;if(P==0){let R=0;for(;R<3;){let k=R++,O=this.tmpSphereVerts[k].length,v=0;for(;v<O;){let D=v++,B=g[k][D],U=x[k][D];B.x=U.x,B.y=U.y,B.z=U.z,B.x*=e,B.y*=e,B.z*=e,B.x+=u.x,B.y+=u.y,B.z+=u.z,B.x+=_.x*i,B.y+=_.y*i,B.z+=_.z*i}}}if(P==2){let R=2;for(;R<5;){let k=R++,O=this.tmpSphereVerts[k].length,v=0;for(;v<O;){let D=v++,B=g[k][D],U=x[k][D];B.x=U.x,B.y=U.y,B.z=U.z,B.x*=e,B.y*=e,B.z*=e,B.x+=u.x,B.y+=u.y,B.z+=u.z;let q=-i;B.x+=_.x*q,B.y+=_.y*q,B.z+=_.z*q}}}let N=0;for(;N<8;){let R=N++,k,O,v,D,B,U,q,tt;P==0?this.wireframe?(k=g[0][0],O=g[1][R],this.line(k,O,n)):(k=g[0][0],O=g[1][R],v=g[1][(R+1)%8],B=x[0][0],U=x[1][R],q=x[1][(R+1)%8],this.triangle(k,O,v,B,U,q,n)):P==3?this.wireframe?(k=g[4][0],O=g[P][(R+1)%8],v=g[P][R],this.line(k,O,n),this.line(O,v,n)):(k=g[4][0],O=g[P][(R+1)%8],v=g[P][R],B=x[4][0],U=x[P][(R+1)%8],q=x[P][R],this.triangle(k,O,v,B,U,q,n)):this.wireframe?(k=g[P][R],O=g[P][(R+1)%8],v=g[P+1][R],this.line(k,O,n),this.line(k,v,n)):(k=g[P][R],O=g[P][(R+1)%8],v=g[P+1][R],D=g[P+1][(R+1)%8],B=x[P][R],U=x[P][(R+1)%8],q=x[P+1][R],tt=x[P+1][(R+1)%8],this.rect(k,v,D,O,B,q,tt,U,n))}}let z=this.p,M=z.sizeVec3==0?new I.common.Vec3:z.stackVec3[--z.sizeVec3];M.x=u.x,M.y=u.y,M.z=u.z;let Y=M;Y.x+=_.x*i,Y.y+=_.y*i,Y.z+=_.z*i;let X=this.p,w=X.sizeVec3==0?new I.common.Vec3:X.stackVec3[--X.sizeVec3];w.x=u.x,w.y=u.y,w.z=u.z;let S=w,V=-i;if(S.x+=_.x*V,S.y+=_.y*V,S.z+=_.z*V,this.wireframe){let P=this.p,N=P.sizeVec3==0?new I.common.Vec3:P.stackVec3[--P.sizeVec3];N.x=Y.x,N.y=Y.y,N.z=Y.z;let R=N,k=-e;R.x+=o.x*k,R.y+=o.y*k,R.z+=o.z*k,R.x+=l.x*0,R.y+=l.y*0,R.z+=l.z*0;let O=this.p,v=O.sizeVec3==0?new I.common.Vec3:O.stackVec3[--O.sizeVec3];v.x=Y.x,v.y=Y.y,v.z=Y.z;let D=v;D.x+=o.x*e,D.y+=o.y*e,D.z+=o.z*e,D.x+=l.x*0,D.y+=l.y*0,D.z+=l.z*0;let B=this.p,U=B.sizeVec3==0?new I.common.Vec3:B.stackVec3[--B.sizeVec3];U.x=Y.x,U.y=Y.y,U.z=Y.z;let q=U;q.x+=o.x*0,q.y+=o.y*0,q.z+=o.z*0;let tt=-e;q.x+=l.x*tt,q.y+=l.y*tt,q.z+=l.z*tt;let Q=this.p,nt=Q.sizeVec3==0?new I.common.Vec3:Q.stackVec3[--Q.sizeVec3];nt.x=Y.x,nt.y=Y.y,nt.z=Y.z;let H=nt;H.x+=o.x*0,H.y+=o.y*0,H.z+=o.z*0,H.x+=l.x*e,H.y+=l.y*e,H.z+=l.z*e;let j=this.p,it=j.sizeVec3==0?new I.common.Vec3:j.stackVec3[--j.sizeVec3];it.x=S.x,it.y=S.y,it.z=S.z;let et=it,G=-e;et.x+=o.x*G,et.y+=o.y*G,et.z+=o.z*G,et.x+=l.x*0,et.y+=l.y*0,et.z+=l.z*0;let W=this.p,lt=W.sizeVec3==0?new I.common.Vec3:W.stackVec3[--W.sizeVec3];lt.x=S.x,lt.y=S.y,lt.z=S.z;let ht=lt;ht.x+=o.x*e,ht.y+=o.y*e,ht.z+=o.z*e,ht.x+=l.x*0,ht.y+=l.y*0,ht.z+=l.z*0;let ft=this.p,pt=ft.sizeVec3==0?new I.common.Vec3:ft.stackVec3[--ft.sizeVec3];pt.x=S.x,pt.y=S.y,pt.z=S.z;let K=pt;K.x+=o.x*0,K.y+=o.y*0,K.z+=o.z*0;let J=-e;K.x+=l.x*J,K.y+=l.y*J,K.z+=l.z*J;let rt=this.p,mt=rt.sizeVec3==0?new I.common.Vec3:rt.stackVec3[--rt.sizeVec3];mt.x=S.x,mt.y=S.y,mt.z=S.z;let xt=mt;xt.x+=o.x*0,xt.y+=o.y*0,xt.z+=o.z*0,xt.x+=l.x*e,xt.y+=l.y*e,xt.z+=l.z*e,this.ellipse(Y,o,l,e,e,n),this.ellipse(S,o,l,e,e,n),this.line(R,et,n),this.line(D,ht,n),this.line(q,K,n),this.line(H,xt,n);let vt=this.p;if(R!=null){if(R.zero(),vt.sizeVec3==vt.stackVec3.length){let _t=new Array(vt.sizeVec3<<1),Vt=0,At=vt.sizeVec3;for(;Vt<At;){let St=Vt++;_t[St]=vt.stackVec3[St],vt.stackVec3[St]=null}vt.stackVec3=_t}vt.stackVec3[vt.sizeVec3++]=R}let Mt=this.p;if(D!=null){if(D.zero(),Mt.sizeVec3==Mt.stackVec3.length){let _t=new Array(Mt.sizeVec3<<1),Vt=0,At=Mt.sizeVec3;for(;Vt<At;){let St=Vt++;_t[St]=Mt.stackVec3[St],Mt.stackVec3[St]=null}Mt.stackVec3=_t}Mt.stackVec3[Mt.sizeVec3++]=D}let ut=this.p;if(q!=null){if(q.zero(),ut.sizeVec3==ut.stackVec3.length){let _t=new Array(ut.sizeVec3<<1),Vt=0,At=ut.sizeVec3;for(;Vt<At;){let St=Vt++;_t[St]=ut.stackVec3[St],ut.stackVec3[St]=null}ut.stackVec3=_t}ut.stackVec3[ut.sizeVec3++]=q}let Zt=this.p;if(H!=null){if(H.zero(),Zt.sizeVec3==Zt.stackVec3.length){let _t=new Array(Zt.sizeVec3<<1),Vt=0,At=Zt.sizeVec3;for(;Vt<At;){let St=Vt++;_t[St]=Zt.stackVec3[St],Zt.stackVec3[St]=null}Zt.stackVec3=_t}Zt.stackVec3[Zt.sizeVec3++]=H}let zt=this.p;if(et!=null){if(et.zero(),zt.sizeVec3==zt.stackVec3.length){let _t=new Array(zt.sizeVec3<<1),Vt=0,At=zt.sizeVec3;for(;Vt<At;){let St=Vt++;_t[St]=zt.stackVec3[St],zt.stackVec3[St]=null}zt.stackVec3=_t}zt.stackVec3[zt.sizeVec3++]=et}let dt=this.p;if(ht!=null){if(ht.zero(),dt.sizeVec3==dt.stackVec3.length){let _t=new Array(dt.sizeVec3<<1),Vt=0,At=dt.sizeVec3;for(;Vt<At;){let St=Vt++;_t[St]=dt.stackVec3[St],dt.stackVec3[St]=null}dt.stackVec3=_t}dt.stackVec3[dt.sizeVec3++]=ht}let st=this.p;if(K!=null){if(K.zero(),st.sizeVec3==st.stackVec3.length){let _t=new Array(st.sizeVec3<<1),Vt=0,At=st.sizeVec3;for(;Vt<At;){let St=Vt++;_t[St]=st.stackVec3[St],st.stackVec3[St]=null}st.stackVec3=_t}st.stackVec3[st.sizeVec3++]=K}let ct=this.p;if(xt!=null){if(xt.zero(),ct.sizeVec3==ct.stackVec3.length){let _t=new Array(ct.sizeVec3<<1),Vt=0,At=ct.sizeVec3;for(;Vt<At;){let St=Vt++;_t[St]=ct.stackVec3[St],ct.stackVec3[St]=null}ct.stackVec3=_t}ct.stackVec3[ct.sizeVec3++]=xt}}else{let P=0;for(;P<8;){let R=P++,k=this.tmpCircleNorms[R],O=this.circleCoords[R];k.x=O.x,k.y=O.y,k.z=O.z;let v=k.x*m.e10+k.y*m.e11+k.z*m.e12,D=k.x*m.e20+k.y*m.e21+k.z*m.e22;k.x=k.x*m.e00+k.y*m.e01+k.z*m.e02,k.y=v,k.z=D;let B=this.tmpCircleVerts1[R],U=this.tmpCircleNorms[R];B.x=U.x,B.y=U.y,B.z=U.z,B.x*=e,B.y*=e,B.z*=e,B.x+=u.x,B.y+=u.y,B.z+=u.z;let q=this.tmpCircleVerts2[R],tt=this.tmpCircleVerts1[R];q.x=tt.x,q.y=tt.y,q.z=tt.z;let Q=this.tmpCircleVerts1[R];Q.x+=_.x*i,Q.y+=_.y*i,Q.z+=_.z*i;let nt=this.tmpCircleVerts2[R],H=-i;nt.x+=_.x*H,nt.y+=_.y*H,nt.z+=_.z*H}let N=0;for(;N<8;){let R=N++,k=this.tmpCircleNorms[R],O=this.tmpCircleNorms[(R+1)%8];this.rect(this.tmpCircleVerts1[R],this.tmpCircleVerts2[R],this.tmpCircleVerts2[(R+1)%8],this.tmpCircleVerts1[(R+1)%8],k,k,O,O,n)}}let F=this.p;if(Y!=null){if(Y.zero(),F.sizeVec3==F.stackVec3.length){let P=new Array(F.sizeVec3<<1),N=0,R=F.sizeVec3;for(;N<R;){let k=N++;P[k]=F.stackVec3[k],F.stackVec3[k]=null}F.stackVec3=P}F.stackVec3[F.sizeVec3++]=Y}let C=this.p;if(S!=null){if(S.zero(),C.sizeVec3==C.stackVec3.length){let P=new Array(C.sizeVec3<<1),N=0,R=C.sizeVec3;for(;N<R;){let k=N++;P[k]=C.stackVec3[k],C.stackVec3[k]=null}C.stackVec3=P}C.stackVec3[C.sizeVec3++]=S}let A=this.p;if(u!=null){if(u.zero(),A.sizeVec3==A.stackVec3.length){let P=new Array(A.sizeVec3<<1),N=0,R=A.sizeVec3;for(;N<R;){let k=N++;P[k]=A.stackVec3[k],A.stackVec3[k]=null}A.stackVec3=P}A.stackVec3[A.sizeVec3++]=u}let Z=this.p;if(m!=null){if(m.e00=1,m.e01=0,m.e02=0,m.e10=0,m.e11=1,m.e12=0,m.e20=0,m.e21=0,m.e22=1,Z.sizeMat3==Z.stackMat3.length){let P=new Array(Z.sizeMat3<<1),N=0,R=Z.sizeMat3;for(;N<R;){let k=N++;P[k]=Z.stackMat3[k],Z.stackMat3[k]=null}Z.stackMat3=P}Z.stackMat3[Z.sizeMat3++]=m}let L=this.p;if(o!=null){if(o.zero(),L.sizeVec3==L.stackVec3.length){let P=new Array(L.sizeVec3<<1),N=0,R=L.sizeVec3;for(;N<R;){let k=N++;P[k]=L.stackVec3[k],L.stackVec3[k]=null}L.stackVec3=P}L.stackVec3[L.sizeVec3++]=o}let E=this.p;if(_!=null){if(_.zero(),E.sizeVec3==E.stackVec3.length){let P=new Array(E.sizeVec3<<1),N=0,R=E.sizeVec3;for(;N<R;){let k=N++;P[k]=E.stackVec3[k],E.stackVec3[k]=null}E.stackVec3=P}E.stackVec3[E.sizeVec3++]=_}let T=this.p;if(l!=null){if(l.zero(),T.sizeVec3==T.stackVec3.length){let P=new Array(T.sizeVec3<<1),N=0,R=T.sizeVec3;for(;N<R;){let k=N++;P[k]=T.stackVec3[k],T.stackVec3[k]=null}T.stackVec3=P}T.stackVec3[T.sizeVec3++]=l}}sphere(t,e,i){let n=this.p,s=n.sizeVec3==0?new I.common.Vec3:n.stackVec3[--n.sizeVec3],o=this.p,r=o.sizeMat3==0?new I.common.Mat3:o.stackMat3[--o.sizeMat3],_=s;_.x=t._positionX,_.y=t._positionY,_.z=t._positionZ;let a=r;a.e00=t._rotation00,a.e01=t._rotation01,a.e02=t._rotation02,a.e10=t._rotation10,a.e11=t._rotation11,a.e12=t._rotation12,a.e20=t._rotation20,a.e21=t._rotation21,a.e22=t._rotation22;let l=this.tmpSphereVerts,h=this.tmpSphereNorms,u=0;for(;u<5;){let p=u++,g=this.tmpSphereVerts[p].length,x=0;for(;x<g;){let b=x++,y=h[p][b],z=this.sphereCoords[p][b];y.x=z.x,y.y=z.y,y.z=z.z;let M=y.x*r.e10+y.y*r.e11+y.z*r.e12,Y=y.x*r.e20+y.y*r.e21+y.z*r.e22;y.x=y.x*r.e00+y.y*r.e01+y.z*r.e02,y.y=M,y.z=Y;let X=l[p][b],w=h[p][b];X.x=w.x,X.y=w.y,X.z=w.z,X.x*=e,X.y*=e,X.z*=e,X.x+=s.x,X.y+=s.y,X.z+=s.z}}let f=0;for(;f<4;){let p=f++,g=0;for(;g<8;){let x=g++,b,y,z,M,Y,X,w,S;p==0?this.wireframe?(b=l[0][0],y=l[1][x],this.line(b,y,i)):(b=l[0][0],y=l[1][x],z=l[1][(x+1)%8],Y=h[0][0],X=h[1][x],w=h[1][(x+1)%8],this.triangle(b,y,z,Y,X,w,i)):p==3?this.wireframe?(b=l[4][0],y=l[p][(x+1)%8],z=l[p][x],this.line(b,y,i),this.line(y,z,i)):(b=l[4][0],y=l[p][(x+1)%8],z=l[p][x],Y=h[4][0],X=h[p][(x+1)%8],w=h[p][x],this.triangle(b,y,z,Y,X,w,i)):this.wireframe?(b=l[p][x],y=l[p][(x+1)%8],z=l[p+1][x],this.line(b,y,i),this.line(b,z,i)):(b=l[p][x],y=l[p][(x+1)%8],z=l[p+1][x],M=l[p+1][(x+1)%8],Y=h[p][x],X=h[p][(x+1)%8],w=h[p+1][x],S=h[p+1][(x+1)%8],this.rect(b,z,M,y,Y,w,S,X,i))}}let m=this.p;if(s!=null){if(s.zero(),m.sizeVec3==m.stackVec3.length){let p=new Array(m.sizeVec3<<1),g=0,x=m.sizeVec3;for(;g<x;){let b=g++;p[b]=m.stackVec3[b],m.stackVec3[b]=null}m.stackVec3=p}m.stackVec3[m.sizeVec3++]=s}let d=this.p;if(r!=null){if(r.e00=1,r.e01=0,r.e02=0,r.e10=0,r.e11=1,r.e12=0,r.e20=0,r.e21=0,r.e22=1,d.sizeMat3==d.stackMat3.length){let p=new Array(d.sizeMat3<<1),g=0,x=d.sizeMat3;for(;g<x;){let b=g++;p[b]=d.stackMat3[b],d.stackMat3[b]=null}d.stackMat3=p}d.stackMat3[d.sizeMat3++]=r}}box(t,e,i){let n=this.p,s=n.sizeVec3==0?new I.common.Vec3:n.stackVec3[--n.sizeVec3],o=this.p,r=o.sizeVec3==0?new I.common.Vec3:o.stackVec3[--o.sizeVec3],_=this.p,a=_.sizeVec3==0?new I.common.Vec3:_.stackVec3[--_.sizeVec3],l=this.p,h=l.sizeVec3==0?new I.common.Vec3:l.stackVec3[--l.sizeVec3],u=this.p,f=u.sizeMat3==0?new I.common.Mat3:u.stackMat3[--u.sizeMat3],m=h;m.x=t._positionX,m.y=t._positionY,m.z=t._positionZ;let d=f;d.e00=t._rotation00,d.e01=t._rotation01,d.e02=t._rotation02,d.e10=t._rotation10,d.e11=t._rotation11,d.e12=t._rotation12,d.e20=t._rotation20,d.e21=t._rotation21,d.e22=t._rotation22,s.init(f.e00,f.e10,f.e20),r.init(f.e01,f.e11,f.e21),a.init(f.e02,f.e12,f.e22);let p=e.x,g=e.y,x=e.z,b=this.p,y=b.sizeVec3==0?new I.common.Vec3:b.stackVec3[--b.sizeVec3];y.x=h.x,y.y=h.y,y.z=h.z;let z=y,M=-p;z.x+=s.x*M,z.y+=s.y*M,z.z+=s.z*M;let Y=-g;z.x+=r.x*Y,z.y+=r.y*Y,z.z+=r.z*Y;let X=-x;z.x+=a.x*X,z.y+=a.y*X,z.z+=a.z*X;let w=this.p,S=w.sizeVec3==0?new I.common.Vec3:w.stackVec3[--w.sizeVec3];S.x=h.x,S.y=h.y,S.z=h.z;let V=S,F=-p;V.x+=s.x*F,V.y+=s.y*F,V.z+=s.z*F;let C=-g;V.x+=r.x*C,V.y+=r.y*C,V.z+=r.z*C,V.x+=a.x*x,V.y+=a.y*x,V.z+=a.z*x;let A=this.p,Z=A.sizeVec3==0?new I.common.Vec3:A.stackVec3[--A.sizeVec3];Z.x=h.x,Z.y=h.y,Z.z=h.z;let L=Z,E=-p;L.x+=s.x*E,L.y+=s.y*E,L.z+=s.z*E,L.x+=r.x*g,L.y+=r.y*g,L.z+=r.z*g;let T=-x;L.x+=a.x*T,L.y+=a.y*T,L.z+=a.z*T;let P=this.p,N=P.sizeVec3==0?new I.common.Vec3:P.stackVec3[--P.sizeVec3];N.x=h.x,N.y=h.y,N.z=h.z;let R=N,k=-p;R.x+=s.x*k,R.y+=s.y*k,R.z+=s.z*k,R.x+=r.x*g,R.y+=r.y*g,R.z+=r.z*g,R.x+=a.x*x,R.y+=a.y*x,R.z+=a.z*x;let O=this.p,v=O.sizeVec3==0?new I.common.Vec3:O.stackVec3[--O.sizeVec3];v.x=h.x,v.y=h.y,v.z=h.z;let D=v;D.x+=s.x*p,D.y+=s.y*p,D.z+=s.z*p;let B=-g;D.x+=r.x*B,D.y+=r.y*B,D.z+=r.z*B;let U=-x;D.x+=a.x*U,D.y+=a.y*U,D.z+=a.z*U;let q=this.p,tt=q.sizeVec3==0?new I.common.Vec3:q.stackVec3[--q.sizeVec3];tt.x=h.x,tt.y=h.y,tt.z=h.z;let Q=tt;Q.x+=s.x*p,Q.y+=s.y*p,Q.z+=s.z*p;let nt=-g;Q.x+=r.x*nt,Q.y+=r.y*nt,Q.z+=r.z*nt,Q.x+=a.x*x,Q.y+=a.y*x,Q.z+=a.z*x;let H=this.p,j=H.sizeVec3==0?new I.common.Vec3:H.stackVec3[--H.sizeVec3];j.x=h.x,j.y=h.y,j.z=h.z;let it=j;it.x+=s.x*p,it.y+=s.y*p,it.z+=s.z*p,it.x+=r.x*g,it.y+=r.y*g,it.z+=r.z*g;let et=-x;it.x+=a.x*et,it.y+=a.y*et,it.z+=a.z*et;let G=this.p,W=G.sizeVec3==0?new I.common.Vec3:G.stackVec3[--G.sizeVec3];W.x=h.x,W.y=h.y,W.z=h.z;let lt=W;if(lt.x+=s.x*p,lt.y+=s.y*p,lt.z+=s.z*p,lt.x+=r.x*g,lt.y+=r.y*g,lt.z+=r.z*g,lt.x+=a.x*x,lt.y+=a.y*x,lt.z+=a.z*x,this.wireframe)this.line(z,V,i),this.line(L,R,i),this.line(D,Q,i),this.line(it,lt,i),this.line(z,L,i),this.line(V,R,i),this.line(D,it,i),this.line(Q,lt,i),this.line(z,D,i),this.line(V,Q,i),this.line(L,it,i),this.line(R,lt,i);else{let dt=this.p,st=dt.sizeVec3==0?new I.common.Vec3:dt.stackVec3[--dt.sizeVec3];st.x=s.x,st.y=s.y,st.z=s.z;let ct=st;ct.x=-ct.x,ct.y=-ct.y,ct.z=-ct.z;let _t=this.p,Vt=_t.sizeVec3==0?new I.common.Vec3:_t.stackVec3[--_t.sizeVec3];Vt.x=r.x,Vt.y=r.y,Vt.z=r.z;let At=Vt;At.x=-At.x,At.y=-At.y,At.z=-At.z;let St=this.p,Xt=St.sizeVec3==0?new I.common.Vec3:St.stackVec3[--St.sizeVec3];Xt.x=a.x,Xt.y=a.y,Xt.z=a.z;let Ft=Xt;Ft.x=-Ft.x,Ft.y=-Ft.y,Ft.z=-Ft.z,this.rect(z,V,R,L,ct,ct,ct,ct,i),this.rect(D,it,lt,Q,s,s,s,s,i),this.rect(z,D,Q,V,At,At,At,At,i),this.rect(L,R,lt,it,r,r,r,r,i),this.rect(z,L,it,D,Ft,Ft,Ft,Ft,i),this.rect(V,Q,lt,R,a,a,a,a,i);let ie=this.p;if(ct!=null){if(ct.zero(),ie.sizeVec3==ie.stackVec3.length){let Ie=new Array(ie.sizeVec3<<1),ue=0,$t=ie.sizeVec3;for(;ue<$t;){let Ht=ue++;Ie[Ht]=ie.stackVec3[Ht],ie.stackVec3[Ht]=null}ie.stackVec3=Ie}ie.stackVec3[ie.sizeVec3++]=ct}let ee=this.p;if(At!=null){if(At.zero(),ee.sizeVec3==ee.stackVec3.length){let Ie=new Array(ee.sizeVec3<<1),ue=0,$t=ee.sizeVec3;for(;ue<$t;){let Ht=ue++;Ie[Ht]=ee.stackVec3[Ht],ee.stackVec3[Ht]=null}ee.stackVec3=Ie}ee.stackVec3[ee.sizeVec3++]=At}let Ye=this.p;if(Ft!=null){if(Ft.zero(),Ye.sizeVec3==Ye.stackVec3.length){let Ie=new Array(Ye.sizeVec3<<1),ue=0,$t=Ye.sizeVec3;for(;ue<$t;){let Ht=ue++;Ie[Ht]=Ye.stackVec3[Ht],Ye.stackVec3[Ht]=null}Ye.stackVec3=Ie}Ye.stackVec3[Ye.sizeVec3++]=Ft}}let ht=this.p;if(z!=null){if(z.zero(),ht.sizeVec3==ht.stackVec3.length){let dt=new Array(ht.sizeVec3<<1),st=0,ct=ht.sizeVec3;for(;st<ct;){let _t=st++;dt[_t]=ht.stackVec3[_t],ht.stackVec3[_t]=null}ht.stackVec3=dt}ht.stackVec3[ht.sizeVec3++]=z}let ft=this.p;if(V!=null){if(V.zero(),ft.sizeVec3==ft.stackVec3.length){let dt=new Array(ft.sizeVec3<<1),st=0,ct=ft.sizeVec3;for(;st<ct;){let _t=st++;dt[_t]=ft.stackVec3[_t],ft.stackVec3[_t]=null}ft.stackVec3=dt}ft.stackVec3[ft.sizeVec3++]=V}let pt=this.p;if(L!=null){if(L.zero(),pt.sizeVec3==pt.stackVec3.length){let dt=new Array(pt.sizeVec3<<1),st=0,ct=pt.sizeVec3;for(;st<ct;){let _t=st++;dt[_t]=pt.stackVec3[_t],pt.stackVec3[_t]=null}pt.stackVec3=dt}pt.stackVec3[pt.sizeVec3++]=L}let K=this.p;if(R!=null){if(R.zero(),K.sizeVec3==K.stackVec3.length){let dt=new Array(K.sizeVec3<<1),st=0,ct=K.sizeVec3;for(;st<ct;){let _t=st++;dt[_t]=K.stackVec3[_t],K.stackVec3[_t]=null}K.stackVec3=dt}K.stackVec3[K.sizeVec3++]=R}let J=this.p;if(D!=null){if(D.zero(),J.sizeVec3==J.stackVec3.length){let dt=new Array(J.sizeVec3<<1),st=0,ct=J.sizeVec3;for(;st<ct;){let _t=st++;dt[_t]=J.stackVec3[_t],J.stackVec3[_t]=null}J.stackVec3=dt}J.stackVec3[J.sizeVec3++]=D}let rt=this.p;if(Q!=null){if(Q.zero(),rt.sizeVec3==rt.stackVec3.length){let dt=new Array(rt.sizeVec3<<1),st=0,ct=rt.sizeVec3;for(;st<ct;){let _t=st++;dt[_t]=rt.stackVec3[_t],rt.stackVec3[_t]=null}rt.stackVec3=dt}rt.stackVec3[rt.sizeVec3++]=Q}let mt=this.p;if(it!=null){if(it.zero(),mt.sizeVec3==mt.stackVec3.length){let dt=new Array(mt.sizeVec3<<1),st=0,ct=mt.sizeVec3;for(;st<ct;){let _t=st++;dt[_t]=mt.stackVec3[_t],mt.stackVec3[_t]=null}mt.stackVec3=dt}mt.stackVec3[mt.sizeVec3++]=it}let xt=this.p;if(lt!=null){if(lt.zero(),xt.sizeVec3==xt.stackVec3.length){let dt=new Array(xt.sizeVec3<<1),st=0,ct=xt.sizeVec3;for(;st<ct;){let _t=st++;dt[_t]=xt.stackVec3[_t],xt.stackVec3[_t]=null}xt.stackVec3=dt}xt.stackVec3[xt.sizeVec3++]=lt}let vt=this.p;if(h!=null){if(h.zero(),vt.sizeVec3==vt.stackVec3.length){let dt=new Array(vt.sizeVec3<<1),st=0,ct=vt.sizeVec3;for(;st<ct;){let _t=st++;dt[_t]=vt.stackVec3[_t],vt.stackVec3[_t]=null}vt.stackVec3=dt}vt.stackVec3[vt.sizeVec3++]=h}let Mt=this.p;if(f!=null){if(f.e00=1,f.e01=0,f.e02=0,f.e10=0,f.e11=1,f.e12=0,f.e20=0,f.e21=0,f.e22=1,Mt.sizeMat3==Mt.stackMat3.length){let dt=new Array(Mt.sizeMat3<<1),st=0,ct=Mt.sizeMat3;for(;st<ct;){let _t=st++;dt[_t]=Mt.stackMat3[_t],Mt.stackMat3[_t]=null}Mt.stackMat3=dt}Mt.stackMat3[Mt.sizeMat3++]=f}let ut=this.p;if(s!=null){if(s.zero(),ut.sizeVec3==ut.stackVec3.length){let dt=new Array(ut.sizeVec3<<1),st=0,ct=ut.sizeVec3;for(;st<ct;){let _t=st++;dt[_t]=ut.stackVec3[_t],ut.stackVec3[_t]=null}ut.stackVec3=dt}ut.stackVec3[ut.sizeVec3++]=s}let Zt=this.p;if(r!=null){if(r.zero(),Zt.sizeVec3==Zt.stackVec3.length){let dt=new Array(Zt.sizeVec3<<1),st=0,ct=Zt.sizeVec3;for(;st<ct;){let _t=st++;dt[_t]=Zt.stackVec3[_t],Zt.stackVec3[_t]=null}Zt.stackVec3=dt}Zt.stackVec3[Zt.sizeVec3++]=r}let zt=this.p;if(a!=null){if(a.zero(),zt.sizeVec3==zt.stackVec3.length){let dt=new Array(zt.sizeVec3<<1),st=0,ct=zt.sizeVec3;for(;st<ct;){let _t=st++;dt[_t]=zt.stackVec3[_t],zt.stackVec3[_t]=null}zt.stackVec3=dt}zt.stackVec3[zt.sizeVec3++]=a}}rect(t,e,i,n,s,o,r,_,a){this.triangle(t,e,i,s,o,r,a),this.triangle(t,i,n,s,r,_,a)}point(t,e){}triangle(t,e,i,n,s,o,r){}line(t,e,i){}};I.dynamics.common.DebugDrawStyle=class{constructor(){this.basisColorZ=new I.common.Vec3(0,0,1),this.basisColorY=new I.common.Vec3(0,1,0),this.basisColorX=new I.common.Vec3(1,0,0),this.basisLength=.5,this.jointRotationalConstraintRadius=.3,this.jointErrorColor=new I.common.Vec3(1,.1,.1),this.jointLineColor=new I.common.Vec3(.8,.8,.8),this.contactBinormalLength=.5,this.contactTangentLength=.5,this.contactNormalLength=.5,this.contactBinormalColor=new I.common.Vec3(.2,.2,1),this.contactTangentColor=new I.common.Vec3(.1,.8,.1),this.contactNormalColor=new I.common.Vec3(1,.1,.1),this.disabledContactColor=new I.common.Vec3(.5,.1,.1),this.newContactColor=new I.common.Vec3(1,1,.1),this.contactColor4=new I.common.Vec3(.8,.1,1),this.contactColor3=new I.common.Vec3(.1,.8,.6),this.contactColor2=new I.common.Vec3(1,.6,.1),this.contactColor=new I.common.Vec3(1,.1,.1),this.pairColor=new I.common.Vec3(1,1,.1),this.bvhNodeColor=new I.common.Vec3(.4,.4,.4),this.aabbColor=new I.common.Vec3(1,.1,.1),this.kinematicShapeColor=new I.common.Vec3(1,.5,.1),this.staticShapeColor=new I.common.Vec3(.7,.7,.7),this.sleepingShapeColor2=new I.common.Vec3(.2,.8,.5),this.sleepingShapeColor1=new I.common.Vec3(.3,.3,.8),this.sleepyShapeColor2=new I.common.Vec3(.6,.8,.3),this.sleepyShapeColor1=new I.common.Vec3(.5,.25,.6),this.shapeColor2=new I.common.Vec3(1,.8,.1),this.shapeColor1=new I.common.Vec3(.7,.2,.4)}};I.dynamics.common.Performance=class{};I.dynamics.constraint||(I.dynamics.constraint={});I.dynamics.constraint.ConstraintSolver=class{constructor(){this._b1=null,this._b2=null,this._addedToIsland=!1}preSolveVelocity(t){}warmStart(t){}solveVelocity(){}postSolveVelocity(t){}preSolvePosition(t){}solvePositionSplitImpulse(){}solvePositionNgs(t){}postSolve(){}};I.dynamics.constraint.PositionCorrectionAlgorithm=class{};I.dynamics.constraint.contact||(I.dynamics.constraint.contact={});I.dynamics.constraint.contact.ContactConstraint=class{constructor(t){this._solver=new I.dynamics.constraint.solver.pgs.PgsContactConstraintSolver(this),this._manifold=t}_getVelocitySolverInfo(t,e){e.b1=this._b1,e.b2=this._b2;let i,n,s,o,r,_,a,l,h;i=this._manifold._normalX,n=this._manifold._normalY,s=this._manifold._normalZ,o=this._manifold._tangentX,r=this._manifold._tangentY,_=this._manifold._tangentZ,a=this._manifold._binormalX,l=this._manifold._binormalY,h=this._manifold._binormalZ;let u=Math.sqrt(this._s1._friction*this._s2._friction),f=Math.sqrt(this._s1._restitution*this._s2._restitution),m=this._manifold._numPoints;e.numRows=0;let d=0;for(;d<m;){let p=this._manifold._points[d++];if(p._depth<0){p._disabled=!0;let y=p._impulse;y.impulseN=0,y.impulseT=0,y.impulseB=0,y.impulseP=0,y.impulseLX=0,y.impulseLY=0,y.impulseLZ=0;continue}else p._disabled=!1;let g=e.rows[e.numRows++];g.friction=u,g.cfm=0;let x=g.jacobianN;x.lin1X=i,x.lin1Y=n,x.lin1Z=s,x.lin2X=i,x.lin2Y=n,x.lin2Z=s,x.ang1X=p._relPos1Y*s-p._relPos1Z*n,x.ang1Y=p._relPos1Z*i-p._relPos1X*s,x.ang1Z=p._relPos1X*n-p._relPos1Y*i,x.ang2X=p._relPos2Y*s-p._relPos2Z*n,x.ang2Y=p._relPos2Z*i-p._relPos2X*s,x.ang2Z=p._relPos2X*n-p._relPos2Y*i,x=g.jacobianT,x.lin1X=o,x.lin1Y=r,x.lin1Z=_,x.lin2X=o,x.lin2Y=r,x.lin2Z=_,x.ang1X=p._relPos1Y*_-p._relPos1Z*r,x.ang1Y=p._relPos1Z*o-p._relPos1X*_,x.ang1Z=p._relPos1X*r-p._relPos1Y*o,x.ang2X=p._relPos2Y*_-p._relPos2Z*r,x.ang2Y=p._relPos2Z*o-p._relPos2X*_,x.ang2Z=p._relPos2X*r-p._relPos2Y*o,x=g.jacobianB,x.lin1X=a,x.lin1Y=l,x.lin1Z=h,x.lin2X=a,x.lin2Y=l,x.lin2Z=h,x.ang1X=p._relPos1Y*h-p._relPos1Z*l,x.ang1Y=p._relPos1Z*a-p._relPos1X*h,x.ang1Z=p._relPos1X*l-p._relPos1Y*a,x.ang2X=p._relPos2Y*h-p._relPos2Z*l,x.ang2Y=p._relPos2Z*a-p._relPos2X*h,x.ang2Z=p._relPos2X*l-p._relPos2Y*a,x=g.jacobianN;let b=x.lin1X*this._b1._velX+x.lin1Y*this._b1._velY+x.lin1Z*this._b1._velZ+(x.ang1X*this._b1._angVelX+x.ang1Y*this._b1._angVelY+x.ang1Z*this._b1._angVelZ)-(x.lin2X*this._b2._velX+x.lin2Y*this._b2._velY+x.lin2Z*this._b2._velZ+(x.ang2X*this._b2._angVelX+x.ang2Y*this._b2._angVelY+x.ang2Z*this._b2._angVelZ));if(b<-I.common.Setting.contactEnableBounceThreshold&&!p._warmStarted?g.rhs=-b*f:g.rhs=0,this._positionCorrectionAlgorithm==I.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE&&p._depth>I.common.Setting.linearSlop){let y=(p._depth-I.common.Setting.linearSlop)*I.common.Setting.velocityBaumgarte*t.invDt;g.rhs<y&&(g.rhs=y)}if(!p._warmStarted){let y=p._impulse;y.impulseN=0,y.impulseT=0,y.impulseB=0,y.impulseP=0,y.impulseLX=0,y.impulseLY=0,y.impulseLZ=0}g.impulse=p._impulse}}_getPositionSolverInfo(t){t.b1=this._b1,t.b2=this._b2;let e,i,n;e=this._manifold._normalX,i=this._manifold._normalY,n=this._manifold._normalZ;let s=this._manifold._numPoints;t.numRows=0;let o=0;for(;o<s;){let r=this._manifold._points[o++];if(r._disabled)continue;let _=t.rows[t.numRows++],a=_.jacobianN;a.lin1X=e,a.lin1Y=i,a.lin1Z=n,a.lin2X=e,a.lin2Y=i,a.lin2Z=n,a.ang1X=r._relPos1Y*n-r._relPos1Z*i,a.ang1Y=r._relPos1Z*e-r._relPos1X*n,a.ang1Z=r._relPos1X*i-r._relPos1Y*e,a.ang2X=r._relPos2Y*n-r._relPos2Z*i,a.ang2Y=r._relPos2Z*e-r._relPos2X*n,a.ang2Z=r._relPos2X*i-r._relPos2Y*e,_.rhs=r._depth-I.common.Setting.linearSlop,_.rhs<0&&(_.rhs=0),_.impulse=r._impulse}}_syncManifold(){this._manifold._updateDepthsAndPositions(this._tf1,this._tf2)}getShape1(){return this._s1}getShape2(){return this._s2}getManifold(){return this._manifold}isTouching(){let t=0,e=this._manifold._numPoints;for(;t<e;)if(this._manifold._points[t++]._depth>=0)return!0;return!1}};I.dynamics.constraint.contact.ContactImpulse=class{constructor(){this.impulseN=0,this.impulseT=0,this.impulseB=0,this.impulseP=0,this.impulseLX=0,this.impulseLY=0,this.impulseLZ=0}copyFrom(t){this.impulseN=t.impulseN,this.impulseT=t.impulseT,this.impulseB=t.impulseB,this.impulseLX=t.impulseLX,this.impulseLY=t.impulseLY,this.impulseLZ=t.impulseLZ}};I.dynamics.constraint.contact.Manifold=class{constructor(){this._normalX=0,this._normalY=0,this._normalZ=0,this._tangentX=0,this._tangentY=0,this._tangentZ=0,this._binormalX=0,this._binormalY=0,this._binormalZ=0,this._numPoints=0,this._points=new Array(I.common.Setting.maxManifoldPoints);let t=0,e=I.common.Setting.maxManifoldPoints;for(;t<e;)this._points[t++]=new I.dynamics.constraint.contact.ManifoldPoint}_clear(){let t=0,e=this._numPoints;for(;t<e;){let i=this._points[t++];i._localPos1X=0,i._localPos1Y=0,i._localPos1Z=0,i._localPos2X=0,i._localPos2Y=0,i._localPos2Z=0,i._relPos1X=0,i._relPos1Y=0,i._relPos1Z=0,i._relPos2X=0,i._relPos2Y=0,i._relPos2Z=0,i._pos1X=0,i._pos1Y=0,i._pos1Z=0,i._pos2X=0,i._pos2Y=0,i._pos2Z=0,i._depth=0;let n=i._impulse;n.impulseN=0,n.impulseT=0,n.impulseB=0,n.impulseP=0,n.impulseLX=0,n.impulseLY=0,n.impulseLZ=0,i._warmStarted=!1,i._disabled=!1,i._id=-1}this._numPoints=0}_buildBasis(t){this._normalX=t.x,this._normalY=t.y,this._normalZ=t.z;let e=t.x,i=t.y,n=t.z,s=e*e,o=i*i,r=n*n,_,a,l,h,u,f;if(s<o)if(s<r){let m=1/Math.sqrt(o+r);_=0,a=-n*m,l=i*m,h=i*l-n*a,u=-e*l,f=e*a}else{let m=1/Math.sqrt(s+o);_=-i*m,a=e*m,l=0,h=-n*a,u=n*_,f=e*a-i*_}else if(o<r){let m=1/Math.sqrt(s+r);_=n*m,a=0,l=-e*m,h=i*l,u=n*_-e*l,f=-i*_}else{let m=1/Math.sqrt(s+o);_=-i*m,a=e*m,l=0,h=-n*a,u=n*_,f=e*a-i*_}this._tangentX=_,this._tangentY=a,this._tangentZ=l,this._binormalX=h,this._binormalY=u,this._binormalZ=f}_updateDepthsAndPositions(t,e){let i=0,n=this._numPoints;for(;i<n;){let s=this._points[i++],o,r,_;o=t._rotation00*s._localPos1X+t._rotation01*s._localPos1Y+t._rotation02*s._localPos1Z,r=t._rotation10*s._localPos1X+t._rotation11*s._localPos1Y+t._rotation12*s._localPos1Z,_=t._rotation20*s._localPos1X+t._rotation21*s._localPos1Y+t._rotation22*s._localPos1Z,s._relPos1X=o,s._relPos1Y=r,s._relPos1Z=_;let a,l,h;a=e._rotation00*s._localPos2X+e._rotation01*s._localPos2Y+e._rotation02*s._localPos2Z,l=e._rotation10*s._localPos2X+e._rotation11*s._localPos2Y+e._rotation12*s._localPos2Z,h=e._rotation20*s._localPos2X+e._rotation21*s._localPos2Y+e._rotation22*s._localPos2Z,s._relPos2X=a,s._relPos2Y=l,s._relPos2Z=h,s._pos1X=s._relPos1X+t._positionX,s._pos1Y=s._relPos1Y+t._positionY,s._pos1Z=s._relPos1Z+t._positionZ,s._pos2X=s._relPos2X+e._positionX,s._pos2Y=s._relPos2Y+e._positionY,s._pos2Z=s._relPos2Z+e._positionZ;let u,f,m;u=s._pos1X-s._pos2X,f=s._pos1Y-s._pos2Y,m=s._pos1Z-s._pos2Z,s._depth=-(u*this._normalX+f*this._normalY+m*this._normalZ)}}getNormal(){let t=new I.common.Vec3;return t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ,t}getNormalTo(t){t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ}getTangent(){let t=new I.common.Vec3;return t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ,t}getTangentTo(t){t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ}getBinormal(){let t=new I.common.Vec3;return t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ,t}getBinormalTo(t){t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ}getPoints(){return this._points}getNumPoints(){return this._numPoints}};I.dynamics.constraint.contact.ManifoldPoint=class{constructor(){this._localPos1X=0,this._localPos1Y=0,this._localPos1Z=0,this._localPos2X=0,this._localPos2Y=0,this._localPos2Z=0,this._relPos1X=0,this._relPos1Y=0,this._relPos1Z=0,this._relPos2X=0,this._relPos2Y=0,this._relPos2Z=0,this._pos1X=0,this._pos1Y=0,this._pos1Z=0,this._pos2X=0,this._pos2Y=0,this._pos2Z=0,this._depth=0,this._impulse=new I.dynamics.constraint.contact.ContactImpulse,this._warmStarted=!1,this._disabled=!1,this._id=-1}getPosition1(){let t=new I.common.Vec3;return t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z,t}getPosition1To(t){t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z}getPosition2(){let t=new I.common.Vec3;return t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z,t}getPosition2To(t){t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z}getDepth(){return this._depth}isWarmStarted(){return this._warmStarted}getNormalImpulse(){return this._impulse.impulseN}getTangentImpulse(){return this._impulse.impulseT}getBinormalImpulse(){return this._impulse.impulseB}isEnabled(){return!this._disabled}};I.dynamics.constraint.contact.ManifoldUpdater=class{constructor(t){this._manifold=t,this.numOldPoints=0,this.oldPoints=new Array(I.common.Setting.maxManifoldPoints);let e=0,i=I.common.Setting.maxManifoldPoints;for(;e<i;)this.oldPoints[e++]=new I.dynamics.constraint.contact.ManifoldPoint}removeOutdatedPoints(){let t=this._manifold._numPoints;for(;--t>=0;){let e=this._manifold._points[t],i,n,s;i=e._pos1X-e._pos2X,n=e._pos1Y-e._pos2Y,s=e._pos1Z-e._pos2Z;let o=this._manifold._normalX*i+this._manifold._normalY*n+this._manifold._normalZ*s;if(o>I.common.Setting.contactPersistenceThreshold){this.removeManifoldPoint(t);continue}if(i+=this._manifold._normalX*-o,n+=this._manifold._normalY*-o,s+=this._manifold._normalZ*-o,i*i+n*n+s*s>I.common.Setting.contactPersistenceThreshold*I.common.Setting.contactPersistenceThreshold){this.removeManifoldPoint(t);continue}}}removeManifoldPoint(t){let e=--this._manifold._numPoints;if(t!=e){let s=this._manifold._points[t];this._manifold._points[t]=this._manifold._points[e],this._manifold._points[e]=s}let i=this._manifold._points[e];i._localPos1X=0,i._localPos1Y=0,i._localPos1Z=0,i._localPos2X=0,i._localPos2Y=0,i._localPos2Z=0,i._relPos1X=0,i._relPos1Y=0,i._relPos1Z=0,i._relPos2X=0,i._relPos2Y=0,i._relPos2Z=0,i._pos1X=0,i._pos1Y=0,i._pos1Z=0,i._pos2X=0,i._pos2Y=0,i._pos2Z=0,i._depth=0;let n=i._impulse;n.impulseN=0,n.impulseT=0,n.impulseB=0,n.impulseP=0,n.impulseLX=0,n.impulseLY=0,n.impulseLZ=0,i._warmStarted=!1,i._disabled=!1,i._id=-1}addManifoldPoint(t,e,i){let n=this._manifold._numPoints;if(n==I.common.Setting.maxManifoldPoints){let d=this.computeTargetIndex(t,e,i),p=this._manifold._points[d],g=t.position1;p._pos1X=g.x,p._pos1Y=g.y,p._pos1Z=g.z;let x=t.position2;p._pos2X=x.x,p._pos2Y=x.y,p._pos2Z=x.z,p._relPos1X=p._pos1X-e._positionX,p._relPos1Y=p._pos1Y-e._positionY,p._relPos1Z=p._pos1Z-e._positionZ,p._relPos2X=p._pos2X-i._positionX,p._relPos2Y=p._pos2Y-i._positionY,p._relPos2Z=p._pos2Z-i._positionZ;let b,y,z;b=e._rotation00*p._relPos1X+e._rotation10*p._relPos1Y+e._rotation20*p._relPos1Z,y=e._rotation01*p._relPos1X+e._rotation11*p._relPos1Y+e._rotation21*p._relPos1Z,z=e._rotation02*p._relPos1X+e._rotation12*p._relPos1Y+e._rotation22*p._relPos1Z,p._localPos1X=b,p._localPos1Y=y,p._localPos1Z=z;let M,Y,X;M=i._rotation00*p._relPos2X+i._rotation10*p._relPos2Y+i._rotation20*p._relPos2Z,Y=i._rotation01*p._relPos2X+i._rotation11*p._relPos2Y+i._rotation21*p._relPos2Z,X=i._rotation02*p._relPos2X+i._rotation12*p._relPos2Y+i._rotation22*p._relPos2Z,p._localPos2X=M,p._localPos2Y=Y,p._localPos2Z=X,p._depth=t.depth;let w=p._impulse;w.impulseN=0,w.impulseT=0,w.impulseB=0,w.impulseP=0,w.impulseLX=0,w.impulseLY=0,w.impulseLZ=0,p._id=t.id,p._warmStarted=!1,p._disabled=!1;return}let s=this._manifold._points[n],o=t.position1;s._pos1X=o.x,s._pos1Y=o.y,s._pos1Z=o.z;let r=t.position2;s._pos2X=r.x,s._pos2Y=r.y,s._pos2Z=r.z,s._relPos1X=s._pos1X-e._positionX,s._relPos1Y=s._pos1Y-e._positionY,s._relPos1Z=s._pos1Z-e._positionZ,s._relPos2X=s._pos2X-i._positionX,s._relPos2Y=s._pos2Y-i._positionY,s._relPos2Z=s._pos2Z-i._positionZ;let _,a,l;_=e._rotation00*s._relPos1X+e._rotation10*s._relPos1Y+e._rotation20*s._relPos1Z,a=e._rotation01*s._relPos1X+e._rotation11*s._relPos1Y+e._rotation21*s._relPos1Z,l=e._rotation02*s._relPos1X+e._rotation12*s._relPos1Y+e._rotation22*s._relPos1Z,s._localPos1X=_,s._localPos1Y=a,s._localPos1Z=l;let h,u,f;h=i._rotation00*s._relPos2X+i._rotation10*s._relPos2Y+i._rotation20*s._relPos2Z,u=i._rotation01*s._relPos2X+i._rotation11*s._relPos2Y+i._rotation21*s._relPos2Z,f=i._rotation02*s._relPos2X+i._rotation12*s._relPos2Y+i._rotation22*s._relPos2Z,s._localPos2X=h,s._localPos2Y=u,s._localPos2Z=f,s._depth=t.depth;let m=s._impulse;m.impulseN=0,m.impulseT=0,m.impulseB=0,m.impulseP=0,m.impulseLX=0,m.impulseLY=0,m.impulseLZ=0,s._id=t.id,s._warmStarted=!1,s._disabled=!1,this._manifold._numPoints++}computeTargetIndex(t,e,i){let n=this._manifold._points[0],s=this._manifold._points[1],o=this._manifold._points[2],r=this._manifold._points[3],_=n._depth,a=0;s._depth>_&&(_=s._depth,a=1),o._depth>_&&(_=o._depth,a=2),r._depth>_&&(a=3);let l,h,u,f=t.position1;l=f.x,h=f.y,u=f.z,l-=e._positionX,h-=e._positionY,u-=e._positionZ;let m=s._relPos1X,d=s._relPos1Y,p=s._relPos1Z,g=o._relPos1X,x=o._relPos1Y,b=o._relPos1Z,y=r._relPos1X,z=r._relPos1Y,M=r._relPos1Z,Y,X,w,S,V,F,C,A,Z,L,E,T,P,N,R,k,O,v;Y=g-m,X=x-d,w=b-p,S=l-y,V=h-z,F=u-M,C=y-m,A=z-d,Z=M-p,L=l-g,E=h-x,T=u-b,P=l-m,N=h-d,R=u-p,k=y-g,O=z-x,v=M-b;let D,B,U,q,tt,Q,nt,H,j;D=X*F-w*V,B=w*S-Y*F,U=Y*V-X*S,q=A*T-Z*E,tt=Z*L-C*T,Q=C*E-A*L,nt=N*v-R*O,H=R*k-P*v,j=P*O-N*k;let it=D*D+B*B+U*U,et=q*q+tt*tt+Q*Q,G=nt*nt+H*H+j*j,W=n._relPos1X,lt=n._relPos1Y,ht=n._relPos1Z,ft=o._relPos1X,pt=o._relPos1Y,K=o._relPos1Z,J=r._relPos1X,rt=r._relPos1Y,mt=r._relPos1Z,xt,vt,Mt,ut,Zt,zt,dt,st,ct,_t,Vt,At,St,Xt,Ft,ie,ee,Ye;xt=ft-W,vt=pt-lt,Mt=K-ht,ut=l-J,Zt=h-rt,zt=u-mt,dt=J-W,st=rt-lt,ct=mt-ht,_t=l-ft,Vt=h-pt,At=u-K,St=l-W,Xt=h-lt,Ft=u-ht,ie=J-ft,ee=rt-pt,Ye=mt-K;let Ie,ue,$t,Ht,me,ze,qe,Ee,Ut;Ie=vt*zt-Mt*Zt,ue=Mt*ut-xt*zt,$t=xt*Zt-vt*ut,Ht=st*At-ct*Vt,me=ct*_t-dt*At,ze=dt*Vt-st*_t,qe=Xt*Ye-Ft*ee,Ee=Ft*ie-St*Ye,Ut=St*ee-Xt*ie;let at=Ie*Ie+ue*ue+$t*$t,gt=Ht*Ht+me*me+ze*ze,yt=qe*qe+Ee*Ee+Ut*Ut,bt=at>gt?at>yt?at:yt:gt>yt?gt:yt,ot=n._relPos1X,Pt=n._relPos1Y,Dt=n._relPos1Z,$=s._relPos1X,kt=s._relPos1Y,Rt=s._relPos1Z,Ot=r._relPos1X,Wt=r._relPos1Y,Bt=r._relPos1Z,re,Ce,be,Tt,Lt,Yt,pe,Me,fe,ti,di,Le,_i,yi,he,gi,bi,Mi;re=$-ot,Ce=kt-Pt,be=Rt-Dt,Tt=l-Ot,Lt=h-Wt,Yt=u-Bt,pe=Ot-ot,Me=Wt-Pt,fe=Bt-Dt,ti=l-$,di=h-kt,Le=u-Rt,_i=l-ot,yi=h-Pt,he=u-Dt,gi=Ot-$,bi=Wt-kt,Mi=Bt-Rt;let Si,He,Je,Qe,ci,hi,ei,ai,Ke;Si=Ce*Yt-be*Lt,He=be*Tt-re*Yt,Je=re*Lt-Ce*Tt,Qe=Me*Le-fe*di,ci=fe*ti-pe*Le,hi=pe*di-Me*ti,ei=yi*Mi-he*bi,ai=he*gi-_i*Mi,Ke=_i*bi-yi*gi;let We=Si*Si+He*He+Je*Je,ke=Qe*Qe+ci*ci+hi*hi,le=ei*ei+ai*ai+Ke*Ke,ge=We>ke?We>le?We:le:ke>le?ke:le,jt=n._relPos1X,Ae=n._relPos1Y,Ze=n._relPos1Z,Re=s._relPos1X,Te=s._relPos1Y,Fe=s._relPos1Z,se=o._relPos1X,Ct=o._relPos1Y,Gt=o._relPos1Z,Pe,Ve,Ue,ii,ri,mi,xi,ce,Ge,we,Be,ve,qt,Jt,xe,Kt,It,Et;Pe=Re-jt,Ve=Te-Ae,Ue=Fe-Ze,ii=l-se,ri=h-Ct,mi=u-Gt,xi=se-jt,ce=Ct-Ae,Ge=Gt-Ze,we=l-Re,Be=h-Te,ve=u-Fe,qt=l-jt,Jt=h-Ae,xe=u-Ze,Kt=se-Re,It=Ct-Te,Et=Gt-Fe;let Qt,te,ne,_e,de,Se,ye,oe,Nt;Qt=Ve*mi-Ue*ri,te=Ue*ii-Pe*mi,ne=Pe*ri-Ve*ii,_e=ce*ve-Ge*Be,de=Ge*we-xi*ve,Se=xi*Be-ce*we,ye=Jt*Et-xe*It,oe=xe*Kt-qt*Et,Nt=qt*It-Jt*Kt;let ae=Qt*Qt+te*te+ne*ne,Xe=_e*_e+de*de+Se*Se,Oe=ye*ye+oe*oe+Nt*Nt,oi=ae>Xe?ae>Oe?ae:Oe:Xe>Oe?Xe:Oe,ui=it>et?it>G?it:G:et>G?et:G,$e=0;return(bt>ui&&a!=1||a==0)&&(ui=bt,$e=1),ge>ui&&a!=2&&(ui=ge,$e=2),oi>ui&&a!=3&&($e=3),$e}computeRelativePositions(t,e){let i=this._manifold._numPoints,n=0;for(;n<i;){let s=this._manifold._points[n++],o,r,_;o=t._rotation00*s._localPos1X+t._rotation01*s._localPos1Y+t._rotation02*s._localPos1Z,r=t._rotation10*s._localPos1X+t._rotation11*s._localPos1Y+t._rotation12*s._localPos1Z,_=t._rotation20*s._localPos1X+t._rotation21*s._localPos1Y+t._rotation22*s._localPos1Z,s._relPos1X=o,s._relPos1Y=r,s._relPos1Z=_;let a,l,h;a=e._rotation00*s._localPos2X+e._rotation01*s._localPos2Y+e._rotation02*s._localPos2Z,l=e._rotation10*s._localPos2X+e._rotation11*s._localPos2Y+e._rotation12*s._localPos2Z,h=e._rotation20*s._localPos2X+e._rotation21*s._localPos2Y+e._rotation22*s._localPos2Z,s._relPos2X=a,s._relPos2Y=l,s._relPos2Z=h,s._warmStarted=!0}}findNearestContactPointIndex(t,e,i){let n=I.common.Setting.contactPersistenceThreshold*I.common.Setting.contactPersistenceThreshold,s=-1,o=0,r=this._manifold._numPoints;for(;o<r;){let _=o++,a=this._manifold._points[_],l,h,u,f,m,d,p=t.position1;l=p.x,h=p.y,u=p.z;let g=t.position2;f=g.x,m=g.y,d=g.z,l-=e._positionX,h-=e._positionY,u-=e._positionZ,f-=i._positionX,m-=i._positionY,d-=i._positionZ;let x,b,y,z,M,Y;x=a._relPos1X-l,b=a._relPos1Y-h,y=a._relPos1Z-u,z=a._relPos2X-f,M=a._relPos2Y-m,Y=a._relPos2Z-d;let X=x*x+b*b+y*y,w=z*z+M*M+Y*Y,S=X<w?X:w;S<n&&(n=S,s=_)}return s}totalUpdate(t,e,i){this.numOldPoints=this._manifold._numPoints;let n=0,s=this.numOldPoints;for(;n<s;){let _=n++,a=this.oldPoints[_],l=this._manifold._points[_];a._localPos1X=l._localPos1X,a._localPos1Y=l._localPos1Y,a._localPos1Z=l._localPos1Z,a._localPos2X=l._localPos2X,a._localPos2Y=l._localPos2Y,a._localPos2Z=l._localPos2Z,a._relPos1X=l._relPos1X,a._relPos1Y=l._relPos1Y,a._relPos1Z=l._relPos1Z,a._relPos2X=l._relPos2X,a._relPos2Y=l._relPos2Y,a._relPos2Z=l._relPos2Z,a._pos1X=l._pos1X,a._pos1Y=l._pos1Y,a._pos1Z=l._pos1Z,a._pos2X=l._pos2X,a._pos2Y=l._pos2Y,a._pos2Z=l._pos2Z,a._depth=l._depth,a._impulse.copyFrom(l._impulse),a._id=l._id,a._warmStarted=l._warmStarted,a._disabled=!1}let o=t.numPoints;this._manifold._numPoints=o;let r=0;for(;r<o;){let _=r++,a=this._manifold._points[_],l=t.points[_],h=l.position1;a._pos1X=h.x,a._pos1Y=h.y,a._pos1Z=h.z;let u=l.position2;a._pos2X=u.x,a._pos2Y=u.y,a._pos2Z=u.z,a._relPos1X=a._pos1X-e._positionX,a._relPos1Y=a._pos1Y-e._positionY,a._relPos1Z=a._pos1Z-e._positionZ,a._relPos2X=a._pos2X-i._positionX,a._relPos2Y=a._pos2Y-i._positionY,a._relPos2Z=a._pos2Z-i._positionZ;let f,m,d;f=e._rotation00*a._relPos1X+e._rotation10*a._relPos1Y+e._rotation20*a._relPos1Z,m=e._rotation01*a._relPos1X+e._rotation11*a._relPos1Y+e._rotation21*a._relPos1Z,d=e._rotation02*a._relPos1X+e._rotation12*a._relPos1Y+e._rotation22*a._relPos1Z,a._localPos1X=f,a._localPos1Y=m,a._localPos1Z=d;let p,g,x;p=i._rotation00*a._relPos2X+i._rotation10*a._relPos2Y+i._rotation20*a._relPos2Z,g=i._rotation01*a._relPos2X+i._rotation11*a._relPos2Y+i._rotation21*a._relPos2Z,x=i._rotation02*a._relPos2X+i._rotation12*a._relPos2Y+i._rotation22*a._relPos2Z,a._localPos2X=p,a._localPos2Y=g,a._localPos2Z=x,a._depth=l.depth;let b=a._impulse;b.impulseN=0,b.impulseT=0,b.impulseB=0,b.impulseP=0,b.impulseLX=0,b.impulseLY=0,b.impulseLZ=0,a._id=l.id,a._warmStarted=!1,a._disabled=!1;let y=0,z=this.numOldPoints;for(;y<z;){let M=this.oldPoints[y++];if(a._id==M._id){a._impulse.copyFrom(M._impulse),a._warmStarted=!0;break}}}}incrementalUpdate(t,e,i){this._manifold._updateDepthsAndPositions(e,i);let n=0,s=this._manifold._numPoints;for(;n<s;)this._manifold._points[n++]._warmStarted=!0;let o=t.points[0],r=this.findNearestContactPointIndex(o,e,i);if(r==-1)this.addManifoldPoint(o,e,i);else{let _=this._manifold._points[r],a=o.position1;_._pos1X=a.x,_._pos1Y=a.y,_._pos1Z=a.z;let l=o.position2;_._pos2X=l.x,_._pos2Y=l.y,_._pos2Z=l.z,_._relPos1X=_._pos1X-e._positionX,_._relPos1Y=_._pos1Y-e._positionY,_._relPos1Z=_._pos1Z-e._positionZ,_._relPos2X=_._pos2X-i._positionX,_._relPos2Y=_._pos2Y-i._positionY,_._relPos2Z=_._pos2Z-i._positionZ;let h,u,f;h=e._rotation00*_._relPos1X+e._rotation10*_._relPos1Y+e._rotation20*_._relPos1Z,u=e._rotation01*_._relPos1X+e._rotation11*_._relPos1Y+e._rotation21*_._relPos1Z,f=e._rotation02*_._relPos1X+e._rotation12*_._relPos1Y+e._rotation22*_._relPos1Z,_._localPos1X=h,_._localPos1Y=u,_._localPos1Z=f;let m,d,p;m=i._rotation00*_._relPos2X+i._rotation10*_._relPos2Y+i._rotation20*_._relPos2Z,d=i._rotation01*_._relPos2X+i._rotation11*_._relPos2Y+i._rotation21*_._relPos2Z,p=i._rotation02*_._relPos2X+i._rotation12*_._relPos2Y+i._rotation22*_._relPos2Z,_._localPos2X=m,_._localPos2Y=d,_._localPos2Z=p,_._depth=o.depth}this.removeOutdatedPoints()}};I.dynamics.constraint.info||(I.dynamics.constraint.info={});I.dynamics.constraint.info.JacobianRow=class{constructor(){this.lin1X=0,this.lin1Y=0,this.lin1Z=0,this.lin2X=0,this.lin2Y=0,this.lin2Z=0,this.ang1X=0,this.ang1Y=0,this.ang1Z=0,this.ang2X=0,this.ang2Y=0,this.ang2Z=0,this.flag=0}updateSparsity(){this.flag=0,(!(this.lin1X==0&&this.lin1Y==0&&this.lin1Z==0)||!(this.lin2X==0&&this.lin2Y==0&&this.lin2Z==0))&&(this.flag|=1),(!(this.ang1X==0&&this.ang1Y==0&&this.ang1Z==0)||!(this.ang2X==0&&this.ang2Y==0&&this.ang2Z==0))&&(this.flag|=2)}};I.dynamics.constraint.info.contact||(I.dynamics.constraint.info.contact={});I.dynamics.constraint.info.contact.ContactSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0,this.rows=new Array(I.common.Setting.maxManifoldPoints);let t=0,e=this.rows.length;for(;t<e;)this.rows[t++]=new I.dynamics.constraint.info.contact.ContactSolverInfoRow}};I.dynamics.constraint.info.contact.ContactSolverInfoRow=class{constructor(){this.jacobianN=new I.dynamics.constraint.info.JacobianRow,this.jacobianT=new I.dynamics.constraint.info.JacobianRow,this.jacobianB=new I.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.friction=0,this.impulse=null}};I.dynamics.constraint.info.joint||(I.dynamics.constraint.info.joint={});I.dynamics.constraint.info.joint.JointSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0,this.rows=new Array(I.common.Setting.maxJacobianRows);let t=0,e=this.rows.length;for(;t<e;)this.rows[t++]=new I.dynamics.constraint.info.joint.JointSolverInfoRow}};I.dynamics.constraint.info.joint.JointSolverInfoRow=class{constructor(){this.jacobian=new I.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.minImpulse=0,this.maxImpulse=0,this.motorSpeed=0,this.motorMaxImpulse=0,this.impulse=null}};I.dynamics.constraint.joint||(I.dynamics.constraint.joint={});I.dynamics.constraint.joint.BasisTracker=class{constructor(t){this.joint=t,this.xX=0,this.xY=0,this.xZ=0,this.yX=0,this.yY=0,this.yZ=0,this.zX=0,this.zY=0,this.zZ=0}};I.dynamics.constraint.joint.Joint=class{constructor(t,e){switch(this._link1=new I.dynamics.constraint.joint.JointLink(this),this._link2=new I.dynamics.constraint.joint.JointLink(this),this._positionCorrectionAlgorithm=I.common.Setting.defaultJointPositionCorrectionAlgorithm,this._type=e,this._world=null,this._b1=t.rigidBody1,this._b2=t.rigidBody2,this._allowCollision=t.allowCollision,this._breakForce=t.breakForce,this._breakTorque=t.breakTorque,t.solverType){case 0:this._solver=new I.dynamics.constraint.solver.pgs.PgsJointConstraintSolver(this);break;case 1:this._solver=new I.dynamics.constraint.solver.direct.DirectJointConstraintSolver(this);break}let i=t.localAnchor1;this._localAnchor1X=i.x,this._localAnchor1Y=i.y,this._localAnchor1Z=i.z;let n=t.localAnchor2;this._localAnchor2X=n.x,this._localAnchor2Y=n.y,this._localAnchor2Z=n.z,this._relativeAnchor1X=0,this._relativeAnchor1Y=0,this._relativeAnchor1Z=0,this._relativeAnchor2X=0,this._relativeAnchor2Y=0,this._relativeAnchor2Z=0,this._anchor1X=0,this._anchor1Y=0,this._anchor1Z=0,this._anchor2X=0,this._anchor2Y=0,this._anchor2Z=0,this._localBasisX1X=0,this._localBasisX1Y=0,this._localBasisX1Z=0,this._localBasisY1X=0,this._localBasisY1Y=0,this._localBasisY1Z=0,this._localBasisZ1X=0,this._localBasisZ1Y=0,this._localBasisZ1Z=0,this._localBasisX2X=0,this._localBasisX2Y=0,this._localBasisX2Z=0,this._localBasisY2X=0,this._localBasisY2Y=0,this._localBasisY2Z=0,this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=0,this._impulses=new Array(I.common.Setting.maxJacobianRows);let s=0,o=I.common.Setting.maxJacobianRows;for(;s<o;)this._impulses[s++]=new I.dynamics.constraint.joint.JointImpulse}buildLocalBasesFromX(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let nt=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;nt>0&&(nt=1/Math.sqrt(nt)),this._localBasisX1X*=nt,this._localBasisX1Y*=nt,this._localBasisX1Z*=nt}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{let nt=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;nt>0&&(nt=1/Math.sqrt(nt)),this._localBasisX2X*=nt,this._localBasisX2Y*=nt,this._localBasisX2Z*=nt}let t,e,i,n,s,o,r,_,a,l,h,u,f,m=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(m<-.999999999){let nt,H,j,it=this._localBasisX1X,et=this._localBasisX1Y,G=this._localBasisX1Z,W=it*it,lt=et*et,ht=G*G,ft;W<lt?W<ht?(ft=1/Math.sqrt(lt+ht),nt=0,H=G*ft,j=-et*ft):(ft=1/Math.sqrt(W+lt),nt=et*ft,H=-it*ft,j=0):lt<ht?(ft=1/Math.sqrt(ht+W),nt=-G*ft,H=0,j=it*ft):(ft=1/Math.sqrt(W+lt),nt=et*ft,H=-it*ft,j=0),t=nt,e=H,i=j,n=0}else{let nt,H,j;nt=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,H=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,j=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;let it=Math.sqrt((1+m)*.5);m=.5/it,nt*=m,H*=m,j*=m,t=nt,e=H,i=j,n=it}let d=t,p=e,g=i,x=n,b=2*d,y=2*p,z=2*g,M=d*b,Y=p*y,X=g*z,w=d*y,S=p*z,V=d*z,F=x*b,C=x*y,A=x*z;s=1-Y-X,o=w-A,r=V+C,_=w+A,a=1-M-X,l=S-F,h=V-C,u=S+F,f=1-M-Y;let Z=this._localBasisX1X,L=this._localBasisX1Y,E=this._localBasisX1Z,T=Z*Z,P=L*L,N=E*E,R;T<P?T<N?(R=1/Math.sqrt(P+N),this._localBasisY1X=0,this._localBasisY1Y=E*R,this._localBasisY1Z=-L*R):(R=1/Math.sqrt(T+P),this._localBasisY1X=L*R,this._localBasisY1Y=-Z*R,this._localBasisY1Z=0):P<N?(R=1/Math.sqrt(N+T),this._localBasisY1X=-E*R,this._localBasisY1Y=0,this._localBasisY1Z=Z*R):(R=1/Math.sqrt(T+P),this._localBasisY1X=L*R,this._localBasisY1Y=-Z*R,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X;let k,O,v;k=s*this._localBasisX1X+o*this._localBasisX1Y+r*this._localBasisX1Z,O=_*this._localBasisX1X+a*this._localBasisX1Y+l*this._localBasisX1Z,v=h*this._localBasisX1X+u*this._localBasisX1Y+f*this._localBasisX1Z,this._localBasisX2X=k,this._localBasisX2Y=O,this._localBasisX2Z=v;let D,B,U;D=s*this._localBasisY1X+o*this._localBasisY1Y+r*this._localBasisY1Z,B=_*this._localBasisY1X+a*this._localBasisY1Y+l*this._localBasisY1Z,U=h*this._localBasisY1X+u*this._localBasisY1Y+f*this._localBasisY1Z,this._localBasisY2X=D,this._localBasisY2Y=B,this._localBasisY2Z=U;let q,tt,Q;q=s*this._localBasisZ1X+o*this._localBasisZ1Y+r*this._localBasisZ1Z,tt=_*this._localBasisZ1X+a*this._localBasisZ1Y+l*this._localBasisZ1Z,Q=h*this._localBasisZ1X+u*this._localBasisZ1Y+f*this._localBasisZ1Z,this._localBasisZ2X=q,this._localBasisZ2Y=tt,this._localBasisZ2Z=Q}buildLocalBasesFromXY(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{let t=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX2X*=t,this._localBasisX2Y*=t,this._localBasisX2Z*=t}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){let t=this._localBasisX1X,e=this._localBasisX1Y,i=this._localBasisX1Z,n=t*t,s=e*e,o=i*i,r;n<s?n<o?(r=1/Math.sqrt(s+o),this._localBasisY1X=0,this._localBasisY1Y=i*r,this._localBasisY1Z=-e*r):(r=1/Math.sqrt(n+s),this._localBasisY1X=e*r,this._localBasisY1Y=-t*r,this._localBasisY1Z=0):s<o?(r=1/Math.sqrt(o+n),this._localBasisY1X=-i*r,this._localBasisY1Y=0,this._localBasisY1Z=t*r):(r=1/Math.sqrt(n+s),this._localBasisY1X=e*r,this._localBasisY1Y=-t*r,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{let t=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ1X*=t,this._localBasisZ1Y*=t,this._localBasisZ1Z*=t,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0){let t=this._localBasisX2X,e=this._localBasisX2Y,i=this._localBasisX2Z,n=t*t,s=e*e,o=i*i,r;n<s?n<o?(r=1/Math.sqrt(s+o),this._localBasisY2X=0,this._localBasisY2Y=i*r,this._localBasisY2Z=-e*r):(r=1/Math.sqrt(n+s),this._localBasisY2X=e*r,this._localBasisY2Y=-t*r,this._localBasisY2Z=0):s<o?(r=1/Math.sqrt(o+n),this._localBasisY2X=-i*r,this._localBasisY2Y=0,this._localBasisY2Z=t*r):(r=1/Math.sqrt(n+s),this._localBasisY2X=e*r,this._localBasisY2Y=-t*r,this._localBasisY2Z=0),this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X}else{let t=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ2X*=t,this._localBasisZ2Y*=t,this._localBasisZ2Z*=t,this._localBasisY2X=this._localBasisZ2Y*this._localBasisX2Z-this._localBasisZ2Z*this._localBasisX2Y,this._localBasisY2Y=this._localBasisZ2Z*this._localBasisX2X-this._localBasisZ2X*this._localBasisX2Z,this._localBasisY2Z=this._localBasisZ2X*this._localBasisX2Y-this._localBasisZ2Y*this._localBasisX2X}}buildLocalBasesFromX1Z2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let B=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;B>0&&(B=1/Math.sqrt(B)),this._localBasisX1X*=B,this._localBasisX1Y*=B,this._localBasisX1Z*=B}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0)this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=1;else{let B=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;B>0&&(B=1/Math.sqrt(B)),this._localBasisZ2X*=B,this._localBasisZ2Y*=B,this._localBasisZ2Z*=B}let t=this._b1._transform,e=this._b2._transform,i,n,s,o,r,_,a,l,h,u,f,m,d,p,g,x,b,y;x=t._rotation00*this._localBasisX1X+t._rotation01*this._localBasisX1Y+t._rotation02*this._localBasisX1Z,b=t._rotation10*this._localBasisX1X+t._rotation11*this._localBasisX1Y+t._rotation12*this._localBasisX1Z,y=t._rotation20*this._localBasisX1X+t._rotation21*this._localBasisX1Y+t._rotation22*this._localBasisX1Z,i=x,n=b,s=y;let z,M,Y;if(z=e._rotation00*this._localBasisZ2X+e._rotation01*this._localBasisZ2Y+e._rotation02*this._localBasisZ2Z,M=e._rotation10*this._localBasisZ2X+e._rotation11*this._localBasisZ2Y+e._rotation12*this._localBasisZ2Z,Y=e._rotation20*this._localBasisZ2X+e._rotation21*this._localBasisZ2Y+e._rotation22*this._localBasisZ2Z,d=z,p=M,g=Y,a=p*s-g*n,l=g*i-d*s,h=d*n-p*i,a*a+l*l+h*h==0){let B=i,U=n,q=s,tt=B*B,Q=U*U,nt=q*q,H;tt<Q?tt<nt?(H=1/Math.sqrt(Q+nt),a=0,l=q*H,h=-U*H):(H=1/Math.sqrt(tt+Q),a=U*H,l=-B*H,h=0):Q<nt?(H=1/Math.sqrt(nt+tt),a=-q*H,l=0,h=B*H):(H=1/Math.sqrt(tt+Q),a=U*H,l=-B*H,h=0)}o=n*h-s*l,r=s*a-i*h,_=i*l-n*a,u=l*g-h*p,f=h*d-a*g,m=a*p-l*d;let X,w,S;X=t._rotation00*i+t._rotation10*n+t._rotation20*s,w=t._rotation01*i+t._rotation11*n+t._rotation21*s,S=t._rotation02*i+t._rotation12*n+t._rotation22*s,this._localBasisX1X=X,this._localBasisX1Y=w,this._localBasisX1Z=S;let V,F,C;V=t._rotation00*a+t._rotation10*l+t._rotation20*h,F=t._rotation01*a+t._rotation11*l+t._rotation21*h,C=t._rotation02*a+t._rotation12*l+t._rotation22*h,this._localBasisY1X=V,this._localBasisY1Y=F,this._localBasisY1Z=C;let A,Z,L;A=t._rotation00*o+t._rotation10*r+t._rotation20*_,Z=t._rotation01*o+t._rotation11*r+t._rotation21*_,L=t._rotation02*o+t._rotation12*r+t._rotation22*_,this._localBasisZ1X=A,this._localBasisZ1Y=Z,this._localBasisZ1Z=L;let E,T,P;E=e._rotation00*u+e._rotation10*f+e._rotation20*m,T=e._rotation01*u+e._rotation11*f+e._rotation21*m,P=e._rotation02*u+e._rotation12*f+e._rotation22*m,this._localBasisX2X=E,this._localBasisX2Y=T,this._localBasisX2Z=P;let N,R,k;N=e._rotation00*a+e._rotation10*l+e._rotation20*h,R=e._rotation01*a+e._rotation11*l+e._rotation21*h,k=e._rotation02*a+e._rotation12*l+e._rotation22*h,this._localBasisY2X=N,this._localBasisY2Y=R,this._localBasisY2Z=k;let O,v,D;O=e._rotation00*d+e._rotation10*p+e._rotation20*g,v=e._rotation01*d+e._rotation11*p+e._rotation21*g,D=e._rotation02*d+e._rotation12*p+e._rotation22*g,this._localBasisZ2X=O,this._localBasisZ2Y=v,this._localBasisZ2Z=D}buildLocalBasesFromXY1X2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let v=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;v>0&&(v=1/Math.sqrt(v)),this._localBasisX1X*=v,this._localBasisX1Y*=v,this._localBasisX1Z*=v}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){let v=this._localBasisX1X,D=this._localBasisX1Y,B=this._localBasisX1Z,U=v*v,q=D*D,tt=B*B,Q;U<q?U<tt?(Q=1/Math.sqrt(q+tt),this._localBasisY1X=0,this._localBasisY1Y=B*Q,this._localBasisY1Z=-D*Q):(Q=1/Math.sqrt(U+q),this._localBasisY1X=D*Q,this._localBasisY1Y=-v*Q,this._localBasisY1Z=0):q<tt?(Q=1/Math.sqrt(tt+U),this._localBasisY1X=-B*Q,this._localBasisY1Y=0,this._localBasisY1Z=v*Q):(Q=1/Math.sqrt(U+q),this._localBasisY1X=D*Q,this._localBasisY1Y=-v*Q,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{let v=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;v>0&&(v=1/Math.sqrt(v)),this._localBasisZ1X*=v,this._localBasisZ1Y*=v,this._localBasisZ1Z*=v,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}let t,e,i,n,s,o,r,_,a,l,h,u,f,m=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(m<-.999999999){let v,D,B,U=this._localBasisX1X,q=this._localBasisX1Y,tt=this._localBasisX1Z,Q=U*U,nt=q*q,H=tt*tt,j;Q<nt?Q<H?(j=1/Math.sqrt(nt+H),v=0,D=tt*j,B=-q*j):(j=1/Math.sqrt(Q+nt),v=q*j,D=-U*j,B=0):nt<H?(j=1/Math.sqrt(H+Q),v=-tt*j,D=0,B=U*j):(j=1/Math.sqrt(Q+nt),v=q*j,D=-U*j,B=0),t=v,e=D,i=B,n=0}else{let v,D,B;v=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,D=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,B=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;let U=Math.sqrt((1+m)*.5);m=.5/U,v*=m,D*=m,B*=m,t=v,e=D,i=B,n=U}let d=t,p=e,g=i,x=n,b=2*d,y=2*p,z=2*g,M=d*b,Y=p*y,X=g*z,w=d*y,S=p*z,V=d*z,F=x*b,C=x*y,A=x*z;s=1-Y-X,o=w-A,r=V+C,_=w+A,a=1-M-X,l=S-F,h=V-C,u=S+F,f=1-M-Y;let Z,L,E;Z=s*this._localBasisX1X+o*this._localBasisX1Y+r*this._localBasisX1Z,L=_*this._localBasisX1X+a*this._localBasisX1Y+l*this._localBasisX1Z,E=h*this._localBasisX1X+u*this._localBasisX1Y+f*this._localBasisX1Z,this._localBasisX2X=Z,this._localBasisX2Y=L,this._localBasisX2Z=E;let T,P,N;T=s*this._localBasisY1X+o*this._localBasisY1Y+r*this._localBasisY1Z,P=_*this._localBasisY1X+a*this._localBasisY1Y+l*this._localBasisY1Z,N=h*this._localBasisY1X+u*this._localBasisY1Y+f*this._localBasisY1Z,this._localBasisY2X=T,this._localBasisY2Y=P,this._localBasisY2Z=N;let R,k,O;R=s*this._localBasisZ1X+o*this._localBasisZ1Y+r*this._localBasisZ1Z,k=_*this._localBasisZ1X+a*this._localBasisZ1Y+l*this._localBasisZ1Z,O=h*this._localBasisZ1X+u*this._localBasisZ1Y+f*this._localBasisZ1Z,this._localBasisZ2X=R,this._localBasisZ2Y=k,this._localBasisZ2Z=O}setSolverInfoRowLinear(t,e,i,n,s,o,r){let _,a,l=I.common.Setting.linearSlop;if(r)_=0,a=1;else{if(s.frequency>0){l=0;let p=6.28318530717958*s.frequency,g=s.dampingRatio;g<I.common.Setting.minSpringDamperDampingRatio&&(g=I.common.Setting.minSpringDamperDampingRatio);let x=o.dt,b=2*g*p,y=p*p;s.useSymplecticEuler?(_=1/(x*b),a=y/b):(_=1/(x*(x*y+b)),a=y/(x*y+b))}else _=0,a=this.getErp(o,!1);i.motorForce>0?(t.motorSpeed=i.motorSpeed,t.motorMaxImpulse=i.motorForce*o.dt):(t.motorSpeed=0,t.motorMaxImpulse=0)}let h=i.lowerLimit,u=i.upperLimit,f,m,d;h>u?(f=0,m=0,d=0):h==u?(f=-1/0,m=1/0,d=e-h):e<h?(f=-1/0,m=0,d=e-h+l,d>0&&(d=0)):e>u?(f=0,m=1/0,d=e-u-l,d<0&&(d=0)):(f=0,m=0,d=0),t.minImpulse=f,t.maxImpulse=m,t.cfm=_*(n==0?0:1/n),t.rhs=d*a}setSolverInfoRowAngular(t,e,i,n,s,o,r){let _,a,l=I.common.Setting.angularSlop;if(r)_=0,a=1;else{if(s.frequency>0){l=0;let g=6.28318530717958*s.frequency,x=s.dampingRatio;x<I.common.Setting.minSpringDamperDampingRatio&&(x=I.common.Setting.minSpringDamperDampingRatio);let b=o.dt,y=2*x*g,z=g*g;s.useSymplecticEuler?(_=1/(b*y),a=z/y):(_=1/(b*(b*z+y)),a=z/(b*z+y))}else _=0,a=this.getErp(o,!1);i.motorTorque>0?(t.motorSpeed=i.motorSpeed,t.motorMaxImpulse=i.motorTorque*o.dt):(t.motorSpeed=0,t.motorMaxImpulse=0)}let h=i.lowerLimit,u=i.upperLimit,f=(h+u)*.5;e-=f,e=((e+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,e+=f;let m,d,p;h>u?(m=0,d=0,p=0):h==u?(m=-1/0,d=1/0,p=e-h):e<h?(m=-1/0,d=0,p=e-h+l,p>0&&(p=0)):e>u?(m=0,d=1/0,p=e-u-l,p<0&&(p=0)):(m=0,d=0,p=0),t.minImpulse=m,t.maxImpulse=d,t.cfm=_*(n==0?0:1/n),t.rhs=p*a}getErp(t,e){return e?1:this._positionCorrectionAlgorithm==I.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?t.invDt*I.common.Setting.velocityBaumgarte:0}computeEffectiveInertiaMoment(t,e,i){let n,s,o,r,_,a,l,h,u;l=this._b1._invInertia00*t+this._b1._invInertia01*e+this._b1._invInertia02*i,h=this._b1._invInertia10*t+this._b1._invInertia11*e+this._b1._invInertia12*i,u=this._b1._invInertia20*t+this._b1._invInertia21*e+this._b1._invInertia22*i,n=l,s=h,o=u;let f,m,d;f=this._b2._invInertia00*t+this._b2._invInertia01*e+this._b2._invInertia02*i,m=this._b2._invInertia10*t+this._b2._invInertia11*e+this._b2._invInertia12*i,d=this._b2._invInertia20*t+this._b2._invInertia21*e+this._b2._invInertia22*i,r=f,_=m,a=d;let p=n*t+s*e+o*i,g=r*t+_*e+a*i;if(p>0){let x=t*this._relativeAnchor1X+e*this._relativeAnchor1Y+i*this._relativeAnchor1Z,b=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z-x*x;b>0&&(this._b1._invMass>0?p=1/(1/p+this._b1._mass*b):p=0)}if(g>0){let x=t*this._relativeAnchor2X+e*this._relativeAnchor2Y+i*this._relativeAnchor2Z,b=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z-x*x;b>0&&(this._b2._invMass>0?g=1/(1/g+this._b2._mass*b):g=0)}return p+g==0?0:1/(p+g)}computeEffectiveInertiaMoment2(t,e,i,n,s,o){let r,_,a,l,h,u,f,m,d;f=this._b1._invInertia00*t+this._b1._invInertia01*e+this._b1._invInertia02*i,m=this._b1._invInertia10*t+this._b1._invInertia11*e+this._b1._invInertia12*i,d=this._b1._invInertia20*t+this._b1._invInertia21*e+this._b1._invInertia22*i,r=f,_=m,a=d;let p,g,x;p=this._b2._invInertia00*n+this._b2._invInertia01*s+this._b2._invInertia02*o,g=this._b2._invInertia10*n+this._b2._invInertia11*s+this._b2._invInertia12*o,x=this._b2._invInertia20*n+this._b2._invInertia21*s+this._b2._invInertia22*o,l=p,h=g,u=x;let b=r*t+_*e+a*i,y=l*n+h*s+u*o;if(b>0){let z=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,M=t*this._relativeAnchor1X+e*this._relativeAnchor1Y+i*this._relativeAnchor1Z,Y=z*z-M*M;Y>0&&(this._b1._invMass>0?b=1/(1/b+this._b1._mass*Y):b=0)}if(y>0){let z=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,M=n*this._relativeAnchor2X+s*this._relativeAnchor2Y+o*this._relativeAnchor2Z,Y=z*z-M*M;Y>0&&(this._b2._invMass>0?y=1/(1/y+this._b2._mass*Y):y=0)}return b+y==0?0:1/(b+y)}_syncAnchors(){let t=this._b1._transform,e=this._b2._transform,i,n,s;i=t._rotation00*this._localAnchor1X+t._rotation01*this._localAnchor1Y+t._rotation02*this._localAnchor1Z,n=t._rotation10*this._localAnchor1X+t._rotation11*this._localAnchor1Y+t._rotation12*this._localAnchor1Z,s=t._rotation20*this._localAnchor1X+t._rotation21*this._localAnchor1Y+t._rotation22*this._localAnchor1Z,this._relativeAnchor1X=i,this._relativeAnchor1Y=n,this._relativeAnchor1Z=s;let o,r,_;o=e._rotation00*this._localAnchor2X+e._rotation01*this._localAnchor2Y+e._rotation02*this._localAnchor2Z,r=e._rotation10*this._localAnchor2X+e._rotation11*this._localAnchor2Y+e._rotation12*this._localAnchor2Z,_=e._rotation20*this._localAnchor2X+e._rotation21*this._localAnchor2Y+e._rotation22*this._localAnchor2Z,this._relativeAnchor2X=o,this._relativeAnchor2Y=r,this._relativeAnchor2Z=_,this._anchor1X=this._relativeAnchor1X+t._positionX,this._anchor1Y=this._relativeAnchor1Y+t._positionY,this._anchor1Z=this._relativeAnchor1Z+t._positionZ,this._anchor2X=this._relativeAnchor2X+e._positionX,this._anchor2Y=this._relativeAnchor2Y+e._positionY,this._anchor2Z=this._relativeAnchor2Z+e._positionZ;let a,l,h;a=t._rotation00*this._localBasisX1X+t._rotation01*this._localBasisX1Y+t._rotation02*this._localBasisX1Z,l=t._rotation10*this._localBasisX1X+t._rotation11*this._localBasisX1Y+t._rotation12*this._localBasisX1Z,h=t._rotation20*this._localBasisX1X+t._rotation21*this._localBasisX1Y+t._rotation22*this._localBasisX1Z,this._basisX1X=a,this._basisX1Y=l,this._basisX1Z=h;let u,f,m;u=t._rotation00*this._localBasisY1X+t._rotation01*this._localBasisY1Y+t._rotation02*this._localBasisY1Z,f=t._rotation10*this._localBasisY1X+t._rotation11*this._localBasisY1Y+t._rotation12*this._localBasisY1Z,m=t._rotation20*this._localBasisY1X+t._rotation21*this._localBasisY1Y+t._rotation22*this._localBasisY1Z,this._basisY1X=u,this._basisY1Y=f,this._basisY1Z=m;let d,p,g;d=t._rotation00*this._localBasisZ1X+t._rotation01*this._localBasisZ1Y+t._rotation02*this._localBasisZ1Z,p=t._rotation10*this._localBasisZ1X+t._rotation11*this._localBasisZ1Y+t._rotation12*this._localBasisZ1Z,g=t._rotation20*this._localBasisZ1X+t._rotation21*this._localBasisZ1Y+t._rotation22*this._localBasisZ1Z,this._basisZ1X=d,this._basisZ1Y=p,this._basisZ1Z=g;let x,b,y;x=e._rotation00*this._localBasisX2X+e._rotation01*this._localBasisX2Y+e._rotation02*this._localBasisX2Z,b=e._rotation10*this._localBasisX2X+e._rotation11*this._localBasisX2Y+e._rotation12*this._localBasisX2Z,y=e._rotation20*this._localBasisX2X+e._rotation21*this._localBasisX2Y+e._rotation22*this._localBasisX2Z,this._basisX2X=x,this._basisX2Y=b,this._basisX2Z=y;let z,M,Y;z=e._rotation00*this._localBasisY2X+e._rotation01*this._localBasisY2Y+e._rotation02*this._localBasisY2Z,M=e._rotation10*this._localBasisY2X+e._rotation11*this._localBasisY2Y+e._rotation12*this._localBasisY2Z,Y=e._rotation20*this._localBasisY2X+e._rotation21*this._localBasisY2Y+e._rotation22*this._localBasisY2Z,this._basisY2X=z,this._basisY2Y=M,this._basisY2Z=Y;let X,w,S;X=e._rotation00*this._localBasisZ2X+e._rotation01*this._localBasisZ2Y+e._rotation02*this._localBasisZ2Z,w=e._rotation10*this._localBasisZ2X+e._rotation11*this._localBasisZ2Y+e._rotation12*this._localBasisZ2Z,S=e._rotation20*this._localBasisZ2X+e._rotation21*this._localBasisZ2Y+e._rotation22*this._localBasisZ2Z,this._basisZ2X=X,this._basisZ2Y=w,this._basisZ2Z=S}_getVelocitySolverInfo(t,e){e.b1=this._b1,e.b2=this._b2,e.numRows=0}_getPositionSolverInfo(t){t.b1=this._b1,t.b2=this._b2,t.numRows=0}_checkDestruction(){let t=this._appliedTorqueX*this._appliedTorqueX+this._appliedTorqueY*this._appliedTorqueY+this._appliedTorqueZ*this._appliedTorqueZ;if(this._breakForce>0&&this._appliedForceX*this._appliedForceX+this._appliedForceY*this._appliedForceY+this._appliedForceZ*this._appliedForceZ>this._breakForce*this._breakForce){this._world.removeJoint(this);return}if(this._breakTorque>0&&t>this._breakTorque*this._breakTorque){this._world.removeJoint(this);return}}getRigidBody1(){return this._b1}getRigidBody2(){return this._b2}getType(){return this._type}getAnchor1(){let t=new I.common.Vec3;return t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z,t}getAnchor2(){let t=new I.common.Vec3;return t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z,t}getAnchor1To(t){t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z}getAnchor2To(t){t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z}getLocalAnchor1(){let t=new I.common.Vec3;return t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z,t}getLocalAnchor2(){let t=new I.common.Vec3;return t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z,t}getLocalAnchor1To(t){t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z}getLocalAnchor2To(t){t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z}getBasis1(){let t=new I.common.Mat3,e,i,n,s,o,r,_,a,l;return e=this._basisX1X,i=this._basisY1X,n=this._basisZ1X,s=this._basisX1Y,o=this._basisY1Y,r=this._basisZ1Y,_=this._basisX1Z,a=this._basisY1Z,l=this._basisZ1Z,t.e00=e,t.e01=i,t.e02=n,t.e10=s,t.e11=o,t.e12=r,t.e20=_,t.e21=a,t.e22=l,t}getBasis2(){let t=new I.common.Mat3,e,i,n,s,o,r,_,a,l;return e=this._basisX2X,i=this._basisY2X,n=this._basisZ2X,s=this._basisX2Y,o=this._basisY2Y,r=this._basisZ2Y,_=this._basisX2Z,a=this._basisY2Z,l=this._basisZ2Z,t.e00=e,t.e01=i,t.e02=n,t.e10=s,t.e11=o,t.e12=r,t.e20=_,t.e21=a,t.e22=l,t}getBasis1To(t){let e,i,n,s,o,r,_,a,l;e=this._basisX1X,i=this._basisY1X,n=this._basisZ1X,s=this._basisX1Y,o=this._basisY1Y,r=this._basisZ1Y,_=this._basisX1Z,a=this._basisY1Z,l=this._basisZ1Z,t.e00=e,t.e01=i,t.e02=n,t.e10=s,t.e11=o,t.e12=r,t.e20=_,t.e21=a,t.e22=l}getBasis2To(t){let e,i,n,s,o,r,_,a,l;e=this._basisX2X,i=this._basisY2X,n=this._basisZ2X,s=this._basisX2Y,o=this._basisY2Y,r=this._basisZ2Y,_=this._basisX2Z,a=this._basisY2Z,l=this._basisZ2Z,t.e00=e,t.e01=i,t.e02=n,t.e10=s,t.e11=o,t.e12=r,t.e20=_,t.e21=a,t.e22=l}getAllowCollision(){return this._allowCollision}setAllowCollision(t){this._allowCollision=t}getBreakForce(){return this._breakForce}setBreakForce(t){this._breakForce=t}getBreakTorque(){return this._breakTorque}setBreakTorque(t){this._breakTorque=t}getPositionCorrectionAlgorithm(){return this._positionCorrectionAlgorithm}setPositionCorrectionAlgorithm(t){switch(t){case 0:case 1:case 2:break;default:throw new Error("invalid position correction algorithm id: "+t)}this._positionCorrectionAlgorithm=t}getAppliedForce(){let t=new I.common.Vec3;return t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ,t}getAppliedForceTo(t){t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ}getAppliedTorque(){let t=new I.common.Vec3;return t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ,t}getAppliedTorqueTo(t){t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ}getPrev(){return this._prev}getNext(){return this._next}};I.dynamics.constraint.joint.CylindricalJoint=class extends I.dynamics.constraint.joint.Joint{constructor(t){super(t,2);let e=t.localAxis1;this._localBasisX1X=e.x,this._localBasisX1Y=e.y,this._localBasisX1Z=e.z;let i=t.localAxis2;this._localBasisX2X=i.x,this._localBasisX2Y=i.y,this._localBasisX2Z=i.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this._basis=new I.dynamics.constraint.joint.BasisTracker(this),this._translSd=t.translationalSpringDamper.clone(),this._translLm=t.translationalLimitMotor.clone(),this._rotSd=t.rotationalSpringDamper.clone(),this._rotLm=t.rotationalLimitMotor.clone()}getInfo(t,e,i){let n=this.getErp(e,i),s=this.linearErrorY*n,o=this.linearErrorZ*n,r=this.angularErrorY*n,_=this.angularErrorZ*n,a,l=1/(this._b1._invMass+this._b2._invMass),h=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ);if(this._translSd.frequency<=0||!i){let X=this._impulses[0],w=t.rows[t.numRows++],S=w.jacobian;S.lin1X=0,S.lin1Y=0,S.lin1Z=0,S.lin2X=0,S.lin2Y=0,S.lin2Z=0,S.ang1X=0,S.ang1Y=0,S.ang1Z=0,S.ang2X=0,S.ang2Y=0,S.ang2Z=0,w.rhs=0,w.cfm=0,w.minImpulse=0,w.maxImpulse=0,w.motorSpeed=0,w.motorMaxImpulse=0,w.impulse=null,w.impulse=X,this.setSolverInfoRowLinear(w,this.translation,this._translLm,l,this._translSd,e,i),a=w.jacobian,a.lin1X=this._basis.xX,a.lin1Y=this._basis.xY,a.lin1Z=this._basis.xZ,a.lin2X=this._basis.xX,a.lin2Y=this._basis.xY,a.lin2Z=this._basis.xZ,a.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,a.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,a.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,a.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,a.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,a.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}let u=this._impulses[1],f=t.rows[t.numRows++],m=f.jacobian;m.lin1X=0,m.lin1Y=0,m.lin1Z=0,m.lin2X=0,m.lin2Y=0,m.lin2Z=0,m.ang1X=0,m.ang1Y=0,m.ang1Z=0,m.ang2X=0,m.ang2Y=0,m.ang2Z=0,f.rhs=0,f.cfm=0,f.minImpulse=0,f.maxImpulse=0,f.motorSpeed=0,f.motorMaxImpulse=0,f.impulse=null,f.impulse=u,f.rhs=s,f.cfm=0,f.minImpulse=-1/0,f.maxImpulse=1/0,a=f.jacobian,a.lin1X=this._basis.yX,a.lin1Y=this._basis.yY,a.lin1Z=this._basis.yZ,a.lin2X=this._basis.yX,a.lin2Y=this._basis.yY,a.lin2Z=this._basis.yZ,a.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,a.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,a.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,a.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,a.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,a.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;let d=this._impulses[2],p=t.rows[t.numRows++],g=p.jacobian;if(g.lin1X=0,g.lin1Y=0,g.lin1Z=0,g.lin2X=0,g.lin2Y=0,g.lin2Z=0,g.ang1X=0,g.ang1Y=0,g.ang1Z=0,g.ang2X=0,g.ang2Y=0,g.ang2Z=0,p.rhs=0,p.cfm=0,p.minImpulse=0,p.maxImpulse=0,p.motorSpeed=0,p.motorMaxImpulse=0,p.impulse=null,p.impulse=d,p.rhs=o,p.cfm=0,p.minImpulse=-1/0,p.maxImpulse=1/0,a=p.jacobian,a.lin1X=this._basis.zX,a.lin1Y=this._basis.zY,a.lin1Z=this._basis.zZ,a.lin2X=this._basis.zX,a.lin2Y=this._basis.zY,a.lin2Z=this._basis.zZ,a.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,a.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,a.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,a.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,a.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,a.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX,this._rotSd.frequency<=0||!i){let X=this._impulses[3],w=t.rows[t.numRows++],S=w.jacobian;S.lin1X=0,S.lin1Y=0,S.lin1Z=0,S.lin2X=0,S.lin2Y=0,S.lin2Z=0,S.ang1X=0,S.ang1Y=0,S.ang1Z=0,S.ang2X=0,S.ang2Y=0,S.ang2Z=0,w.rhs=0,w.cfm=0,w.minImpulse=0,w.maxImpulse=0,w.motorSpeed=0,w.motorMaxImpulse=0,w.impulse=null,w.impulse=X,this.setSolverInfoRowAngular(w,this.angle,this._rotLm,h,this._rotSd,e,i),a=w.jacobian,a.ang1X=this._basis.xX,a.ang1Y=this._basis.xY,a.ang1Z=this._basis.xZ,a.ang2X=this._basis.xX,a.ang2Y=this._basis.xY,a.ang2Z=this._basis.xZ}let x=this._impulses[4],b=t.rows[t.numRows++],y=b.jacobian;y.lin1X=0,y.lin1Y=0,y.lin1Z=0,y.lin2X=0,y.lin2Y=0,y.lin2Z=0,y.ang1X=0,y.ang1Y=0,y.ang1Z=0,y.ang2X=0,y.ang2Y=0,y.ang2Z=0,b.rhs=0,b.cfm=0,b.minImpulse=0,b.maxImpulse=0,b.motorSpeed=0,b.motorMaxImpulse=0,b.impulse=null,b.impulse=x,b.rhs=r,b.cfm=0,b.minImpulse=-1/0,b.maxImpulse=1/0,a=b.jacobian,a.ang1X=this._basis.yX,a.ang1Y=this._basis.yY,a.ang1Z=this._basis.yZ,a.ang2X=this._basis.yX,a.ang2Y=this._basis.yY,a.ang2Z=this._basis.yZ;let z=this._impulses[5],M=t.rows[t.numRows++],Y=M.jacobian;Y.lin1X=0,Y.lin1Y=0,Y.lin1Z=0,Y.lin2X=0,Y.lin2Y=0,Y.lin2Z=0,Y.ang1X=0,Y.ang1Y=0,Y.ang1Z=0,Y.ang2X=0,Y.ang2Y=0,Y.ang2Z=0,M.rhs=0,M.cfm=0,M.minImpulse=0,M.maxImpulse=0,M.motorSpeed=0,M.motorMaxImpulse=0,M.impulse=null,M.impulse=z,M.rhs=_,M.cfm=0,M.minImpulse=-1/0,M.maxImpulse=1/0,a=M.jacobian,a.ang1X=this._basis.zX,a.ang1Y=this._basis.zY,a.ang1Z=this._basis.zZ,a.ang2X=this._basis.zX,a.ang2Y=this._basis.zY,a.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();let t=this._basis,e=t.joint._b1._invMass,i=t.joint._b2._invMass,n,s,o,r,_,a,l,h,u,f,m,d,p,g,x,b,y,z,M,Y,X,w,S,V,F,C,A,Z,L,E,T,P,N,R,k,O,v=t.joint._basisX1X*t.joint._basisX2X+t.joint._basisX1Y*t.joint._basisX2Y+t.joint._basisX1Z*t.joint._basisX2Z;if(v<-.999999999){let Bt,re,Ce,be=t.joint._basisX1X,Tt=t.joint._basisX1Y,Lt=t.joint._basisX1Z,Yt=be*be,pe=Tt*Tt,Me=Lt*Lt,fe;Yt<pe?Yt<Me?(fe=1/Math.sqrt(pe+Me),Bt=0,re=Lt*fe,Ce=-Tt*fe):(fe=1/Math.sqrt(Yt+pe),Bt=Tt*fe,re=-be*fe,Ce=0):pe<Me?(fe=1/Math.sqrt(Me+Yt),Bt=-Lt*fe,re=0,Ce=be*fe):(fe=1/Math.sqrt(Yt+pe),Bt=Tt*fe,re=-be*fe,Ce=0),n=Bt,s=re,o=Ce,r=0}else{let Bt,re,Ce;Bt=t.joint._basisX1Y*t.joint._basisX2Z-t.joint._basisX1Z*t.joint._basisX2Y,re=t.joint._basisX1Z*t.joint._basisX2X-t.joint._basisX1X*t.joint._basisX2Z,Ce=t.joint._basisX1X*t.joint._basisX2Y-t.joint._basisX1Y*t.joint._basisX2X;let be=Math.sqrt((1+v)*.5);v=.5/be,Bt*=v,re*=v,Ce*=v,n=Bt,s=re,o=Ce,r=be}_=0,a=0,l=0,h=1;let D,B,U,q,tt,Q,nt,H;D=_,B=a,U=l,q=h,tt=n,Q=s,nt=o,H=r;let j=D*tt+B*Q+U*nt+q*H;if(j<0&&(j=-j,tt=-tt,Q=-Q,nt=-nt,H=-H),j>.999999){let Bt,re,Ce,be;Bt=tt-D,re=Q-B,Ce=nt-U,be=H-q,tt=D+Bt*(e/(e+i)),Q=B+re*(e/(e+i)),nt=U+Ce*(e/(e+i)),H=q+be*(e/(e+i));let Tt=tt*tt+Q*Q+nt*nt+H*H;Tt>1e-32&&(Tt=1/Math.sqrt(Tt)),u=tt*Tt,f=Q*Tt,m=nt*Tt,d=H*Tt}else{let Bt=e/(e+i)*Math.acos(j);tt+=D*-j,Q+=B*-j,nt+=U*-j,H+=q*-j;let re=tt*tt+Q*Q+nt*nt+H*H;re>1e-32&&(re=1/Math.sqrt(re)),tt*=re,Q*=re,nt*=re,H*=re;let Ce=Math.sin(Bt),be=Math.cos(Bt);D*=be,B*=be,U*=be,q*=be,u=D+tt*Ce,f=B+Q*Ce,m=U+nt*Ce,d=q+H*Ce}let it=u,et=f,G=m,W=d,lt=2*it,ht=2*et,ft=2*G,pt=it*lt,K=et*ht,J=G*ft,rt=it*ht,mt=et*ft,xt=it*ft,vt=W*lt,Mt=W*ht,ut=W*ft;p=1-K-J,g=rt-ut,x=xt+Mt,b=rt+ut,y=1-pt-J,z=mt-vt,M=xt-Mt,Y=mt+vt,X=1-pt-K;let Zt,zt,dt;Zt=p*t.joint._basisX1X+g*t.joint._basisX1Y+x*t.joint._basisX1Z,zt=b*t.joint._basisX1X+y*t.joint._basisX1Y+z*t.joint._basisX1Z,dt=M*t.joint._basisX1X+Y*t.joint._basisX1Y+X*t.joint._basisX1Z,w=Zt,S=zt,V=dt,T=t.xX,P=t.xY,N=t.xZ,R=t.yX,k=t.yY,O=t.yZ;let st=T*w+P*S+N*V;if(st<-.999999999){let Bt,re,Ce,be=T,Tt=P,Lt=N,Yt=be*be,pe=Tt*Tt,Me=Lt*Lt,fe;Yt<pe?Yt<Me?(fe=1/Math.sqrt(pe+Me),Bt=0,re=Lt*fe,Ce=-Tt*fe):(fe=1/Math.sqrt(Yt+pe),Bt=Tt*fe,re=-be*fe,Ce=0):pe<Me?(fe=1/Math.sqrt(Me+Yt),Bt=-Lt*fe,re=0,Ce=be*fe):(fe=1/Math.sqrt(Yt+pe),Bt=Tt*fe,re=-be*fe,Ce=0),u=Bt,f=re,m=Ce,d=0}else{let Bt,re,Ce;Bt=P*V-N*S,re=N*w-T*V,Ce=T*S-P*w;let be=Math.sqrt((1+st)*.5);st=.5/be,Bt*=st,re*=st,Ce*=st,u=Bt,f=re,m=Ce,d=be}let ct=u,_t=f,Vt=m,At=d,St=2*ct,Xt=2*_t,Ft=2*Vt,ie=ct*St,ee=_t*Xt,Ye=Vt*Ft,Ie=ct*Xt,ue=_t*Ft,$t=ct*Ft,Ht=At*St,me=At*Xt,ze=At*Ft;p=1-ee-Ye,g=Ie-ze,x=$t+me,b=Ie+ze,y=1-ie-Ye,z=ue-Ht,M=$t-me,Y=ue+Ht,X=1-ie-ee;let qe,Ee,Ut;if(qe=p*R+g*k+x*O,Ee=b*R+y*k+z*O,Ut=M*R+Y*k+X*O,F=qe,C=Ee,A=Ut,Z=S*A-V*C,L=V*F-w*A,E=w*C-S*F,Z*Z+L*L+E*E>1e-6){let Bt=Z*Z+L*L+E*E;Bt>0&&(Bt=1/Math.sqrt(Bt)),Z*=Bt,L*=Bt,E*=Bt}else{let Bt=w,re=S,Ce=V,be=Bt*Bt,Tt=re*re,Lt=Ce*Ce,Yt;be<Tt?be<Lt?(Yt=1/Math.sqrt(Tt+Lt),Z=0,L=Ce*Yt,E=-re*Yt):(Yt=1/Math.sqrt(be+Tt),Z=re*Yt,L=-Bt*Yt,E=0):Tt<Lt?(Yt=1/Math.sqrt(Lt+be),Z=-Ce*Yt,L=0,E=Bt*Yt):(Yt=1/Math.sqrt(be+Tt),Z=re*Yt,L=-Bt*Yt,E=0)}F=L*V-E*S,C=E*w-Z*V,A=Z*S-L*w,t.xX=w,t.xY=S,t.xZ=V,t.yX=F,t.yY=C,t.yZ=A,t.zX=Z,t.zY=L,t.zZ=E;let at,gt,yt;at=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,gt=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,yt=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;let bt=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,ot=bt<=-1?3.14159265358979:bt>=1?0:Math.acos(bt),Pt=at*at+gt*gt+yt*yt;Pt>0&&(Pt=1/Math.sqrt(Pt)),at*=Pt,gt*=Pt,yt*=Pt,at*=ot,gt*=ot,yt*=ot,this.angularErrorY=at*this._basis.yX+gt*this._basis.yY+yt*this._basis.yZ,this.angularErrorZ=at*this._basis.zX+gt*this._basis.zY+yt*this._basis.zZ;let Dt,$,kt;Dt=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,$=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,kt=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,bt=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=bt<=-1?3.14159265358979:bt>=1?0:Math.acos(bt),Dt*this._basis.xX+$*this._basis.xY+kt*this._basis.xZ<0&&(this.angle=-this.angle);let Rt,Ot,Wt;Rt=this._anchor2X-this._anchor1X,Ot=this._anchor2Y-this._anchor1Y,Wt=this._anchor2Z-this._anchor1Z,this.translation=Rt*this._basis.xX+Ot*this._basis.xY+Wt*this._basis.xZ,this.linearErrorY=Rt*this._basis.yX+Ot*this._basis.yY+Wt*this._basis.yZ,this.linearErrorZ=Rt*this._basis.zX+Ot*this._basis.zY+Wt*this._basis.zZ}_getVelocitySolverInfo(t,e){super._getVelocitySolverInfo(t,e),this.getInfo(e,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new I.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new I.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new I.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new I.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getTranslationalSpringDamper(){return this._translSd}getRotationalSpringDamper(){return this._rotSd}getTranslationalLimitMotor(){return this._translLm}getRotationalLimitMotor(){return this._rotLm}getAngle(){return this.angle}getTranslation(){return this.translation}};I.dynamics.constraint.joint.JointConfig=class{constructor(){this.rigidBody1=null,this.rigidBody2=null,this.localAnchor1=new I.common.Vec3,this.localAnchor2=new I.common.Vec3,this.allowCollision=!1,this.solverType=I.common.Setting.defaultJointConstraintSolverType,this.positionCorrectionAlgorithm=I.common.Setting.defaultJointPositionCorrectionAlgorithm,this.breakForce=0,this.breakTorque=0}_init(t,e,i){this.rigidBody1=t,this.rigidBody2=e;let n=this.rigidBody1,s=this.localAnchor1,o,r,_;o=i.x,r=i.y,_=i.z,o-=n._transform._positionX,r-=n._transform._positionY,_-=n._transform._positionZ;let a,l,h;a=n._transform._rotation00*o+n._transform._rotation10*r+n._transform._rotation20*_,l=n._transform._rotation01*o+n._transform._rotation11*r+n._transform._rotation21*_,h=n._transform._rotation02*o+n._transform._rotation12*r+n._transform._rotation22*_,o=a,r=l,_=h,s.x=o,s.y=r,s.z=_;let u=this.rigidBody2,f=this.localAnchor2,m,d,p;m=i.x,d=i.y,p=i.z,m-=u._transform._positionX,d-=u._transform._positionY,p-=u._transform._positionZ;let g,x,b;g=u._transform._rotation00*m+u._transform._rotation10*d+u._transform._rotation20*p,x=u._transform._rotation01*m+u._transform._rotation11*d+u._transform._rotation21*p,b=u._transform._rotation02*m+u._transform._rotation12*d+u._transform._rotation22*p,m=g,d=x,p=b,f.x=m,f.y=d,f.z=p}};I.dynamics.constraint.joint.CylindricalJointConfig=class extends I.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new I.common.Vec3(1,0,0),this.localAxis2=new I.common.Vec3(1,0,0),this.translationalLimitMotor=new I.dynamics.constraint.joint.TranslationalLimitMotor,this.translationalSpringDamper=new I.dynamics.constraint.joint.SpringDamper,this.rotationalLimitMotor=new I.dynamics.constraint.joint.RotationalLimitMotor,this.rotationalSpringDamper=new I.dynamics.constraint.joint.SpringDamper}init(t,e,i,n){this._init(t,e,i);let s=this.localAxis1,o,r,_;o=n.x,r=n.y,_=n.z;let a,l,h;a=t._transform._rotation00*o+t._transform._rotation10*r+t._transform._rotation20*_,l=t._transform._rotation01*o+t._transform._rotation11*r+t._transform._rotation21*_,h=t._transform._rotation02*o+t._transform._rotation12*r+t._transform._rotation22*_,o=a,r=l,_=h,s.x=o,s.y=r,s.z=_;let u=this.localAxis2,f,m,d;f=n.x,m=n.y,d=n.z;let p,g,x;return p=e._transform._rotation00*f+e._transform._rotation10*m+e._transform._rotation20*d,g=e._transform._rotation01*f+e._transform._rotation11*m+e._transform._rotation21*d,x=e._transform._rotation02*f+e._transform._rotation12*m+e._transform._rotation22*d,f=p,m=g,d=x,u.x=f,u.y=m,u.z=d,this}};I.dynamics.constraint.joint.GenericJoint=class extends I.dynamics.constraint.joint.Joint{constructor(t){super(t,I.dynamics.constraint.joint.JointType.GENERIC);let e,i=t.localBasis1;if(i.e00*(i.e11*i.e22-i.e12*i.e21)-i.e01*(i.e10*i.e22-i.e12*i.e20)+i.e02*(i.e10*i.e21-i.e11*i.e20)<0)e=!0;else{let X=t.localBasis2;e=X.e00*(X.e11*X.e22-X.e12*X.e21)-X.e01*(X.e10*X.e22-X.e12*X.e20)+X.e02*(X.e10*X.e21-X.e11*X.e20)<0}e&&console.log("src/oimo/dynamics/constraint/joint/GenericJoint.hx:50:","[warning] joint basis must be right handed");let n,s,o,r,_,a,l,h,u,f,m,d,p,g,x,b,y,z,M=t.localBasis1;n=M.e00,s=M.e01,o=M.e02,r=M.e10,_=M.e11,a=M.e12,l=M.e20,h=M.e21,u=M.e22;let Y=t.localBasis2;f=Y.e00,m=Y.e01,d=Y.e02,p=Y.e10,g=Y.e11,x=Y.e12,b=Y.e20,y=Y.e21,z=Y.e22,this._localBasisX1X=n,this._localBasisX1Y=r,this._localBasisX1Z=l,this._localBasisY1X=s,this._localBasisY1Y=_,this._localBasisY1Z=h,this._localBasisZ1X=o,this._localBasisZ1Y=a,this._localBasisZ1Z=u,this._localBasisX2X=f,this._localBasisX2Y=p,this._localBasisX2Z=b,this._localBasisY2X=m,this._localBasisY2Y=g,this._localBasisY2Z=y,this._localBasisZ2X=d,this._localBasisZ2Y=x,this._localBasisZ2Z=z,this._angleX=0,this._angleY=0,this._angleZ=0,this.translationX=0,this.translationY=0,this.translationZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1,this._translLms=new Array(3),this._translSds=new Array(3),this._rotLms=new Array(3),this._rotSds=new Array(3),this._translLms[0]=t.translationalLimitMotors[0].clone(),this._translLms[1]=t.translationalLimitMotors[1].clone(),this._translLms[2]=t.translationalLimitMotors[2].clone(),this._translSds[0]=t.translationalSpringDampers[0].clone(),this._translSds[1]=t.translationalSpringDampers[1].clone(),this._translSds[2]=t.translationalSpringDampers[2].clone(),this._rotLms[0]=t.rotationalLimitMotors[0].clone(),this._rotLms[1]=t.rotationalLimitMotors[1].clone(),this._rotLms[2]=t.rotationalLimitMotors[2].clone(),this._rotSds[0]=t.rotationalSpringDampers[0].clone(),this._rotSds[1]=t.rotationalSpringDampers[1].clone(),this._rotSds[2]=t.rotationalSpringDampers[2].clone()}getInfo(t,e,i){let n,s=1/(this._b1._invMass+this._b2._invMass),o=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),r=this.computeEffectiveInertiaMoment(this._axisYX,this._axisYY,this._axisYZ),_=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ);if(this._translSds[0].frequency<=0||!i){let a=this._impulses[0],l=t.rows[t.numRows++],h=l.jacobian;h.lin1X=0,h.lin1Y=0,h.lin1Z=0,h.lin2X=0,h.lin2Y=0,h.lin2Z=0,h.ang1X=0,h.ang1Y=0,h.ang1Z=0,h.ang2X=0,h.ang2Y=0,h.ang2Z=0,l.rhs=0,l.cfm=0,l.minImpulse=0,l.maxImpulse=0,l.motorSpeed=0,l.motorMaxImpulse=0,l.impulse=null,l.impulse=a,this.setSolverInfoRowLinear(l,this.translationX,this._translLms[0],s,this._translSds[0],e,i),n=l.jacobian,n.lin1X=this._basisX1X,n.lin1Y=this._basisX1Y,n.lin1Z=this._basisX1Z,n.lin2X=this._basisX1X,n.lin2Y=this._basisX1Y,n.lin2Z=this._basisX1Z,n.ang1X=this._relativeAnchor1Y*this._basisX1Z-this._relativeAnchor1Z*this._basisX1Y,n.ang1Y=this._relativeAnchor1Z*this._basisX1X-this._relativeAnchor1X*this._basisX1Z,n.ang1Z=this._relativeAnchor1X*this._basisX1Y-this._relativeAnchor1Y*this._basisX1X,n.ang2X=this._relativeAnchor2Y*this._basisX1Z-this._relativeAnchor2Z*this._basisX1Y,n.ang2Y=this._relativeAnchor2Z*this._basisX1X-this._relativeAnchor2X*this._basisX1Z,n.ang2Z=this._relativeAnchor2X*this._basisX1Y-this._relativeAnchor2Y*this._basisX1X}if(this._translSds[1].frequency<=0||!i){let a=this._impulses[1],l=t.rows[t.numRows++],h=l.jacobian;h.lin1X=0,h.lin1Y=0,h.lin1Z=0,h.lin2X=0,h.lin2Y=0,h.lin2Z=0,h.ang1X=0,h.ang1Y=0,h.ang1Z=0,h.ang2X=0,h.ang2Y=0,h.ang2Z=0,l.rhs=0,l.cfm=0,l.minImpulse=0,l.maxImpulse=0,l.motorSpeed=0,l.motorMaxImpulse=0,l.impulse=null,l.impulse=a,this.setSolverInfoRowLinear(l,this.translationY,this._translLms[1],s,this._translSds[1],e,i),n=l.jacobian,n.lin1X=this._basisY1X,n.lin1Y=this._basisY1Y,n.lin1Z=this._basisY1Z,n.lin2X=this._basisY1X,n.lin2Y=this._basisY1Y,n.lin2Z=this._basisY1Z,n.ang1X=this._relativeAnchor1Y*this._basisY1Z-this._relativeAnchor1Z*this._basisY1Y,n.ang1Y=this._relativeAnchor1Z*this._basisY1X-this._relativeAnchor1X*this._basisY1Z,n.ang1Z=this._relativeAnchor1X*this._basisY1Y-this._relativeAnchor1Y*this._basisY1X,n.ang2X=this._relativeAnchor2Y*this._basisY1Z-this._relativeAnchor2Z*this._basisY1Y,n.ang2Y=this._relativeAnchor2Z*this._basisY1X-this._relativeAnchor2X*this._basisY1Z,n.ang2Z=this._relativeAnchor2X*this._basisY1Y-this._relativeAnchor2Y*this._basisY1X}if(this._translSds[2].frequency<=0||!i){let a=this._impulses[2],l=t.rows[t.numRows++],h=l.jacobian;h.lin1X=0,h.lin1Y=0,h.lin1Z=0,h.lin2X=0,h.lin2Y=0,h.lin2Z=0,h.ang1X=0,h.ang1Y=0,h.ang1Z=0,h.ang2X=0,h.ang2Y=0,h.ang2Z=0,l.rhs=0,l.cfm=0,l.minImpulse=0,l.maxImpulse=0,l.motorSpeed=0,l.motorMaxImpulse=0,l.impulse=null,l.impulse=a,this.setSolverInfoRowLinear(l,this.translationZ,this._translLms[2],s,this._translSds[2],e,i),n=l.jacobian,n.lin1X=this._basisZ1X,n.lin1Y=this._basisZ1Y,n.lin1Z=this._basisZ1Z,n.lin2X=this._basisZ1X,n.lin2Y=this._basisZ1Y,n.lin2Z=this._basisZ1Z,n.ang1X=this._relativeAnchor1Y*this._basisZ1Z-this._relativeAnchor1Z*this._basisZ1Y,n.ang1Y=this._relativeAnchor1Z*this._basisZ1X-this._relativeAnchor1X*this._basisZ1Z,n.ang1Z=this._relativeAnchor1X*this._basisZ1Y-this._relativeAnchor1Y*this._basisZ1X,n.ang2X=this._relativeAnchor2Y*this._basisZ1Z-this._relativeAnchor2Z*this._basisZ1Y,n.ang2Y=this._relativeAnchor2Z*this._basisZ1X-this._relativeAnchor2X*this._basisZ1Z,n.ang2Z=this._relativeAnchor2X*this._basisZ1Y-this._relativeAnchor2Y*this._basisZ1X}if(!this.xSingular&&(this._rotSds[0].frequency<=0||!i)){let a=this._impulses[3],l=t.rows[t.numRows++],h=l.jacobian;h.lin1X=0,h.lin1Y=0,h.lin1Z=0,h.lin2X=0,h.lin2Y=0,h.lin2Z=0,h.ang1X=0,h.ang1Y=0,h.ang1Z=0,h.ang2X=0,h.ang2Y=0,h.ang2Z=0,l.rhs=0,l.cfm=0,l.minImpulse=0,l.maxImpulse=0,l.motorSpeed=0,l.motorMaxImpulse=0,l.impulse=null,l.impulse=a,this.setSolverInfoRowAngular(l,this._angleX,this._rotLms[0],o,this._rotSds[0],e,i),n=l.jacobian,n.ang1X=this._axisXX,n.ang1Y=this._axisXY,n.ang1Z=this._axisXZ,n.ang2X=this._axisXX,n.ang2Y=this._axisXY,n.ang2Z=this._axisXZ}if(!this.ySingular&&(this._rotSds[1].frequency<=0||!i)){let a=this._impulses[4],l=t.rows[t.numRows++],h=l.jacobian;h.lin1X=0,h.lin1Y=0,h.lin1Z=0,h.lin2X=0,h.lin2Y=0,h.lin2Z=0,h.ang1X=0,h.ang1Y=0,h.ang1Z=0,h.ang2X=0,h.ang2Y=0,h.ang2Z=0,l.rhs=0,l.cfm=0,l.minImpulse=0,l.maxImpulse=0,l.motorSpeed=0,l.motorMaxImpulse=0,l.impulse=null,l.impulse=a,this.setSolverInfoRowAngular(l,this._angleY,this._rotLms[1],r,this._rotSds[1],e,i),n=l.jacobian,n.ang1X=this._axisYX,n.ang1Y=this._axisYY,n.ang1Z=this._axisYZ,n.ang2X=this._axisYX,n.ang2Y=this._axisYY,n.ang2Z=this._axisYZ}if(!this.zSingular&&(this._rotSds[2].frequency<=0||!i)){let a=this._impulses[5],l=t.rows[t.numRows++],h=l.jacobian;h.lin1X=0,h.lin1Y=0,h.lin1Z=0,h.lin2X=0,h.lin2Y=0,h.lin2Z=0,h.ang1X=0,h.ang1Y=0,h.ang1Z=0,h.ang2X=0,h.ang2Y=0,h.ang2Z=0,l.rhs=0,l.cfm=0,l.minImpulse=0,l.maxImpulse=0,l.motorSpeed=0,l.motorMaxImpulse=0,l.impulse=null,l.impulse=a,this.setSolverInfoRowAngular(l,this._angleZ,this._rotLms[2],_,this._rotSds[2],e,i),n=l.jacobian,n.ang1X=this._axisZX,n.ang1Y=this._axisZY,n.ang1Z=this._axisZZ,n.ang2X=this._axisZX,n.ang2Y=this._axisZY,n.ang2Z=this._axisZZ}}_syncAnchors(){super._syncAnchors();let t,e,i,n,s,o,r,_,a;t=this._basisX1X,e=this._basisX1Y,i=this._basisX1Z,r=this._basisZ2X,_=this._basisZ2Y,a=this._basisZ2Z,n=_*i-a*e,s=a*t-r*i,o=r*e-_*t,this._axisXX=s*a-o*_,this._axisXY=o*r-n*a,this._axisXZ=n*_-s*r,this._axisYX=n,this._axisYY=s,this._axisYZ=o,this._axisZX=e*o-i*s,this._axisZY=i*n-t*o,this._axisZZ=t*s-e*n;let l=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;l>0&&(l=1/Math.sqrt(l)),this._axisXX*=l,this._axisXY*=l,this._axisXZ*=l;let h=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;h>0&&(h=1/Math.sqrt(h)),this._axisYX*=h,this._axisYY*=h,this._axisYZ*=h;let u=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;u>0&&(u=1/Math.sqrt(u)),this._axisZX*=u,this._axisZY*=u,this._axisZZ*=u,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0;let f,m,d,p,g,x,b,y,z,M,Y,X,w,S,V,F,C,A;f=this._basisX1X,m=this._basisY1X,d=this._basisZ1X,p=this._basisX1Y,g=this._basisY1Y,x=this._basisZ1Y,b=this._basisX1Z,y=this._basisY1Z,z=this._basisZ1Z,M=this._basisX2X,Y=this._basisY2X,X=this._basisZ2X,w=this._basisX2Y,S=this._basisY2Y,V=this._basisZ2Y,F=this._basisX2Z,C=this._basisY2Z,A=this._basisZ2Z;let Z,L,E,T,P,N,R,k,O,v,D,B,U,q;k=f*M+p*w+b*F,O=f*Y+p*S+b*C,v=f*X+p*V+b*A,D=m*Y+g*S+y*C,B=m*X+g*V+y*A,U=d*Y+x*S+z*C,q=d*X+x*V+z*A,Z=k,L=O,E=v,T=D,P=B,N=U,R=q;let tt,Q,nt,H=E;if(H<=-1){let G=Math.atan2(N,T);tt=G*.5,Q=-1.570796326794895,nt=-G*.5}else if(H>=1){let G=Math.atan2(N,T);tt=G*.5,Q=1.570796326794895,nt=G*.5}else tt=Math.atan2(-P,R),Q=Math.asin(H),nt=Math.atan2(-L,Z);this._angleX=tt,this._angleY=Q,this._angleZ=nt;let j,it,et;j=this._anchor2X-this._anchor1X,it=this._anchor2Y-this._anchor1Y,et=this._anchor2Z-this._anchor1Z,this.translationX=j*this._basisX1X+it*this._basisX1Y+et*this._basisX1Z,this.translationY=j*this._basisY1X+it*this._basisY1Y+et*this._basisY1Z,this.translationZ=j*this._basisZ1X+it*this._basisZ1Y+et*this._basisZ1Z}_getVelocitySolverInfo(t,e){super._getVelocitySolverInfo(t,e),this.getInfo(e,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxisX(){let t=new I.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxisY(){let t=new I.common.Vec3;return t.x=this._axisYX,t.y=this._axisYY,t.z=this._axisYZ,t}getAxisZ(){let t=new I.common.Vec3;return t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z,t}getTranslationalSpringDampers(){return this._translSds.slice(0)}getRotationalSpringDampers(){return this._rotSds.slice(0)}getTranslationalLimitMotors(){return this._translLms.slice(0)}getRotationalLimitMotors(){return this._rotLms.slice(0)}getAngles(){return new I.common.Vec3(this._angleX,this._angleY,this._angleZ)}getTranslations(){return new I.common.Vec3(this.translationX,this.translationY,this.translationZ)}};I.dynamics.constraint.joint.GenericJointConfig=class extends I.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localBasis1=new I.common.Mat3,this.localBasis2=new I.common.Mat3;let t=[];t.push(new I.dynamics.constraint.joint.TranslationalLimitMotor().setLimits(0,0)),t.push(new I.dynamics.constraint.joint.TranslationalLimitMotor().setLimits(0,0)),t.push(new I.dynamics.constraint.joint.TranslationalLimitMotor().setLimits(0,0)),this.translationalLimitMotors=t;let e=[];e.push(new I.dynamics.constraint.joint.RotationalLimitMotor().setLimits(0,0)),e.push(new I.dynamics.constraint.joint.RotationalLimitMotor().setLimits(0,0)),e.push(new I.dynamics.constraint.joint.RotationalLimitMotor().setLimits(0,0)),this.rotationalLimitMotors=e,this.translationalSpringDampers=[new I.dynamics.constraint.joint.SpringDamper,new I.dynamics.constraint.joint.SpringDamper,new I.dynamics.constraint.joint.SpringDamper],this.rotationalSpringDampers=[new I.dynamics.constraint.joint.SpringDamper,new I.dynamics.constraint.joint.SpringDamper,new I.dynamics.constraint.joint.SpringDamper]}init(t,e,i,n,s){this._init(t,e,i);let o=t._transform,r=e._transform,_,a,l,h,u,f,m,d,p,g,x,b,y,z,M,Y,X,w,S,V,F,C,A,Z,L,E,T,P,N,R,k,O,v,D,B,U;_=n.e00,a=n.e01,l=n.e02,h=n.e10,u=n.e11,f=n.e12,m=n.e20,d=n.e21,p=n.e22,g=s.e00,x=s.e01,b=s.e02,y=s.e10,z=s.e11,M=s.e12,Y=s.e20,X=s.e21,w=s.e22;let q,tt,Q,nt,H,j,it,et,G;q=o._rotation00*_+o._rotation10*h+o._rotation20*m,tt=o._rotation00*a+o._rotation10*u+o._rotation20*d,Q=o._rotation00*l+o._rotation10*f+o._rotation20*p,nt=o._rotation01*_+o._rotation11*h+o._rotation21*m,H=o._rotation01*a+o._rotation11*u+o._rotation21*d,j=o._rotation01*l+o._rotation11*f+o._rotation21*p,it=o._rotation02*_+o._rotation12*h+o._rotation22*m,et=o._rotation02*a+o._rotation12*u+o._rotation22*d,G=o._rotation02*l+o._rotation12*f+o._rotation22*p,S=q,V=tt,F=Q,C=nt,A=H,Z=j,L=it,E=et,T=G;let W,lt,ht,ft,pt,K,J,rt,mt;W=r._rotation00*g+r._rotation10*y+r._rotation20*Y,lt=r._rotation00*x+r._rotation10*z+r._rotation20*X,ht=r._rotation00*b+r._rotation10*M+r._rotation20*w,ft=r._rotation01*g+r._rotation11*y+r._rotation21*Y,pt=r._rotation01*x+r._rotation11*z+r._rotation21*X,K=r._rotation01*b+r._rotation11*M+r._rotation21*w,J=r._rotation02*g+r._rotation12*y+r._rotation22*Y,rt=r._rotation02*x+r._rotation12*z+r._rotation22*X,mt=r._rotation02*b+r._rotation12*M+r._rotation22*w,P=W,N=lt,R=ht,k=ft,O=pt,v=K,D=J,B=rt,U=mt;let xt=this.localBasis1;xt.e00=S,xt.e01=V,xt.e02=F,xt.e10=C,xt.e11=A,xt.e12=Z,xt.e20=L,xt.e21=E,xt.e22=T;let vt=this.localBasis2;return vt.e00=P,vt.e01=N,vt.e02=R,vt.e10=k,vt.e11=O,vt.e12=v,vt.e20=D,vt.e21=B,vt.e22=U,this}};I.dynamics.constraint.joint.JointImpulse=class{constructor(){this.impulse=0,this.impulseM=0,this.impulseP=0}};I.dynamics.constraint.joint.JointLink=class{constructor(t){this._joint=t}getContact(){return this._joint}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}};I.dynamics.constraint.joint.JointMacro=class{};I.dynamics.constraint.joint.JointType=class{};I.dynamics.constraint.joint.PrismaticJoint=class extends I.dynamics.constraint.joint.Joint{constructor(t){super(t,I.dynamics.constraint.joint.JointType.PRISMATIC);let e=t.localAxis1;this._localBasisX1X=e.x,this._localBasisX1Y=e.y,this._localBasisX1Z=e.z;let i=t.localAxis2;this._localBasisX2X=i.x,this._localBasisX2Y=i.y,this._localBasisX2Z=i.z,this.buildLocalBasesFromX(),this._basis=new I.dynamics.constraint.joint.BasisTracker(this),this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this.angularErrorX=0,this.angularErrorY=0,this.angularErrorZ=0,this._sd=t.springDamper.clone(),this._lm=t.limitMotor.clone()}getInfo(t,e,i){let n=this.getErp(e,i),s=this.linearErrorY*n,o=this.linearErrorZ*n,r=this.angularErrorX*n,_=this.angularErrorY*n,a=this.angularErrorZ*n,l;if(this._sd.frequency<=0||!i){let S=this._impulses[0],V=t.rows[t.numRows++],F=V.jacobian;F.lin1X=0,F.lin1Y=0,F.lin1Z=0,F.lin2X=0,F.lin2Y=0,F.lin2Z=0,F.ang1X=0,F.ang1Y=0,F.ang1Z=0,F.ang2X=0,F.ang2Y=0,F.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=S,this.setSolverInfoRowLinear(V,this.translation,this._lm,1/(this._b1._invMass+this._b2._invMass),this._sd,e,i),l=V.jacobian,l.lin1X=this._basis.xX,l.lin1Y=this._basis.xY,l.lin1Z=this._basis.xZ,l.lin2X=this._basis.xX,l.lin2Y=this._basis.xY,l.lin2Z=this._basis.xZ,l.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,l.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,l.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,l.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,l.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,l.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}let h=this._impulses[1],u=t.rows[t.numRows++],f=u.jacobian;f.lin1X=0,f.lin1Y=0,f.lin1Z=0,f.lin2X=0,f.lin2Y=0,f.lin2Z=0,f.ang1X=0,f.ang1Y=0,f.ang1Z=0,f.ang2X=0,f.ang2Y=0,f.ang2Z=0,u.rhs=0,u.cfm=0,u.minImpulse=0,u.maxImpulse=0,u.motorSpeed=0,u.motorMaxImpulse=0,u.impulse=null,u.impulse=h,u.rhs=s,u.cfm=0,u.minImpulse=-1/0,u.maxImpulse=1/0,l=u.jacobian,l.lin1X=this._basis.yX,l.lin1Y=this._basis.yY,l.lin1Z=this._basis.yZ,l.lin2X=this._basis.yX,l.lin2Y=this._basis.yY,l.lin2Z=this._basis.yZ,l.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,l.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,l.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,l.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,l.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,l.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;let m=this._impulses[2],d=t.rows[t.numRows++],p=d.jacobian;p.lin1X=0,p.lin1Y=0,p.lin1Z=0,p.lin2X=0,p.lin2Y=0,p.lin2Z=0,p.ang1X=0,p.ang1Y=0,p.ang1Z=0,p.ang2X=0,p.ang2Y=0,p.ang2Z=0,d.rhs=0,d.cfm=0,d.minImpulse=0,d.maxImpulse=0,d.motorSpeed=0,d.motorMaxImpulse=0,d.impulse=null,d.impulse=m,d.rhs=o,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0,l=d.jacobian,l.lin1X=this._basis.zX,l.lin1Y=this._basis.zY,l.lin1Z=this._basis.zZ,l.lin2X=this._basis.zX,l.lin2Y=this._basis.zY,l.lin2Z=this._basis.zZ,l.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,l.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,l.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,l.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,l.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,l.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX;let g=this._impulses[3],x=t.rows[t.numRows++],b=x.jacobian;b.lin1X=0,b.lin1Y=0,b.lin1Z=0,b.lin2X=0,b.lin2Y=0,b.lin2Z=0,b.ang1X=0,b.ang1Y=0,b.ang1Z=0,b.ang2X=0,b.ang2Y=0,b.ang2Z=0,x.rhs=0,x.cfm=0,x.minImpulse=0,x.maxImpulse=0,x.motorSpeed=0,x.motorMaxImpulse=0,x.impulse=null,x.impulse=g,x.rhs=r,x.cfm=0,x.minImpulse=-1/0,x.maxImpulse=1/0,l=x.jacobian,l.ang1X=1,l.ang1Y=0,l.ang1Z=0,l.ang2X=1,l.ang2Y=0,l.ang2Z=0;let y=this._impulses[4],z=t.rows[t.numRows++],M=z.jacobian;M.lin1X=0,M.lin1Y=0,M.lin1Z=0,M.lin2X=0,M.lin2Y=0,M.lin2Z=0,M.ang1X=0,M.ang1Y=0,M.ang1Z=0,M.ang2X=0,M.ang2Y=0,M.ang2Z=0,z.rhs=0,z.cfm=0,z.minImpulse=0,z.maxImpulse=0,z.motorSpeed=0,z.motorMaxImpulse=0,z.impulse=null,z.impulse=y,z.rhs=_,z.cfm=0,z.minImpulse=-1/0,z.maxImpulse=1/0,l=z.jacobian,l.ang1X=0,l.ang1Y=1,l.ang1Z=0,l.ang2X=0,l.ang2Y=1,l.ang2Z=0;let Y=this._impulses[5],X=t.rows[t.numRows++],w=X.jacobian;w.lin1X=0,w.lin1Y=0,w.lin1Z=0,w.lin2X=0,w.lin2Y=0,w.lin2Z=0,w.ang1X=0,w.ang1Y=0,w.ang1Z=0,w.ang2X=0,w.ang2Y=0,w.ang2Z=0,X.rhs=0,X.cfm=0,X.minImpulse=0,X.maxImpulse=0,X.motorSpeed=0,X.motorMaxImpulse=0,X.impulse=null,X.impulse=Y,X.rhs=a,X.cfm=0,X.minImpulse=-1/0,X.maxImpulse=1/0,l=X.jacobian,l.ang1X=0,l.ang1Y=0,l.ang1Z=1,l.ang2X=0,l.ang2Y=0,l.ang2Z=1}_syncAnchors(){super._syncAnchors();let t=this._basis,e=t.joint._b1._invMass,i=t.joint._b2._invMass,n,s,o,r,_,a,l,h,u,f,m,d,p,g,x,b,y,z,M,Y,X,w,S,V,F,C,A,Z,L,E,T,P,N,R,k,O,v=t.joint._basisX1X*t.joint._basisX2X+t.joint._basisX1Y*t.joint._basisX2Y+t.joint._basisX1Z*t.joint._basisX2Z;if(v<-.999999999){let Ct,Gt,Pe,Ve=t.joint._basisX1X,Ue=t.joint._basisX1Y,ii=t.joint._basisX1Z,ri=Ve*Ve,mi=Ue*Ue,xi=ii*ii,ce;ri<mi?ri<xi?(ce=1/Math.sqrt(mi+xi),Ct=0,Gt=ii*ce,Pe=-Ue*ce):(ce=1/Math.sqrt(ri+mi),Ct=Ue*ce,Gt=-Ve*ce,Pe=0):mi<xi?(ce=1/Math.sqrt(xi+ri),Ct=-ii*ce,Gt=0,Pe=Ve*ce):(ce=1/Math.sqrt(ri+mi),Ct=Ue*ce,Gt=-Ve*ce,Pe=0),n=Ct,s=Gt,o=Pe,r=0}else{let Ct,Gt,Pe;Ct=t.joint._basisX1Y*t.joint._basisX2Z-t.joint._basisX1Z*t.joint._basisX2Y,Gt=t.joint._basisX1Z*t.joint._basisX2X-t.joint._basisX1X*t.joint._basisX2Z,Pe=t.joint._basisX1X*t.joint._basisX2Y-t.joint._basisX1Y*t.joint._basisX2X;let Ve=Math.sqrt((1+v)*.5);v=.5/Ve,Ct*=v,Gt*=v,Pe*=v,n=Ct,s=Gt,o=Pe,r=Ve}_=0,a=0,l=0,h=1;let D,B,U,q,tt,Q,nt,H;D=_,B=a,U=l,q=h,tt=n,Q=s,nt=o,H=r;let j=D*tt+B*Q+U*nt+q*H;if(j<0&&(j=-j,tt=-tt,Q=-Q,nt=-nt,H=-H),j>.999999){let Ct,Gt,Pe,Ve;Ct=tt-D,Gt=Q-B,Pe=nt-U,Ve=H-q,tt=D+Ct*(e/(e+i)),Q=B+Gt*(e/(e+i)),nt=U+Pe*(e/(e+i)),H=q+Ve*(e/(e+i));let Ue=tt*tt+Q*Q+nt*nt+H*H;Ue>1e-32&&(Ue=1/Math.sqrt(Ue)),u=tt*Ue,f=Q*Ue,m=nt*Ue,d=H*Ue}else{let Ct=e/(e+i)*Math.acos(j);tt+=D*-j,Q+=B*-j,nt+=U*-j,H+=q*-j;let Gt=tt*tt+Q*Q+nt*nt+H*H;Gt>1e-32&&(Gt=1/Math.sqrt(Gt)),tt*=Gt,Q*=Gt,nt*=Gt,H*=Gt;let Pe=Math.sin(Ct),Ve=Math.cos(Ct);D*=Ve,B*=Ve,U*=Ve,q*=Ve,u=D+tt*Pe,f=B+Q*Pe,m=U+nt*Pe,d=q+H*Pe}let it=u,et=f,G=m,W=d,lt=2*it,ht=2*et,ft=2*G,pt=it*lt,K=et*ht,J=G*ft,rt=it*ht,mt=et*ft,xt=it*ft,vt=W*lt,Mt=W*ht,ut=W*ft;p=1-K-J,g=rt-ut,x=xt+Mt,b=rt+ut,y=1-pt-J,z=mt-vt,M=xt-Mt,Y=mt+vt,X=1-pt-K;let Zt,zt,dt;Zt=p*t.joint._basisX1X+g*t.joint._basisX1Y+x*t.joint._basisX1Z,zt=b*t.joint._basisX1X+y*t.joint._basisX1Y+z*t.joint._basisX1Z,dt=M*t.joint._basisX1X+Y*t.joint._basisX1Y+X*t.joint._basisX1Z,w=Zt,S=zt,V=dt,T=t.xX,P=t.xY,N=t.xZ,R=t.yX,k=t.yY,O=t.yZ;let st=T*w+P*S+N*V;if(st<-.999999999){let Ct,Gt,Pe,Ve=T,Ue=P,ii=N,ri=Ve*Ve,mi=Ue*Ue,xi=ii*ii,ce;ri<mi?ri<xi?(ce=1/Math.sqrt(mi+xi),Ct=0,Gt=ii*ce,Pe=-Ue*ce):(ce=1/Math.sqrt(ri+mi),Ct=Ue*ce,Gt=-Ve*ce,Pe=0):mi<xi?(ce=1/Math.sqrt(xi+ri),Ct=-ii*ce,Gt=0,Pe=Ve*ce):(ce=1/Math.sqrt(ri+mi),Ct=Ue*ce,Gt=-Ve*ce,Pe=0),u=Ct,f=Gt,m=Pe,d=0}else{let Ct,Gt,Pe;Ct=P*V-N*S,Gt=N*w-T*V,Pe=T*S-P*w;let Ve=Math.sqrt((1+st)*.5);st=.5/Ve,Ct*=st,Gt*=st,Pe*=st,u=Ct,f=Gt,m=Pe,d=Ve}let ct=u,_t=f,Vt=m,At=d,St=2*ct,Xt=2*_t,Ft=2*Vt,ie=ct*St,ee=_t*Xt,Ye=Vt*Ft,Ie=ct*Xt,ue=_t*Ft,$t=ct*Ft,Ht=At*St,me=At*Xt,ze=At*Ft;p=1-ee-Ye,g=Ie-ze,x=$t+me,b=Ie+ze,y=1-ie-Ye,z=ue-Ht,M=$t-me,Y=ue+Ht,X=1-ie-ee;let qe,Ee,Ut;if(qe=p*R+g*k+x*O,Ee=b*R+y*k+z*O,Ut=M*R+Y*k+X*O,F=qe,C=Ee,A=Ut,Z=S*A-V*C,L=V*F-w*A,E=w*C-S*F,Z*Z+L*L+E*E>1e-6){let Ct=Z*Z+L*L+E*E;Ct>0&&(Ct=1/Math.sqrt(Ct)),Z*=Ct,L*=Ct,E*=Ct}else{let Ct=w,Gt=S,Pe=V,Ve=Ct*Ct,Ue=Gt*Gt,ii=Pe*Pe,ri;Ve<Ue?Ve<ii?(ri=1/Math.sqrt(Ue+ii),Z=0,L=Pe*ri,E=-Gt*ri):(ri=1/Math.sqrt(Ve+Ue),Z=Gt*ri,L=-Ct*ri,E=0):Ue<ii?(ri=1/Math.sqrt(ii+Ve),Z=-Pe*ri,L=0,E=Ct*ri):(ri=1/Math.sqrt(Ve+Ue),Z=Gt*ri,L=-Ct*ri,E=0)}F=L*V-E*S,C=E*w-Z*V,A=Z*S-L*w,t.xX=w,t.xY=S,t.xZ=V,t.yX=F,t.yY=C,t.yZ=A,t.zX=Z,t.zY=L,t.zZ=E;let at,gt,yt,bt,ot,Pt,Dt,$,kt,Rt,Ot,Wt,Bt,re,Ce,be,Tt,Lt;at=this._basisX1X,gt=this._basisY1X,yt=this._basisZ1X,bt=this._basisX1Y,ot=this._basisY1Y,Pt=this._basisZ1Y,Dt=this._basisX1Z,$=this._basisY1Z,kt=this._basisZ1Z,Rt=this._basisX2X,Ot=this._basisY2X,Wt=this._basisZ2X,Bt=this._basisX2Y,re=this._basisY2Y,Ce=this._basisZ2Y,be=this._basisX2Z,Tt=this._basisY2Z,Lt=this._basisZ2Z;let Yt,pe,Me,fe,ti,di,Le,_i,yi,he,gi,bi,Mi,Si,He,Je,Qe,ci;he=Rt*at+Ot*gt+Wt*yt,gi=Rt*bt+Ot*ot+Wt*Pt,bi=Rt*Dt+Ot*$+Wt*kt,Mi=Bt*at+re*gt+Ce*yt,Si=Bt*bt+re*ot+Ce*Pt,He=Bt*Dt+re*$+Ce*kt,Je=be*at+Tt*gt+Lt*yt,Qe=be*bt+Tt*ot+Lt*Pt,ci=be*Dt+Tt*$+Lt*kt,Yt=he,pe=gi,Me=bi,fe=Mi,ti=Si,di=He,Le=Je,_i=Qe,yi=ci;let hi,ei,ai,Ke,We=Yt,ke=ti,le=yi,ge=We+ke+le,jt;ge>0?(jt=Math.sqrt(ge+1),Ke=.5*jt,jt=.5/jt,hi=(_i-di)*jt,ei=(Me-Le)*jt,ai=(fe-pe)*jt):We>ke?We>le?(jt=Math.sqrt(We-ke-le+1),hi=.5*jt,jt=.5/jt,ei=(pe+fe)*jt,ai=(Me+Le)*jt,Ke=(_i-di)*jt):(jt=Math.sqrt(le-We-ke+1),ai=.5*jt,jt=.5/jt,hi=(Me+Le)*jt,ei=(di+_i)*jt,Ke=(fe-pe)*jt):ke>le?(jt=Math.sqrt(ke-le-We+1),ei=.5*jt,jt=.5/jt,hi=(pe+fe)*jt,ai=(di+_i)*jt,Ke=(Me-Le)*jt):(jt=Math.sqrt(le-We-ke+1),ai=.5*jt,jt=.5/jt,hi=(Me+Le)*jt,ei=(di+_i)*jt,Ke=(fe-pe)*jt);let Ae=Ke,Ze=(Ae<=-1?3.14159265358979:Ae>=1?0:Math.acos(Ae))*2;this.angularErrorX=hi,this.angularErrorY=ei,this.angularErrorZ=ai;let Re=this.angularErrorX*this.angularErrorX+this.angularErrorY*this.angularErrorY+this.angularErrorZ*this.angularErrorZ;Re>0&&(Re=1/Math.sqrt(Re)),this.angularErrorX*=Re,this.angularErrorY*=Re,this.angularErrorZ*=Re,this.angularErrorX*=Ze,this.angularErrorY*=Ze,this.angularErrorZ*=Ze;let Te,Fe,se;Te=this._anchor2X-this._anchor1X,Fe=this._anchor2Y-this._anchor1Y,se=this._anchor2Z-this._anchor1Z,this.translation=Te*this._basis.xX+Fe*this._basis.xY+se*this._basis.xZ,this.linearErrorY=Te*this._basis.yX+Fe*this._basis.yY+se*this._basis.yZ,this.linearErrorZ=Te*this._basis.zX+Fe*this._basis.zY+se*this._basis.zZ}_getVelocitySolverInfo(t,e){super._getVelocitySolverInfo(t,e),this.getInfo(e,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new I.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new I.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new I.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new I.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getTranslation(){return this.translation}};I.dynamics.constraint.joint.PrismaticJointConfig=class extends I.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new I.common.Vec3(1,0,0),this.localAxis2=new I.common.Vec3(1,0,0),this.limitMotor=new I.dynamics.constraint.joint.TranslationalLimitMotor,this.springDamper=new I.dynamics.constraint.joint.SpringDamper}init(t,e,i,n){this._init(t,e,i);let s=this.localAxis1,o,r,_;o=n.x,r=n.y,_=n.z;let a,l,h;a=t._transform._rotation00*o+t._transform._rotation10*r+t._transform._rotation20*_,l=t._transform._rotation01*o+t._transform._rotation11*r+t._transform._rotation21*_,h=t._transform._rotation02*o+t._transform._rotation12*r+t._transform._rotation22*_,o=a,r=l,_=h,s.x=o,s.y=r,s.z=_;let u=this.localAxis2,f,m,d;f=n.x,m=n.y,d=n.z;let p,g,x;return p=e._transform._rotation00*f+e._transform._rotation10*m+e._transform._rotation20*d,g=e._transform._rotation01*f+e._transform._rotation11*m+e._transform._rotation21*d,x=e._transform._rotation02*f+e._transform._rotation12*m+e._transform._rotation22*d,f=p,m=g,d=x,u.x=f,u.y=m,u.z=d,this}};I.dynamics.constraint.joint.RagdollJoint=class extends I.dynamics.constraint.joint.Joint{constructor(t){super(t,I.dynamics.constraint.joint.JointType.RAGDOLL);let e=t.localTwistAxis1;this._localBasisX1X=e.x,this._localBasisX1Y=e.y,this._localBasisX1Z=e.z;let i=t.localSwingAxis1;this._localBasisY1X=i.x,this._localBasisY1Y=i.y,this._localBasisY1Z=i.z;let n=t.localTwistAxis2;this._localBasisX2X=n.x,this._localBasisX2Y=n.y,this._localBasisX2Z=n.z,this.buildLocalBasesFromXY1X2(),this._twistSd=t.twistSpringDamper.clone(),this._twistLm=t.twistLimitMotor.clone(),this._swingSd=t.swingSpringDamper.clone(),this._maxSwingAngle1=t.maxSwingAngle1,this._maxSwingAngle2=t.maxSwingAngle2,this._maxSwingAngle1<I.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle1=I.common.Setting.minRagdollMaxSwingAngle),this._maxSwingAngle2<I.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle2=I.common.Setting.minRagdollMaxSwingAngle),this.dummySwingLm=new I.dynamics.constraint.joint.RotationalLimitMotor,this.dummySwingLm.lowerLimit=-1,this.dummySwingLm.upperLimit=0,this._swingAngle=0,this._twistAngle=0,this.swingError=0,this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.twistAxisX=0,this.twistAxisY=0,this.twistAxisZ=0}getInfo(t,e,i){let n=this.getErp(e,i),s,o,r;s=this.linearErrorX*n,o=this.linearErrorY*n,r=this.linearErrorZ*n;let _,a,l,h,u,f,m,d,p,g,x,b,y,z,M,Y,X,w;_=0,a=-this._relativeAnchor1Z,l=this._relativeAnchor1Y,h=this._relativeAnchor1Z,u=0,f=-this._relativeAnchor1X,m=-this._relativeAnchor1Y,d=this._relativeAnchor1X,p=0,g=0,x=-this._relativeAnchor2Z,b=this._relativeAnchor2Y,y=this._relativeAnchor2Z,z=0,M=-this._relativeAnchor2X,Y=-this._relativeAnchor2Y,X=this._relativeAnchor2X,w=0,_=-_,a=-a,l=-l,h=-h,u=-u,f=-f,m=-m,d=-d,p=-p,g=-g,x=-x,b=-b,y=-y,z=-z,M=-M,Y=-Y,X=-X,w=-w;let S=this.computeEffectiveInertiaMoment(this.swingAxisX,this.swingAxisY,this.swingAxisZ),V=this.computeEffectiveInertiaMoment(this._basisX2X,this._basisX2Y,this._basisX2Z),F=this._impulses[0],C=t.rows[t.numRows++],A=C.jacobian;A.lin1X=0,A.lin1Y=0,A.lin1Z=0,A.lin2X=0,A.lin2Y=0,A.lin2Z=0,A.ang1X=0,A.ang1Y=0,A.ang1Z=0,A.ang2X=0,A.ang2Y=0,A.ang2Z=0,C.rhs=0,C.cfm=0,C.minImpulse=0,C.maxImpulse=0,C.motorSpeed=0,C.motorMaxImpulse=0,C.impulse=null,C.impulse=F,C.rhs=s,C.cfm=0,C.minImpulse=-1/0,C.maxImpulse=1/0;let Z=C.jacobian;Z.lin1X=1,Z.lin1Y=0,Z.lin1Z=0,Z.lin2X=1,Z.lin2Y=0,Z.lin2Z=0,Z.ang1X=_,Z.ang1Y=a,Z.ang1Z=l,Z.ang2X=g,Z.ang2Y=x,Z.ang2Z=b;let L=this._impulses[1],E=t.rows[t.numRows++],T=E.jacobian;T.lin1X=0,T.lin1Y=0,T.lin1Z=0,T.lin2X=0,T.lin2Y=0,T.lin2Z=0,T.ang1X=0,T.ang1Y=0,T.ang1Z=0,T.ang2X=0,T.ang2Y=0,T.ang2Z=0,E.rhs=0,E.cfm=0,E.minImpulse=0,E.maxImpulse=0,E.motorSpeed=0,E.motorMaxImpulse=0,E.impulse=null,E.impulse=L,E.rhs=o,E.cfm=0,E.minImpulse=-1/0,E.maxImpulse=1/0,Z=E.jacobian,Z.lin1X=0,Z.lin1Y=1,Z.lin1Z=0,Z.lin2X=0,Z.lin2Y=1,Z.lin2Z=0,Z.ang1X=h,Z.ang1Y=u,Z.ang1Z=f,Z.ang2X=y,Z.ang2Y=z,Z.ang2Z=M;let P=this._impulses[2],N=t.rows[t.numRows++],R=N.jacobian;if(R.lin1X=0,R.lin1Y=0,R.lin1Z=0,R.lin2X=0,R.lin2Y=0,R.lin2Z=0,R.ang1X=0,R.ang1Y=0,R.ang1Z=0,R.ang2X=0,R.ang2Y=0,R.ang2Z=0,N.rhs=0,N.cfm=0,N.minImpulse=0,N.maxImpulse=0,N.motorSpeed=0,N.motorMaxImpulse=0,N.impulse=null,N.impulse=P,N.rhs=r,N.cfm=0,N.minImpulse=-1/0,N.maxImpulse=1/0,Z=N.jacobian,Z.lin1X=0,Z.lin1Y=0,Z.lin1Z=1,Z.lin2X=0,Z.lin2Y=0,Z.lin2Z=1,Z.ang1X=m,Z.ang1Y=d,Z.ang1Z=p,Z.ang2X=Y,Z.ang2Y=X,Z.ang2Z=w,this.swingError>0&&(this._swingSd.frequency<=0||!i)){let k=this._impulses[3],O=t.rows[t.numRows++],v=O.jacobian;v.lin1X=0,v.lin1Y=0,v.lin1Z=0,v.lin2X=0,v.lin2Y=0,v.lin2Z=0,v.ang1X=0,v.ang1Y=0,v.ang1Z=0,v.ang2X=0,v.ang2Y=0,v.ang2Z=0,O.rhs=0,O.cfm=0,O.minImpulse=0,O.maxImpulse=0,O.motorSpeed=0,O.motorMaxImpulse=0,O.impulse=null,O.impulse=k,this.setSolverInfoRowAngular(O,this.swingError,this.dummySwingLm,S,this._swingSd,e,i),Z=O.jacobian,Z.ang1X=this.swingAxisX,Z.ang1Y=this.swingAxisY,Z.ang1Z=this.swingAxisZ,Z.ang2X=this.swingAxisX,Z.ang2Y=this.swingAxisY,Z.ang2Z=this.swingAxisZ}if(this._twistSd.frequency<=0||!i){let k=this._impulses[4],O=t.rows[t.numRows++],v=O.jacobian;v.lin1X=0,v.lin1Y=0,v.lin1Z=0,v.lin2X=0,v.lin2Y=0,v.lin2Z=0,v.ang1X=0,v.ang1Y=0,v.ang1Z=0,v.ang2X=0,v.ang2Y=0,v.ang2Z=0,O.rhs=0,O.cfm=0,O.minImpulse=0,O.maxImpulse=0,O.motorSpeed=0,O.motorMaxImpulse=0,O.impulse=null,O.impulse=k,this.setSolverInfoRowAngular(O,this._twistAngle,this._twistLm,V,this._twistSd,e,i),Z=O.jacobian,Z.ang1X=this.twistAxisX,Z.ang1Y=this.twistAxisY,Z.ang1Z=this.twistAxisZ,Z.ang2X=this.twistAxisX,Z.ang2Y=this.twistAxisY,Z.ang2Z=this.twistAxisZ}}_syncAnchors(){super._syncAnchors();let t,e,i,n,s,o;t=this._basisX1X,e=this._basisX1Y,i=this._basisX1Z,n=this._basisX2X,s=this._basisX2Y,o=this._basisX2Z;let r,_,a,l,h,u,f,m,d;r=this._basisX1X,_=this._basisY1X,a=this._basisZ1X,l=this._basisX1Y,h=this._basisY1Y,u=this._basisZ1Y,f=this._basisX1Z,m=this._basisY1Z,d=this._basisZ1Z;let p,g,x,b,y,z,M,Y,X,w,S,V,F,C,A,Z,L=t*n+e*s+i*o;if(L<-.999999999){let Zt,zt,dt,st=t,ct=e,_t=i,Vt=st*st,At=ct*ct,St=_t*_t,Xt;Vt<At?Vt<St?(Xt=1/Math.sqrt(At+St),Zt=0,zt=_t*Xt,dt=-ct*Xt):(Xt=1/Math.sqrt(Vt+At),Zt=ct*Xt,zt=-st*Xt,dt=0):At<St?(Xt=1/Math.sqrt(St+Vt),Zt=-_t*Xt,zt=0,dt=st*Xt):(Xt=1/Math.sqrt(Vt+At),Zt=ct*Xt,zt=-st*Xt,dt=0),p=Zt,g=zt,x=dt,b=0}else{let Zt,zt,dt;Zt=e*o-i*s,zt=i*n-t*o,dt=t*s-e*n;let st=Math.sqrt((1+L)*.5);L=.5/st,Zt*=L,zt*=L,dt*=L,p=Zt,g=zt,x=dt,b=st}let E=p,T=g,P=x,N=b,R=2*E,k=2*T,O=2*P,v=E*R,D=T*k,B=P*O,U=E*k,q=T*O,tt=E*O,Q=N*R,nt=N*k,H=N*O;y=1-D-B,z=U-H,M=tt+nt,Y=U+H,X=1-v-B,w=q-Q,S=tt-nt,V=q+Q,F=1-v-D,this._swingAngle=(b<=-1?3.14159265358979:b>=1?0:Math.acos(b))*2,C=p,A=g,Z=x;let j,it,et,G,W,lt;G=y*this._basisY2X+Y*this._basisY2Y+S*this._basisY2Z,W=z*this._basisY2X+X*this._basisY2Y+V*this._basisY2Z,lt=M*this._basisY2X+w*this._basisY2Y+F*this._basisY2Z,j=G,it=W,et=lt,this._twistAngle=Math.atan2(this._basisZ1X*j+this._basisZ1Y*it+this._basisZ1Z*et,this._basisY1X*j+this._basisY1Y*it+this._basisY1Z*et),this.twistAxisX=this._basisX1X+this._basisX2X,this.twistAxisY=this._basisX1Y+this._basisX2Y,this.twistAxisZ=this._basisX1Z+this._basisX2Z;let ht=this.twistAxisX*this.twistAxisX+this.twistAxisY*this.twistAxisY+this.twistAxisZ*this.twistAxisZ;ht>0&&(ht=1/Math.sqrt(ht)),this.twistAxisX*=ht,this.twistAxisY*=ht,this.twistAxisZ*=ht;let ft=Math.sqrt(C*C+A*A+Z*Z);ft>0&&(ft=1/ft),C*=ft*this._swingAngle,A*=ft*this._swingAngle,Z*=ft*this._swingAngle;let pt,K;pt=_*C+h*A+m*Z,K=a*C+u*A+d*Z,A=pt,Z=K;let J=A,rt=Z,mt=this._maxSwingAngle1,xt=this._maxSwingAngle2,vt=1/(mt*mt),Mt=1/(xt*xt),ut=J*J*vt+rt*rt*Mt;if(ut==0)this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.swingError=0;else{let Zt=Math.sqrt(1/ut),zt=J*Zt,dt=rt*Zt,st=zt*vt,ct=dt*Mt;ft=1/Math.sqrt(st*st+ct*ct),st*=ft,ct*=ft;let _t=(J-zt)*st+(rt-dt)*ct;if(_t>0){this.swingError=_t,this.swingAxisX=0,this.swingAxisY=st,this.swingAxisZ=ct;let Vt,At,St;Vt=r*this.swingAxisX+_*this.swingAxisY+a*this.swingAxisZ,At=l*this.swingAxisX+h*this.swingAxisY+u*this.swingAxisZ,St=f*this.swingAxisX+m*this.swingAxisY+d*this.swingAxisZ,this.swingAxisX=Vt,this.swingAxisY=At,this.swingAxisZ=St;let Xt,Ft,ie;Xt=y*this.swingAxisX+z*this.swingAxisY+M*this.swingAxisZ,Ft=Y*this.swingAxisX+X*this.swingAxisY+w*this.swingAxisZ,ie=S*this.swingAxisX+V*this.swingAxisY+F*this.swingAxisZ,this.swingAxisX=Xt,this.swingAxisY=Ft,this.swingAxisZ=ie}else this.swingError=0}this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,e){super._getVelocitySolverInfo(t,e),this.getInfo(e,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new I.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new I.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new I.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new I.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getTwistSpringDamper(){return this._twistSd}getTwistLimitMotor(){return this._twistLm}getSwingSpringDamper(){return this._swingSd}getSwingAxis(){let t=new I.common.Vec3;return t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ,t}getSwingAxisTo(t){t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ}getSwingAngle(){return this._swingAngle}getTwistAngle(){return this._twistAngle}};I.dynamics.constraint.joint.RagdollJointConfig=class extends I.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localTwistAxis1=new I.common.Vec3(1,0,0),this.localTwistAxis2=new I.common.Vec3(1,0,0),this.localSwingAxis1=new I.common.Vec3(0,1,0),this.twistSpringDamper=new I.dynamics.constraint.joint.SpringDamper,this.swingSpringDamper=new I.dynamics.constraint.joint.SpringDamper,this.twistLimitMotor=new I.dynamics.constraint.joint.RotationalLimitMotor,this.maxSwingAngle1=3.14159265358979,this.maxSwingAngle2=3.14159265358979}init(t,e,i,n,s){this._init(t,e,i);let o=this.localTwistAxis1,r,_,a;r=n.x,_=n.y,a=n.z;let l,h,u;l=t._transform._rotation00*r+t._transform._rotation10*_+t._transform._rotation20*a,h=t._transform._rotation01*r+t._transform._rotation11*_+t._transform._rotation21*a,u=t._transform._rotation02*r+t._transform._rotation12*_+t._transform._rotation22*a,r=l,_=h,a=u,o.x=r,o.y=_,o.z=a;let f=this.localTwistAxis2,m,d,p;m=n.x,d=n.y,p=n.z;let g,x,b;g=e._transform._rotation00*m+e._transform._rotation10*d+e._transform._rotation20*p,x=e._transform._rotation01*m+e._transform._rotation11*d+e._transform._rotation21*p,b=e._transform._rotation02*m+e._transform._rotation12*d+e._transform._rotation22*p,m=g,d=x,p=b,f.x=m,f.y=d,f.z=p;let y=this.localSwingAxis1,z,M,Y;z=s.x,M=s.y,Y=s.z;let X,w,S;return X=t._transform._rotation00*z+t._transform._rotation10*M+t._transform._rotation20*Y,w=t._transform._rotation01*z+t._transform._rotation11*M+t._transform._rotation21*Y,S=t._transform._rotation02*z+t._transform._rotation12*M+t._transform._rotation22*Y,z=X,M=w,Y=S,y.x=z,y.y=M,y.z=Y,this}};I.dynamics.constraint.joint.RevoluteJoint=class extends I.dynamics.constraint.joint.Joint{constructor(t){super(t,1);let e=t.localAxis1;this._localBasisX1X=e.x,this._localBasisX1Y=e.y,this._localBasisX1Z=e.z;let i=t.localAxis2;this._localBasisX2X=i.x,this._localBasisX2Y=i.y,this._localBasisX2Z=i.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this._basis=new I.dynamics.constraint.joint.BasisTracker(this),this._sd=t.springDamper.clone(),this._lm=t.limitMotor.clone()}getInfo(t,e,i){let n=this.getErp(e,i),s,o,r;s=this.linearErrorX*n,o=this.linearErrorY*n,r=this.linearErrorZ*n;let _=this.angularErrorY*n,a=this.angularErrorZ*n,l,h,u,f,m,d,p,g,x,b,y,z,M,Y,X,w,S,V;l=0,h=-this._relativeAnchor1Z,u=this._relativeAnchor1Y,f=this._relativeAnchor1Z,m=0,d=-this._relativeAnchor1X,p=-this._relativeAnchor1Y,g=this._relativeAnchor1X,x=0,b=0,y=-this._relativeAnchor2Z,z=this._relativeAnchor2Y,M=this._relativeAnchor2Z,Y=0,X=-this._relativeAnchor2X,w=-this._relativeAnchor2Y,S=this._relativeAnchor2X,V=0,l=-l,h=-h,u=-u,f=-f,m=-m,d=-d,p=-p,g=-g,x=-x,b=-b,y=-y,z=-z,M=-M,Y=-Y,X=-X,w=-w,S=-S,V=-V;let F=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ),C=this._impulses[0],A=t.rows[t.numRows++],Z=A.jacobian;Z.lin1X=0,Z.lin1Y=0,Z.lin1Z=0,Z.lin2X=0,Z.lin2Y=0,Z.lin2Z=0,Z.ang1X=0,Z.ang1Y=0,Z.ang1Z=0,Z.ang2X=0,Z.ang2Y=0,Z.ang2Z=0,A.rhs=0,A.cfm=0,A.minImpulse=0,A.maxImpulse=0,A.motorSpeed=0,A.motorMaxImpulse=0,A.impulse=null,A.impulse=C,A.rhs=s,A.cfm=0,A.minImpulse=-1/0,A.maxImpulse=1/0;let L=A.jacobian;L.lin1X=1,L.lin1Y=0,L.lin1Z=0,L.lin2X=1,L.lin2Y=0,L.lin2Z=0,L.ang1X=l,L.ang1Y=h,L.ang1Z=u,L.ang2X=b,L.ang2Y=y,L.ang2Z=z;let E=this._impulses[1],T=t.rows[t.numRows++],P=T.jacobian;P.lin1X=0,P.lin1Y=0,P.lin1Z=0,P.lin2X=0,P.lin2Y=0,P.lin2Z=0,P.ang1X=0,P.ang1Y=0,P.ang1Z=0,P.ang2X=0,P.ang2Y=0,P.ang2Z=0,T.rhs=0,T.cfm=0,T.minImpulse=0,T.maxImpulse=0,T.motorSpeed=0,T.motorMaxImpulse=0,T.impulse=null,T.impulse=E,T.rhs=o,T.cfm=0,T.minImpulse=-1/0,T.maxImpulse=1/0,L=T.jacobian,L.lin1X=0,L.lin1Y=1,L.lin1Z=0,L.lin2X=0,L.lin2Y=1,L.lin2Z=0,L.ang1X=f,L.ang1Y=m,L.ang1Z=d,L.ang2X=M,L.ang2Y=Y,L.ang2Z=X;let N=this._impulses[2],R=t.rows[t.numRows++],k=R.jacobian;if(k.lin1X=0,k.lin1Y=0,k.lin1Z=0,k.lin2X=0,k.lin2Y=0,k.lin2Z=0,k.ang1X=0,k.ang1Y=0,k.ang1Z=0,k.ang2X=0,k.ang2Y=0,k.ang2Z=0,R.rhs=0,R.cfm=0,R.minImpulse=0,R.maxImpulse=0,R.motorSpeed=0,R.motorMaxImpulse=0,R.impulse=null,R.impulse=N,R.rhs=r,R.cfm=0,R.minImpulse=-1/0,R.maxImpulse=1/0,L=R.jacobian,L.lin1X=0,L.lin1Y=0,L.lin1Z=1,L.lin2X=0,L.lin2Y=0,L.lin2Z=1,L.ang1X=p,L.ang1Y=g,L.ang1Z=x,L.ang2X=w,L.ang2Y=S,L.ang2Z=V,this._sd.frequency<=0||!i){let tt=this._impulses[3],Q=t.rows[t.numRows++],nt=Q.jacobian;nt.lin1X=0,nt.lin1Y=0,nt.lin1Z=0,nt.lin2X=0,nt.lin2Y=0,nt.lin2Z=0,nt.ang1X=0,nt.ang1Y=0,nt.ang1Z=0,nt.ang2X=0,nt.ang2Y=0,nt.ang2Z=0,Q.rhs=0,Q.cfm=0,Q.minImpulse=0,Q.maxImpulse=0,Q.motorSpeed=0,Q.motorMaxImpulse=0,Q.impulse=null,Q.impulse=tt,this.setSolverInfoRowAngular(Q,this.angle,this._lm,F,this._sd,e,i),L=Q.jacobian,L.ang1X=this._basis.xX,L.ang1Y=this._basis.xY,L.ang1Z=this._basis.xZ,L.ang2X=this._basis.xX,L.ang2Y=this._basis.xY,L.ang2Z=this._basis.xZ}let O=this._impulses[4],v=t.rows[t.numRows++],D=v.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,v.rhs=0,v.cfm=0,v.minImpulse=0,v.maxImpulse=0,v.motorSpeed=0,v.motorMaxImpulse=0,v.impulse=null,v.impulse=O,v.rhs=_,v.cfm=0,v.minImpulse=-1/0,v.maxImpulse=1/0,L=v.jacobian,L.ang1X=this._basis.yX,L.ang1Y=this._basis.yY,L.ang1Z=this._basis.yZ,L.ang2X=this._basis.yX,L.ang2Y=this._basis.yY,L.ang2Z=this._basis.yZ;let B=this._impulses[5],U=t.rows[t.numRows++],q=U.jacobian;q.lin1X=0,q.lin1Y=0,q.lin1Z=0,q.lin2X=0,q.lin2Y=0,q.lin2Z=0,q.ang1X=0,q.ang1Y=0,q.ang1Z=0,q.ang2X=0,q.ang2Y=0,q.ang2Z=0,U.rhs=0,U.cfm=0,U.minImpulse=0,U.maxImpulse=0,U.motorSpeed=0,U.motorMaxImpulse=0,U.impulse=null,U.impulse=B,U.rhs=a,U.cfm=0,U.minImpulse=-1/0,U.maxImpulse=1/0,L=U.jacobian,L.ang1X=this._basis.zX,L.ang1Y=this._basis.zY,L.ang1Z=this._basis.zZ,L.ang2X=this._basis.zX,L.ang2Y=this._basis.zY,L.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();let t=this._basis,e=t.joint._b1._invMass,i=t.joint._b2._invMass,n,s,o,r,_,a,l,h,u,f,m,d,p,g,x,b,y,z,M,Y,X,w,S,V,F,C,A,Z,L,E,T,P,N,R,k,O,v=t.joint._basisX1X*t.joint._basisX2X+t.joint._basisX1Y*t.joint._basisX2Y+t.joint._basisX1Z*t.joint._basisX2Z;if(v<-.999999999){let Rt,Ot,Wt,Bt=t.joint._basisX1X,re=t.joint._basisX1Y,Ce=t.joint._basisX1Z,be=Bt*Bt,Tt=re*re,Lt=Ce*Ce,Yt;be<Tt?be<Lt?(Yt=1/Math.sqrt(Tt+Lt),Rt=0,Ot=Ce*Yt,Wt=-re*Yt):(Yt=1/Math.sqrt(be+Tt),Rt=re*Yt,Ot=-Bt*Yt,Wt=0):Tt<Lt?(Yt=1/Math.sqrt(Lt+be),Rt=-Ce*Yt,Ot=0,Wt=Bt*Yt):(Yt=1/Math.sqrt(be+Tt),Rt=re*Yt,Ot=-Bt*Yt,Wt=0),n=Rt,s=Ot,o=Wt,r=0}else{let Rt,Ot,Wt;Rt=t.joint._basisX1Y*t.joint._basisX2Z-t.joint._basisX1Z*t.joint._basisX2Y,Ot=t.joint._basisX1Z*t.joint._basisX2X-t.joint._basisX1X*t.joint._basisX2Z,Wt=t.joint._basisX1X*t.joint._basisX2Y-t.joint._basisX1Y*t.joint._basisX2X;let Bt=Math.sqrt((1+v)*.5);v=.5/Bt,Rt*=v,Ot*=v,Wt*=v,n=Rt,s=Ot,o=Wt,r=Bt}_=0,a=0,l=0,h=1;let D,B,U,q,tt,Q,nt,H;D=_,B=a,U=l,q=h,tt=n,Q=s,nt=o,H=r;let j=D*tt+B*Q+U*nt+q*H;if(j<0&&(j=-j,tt=-tt,Q=-Q,nt=-nt,H=-H),j>.999999){let Rt,Ot,Wt,Bt;Rt=tt-D,Ot=Q-B,Wt=nt-U,Bt=H-q,tt=D+Rt*(e/(e+i)),Q=B+Ot*(e/(e+i)),nt=U+Wt*(e/(e+i)),H=q+Bt*(e/(e+i));let re=tt*tt+Q*Q+nt*nt+H*H;re>1e-32&&(re=1/Math.sqrt(re)),u=tt*re,f=Q*re,m=nt*re,d=H*re}else{let Rt=e/(e+i)*Math.acos(j);tt+=D*-j,Q+=B*-j,nt+=U*-j,H+=q*-j;let Ot=tt*tt+Q*Q+nt*nt+H*H;Ot>1e-32&&(Ot=1/Math.sqrt(Ot)),tt*=Ot,Q*=Ot,nt*=Ot,H*=Ot;let Wt=Math.sin(Rt),Bt=Math.cos(Rt);D*=Bt,B*=Bt,U*=Bt,q*=Bt,u=D+tt*Wt,f=B+Q*Wt,m=U+nt*Wt,d=q+H*Wt}let it=u,et=f,G=m,W=d,lt=2*it,ht=2*et,ft=2*G,pt=it*lt,K=et*ht,J=G*ft,rt=it*ht,mt=et*ft,xt=it*ft,vt=W*lt,Mt=W*ht,ut=W*ft;p=1-K-J,g=rt-ut,x=xt+Mt,b=rt+ut,y=1-pt-J,z=mt-vt,M=xt-Mt,Y=mt+vt,X=1-pt-K;let Zt,zt,dt;Zt=p*t.joint._basisX1X+g*t.joint._basisX1Y+x*t.joint._basisX1Z,zt=b*t.joint._basisX1X+y*t.joint._basisX1Y+z*t.joint._basisX1Z,dt=M*t.joint._basisX1X+Y*t.joint._basisX1Y+X*t.joint._basisX1Z,w=Zt,S=zt,V=dt,T=t.xX,P=t.xY,N=t.xZ,R=t.yX,k=t.yY,O=t.yZ;let st=T*w+P*S+N*V;if(st<-.999999999){let Rt,Ot,Wt,Bt=T,re=P,Ce=N,be=Bt*Bt,Tt=re*re,Lt=Ce*Ce,Yt;be<Tt?be<Lt?(Yt=1/Math.sqrt(Tt+Lt),Rt=0,Ot=Ce*Yt,Wt=-re*Yt):(Yt=1/Math.sqrt(be+Tt),Rt=re*Yt,Ot=-Bt*Yt,Wt=0):Tt<Lt?(Yt=1/Math.sqrt(Lt+be),Rt=-Ce*Yt,Ot=0,Wt=Bt*Yt):(Yt=1/Math.sqrt(be+Tt),Rt=re*Yt,Ot=-Bt*Yt,Wt=0),u=Rt,f=Ot,m=Wt,d=0}else{let Rt,Ot,Wt;Rt=P*V-N*S,Ot=N*w-T*V,Wt=T*S-P*w;let Bt=Math.sqrt((1+st)*.5);st=.5/Bt,Rt*=st,Ot*=st,Wt*=st,u=Rt,f=Ot,m=Wt,d=Bt}let ct=u,_t=f,Vt=m,At=d,St=2*ct,Xt=2*_t,Ft=2*Vt,ie=ct*St,ee=_t*Xt,Ye=Vt*Ft,Ie=ct*Xt,ue=_t*Ft,$t=ct*Ft,Ht=At*St,me=At*Xt,ze=At*Ft;p=1-ee-Ye,g=Ie-ze,x=$t+me,b=Ie+ze,y=1-ie-Ye,z=ue-Ht,M=$t-me,Y=ue+Ht,X=1-ie-ee;let qe,Ee,Ut;if(qe=p*R+g*k+x*O,Ee=b*R+y*k+z*O,Ut=M*R+Y*k+X*O,F=qe,C=Ee,A=Ut,Z=S*A-V*C,L=V*F-w*A,E=w*C-S*F,Z*Z+L*L+E*E>1e-6){let Rt=Z*Z+L*L+E*E;Rt>0&&(Rt=1/Math.sqrt(Rt)),Z*=Rt,L*=Rt,E*=Rt}else{let Rt=w,Ot=S,Wt=V,Bt=Rt*Rt,re=Ot*Ot,Ce=Wt*Wt,be;Bt<re?Bt<Ce?(be=1/Math.sqrt(re+Ce),Z=0,L=Wt*be,E=-Ot*be):(be=1/Math.sqrt(Bt+re),Z=Ot*be,L=-Rt*be,E=0):re<Ce?(be=1/Math.sqrt(Ce+Bt),Z=-Wt*be,L=0,E=Rt*be):(be=1/Math.sqrt(Bt+re),Z=Ot*be,L=-Rt*be,E=0)}F=L*V-E*S,C=E*w-Z*V,A=Z*S-L*w,t.xX=w,t.xY=S,t.xZ=V,t.yX=F,t.yY=C,t.yZ=A,t.zX=Z,t.zY=L,t.zZ=E;let at,gt,yt;at=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,gt=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,yt=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;let bt=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,ot=bt<=-1?3.14159265358979:bt>=1?0:Math.acos(bt),Pt=at*at+gt*gt+yt*yt;Pt>0&&(Pt=1/Math.sqrt(Pt)),at*=Pt,gt*=Pt,yt*=Pt,at*=ot,gt*=ot,yt*=ot,this.angularErrorY=at*this._basis.yX+gt*this._basis.yY+yt*this._basis.yZ,this.angularErrorZ=at*this._basis.zX+gt*this._basis.zY+yt*this._basis.zZ;let Dt,$,kt;Dt=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,$=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,kt=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,bt=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=bt<=-1?3.14159265358979:bt>=1?0:Math.acos(bt),Dt*this._basis.xX+$*this._basis.xY+kt*this._basis.xZ<0&&(this.angle=-this.angle),this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,e){super._getVelocitySolverInfo(t,e),this.getInfo(e,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new I.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new I.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new I.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new I.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getAngle(){return this.angle}};I.dynamics.constraint.joint.RevoluteJointConfig=class extends I.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new I.common.Vec3(1,0,0),this.localAxis2=new I.common.Vec3(1,0,0),this.springDamper=new I.dynamics.constraint.joint.SpringDamper,this.limitMotor=new I.dynamics.constraint.joint.RotationalLimitMotor}init(t,e,i,n){this._init(t,e,i);let s=this.localAxis1,o,r,_;o=n.x,r=n.y,_=n.z;let a,l,h;a=t._transform._rotation00*o+t._transform._rotation10*r+t._transform._rotation20*_,l=t._transform._rotation01*o+t._transform._rotation11*r+t._transform._rotation21*_,h=t._transform._rotation02*o+t._transform._rotation12*r+t._transform._rotation22*_,o=a,r=l,_=h,s.x=o,s.y=r,s.z=_;let u=this.localAxis2,f,m,d;f=n.x,m=n.y,d=n.z;let p,g,x;return p=e._transform._rotation00*f+e._transform._rotation10*m+e._transform._rotation20*d,g=e._transform._rotation01*f+e._transform._rotation11*m+e._transform._rotation21*d,x=e._transform._rotation02*f+e._transform._rotation12*m+e._transform._rotation22*d,f=p,m=g,d=x,u.x=f,u.y=m,u.z=d,this}};I.dynamics.constraint.joint.RotationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorTorque=0}setLimits(t,e){return this.lowerLimit=t,this.upperLimit=e,this}setMotor(t,e){return this.motorSpeed=t,this.motorTorque=e,this}clone(){let t=new I.dynamics.constraint.joint.RotationalLimitMotor;return t.lowerLimit=this.lowerLimit,t.upperLimit=this.upperLimit,t.motorSpeed=this.motorSpeed,t.motorTorque=this.motorTorque,t}};I.dynamics.constraint.joint.SphericalJoint=class extends I.dynamics.constraint.joint.Joint{constructor(t){super(t,0),this._sd=t.springDamper.clone()}getInfo(t,e,i){if(this._sd.frequency>0&&i)return;let n,s,o;n=this._anchor2X-this._anchor1X,s=this._anchor2Y-this._anchor1Y,o=this._anchor2Z-this._anchor1Z;let r,_;if(this._sd.frequency>0){let v=6.28318530717958*this._sd.frequency,D=this._sd.dampingRatio;D<I.common.Setting.minSpringDamperDampingRatio&&(D=I.common.Setting.minSpringDamperDampingRatio);let B=e.dt,U=2*D*v,q=v*v;this._sd.useSymplecticEuler?(r=1/(B*U),_=q/U):(r=1/(B*(B*q+U)),_=q/(B*q+U)),r*=this._b1._invMass+this._b2._invMass}else r=0,_=this.getErp(e,i);let a,l,h;a=n*_,l=s*_,h=o*_;let u,f,m,d,p,g,x,b,y,z,M,Y,X,w,S,V,F,C;u=0,f=-this._relativeAnchor1Z,m=this._relativeAnchor1Y,d=this._relativeAnchor1Z,p=0,g=-this._relativeAnchor1X,x=-this._relativeAnchor1Y,b=this._relativeAnchor1X,y=0,z=0,M=-this._relativeAnchor2Z,Y=this._relativeAnchor2Y,X=this._relativeAnchor2Z,w=0,S=-this._relativeAnchor2X,V=-this._relativeAnchor2Y,F=this._relativeAnchor2X,C=0,u=-u,f=-f,m=-m,d=-d,p=-p,g=-g,x=-x,b=-b,y=-y,z=-z,M=-M,Y=-Y,X=-X,w=-w,S=-S,V=-V,F=-F,C=-C;let A=this._impulses[0],Z=t.rows[t.numRows++],L=Z.jacobian;L.lin1X=0,L.lin1Y=0,L.lin1Z=0,L.lin2X=0,L.lin2Y=0,L.lin2Z=0,L.ang1X=0,L.ang1Y=0,L.ang1Z=0,L.ang2X=0,L.ang2Y=0,L.ang2Z=0,Z.rhs=0,Z.cfm=0,Z.minImpulse=0,Z.maxImpulse=0,Z.motorSpeed=0,Z.motorMaxImpulse=0,Z.impulse=null,Z.impulse=A,Z.rhs=a,Z.cfm=r,Z.minImpulse=-1/0,Z.maxImpulse=1/0;let E=Z.jacobian;E.lin1X=1,E.lin1Y=0,E.lin1Z=0,E.lin2X=1,E.lin2Y=0,E.lin2Z=0,E.ang1X=u,E.ang1Y=f,E.ang1Z=m,E.ang2X=z,E.ang2Y=M,E.ang2Z=Y;let T=this._impulses[1],P=t.rows[t.numRows++],N=P.jacobian;N.lin1X=0,N.lin1Y=0,N.lin1Z=0,N.lin2X=0,N.lin2Y=0,N.lin2Z=0,N.ang1X=0,N.ang1Y=0,N.ang1Z=0,N.ang2X=0,N.ang2Y=0,N.ang2Z=0,P.rhs=0,P.cfm=0,P.minImpulse=0,P.maxImpulse=0,P.motorSpeed=0,P.motorMaxImpulse=0,P.impulse=null,P.impulse=T,P.rhs=l,P.cfm=r,P.minImpulse=-1/0,P.maxImpulse=1/0,E=P.jacobian,E.lin1X=0,E.lin1Y=1,E.lin1Z=0,E.lin2X=0,E.lin2Y=1,E.lin2Z=0,E.ang1X=d,E.ang1Y=p,E.ang1Z=g,E.ang2X=X,E.ang2Y=w,E.ang2Z=S;let R=this._impulses[2],k=t.rows[t.numRows++],O=k.jacobian;O.lin1X=0,O.lin1Y=0,O.lin1Z=0,O.lin2X=0,O.lin2Y=0,O.lin2Z=0,O.ang1X=0,O.ang1Y=0,O.ang1Z=0,O.ang2X=0,O.ang2Y=0,O.ang2Z=0,k.rhs=0,k.cfm=0,k.minImpulse=0,k.maxImpulse=0,k.motorSpeed=0,k.motorMaxImpulse=0,k.impulse=null,k.impulse=R,k.rhs=h,k.cfm=r,k.minImpulse=-1/0,k.maxImpulse=1/0,E=k.jacobian,E.lin1X=0,E.lin1Y=0,E.lin1Z=1,E.lin2X=0,E.lin2Y=0,E.lin2Z=1,E.ang1X=x,E.ang1Y=b,E.ang1Z=y,E.ang2X=V,E.ang2Y=F,E.ang2Z=C}_getVelocitySolverInfo(t,e){super._getVelocitySolverInfo(t,e),this.getInfo(e,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getSpringDamper(){return this._sd}};I.dynamics.constraint.joint.SphericalJointConfig=class extends I.dynamics.constraint.joint.JointConfig{constructor(){super(),this.springDamper=new I.dynamics.constraint.joint.SpringDamper}init(t,e,i){return this._init(t,e,i),this}};I.dynamics.constraint.joint.SpringDamper=class{constructor(){this.frequency=0,this.dampingRatio=0,this.useSymplecticEuler=!1}setSpring(t,e){return this.frequency=t,this.dampingRatio=e,this}setSymplecticEuler(t){return this.useSymplecticEuler=t,this}clone(){let t=new I.dynamics.constraint.joint.SpringDamper;return t.frequency=this.frequency,t.dampingRatio=this.dampingRatio,t.useSymplecticEuler=this.useSymplecticEuler,t}};I.dynamics.constraint.joint.TranslationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorForce=0}setLimits(t,e){return this.lowerLimit=t,this.upperLimit=e,this}setMotor(t,e){return this.motorSpeed=t,this.motorForce=e,this}clone(){let t=new I.dynamics.constraint.joint.TranslationalLimitMotor;return t.lowerLimit=this.lowerLimit,t.upperLimit=this.upperLimit,t.motorSpeed=this.motorSpeed,t.motorForce=this.motorForce,t}};I.dynamics.constraint.joint.UniversalJoint=class extends I.dynamics.constraint.joint.Joint{constructor(t){super(t,I.dynamics.constraint.joint.JointType.UNIVERSAL);let e=t.localAxis1;this._localBasisX1X=e.x,this._localBasisX1Y=e.y,this._localBasisX1Z=e.z;let i=t.localAxis2;this._localBasisZ2X=i.x,this._localBasisZ2Y=i.y,this._localBasisZ2Z=i.z,this.buildLocalBasesFromX1Z2(),this._angleX=0,this._angleY=0,this._angleZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1,this._sd1=t.springDamper1.clone(),this._sd2=t.springDamper2.clone(),this._lm1=t.limitMotor1.clone(),this._lm2=t.limitMotor2.clone()}getInfo(t,e,i){let n=this.getErp(e,i),s,o,r;s=this.linearErrorX*n,o=this.linearErrorY*n,r=this.linearErrorZ*n;let _=this._angleY*n,a,l,h,u,f,m,d,p,g,x,b,y,z,M,Y,X,w,S;a=0,l=-this._relativeAnchor1Z,h=this._relativeAnchor1Y,u=this._relativeAnchor1Z,f=0,m=-this._relativeAnchor1X,d=-this._relativeAnchor1Y,p=this._relativeAnchor1X,g=0,x=0,b=-this._relativeAnchor2Z,y=this._relativeAnchor2Y,z=this._relativeAnchor2Z,M=0,Y=-this._relativeAnchor2X,X=-this._relativeAnchor2Y,w=this._relativeAnchor2X,S=0,a=-a,l=-l,h=-h,u=-u,f=-f,m=-m,d=-d,p=-p,g=-g,x=-x,b=-b,y=-y,z=-z,M=-M,Y=-Y,X=-X,w=-w,S=-S;let V=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),F=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ),C=this._impulses[0],A=t.rows[t.numRows++],Z=A.jacobian;Z.lin1X=0,Z.lin1Y=0,Z.lin1Z=0,Z.lin2X=0,Z.lin2Y=0,Z.lin2Z=0,Z.ang1X=0,Z.ang1Y=0,Z.ang1Z=0,Z.ang2X=0,Z.ang2Y=0,Z.ang2Z=0,A.rhs=0,A.cfm=0,A.minImpulse=0,A.maxImpulse=0,A.motorSpeed=0,A.motorMaxImpulse=0,A.impulse=null,A.impulse=C,A.rhs=s,A.cfm=0,A.minImpulse=-1/0,A.maxImpulse=1/0;let L=A.jacobian;L.lin1X=1,L.lin1Y=0,L.lin1Z=0,L.lin2X=1,L.lin2Y=0,L.lin2Z=0,L.ang1X=a,L.ang1Y=l,L.ang1Z=h,L.ang2X=x,L.ang2Y=b,L.ang2Z=y;let E=this._impulses[1],T=t.rows[t.numRows++],P=T.jacobian;P.lin1X=0,P.lin1Y=0,P.lin1Z=0,P.lin2X=0,P.lin2Y=0,P.lin2Z=0,P.ang1X=0,P.ang1Y=0,P.ang1Z=0,P.ang2X=0,P.ang2Y=0,P.ang2Z=0,T.rhs=0,T.cfm=0,T.minImpulse=0,T.maxImpulse=0,T.motorSpeed=0,T.motorMaxImpulse=0,T.impulse=null,T.impulse=E,T.rhs=o,T.cfm=0,T.minImpulse=-1/0,T.maxImpulse=1/0,L=T.jacobian,L.lin1X=0,L.lin1Y=1,L.lin1Z=0,L.lin2X=0,L.lin2Y=1,L.lin2Z=0,L.ang1X=u,L.ang1Y=f,L.ang1Z=m,L.ang2X=z,L.ang2Y=M,L.ang2Z=Y;let N=this._impulses[2],R=t.rows[t.numRows++],k=R.jacobian;if(k.lin1X=0,k.lin1Y=0,k.lin1Z=0,k.lin2X=0,k.lin2Y=0,k.lin2Z=0,k.ang1X=0,k.ang1Y=0,k.ang1Z=0,k.ang2X=0,k.ang2Y=0,k.ang2Z=0,R.rhs=0,R.cfm=0,R.minImpulse=0,R.maxImpulse=0,R.motorSpeed=0,R.motorMaxImpulse=0,R.impulse=null,R.impulse=N,R.rhs=r,R.cfm=0,R.minImpulse=-1/0,R.maxImpulse=1/0,L=R.jacobian,L.lin1X=0,L.lin1Y=0,L.lin1Z=1,L.lin2X=0,L.lin2Y=0,L.lin2Z=1,L.ang1X=d,L.ang1Y=p,L.ang1Z=g,L.ang2X=X,L.ang2Y=w,L.ang2Z=S,!this.xSingular&&(this._sd1.frequency<=0||!i)){let O=this._impulses[3],v=t.rows[t.numRows++],D=v.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,v.rhs=0,v.cfm=0,v.minImpulse=0,v.maxImpulse=0,v.motorSpeed=0,v.motorMaxImpulse=0,v.impulse=null,v.impulse=O,this.setSolverInfoRowAngular(v,this._angleX,this._lm1,V,this._sd1,e,i),L=v.jacobian,L.ang1X=this._axisXX,L.ang1Y=this._axisXY,L.ang1Z=this._axisXZ,L.ang2X=this._axisXX,L.ang2Y=this._axisXY,L.ang2Z=this._axisXZ}if(!this.ySingular){let O=this._impulses[4],v=t.rows[t.numRows++],D=v.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,v.rhs=0,v.cfm=0,v.minImpulse=0,v.maxImpulse=0,v.motorSpeed=0,v.motorMaxImpulse=0,v.impulse=null,v.impulse=O,v.rhs=_,v.cfm=0,v.minImpulse=-1/0,v.maxImpulse=1/0,L=v.jacobian,L.ang1X=this._axisYX,L.ang1Y=this._axisYY,L.ang1Z=this._axisYZ,L.ang2X=this._axisYX,L.ang2Y=this._axisYY,L.ang2Z=this._axisYZ}if(!this.zSingular&&(this._sd2.frequency<=0||!i)){let O=this._impulses[5],v=t.rows[t.numRows++],D=v.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,v.rhs=0,v.cfm=0,v.minImpulse=0,v.maxImpulse=0,v.motorSpeed=0,v.motorMaxImpulse=0,v.impulse=null,v.impulse=O,this.setSolverInfoRowAngular(v,this._angleZ,this._lm2,F,this._sd2,e,i),L=v.jacobian,L.ang1X=this._axisZX,L.ang1Y=this._axisZY,L.ang1Z=this._axisZZ,L.ang2X=this._axisZX,L.ang2Y=this._axisZY,L.ang2Z=this._axisZZ}}_syncAnchors(){super._syncAnchors();let t,e,i,n,s,o,r,_,a;t=this._basisX1X,e=this._basisX1Y,i=this._basisX1Z,r=this._basisZ2X,_=this._basisZ2Y,a=this._basisZ2Z,n=_*i-a*e,s=a*t-r*i,o=r*e-_*t,this._axisXX=s*a-o*_,this._axisXY=o*r-n*a,this._axisXZ=n*_-s*r,this._axisYX=n,this._axisYY=s,this._axisYZ=o,this._axisZX=e*o-i*s,this._axisZY=i*n-t*o,this._axisZZ=t*s-e*n;let l=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;l>0&&(l=1/Math.sqrt(l)),this._axisXX*=l,this._axisXY*=l,this._axisXZ*=l;let h=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;h>0&&(h=1/Math.sqrt(h)),this._axisYX*=h,this._axisYY*=h,this._axisYZ*=h;let u=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;u>0&&(u=1/Math.sqrt(u)),this._axisZX*=u,this._axisZY*=u,this._axisZZ*=u,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0;let f,m,d,p,g,x,b,y,z,M,Y,X,w,S,V,F,C,A;f=this._basisX1X,m=this._basisY1X,d=this._basisZ1X,p=this._basisX1Y,g=this._basisY1Y,x=this._basisZ1Y,b=this._basisX1Z,y=this._basisY1Z,z=this._basisZ1Z,M=this._basisX2X,Y=this._basisY2X,X=this._basisZ2X,w=this._basisX2Y,S=this._basisY2Y,V=this._basisZ2Y,F=this._basisX2Z,C=this._basisY2Z,A=this._basisZ2Z;let Z,L,E,T,P,N,R,k,O,v,D,B,U,q;k=f*M+p*w+b*F,O=f*Y+p*S+b*C,v=f*X+p*V+b*A,D=m*Y+g*S+y*C,B=m*X+g*V+y*A,U=d*Y+x*S+z*C,q=d*X+x*V+z*A,Z=k,L=O,E=v,T=D,P=B,N=U,R=q;let tt,Q,nt,H=E;if(H<=-1){let j=Math.atan2(N,T);tt=j*.5,Q=-1.570796326794895,nt=-j*.5}else if(H>=1){let j=Math.atan2(N,T);tt=j*.5,Q=1.570796326794895,nt=j*.5}else tt=Math.atan2(-P,R),Q=Math.asin(H),nt=Math.atan2(-L,Z);this._angleX=tt,this._angleY=Q,this._angleZ=nt,this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,e){super._getVelocitySolverInfo(t,e),this.getInfo(e,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new I.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new I.common.Vec3;return t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z}getLocalAxis1(){let t=new I.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new I.common.Vec3;return t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z}getSpringDamper1(){return this._sd1}getSpringDamper2(){return this._sd2}getLimitMotor1(){return this._lm1}getLimitMotor2(){return this._lm2}getAngle1(){return this._angleX}getAngle2(){return this._angleZ}};I.dynamics.constraint.joint.UniversalJointConfig=class extends I.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new I.common.Vec3(1,0,0),this.localAxis2=new I.common.Vec3(1,0,0),this.springDamper1=new I.dynamics.constraint.joint.SpringDamper,this.springDamper2=new I.dynamics.constraint.joint.SpringDamper,this.limitMotor1=new I.dynamics.constraint.joint.RotationalLimitMotor,this.limitMotor2=new I.dynamics.constraint.joint.RotationalLimitMotor}init(t,e,i,n,s){this._init(t,e,i);let o=this.localAxis1,r,_,a;r=n.x,_=n.y,a=n.z;let l,h,u;l=t._transform._rotation00*r+t._transform._rotation10*_+t._transform._rotation20*a,h=t._transform._rotation01*r+t._transform._rotation11*_+t._transform._rotation21*a,u=t._transform._rotation02*r+t._transform._rotation12*_+t._transform._rotation22*a,r=l,_=h,a=u,o.x=r,o.y=_,o.z=a;let f=this.localAxis2,m,d,p;m=s.x,d=s.y,p=s.z;let g,x,b;return g=e._transform._rotation00*m+e._transform._rotation10*d+e._transform._rotation20*p,x=e._transform._rotation01*m+e._transform._rotation11*d+e._transform._rotation21*p,b=e._transform._rotation02*m+e._transform._rotation12*d+e._transform._rotation22*p,m=g,d=x,p=b,f.x=m,f.y=d,f.z=p,this}};I.dynamics.constraint.solver||(I.dynamics.constraint.solver={});I.dynamics.constraint.solver.ConstraintSolverType=class{};I.dynamics.constraint.solver.common||(I.dynamics.constraint.solver.common={});I.dynamics.constraint.solver.common.ContactSolverMassDataRow=class{constructor(){this.invMLinN1X=0,this.invMLinN1Y=0,this.invMLinN1Z=0,this.invMLinN2X=0,this.invMLinN2Y=0,this.invMLinN2Z=0,this.invMAngN1X=0,this.invMAngN1Y=0,this.invMAngN1Z=0,this.invMAngN2X=0,this.invMAngN2Y=0,this.invMAngN2Z=0,this.invMLinT1X=0,this.invMLinT1Y=0,this.invMLinT1Z=0,this.invMLinT2X=0,this.invMLinT2Y=0,this.invMLinT2Z=0,this.invMAngT1X=0,this.invMAngT1Y=0,this.invMAngT1Z=0,this.invMAngT2X=0,this.invMAngT2Y=0,this.invMAngT2Z=0,this.invMLinB1X=0,this.invMLinB1Y=0,this.invMLinB1Z=0,this.invMLinB2X=0,this.invMLinB2Y=0,this.invMLinB2Z=0,this.invMAngB1X=0,this.invMAngB1Y=0,this.invMAngB1Z=0,this.invMAngB2X=0,this.invMAngB2Y=0,this.invMAngB2Z=0,this.massN=0,this.massTB00=0,this.massTB01=0,this.massTB10=0,this.massTB11=0}};I.dynamics.constraint.solver.common.JointSolverMassDataRow=class{constructor(){this.invMLin1X=0,this.invMLin1Y=0,this.invMLin1Z=0,this.invMLin2X=0,this.invMLin2Y=0,this.invMLin2Z=0,this.invMAng1X=0,this.invMAng1Y=0,this.invMAng1Z=0,this.invMAng2X=0,this.invMAng2Y=0,this.invMAng2Z=0,this.mass=0,this.massWithoutCfm=0}};I.dynamics.constraint.solver.direct||(I.dynamics.constraint.solver.direct={});I.dynamics.constraint.solver.direct.Boundary=class{constructor(t){this.iBounded=new Array(t),this.iUnbounded=new Array(t),this.signs=new Array(t),this.b=new Array(t),this.numBounded=0,this.numUnbounded=0,this.matrixId=0}init(t){this.numBounded=t.numBounded;let e=0,i=this.numBounded;for(;e<i;){let o=e++;this.iBounded[o]=t.iBounded[o],this.signs[o]=t.signs[o]}this.numUnbounded=t.numUnbounded,this.matrixId=0;let n=0,s=this.numUnbounded;for(;n<s;){let o=n++,r=t.iUnbounded[o];this.iUnbounded[o]=r,this.matrixId|=1<<r}}computeImpulses(t,e,i,n,s,o,r){let _=0,a=this.numUnbounded;for(;_<a;){let Y=this.iUnbounded[_++],X=t.rows[Y];this.b[Y]=X.rhs*o-i[Y]-X.cfm*n[Y]}let l=e._invMassWithoutCfm,h=0,u=this.numBounded;for(;h<u;){let Y=h++,X=this.iBounded[Y],w=this.signs[Y],S=t.rows[X],V=(w<0?S.minImpulse:w>0?S.maxImpulse:0)-n[X];if(s[X]=V,V!=0){let F=0,C=this.numUnbounded;for(;F<C;){let A=this.iUnbounded[F++];this.b[A]-=l[X][A]*V}}}let f=this.iUnbounded,m=this.numUnbounded,d=0,p=0;for(;p<m;)d|=1<<f[p++];let g;e._cacheComputed[d]||(e.computeSubmatrix(d,f,m),e._cacheComputed[d]=!0),g=e._cachedSubmatrices[d];let x=!0,b=0,y=this.numUnbounded;for(;b<y;){let Y=b++,X=this.iUnbounded[Y],w=t.rows[X],S=n[X],V=S,F=0,C=this.numUnbounded;for(;F<C;){let A=F++;V+=this.b[this.iUnbounded[A]]*g[Y][A]}if(V<w.minImpulse-I.common.Setting.directMlcpSolverEps||V>w.maxImpulse+I.common.Setting.directMlcpSolverEps){x=!1;break}s[X]=V-S}if(r)return!0;if(!x)return!1;let z=0,M=this.numBounded;for(;z<M;){let Y=z++,X=this.iBounded[Y],w=t.rows[X],S=this.signs[Y],V=0,F=n[X]+s[X],C=i[X],A=0,Z=t.numRows;for(;A<Z;){let L=A++;C+=l[X][L]*s[L]}if(V=w.rhs*o-C-w.cfm*F,S<0&&V>I.common.Setting.directMlcpSolverEps||S>0&&V<-I.common.Setting.directMlcpSolverEps){x=!1;break}}return x}};I.dynamics.constraint.solver.direct.BoundaryBuildInfo=class{constructor(t){this.size=t,this.numBounded=0,this.iBounded=new Array(t),this.signs=new Array(t),this.numUnbounded=0,this.iUnbounded=new Array(t)}};I.dynamics.constraint.solver.direct.BoundaryBuilder=class{constructor(t){this.maxRows=t,this.numBoundaries=0,this.boundaries=new Array(1<<t),this.bbInfo=new I.dynamics.constraint.solver.direct.BoundaryBuildInfo(t)}buildBoundariesRecursive(t,e){if(e==t.numRows){this.boundaries[this.numBoundaries]==null&&(this.boundaries[this.numBoundaries]=new I.dynamics.constraint.solver.direct.Boundary(this.maxRows)),this.boundaries[this.numBoundaries++].init(this.bbInfo);return}let i=t.rows[e],n=i.minImpulse>-1/0,s=i.maxImpulse<1/0;if(i.minImpulse==0&&i.maxImpulse==0){let r=this.bbInfo;r.iBounded[r.numBounded]=e,r.signs[r.numBounded]=0,r.numBounded++,this.buildBoundariesRecursive(t,e+1),this.bbInfo.numBounded--;return}let o=this.bbInfo;if(o.iUnbounded[o.numUnbounded]=e,o.numUnbounded++,this.buildBoundariesRecursive(t,e+1),this.bbInfo.numUnbounded--,n){let r=this.bbInfo;r.iBounded[r.numBounded]=e,r.signs[r.numBounded]=-1,r.numBounded++,this.buildBoundariesRecursive(t,e+1),this.bbInfo.numBounded--}if(s){let r=this.bbInfo;r.iBounded[r.numBounded]=e,r.signs[r.numBounded]=1,r.numBounded++,this.buildBoundariesRecursive(t,e+1),this.bbInfo.numBounded--}}buildBoundaries(t){this.numBoundaries=0;let e=this.bbInfo;e.numBounded=0,e.numUnbounded=0,this.buildBoundariesRecursive(t,0)}};I.dynamics.constraint.solver.direct.BoundarySelector=class{constructor(t){this.n=t,this.indices=new Array(t),this.tmpIndices=new Array(t);let e=0;for(;e<t;){let i=e++;this.indices[i]=i}}getIndex(t){return this.indices[t]}select(t){let e=0;for(;this.indices[e]!=t;)++e;for(;e>0;){let i=this.indices[e];this.indices[e]=this.indices[e-1],this.indices[e-1]=i,--e}}setSize(t){let e=0,i=0,n=0,s=this.n;for(;n<s;){let r=this.indices[n++];r<t?(this.tmpIndices[e]=r,++e):(this.tmpIndices[t+i]=r,++i)}let o=this.indices;this.indices=this.tmpIndices,this.tmpIndices=o}};I.dynamics.constraint.solver.direct.DirectJointConstraintSolver=class extends I.dynamics.constraint.ConstraintSolver{constructor(t){super(),this.joint=t,this.info=new I.dynamics.constraint.info.joint.JointSolverInfo;let e=I.common.Setting.maxJacobianRows;this.massMatrix=new I.dynamics.constraint.solver.direct.MassMatrix(e),this.boundaryBuilder=new I.dynamics.constraint.solver.direct.BoundaryBuilder(e),this.massData=new Array(e);let i=0,n=this.massData.length;for(;i<n;)this.massData[i++]=new I.dynamics.constraint.solver.common.JointSolverMassDataRow;let s=this.boundaryBuilder.boundaries.length;this.velBoundarySelector=new I.dynamics.constraint.solver.direct.BoundarySelector(s),this.posBoundarySelector=new I.dynamics.constraint.solver.direct.BoundarySelector(s),this.relVels=new Array(e),this.impulses=new Array(e),this.dImpulses=new Array(e),this.dTotalImpulses=new Array(e);let o=0;for(;o<e;){let r=o++;this.relVels[r]=0,this.impulses[r]=0,this.dImpulses[r]=0,this.dTotalImpulses[r]=0}}preSolveVelocity(t){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);let e=this.boundaryBuilder;e.numBoundaries=0;let i=e.bbInfo;i.numBounded=0,i.numUnbounded=0,e.buildBoundariesRecursive(this.info,0);let n=this.velBoundarySelector,s=this.boundaryBuilder.numBoundaries,o=0,r=0,_=0,a=n.n;for(;_<a;){let h=n.indices[_++];h<s?(n.tmpIndices[o]=h,++o):(n.tmpIndices[s+r]=h,++r)}let l=n.indices;n.indices=n.tmpIndices,n.tmpIndices=l}warmStart(t){let e=this.joint._positionCorrectionAlgorithm==I.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?I.common.Setting.jointWarmStartingFactorForBaungarte:I.common.Setting.jointWarmStartingFactor;if(e*=t.dtRatio,e<=0){let M=0,Y=this.info.numRows;for(;M<Y;){let X=this.info.rows[M++].impulse;X.impulse=0,X.impulseM=0,X.impulseP=0}return}let i=0,n=this.info.numRows;for(;i<n;){let M=i++,Y=this.info.rows[M],X=Y.impulse,w=X.impulse*e;if(w<Y.minImpulse?w=Y.minImpulse:w>Y.maxImpulse&&(w=Y.maxImpulse),X.impulse=w,Y.motorMaxImpulse>0){let S=X.impulseM*e,V=Y.motorMaxImpulse;S<-V?S=-V:S>V&&(S=V),X.impulseM=S}else X.impulseM=0;this.dImpulses[M]=X.impulse+X.impulseM}let s=this.dImpulses,o=!1,r=!1,_,a,l,h,u,f,m,d,p,g,x,b;_=this._b1._velX,a=this._b1._velY,l=this._b1._velZ,h=this._b2._velX,u=this._b2._velY,f=this._b2._velZ,m=this._b1._angVelX,d=this._b1._angVelY,p=this._b1._angVelZ,g=this._b2._angVelX,x=this._b2._angVelY,b=this._b2._angVelZ;let y=0,z=this.info.numRows;for(;y<z;){let M=y++,Y=this.info.rows[M].jacobian,X=this.massData[M],w=s[M];(Y.flag&1)!=0&&(_+=X.invMLin1X*w,a+=X.invMLin1Y*w,l+=X.invMLin1Z*w,h+=X.invMLin2X*-w,u+=X.invMLin2Y*-w,f+=X.invMLin2Z*-w,o=!0),(Y.flag&2)!=0&&(m+=X.invMAng1X*w,d+=X.invMAng1Y*w,p+=X.invMAng1Z*w,g+=X.invMAng2X*-w,x+=X.invMAng2Y*-w,b+=X.invMAng2Z*-w,r=!0)}o&&(this._b1._velX=_,this._b1._velY=a,this._b1._velZ=l,this._b2._velX=h,this._b2._velY=u,this._b2._velZ=f),r&&(this._b1._angVelX=m,this._b1._angVelY=d,this._b1._angVelZ=p,this._b2._angVelX=g,this._b2._angVelY=x,this._b2._angVelZ=b)}solveVelocity(){let t=this.info.numRows,e,i,n,s,o,r,_,a,l,h,u,f;e=this._b1._velX,i=this._b1._velY,n=this._b1._velZ,s=this._b2._velX,o=this._b2._velY,r=this._b2._velZ,_=this._b1._angVelX,a=this._b1._angVelY,l=this._b1._angVelZ,h=this._b2._angVelX,u=this._b2._angVelY,f=this._b2._angVelZ;let m=0;for(;m<t;){let y=m++,z=this.info.rows[y],M=z.jacobian,Y=0;Y+=e*M.lin1X+i*M.lin1Y+n*M.lin1Z,Y-=s*M.lin2X+o*M.lin2Y+r*M.lin2Z,Y+=_*M.ang1X+a*M.ang1Y+l*M.ang1Z,Y-=h*M.ang2X+u*M.ang2Y+f*M.ang2Z,this.relVels[y]=Y,this.impulses[y]=z.impulse.impulse,this.dTotalImpulses[y]=0}let d=this.massMatrix._invMassWithoutCfm,p=0;for(;p<t;){let y=p++,z=this.info.rows[y],M=z.impulse;if(z.motorMaxImpulse>0){let Y=M.impulseM,X=Y+this.massData[y].massWithoutCfm*(-z.motorSpeed-this.relVels[y]),w=z.motorMaxImpulse;X<-w?X=-w:X>w&&(X=w),M.impulseM=X;let S=X-Y;this.dTotalImpulses[y]=S;let V=0;for(;V<t;){let F=V++;this.relVels[F]+=S*d[y][F]}}}let g=!1,x=0,b=this.boundaryBuilder.numBoundaries;for(;x<b;){let y=this.velBoundarySelector.indices[x++];if(this.boundaryBuilder.boundaries[y].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,1,!1)){let z=0;for(;z<t;){let D=z++,B=this.dImpulses[D];this.info.rows[D].impulse.impulse+=B,this.dTotalImpulses[D]+=B}let M=this.dTotalImpulses,Y=!1,X=!1,w,S,V,F,C,A,Z,L,E,T,P,N;w=this._b1._velX,S=this._b1._velY,V=this._b1._velZ,F=this._b2._velX,C=this._b2._velY,A=this._b2._velZ,Z=this._b1._angVelX,L=this._b1._angVelY,E=this._b1._angVelZ,T=this._b2._angVelX,P=this._b2._angVelY,N=this._b2._angVelZ;let R=0,k=this.info.numRows;for(;R<k;){let D=R++,B=this.info.rows[D].jacobian,U=this.massData[D],q=M[D];(B.flag&1)!=0&&(w+=U.invMLin1X*q,S+=U.invMLin1Y*q,V+=U.invMLin1Z*q,F+=U.invMLin2X*-q,C+=U.invMLin2Y*-q,A+=U.invMLin2Z*-q,Y=!0),(B.flag&2)!=0&&(Z+=U.invMAng1X*q,L+=U.invMAng1Y*q,E+=U.invMAng1Z*q,T+=U.invMAng2X*-q,P+=U.invMAng2Y*-q,N+=U.invMAng2Z*-q,X=!0)}Y&&(this._b1._velX=w,this._b1._velY=S,this._b1._velZ=V,this._b2._velX=F,this._b2._velY=C,this._b2._velZ=A),X&&(this._b1._angVelX=Z,this._b1._angVelY=L,this._b1._angVelZ=E,this._b2._angVelX=T,this._b2._angVelY=P,this._b2._angVelZ=N);let O=this.velBoundarySelector,v=0;for(;O.indices[v]!=y;)++v;for(;v>0;){let D=O.indices[v];O.indices[v]=O.indices[v-1],O.indices[v-1]=D,--v}g=!0;break}}if(!g){console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:335:","could not find solution. (velocity)");return}}postSolveVelocity(t){let e,i,n,s,o,r;e=0,i=0,n=0,s=0,o=0,r=0;let _=0,a=this.info.numRows;for(;_<a;){let l=this.info.rows[_++],h=l.impulse,u=l.jacobian;(u.flag&1)!=0?(e+=u.lin1X*h.impulse,i+=u.lin1Y*h.impulse,n+=u.lin1Z*h.impulse):(u.flag&2)!=0&&(s+=u.ang1X*h.impulse,o+=u.ang1Y*h.impulse,r+=u.ang1Z*h.impulse)}this.joint._appliedForceX=e*t.invDt,this.joint._appliedForceY=i*t.invDt,this.joint._appliedForceZ=n*t.invDt,this.joint._appliedTorqueX=s*t.invDt,this.joint._appliedTorqueY=o*t.invDt,this.joint._appliedTorqueZ=r*t.invDt}preSolvePosition(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);let e=this.boundaryBuilder;e.numBoundaries=0;let i=e.bbInfo;i.numBounded=0,i.numUnbounded=0,e.buildBoundariesRecursive(this.info,0);let n=this.posBoundarySelector,s=this.boundaryBuilder.numBoundaries,o=0,r=0,_=0,a=n.n;for(;_<a;){let f=n.indices[_++];f<s?(n.tmpIndices[o]=f,++o):(n.tmpIndices[s+r]=f,++r)}let l=n.indices;n.indices=n.tmpIndices,n.tmpIndices=l;let h=0,u=this.info.numRows;for(;h<u;)this.info.rows[h++].impulse.impulseP=0}solvePositionSplitImpulse(){let t=this.info.numRows,e,i,n,s,o,r,_,a,l,h,u,f;e=this._b1._pseudoVelX,i=this._b1._pseudoVelY,n=this._b1._pseudoVelZ,s=this._b2._pseudoVelX,o=this._b2._pseudoVelY,r=this._b2._pseudoVelZ,_=this._b1._angPseudoVelX,a=this._b1._angPseudoVelY,l=this._b1._angPseudoVelZ,h=this._b2._angPseudoVelX,u=this._b2._angPseudoVelY,f=this._b2._angPseudoVelZ;let m=0;for(;m<t;){let x=m++,b=this.info.rows[x],y=b.jacobian,z=0;z+=e*y.lin1X+i*y.lin1Y+n*y.lin1Z,z-=s*y.lin2X+o*y.lin2Y+r*y.lin2Z,z+=_*y.ang1X+a*y.ang1Y+l*y.ang1Z,z-=h*y.ang2X+u*y.ang2Y+f*y.ang2Z,this.relVels[x]=z,this.impulses[x]=b.impulse.impulseP}let d=!1,p=0,g=this.boundaryBuilder.numBoundaries;for(;p<g;){let x=this.posBoundarySelector.indices[p++];if(this.boundaryBuilder.boundaries[x].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,I.common.Setting.positionSplitImpulseBaumgarte,!1)){let b=0;for(;b<t;){let O=b++;this.info.rows[O].impulse.impulseP+=this.dImpulses[O]}let y=this.dImpulses,z=!1,M=!1,Y,X,w,S,V,F,C,A,Z,L,E,T;Y=this._b1._pseudoVelX,X=this._b1._pseudoVelY,w=this._b1._pseudoVelZ,S=this._b2._pseudoVelX,V=this._b2._pseudoVelY,F=this._b2._pseudoVelZ,C=this._b1._angPseudoVelX,A=this._b1._angPseudoVelY,Z=this._b1._angPseudoVelZ,L=this._b2._angPseudoVelX,E=this._b2._angPseudoVelY,T=this._b2._angPseudoVelZ;let P=0,N=this.info.numRows;for(;P<N;){let O=P++,v=this.info.rows[O].jacobian,D=this.massData[O],B=y[O];(v.flag&1)!=0&&(Y+=D.invMLin1X*B,X+=D.invMLin1Y*B,w+=D.invMLin1Z*B,S+=D.invMLin2X*-B,V+=D.invMLin2Y*-B,F+=D.invMLin2Z*-B,z=!0),(v.flag&2)!=0&&(C+=D.invMAng1X*B,A+=D.invMAng1Y*B,Z+=D.invMAng1Z*B,L+=D.invMAng2X*-B,E+=D.invMAng2Y*-B,T+=D.invMAng2Z*-B,M=!0)}z&&(this._b1._pseudoVelX=Y,this._b1._pseudoVelY=X,this._b1._pseudoVelZ=w,this._b2._pseudoVelX=S,this._b2._pseudoVelY=V,this._b2._pseudoVelZ=F),M&&(this._b1._angPseudoVelX=C,this._b1._angPseudoVelY=A,this._b1._angPseudoVelZ=Z,this._b2._angPseudoVelX=L,this._b2._angPseudoVelY=E,this._b2._angPseudoVelZ=T);let R=this.posBoundarySelector,k=0;for(;R.indices[k]!=x;)++k;for(;k>0;){let O=R.indices[k];R.indices[k]=R.indices[k-1],R.indices[k-1]=O,--k}d=!0;break}}if(!d){console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:450:","could not find solution. (split impulse)");return}}solvePositionNgs(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);let e=this.boundaryBuilder;e.numBoundaries=0;let i=e.bbInfo;i.numBounded=0,i.numUnbounded=0,e.buildBoundariesRecursive(this.info,0);let n=this.posBoundarySelector,s=this.boundaryBuilder.numBoundaries,o=0,r=0,_=0,a=n.n;for(;_<a;){let p=n.indices[_++];p<s?(n.tmpIndices[o]=p,++o):(n.tmpIndices[s+r]=p,++r)}let l=n.indices;n.indices=n.tmpIndices,n.tmpIndices=l;let h=this.info.numRows,u=0;for(;u<h;){let p=u++,g=this.info.rows[p].impulse;this.relVels[p]=0,this.impulses[p]=g.impulseP}let f=!1,m=0,d=this.boundaryBuilder.numBoundaries;for(;m<d;){let p=this.posBoundarySelector.indices[m++];if(this.boundaryBuilder.boundaries[p].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,I.common.Setting.positionNgsBaumgarte,!1)){let g=0;for(;g<h;){let R=g++;this.info.rows[R].impulse.impulseP+=this.dImpulses[R]}let x=this.dImpulses,b=!1,y=!1,z,M,Y,X,w,S,V,F,C,A,Z,L;z=0,M=0,Y=0,X=0,w=0,S=0,V=0,F=0,C=0,A=0,Z=0,L=0;let E=0,T=this.info.numRows;for(;E<T;){let R=E++,k=this.info.rows[R].jacobian,O=this.massData[R],v=x[R];(k.flag&1)!=0&&(z+=O.invMLin1X*v,M+=O.invMLin1Y*v,Y+=O.invMLin1Z*v,X+=O.invMLin2X*-v,w+=O.invMLin2Y*-v,S+=O.invMLin2Z*-v,b=!0),(k.flag&2)!=0&&(V+=O.invMAng1X*v,F+=O.invMAng1Y*v,C+=O.invMAng1Z*v,A+=O.invMAng2X*-v,Z+=O.invMAng2Y*-v,L+=O.invMAng2Z*-v,y=!0)}if(b){let R=this._b1;R._transform._positionX+=z,R._transform._positionY+=M,R._transform._positionZ+=Y;let k=this._b2;k._transform._positionX+=X,k._transform._positionY+=w,k._transform._positionZ+=S}if(y){let R=this._b1,k=Math.sqrt(V*V+F*F+C*C),O=k*.5,v,D;if(O<.5){let ce=O*O;v=.5*(1-ce*.16666666666666666+ce*ce*.008333333333333333),D=1-ce*.5+ce*ce*.041666666666666664}else v=Math.sin(O)/k,D=Math.cos(O);let B,U,q;B=V*v,U=F*v,q=C*v;let tt,Q,nt,H;tt=B,Q=U,nt=q,H=D;let j,it,et,G,W=R._transform._rotation00,lt=R._transform._rotation11,ht=R._transform._rotation22,ft=W+lt+ht,pt;ft>0?(pt=Math.sqrt(ft+1),G=.5*pt,pt=.5/pt,j=(R._transform._rotation21-R._transform._rotation12)*pt,it=(R._transform._rotation02-R._transform._rotation20)*pt,et=(R._transform._rotation10-R._transform._rotation01)*pt):W>lt?W>ht?(pt=Math.sqrt(W-lt-ht+1),j=.5*pt,pt=.5/pt,it=(R._transform._rotation01+R._transform._rotation10)*pt,et=(R._transform._rotation02+R._transform._rotation20)*pt,G=(R._transform._rotation21-R._transform._rotation12)*pt):(pt=Math.sqrt(ht-W-lt+1),et=.5*pt,pt=.5/pt,j=(R._transform._rotation02+R._transform._rotation20)*pt,it=(R._transform._rotation12+R._transform._rotation21)*pt,G=(R._transform._rotation10-R._transform._rotation01)*pt):lt>ht?(pt=Math.sqrt(lt-ht-W+1),it=.5*pt,pt=.5/pt,j=(R._transform._rotation01+R._transform._rotation10)*pt,et=(R._transform._rotation12+R._transform._rotation21)*pt,G=(R._transform._rotation02-R._transform._rotation20)*pt):(pt=Math.sqrt(ht-W-lt+1),et=.5*pt,pt=.5/pt,j=(R._transform._rotation02+R._transform._rotation20)*pt,it=(R._transform._rotation12+R._transform._rotation21)*pt,G=(R._transform._rotation10-R._transform._rotation01)*pt),j=H*j+tt*G+Q*et-nt*it,it=H*it-tt*et+Q*G+nt*j,et=H*et+tt*it-Q*j+nt*G,G=H*G-tt*j-Q*it-nt*et;let K=j*j+it*it+et*et+G*G;K>1e-32&&(K=1/Math.sqrt(K)),j*=K,it*=K,et*=K,G*=K;let J=j,rt=it,mt=et,xt=G,vt=2*J,Mt=2*rt,ut=2*mt,Zt=J*vt,zt=rt*Mt,dt=mt*ut,st=J*Mt,ct=rt*ut,_t=J*ut,Vt=xt*vt,At=xt*Mt,St=xt*ut;R._transform._rotation00=1-zt-dt,R._transform._rotation01=st-St,R._transform._rotation02=_t+At,R._transform._rotation10=st+St,R._transform._rotation11=1-Zt-dt,R._transform._rotation12=ct-Vt,R._transform._rotation20=_t-At,R._transform._rotation21=ct+Vt,R._transform._rotation22=1-Zt-zt;let Xt,Ft,ie,ee,Ye,Ie,ue,$t,Ht;Xt=R._transform._rotation00*R._invLocalInertia00+R._transform._rotation01*R._invLocalInertia10+R._transform._rotation02*R._invLocalInertia20,Ft=R._transform._rotation00*R._invLocalInertia01+R._transform._rotation01*R._invLocalInertia11+R._transform._rotation02*R._invLocalInertia21,ie=R._transform._rotation00*R._invLocalInertia02+R._transform._rotation01*R._invLocalInertia12+R._transform._rotation02*R._invLocalInertia22,ee=R._transform._rotation10*R._invLocalInertia00+R._transform._rotation11*R._invLocalInertia10+R._transform._rotation12*R._invLocalInertia20,Ye=R._transform._rotation10*R._invLocalInertia01+R._transform._rotation11*R._invLocalInertia11+R._transform._rotation12*R._invLocalInertia21,Ie=R._transform._rotation10*R._invLocalInertia02+R._transform._rotation11*R._invLocalInertia12+R._transform._rotation12*R._invLocalInertia22,ue=R._transform._rotation20*R._invLocalInertia00+R._transform._rotation21*R._invLocalInertia10+R._transform._rotation22*R._invLocalInertia20,$t=R._transform._rotation20*R._invLocalInertia01+R._transform._rotation21*R._invLocalInertia11+R._transform._rotation22*R._invLocalInertia21,Ht=R._transform._rotation20*R._invLocalInertia02+R._transform._rotation21*R._invLocalInertia12+R._transform._rotation22*R._invLocalInertia22,R._invInertia00=Xt,R._invInertia01=Ft,R._invInertia02=ie,R._invInertia10=ee,R._invInertia11=Ye,R._invInertia12=Ie,R._invInertia20=ue,R._invInertia21=$t,R._invInertia22=Ht;let me,ze,qe,Ee,Ut,at,gt,yt,bt;me=R._invInertia00*R._transform._rotation00+R._invInertia01*R._transform._rotation01+R._invInertia02*R._transform._rotation02,ze=R._invInertia00*R._transform._rotation10+R._invInertia01*R._transform._rotation11+R._invInertia02*R._transform._rotation12,qe=R._invInertia00*R._transform._rotation20+R._invInertia01*R._transform._rotation21+R._invInertia02*R._transform._rotation22,Ee=R._invInertia10*R._transform._rotation00+R._invInertia11*R._transform._rotation01+R._invInertia12*R._transform._rotation02,Ut=R._invInertia10*R._transform._rotation10+R._invInertia11*R._transform._rotation11+R._invInertia12*R._transform._rotation12,at=R._invInertia10*R._transform._rotation20+R._invInertia11*R._transform._rotation21+R._invInertia12*R._transform._rotation22,gt=R._invInertia20*R._transform._rotation00+R._invInertia21*R._transform._rotation01+R._invInertia22*R._transform._rotation02,yt=R._invInertia20*R._transform._rotation10+R._invInertia21*R._transform._rotation11+R._invInertia22*R._transform._rotation12,bt=R._invInertia20*R._transform._rotation20+R._invInertia21*R._transform._rotation21+R._invInertia22*R._transform._rotation22,R._invInertia00=me,R._invInertia01=ze,R._invInertia02=qe,R._invInertia10=Ee,R._invInertia11=Ut,R._invInertia12=at,R._invInertia20=gt,R._invInertia21=yt,R._invInertia22=bt,R._invInertia00*=R._rotFactor.x,R._invInertia01*=R._rotFactor.x,R._invInertia02*=R._rotFactor.x,R._invInertia10*=R._rotFactor.y,R._invInertia11*=R._rotFactor.y,R._invInertia12*=R._rotFactor.y,R._invInertia20*=R._rotFactor.z,R._invInertia21*=R._rotFactor.z,R._invInertia22*=R._rotFactor.z;let ot=this._b2,Pt=Math.sqrt(A*A+Z*Z+L*L),Dt=Pt*.5,$,kt;if(Dt<.5){let ce=Dt*Dt;$=.5*(1-ce*.16666666666666666+ce*ce*.008333333333333333),kt=1-ce*.5+ce*ce*.041666666666666664}else $=Math.sin(Dt)/Pt,kt=Math.cos(Dt);let Rt,Ot,Wt;Rt=A*$,Ot=Z*$,Wt=L*$;let Bt,re,Ce,be;Bt=Rt,re=Ot,Ce=Wt,be=kt;let Tt,Lt,Yt,pe,Me=ot._transform._rotation00,fe=ot._transform._rotation11,ti=ot._transform._rotation22,di=Me+fe+ti,Le;di>0?(Le=Math.sqrt(di+1),pe=.5*Le,Le=.5/Le,Tt=(ot._transform._rotation21-ot._transform._rotation12)*Le,Lt=(ot._transform._rotation02-ot._transform._rotation20)*Le,Yt=(ot._transform._rotation10-ot._transform._rotation01)*Le):Me>fe?Me>ti?(Le=Math.sqrt(Me-fe-ti+1),Tt=.5*Le,Le=.5/Le,Lt=(ot._transform._rotation01+ot._transform._rotation10)*Le,Yt=(ot._transform._rotation02+ot._transform._rotation20)*Le,pe=(ot._transform._rotation21-ot._transform._rotation12)*Le):(Le=Math.sqrt(ti-Me-fe+1),Yt=.5*Le,Le=.5/Le,Tt=(ot._transform._rotation02+ot._transform._rotation20)*Le,Lt=(ot._transform._rotation12+ot._transform._rotation21)*Le,pe=(ot._transform._rotation10-ot._transform._rotation01)*Le):fe>ti?(Le=Math.sqrt(fe-ti-Me+1),Lt=.5*Le,Le=.5/Le,Tt=(ot._transform._rotation01+ot._transform._rotation10)*Le,Yt=(ot._transform._rotation12+ot._transform._rotation21)*Le,pe=(ot._transform._rotation02-ot._transform._rotation20)*Le):(Le=Math.sqrt(ti-Me-fe+1),Yt=.5*Le,Le=.5/Le,Tt=(ot._transform._rotation02+ot._transform._rotation20)*Le,Lt=(ot._transform._rotation12+ot._transform._rotation21)*Le,pe=(ot._transform._rotation10-ot._transform._rotation01)*Le),Tt=be*Tt+Bt*pe+re*Yt-Ce*Lt,Lt=be*Lt-Bt*Yt+re*pe+Ce*Tt,Yt=be*Yt+Bt*Lt-re*Tt+Ce*pe,pe=be*pe-Bt*Tt-re*Lt-Ce*Yt;let _i=Tt*Tt+Lt*Lt+Yt*Yt+pe*pe;_i>1e-32&&(_i=1/Math.sqrt(_i)),Tt*=_i,Lt*=_i,Yt*=_i,pe*=_i;let yi=Tt,he=Lt,gi=Yt,bi=pe,Mi=2*yi,Si=2*he,He=2*gi,Je=yi*Mi,Qe=he*Si,ci=gi*He,hi=yi*Si,ei=he*He,ai=yi*He,Ke=bi*Mi,We=bi*Si,ke=bi*He;ot._transform._rotation00=1-Qe-ci,ot._transform._rotation01=hi-ke,ot._transform._rotation02=ai+We,ot._transform._rotation10=hi+ke,ot._transform._rotation11=1-Je-ci,ot._transform._rotation12=ei-Ke,ot._transform._rotation20=ai-We,ot._transform._rotation21=ei+Ke,ot._transform._rotation22=1-Je-Qe;let le,ge,jt,Ae,Ze,Re,Te,Fe,se;le=ot._transform._rotation00*ot._invLocalInertia00+ot._transform._rotation01*ot._invLocalInertia10+ot._transform._rotation02*ot._invLocalInertia20,ge=ot._transform._rotation00*ot._invLocalInertia01+ot._transform._rotation01*ot._invLocalInertia11+ot._transform._rotation02*ot._invLocalInertia21,jt=ot._transform._rotation00*ot._invLocalInertia02+ot._transform._rotation01*ot._invLocalInertia12+ot._transform._rotation02*ot._invLocalInertia22,Ae=ot._transform._rotation10*ot._invLocalInertia00+ot._transform._rotation11*ot._invLocalInertia10+ot._transform._rotation12*ot._invLocalInertia20,Ze=ot._transform._rotation10*ot._invLocalInertia01+ot._transform._rotation11*ot._invLocalInertia11+ot._transform._rotation12*ot._invLocalInertia21,Re=ot._transform._rotation10*ot._invLocalInertia02+ot._transform._rotation11*ot._invLocalInertia12+ot._transform._rotation12*ot._invLocalInertia22,Te=ot._transform._rotation20*ot._invLocalInertia00+ot._transform._rotation21*ot._invLocalInertia10+ot._transform._rotation22*ot._invLocalInertia20,Fe=ot._transform._rotation20*ot._invLocalInertia01+ot._transform._rotation21*ot._invLocalInertia11+ot._transform._rotation22*ot._invLocalInertia21,se=ot._transform._rotation20*ot._invLocalInertia02+ot._transform._rotation21*ot._invLocalInertia12+ot._transform._rotation22*ot._invLocalInertia22,ot._invInertia00=le,ot._invInertia01=ge,ot._invInertia02=jt,ot._invInertia10=Ae,ot._invInertia11=Ze,ot._invInertia12=Re,ot._invInertia20=Te,ot._invInertia21=Fe,ot._invInertia22=se;let Ct,Gt,Pe,Ve,Ue,ii,ri,mi,xi;Ct=ot._invInertia00*ot._transform._rotation00+ot._invInertia01*ot._transform._rotation01+ot._invInertia02*ot._transform._rotation02,Gt=ot._invInertia00*ot._transform._rotation10+ot._invInertia01*ot._transform._rotation11+ot._invInertia02*ot._transform._rotation12,Pe=ot._invInertia00*ot._transform._rotation20+ot._invInertia01*ot._transform._rotation21+ot._invInertia02*ot._transform._rotation22,Ve=ot._invInertia10*ot._transform._rotation00+ot._invInertia11*ot._transform._rotation01+ot._invInertia12*ot._transform._rotation02,Ue=ot._invInertia10*ot._transform._rotation10+ot._invInertia11*ot._transform._rotation11+ot._invInertia12*ot._transform._rotation12,ii=ot._invInertia10*ot._transform._rotation20+ot._invInertia11*ot._transform._rotation21+ot._invInertia12*ot._transform._rotation22,ri=ot._invInertia20*ot._transform._rotation00+ot._invInertia21*ot._transform._rotation01+ot._invInertia22*ot._transform._rotation02,mi=ot._invInertia20*ot._transform._rotation10+ot._invInertia21*ot._transform._rotation11+ot._invInertia22*ot._transform._rotation12,xi=ot._invInertia20*ot._transform._rotation20+ot._invInertia21*ot._transform._rotation21+ot._invInertia22*ot._transform._rotation22,ot._invInertia00=Ct,ot._invInertia01=Gt,ot._invInertia02=Pe,ot._invInertia10=Ve,ot._invInertia11=Ue,ot._invInertia12=ii,ot._invInertia20=ri,ot._invInertia21=mi,ot._invInertia22=xi,ot._invInertia00*=ot._rotFactor.x,ot._invInertia01*=ot._rotFactor.x,ot._invInertia02*=ot._rotFactor.x,ot._invInertia10*=ot._rotFactor.y,ot._invInertia11*=ot._rotFactor.y,ot._invInertia12*=ot._rotFactor.y,ot._invInertia20*=ot._rotFactor.z,ot._invInertia21*=ot._rotFactor.z,ot._invInertia22*=ot._rotFactor.z}let P=this.posBoundarySelector,N=0;for(;P.indices[N]!=p;)++N;for(;N>0;){let R=P.indices[N];P.indices[N]=P.indices[N-1],P.indices[N-1]=R,--N}f=!0;break}}if(!f){console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:502:","could not find solution. (NGS)");return}}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}};I.dynamics.constraint.solver.direct.MassMatrix=class{constructor(t){this._size=t,this.tmpMatrix=new Array(this._size),this._invMass=new Array(this._size),this._invMassWithoutCfm=new Array(this._size);let e=0,i=this._size;for(;e<i;){let o=e++;this.tmpMatrix[o]=new Array(this._size),this._invMass[o]=new Array(this._size),this._invMassWithoutCfm[o]=new Array(this._size);let r=0,_=this._size;for(;r<_;){let a=r++;this.tmpMatrix[o][a]=0,this._invMass[o][a]=0,this._invMassWithoutCfm[o][a]=0}}this._maxSubmatrixId=1<<this._size,this._cacheComputed=new Array(this._maxSubmatrixId),this._cachedSubmatrices=new Array(this._maxSubmatrixId);let n=0,s=this._maxSubmatrixId;for(;n<s;){let o=n++,r;r=(o&85)+(o>>1&85),r=(r&51)+(r>>2&51),r=(r&15)+(r>>4&15);let _=r,a=new Array(_),l=0;for(;l<_;){let h=l++;a[h]=new Array(_);let u=0;for(;u<_;)a[h][u++]=0}this._cacheComputed[o]=!1,this._cachedSubmatrices[o]=a}}computeSubmatrix(t,e,i){let n=0;for(;n<i;){let u=n++,f=e[u],m=0;for(;m<i;){let d=m++;this.tmpMatrix[u][d]=this._invMass[f][e[d]]}}let s=this.tmpMatrix,o=this._cachedSubmatrices[t],r,_,a,l,h;switch(i){case 4:r=s[0],_=o[0],h=1/r[0],_[0]=h,r[1]*=h,r[2]*=h,r[3]*=h,a=s[1],l=o[1],l[0]=-h*a[0],a[1]-=r[1]*a[0],a[2]-=r[2]*a[0],a[3]-=r[3]*a[0],a=s[2],l=o[2],l[0]=-h*a[0],a[1]-=r[1]*a[0],a[2]-=r[2]*a[0],a[3]-=r[3]*a[0],a=s[3],l=o[3],l[0]=-h*a[0],a[1]-=r[1]*a[0],a[2]-=r[2]*a[0],a[3]-=r[3]*a[0],r=s[1],_=o[1],h=1/r[1],_[1]=h,_[0]*=h,r[2]*=h,r[3]*=h,a=s[0],l=o[0],l[0]-=_[0]*a[1],a[2]-=r[2]*a[1],a[3]-=r[3]*a[1],a=s[2],l=o[2],l[0]-=_[0]*a[1],l[1]=-h*a[1],a[2]-=r[2]*a[1],a[3]-=r[3]*a[1],a=s[3],l=o[3],l[0]-=_[0]*a[1],l[1]=-h*a[1],a[2]-=r[2]*a[1],a[3]-=r[3]*a[1],r=s[2],_=o[2],h=1/r[2],_[2]=h,_[0]*=h,_[1]*=h,r[3]*=h,a=s[0],l=o[0],l[0]-=_[0]*a[2],a[3]-=r[3]*a[2],a=s[1],l=o[1],l[0]-=_[0]*a[2],l[1]-=_[1]*a[2],a[3]-=r[3]*a[2],a=s[3],l=o[3],l[0]-=_[0]*a[2],l[1]-=_[1]*a[2],l[2]=-h*a[2],a[3]-=r[3]*a[2],r=s[3],_=o[3],h=1/r[3],_[3]=h,_[0]*=h,_[1]*=h,_[2]*=h,a=s[0],l=o[0],l[0]-=_[0]*a[3],a=s[1],l=o[1],l[0]-=_[0]*a[3],l[1]-=_[1]*a[3],a=s[2],l=o[2],l[0]-=_[0]*a[3],l[1]-=_[1]*a[3],l[2]-=_[2]*a[3],_=o[1],o[0][1]=_[0],_=o[2],o[0][2]=_[0],o[1][2]=_[1],_=o[3],o[0][3]=_[0],o[1][3]=_[1],o[2][3]=_[2];break;case 5:r=s[0],_=o[0],h=1/r[0],_[0]=h,r[1]*=h,r[2]*=h,r[3]*=h,r[4]*=h,a=s[1],l=o[1],l[0]=-h*a[0],a[1]-=r[1]*a[0],a[2]-=r[2]*a[0],a[3]-=r[3]*a[0],a[4]-=r[4]*a[0],a=s[2],l=o[2],l[0]=-h*a[0],a[1]-=r[1]*a[0],a[2]-=r[2]*a[0],a[3]-=r[3]*a[0],a[4]-=r[4]*a[0],a=s[3],l=o[3],l[0]=-h*a[0],a[1]-=r[1]*a[0],a[2]-=r[2]*a[0],a[3]-=r[3]*a[0],a[4]-=r[4]*a[0],a=s[4],l=o[4],l[0]=-h*a[0],a[1]-=r[1]*a[0],a[2]-=r[2]*a[0],a[3]-=r[3]*a[0],a[4]-=r[4]*a[0],r=s[1],_=o[1],h=1/r[1],_[1]=h,_[0]*=h,r[2]*=h,r[3]*=h,r[4]*=h,a=s[0],l=o[0],l[0]-=_[0]*a[1],a[2]-=r[2]*a[1],a[3]-=r[3]*a[1],a[4]-=r[4]*a[1],a=s[2],l=o[2],l[0]-=_[0]*a[1],l[1]=-h*a[1],a[2]-=r[2]*a[1],a[3]-=r[3]*a[1],a[4]-=r[4]*a[1],a=s[3],l=o[3],l[0]-=_[0]*a[1],l[1]=-h*a[1],a[2]-=r[2]*a[1],a[3]-=r[3]*a[1],a[4]-=r[4]*a[1],a=s[4],l=o[4],l[0]-=_[0]*a[1],l[1]=-h*a[1],a[2]-=r[2]*a[1],a[3]-=r[3]*a[1],a[4]-=r[4]*a[1],r=s[2],_=o[2],h=1/r[2],_[2]=h,_[0]*=h,_[1]*=h,r[3]*=h,r[4]*=h,a=s[0],l=o[0],l[0]-=_[0]*a[2],a[3]-=r[3]*a[2],a[4]-=r[4]*a[2],a=s[1],l=o[1],l[0]-=_[0]*a[2],l[1]-=_[1]*a[2],a[3]-=r[3]*a[2],a[4]-=r[4]*a[2],a=s[3],l=o[3],l[0]-=_[0]*a[2],l[1]-=_[1]*a[2],l[2]=-h*a[2],a[3]-=r[3]*a[2],a[4]-=r[4]*a[2],a=s[4],l=o[4],l[0]-=_[0]*a[2],l[1]-=_[1]*a[2],l[2]=-h*a[2],a[3]-=r[3]*a[2],a[4]-=r[4]*a[2],r=s[3],_=o[3],h=1/r[3],_[3]=h,_[0]*=h,_[1]*=h,_[2]*=h,r[4]*=h,a=s[0],l=o[0],l[0]-=_[0]*a[3],a[4]-=r[4]*a[3],a=s[1],l=o[1],l[0]-=_[0]*a[3],l[1]-=_[1]*a[3],a[4]-=r[4]*a[3],a=s[2],l=o[2],l[0]-=_[0]*a[3],l[1]-=_[1]*a[3],l[2]-=_[2]*a[3],a[4]-=r[4]*a[3],a=s[4],l=o[4],l[0]-=_[0]*a[3],l[1]-=_[1]*a[3],l[2]-=_[2]*a[3],l[3]=-h*a[3],a[4]-=r[4]*a[3],r=s[4],_=o[4],h=1/r[4],_[4]=h,_[0]*=h,_[1]*=h,_[2]*=h,_[3]*=h,a=s[0],l=o[0],l[0]-=_[0]*a[4],a=s[1],l=o[1],l[0]-=_[0]*a[4],l[1]-=_[1]*a[4],a=s[2],l=o[2],l[0]-=_[0]*a[4],l[1]-=_[1]*a[4],l[2]-=_[2]*a[4],a=s[3],l=o[3],l[0]-=_[0]*a[4],l[1]-=_[1]*a[4],l[2]-=_[2]*a[4],l[3]-=_[3]*a[4],_=o[1],o[0][1]=_[0],_=o[2],o[0][2]=_[0],o[1][2]=_[1],_=o[3],o[0][3]=_[0],o[1][3]=_[1],o[2][3]=_[2],_=o[4],o[0][4]=_[0],o[1][4]=_[1],o[2][4]=_[2],o[3][4]=_[3];break;case 6:r=s[0],_=o[0],h=1/r[0],_[0]=h,r[1]*=h,r[2]*=h,r[3]*=h,r[4]*=h,r[5]*=h,a=s[1],l=o[1],l[0]=-h*a[0],a[1]-=r[1]*a[0],a[2]-=r[2]*a[0],a[3]-=r[3]*a[0],a[4]-=r[4]*a[0],a[5]-=r[5]*a[0],a=s[2],l=o[2],l[0]=-h*a[0],a[1]-=r[1]*a[0],a[2]-=r[2]*a[0],a[3]-=r[3]*a[0],a[4]-=r[4]*a[0],a[5]-=r[5]*a[0],a=s[3],l=o[3],l[0]=-h*a[0],a[1]-=r[1]*a[0],a[2]-=r[2]*a[0],a[3]-=r[3]*a[0],a[4]-=r[4]*a[0],a[5]-=r[5]*a[0],a=s[4],l=o[4],l[0]=-h*a[0],a[1]-=r[1]*a[0],a[2]-=r[2]*a[0],a[3]-=r[3]*a[0],a[4]-=r[4]*a[0],a[5]-=r[5]*a[0],a=s[5],l=o[5],l[0]=-h*a[0],a[1]-=r[1]*a[0],a[2]-=r[2]*a[0],a[3]-=r[3]*a[0],a[4]-=r[4]*a[0],a[5]-=r[5]*a[0],r=s[1],_=o[1],h=1/r[1],_[1]=h,_[0]*=h,r[2]*=h,r[3]*=h,r[4]*=h,r[5]*=h,a=s[0],l=o[0],l[0]-=_[0]*a[1],a[2]-=r[2]*a[1],a[3]-=r[3]*a[1],a[4]-=r[4]*a[1],a[5]-=r[5]*a[1],a=s[2],l=o[2],l[0]-=_[0]*a[1],l[1]=-h*a[1],a[2]-=r[2]*a[1],a[3]-=r[3]*a[1],a[4]-=r[4]*a[1],a[5]-=r[5]*a[1],a=s[3],l=o[3],l[0]-=_[0]*a[1],l[1]=-h*a[1],a[2]-=r[2]*a[1],a[3]-=r[3]*a[1],a[4]-=r[4]*a[1],a[5]-=r[5]*a[1],a=s[4],l=o[4],l[0]-=_[0]*a[1],l[1]=-h*a[1],a[2]-=r[2]*a[1],a[3]-=r[3]*a[1],a[4]-=r[4]*a[1],a[5]-=r[5]*a[1],a=s[5],l=o[5],l[0]-=_[0]*a[1],l[1]=-h*a[1],a[2]-=r[2]*a[1],a[3]-=r[3]*a[1],a[4]-=r[4]*a[1],a[5]-=r[5]*a[1],r=s[2],_=o[2],h=1/r[2],_[2]=h,_[0]*=h,_[1]*=h,r[3]*=h,r[4]*=h,r[5]*=h,a=s[0],l=o[0],l[0]-=_[0]*a[2],a[3]-=r[3]*a[2],a[4]-=r[4]*a[2],a[5]-=r[5]*a[2],a=s[1],l=o[1],l[0]-=_[0]*a[2],l[1]-=_[1]*a[2],a[3]-=r[3]*a[2],a[4]-=r[4]*a[2],a[5]-=r[5]*a[2],a=s[3],l=o[3],l[0]-=_[0]*a[2],l[1]-=_[1]*a[2],l[2]=-h*a[2],a[3]-=r[3]*a[2],a[4]-=r[4]*a[2],a[5]-=r[5]*a[2],a=s[4],l=o[4],l[0]-=_[0]*a[2],l[1]-=_[1]*a[2],l[2]=-h*a[2],a[3]-=r[3]*a[2],a[4]-=r[4]*a[2],a[5]-=r[5]*a[2],a=s[5],l=o[5],l[0]-=_[0]*a[2],l[1]-=_[1]*a[2],l[2]=-h*a[2],a[3]-=r[3]*a[2],a[4]-=r[4]*a[2],a[5]-=r[5]*a[2],r=s[3],_=o[3],h=1/r[3],_[3]=h,_[0]*=h,_[1]*=h,_[2]*=h,r[4]*=h,r[5]*=h,a=s[0],l=o[0],l[0]-=_[0]*a[3],a[4]-=r[4]*a[3],a[5]-=r[5]*a[3],a=s[1],l=o[1],l[0]-=_[0]*a[3],l[1]-=_[1]*a[3],a[4]-=r[4]*a[3],a[5]-=r[5]*a[3],a=s[2],l=o[2],l[0]-=_[0]*a[3],l[1]-=_[1]*a[3],l[2]-=_[2]*a[3],a[4]-=r[4]*a[3],a[5]-=r[5]*a[3],a=s[4],l=o[4],l[0]-=_[0]*a[3],l[1]-=_[1]*a[3],l[2]-=_[2]*a[3],l[3]=-h*a[3],a[4]-=r[4]*a[3],a[5]-=r[5]*a[3],a=s[5],l=o[5],l[0]-=_[0]*a[3],l[1]-=_[1]*a[3],l[2]-=_[2]*a[3],l[3]=-h*a[3],a[4]-=r[4]*a[3],a[5]-=r[5]*a[3],r=s[4],_=o[4],h=1/r[4],_[4]=h,_[0]*=h,_[1]*=h,_[2]*=h,_[3]*=h,r[5]*=h,a=s[0],l=o[0],l[0]-=_[0]*a[4],a[5]-=r[5]*a[4],a=s[1],l=o[1],l[0]-=_[0]*a[4],l[1]-=_[1]*a[4],a[5]-=r[5]*a[4],a=s[2],l=o[2],l[0]-=_[0]*a[4],l[1]-=_[1]*a[4],l[2]-=_[2]*a[4],a[5]-=r[5]*a[4],a=s[3],l=o[3],l[0]-=_[0]*a[4],l[1]-=_[1]*a[4],l[2]-=_[2]*a[4],l[3]-=_[3]*a[4],a[5]-=r[5]*a[4],a=s[5],l=o[5],l[0]-=_[0]*a[4],l[1]-=_[1]*a[4],l[2]-=_[2]*a[4],l[3]-=_[3]*a[4],l[4]=-h*a[4],a[5]-=r[5]*a[4],r=s[5],_=o[5],h=1/r[5],_[5]=h,_[0]*=h,_[1]*=h,_[2]*=h,_[3]*=h,_[4]*=h,a=s[0],l=o[0],l[0]-=_[0]*a[5],a=s[1],l=o[1],l[0]-=_[0]*a[5],l[1]-=_[1]*a[5],a=s[2],l=o[2],l[0]-=_[0]*a[5],l[1]-=_[1]*a[5],l[2]-=_[2]*a[5],a=s[3],l=o[3],l[0]-=_[0]*a[5],l[1]-=_[1]*a[5],l[2]-=_[2]*a[5],l[3]-=_[3]*a[5],a=s[4],l=o[4],l[0]-=_[0]*a[5],l[1]-=_[1]*a[5],l[2]-=_[2]*a[5],l[3]-=_[3]*a[5],l[4]-=_[4]*a[5],_=o[1],o[0][1]=_[0],_=o[2],o[0][2]=_[0],o[1][2]=_[1],_=o[3],o[0][3]=_[0],o[1][3]=_[1],o[2][3]=_[2],_=o[4],o[0][4]=_[0],o[1][4]=_[1],o[2][4]=_[2],o[3][4]=_[3],_=o[5],o[0][5]=_[0],o[1][5]=_[1],o[2][5]=_[2],o[3][5]=_[3],o[4][5]=_[4];break;default:let u=0;for(;u<i;){let m=u++;r=s[m],_=o[m];let d=1/r[m];_[m]=d;let p=0;for(;p<m;)_[p++]*=d;let g=m+1;for(;g<i;)r[g++]*=d;let x=0;for(;x<m;){let y=x++;a=s[y],l=o[y];let z=0,M=y+1;for(;z<M;){let X=z++;l[X]-=_[X]*a[m]}let Y=m+1;for(;Y<i;){let X=Y++;a[X]-=r[X]*a[m]}}let b=m+1;for(;b<i;){let y=b++;a=s[y],l=o[y];let z=0;for(;z<m;){let Y=z++;l[Y]-=_[Y]*a[m]}l[m]=-d*a[m];let M=m+1;for(;M<i;){let Y=M++;a[Y]-=r[Y]*a[m]}}}let f=1;for(;f<i;){let m=f++;_=o[m];let d=0;for(;d<m;){let p=d++;o[p][m]=_[p]}}}}computeInvMass(t,e){let i=this._invMass,n=this._invMassWithoutCfm,s=t.numRows,o=t.b1,r=t.b2,_=o._invMass,a=r._invMass,l,h,u,f,m,d,p,g,x,b,y,z,M,Y,X,w,S,V;l=o._invInertia00,h=o._invInertia01,u=o._invInertia02,f=o._invInertia10,m=o._invInertia11,d=o._invInertia12,p=o._invInertia20,g=o._invInertia21,x=o._invInertia22,b=r._invInertia00,y=r._invInertia01,z=r._invInertia02,M=r._invInertia10,Y=r._invInertia11,X=r._invInertia12,w=r._invInertia20,S=r._invInertia21,V=r._invInertia22;let F=0;for(;F<s;){let L=F++,E=t.rows[L].jacobian,T=e[L];if(E.updateSparsity(),(E.flag&1)!=0?(T.invMLin1X=E.lin1X*_,T.invMLin1Y=E.lin1Y*_,T.invMLin1Z=E.lin1Z*_,T.invMLin2X=E.lin2X*a,T.invMLin2Y=E.lin2Y*a,T.invMLin2Z=E.lin2Z*a):(T.invMLin1X=0,T.invMLin1Y=0,T.invMLin1Z=0,T.invMLin2X=0,T.invMLin2Y=0,T.invMLin2Z=0),(E.flag&2)!=0){let P,N,R;P=l*E.ang1X+h*E.ang1Y+u*E.ang1Z,N=f*E.ang1X+m*E.ang1Y+d*E.ang1Z,R=p*E.ang1X+g*E.ang1Y+x*E.ang1Z,T.invMAng1X=P,T.invMAng1Y=N,T.invMAng1Z=R;let k,O,v;k=b*E.ang2X+y*E.ang2Y+z*E.ang2Z,O=M*E.ang2X+Y*E.ang2Y+X*E.ang2Z,v=w*E.ang2X+S*E.ang2Y+V*E.ang2Z,T.invMAng2X=k,T.invMAng2Y=O,T.invMAng2Z=v}else T.invMAng1X=0,T.invMAng1Y=0,T.invMAng1Z=0,T.invMAng2X=0,T.invMAng2Y=0,T.invMAng2Z=0}let C=0;for(;C<s;){let L=C++,E=t.rows[L].jacobian,T=L;for(;T<s;){let P=T++,N=e[P],R=E.lin1X*N.invMLin1X+E.lin1Y*N.invMLin1Y+E.lin1Z*N.invMLin1Z+(E.ang1X*N.invMAng1X+E.ang1Y*N.invMAng1Y+E.ang1Z*N.invMAng1Z)+(E.lin2X*N.invMLin2X+E.lin2Y*N.invMLin2Y+E.lin2Z*N.invMLin2Z)+(E.ang2X*N.invMAng2X+E.ang2Y*N.invMAng2Y+E.ang2Z*N.invMAng2Z);L==P?(i[L][P]=R+t.rows[L].cfm,n[L][P]=R,N.mass=R+t.rows[L].cfm,N.massWithoutCfm=R,N.mass!=0&&(N.mass=1/N.mass),N.massWithoutCfm!=0&&(N.massWithoutCfm=1/N.massWithoutCfm)):(i[L][P]=R,i[P][L]=R,n[L][P]=R,n[P][L]=R)}}let A=0,Z=this._maxSubmatrixId;for(;A<Z;)this._cacheComputed[A++]=!1}};I.dynamics.constraint.solver.pgs||(I.dynamics.constraint.solver.pgs={});I.dynamics.constraint.solver.pgs.PgsContactConstraintSolver=class extends I.dynamics.constraint.ConstraintSolver{constructor(t){super(),this.constraint=t,this.info=new I.dynamics.constraint.info.contact.ContactSolverInfo,this.massData=new Array(I.common.Setting.maxManifoldPoints);let e=0,i=this.massData.length;for(;e<i;)this.massData[e++]=new I.dynamics.constraint.solver.common.ContactSolverMassDataRow}preSolveVelocity(t){this.constraint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2;let e=this._b1._invMass,i=this._b2._invMass,n,s,o,r,_,a,l,h,u,f,m,d,p,g,x,b,y,z;n=this._b1._invInertia00,s=this._b1._invInertia01,o=this._b1._invInertia02,r=this._b1._invInertia10,_=this._b1._invInertia11,a=this._b1._invInertia12,l=this._b1._invInertia20,h=this._b1._invInertia21,u=this._b1._invInertia22,f=this._b2._invInertia00,m=this._b2._invInertia01,d=this._b2._invInertia02,p=this._b2._invInertia10,g=this._b2._invInertia11,x=this._b2._invInertia12,b=this._b2._invInertia20,y=this._b2._invInertia21,z=this._b2._invInertia22;let M=0,Y=this.info.numRows;for(;M<Y;){let X=M++,w=this.info.rows[X],S=this.massData[X],V=w.jacobianN;S.invMLinN1X=V.lin1X*e,S.invMLinN1Y=V.lin1Y*e,S.invMLinN1Z=V.lin1Z*e,S.invMLinN2X=V.lin2X*i,S.invMLinN2Y=V.lin2Y*i,S.invMLinN2Z=V.lin2Z*i;let F,C,A;F=n*V.ang1X+s*V.ang1Y+o*V.ang1Z,C=r*V.ang1X+_*V.ang1Y+a*V.ang1Z,A=l*V.ang1X+h*V.ang1Y+u*V.ang1Z,S.invMAngN1X=F,S.invMAngN1Y=C,S.invMAngN1Z=A;let Z,L,E;Z=f*V.ang2X+m*V.ang2Y+d*V.ang2Z,L=p*V.ang2X+g*V.ang2Y+x*V.ang2Z,E=b*V.ang2X+y*V.ang2Y+z*V.ang2Z,S.invMAngN2X=Z,S.invMAngN2Y=L,S.invMAngN2Z=E,S.massN=e+i+(S.invMAngN1X*V.ang1X+S.invMAngN1Y*V.ang1Y+S.invMAngN1Z*V.ang1Z)+(S.invMAngN2X*V.ang2X+S.invMAngN2Y*V.ang2Y+S.invMAngN2Z*V.ang2Z),S.massN!=0&&(S.massN=1/S.massN);let T=w.jacobianT,P=w.jacobianB;S.invMLinT1X=T.lin1X*e,S.invMLinT1Y=T.lin1Y*e,S.invMLinT1Z=T.lin1Z*e,S.invMLinT2X=T.lin2X*i,S.invMLinT2Y=T.lin2Y*i,S.invMLinT2Z=T.lin2Z*i,S.invMLinB1X=P.lin1X*e,S.invMLinB1Y=P.lin1Y*e,S.invMLinB1Z=P.lin1Z*e,S.invMLinB2X=P.lin2X*i,S.invMLinB2Y=P.lin2Y*i,S.invMLinB2Z=P.lin2Z*i;let N,R,k;N=n*T.ang1X+s*T.ang1Y+o*T.ang1Z,R=r*T.ang1X+_*T.ang1Y+a*T.ang1Z,k=l*T.ang1X+h*T.ang1Y+u*T.ang1Z,S.invMAngT1X=N,S.invMAngT1Y=R,S.invMAngT1Z=k;let O,v,D;O=f*T.ang2X+m*T.ang2Y+d*T.ang2Z,v=p*T.ang2X+g*T.ang2Y+x*T.ang2Z,D=b*T.ang2X+y*T.ang2Y+z*T.ang2Z,S.invMAngT2X=O,S.invMAngT2Y=v,S.invMAngT2Z=D;let B,U,q;B=n*P.ang1X+s*P.ang1Y+o*P.ang1Z,U=r*P.ang1X+_*P.ang1Y+a*P.ang1Z,q=l*P.ang1X+h*P.ang1Y+u*P.ang1Z,S.invMAngB1X=B,S.invMAngB1Y=U,S.invMAngB1Z=q;let tt,Q,nt;tt=f*P.ang2X+m*P.ang2Y+d*P.ang2Z,Q=p*P.ang2X+g*P.ang2Y+x*P.ang2Z,nt=b*P.ang2X+y*P.ang2Y+z*P.ang2Z,S.invMAngB2X=tt,S.invMAngB2Y=Q,S.invMAngB2Z=nt;let H=e+i+(S.invMAngT1X*T.ang1X+S.invMAngT1Y*T.ang1Y+S.invMAngT1Z*T.ang1Z)+(S.invMAngT2X*T.ang2X+S.invMAngT2Y*T.ang2Y+S.invMAngT2Z*T.ang2Z),j=S.invMAngT1X*P.ang1X+S.invMAngT1Y*P.ang1Y+S.invMAngT1Z*P.ang1Z+(S.invMAngT2X*P.ang2X+S.invMAngT2Y*P.ang2Y+S.invMAngT2Z*P.ang2Z),it=e+i+(S.invMAngB1X*P.ang1X+S.invMAngB1Y*P.ang1Y+S.invMAngB1Z*P.ang1Z)+(S.invMAngB2X*P.ang2X+S.invMAngB2Y*P.ang2Y+S.invMAngB2Z*P.ang2Z),et=H*it-j*j;et!=0&&(et=1/et),S.massTB00=it*et,S.massTB01=-j*et,S.massTB10=-j*et,S.massTB11=H*et}}warmStart(t){let e,i,n,s,o,r,_,a,l,h,u,f;e=this._b1._velX,i=this._b1._velY,n=this._b1._velZ,s=this._b2._velX,o=this._b2._velY,r=this._b2._velZ,_=this._b1._angVelX,a=this._b1._angVelY,l=this._b1._angVelZ,h=this._b2._angVelX,u=this._b2._angVelY,f=this._b2._angVelZ;let m=0,d=this.info.numRows;for(;m<d;){let p=m++,g=this.info.rows[p],x=g.impulse,b=this.massData[p],y=g.jacobianT,z=g.jacobianB,M=x.impulseN,Y=x.impulseLX*y.lin1X+x.impulseLY*y.lin1Y+x.impulseLZ*y.lin1Z,X=x.impulseLX*z.lin1X+x.impulseLY*z.lin1Y+x.impulseLZ*z.lin1Z;x.impulseT=Y,x.impulseB=X,x.impulseN*=t.dtRatio,x.impulseT*=t.dtRatio,x.impulseB*=t.dtRatio,e+=b.invMLinN1X*M,i+=b.invMLinN1Y*M,n+=b.invMLinN1Z*M,e+=b.invMLinT1X*Y,i+=b.invMLinT1Y*Y,n+=b.invMLinT1Z*Y,e+=b.invMLinB1X*X,i+=b.invMLinB1Y*X,n+=b.invMLinB1Z*X,s+=b.invMLinN2X*-M,o+=b.invMLinN2Y*-M,r+=b.invMLinN2Z*-M,s+=b.invMLinT2X*-Y,o+=b.invMLinT2Y*-Y,r+=b.invMLinT2Z*-Y,s+=b.invMLinB2X*-X,o+=b.invMLinB2Y*-X,r+=b.invMLinB2Z*-X,_+=b.invMAngN1X*M,a+=b.invMAngN1Y*M,l+=b.invMAngN1Z*M,_+=b.invMAngT1X*Y,a+=b.invMAngT1Y*Y,l+=b.invMAngT1Z*Y,_+=b.invMAngB1X*X,a+=b.invMAngB1Y*X,l+=b.invMAngB1Z*X,h+=b.invMAngN2X*-M,u+=b.invMAngN2Y*-M,f+=b.invMAngN2Z*-M,h+=b.invMAngT2X*-Y,u+=b.invMAngT2Y*-Y,f+=b.invMAngT2Z*-Y,h+=b.invMAngB2X*-X,u+=b.invMAngB2Y*-X,f+=b.invMAngB2Z*-X}this._b1._velX=e,this._b1._velY=i,this._b1._velZ=n,this._b2._velX=s,this._b2._velY=o,this._b2._velZ=r,this._b1._angVelX=_,this._b1._angVelY=a,this._b1._angVelZ=l,this._b2._angVelX=h,this._b2._angVelY=u,this._b2._angVelZ=f}solveVelocity(){let t,e,i,n,s,o,r,_,a,l,h,u;t=this._b1._velX,e=this._b1._velY,i=this._b1._velZ,n=this._b2._velX,s=this._b2._velY,o=this._b2._velZ,r=this._b1._angVelX,_=this._b1._angVelY,a=this._b1._angVelZ,l=this._b2._angVelX,h=this._b2._angVelY,u=this._b2._angVelZ;let f=0,m=this.info.numRows;for(;f<m;){let g=f++,x=this.info.rows[g],b=this.massData[g],y=x.impulse,z=0,M=x.jacobianT;z+=t*M.lin1X+e*M.lin1Y+i*M.lin1Z,z-=n*M.lin2X+s*M.lin2Y+o*M.lin2Z,z+=r*M.ang1X+_*M.ang1Y+a*M.ang1Z,z-=l*M.ang2X+h*M.ang2Y+u*M.ang2Z;let Y=0;M=x.jacobianB,Y+=t*M.lin1X+e*M.lin1Y+i*M.lin1Z,Y-=n*M.lin2X+s*M.lin2Y+o*M.lin2Z,Y+=r*M.ang1X+_*M.ang1Y+a*M.ang1Z,Y-=l*M.ang2X+h*M.ang2Y+u*M.ang2Z;let X=-(z*b.massTB00+Y*b.massTB01),w=-(z*b.massTB10+Y*b.massTB11),S=y.impulseT,V=y.impulseB;y.impulseT+=X,y.impulseB+=w;let F=x.friction*y.impulseN;if(F==0)y.impulseT=0,y.impulseB=0;else{let C=y.impulseT*y.impulseT+y.impulseB*y.impulseB;if(C>F*F){let A=F/Math.sqrt(C);y.impulseT*=A,y.impulseB*=A}}X=y.impulseT-S,w=y.impulseB-V,t+=b.invMLinT1X*X,e+=b.invMLinT1Y*X,i+=b.invMLinT1Z*X,t+=b.invMLinB1X*w,e+=b.invMLinB1Y*w,i+=b.invMLinB1Z*w,n+=b.invMLinT2X*-X,s+=b.invMLinT2Y*-X,o+=b.invMLinT2Z*-X,n+=b.invMLinB2X*-w,s+=b.invMLinB2Y*-w,o+=b.invMLinB2Z*-w,r+=b.invMAngT1X*X,_+=b.invMAngT1Y*X,a+=b.invMAngT1Z*X,r+=b.invMAngB1X*w,_+=b.invMAngB1Y*w,a+=b.invMAngB1Z*w,l+=b.invMAngT2X*-X,h+=b.invMAngT2Y*-X,u+=b.invMAngT2Z*-X,l+=b.invMAngB2X*-w,h+=b.invMAngB2Y*-w,u+=b.invMAngB2Z*-w}let d=0,p=this.info.numRows;for(;d<p;){let g=d++,x=this.info.rows[g],b=this.massData[g],y=x.impulse,z=0,M=x.jacobianN;z+=t*M.lin1X+e*M.lin1Y+i*M.lin1Z,z-=n*M.lin2X+s*M.lin2Y+o*M.lin2Z,z+=r*M.ang1X+_*M.ang1Y+a*M.ang1Z,z-=l*M.ang2X+h*M.ang2Y+u*M.ang2Z;let Y=(x.rhs-z)*b.massN,X=y.impulseN;y.impulseN+=Y,y.impulseN<0&&(y.impulseN=0),Y=y.impulseN-X,t+=b.invMLinN1X*Y,e+=b.invMLinN1Y*Y,i+=b.invMLinN1Z*Y,n+=b.invMLinN2X*-Y,s+=b.invMLinN2Y*-Y,o+=b.invMLinN2Z*-Y,r+=b.invMAngN1X*Y,_+=b.invMAngN1Y*Y,a+=b.invMAngN1Z*Y,l+=b.invMAngN2X*-Y,h+=b.invMAngN2Y*-Y,u+=b.invMAngN2Z*-Y}this._b1._velX=t,this._b1._velY=e,this._b1._velZ=i,this._b2._velX=n,this._b2._velY=s,this._b2._velZ=o,this._b1._angVelX=r,this._b1._angVelY=_,this._b1._angVelZ=a,this._b2._angVelX=l,this._b2._angVelY=h,this._b2._angVelZ=u}preSolvePosition(t){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);let e=this._b1._invMass,i=this._b2._invMass,n,s,o,r,_,a,l,h,u,f,m,d,p,g,x,b,y,z;n=this._b1._invInertia00,s=this._b1._invInertia01,o=this._b1._invInertia02,r=this._b1._invInertia10,_=this._b1._invInertia11,a=this._b1._invInertia12,l=this._b1._invInertia20,h=this._b1._invInertia21,u=this._b1._invInertia22,f=this._b2._invInertia00,m=this._b2._invInertia01,d=this._b2._invInertia02,p=this._b2._invInertia10,g=this._b2._invInertia11,x=this._b2._invInertia12,b=this._b2._invInertia20,y=this._b2._invInertia21,z=this._b2._invInertia22;let M=0,Y=this.info.numRows;for(;M<Y;){let S=M++,V=this.massData[S],F=this.info.rows[S].jacobianN;V.invMLinN1X=F.lin1X*e,V.invMLinN1Y=F.lin1Y*e,V.invMLinN1Z=F.lin1Z*e,V.invMLinN2X=F.lin2X*i,V.invMLinN2Y=F.lin2Y*i,V.invMLinN2Z=F.lin2Z*i;let C,A,Z;C=n*F.ang1X+s*F.ang1Y+o*F.ang1Z,A=r*F.ang1X+_*F.ang1Y+a*F.ang1Z,Z=l*F.ang1X+h*F.ang1Y+u*F.ang1Z,V.invMAngN1X=C,V.invMAngN1Y=A,V.invMAngN1Z=Z;let L,E,T;L=f*F.ang2X+m*F.ang2Y+d*F.ang2Z,E=p*F.ang2X+g*F.ang2Y+x*F.ang2Z,T=b*F.ang2X+y*F.ang2Y+z*F.ang2Z,V.invMAngN2X=L,V.invMAngN2Y=E,V.invMAngN2Z=T,V.massN=e+i+(V.invMAngN1X*F.ang1X+V.invMAngN1Y*F.ang1Y+V.invMAngN1Z*F.ang1Z)+(V.invMAngN2X*F.ang2X+V.invMAngN2Y*F.ang2Y+V.invMAngN2Z*F.ang2Z),V.massN!=0&&(V.massN=1/V.massN)}let X=0,w=this.info.numRows;for(;X<w;)this.info.rows[X++].impulse.impulseP=0}solvePositionSplitImpulse(){let t,e,i,n,s,o,r,_,a,l,h,u;t=this._b1._pseudoVelX,e=this._b1._pseudoVelY,i=this._b1._pseudoVelZ,n=this._b2._pseudoVelX,s=this._b2._pseudoVelY,o=this._b2._pseudoVelZ,r=this._b1._angPseudoVelX,_=this._b1._angPseudoVelY,a=this._b1._angPseudoVelZ,l=this._b2._angPseudoVelX,h=this._b2._angPseudoVelY,u=this._b2._angPseudoVelZ;let f=0,m=this.info.numRows;for(;f<m;){let d=f++,p=this.info.rows[d],g=this.massData[d],x=p.impulse,b=p.jacobianN,y=0;y+=t*b.lin1X+e*b.lin1Y+i*b.lin1Z,y-=n*b.lin2X+s*b.lin2Y+o*b.lin2Z,y+=r*b.ang1X+_*b.ang1Y+a*b.ang1Z,y-=l*b.ang2X+h*b.ang2Y+u*b.ang2Z;let z=(p.rhs-y)*g.massN*I.common.Setting.positionSplitImpulseBaumgarte,M=x.impulseP;x.impulseP+=z,x.impulseP<0&&(x.impulseP=0),z=x.impulseP-M,t+=g.invMLinN1X*z,e+=g.invMLinN1Y*z,i+=g.invMLinN1Z*z,n+=g.invMLinN2X*-z,s+=g.invMLinN2Y*-z,o+=g.invMLinN2Z*-z,r+=g.invMAngN1X*z,_+=g.invMAngN1Y*z,a+=g.invMAngN1Z*z,l+=g.invMAngN2X*-z,h+=g.invMAngN2Y*-z,u+=g.invMAngN2Z*-z}this._b1._pseudoVelX=t,this._b1._pseudoVelY=e,this._b1._pseudoVelZ=i,this._b2._pseudoVelX=n,this._b2._pseudoVelY=s,this._b2._pseudoVelZ=o,this._b1._angPseudoVelX=r,this._b1._angPseudoVelY=_,this._b1._angPseudoVelZ=a,this._b2._angPseudoVelX=l,this._b2._angPseudoVelY=h,this._b2._angPseudoVelZ=u}solvePositionNgs(t){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);let e=this._b1._invMass,i=this._b2._invMass,n,s,o,r,_,a,l,h,u,f,m,d,p,g,x,b,y,z;n=this._b1._invInertia00,s=this._b1._invInertia01,o=this._b1._invInertia02,r=this._b1._invInertia10,_=this._b1._invInertia11,a=this._b1._invInertia12,l=this._b1._invInertia20,h=this._b1._invInertia21,u=this._b1._invInertia22,f=this._b2._invInertia00,m=this._b2._invInertia01,d=this._b2._invInertia02,p=this._b2._invInertia10,g=this._b2._invInertia11,x=this._b2._invInertia12,b=this._b2._invInertia20,y=this._b2._invInertia21,z=this._b2._invInertia22;let M=0,Y=this.info.numRows;for(;M<Y;){let Be=M++,ve=this.massData[Be],qt=this.info.rows[Be].jacobianN;ve.invMLinN1X=qt.lin1X*e,ve.invMLinN1Y=qt.lin1Y*e,ve.invMLinN1Z=qt.lin1Z*e,ve.invMLinN2X=qt.lin2X*i,ve.invMLinN2Y=qt.lin2Y*i,ve.invMLinN2Z=qt.lin2Z*i;let Jt,xe,Kt;Jt=n*qt.ang1X+s*qt.ang1Y+o*qt.ang1Z,xe=r*qt.ang1X+_*qt.ang1Y+a*qt.ang1Z,Kt=l*qt.ang1X+h*qt.ang1Y+u*qt.ang1Z,ve.invMAngN1X=Jt,ve.invMAngN1Y=xe,ve.invMAngN1Z=Kt;let It,Et,Qt;It=f*qt.ang2X+m*qt.ang2Y+d*qt.ang2Z,Et=p*qt.ang2X+g*qt.ang2Y+x*qt.ang2Z,Qt=b*qt.ang2X+y*qt.ang2Y+z*qt.ang2Z,ve.invMAngN2X=It,ve.invMAngN2Y=Et,ve.invMAngN2Z=Qt,ve.massN=e+i+(ve.invMAngN1X*qt.ang1X+ve.invMAngN1Y*qt.ang1Y+ve.invMAngN1Z*qt.ang1Z)+(ve.invMAngN2X*qt.ang2X+ve.invMAngN2Y*qt.ang2Y+ve.invMAngN2Z*qt.ang2Z),ve.massN!=0&&(ve.massN=1/ve.massN)}let X,w,S,V,F,C,A,Z,L,E,T,P;X=0,w=0,S=0,V=0,F=0,C=0,A=0,Z=0,L=0,E=0,T=0,P=0;let N=0,R=this.info.numRows;for(;N<R;){let Be=N++,ve=this.info.rows[Be],qt=this.massData[Be],Jt=ve.impulse,xe=ve.jacobianN,Kt=0;Kt+=X*xe.lin1X+w*xe.lin1Y+S*xe.lin1Z,Kt-=V*xe.lin2X+F*xe.lin2Y+C*xe.lin2Z,Kt+=A*xe.ang1X+Z*xe.ang1Y+L*xe.ang1Z,Kt-=E*xe.ang2X+T*xe.ang2Y+P*xe.ang2Z;let It=(ve.rhs-Kt)*qt.massN*I.common.Setting.positionNgsBaumgarte,Et=Jt.impulseP;Jt.impulseP+=It,Jt.impulseP<0&&(Jt.impulseP=0),It=Jt.impulseP-Et,X+=qt.invMLinN1X*It,w+=qt.invMLinN1Y*It,S+=qt.invMLinN1Z*It,V+=qt.invMLinN2X*-It,F+=qt.invMLinN2Y*-It,C+=qt.invMLinN2Z*-It,A+=qt.invMAngN1X*It,Z+=qt.invMAngN1Y*It,L+=qt.invMAngN1Z*It,E+=qt.invMAngN2X*-It,T+=qt.invMAngN2Y*-It,P+=qt.invMAngN2Z*-It}let k=this._b1;k._transform._positionX+=X,k._transform._positionY+=w,k._transform._positionZ+=S;let O=this._b2;O._transform._positionX+=V,O._transform._positionY+=F,O._transform._positionZ+=C;let v=this._b1,D=Math.sqrt(A*A+Z*Z+L*L),B=D*.5,U,q;if(B<.5){let Be=B*B;U=.5*(1-Be*.16666666666666666+Be*Be*.008333333333333333),q=1-Be*.5+Be*Be*.041666666666666664}else U=Math.sin(B)/D,q=Math.cos(B);let tt,Q,nt;tt=A*U,Q=Z*U,nt=L*U;let H,j,it,et;H=tt,j=Q,it=nt,et=q;let G,W,lt,ht,ft=v._transform._rotation00,pt=v._transform._rotation11,K=v._transform._rotation22,J=ft+pt+K,rt;J>0?(rt=Math.sqrt(J+1),ht=.5*rt,rt=.5/rt,G=(v._transform._rotation21-v._transform._rotation12)*rt,W=(v._transform._rotation02-v._transform._rotation20)*rt,lt=(v._transform._rotation10-v._transform._rotation01)*rt):ft>pt?ft>K?(rt=Math.sqrt(ft-pt-K+1),G=.5*rt,rt=.5/rt,W=(v._transform._rotation01+v._transform._rotation10)*rt,lt=(v._transform._rotation02+v._transform._rotation20)*rt,ht=(v._transform._rotation21-v._transform._rotation12)*rt):(rt=Math.sqrt(K-ft-pt+1),lt=.5*rt,rt=.5/rt,G=(v._transform._rotation02+v._transform._rotation20)*rt,W=(v._transform._rotation12+v._transform._rotation21)*rt,ht=(v._transform._rotation10-v._transform._rotation01)*rt):pt>K?(rt=Math.sqrt(pt-K-ft+1),W=.5*rt,rt=.5/rt,G=(v._transform._rotation01+v._transform._rotation10)*rt,lt=(v._transform._rotation12+v._transform._rotation21)*rt,ht=(v._transform._rotation02-v._transform._rotation20)*rt):(rt=Math.sqrt(K-ft-pt+1),lt=.5*rt,rt=.5/rt,G=(v._transform._rotation02+v._transform._rotation20)*rt,W=(v._transform._rotation12+v._transform._rotation21)*rt,ht=(v._transform._rotation10-v._transform._rotation01)*rt),G=et*G+H*ht+j*lt-it*W,W=et*W-H*lt+j*ht+it*G,lt=et*lt+H*W-j*G+it*ht,ht=et*ht-H*G-j*W-it*lt;let mt=G*G+W*W+lt*lt+ht*ht;mt>1e-32&&(mt=1/Math.sqrt(mt)),G*=mt,W*=mt,lt*=mt,ht*=mt;let xt=G,vt=W,Mt=lt,ut=ht,Zt=2*xt,zt=2*vt,dt=2*Mt,st=xt*Zt,ct=vt*zt,_t=Mt*dt,Vt=xt*zt,At=vt*dt,St=xt*dt,Xt=ut*Zt,Ft=ut*zt,ie=ut*dt;v._transform._rotation00=1-ct-_t,v._transform._rotation01=Vt-ie,v._transform._rotation02=St+Ft,v._transform._rotation10=Vt+ie,v._transform._rotation11=1-st-_t,v._transform._rotation12=At-Xt,v._transform._rotation20=St-Ft,v._transform._rotation21=At+Xt,v._transform._rotation22=1-st-ct;let ee,Ye,Ie,ue,$t,Ht,me,ze,qe;ee=v._transform._rotation00*v._invLocalInertia00+v._transform._rotation01*v._invLocalInertia10+v._transform._rotation02*v._invLocalInertia20,Ye=v._transform._rotation00*v._invLocalInertia01+v._transform._rotation01*v._invLocalInertia11+v._transform._rotation02*v._invLocalInertia21,Ie=v._transform._rotation00*v._invLocalInertia02+v._transform._rotation01*v._invLocalInertia12+v._transform._rotation02*v._invLocalInertia22,ue=v._transform._rotation10*v._invLocalInertia00+v._transform._rotation11*v._invLocalInertia10+v._transform._rotation12*v._invLocalInertia20,$t=v._transform._rotation10*v._invLocalInertia01+v._transform._rotation11*v._invLocalInertia11+v._transform._rotation12*v._invLocalInertia21,Ht=v._transform._rotation10*v._invLocalInertia02+v._transform._rotation11*v._invLocalInertia12+v._transform._rotation12*v._invLocalInertia22,me=v._transform._rotation20*v._invLocalInertia00+v._transform._rotation21*v._invLocalInertia10+v._transform._rotation22*v._invLocalInertia20,ze=v._transform._rotation20*v._invLocalInertia01+v._transform._rotation21*v._invLocalInertia11+v._transform._rotation22*v._invLocalInertia21,qe=v._transform._rotation20*v._invLocalInertia02+v._transform._rotation21*v._invLocalInertia12+v._transform._rotation22*v._invLocalInertia22,v._invInertia00=ee,v._invInertia01=Ye,v._invInertia02=Ie,v._invInertia10=ue,v._invInertia11=$t,v._invInertia12=Ht,v._invInertia20=me,v._invInertia21=ze,v._invInertia22=qe;let Ee,Ut,at,gt,yt,bt,ot,Pt,Dt;Ee=v._invInertia00*v._transform._rotation00+v._invInertia01*v._transform._rotation01+v._invInertia02*v._transform._rotation02,Ut=v._invInertia00*v._transform._rotation10+v._invInertia01*v._transform._rotation11+v._invInertia02*v._transform._rotation12,at=v._invInertia00*v._transform._rotation20+v._invInertia01*v._transform._rotation21+v._invInertia02*v._transform._rotation22,gt=v._invInertia10*v._transform._rotation00+v._invInertia11*v._transform._rotation01+v._invInertia12*v._transform._rotation02,yt=v._invInertia10*v._transform._rotation10+v._invInertia11*v._transform._rotation11+v._invInertia12*v._transform._rotation12,bt=v._invInertia10*v._transform._rotation20+v._invInertia11*v._transform._rotation21+v._invInertia12*v._transform._rotation22,ot=v._invInertia20*v._transform._rotation00+v._invInertia21*v._transform._rotation01+v._invInertia22*v._transform._rotation02,Pt=v._invInertia20*v._transform._rotation10+v._invInertia21*v._transform._rotation11+v._invInertia22*v._transform._rotation12,Dt=v._invInertia20*v._transform._rotation20+v._invInertia21*v._transform._rotation21+v._invInertia22*v._transform._rotation22,v._invInertia00=Ee,v._invInertia01=Ut,v._invInertia02=at,v._invInertia10=gt,v._invInertia11=yt,v._invInertia12=bt,v._invInertia20=ot,v._invInertia21=Pt,v._invInertia22=Dt,v._invInertia00*=v._rotFactor.x,v._invInertia01*=v._rotFactor.x,v._invInertia02*=v._rotFactor.x,v._invInertia10*=v._rotFactor.y,v._invInertia11*=v._rotFactor.y,v._invInertia12*=v._rotFactor.y,v._invInertia20*=v._rotFactor.z,v._invInertia21*=v._rotFactor.z,v._invInertia22*=v._rotFactor.z;let $=this._b2,kt=Math.sqrt(E*E+T*T+P*P),Rt=kt*.5,Ot,Wt;if(Rt<.5){let Be=Rt*Rt;Ot=.5*(1-Be*.16666666666666666+Be*Be*.008333333333333333),Wt=1-Be*.5+Be*Be*.041666666666666664}else Ot=Math.sin(Rt)/kt,Wt=Math.cos(Rt);let Bt,re,Ce;Bt=E*Ot,re=T*Ot,Ce=P*Ot;let be,Tt,Lt,Yt;be=Bt,Tt=re,Lt=Ce,Yt=Wt;let pe,Me,fe,ti,di=$._transform._rotation00,Le=$._transform._rotation11,_i=$._transform._rotation22,yi=di+Le+_i,he;yi>0?(he=Math.sqrt(yi+1),ti=.5*he,he=.5/he,pe=($._transform._rotation21-$._transform._rotation12)*he,Me=($._transform._rotation02-$._transform._rotation20)*he,fe=($._transform._rotation10-$._transform._rotation01)*he):di>Le?di>_i?(he=Math.sqrt(di-Le-_i+1),pe=.5*he,he=.5/he,Me=($._transform._rotation01+$._transform._rotation10)*he,fe=($._transform._rotation02+$._transform._rotation20)*he,ti=($._transform._rotation21-$._transform._rotation12)*he):(he=Math.sqrt(_i-di-Le+1),fe=.5*he,he=.5/he,pe=($._transform._rotation02+$._transform._rotation20)*he,Me=($._transform._rotation12+$._transform._rotation21)*he,ti=($._transform._rotation10-$._transform._rotation01)*he):Le>_i?(he=Math.sqrt(Le-_i-di+1),Me=.5*he,he=.5/he,pe=($._transform._rotation01+$._transform._rotation10)*he,fe=($._transform._rotation12+$._transform._rotation21)*he,ti=($._transform._rotation02-$._transform._rotation20)*he):(he=Math.sqrt(_i-di-Le+1),fe=.5*he,he=.5/he,pe=($._transform._rotation02+$._transform._rotation20)*he,Me=($._transform._rotation12+$._transform._rotation21)*he,ti=($._transform._rotation10-$._transform._rotation01)*he),pe=Yt*pe+be*ti+Tt*fe-Lt*Me,Me=Yt*Me-be*fe+Tt*ti+Lt*pe,fe=Yt*fe+be*Me-Tt*pe+Lt*ti,ti=Yt*ti-be*pe-Tt*Me-Lt*fe;let gi=pe*pe+Me*Me+fe*fe+ti*ti;gi>1e-32&&(gi=1/Math.sqrt(gi)),pe*=gi,Me*=gi,fe*=gi,ti*=gi;let bi=pe,Mi=Me,Si=fe,He=ti,Je=2*bi,Qe=2*Mi,ci=2*Si,hi=bi*Je,ei=Mi*Qe,ai=Si*ci,Ke=bi*Qe,We=Mi*ci,ke=bi*ci,le=He*Je,ge=He*Qe,jt=He*ci;$._transform._rotation00=1-ei-ai,$._transform._rotation01=Ke-jt,$._transform._rotation02=ke+ge,$._transform._rotation10=Ke+jt,$._transform._rotation11=1-hi-ai,$._transform._rotation12=We-le,$._transform._rotation20=ke-ge,$._transform._rotation21=We+le,$._transform._rotation22=1-hi-ei;let Ae,Ze,Re,Te,Fe,se,Ct,Gt,Pe;Ae=$._transform._rotation00*$._invLocalInertia00+$._transform._rotation01*$._invLocalInertia10+$._transform._rotation02*$._invLocalInertia20,Ze=$._transform._rotation00*$._invLocalInertia01+$._transform._rotation01*$._invLocalInertia11+$._transform._rotation02*$._invLocalInertia21,Re=$._transform._rotation00*$._invLocalInertia02+$._transform._rotation01*$._invLocalInertia12+$._transform._rotation02*$._invLocalInertia22,Te=$._transform._rotation10*$._invLocalInertia00+$._transform._rotation11*$._invLocalInertia10+$._transform._rotation12*$._invLocalInertia20,Fe=$._transform._rotation10*$._invLocalInertia01+$._transform._rotation11*$._invLocalInertia11+$._transform._rotation12*$._invLocalInertia21,se=$._transform._rotation10*$._invLocalInertia02+$._transform._rotation11*$._invLocalInertia12+$._transform._rotation12*$._invLocalInertia22,Ct=$._transform._rotation20*$._invLocalInertia00+$._transform._rotation21*$._invLocalInertia10+$._transform._rotation22*$._invLocalInertia20,Gt=$._transform._rotation20*$._invLocalInertia01+$._transform._rotation21*$._invLocalInertia11+$._transform._rotation22*$._invLocalInertia21,Pe=$._transform._rotation20*$._invLocalInertia02+$._transform._rotation21*$._invLocalInertia12+$._transform._rotation22*$._invLocalInertia22,$._invInertia00=Ae,$._invInertia01=Ze,$._invInertia02=Re,$._invInertia10=Te,$._invInertia11=Fe,$._invInertia12=se,$._invInertia20=Ct,$._invInertia21=Gt,$._invInertia22=Pe;let Ve,Ue,ii,ri,mi,xi,ce,Ge,we;Ve=$._invInertia00*$._transform._rotation00+$._invInertia01*$._transform._rotation01+$._invInertia02*$._transform._rotation02,Ue=$._invInertia00*$._transform._rotation10+$._invInertia01*$._transform._rotation11+$._invInertia02*$._transform._rotation12,ii=$._invInertia00*$._transform._rotation20+$._invInertia01*$._transform._rotation21+$._invInertia02*$._transform._rotation22,ri=$._invInertia10*$._transform._rotation00+$._invInertia11*$._transform._rotation01+$._invInertia12*$._transform._rotation02,mi=$._invInertia10*$._transform._rotation10+$._invInertia11*$._transform._rotation11+$._invInertia12*$._transform._rotation12,xi=$._invInertia10*$._transform._rotation20+$._invInertia11*$._transform._rotation21+$._invInertia12*$._transform._rotation22,ce=$._invInertia20*$._transform._rotation00+$._invInertia21*$._transform._rotation01+$._invInertia22*$._transform._rotation02,Ge=$._invInertia20*$._transform._rotation10+$._invInertia21*$._transform._rotation11+$._invInertia22*$._transform._rotation12,we=$._invInertia20*$._transform._rotation20+$._invInertia21*$._transform._rotation21+$._invInertia22*$._transform._rotation22,$._invInertia00=Ve,$._invInertia01=Ue,$._invInertia02=ii,$._invInertia10=ri,$._invInertia11=mi,$._invInertia12=xi,$._invInertia20=ce,$._invInertia21=Ge,$._invInertia22=we,$._invInertia00*=$._rotFactor.x,$._invInertia01*=$._rotFactor.x,$._invInertia02*=$._rotFactor.x,$._invInertia10*=$._rotFactor.y,$._invInertia11*=$._rotFactor.y,$._invInertia12*=$._rotFactor.y,$._invInertia20*=$._rotFactor.z,$._invInertia21*=$._rotFactor.z,$._invInertia22*=$._rotFactor.z}postSolve(){let t,e,i,n,s,o,r,_,a;t=0,e=0,i=0,n=0,s=0,o=0,r=0,_=0,a=0;let l=0,h=this.info.numRows;for(;l<h;){let u=this.info.rows[l++],f=u.impulse,m=u.jacobianN,d=u.jacobianT,p=u.jacobianB,g=f.impulseN,x=f.impulseT,b=f.impulseB,y,z,M;y=0,z=0,M=0,y+=d.lin1X*x,z+=d.lin1Y*x,M+=d.lin1Z*x,y+=p.lin1X*b,z+=p.lin1Y*b,M+=p.lin1Z*b,f.impulseLX=y,f.impulseLY=z,f.impulseLZ=M,t+=m.lin1X*g,e+=m.lin1Y*g,i+=m.lin1Z*g,n+=m.ang1X*g,s+=m.ang1Y*g,o+=m.ang1Z*g,r+=m.ang2X*g,_+=m.ang2Y*g,a+=m.ang2Z*g,t+=d.lin1X*x,e+=d.lin1Y*x,i+=d.lin1Z*x,n+=d.ang1X*x,s+=d.ang1Y*x,o+=d.ang1Z*x,r+=d.ang2X*x,_+=d.ang2Y*x,a+=d.ang2Z*x,t+=p.lin1X*b,e+=p.lin1Y*b,i+=p.lin1Z*b,n+=p.ang1X*b,s+=p.ang1Y*b,o+=p.ang1Z*b,r+=p.ang2X*b,_+=p.ang2Y*b,a+=p.ang2Z*b}this._b1._linearContactImpulseX+=t,this._b1._linearContactImpulseY+=e,this._b1._linearContactImpulseZ+=i,this._b1._angularContactImpulseX+=n,this._b1._angularContactImpulseY+=s,this._b1._angularContactImpulseZ+=o,this._b2._linearContactImpulseX-=t,this._b2._linearContactImpulseY-=e,this._b2._linearContactImpulseZ-=i,this._b2._angularContactImpulseX-=r,this._b2._angularContactImpulseY-=_,this._b2._angularContactImpulseZ-=a,this.constraint._syncManifold()}};I.dynamics.constraint.solver.pgs.PgsJointConstraintSolver=class extends I.dynamics.constraint.ConstraintSolver{constructor(t){super(),this.joint=t,this.info=new I.dynamics.constraint.info.joint.JointSolverInfo,this.massData=new Array(I.common.Setting.maxJacobianRows);let e=0,i=this.massData.length;for(;e<i;)this.massData[e++]=new I.dynamics.constraint.solver.common.JointSolverMassDataRow}preSolveVelocity(t){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2;let e=this._b1._invMass,i=this._b2._invMass,n,s,o,r,_,a,l,h,u,f,m,d,p,g,x,b,y,z;n=this._b1._invInertia00,s=this._b1._invInertia01,o=this._b1._invInertia02,r=this._b1._invInertia10,_=this._b1._invInertia11,a=this._b1._invInertia12,l=this._b1._invInertia20,h=this._b1._invInertia21,u=this._b1._invInertia22,f=this._b2._invInertia00,m=this._b2._invInertia01,d=this._b2._invInertia02,p=this._b2._invInertia10,g=this._b2._invInertia11,x=this._b2._invInertia12,b=this._b2._invInertia20,y=this._b2._invInertia21,z=this._b2._invInertia22;let M=0,Y=this.info.numRows;for(;M<Y;){let X=M++,w=this.info.rows[X],S=this.massData[X],V=w.jacobian;if(V.updateSparsity(),(V.flag&1)!=0?(S.invMLin1X=V.lin1X*e,S.invMLin1Y=V.lin1Y*e,S.invMLin1Z=V.lin1Z*e,S.invMLin2X=V.lin2X*i,S.invMLin2Y=V.lin2Y*i,S.invMLin2Z=V.lin2Z*i):(S.invMLin1X=0,S.invMLin1Y=0,S.invMLin1Z=0,S.invMLin2X=0,S.invMLin2Y=0,S.invMLin2Z=0),(V.flag&2)!=0){let F,C,A;F=n*V.ang1X+s*V.ang1Y+o*V.ang1Z,C=r*V.ang1X+_*V.ang1Y+a*V.ang1Z,A=l*V.ang1X+h*V.ang1Y+u*V.ang1Z,S.invMAng1X=F,S.invMAng1Y=C,S.invMAng1Z=A;let Z,L,E;Z=f*V.ang2X+m*V.ang2Y+d*V.ang2Z,L=p*V.ang2X+g*V.ang2Y+x*V.ang2Z,E=b*V.ang2X+y*V.ang2Y+z*V.ang2Z,S.invMAng2X=Z,S.invMAng2Y=L,S.invMAng2Z=E}else S.invMAng1X=0,S.invMAng1Y=0,S.invMAng1Z=0,S.invMAng2X=0,S.invMAng2Y=0,S.invMAng2Z=0;S.massWithoutCfm=S.invMLin1X*V.lin1X+S.invMLin1Y*V.lin1Y+S.invMLin1Z*V.lin1Z+(S.invMLin2X*V.lin2X+S.invMLin2Y*V.lin2Y+S.invMLin2Z*V.lin2Z)+(S.invMAng1X*V.ang1X+S.invMAng1Y*V.ang1Y+S.invMAng1Z*V.ang1Z)+(S.invMAng2X*V.ang2X+S.invMAng2Y*V.ang2Y+S.invMAng2Z*V.ang2Z),S.mass=S.massWithoutCfm+w.cfm,S.massWithoutCfm!=0&&(S.massWithoutCfm=1/S.massWithoutCfm),S.mass!=0&&(S.mass=1/S.mass)}}warmStart(t){let e=this.joint._positionCorrectionAlgorithm==I.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?I.common.Setting.jointWarmStartingFactorForBaungarte:I.common.Setting.jointWarmStartingFactor;if(e*=t.dtRatio,e<=0){let g=0,x=this.info.numRows;for(;g<x;){let b=this.info.rows[g++].impulse;b.impulse=0,b.impulseM=0,b.impulseP=0}return}let i,n,s,o,r,_,a,l,h,u,f,m;i=this._b1._velX,n=this._b1._velY,s=this._b1._velZ,o=this._b2._velX,r=this._b2._velY,_=this._b2._velZ,a=this._b1._angVelX,l=this._b1._angVelY,h=this._b1._angVelZ,u=this._b2._angVelX,f=this._b2._angVelY,m=this._b2._angVelZ;let d=0,p=this.info.numRows;for(;d<p;){let g=d++,x=this.massData[g],b=this.info.rows[g].impulse;b.impulse*=e,b.impulseM*=e;let y=b.impulse+b.impulseM;i+=x.invMLin1X*y,n+=x.invMLin1Y*y,s+=x.invMLin1Z*y,o+=x.invMLin2X*-y,r+=x.invMLin2Y*-y,_+=x.invMLin2Z*-y,a+=x.invMAng1X*y,l+=x.invMAng1Y*y,h+=x.invMAng1Z*y,u+=x.invMAng2X*-y,f+=x.invMAng2Y*-y,m+=x.invMAng2Z*-y}this._b1._velX=i,this._b1._velY=n,this._b1._velZ=s,this._b2._velX=o,this._b2._velY=r,this._b2._velZ=_,this._b1._angVelX=a,this._b1._angVelY=l,this._b1._angVelZ=h,this._b2._angVelX=u,this._b2._angVelY=f,this._b2._angVelZ=m}solveVelocity(){let t,e,i,n,s,o,r,_,a,l,h,u;t=this._b1._velX,e=this._b1._velY,i=this._b1._velZ,n=this._b2._velX,s=this._b2._velY,o=this._b2._velZ,r=this._b1._angVelX,_=this._b1._angVelY,a=this._b1._angVelZ,l=this._b2._angVelX,h=this._b2._angVelY,u=this._b2._angVelZ;let f=0,m=this.info.numRows;for(;f<m;){let g=f++,x=this.info.rows[g],b=this.massData[g],y=x.impulse,z=x.jacobian;if(x.motorMaxImpulse==0)continue;let M=0;M+=t*z.lin1X+e*z.lin1Y+i*z.lin1Z,M-=n*z.lin2X+s*z.lin2Y+o*z.lin2Z,M+=r*z.ang1X+_*z.ang1Y+a*z.ang1Z,M-=l*z.ang2X+h*z.ang2Y+u*z.ang2Z;let Y=(-x.motorSpeed-M)*b.massWithoutCfm,X=y.impulseM;y.impulseM+=Y,y.impulseM<-x.motorMaxImpulse?y.impulseM=-x.motorMaxImpulse:y.impulseM>x.motorMaxImpulse&&(y.impulseM=x.motorMaxImpulse),Y=y.impulseM-X,(z.flag&1)!=0&&(t+=b.invMLin1X*Y,e+=b.invMLin1Y*Y,i+=b.invMLin1Z*Y,n+=b.invMLin2X*-Y,s+=b.invMLin2Y*-Y,o+=b.invMLin2Z*-Y),(z.flag&2)!=0&&(r+=b.invMAng1X*Y,_+=b.invMAng1Y*Y,a+=b.invMAng1Z*Y,l+=b.invMAng2X*-Y,h+=b.invMAng2Y*-Y,u+=b.invMAng2Z*-Y)}let d=0,p=this.info.numRows;for(;d<p;){let g=d++,x=this.info.rows[g],b=this.massData[g],y=x.impulse,z=x.jacobian,M=0;M+=t*z.lin1X+e*z.lin1Y+i*z.lin1Z,M-=n*z.lin2X+s*z.lin2Y+o*z.lin2Z,M+=r*z.ang1X+_*z.ang1Y+a*z.ang1Z,M-=l*z.ang2X+h*z.ang2Y+u*z.ang2Z;let Y=(x.rhs-M-y.impulse*x.cfm)*b.mass,X=y.impulse;y.impulse+=Y,y.impulse<x.minImpulse?y.impulse=x.minImpulse:y.impulse>x.maxImpulse&&(y.impulse=x.maxImpulse),Y=y.impulse-X,(z.flag&1)!=0&&(t+=b.invMLin1X*Y,e+=b.invMLin1Y*Y,i+=b.invMLin1Z*Y,n+=b.invMLin2X*-Y,s+=b.invMLin2Y*-Y,o+=b.invMLin2Z*-Y),(z.flag&2)!=0&&(r+=b.invMAng1X*Y,_+=b.invMAng1Y*Y,a+=b.invMAng1Z*Y,l+=b.invMAng2X*-Y,h+=b.invMAng2Y*-Y,u+=b.invMAng2Z*-Y)}this._b1._velX=t,this._b1._velY=e,this._b1._velZ=i,this._b2._velX=n,this._b2._velY=s,this._b2._velZ=o,this._b1._angVelX=r,this._b1._angVelY=_,this._b1._angVelZ=a,this._b2._angVelX=l,this._b2._angVelY=h,this._b2._angVelZ=u}postSolveVelocity(t){let e,i,n,s,o,r;e=0,i=0,n=0,s=0,o=0,r=0;let _=0,a=this.info.numRows;for(;_<a;){let l=this.info.rows[_++],h=l.impulse,u=l.jacobian;(u.flag&1)!=0?(e+=u.lin1X*h.impulse,i+=u.lin1Y*h.impulse,n+=u.lin1Z*h.impulse):(u.flag&2)!=0&&(s+=u.ang1X*h.impulse,o+=u.ang1Y*h.impulse,r+=u.ang1Z*h.impulse)}this.joint._appliedForceX=e*t.invDt,this.joint._appliedForceY=i*t.invDt,this.joint._appliedForceZ=n*t.invDt,this.joint._appliedTorqueX=s*t.invDt,this.joint._appliedTorqueY=o*t.invDt,this.joint._appliedTorqueZ=r*t.invDt}preSolvePosition(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;let e=this._b1._invMass,i=this._b2._invMass,n,s,o,r,_,a,l,h,u,f,m,d,p,g,x,b,y,z;n=this._b1._invInertia00,s=this._b1._invInertia01,o=this._b1._invInertia02,r=this._b1._invInertia10,_=this._b1._invInertia11,a=this._b1._invInertia12,l=this._b1._invInertia20,h=this._b1._invInertia21,u=this._b1._invInertia22,f=this._b2._invInertia00,m=this._b2._invInertia01,d=this._b2._invInertia02,p=this._b2._invInertia10,g=this._b2._invInertia11,x=this._b2._invInertia12,b=this._b2._invInertia20,y=this._b2._invInertia21,z=this._b2._invInertia22;let M=0,Y=this.info.numRows;for(;M<Y;){let S=M++,V=this.massData[S],F=this.info.rows[S].jacobian;V.invMLin1X=F.lin1X*e,V.invMLin1Y=F.lin1Y*e,V.invMLin1Z=F.lin1Z*e,V.invMLin2X=F.lin2X*i,V.invMLin2Y=F.lin2Y*i,V.invMLin2Z=F.lin2Z*i;let C,A,Z;C=n*F.ang1X+s*F.ang1Y+o*F.ang1Z,A=r*F.ang1X+_*F.ang1Y+a*F.ang1Z,Z=l*F.ang1X+h*F.ang1Y+u*F.ang1Z,V.invMAng1X=C,V.invMAng1Y=A,V.invMAng1Z=Z;let L,E,T;L=f*F.ang2X+m*F.ang2Y+d*F.ang2Z,E=p*F.ang2X+g*F.ang2Y+x*F.ang2Z,T=b*F.ang2X+y*F.ang2Y+z*F.ang2Z,V.invMAng2X=L,V.invMAng2Y=E,V.invMAng2Z=T,V.mass=V.invMLin1X*F.lin1X+V.invMLin1Y*F.lin1Y+V.invMLin1Z*F.lin1Z+(V.invMLin2X*F.lin2X+V.invMLin2Y*F.lin2Y+V.invMLin2Z*F.lin2Z)+(V.invMAng1X*F.ang1X+V.invMAng1Y*F.ang1Y+V.invMAng1Z*F.ang1Z)+(V.invMAng2X*F.ang2X+V.invMAng2Y*F.ang2Y+V.invMAng2Z*F.ang2Z),V.mass!=0&&(V.mass=1/V.mass)}let X=0,w=this.info.numRows;for(;X<w;)this.info.rows[X++].impulse.impulseP=0}solvePositionSplitImpulse(){let t,e,i,n,s,o,r,_,a,l,h,u;t=this._b1._pseudoVelX,e=this._b1._pseudoVelY,i=this._b1._pseudoVelZ,n=this._b2._pseudoVelX,s=this._b2._pseudoVelY,o=this._b2._pseudoVelZ,r=this._b1._angPseudoVelX,_=this._b1._angPseudoVelY,a=this._b1._angPseudoVelZ,l=this._b2._angPseudoVelX,h=this._b2._angPseudoVelY,u=this._b2._angPseudoVelZ;let f=0,m=this.info.numRows;for(;f<m;){let d=f++,p=this.info.rows[d],g=this.massData[d],x=p.impulse,b=p.jacobian,y=0;y+=t*b.lin1X+e*b.lin1Y+i*b.lin1Z,y-=n*b.lin2X+s*b.lin2Y+o*b.lin2Z,y+=r*b.ang1X+_*b.ang1Y+a*b.ang1Z,y-=l*b.ang2X+h*b.ang2Y+u*b.ang2Z;let z=(p.rhs*I.common.Setting.positionSplitImpulseBaumgarte-y)*g.mass,M=x.impulseP;x.impulseP+=z,x.impulseP<p.minImpulse?x.impulseP=p.minImpulse:x.impulseP>p.maxImpulse&&(x.impulseP=p.maxImpulse),z=x.impulseP-M,t+=g.invMLin1X*z,e+=g.invMLin1Y*z,i+=g.invMLin1Z*z,n+=g.invMLin2X*-z,s+=g.invMLin2Y*-z,o+=g.invMLin2Z*-z,r+=g.invMAng1X*z,_+=g.invMAng1Y*z,a+=g.invMAng1Z*z,l+=g.invMAng2X*-z,h+=g.invMAng2Y*-z,u+=g.invMAng2Z*-z}this._b1._pseudoVelX=t,this._b1._pseudoVelY=e,this._b1._pseudoVelZ=i,this._b2._pseudoVelX=n,this._b2._pseudoVelY=s,this._b2._pseudoVelZ=o,this._b1._angPseudoVelX=r,this._b1._angPseudoVelY=_,this._b1._angPseudoVelZ=a,this._b2._angPseudoVelX=l,this._b2._angPseudoVelY=h,this._b2._angPseudoVelZ=u}solvePositionNgs(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;let e=this._b1._invMass,i=this._b2._invMass,n,s,o,r,_,a,l,h,u,f,m,d,p,g,x,b,y,z;n=this._b1._invInertia00,s=this._b1._invInertia01,o=this._b1._invInertia02,r=this._b1._invInertia10,_=this._b1._invInertia11,a=this._b1._invInertia12,l=this._b1._invInertia20,h=this._b1._invInertia21,u=this._b1._invInertia22,f=this._b2._invInertia00,m=this._b2._invInertia01,d=this._b2._invInertia02,p=this._b2._invInertia10,g=this._b2._invInertia11,x=this._b2._invInertia12,b=this._b2._invInertia20,y=this._b2._invInertia21,z=this._b2._invInertia22;let M=0,Y=this.info.numRows;for(;M<Y;){let Be=M++,ve=this.massData[Be],qt=this.info.rows[Be].jacobian;ve.invMLin1X=qt.lin1X*e,ve.invMLin1Y=qt.lin1Y*e,ve.invMLin1Z=qt.lin1Z*e,ve.invMLin2X=qt.lin2X*i,ve.invMLin2Y=qt.lin2Y*i,ve.invMLin2Z=qt.lin2Z*i;let Jt,xe,Kt;Jt=n*qt.ang1X+s*qt.ang1Y+o*qt.ang1Z,xe=r*qt.ang1X+_*qt.ang1Y+a*qt.ang1Z,Kt=l*qt.ang1X+h*qt.ang1Y+u*qt.ang1Z,ve.invMAng1X=Jt,ve.invMAng1Y=xe,ve.invMAng1Z=Kt;let It,Et,Qt;It=f*qt.ang2X+m*qt.ang2Y+d*qt.ang2Z,Et=p*qt.ang2X+g*qt.ang2Y+x*qt.ang2Z,Qt=b*qt.ang2X+y*qt.ang2Y+z*qt.ang2Z,ve.invMAng2X=It,ve.invMAng2Y=Et,ve.invMAng2Z=Qt,ve.mass=ve.invMLin1X*qt.lin1X+ve.invMLin1Y*qt.lin1Y+ve.invMLin1Z*qt.lin1Z+(ve.invMLin2X*qt.lin2X+ve.invMLin2Y*qt.lin2Y+ve.invMLin2Z*qt.lin2Z)+(ve.invMAng1X*qt.ang1X+ve.invMAng1Y*qt.ang1Y+ve.invMAng1Z*qt.ang1Z)+(ve.invMAng2X*qt.ang2X+ve.invMAng2Y*qt.ang2Y+ve.invMAng2Z*qt.ang2Z),ve.mass!=0&&(ve.mass=1/ve.mass)}let X,w,S,V,F,C,A,Z,L,E,T,P;X=0,w=0,S=0,V=0,F=0,C=0,A=0,Z=0,L=0,E=0,T=0,P=0;let N=0,R=this.info.numRows;for(;N<R;){let Be=N++,ve=this.info.rows[Be],qt=this.massData[Be],Jt=ve.impulse,xe=ve.jacobian,Kt=0;Kt+=X*xe.lin1X+w*xe.lin1Y+S*xe.lin1Z,Kt-=V*xe.lin2X+F*xe.lin2Y+C*xe.lin2Z,Kt+=A*xe.ang1X+Z*xe.ang1Y+L*xe.ang1Z,Kt-=E*xe.ang2X+T*xe.ang2Y+P*xe.ang2Z;let It=(ve.rhs*I.common.Setting.positionNgsBaumgarte-Kt)*qt.mass,Et=Jt.impulseP;Jt.impulseP+=It,Jt.impulseP<ve.minImpulse?Jt.impulseP=ve.minImpulse:Jt.impulseP>ve.maxImpulse&&(Jt.impulseP=ve.maxImpulse),It=Jt.impulseP-Et,X+=qt.invMLin1X*It,w+=qt.invMLin1Y*It,S+=qt.invMLin1Z*It,V+=qt.invMLin2X*-It,F+=qt.invMLin2Y*-It,C+=qt.invMLin2Z*-It,A+=qt.invMAng1X*It,Z+=qt.invMAng1Y*It,L+=qt.invMAng1Z*It,E+=qt.invMAng2X*-It,T+=qt.invMAng2Y*-It,P+=qt.invMAng2Z*-It}let k=this._b1;k._transform._positionX+=X,k._transform._positionY+=w,k._transform._positionZ+=S;let O=this._b2;O._transform._positionX+=V,O._transform._positionY+=F,O._transform._positionZ+=C;let v=this._b1,D=Math.sqrt(A*A+Z*Z+L*L),B=D*.5,U,q;if(B<.5){let Be=B*B;U=.5*(1-Be*.16666666666666666+Be*Be*.008333333333333333),q=1-Be*.5+Be*Be*.041666666666666664}else U=Math.sin(B)/D,q=Math.cos(B);let tt,Q,nt;tt=A*U,Q=Z*U,nt=L*U;let H,j,it,et;H=tt,j=Q,it=nt,et=q;let G,W,lt,ht,ft=v._transform._rotation00,pt=v._transform._rotation11,K=v._transform._rotation22,J=ft+pt+K,rt;J>0?(rt=Math.sqrt(J+1),ht=.5*rt,rt=.5/rt,G=(v._transform._rotation21-v._transform._rotation12)*rt,W=(v._transform._rotation02-v._transform._rotation20)*rt,lt=(v._transform._rotation10-v._transform._rotation01)*rt):ft>pt?ft>K?(rt=Math.sqrt(ft-pt-K+1),G=.5*rt,rt=.5/rt,W=(v._transform._rotation01+v._transform._rotation10)*rt,lt=(v._transform._rotation02+v._transform._rotation20)*rt,ht=(v._transform._rotation21-v._transform._rotation12)*rt):(rt=Math.sqrt(K-ft-pt+1),lt=.5*rt,rt=.5/rt,G=(v._transform._rotation02+v._transform._rotation20)*rt,W=(v._transform._rotation12+v._transform._rotation21)*rt,ht=(v._transform._rotation10-v._transform._rotation01)*rt):pt>K?(rt=Math.sqrt(pt-K-ft+1),W=.5*rt,rt=.5/rt,G=(v._transform._rotation01+v._transform._rotation10)*rt,lt=(v._transform._rotation12+v._transform._rotation21)*rt,ht=(v._transform._rotation02-v._transform._rotation20)*rt):(rt=Math.sqrt(K-ft-pt+1),lt=.5*rt,rt=.5/rt,G=(v._transform._rotation02+v._transform._rotation20)*rt,W=(v._transform._rotation12+v._transform._rotation21)*rt,ht=(v._transform._rotation10-v._transform._rotation01)*rt),G=et*G+H*ht+j*lt-it*W,W=et*W-H*lt+j*ht+it*G,lt=et*lt+H*W-j*G+it*ht,ht=et*ht-H*G-j*W-it*lt;let mt=G*G+W*W+lt*lt+ht*ht;mt>1e-32&&(mt=1/Math.sqrt(mt)),G*=mt,W*=mt,lt*=mt,ht*=mt;let xt=G,vt=W,Mt=lt,ut=ht,Zt=2*xt,zt=2*vt,dt=2*Mt,st=xt*Zt,ct=vt*zt,_t=Mt*dt,Vt=xt*zt,At=vt*dt,St=xt*dt,Xt=ut*Zt,Ft=ut*zt,ie=ut*dt;v._transform._rotation00=1-ct-_t,v._transform._rotation01=Vt-ie,v._transform._rotation02=St+Ft,v._transform._rotation10=Vt+ie,v._transform._rotation11=1-st-_t,v._transform._rotation12=At-Xt,v._transform._rotation20=St-Ft,v._transform._rotation21=At+Xt,v._transform._rotation22=1-st-ct;let ee,Ye,Ie,ue,$t,Ht,me,ze,qe;ee=v._transform._rotation00*v._invLocalInertia00+v._transform._rotation01*v._invLocalInertia10+v._transform._rotation02*v._invLocalInertia20,Ye=v._transform._rotation00*v._invLocalInertia01+v._transform._rotation01*v._invLocalInertia11+v._transform._rotation02*v._invLocalInertia21,Ie=v._transform._rotation00*v._invLocalInertia02+v._transform._rotation01*v._invLocalInertia12+v._transform._rotation02*v._invLocalInertia22,ue=v._transform._rotation10*v._invLocalInertia00+v._transform._rotation11*v._invLocalInertia10+v._transform._rotation12*v._invLocalInertia20,$t=v._transform._rotation10*v._invLocalInertia01+v._transform._rotation11*v._invLocalInertia11+v._transform._rotation12*v._invLocalInertia21,Ht=v._transform._rotation10*v._invLocalInertia02+v._transform._rotation11*v._invLocalInertia12+v._transform._rotation12*v._invLocalInertia22,me=v._transform._rotation20*v._invLocalInertia00+v._transform._rotation21*v._invLocalInertia10+v._transform._rotation22*v._invLocalInertia20,ze=v._transform._rotation20*v._invLocalInertia01+v._transform._rotation21*v._invLocalInertia11+v._transform._rotation22*v._invLocalInertia21,qe=v._transform._rotation20*v._invLocalInertia02+v._transform._rotation21*v._invLocalInertia12+v._transform._rotation22*v._invLocalInertia22,v._invInertia00=ee,v._invInertia01=Ye,v._invInertia02=Ie,v._invInertia10=ue,v._invInertia11=$t,v._invInertia12=Ht,v._invInertia20=me,v._invInertia21=ze,v._invInertia22=qe;let Ee,Ut,at,gt,yt,bt,ot,Pt,Dt;Ee=v._invInertia00*v._transform._rotation00+v._invInertia01*v._transform._rotation01+v._invInertia02*v._transform._rotation02,Ut=v._invInertia00*v._transform._rotation10+v._invInertia01*v._transform._rotation11+v._invInertia02*v._transform._rotation12,at=v._invInertia00*v._transform._rotation20+v._invInertia01*v._transform._rotation21+v._invInertia02*v._transform._rotation22,gt=v._invInertia10*v._transform._rotation00+v._invInertia11*v._transform._rotation01+v._invInertia12*v._transform._rotation02,yt=v._invInertia10*v._transform._rotation10+v._invInertia11*v._transform._rotation11+v._invInertia12*v._transform._rotation12,bt=v._invInertia10*v._transform._rotation20+v._invInertia11*v._transform._rotation21+v._invInertia12*v._transform._rotation22,ot=v._invInertia20*v._transform._rotation00+v._invInertia21*v._transform._rotation01+v._invInertia22*v._transform._rotation02,Pt=v._invInertia20*v._transform._rotation10+v._invInertia21*v._transform._rotation11+v._invInertia22*v._transform._rotation12,Dt=v._invInertia20*v._transform._rotation20+v._invInertia21*v._transform._rotation21+v._invInertia22*v._transform._rotation22,v._invInertia00=Ee,v._invInertia01=Ut,v._invInertia02=at,v._invInertia10=gt,v._invInertia11=yt,v._invInertia12=bt,v._invInertia20=ot,v._invInertia21=Pt,v._invInertia22=Dt,v._invInertia00*=v._rotFactor.x,v._invInertia01*=v._rotFactor.x,v._invInertia02*=v._rotFactor.x,v._invInertia10*=v._rotFactor.y,v._invInertia11*=v._rotFactor.y,v._invInertia12*=v._rotFactor.y,v._invInertia20*=v._rotFactor.z,v._invInertia21*=v._rotFactor.z,v._invInertia22*=v._rotFactor.z;let $=this._b2,kt=Math.sqrt(E*E+T*T+P*P),Rt=kt*.5,Ot,Wt;if(Rt<.5){let Be=Rt*Rt;Ot=.5*(1-Be*.16666666666666666+Be*Be*.008333333333333333),Wt=1-Be*.5+Be*Be*.041666666666666664}else Ot=Math.sin(Rt)/kt,Wt=Math.cos(Rt);let Bt,re,Ce;Bt=E*Ot,re=T*Ot,Ce=P*Ot;let be,Tt,Lt,Yt;be=Bt,Tt=re,Lt=Ce,Yt=Wt;let pe,Me,fe,ti,di=$._transform._rotation00,Le=$._transform._rotation11,_i=$._transform._rotation22,yi=di+Le+_i,he;yi>0?(he=Math.sqrt(yi+1),ti=.5*he,he=.5/he,pe=($._transform._rotation21-$._transform._rotation12)*he,Me=($._transform._rotation02-$._transform._rotation20)*he,fe=($._transform._rotation10-$._transform._rotation01)*he):di>Le?di>_i?(he=Math.sqrt(di-Le-_i+1),pe=.5*he,he=.5/he,Me=($._transform._rotation01+$._transform._rotation10)*he,fe=($._transform._rotation02+$._transform._rotation20)*he,ti=($._transform._rotation21-$._transform._rotation12)*he):(he=Math.sqrt(_i-di-Le+1),fe=.5*he,he=.5/he,pe=($._transform._rotation02+$._transform._rotation20)*he,Me=($._transform._rotation12+$._transform._rotation21)*he,ti=($._transform._rotation10-$._transform._rotation01)*he):Le>_i?(he=Math.sqrt(Le-_i-di+1),Me=.5*he,he=.5/he,pe=($._transform._rotation01+$._transform._rotation10)*he,fe=($._transform._rotation12+$._transform._rotation21)*he,ti=($._transform._rotation02-$._transform._rotation20)*he):(he=Math.sqrt(_i-di-Le+1),fe=.5*he,he=.5/he,pe=($._transform._rotation02+$._transform._rotation20)*he,Me=($._transform._rotation12+$._transform._rotation21)*he,ti=($._transform._rotation10-$._transform._rotation01)*he),pe=Yt*pe+be*ti+Tt*fe-Lt*Me,Me=Yt*Me-be*fe+Tt*ti+Lt*pe,fe=Yt*fe+be*Me-Tt*pe+Lt*ti,ti=Yt*ti-be*pe-Tt*Me-Lt*fe;let gi=pe*pe+Me*Me+fe*fe+ti*ti;gi>1e-32&&(gi=1/Math.sqrt(gi)),pe*=gi,Me*=gi,fe*=gi,ti*=gi;let bi=pe,Mi=Me,Si=fe,He=ti,Je=2*bi,Qe=2*Mi,ci=2*Si,hi=bi*Je,ei=Mi*Qe,ai=Si*ci,Ke=bi*Qe,We=Mi*ci,ke=bi*ci,le=He*Je,ge=He*Qe,jt=He*ci;$._transform._rotation00=1-ei-ai,$._transform._rotation01=Ke-jt,$._transform._rotation02=ke+ge,$._transform._rotation10=Ke+jt,$._transform._rotation11=1-hi-ai,$._transform._rotation12=We-le,$._transform._rotation20=ke-ge,$._transform._rotation21=We+le,$._transform._rotation22=1-hi-ei;let Ae,Ze,Re,Te,Fe,se,Ct,Gt,Pe;Ae=$._transform._rotation00*$._invLocalInertia00+$._transform._rotation01*$._invLocalInertia10+$._transform._rotation02*$._invLocalInertia20,Ze=$._transform._rotation00*$._invLocalInertia01+$._transform._rotation01*$._invLocalInertia11+$._transform._rotation02*$._invLocalInertia21,Re=$._transform._rotation00*$._invLocalInertia02+$._transform._rotation01*$._invLocalInertia12+$._transform._rotation02*$._invLocalInertia22,Te=$._transform._rotation10*$._invLocalInertia00+$._transform._rotation11*$._invLocalInertia10+$._transform._rotation12*$._invLocalInertia20,Fe=$._transform._rotation10*$._invLocalInertia01+$._transform._rotation11*$._invLocalInertia11+$._transform._rotation12*$._invLocalInertia21,se=$._transform._rotation10*$._invLocalInertia02+$._transform._rotation11*$._invLocalInertia12+$._transform._rotation12*$._invLocalInertia22,Ct=$._transform._rotation20*$._invLocalInertia00+$._transform._rotation21*$._invLocalInertia10+$._transform._rotation22*$._invLocalInertia20,Gt=$._transform._rotation20*$._invLocalInertia01+$._transform._rotation21*$._invLocalInertia11+$._transform._rotation22*$._invLocalInertia21,Pe=$._transform._rotation20*$._invLocalInertia02+$._transform._rotation21*$._invLocalInertia12+$._transform._rotation22*$._invLocalInertia22,$._invInertia00=Ae,$._invInertia01=Ze,$._invInertia02=Re,$._invInertia10=Te,$._invInertia11=Fe,$._invInertia12=se,$._invInertia20=Ct,$._invInertia21=Gt,$._invInertia22=Pe;let Ve,Ue,ii,ri,mi,xi,ce,Ge,we;Ve=$._invInertia00*$._transform._rotation00+$._invInertia01*$._transform._rotation01+$._invInertia02*$._transform._rotation02,Ue=$._invInertia00*$._transform._rotation10+$._invInertia01*$._transform._rotation11+$._invInertia02*$._transform._rotation12,ii=$._invInertia00*$._transform._rotation20+$._invInertia01*$._transform._rotation21+$._invInertia02*$._transform._rotation22,ri=$._invInertia10*$._transform._rotation00+$._invInertia11*$._transform._rotation01+$._invInertia12*$._transform._rotation02,mi=$._invInertia10*$._transform._rotation10+$._invInertia11*$._transform._rotation11+$._invInertia12*$._transform._rotation12,xi=$._invInertia10*$._transform._rotation20+$._invInertia11*$._transform._rotation21+$._invInertia12*$._transform._rotation22,ce=$._invInertia20*$._transform._rotation00+$._invInertia21*$._transform._rotation01+$._invInertia22*$._transform._rotation02,Ge=$._invInertia20*$._transform._rotation10+$._invInertia21*$._transform._rotation11+$._invInertia22*$._transform._rotation12,we=$._invInertia20*$._transform._rotation20+$._invInertia21*$._transform._rotation21+$._invInertia22*$._transform._rotation22,$._invInertia00=Ve,$._invInertia01=Ue,$._invInertia02=ii,$._invInertia10=ri,$._invInertia11=mi,$._invInertia12=xi,$._invInertia20=ce,$._invInertia21=Ge,$._invInertia22=we,$._invInertia00*=$._rotFactor.x,$._invInertia01*=$._rotFactor.x,$._invInertia02*=$._rotFactor.x,$._invInertia10*=$._rotFactor.y,$._invInertia11*=$._rotFactor.y,$._invInertia12*=$._rotFactor.y,$._invInertia20*=$._rotFactor.z,$._invInertia21*=$._rotFactor.z,$._invInertia22*=$._rotFactor.z}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}};I.dynamics.rigidbody||(I.dynamics.rigidbody={});I.dynamics.rigidbody.MassData=class{constructor(){this.mass=0,this.localInertia=new I.common.Mat3}};I.dynamics.rigidbody.RigidBody=class{constructor(t){this._next=null,this._prev=null,this._shapeList=null,this._shapeListLast=null,this._numShapes=0,this._contactLinkList=null,this._contactLinkListLast=null,this._numContactLinks=0,this._jointLinkList=null,this._jointLinkListLast=null,this._numJointLinks=0;let e=t.linearVelocity;this._velX=e.x,this._velY=e.y,this._velZ=e.z;let i=t.angularVelocity;this._angVelX=i.x,this._angVelY=i.y,this._angVelZ=i.z,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._ptransform=new I.common.Transform,this._transform=new I.common.Transform;let n=t.position;this._ptransform._positionX=n.x,this._ptransform._positionY=n.y,this._ptransform._positionZ=n.z;let s=t.rotation;this._ptransform._rotation00=s.e00,this._ptransform._rotation01=s.e01,this._ptransform._rotation02=s.e02,this._ptransform._rotation10=s.e10,this._ptransform._rotation11=s.e11,this._ptransform._rotation12=s.e12,this._ptransform._rotation20=s.e20,this._ptransform._rotation21=s.e21,this._ptransform._rotation22=s.e22;let o=this._transform,r=this._ptransform;o._positionX=r._positionX,o._positionY=r._positionY,o._positionZ=r._positionZ,o._rotation00=r._rotation00,o._rotation01=r._rotation01,o._rotation02=r._rotation02,o._rotation10=r._rotation10,o._rotation11=r._rotation11,o._rotation12=r._rotation12,o._rotation20=r._rotation20,o._rotation21=r._rotation21,o._rotation22=r._rotation22,this._type=t.type,this._sleepTime=0,this._sleeping=!1,this._autoSleep=t.autoSleep,this._mass=0,this._invMass=0,this._localInertia00=0,this._localInertia01=0,this._localInertia02=0,this._localInertia10=0,this._localInertia11=0,this._localInertia12=0,this._localInertia20=0,this._localInertia21=0,this._localInertia22=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._invInertia00=0,this._invInertia01=0,this._invInertia02=0,this._invInertia10=0,this._invInertia11=0,this._invInertia12=0,this._invInertia20=0,this._invInertia21=0,this._invInertia22=0,this._linearDamping=t.linearDamping,this._angularDamping=t.angularDamping,this._forceX=0,this._forceY=0,this._forceZ=0,this._torqueX=0,this._torqueY=0,this._torqueZ=0,this._linearContactImpulseX=0,this._linearContactImpulseY=0,this._linearContactImpulseZ=0,this._angularContactImpulseX=0,this._angularContactImpulseY=0,this._angularContactImpulseZ=0,this._rotFactor=new I.common.Vec3(1,1,1),this._addedToIsland=!1,this._gravityScale=1,this._world=null}_integrate(t){switch(this._type){case 1:this._velX=0,this._velY=0,this._velZ=0,this._angVelX=0,this._angVelY=0,this._angVelZ=0,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:let e,i,n,s,o,r;e=this._velX*t,i=this._velY*t,n=this._velZ*t,s=this._angVelX*t,o=this._angVelY*t,r=this._angVelZ*t;let _=e*e+i*i+n*n,a=s*s+o*o+r*r;if(_==0&&a==0)return;if(_>I.common.Setting.maxTranslationPerStep*I.common.Setting.maxTranslationPerStep){let ut=I.common.Setting.maxTranslationPerStep/Math.sqrt(_);this._velX*=ut,this._velY*=ut,this._velZ*=ut,e*=ut,i*=ut,n*=ut}if(a>I.common.Setting.maxRotationPerStep*I.common.Setting.maxRotationPerStep){let ut=I.common.Setting.maxRotationPerStep/Math.sqrt(a);this._angVelX*=ut,this._angVelY*=ut,this._angVelZ*=ut,s*=ut,o*=ut,r*=ut}this._transform._positionX+=e,this._transform._positionY+=i,this._transform._positionZ+=n;let l=Math.sqrt(s*s+o*o+r*r),h=l*.5,u,f;if(h<.5){let ut=h*h;u=.5*(1-ut*.16666666666666666+ut*ut*.008333333333333333),f=1-ut*.5+ut*ut*.041666666666666664}else u=Math.sin(h)/l,f=Math.cos(h);let m,d,p;m=s*u,d=o*u,p=r*u;let g,x,b,y;g=m,x=d,b=p,y=f;let z,M,Y,X,w=this._transform._rotation00,S=this._transform._rotation11,V=this._transform._rotation22,F=w+S+V,C;F>0?(C=Math.sqrt(F+1),X=.5*C,C=.5/C,z=(this._transform._rotation21-this._transform._rotation12)*C,M=(this._transform._rotation02-this._transform._rotation20)*C,Y=(this._transform._rotation10-this._transform._rotation01)*C):w>S?w>V?(C=Math.sqrt(w-S-V+1),z=.5*C,C=.5/C,M=(this._transform._rotation01+this._transform._rotation10)*C,Y=(this._transform._rotation02+this._transform._rotation20)*C,X=(this._transform._rotation21-this._transform._rotation12)*C):(C=Math.sqrt(V-w-S+1),Y=.5*C,C=.5/C,z=(this._transform._rotation02+this._transform._rotation20)*C,M=(this._transform._rotation12+this._transform._rotation21)*C,X=(this._transform._rotation10-this._transform._rotation01)*C):S>V?(C=Math.sqrt(S-V-w+1),M=.5*C,C=.5/C,z=(this._transform._rotation01+this._transform._rotation10)*C,Y=(this._transform._rotation12+this._transform._rotation21)*C,X=(this._transform._rotation02-this._transform._rotation20)*C):(C=Math.sqrt(V-w-S+1),Y=.5*C,C=.5/C,z=(this._transform._rotation02+this._transform._rotation20)*C,M=(this._transform._rotation12+this._transform._rotation21)*C,X=(this._transform._rotation10-this._transform._rotation01)*C),z=y*z+g*X+x*Y-b*M,M=y*M-g*Y+x*X+b*z,Y=y*Y+g*M-x*z+b*X,X=y*X-g*z-x*M-b*Y;let A=z*z+M*M+Y*Y+X*X;A>1e-32&&(A=1/Math.sqrt(A)),z*=A,M*=A,Y*=A,X*=A;let Z=z,L=M,E=Y,T=X,P=2*Z,N=2*L,R=2*E,k=Z*P,O=L*N,v=E*R,D=Z*N,B=L*R,U=Z*R,q=T*P,tt=T*N,Q=T*R;this._transform._rotation00=1-O-v,this._transform._rotation01=D-Q,this._transform._rotation02=U+tt,this._transform._rotation10=D+Q,this._transform._rotation11=1-k-v,this._transform._rotation12=B-q,this._transform._rotation20=U-tt,this._transform._rotation21=B+q,this._transform._rotation22=1-k-O;let nt,H,j,it,et,G,W,lt,ht;nt=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,H=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,j=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,it=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,et=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,G=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,W=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,lt=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,ht=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=nt,this._invInertia01=H,this._invInertia02=j,this._invInertia10=it,this._invInertia11=et,this._invInertia12=G,this._invInertia20=W,this._invInertia21=lt,this._invInertia22=ht;let ft,pt,K,J,rt,mt,xt,vt,Mt;ft=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,pt=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,K=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,J=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,rt=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,mt=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,xt=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,vt=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,Mt=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=ft,this._invInertia01=pt,this._invInertia02=K,this._invInertia10=J,this._invInertia11=rt,this._invInertia12=mt,this._invInertia20=xt,this._invInertia21=vt,this._invInertia22=Mt,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;break}}_integratePseudoVelocity(){if(!(this._pseudoVelX*this._pseudoVelX+this._pseudoVelY*this._pseudoVelY+this._pseudoVelZ*this._pseudoVelZ==0&&this._angPseudoVelX*this._angPseudoVelX+this._angPseudoVelY*this._angPseudoVelY+this._angPseudoVelZ*this._angPseudoVelZ==0))switch(this._type){case 1:this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:let t,e,i,n,s,o;t=this._pseudoVelX,e=this._pseudoVelY,i=this._pseudoVelZ,n=this._angPseudoVelX,s=this._angPseudoVelY,o=this._angPseudoVelZ,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._transform._positionX+=t,this._transform._positionY+=e,this._transform._positionZ+=i;let r=Math.sqrt(n*n+s*s+o*o),_=r*.5,a,l;if(_<.5){let xt=_*_;a=.5*(1-xt*.16666666666666666+xt*xt*.008333333333333333),l=1-xt*.5+xt*xt*.041666666666666664}else a=Math.sin(_)/r,l=Math.cos(_);let h,u,f;h=n*a,u=s*a,f=o*a;let m,d,p,g;m=h,d=u,p=f,g=l;let x,b,y,z,M=this._transform._rotation00,Y=this._transform._rotation11,X=this._transform._rotation22,w=M+Y+X,S;w>0?(S=Math.sqrt(w+1),z=.5*S,S=.5/S,x=(this._transform._rotation21-this._transform._rotation12)*S,b=(this._transform._rotation02-this._transform._rotation20)*S,y=(this._transform._rotation10-this._transform._rotation01)*S):M>Y?M>X?(S=Math.sqrt(M-Y-X+1),x=.5*S,S=.5/S,b=(this._transform._rotation01+this._transform._rotation10)*S,y=(this._transform._rotation02+this._transform._rotation20)*S,z=(this._transform._rotation21-this._transform._rotation12)*S):(S=Math.sqrt(X-M-Y+1),y=.5*S,S=.5/S,x=(this._transform._rotation02+this._transform._rotation20)*S,b=(this._transform._rotation12+this._transform._rotation21)*S,z=(this._transform._rotation10-this._transform._rotation01)*S):Y>X?(S=Math.sqrt(Y-X-M+1),b=.5*S,S=.5/S,x=(this._transform._rotation01+this._transform._rotation10)*S,y=(this._transform._rotation12+this._transform._rotation21)*S,z=(this._transform._rotation02-this._transform._rotation20)*S):(S=Math.sqrt(X-M-Y+1),y=.5*S,S=.5/S,x=(this._transform._rotation02+this._transform._rotation20)*S,b=(this._transform._rotation12+this._transform._rotation21)*S,z=(this._transform._rotation10-this._transform._rotation01)*S),x=g*x+m*z+d*y-p*b,b=g*b-m*y+d*z+p*x,y=g*y+m*b-d*x+p*z,z=g*z-m*x-d*b-p*y;let V=x*x+b*b+y*y+z*z;V>1e-32&&(V=1/Math.sqrt(V)),x*=V,b*=V,y*=V,z*=V;let F=x,C=b,A=y,Z=z,L=2*F,E=2*C,T=2*A,P=F*L,N=C*E,R=A*T,k=F*E,O=C*T,v=F*T,D=Z*L,B=Z*E,U=Z*T;this._transform._rotation00=1-N-R,this._transform._rotation01=k-U,this._transform._rotation02=v+B,this._transform._rotation10=k+U,this._transform._rotation11=1-P-R,this._transform._rotation12=O-D,this._transform._rotation20=v-B,this._transform._rotation21=O+D,this._transform._rotation22=1-P-N;let q,tt,Q,nt,H,j,it,et,G;q=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,tt=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,Q=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,nt=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,H=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,j=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,it=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,et=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,G=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=q,this._invInertia01=tt,this._invInertia02=Q,this._invInertia10=nt,this._invInertia11=H,this._invInertia12=j,this._invInertia20=it,this._invInertia21=et,this._invInertia22=G;let W,lt,ht,ft,pt,K,J,rt,mt;W=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,lt=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,ht=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,ft=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,pt=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,K=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,J=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,rt=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,mt=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=W,this._invInertia01=lt,this._invInertia02=ht,this._invInertia10=ft,this._invInertia11=pt,this._invInertia12=K,this._invInertia20=J,this._invInertia21=rt,this._invInertia22=mt,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;break}}updateMass(){let t,e,i,n,s,o,r,_,a;t=0,e=0,i=0,n=0,s=0,o=0,r=0,_=0,a=0;let l=0,h=this._shapeList;for(;h!=null;){let A=h._next,Z=h._geom;Z._updateMass();let L=h._density*Z._volume,E,T,P,N,R,k,O,v,D,B,U,q,tt,Q,nt,H,j,it;B=h._localTransform._rotation00*Z._inertiaCoeff00+h._localTransform._rotation01*Z._inertiaCoeff10+h._localTransform._rotation02*Z._inertiaCoeff20,U=h._localTransform._rotation00*Z._inertiaCoeff01+h._localTransform._rotation01*Z._inertiaCoeff11+h._localTransform._rotation02*Z._inertiaCoeff21,q=h._localTransform._rotation00*Z._inertiaCoeff02+h._localTransform._rotation01*Z._inertiaCoeff12+h._localTransform._rotation02*Z._inertiaCoeff22,tt=h._localTransform._rotation10*Z._inertiaCoeff00+h._localTransform._rotation11*Z._inertiaCoeff10+h._localTransform._rotation12*Z._inertiaCoeff20,Q=h._localTransform._rotation10*Z._inertiaCoeff01+h._localTransform._rotation11*Z._inertiaCoeff11+h._localTransform._rotation12*Z._inertiaCoeff21,nt=h._localTransform._rotation10*Z._inertiaCoeff02+h._localTransform._rotation11*Z._inertiaCoeff12+h._localTransform._rotation12*Z._inertiaCoeff22,H=h._localTransform._rotation20*Z._inertiaCoeff00+h._localTransform._rotation21*Z._inertiaCoeff10+h._localTransform._rotation22*Z._inertiaCoeff20,j=h._localTransform._rotation20*Z._inertiaCoeff01+h._localTransform._rotation21*Z._inertiaCoeff11+h._localTransform._rotation22*Z._inertiaCoeff21,it=h._localTransform._rotation20*Z._inertiaCoeff02+h._localTransform._rotation21*Z._inertiaCoeff12+h._localTransform._rotation22*Z._inertiaCoeff22,E=B,T=U,P=q,N=tt,R=Q,k=nt,O=H,v=j,D=it;let et,G,W,lt,ht,ft,pt,K,J;et=E*h._localTransform._rotation00+T*h._localTransform._rotation01+P*h._localTransform._rotation02,G=E*h._localTransform._rotation10+T*h._localTransform._rotation11+P*h._localTransform._rotation12,W=E*h._localTransform._rotation20+T*h._localTransform._rotation21+P*h._localTransform._rotation22,lt=N*h._localTransform._rotation00+R*h._localTransform._rotation01+k*h._localTransform._rotation02,ht=N*h._localTransform._rotation10+R*h._localTransform._rotation11+k*h._localTransform._rotation12,ft=N*h._localTransform._rotation20+R*h._localTransform._rotation21+k*h._localTransform._rotation22,pt=O*h._localTransform._rotation00+v*h._localTransform._rotation01+D*h._localTransform._rotation02,K=O*h._localTransform._rotation10+v*h._localTransform._rotation11+D*h._localTransform._rotation12,J=O*h._localTransform._rotation20+v*h._localTransform._rotation21+D*h._localTransform._rotation22,E=et,T=G,P=W,N=lt,R=ht,k=ft,O=pt,v=K,D=J,E*=L,T*=L,P*=L,N*=L,R*=L,k*=L,O*=L,v*=L,D*=L;let rt,mt,xt,vt,Mt,ut,Zt,zt,dt,st=h._localTransform._positionX*h._localTransform._positionX,ct=h._localTransform._positionY*h._localTransform._positionY,_t=h._localTransform._positionZ*h._localTransform._positionZ,Vt=-h._localTransform._positionX*h._localTransform._positionY,At=-h._localTransform._positionY*h._localTransform._positionZ,St=-h._localTransform._positionZ*h._localTransform._positionX;rt=ct+_t,mt=Vt,xt=St,vt=Vt,Mt=st+_t,ut=At,Zt=St,zt=At,dt=st+ct,E+=rt*L,T+=mt*L,P+=xt*L,N+=vt*L,R+=Mt*L,k+=ut*L,O+=Zt*L,v+=zt*L,D+=dt*L,l+=L,t+=E,e+=T,i+=P,n+=N,s+=R,o+=k,r+=O,_+=v,a+=D,h=A}if(this._mass=l,this._localInertia00=t,this._localInertia01=e,this._localInertia02=i,this._localInertia10=n,this._localInertia11=s,this._localInertia12=o,this._localInertia20=r,this._localInertia21=_,this._localInertia22=a,this._mass>0&&this._localInertia00*(this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21)-this._localInertia01*(this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20)+this._localInertia02*(this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20)>0&&this._type==0){this._invMass=1/this._mass;let A=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,Z=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,L=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,E=this._localInertia00*A-this._localInertia01*Z+this._localInertia02*L;(E<-1e-32||E>1e-32)&&(E=1/E),this._invLocalInertia00=A*E,this._invLocalInertia01=-(this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21)*E,this._invLocalInertia02=(this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11)*E,this._invLocalInertia10=-Z*E,this._invLocalInertia11=(this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20)*E,this._invLocalInertia12=-(this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10)*E,this._invLocalInertia20=L*E,this._invLocalInertia21=-(this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20)*E,this._invLocalInertia22=(this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10)*E,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._type==0&&(this._type=1);let u,f,m,d,p,g,x,b,y;u=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,f=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,m=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,d=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,p=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,g=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,x=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,b=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,y=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=u,this._invInertia01=f,this._invInertia02=m,this._invInertia10=d,this._invInertia11=p,this._invInertia12=g,this._invInertia20=x,this._invInertia21=b,this._invInertia22=y;let z,M,Y,X,w,S,V,F,C;z=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,M=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,Y=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,X=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,w=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,S=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,V=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,F=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,C=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=z,this._invInertia01=M,this._invInertia02=Y,this._invInertia10=X,this._invInertia11=w,this._invInertia12=S,this._invInertia20=V,this._invInertia21=F,this._invInertia22=C,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getPosition(){let t=new I.common.Vec3;return t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ,t}getPositionTo(t){t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ}setPosition(t){this._transform._positionX=t.x,this._transform._positionY=t.y,this._transform._positionZ=t.z;let e=this._ptransform,i=this._transform;e._positionX=i._positionX,e._positionY=i._positionY,e._positionZ=i._positionZ,e._rotation00=i._rotation00,e._rotation01=i._rotation01,e._rotation02=i._rotation02,e._rotation10=i._rotation10,e._rotation11=i._rotation11,e._rotation12=i._rotation12,e._rotation20=i._rotation20,e._rotation21=i._rotation21,e._rotation22=i._rotation22;let n=this._shapeList;for(;n!=null;){let s=n._next,o=this._ptransform,r=this._transform,_=n._ptransform,a=n._localTransform,l,h,u,f,m,d,p,g,x;l=o._rotation00*a._rotation00+o._rotation01*a._rotation10+o._rotation02*a._rotation20,h=o._rotation00*a._rotation01+o._rotation01*a._rotation11+o._rotation02*a._rotation21,u=o._rotation00*a._rotation02+o._rotation01*a._rotation12+o._rotation02*a._rotation22,f=o._rotation10*a._rotation00+o._rotation11*a._rotation10+o._rotation12*a._rotation20,m=o._rotation10*a._rotation01+o._rotation11*a._rotation11+o._rotation12*a._rotation21,d=o._rotation10*a._rotation02+o._rotation11*a._rotation12+o._rotation12*a._rotation22,p=o._rotation20*a._rotation00+o._rotation21*a._rotation10+o._rotation22*a._rotation20,g=o._rotation20*a._rotation01+o._rotation21*a._rotation11+o._rotation22*a._rotation21,x=o._rotation20*a._rotation02+o._rotation21*a._rotation12+o._rotation22*a._rotation22,_._rotation00=l,_._rotation01=h,_._rotation02=u,_._rotation10=f,_._rotation11=m,_._rotation12=d,_._rotation20=p,_._rotation21=g,_._rotation22=x;let b,y,z;b=o._rotation00*a._positionX+o._rotation01*a._positionY+o._rotation02*a._positionZ,y=o._rotation10*a._positionX+o._rotation11*a._positionY+o._rotation12*a._positionZ,z=o._rotation20*a._positionX+o._rotation21*a._positionY+o._rotation22*a._positionZ,_._positionX=b,_._positionY=y,_._positionZ=z,_._positionX+=o._positionX,_._positionY+=o._positionY,_._positionZ+=o._positionZ;let M=n._transform,Y=n._localTransform,X,w,S,V,F,C,A,Z,L;X=r._rotation00*Y._rotation00+r._rotation01*Y._rotation10+r._rotation02*Y._rotation20,w=r._rotation00*Y._rotation01+r._rotation01*Y._rotation11+r._rotation02*Y._rotation21,S=r._rotation00*Y._rotation02+r._rotation01*Y._rotation12+r._rotation02*Y._rotation22,V=r._rotation10*Y._rotation00+r._rotation11*Y._rotation10+r._rotation12*Y._rotation20,F=r._rotation10*Y._rotation01+r._rotation11*Y._rotation11+r._rotation12*Y._rotation21,C=r._rotation10*Y._rotation02+r._rotation11*Y._rotation12+r._rotation12*Y._rotation22,A=r._rotation20*Y._rotation00+r._rotation21*Y._rotation10+r._rotation22*Y._rotation20,Z=r._rotation20*Y._rotation01+r._rotation21*Y._rotation11+r._rotation22*Y._rotation21,L=r._rotation20*Y._rotation02+r._rotation21*Y._rotation12+r._rotation22*Y._rotation22,M._rotation00=X,M._rotation01=w,M._rotation02=S,M._rotation10=V,M._rotation11=F,M._rotation12=C,M._rotation20=A,M._rotation21=Z,M._rotation22=L;let E,T,P;E=r._rotation00*Y._positionX+r._rotation01*Y._positionY+r._rotation02*Y._positionZ,T=r._rotation10*Y._positionX+r._rotation11*Y._positionY+r._rotation12*Y._positionZ,P=r._rotation20*Y._positionX+r._rotation21*Y._positionY+r._rotation22*Y._positionZ,M._positionX=E,M._positionY=T,M._positionZ=P,M._positionX+=r._positionX,M._positionY+=r._positionY,M._positionZ+=r._positionZ;let N,R,k,O,v,D;if(n._geom._computeAabb(n._aabb,n._ptransform),N=n._aabb._minX,R=n._aabb._minY,k=n._aabb._minZ,O=n._aabb._maxX,v=n._aabb._maxY,D=n._aabb._maxZ,n._geom._computeAabb(n._aabb,n._transform),n._aabb._minX=N<n._aabb._minX?N:n._aabb._minX,n._aabb._minY=R<n._aabb._minY?R:n._aabb._minY,n._aabb._minZ=k<n._aabb._minZ?k:n._aabb._minZ,n._aabb._maxX=O>n._aabb._maxX?O:n._aabb._maxX,n._aabb._maxY=v>n._aabb._maxY?v:n._aabb._maxY,n._aabb._maxZ=D>n._aabb._maxZ?D:n._aabb._maxZ,n._proxy!=null){let B,U,q;B=n._transform._positionX-n._ptransform._positionX,U=n._transform._positionY-n._ptransform._positionY,q=n._transform._positionZ-n._ptransform._positionZ;let tt=n.displacement;tt.x=B,tt.y=U,tt.z=q,n._rigidBody._world._broadPhase.moveProxy(n._proxy,n._aabb,n.displacement)}n=s}this._sleeping=!1,this._sleepTime=0}translate(t){let e,i,n;e=t.x,i=t.y,n=t.z,this._transform._positionX+=e,this._transform._positionY+=i,this._transform._positionZ+=n;let s=this._ptransform,o=this._transform;s._positionX=o._positionX,s._positionY=o._positionY,s._positionZ=o._positionZ,s._rotation00=o._rotation00,s._rotation01=o._rotation01,s._rotation02=o._rotation02,s._rotation10=o._rotation10,s._rotation11=o._rotation11,s._rotation12=o._rotation12,s._rotation20=o._rotation20,s._rotation21=o._rotation21,s._rotation22=o._rotation22;let r=this._shapeList;for(;r!=null;){let _=r._next,a=this._ptransform,l=this._transform,h=r._ptransform,u=r._localTransform,f,m,d,p,g,x,b,y,z;f=a._rotation00*u._rotation00+a._rotation01*u._rotation10+a._rotation02*u._rotation20,m=a._rotation00*u._rotation01+a._rotation01*u._rotation11+a._rotation02*u._rotation21,d=a._rotation00*u._rotation02+a._rotation01*u._rotation12+a._rotation02*u._rotation22,p=a._rotation10*u._rotation00+a._rotation11*u._rotation10+a._rotation12*u._rotation20,g=a._rotation10*u._rotation01+a._rotation11*u._rotation11+a._rotation12*u._rotation21,x=a._rotation10*u._rotation02+a._rotation11*u._rotation12+a._rotation12*u._rotation22,b=a._rotation20*u._rotation00+a._rotation21*u._rotation10+a._rotation22*u._rotation20,y=a._rotation20*u._rotation01+a._rotation21*u._rotation11+a._rotation22*u._rotation21,z=a._rotation20*u._rotation02+a._rotation21*u._rotation12+a._rotation22*u._rotation22,h._rotation00=f,h._rotation01=m,h._rotation02=d,h._rotation10=p,h._rotation11=g,h._rotation12=x,h._rotation20=b,h._rotation21=y,h._rotation22=z;let M,Y,X;M=a._rotation00*u._positionX+a._rotation01*u._positionY+a._rotation02*u._positionZ,Y=a._rotation10*u._positionX+a._rotation11*u._positionY+a._rotation12*u._positionZ,X=a._rotation20*u._positionX+a._rotation21*u._positionY+a._rotation22*u._positionZ,h._positionX=M,h._positionY=Y,h._positionZ=X,h._positionX+=a._positionX,h._positionY+=a._positionY,h._positionZ+=a._positionZ;let w=r._transform,S=r._localTransform,V,F,C,A,Z,L,E,T,P;V=l._rotation00*S._rotation00+l._rotation01*S._rotation10+l._rotation02*S._rotation20,F=l._rotation00*S._rotation01+l._rotation01*S._rotation11+l._rotation02*S._rotation21,C=l._rotation00*S._rotation02+l._rotation01*S._rotation12+l._rotation02*S._rotation22,A=l._rotation10*S._rotation00+l._rotation11*S._rotation10+l._rotation12*S._rotation20,Z=l._rotation10*S._rotation01+l._rotation11*S._rotation11+l._rotation12*S._rotation21,L=l._rotation10*S._rotation02+l._rotation11*S._rotation12+l._rotation12*S._rotation22,E=l._rotation20*S._rotation00+l._rotation21*S._rotation10+l._rotation22*S._rotation20,T=l._rotation20*S._rotation01+l._rotation21*S._rotation11+l._rotation22*S._rotation21,P=l._rotation20*S._rotation02+l._rotation21*S._rotation12+l._rotation22*S._rotation22,w._rotation00=V,w._rotation01=F,w._rotation02=C,w._rotation10=A,w._rotation11=Z,w._rotation12=L,w._rotation20=E,w._rotation21=T,w._rotation22=P;let N,R,k;N=l._rotation00*S._positionX+l._rotation01*S._positionY+l._rotation02*S._positionZ,R=l._rotation10*S._positionX+l._rotation11*S._positionY+l._rotation12*S._positionZ,k=l._rotation20*S._positionX+l._rotation21*S._positionY+l._rotation22*S._positionZ,w._positionX=N,w._positionY=R,w._positionZ=k,w._positionX+=l._positionX,w._positionY+=l._positionY,w._positionZ+=l._positionZ;let O,v,D,B,U,q;if(r._geom._computeAabb(r._aabb,r._ptransform),O=r._aabb._minX,v=r._aabb._minY,D=r._aabb._minZ,B=r._aabb._maxX,U=r._aabb._maxY,q=r._aabb._maxZ,r._geom._computeAabb(r._aabb,r._transform),r._aabb._minX=O<r._aabb._minX?O:r._aabb._minX,r._aabb._minY=v<r._aabb._minY?v:r._aabb._minY,r._aabb._minZ=D<r._aabb._minZ?D:r._aabb._minZ,r._aabb._maxX=B>r._aabb._maxX?B:r._aabb._maxX,r._aabb._maxY=U>r._aabb._maxY?U:r._aabb._maxY,r._aabb._maxZ=q>r._aabb._maxZ?q:r._aabb._maxZ,r._proxy!=null){let tt,Q,nt;tt=r._transform._positionX-r._ptransform._positionX,Q=r._transform._positionY-r._ptransform._positionY,nt=r._transform._positionZ-r._ptransform._positionZ;let H=r.displacement;H.x=tt,H.y=Q,H.z=nt,r._rigidBody._world._broadPhase.moveProxy(r._proxy,r._aabb,r.displacement)}r=_}this._sleeping=!1,this._sleepTime=0}getRotation(){let t=new I.common.Mat3;return t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22,t}getRotationTo(t){t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22}setRotation(t){this._transform._rotation00=t.e00,this._transform._rotation01=t.e01,this._transform._rotation02=t.e02,this._transform._rotation10=t.e10,this._transform._rotation11=t.e11,this._transform._rotation12=t.e12,this._transform._rotation20=t.e20,this._transform._rotation21=t.e21,this._transform._rotation22=t.e22;let e,i,n,s,o,r,_,a,l;e=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,i=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,n=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,s=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,o=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,r=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,_=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,a=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=e,this._invInertia01=i,this._invInertia02=n,this._invInertia10=s,this._invInertia11=o,this._invInertia12=r,this._invInertia20=_,this._invInertia21=a,this._invInertia22=l;let h,u,f,m,d,p,g,x,b;h=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,u=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,f=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,m=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,d=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,p=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,g=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,x=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,b=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=h,this._invInertia01=u,this._invInertia02=f,this._invInertia10=m,this._invInertia11=d,this._invInertia12=p,this._invInertia20=g,this._invInertia21=x,this._invInertia22=b,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let y=this._ptransform,z=this._transform;y._positionX=z._positionX,y._positionY=z._positionY,y._positionZ=z._positionZ,y._rotation00=z._rotation00,y._rotation01=z._rotation01,y._rotation02=z._rotation02,y._rotation10=z._rotation10,y._rotation11=z._rotation11,y._rotation12=z._rotation12,y._rotation20=z._rotation20,y._rotation21=z._rotation21,y._rotation22=z._rotation22;let M=this._shapeList;for(;M!=null;){let Y=M._next,X=this._ptransform,w=this._transform,S=M._ptransform,V=M._localTransform,F,C,A,Z,L,E,T,P,N;F=X._rotation00*V._rotation00+X._rotation01*V._rotation10+X._rotation02*V._rotation20,C=X._rotation00*V._rotation01+X._rotation01*V._rotation11+X._rotation02*V._rotation21,A=X._rotation00*V._rotation02+X._rotation01*V._rotation12+X._rotation02*V._rotation22,Z=X._rotation10*V._rotation00+X._rotation11*V._rotation10+X._rotation12*V._rotation20,L=X._rotation10*V._rotation01+X._rotation11*V._rotation11+X._rotation12*V._rotation21,E=X._rotation10*V._rotation02+X._rotation11*V._rotation12+X._rotation12*V._rotation22,T=X._rotation20*V._rotation00+X._rotation21*V._rotation10+X._rotation22*V._rotation20,P=X._rotation20*V._rotation01+X._rotation21*V._rotation11+X._rotation22*V._rotation21,N=X._rotation20*V._rotation02+X._rotation21*V._rotation12+X._rotation22*V._rotation22,S._rotation00=F,S._rotation01=C,S._rotation02=A,S._rotation10=Z,S._rotation11=L,S._rotation12=E,S._rotation20=T,S._rotation21=P,S._rotation22=N;let R,k,O;R=X._rotation00*V._positionX+X._rotation01*V._positionY+X._rotation02*V._positionZ,k=X._rotation10*V._positionX+X._rotation11*V._positionY+X._rotation12*V._positionZ,O=X._rotation20*V._positionX+X._rotation21*V._positionY+X._rotation22*V._positionZ,S._positionX=R,S._positionY=k,S._positionZ=O,S._positionX+=X._positionX,S._positionY+=X._positionY,S._positionZ+=X._positionZ;let v=M._transform,D=M._localTransform,B,U,q,tt,Q,nt,H,j,it;B=w._rotation00*D._rotation00+w._rotation01*D._rotation10+w._rotation02*D._rotation20,U=w._rotation00*D._rotation01+w._rotation01*D._rotation11+w._rotation02*D._rotation21,q=w._rotation00*D._rotation02+w._rotation01*D._rotation12+w._rotation02*D._rotation22,tt=w._rotation10*D._rotation00+w._rotation11*D._rotation10+w._rotation12*D._rotation20,Q=w._rotation10*D._rotation01+w._rotation11*D._rotation11+w._rotation12*D._rotation21,nt=w._rotation10*D._rotation02+w._rotation11*D._rotation12+w._rotation12*D._rotation22,H=w._rotation20*D._rotation00+w._rotation21*D._rotation10+w._rotation22*D._rotation20,j=w._rotation20*D._rotation01+w._rotation21*D._rotation11+w._rotation22*D._rotation21,it=w._rotation20*D._rotation02+w._rotation21*D._rotation12+w._rotation22*D._rotation22,v._rotation00=B,v._rotation01=U,v._rotation02=q,v._rotation10=tt,v._rotation11=Q,v._rotation12=nt,v._rotation20=H,v._rotation21=j,v._rotation22=it;let et,G,W;et=w._rotation00*D._positionX+w._rotation01*D._positionY+w._rotation02*D._positionZ,G=w._rotation10*D._positionX+w._rotation11*D._positionY+w._rotation12*D._positionZ,W=w._rotation20*D._positionX+w._rotation21*D._positionY+w._rotation22*D._positionZ,v._positionX=et,v._positionY=G,v._positionZ=W,v._positionX+=w._positionX,v._positionY+=w._positionY,v._positionZ+=w._positionZ;let lt,ht,ft,pt,K,J;if(M._geom._computeAabb(M._aabb,M._ptransform),lt=M._aabb._minX,ht=M._aabb._minY,ft=M._aabb._minZ,pt=M._aabb._maxX,K=M._aabb._maxY,J=M._aabb._maxZ,M._geom._computeAabb(M._aabb,M._transform),M._aabb._minX=lt<M._aabb._minX?lt:M._aabb._minX,M._aabb._minY=ht<M._aabb._minY?ht:M._aabb._minY,M._aabb._minZ=ft<M._aabb._minZ?ft:M._aabb._minZ,M._aabb._maxX=pt>M._aabb._maxX?pt:M._aabb._maxX,M._aabb._maxY=K>M._aabb._maxY?K:M._aabb._maxY,M._aabb._maxZ=J>M._aabb._maxZ?J:M._aabb._maxZ,M._proxy!=null){let rt,mt,xt;rt=M._transform._positionX-M._ptransform._positionX,mt=M._transform._positionY-M._ptransform._positionY,xt=M._transform._positionZ-M._ptransform._positionZ;let vt=M.displacement;vt.x=rt,vt.y=mt,vt.z=xt,M._rigidBody._world._broadPhase.moveProxy(M._proxy,M._aabb,M.displacement)}M=Y}this._sleeping=!1,this._sleepTime=0}setRotationXyz(t){let e,i,n;e=t.x,i=t.y,n=t.z;let s=Math.sin(e),o=Math.sin(i),r=Math.sin(n),_=Math.cos(e),a=Math.cos(i),l=Math.cos(n);this._transform._rotation00=a*l,this._transform._rotation01=-a*r,this._transform._rotation02=o,this._transform._rotation10=_*r+l*s*o,this._transform._rotation11=_*l-s*o*r,this._transform._rotation12=-a*s,this._transform._rotation20=s*r-_*l*o,this._transform._rotation21=l*s+_*o*r,this._transform._rotation22=_*a;let h,u,f,m,d,p,g,x,b;h=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,u=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,f=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,m=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,d=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,p=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,g=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,x=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,b=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=h,this._invInertia01=u,this._invInertia02=f,this._invInertia10=m,this._invInertia11=d,this._invInertia12=p,this._invInertia20=g,this._invInertia21=x,this._invInertia22=b;let y,z,M,Y,X,w,S,V,F;y=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,z=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,M=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,Y=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,X=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,w=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,S=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,V=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,F=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=y,this._invInertia01=z,this._invInertia02=M,this._invInertia10=Y,this._invInertia11=X,this._invInertia12=w,this._invInertia20=S,this._invInertia21=V,this._invInertia22=F,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let C=this._ptransform,A=this._transform;C._positionX=A._positionX,C._positionY=A._positionY,C._positionZ=A._positionZ,C._rotation00=A._rotation00,C._rotation01=A._rotation01,C._rotation02=A._rotation02,C._rotation10=A._rotation10,C._rotation11=A._rotation11,C._rotation12=A._rotation12,C._rotation20=A._rotation20,C._rotation21=A._rotation21,C._rotation22=A._rotation22;let Z=this._shapeList;for(;Z!=null;){let L=Z._next,E=this._ptransform,T=this._transform,P=Z._ptransform,N=Z._localTransform,R,k,O,v,D,B,U,q,tt;R=E._rotation00*N._rotation00+E._rotation01*N._rotation10+E._rotation02*N._rotation20,k=E._rotation00*N._rotation01+E._rotation01*N._rotation11+E._rotation02*N._rotation21,O=E._rotation00*N._rotation02+E._rotation01*N._rotation12+E._rotation02*N._rotation22,v=E._rotation10*N._rotation00+E._rotation11*N._rotation10+E._rotation12*N._rotation20,D=E._rotation10*N._rotation01+E._rotation11*N._rotation11+E._rotation12*N._rotation21,B=E._rotation10*N._rotation02+E._rotation11*N._rotation12+E._rotation12*N._rotation22,U=E._rotation20*N._rotation00+E._rotation21*N._rotation10+E._rotation22*N._rotation20,q=E._rotation20*N._rotation01+E._rotation21*N._rotation11+E._rotation22*N._rotation21,tt=E._rotation20*N._rotation02+E._rotation21*N._rotation12+E._rotation22*N._rotation22,P._rotation00=R,P._rotation01=k,P._rotation02=O,P._rotation10=v,P._rotation11=D,P._rotation12=B,P._rotation20=U,P._rotation21=q,P._rotation22=tt;let Q,nt,H;Q=E._rotation00*N._positionX+E._rotation01*N._positionY+E._rotation02*N._positionZ,nt=E._rotation10*N._positionX+E._rotation11*N._positionY+E._rotation12*N._positionZ,H=E._rotation20*N._positionX+E._rotation21*N._positionY+E._rotation22*N._positionZ,P._positionX=Q,P._positionY=nt,P._positionZ=H,P._positionX+=E._positionX,P._positionY+=E._positionY,P._positionZ+=E._positionZ;let j=Z._transform,it=Z._localTransform,et,G,W,lt,ht,ft,pt,K,J;et=T._rotation00*it._rotation00+T._rotation01*it._rotation10+T._rotation02*it._rotation20,G=T._rotation00*it._rotation01+T._rotation01*it._rotation11+T._rotation02*it._rotation21,W=T._rotation00*it._rotation02+T._rotation01*it._rotation12+T._rotation02*it._rotation22,lt=T._rotation10*it._rotation00+T._rotation11*it._rotation10+T._rotation12*it._rotation20,ht=T._rotation10*it._rotation01+T._rotation11*it._rotation11+T._rotation12*it._rotation21,ft=T._rotation10*it._rotation02+T._rotation11*it._rotation12+T._rotation12*it._rotation22,pt=T._rotation20*it._rotation00+T._rotation21*it._rotation10+T._rotation22*it._rotation20,K=T._rotation20*it._rotation01+T._rotation21*it._rotation11+T._rotation22*it._rotation21,J=T._rotation20*it._rotation02+T._rotation21*it._rotation12+T._rotation22*it._rotation22,j._rotation00=et,j._rotation01=G,j._rotation02=W,j._rotation10=lt,j._rotation11=ht,j._rotation12=ft,j._rotation20=pt,j._rotation21=K,j._rotation22=J;let rt,mt,xt;rt=T._rotation00*it._positionX+T._rotation01*it._positionY+T._rotation02*it._positionZ,mt=T._rotation10*it._positionX+T._rotation11*it._positionY+T._rotation12*it._positionZ,xt=T._rotation20*it._positionX+T._rotation21*it._positionY+T._rotation22*it._positionZ,j._positionX=rt,j._positionY=mt,j._positionZ=xt,j._positionX+=T._positionX,j._positionY+=T._positionY,j._positionZ+=T._positionZ;let vt,Mt,ut,Zt,zt,dt;if(Z._geom._computeAabb(Z._aabb,Z._ptransform),vt=Z._aabb._minX,Mt=Z._aabb._minY,ut=Z._aabb._minZ,Zt=Z._aabb._maxX,zt=Z._aabb._maxY,dt=Z._aabb._maxZ,Z._geom._computeAabb(Z._aabb,Z._transform),Z._aabb._minX=vt<Z._aabb._minX?vt:Z._aabb._minX,Z._aabb._minY=Mt<Z._aabb._minY?Mt:Z._aabb._minY,Z._aabb._minZ=ut<Z._aabb._minZ?ut:Z._aabb._minZ,Z._aabb._maxX=Zt>Z._aabb._maxX?Zt:Z._aabb._maxX,Z._aabb._maxY=zt>Z._aabb._maxY?zt:Z._aabb._maxY,Z._aabb._maxZ=dt>Z._aabb._maxZ?dt:Z._aabb._maxZ,Z._proxy!=null){let st,ct,_t;st=Z._transform._positionX-Z._ptransform._positionX,ct=Z._transform._positionY-Z._ptransform._positionY,_t=Z._transform._positionZ-Z._ptransform._positionZ;let Vt=Z.displacement;Vt.x=st,Vt.y=ct,Vt.z=_t,Z._rigidBody._world._broadPhase.moveProxy(Z._proxy,Z._aabb,Z.displacement)}Z=L}this._sleeping=!1,this._sleepTime=0}rotate(t){let e,i,n,s,o,r,_,a,l;e=t.e00,i=t.e01,n=t.e02,s=t.e10,o=t.e11,r=t.e12,_=t.e20,a=t.e21,l=t.e22;let h,u,f,m,d,p,g,x,b;h=e*this._transform._rotation00+i*this._transform._rotation10+n*this._transform._rotation20,u=e*this._transform._rotation01+i*this._transform._rotation11+n*this._transform._rotation21,f=e*this._transform._rotation02+i*this._transform._rotation12+n*this._transform._rotation22,m=s*this._transform._rotation00+o*this._transform._rotation10+r*this._transform._rotation20,d=s*this._transform._rotation01+o*this._transform._rotation11+r*this._transform._rotation21,p=s*this._transform._rotation02+o*this._transform._rotation12+r*this._transform._rotation22,g=_*this._transform._rotation00+a*this._transform._rotation10+l*this._transform._rotation20,x=_*this._transform._rotation01+a*this._transform._rotation11+l*this._transform._rotation21,b=_*this._transform._rotation02+a*this._transform._rotation12+l*this._transform._rotation22,this._transform._rotation00=h,this._transform._rotation01=u,this._transform._rotation02=f,this._transform._rotation10=m,this._transform._rotation11=d,this._transform._rotation12=p,this._transform._rotation20=g,this._transform._rotation21=x,this._transform._rotation22=b;let y,z,M,Y,X,w,S,V,F;y=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,z=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,M=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,Y=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,X=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,w=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,S=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,V=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,F=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=y,this._invInertia01=z,this._invInertia02=M,this._invInertia10=Y,this._invInertia11=X,this._invInertia12=w,this._invInertia20=S,this._invInertia21=V,this._invInertia22=F;let C,A,Z,L,E,T,P,N,R;C=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,A=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,Z=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,L=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,E=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,T=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,P=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,N=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,R=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=C,this._invInertia01=A,this._invInertia02=Z,this._invInertia10=L,this._invInertia11=E,this._invInertia12=T,this._invInertia20=P,this._invInertia21=N,this._invInertia22=R,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let k=this._ptransform,O=this._transform;k._positionX=O._positionX,k._positionY=O._positionY,k._positionZ=O._positionZ,k._rotation00=O._rotation00,k._rotation01=O._rotation01,k._rotation02=O._rotation02,k._rotation10=O._rotation10,k._rotation11=O._rotation11,k._rotation12=O._rotation12,k._rotation20=O._rotation20,k._rotation21=O._rotation21,k._rotation22=O._rotation22;let v=this._shapeList;for(;v!=null;){let D=v._next,B=this._ptransform,U=this._transform,q=v._ptransform,tt=v._localTransform,Q,nt,H,j,it,et,G,W,lt;Q=B._rotation00*tt._rotation00+B._rotation01*tt._rotation10+B._rotation02*tt._rotation20,nt=B._rotation00*tt._rotation01+B._rotation01*tt._rotation11+B._rotation02*tt._rotation21,H=B._rotation00*tt._rotation02+B._rotation01*tt._rotation12+B._rotation02*tt._rotation22,j=B._rotation10*tt._rotation00+B._rotation11*tt._rotation10+B._rotation12*tt._rotation20,it=B._rotation10*tt._rotation01+B._rotation11*tt._rotation11+B._rotation12*tt._rotation21,et=B._rotation10*tt._rotation02+B._rotation11*tt._rotation12+B._rotation12*tt._rotation22,G=B._rotation20*tt._rotation00+B._rotation21*tt._rotation10+B._rotation22*tt._rotation20,W=B._rotation20*tt._rotation01+B._rotation21*tt._rotation11+B._rotation22*tt._rotation21,lt=B._rotation20*tt._rotation02+B._rotation21*tt._rotation12+B._rotation22*tt._rotation22,q._rotation00=Q,q._rotation01=nt,q._rotation02=H,q._rotation10=j,q._rotation11=it,q._rotation12=et,q._rotation20=G,q._rotation21=W,q._rotation22=lt;let ht,ft,pt;ht=B._rotation00*tt._positionX+B._rotation01*tt._positionY+B._rotation02*tt._positionZ,ft=B._rotation10*tt._positionX+B._rotation11*tt._positionY+B._rotation12*tt._positionZ,pt=B._rotation20*tt._positionX+B._rotation21*tt._positionY+B._rotation22*tt._positionZ,q._positionX=ht,q._positionY=ft,q._positionZ=pt,q._positionX+=B._positionX,q._positionY+=B._positionY,q._positionZ+=B._positionZ;let K=v._transform,J=v._localTransform,rt,mt,xt,vt,Mt,ut,Zt,zt,dt;rt=U._rotation00*J._rotation00+U._rotation01*J._rotation10+U._rotation02*J._rotation20,mt=U._rotation00*J._rotation01+U._rotation01*J._rotation11+U._rotation02*J._rotation21,xt=U._rotation00*J._rotation02+U._rotation01*J._rotation12+U._rotation02*J._rotation22,vt=U._rotation10*J._rotation00+U._rotation11*J._rotation10+U._rotation12*J._rotation20,Mt=U._rotation10*J._rotation01+U._rotation11*J._rotation11+U._rotation12*J._rotation21,ut=U._rotation10*J._rotation02+U._rotation11*J._rotation12+U._rotation12*J._rotation22,Zt=U._rotation20*J._rotation00+U._rotation21*J._rotation10+U._rotation22*J._rotation20,zt=U._rotation20*J._rotation01+U._rotation21*J._rotation11+U._rotation22*J._rotation21,dt=U._rotation20*J._rotation02+U._rotation21*J._rotation12+U._rotation22*J._rotation22,K._rotation00=rt,K._rotation01=mt,K._rotation02=xt,K._rotation10=vt,K._rotation11=Mt,K._rotation12=ut,K._rotation20=Zt,K._rotation21=zt,K._rotation22=dt;let st,ct,_t;st=U._rotation00*J._positionX+U._rotation01*J._positionY+U._rotation02*J._positionZ,ct=U._rotation10*J._positionX+U._rotation11*J._positionY+U._rotation12*J._positionZ,_t=U._rotation20*J._positionX+U._rotation21*J._positionY+U._rotation22*J._positionZ,K._positionX=st,K._positionY=ct,K._positionZ=_t,K._positionX+=U._positionX,K._positionY+=U._positionY,K._positionZ+=U._positionZ;let Vt,At,St,Xt,Ft,ie;if(v._geom._computeAabb(v._aabb,v._ptransform),Vt=v._aabb._minX,At=v._aabb._minY,St=v._aabb._minZ,Xt=v._aabb._maxX,Ft=v._aabb._maxY,ie=v._aabb._maxZ,v._geom._computeAabb(v._aabb,v._transform),v._aabb._minX=Vt<v._aabb._minX?Vt:v._aabb._minX,v._aabb._minY=At<v._aabb._minY?At:v._aabb._minY,v._aabb._minZ=St<v._aabb._minZ?St:v._aabb._minZ,v._aabb._maxX=Xt>v._aabb._maxX?Xt:v._aabb._maxX,v._aabb._maxY=Ft>v._aabb._maxY?Ft:v._aabb._maxY,v._aabb._maxZ=ie>v._aabb._maxZ?ie:v._aabb._maxZ,v._proxy!=null){let ee,Ye,Ie;ee=v._transform._positionX-v._ptransform._positionX,Ye=v._transform._positionY-v._ptransform._positionY,Ie=v._transform._positionZ-v._ptransform._positionZ;let ue=v.displacement;ue.x=ee,ue.y=Ye,ue.z=Ie,v._rigidBody._world._broadPhase.moveProxy(v._proxy,v._aabb,v.displacement)}v=D}this._sleeping=!1,this._sleepTime=0}rotateXyz(t){let e,i,n,s,o,r,_,a,l,h,u,f;e=t.x,i=t.y,n=t.z;let m=Math.sin(e),d=Math.sin(i),p=Math.sin(n),g=Math.cos(e),x=Math.cos(i),b=Math.cos(n);s=x*b,o=-x*p,r=d,_=g*p+b*m*d,a=g*b-m*d*p,l=-x*m,h=m*p-g*b*d,u=b*m+g*d*p,f=g*x;let y,z,M,Y,X,w,S,V,F;y=s*this._transform._rotation00+o*this._transform._rotation10+r*this._transform._rotation20,z=s*this._transform._rotation01+o*this._transform._rotation11+r*this._transform._rotation21,M=s*this._transform._rotation02+o*this._transform._rotation12+r*this._transform._rotation22,Y=_*this._transform._rotation00+a*this._transform._rotation10+l*this._transform._rotation20,X=_*this._transform._rotation01+a*this._transform._rotation11+l*this._transform._rotation21,w=_*this._transform._rotation02+a*this._transform._rotation12+l*this._transform._rotation22,S=h*this._transform._rotation00+u*this._transform._rotation10+f*this._transform._rotation20,V=h*this._transform._rotation01+u*this._transform._rotation11+f*this._transform._rotation21,F=h*this._transform._rotation02+u*this._transform._rotation12+f*this._transform._rotation22,this._transform._rotation00=y,this._transform._rotation01=z,this._transform._rotation02=M,this._transform._rotation10=Y,this._transform._rotation11=X,this._transform._rotation12=w,this._transform._rotation20=S,this._transform._rotation21=V,this._transform._rotation22=F;let C,A,Z,L,E,T,P,N,R;C=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,A=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,Z=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,L=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,E=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,T=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,P=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,N=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,R=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=C,this._invInertia01=A,this._invInertia02=Z,this._invInertia10=L,this._invInertia11=E,this._invInertia12=T,this._invInertia20=P,this._invInertia21=N,this._invInertia22=R;let k,O,v,D,B,U,q,tt,Q;k=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,O=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,v=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,D=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,B=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,U=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,q=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,tt=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,Q=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=k,this._invInertia01=O,this._invInertia02=v,this._invInertia10=D,this._invInertia11=B,this._invInertia12=U,this._invInertia20=q,this._invInertia21=tt,this._invInertia22=Q,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let nt=this._ptransform,H=this._transform;nt._positionX=H._positionX,nt._positionY=H._positionY,nt._positionZ=H._positionZ,nt._rotation00=H._rotation00,nt._rotation01=H._rotation01,nt._rotation02=H._rotation02,nt._rotation10=H._rotation10,nt._rotation11=H._rotation11,nt._rotation12=H._rotation12,nt._rotation20=H._rotation20,nt._rotation21=H._rotation21,nt._rotation22=H._rotation22;let j=this._shapeList;for(;j!=null;){let it=j._next,et=this._ptransform,G=this._transform,W=j._ptransform,lt=j._localTransform,ht,ft,pt,K,J,rt,mt,xt,vt;ht=et._rotation00*lt._rotation00+et._rotation01*lt._rotation10+et._rotation02*lt._rotation20,ft=et._rotation00*lt._rotation01+et._rotation01*lt._rotation11+et._rotation02*lt._rotation21,pt=et._rotation00*lt._rotation02+et._rotation01*lt._rotation12+et._rotation02*lt._rotation22,K=et._rotation10*lt._rotation00+et._rotation11*lt._rotation10+et._rotation12*lt._rotation20,J=et._rotation10*lt._rotation01+et._rotation11*lt._rotation11+et._rotation12*lt._rotation21,rt=et._rotation10*lt._rotation02+et._rotation11*lt._rotation12+et._rotation12*lt._rotation22,mt=et._rotation20*lt._rotation00+et._rotation21*lt._rotation10+et._rotation22*lt._rotation20,xt=et._rotation20*lt._rotation01+et._rotation21*lt._rotation11+et._rotation22*lt._rotation21,vt=et._rotation20*lt._rotation02+et._rotation21*lt._rotation12+et._rotation22*lt._rotation22,W._rotation00=ht,W._rotation01=ft,W._rotation02=pt,W._rotation10=K,W._rotation11=J,W._rotation12=rt,W._rotation20=mt,W._rotation21=xt,W._rotation22=vt;let Mt,ut,Zt;Mt=et._rotation00*lt._positionX+et._rotation01*lt._positionY+et._rotation02*lt._positionZ,ut=et._rotation10*lt._positionX+et._rotation11*lt._positionY+et._rotation12*lt._positionZ,Zt=et._rotation20*lt._positionX+et._rotation21*lt._positionY+et._rotation22*lt._positionZ,W._positionX=Mt,W._positionY=ut,W._positionZ=Zt,W._positionX+=et._positionX,W._positionY+=et._positionY,W._positionZ+=et._positionZ;let zt=j._transform,dt=j._localTransform,st,ct,_t,Vt,At,St,Xt,Ft,ie;st=G._rotation00*dt._rotation00+G._rotation01*dt._rotation10+G._rotation02*dt._rotation20,ct=G._rotation00*dt._rotation01+G._rotation01*dt._rotation11+G._rotation02*dt._rotation21,_t=G._rotation00*dt._rotation02+G._rotation01*dt._rotation12+G._rotation02*dt._rotation22,Vt=G._rotation10*dt._rotation00+G._rotation11*dt._rotation10+G._rotation12*dt._rotation20,At=G._rotation10*dt._rotation01+G._rotation11*dt._rotation11+G._rotation12*dt._rotation21,St=G._rotation10*dt._rotation02+G._rotation11*dt._rotation12+G._rotation12*dt._rotation22,Xt=G._rotation20*dt._rotation00+G._rotation21*dt._rotation10+G._rotation22*dt._rotation20,Ft=G._rotation20*dt._rotation01+G._rotation21*dt._rotation11+G._rotation22*dt._rotation21,ie=G._rotation20*dt._rotation02+G._rotation21*dt._rotation12+G._rotation22*dt._rotation22,zt._rotation00=st,zt._rotation01=ct,zt._rotation02=_t,zt._rotation10=Vt,zt._rotation11=At,zt._rotation12=St,zt._rotation20=Xt,zt._rotation21=Ft,zt._rotation22=ie;let ee,Ye,Ie;ee=G._rotation00*dt._positionX+G._rotation01*dt._positionY+G._rotation02*dt._positionZ,Ye=G._rotation10*dt._positionX+G._rotation11*dt._positionY+G._rotation12*dt._positionZ,Ie=G._rotation20*dt._positionX+G._rotation21*dt._positionY+G._rotation22*dt._positionZ,zt._positionX=ee,zt._positionY=Ye,zt._positionZ=Ie,zt._positionX+=G._positionX,zt._positionY+=G._positionY,zt._positionZ+=G._positionZ;let ue,$t,Ht,me,ze,qe;if(j._geom._computeAabb(j._aabb,j._ptransform),ue=j._aabb._minX,$t=j._aabb._minY,Ht=j._aabb._minZ,me=j._aabb._maxX,ze=j._aabb._maxY,qe=j._aabb._maxZ,j._geom._computeAabb(j._aabb,j._transform),j._aabb._minX=ue<j._aabb._minX?ue:j._aabb._minX,j._aabb._minY=$t<j._aabb._minY?$t:j._aabb._minY,j._aabb._minZ=Ht<j._aabb._minZ?Ht:j._aabb._minZ,j._aabb._maxX=me>j._aabb._maxX?me:j._aabb._maxX,j._aabb._maxY=ze>j._aabb._maxY?ze:j._aabb._maxY,j._aabb._maxZ=qe>j._aabb._maxZ?qe:j._aabb._maxZ,j._proxy!=null){let Ee,Ut,at;Ee=j._transform._positionX-j._ptransform._positionX,Ut=j._transform._positionY-j._ptransform._positionY,at=j._transform._positionZ-j._ptransform._positionZ;let gt=j.displacement;gt.x=Ee,gt.y=Ut,gt.z=at,j._rigidBody._world._broadPhase.moveProxy(j._proxy,j._aabb,j.displacement)}j=it}this._sleeping=!1,this._sleepTime=0}getOrientation(){let t=new I.common.Quat,e,i,n,s,o=this._transform._rotation00,r=this._transform._rotation11,_=this._transform._rotation22,a=o+r+_,l;return a>0?(l=Math.sqrt(a+1),s=.5*l,l=.5/l,e=(this._transform._rotation21-this._transform._rotation12)*l,i=(this._transform._rotation02-this._transform._rotation20)*l,n=(this._transform._rotation10-this._transform._rotation01)*l):o>r?o>_?(l=Math.sqrt(o-r-_+1),e=.5*l,l=.5/l,i=(this._transform._rotation01+this._transform._rotation10)*l,n=(this._transform._rotation02+this._transform._rotation20)*l,s=(this._transform._rotation21-this._transform._rotation12)*l):(l=Math.sqrt(_-o-r+1),n=.5*l,l=.5/l,e=(this._transform._rotation02+this._transform._rotation20)*l,i=(this._transform._rotation12+this._transform._rotation21)*l,s=(this._transform._rotation10-this._transform._rotation01)*l):r>_?(l=Math.sqrt(r-_-o+1),i=.5*l,l=.5/l,e=(this._transform._rotation01+this._transform._rotation10)*l,n=(this._transform._rotation12+this._transform._rotation21)*l,s=(this._transform._rotation02-this._transform._rotation20)*l):(l=Math.sqrt(_-o-r+1),n=.5*l,l=.5/l,e=(this._transform._rotation02+this._transform._rotation20)*l,i=(this._transform._rotation12+this._transform._rotation21)*l,s=(this._transform._rotation10-this._transform._rotation01)*l),t.x=e,t.y=i,t.z=n,t.w=s,t}getOrientationTo(t){let e,i,n,s,o=this._transform._rotation00,r=this._transform._rotation11,_=this._transform._rotation22,a=o+r+_,l;a>0?(l=Math.sqrt(a+1),s=.5*l,l=.5/l,e=(this._transform._rotation21-this._transform._rotation12)*l,i=(this._transform._rotation02-this._transform._rotation20)*l,n=(this._transform._rotation10-this._transform._rotation01)*l):o>r?o>_?(l=Math.sqrt(o-r-_+1),e=.5*l,l=.5/l,i=(this._transform._rotation01+this._transform._rotation10)*l,n=(this._transform._rotation02+this._transform._rotation20)*l,s=(this._transform._rotation21-this._transform._rotation12)*l):(l=Math.sqrt(_-o-r+1),n=.5*l,l=.5/l,e=(this._transform._rotation02+this._transform._rotation20)*l,i=(this._transform._rotation12+this._transform._rotation21)*l,s=(this._transform._rotation10-this._transform._rotation01)*l):r>_?(l=Math.sqrt(r-_-o+1),i=.5*l,l=.5/l,e=(this._transform._rotation01+this._transform._rotation10)*l,n=(this._transform._rotation12+this._transform._rotation21)*l,s=(this._transform._rotation02-this._transform._rotation20)*l):(l=Math.sqrt(_-o-r+1),n=.5*l,l=.5/l,e=(this._transform._rotation02+this._transform._rotation20)*l,i=(this._transform._rotation12+this._transform._rotation21)*l,s=(this._transform._rotation10-this._transform._rotation01)*l),t.x=e,t.y=i,t.z=n,t.w=s}setOrientation(t){let e,i,n,s;e=t.x,i=t.y,n=t.z,s=t.w;let o=e,r=i,_=n,a=s,l=2*o,h=2*r,u=2*_,f=o*l,m=r*h,d=_*u,p=o*h,g=r*u,x=o*u,b=a*l,y=a*h,z=a*u;this._transform._rotation00=1-m-d,this._transform._rotation01=p-z,this._transform._rotation02=x+y,this._transform._rotation10=p+z,this._transform._rotation11=1-f-d,this._transform._rotation12=g-b,this._transform._rotation20=x-y,this._transform._rotation21=g+b,this._transform._rotation22=1-f-m;let M,Y,X,w,S,V,F,C,A;M=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,Y=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,X=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,w=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,S=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,V=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,F=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,C=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,A=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=M,this._invInertia01=Y,this._invInertia02=X,this._invInertia10=w,this._invInertia11=S,this._invInertia12=V,this._invInertia20=F,this._invInertia21=C,this._invInertia22=A;let Z,L,E,T,P,N,R,k,O;Z=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,L=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,E=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,T=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,P=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,N=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,R=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,k=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,O=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=Z,this._invInertia01=L,this._invInertia02=E,this._invInertia10=T,this._invInertia11=P,this._invInertia12=N,this._invInertia20=R,this._invInertia21=k,this._invInertia22=O,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let v=this._ptransform,D=this._transform;v._positionX=D._positionX,v._positionY=D._positionY,v._positionZ=D._positionZ,v._rotation00=D._rotation00,v._rotation01=D._rotation01,v._rotation02=D._rotation02,v._rotation10=D._rotation10,v._rotation11=D._rotation11,v._rotation12=D._rotation12,v._rotation20=D._rotation20,v._rotation21=D._rotation21,v._rotation22=D._rotation22;let B=this._shapeList;for(;B!=null;){let U=B._next,q=this._ptransform,tt=this._transform,Q=B._ptransform,nt=B._localTransform,H,j,it,et,G,W,lt,ht,ft;H=q._rotation00*nt._rotation00+q._rotation01*nt._rotation10+q._rotation02*nt._rotation20,j=q._rotation00*nt._rotation01+q._rotation01*nt._rotation11+q._rotation02*nt._rotation21,it=q._rotation00*nt._rotation02+q._rotation01*nt._rotation12+q._rotation02*nt._rotation22,et=q._rotation10*nt._rotation00+q._rotation11*nt._rotation10+q._rotation12*nt._rotation20,G=q._rotation10*nt._rotation01+q._rotation11*nt._rotation11+q._rotation12*nt._rotation21,W=q._rotation10*nt._rotation02+q._rotation11*nt._rotation12+q._rotation12*nt._rotation22,lt=q._rotation20*nt._rotation00+q._rotation21*nt._rotation10+q._rotation22*nt._rotation20,ht=q._rotation20*nt._rotation01+q._rotation21*nt._rotation11+q._rotation22*nt._rotation21,ft=q._rotation20*nt._rotation02+q._rotation21*nt._rotation12+q._rotation22*nt._rotation22,Q._rotation00=H,Q._rotation01=j,Q._rotation02=it,Q._rotation10=et,Q._rotation11=G,Q._rotation12=W,Q._rotation20=lt,Q._rotation21=ht,Q._rotation22=ft;let pt,K,J;pt=q._rotation00*nt._positionX+q._rotation01*nt._positionY+q._rotation02*nt._positionZ,K=q._rotation10*nt._positionX+q._rotation11*nt._positionY+q._rotation12*nt._positionZ,J=q._rotation20*nt._positionX+q._rotation21*nt._positionY+q._rotation22*nt._positionZ,Q._positionX=pt,Q._positionY=K,Q._positionZ=J,Q._positionX+=q._positionX,Q._positionY+=q._positionY,Q._positionZ+=q._positionZ;let rt=B._transform,mt=B._localTransform,xt,vt,Mt,ut,Zt,zt,dt,st,ct;xt=tt._rotation00*mt._rotation00+tt._rotation01*mt._rotation10+tt._rotation02*mt._rotation20,vt=tt._rotation00*mt._rotation01+tt._rotation01*mt._rotation11+tt._rotation02*mt._rotation21,Mt=tt._rotation00*mt._rotation02+tt._rotation01*mt._rotation12+tt._rotation02*mt._rotation22,ut=tt._rotation10*mt._rotation00+tt._rotation11*mt._rotation10+tt._rotation12*mt._rotation20,Zt=tt._rotation10*mt._rotation01+tt._rotation11*mt._rotation11+tt._rotation12*mt._rotation21,zt=tt._rotation10*mt._rotation02+tt._rotation11*mt._rotation12+tt._rotation12*mt._rotation22,dt=tt._rotation20*mt._rotation00+tt._rotation21*mt._rotation10+tt._rotation22*mt._rotation20,st=tt._rotation20*mt._rotation01+tt._rotation21*mt._rotation11+tt._rotation22*mt._rotation21,ct=tt._rotation20*mt._rotation02+tt._rotation21*mt._rotation12+tt._rotation22*mt._rotation22,rt._rotation00=xt,rt._rotation01=vt,rt._rotation02=Mt,rt._rotation10=ut,rt._rotation11=Zt,rt._rotation12=zt,rt._rotation20=dt,rt._rotation21=st,rt._rotation22=ct;let _t,Vt,At;_t=tt._rotation00*mt._positionX+tt._rotation01*mt._positionY+tt._rotation02*mt._positionZ,Vt=tt._rotation10*mt._positionX+tt._rotation11*mt._positionY+tt._rotation12*mt._positionZ,At=tt._rotation20*mt._positionX+tt._rotation21*mt._positionY+tt._rotation22*mt._positionZ,rt._positionX=_t,rt._positionY=Vt,rt._positionZ=At,rt._positionX+=tt._positionX,rt._positionY+=tt._positionY,rt._positionZ+=tt._positionZ;let St,Xt,Ft,ie,ee,Ye;if(B._geom._computeAabb(B._aabb,B._ptransform),St=B._aabb._minX,Xt=B._aabb._minY,Ft=B._aabb._minZ,ie=B._aabb._maxX,ee=B._aabb._maxY,Ye=B._aabb._maxZ,B._geom._computeAabb(B._aabb,B._transform),B._aabb._minX=St<B._aabb._minX?St:B._aabb._minX,B._aabb._minY=Xt<B._aabb._minY?Xt:B._aabb._minY,B._aabb._minZ=Ft<B._aabb._minZ?Ft:B._aabb._minZ,B._aabb._maxX=ie>B._aabb._maxX?ie:B._aabb._maxX,B._aabb._maxY=ee>B._aabb._maxY?ee:B._aabb._maxY,B._aabb._maxZ=Ye>B._aabb._maxZ?Ye:B._aabb._maxZ,B._proxy!=null){let Ie,ue,$t;Ie=B._transform._positionX-B._ptransform._positionX,ue=B._transform._positionY-B._ptransform._positionY,$t=B._transform._positionZ-B._ptransform._positionZ;let Ht=B.displacement;Ht.x=Ie,Ht.y=ue,Ht.z=$t,B._rigidBody._world._broadPhase.moveProxy(B._proxy,B._aabb,B.displacement)}B=U}this._sleeping=!1,this._sleepTime=0}getTransform(){let t=this._transform,e=new I.common.Transform;return e._positionX=t._positionX,e._positionY=t._positionY,e._positionZ=t._positionZ,e._rotation00=t._rotation00,e._rotation01=t._rotation01,e._rotation02=t._rotation02,e._rotation10=t._rotation10,e._rotation11=t._rotation11,e._rotation12=t._rotation12,e._rotation20=t._rotation20,e._rotation21=t._rotation21,e._rotation22=t._rotation22,e}getTransformTo(t){let e=this._transform;t._positionX=e._positionX,t._positionY=e._positionY,t._positionZ=e._positionZ,t._rotation00=e._rotation00,t._rotation01=e._rotation01,t._rotation02=e._rotation02,t._rotation10=e._rotation10,t._rotation11=e._rotation11,t._rotation12=e._rotation12,t._rotation20=e._rotation20,t._rotation21=e._rotation21,t._rotation22=e._rotation22}setTransform(t){this._transform._positionX=t._positionX,this._transform._positionY=t._positionY,this._transform._positionZ=t._positionZ,this._transform._rotation00=t._rotation00,this._transform._rotation01=t._rotation01,this._transform._rotation02=t._rotation02,this._transform._rotation10=t._rotation10,this._transform._rotation11=t._rotation11,this._transform._rotation12=t._rotation12,this._transform._rotation20=t._rotation20,this._transform._rotation21=t._rotation21,this._transform._rotation22=t._rotation22;let e,i,n,s,o,r,_,a,l;e=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,i=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,n=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,s=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,o=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,r=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,_=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,a=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=e,this._invInertia01=i,this._invInertia02=n,this._invInertia10=s,this._invInertia11=o,this._invInertia12=r,this._invInertia20=_,this._invInertia21=a,this._invInertia22=l;let h,u,f,m,d,p,g,x,b;h=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,u=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,f=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,m=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,d=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,p=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,g=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,x=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,b=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=h,this._invInertia01=u,this._invInertia02=f,this._invInertia10=m,this._invInertia11=d,this._invInertia12=p,this._invInertia20=g,this._invInertia21=x,this._invInertia22=b,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let y=this._ptransform,z=this._transform;y._positionX=z._positionX,y._positionY=z._positionY,y._positionZ=z._positionZ,y._rotation00=z._rotation00,y._rotation01=z._rotation01,y._rotation02=z._rotation02,y._rotation10=z._rotation10,y._rotation11=z._rotation11,y._rotation12=z._rotation12,y._rotation20=z._rotation20,y._rotation21=z._rotation21,y._rotation22=z._rotation22;let M=this._shapeList;for(;M!=null;){let Y=M._next,X=this._ptransform,w=this._transform,S=M._ptransform,V=M._localTransform,F,C,A,Z,L,E,T,P,N;F=X._rotation00*V._rotation00+X._rotation01*V._rotation10+X._rotation02*V._rotation20,C=X._rotation00*V._rotation01+X._rotation01*V._rotation11+X._rotation02*V._rotation21,A=X._rotation00*V._rotation02+X._rotation01*V._rotation12+X._rotation02*V._rotation22,Z=X._rotation10*V._rotation00+X._rotation11*V._rotation10+X._rotation12*V._rotation20,L=X._rotation10*V._rotation01+X._rotation11*V._rotation11+X._rotation12*V._rotation21,E=X._rotation10*V._rotation02+X._rotation11*V._rotation12+X._rotation12*V._rotation22,T=X._rotation20*V._rotation00+X._rotation21*V._rotation10+X._rotation22*V._rotation20,P=X._rotation20*V._rotation01+X._rotation21*V._rotation11+X._rotation22*V._rotation21,N=X._rotation20*V._rotation02+X._rotation21*V._rotation12+X._rotation22*V._rotation22,S._rotation00=F,S._rotation01=C,S._rotation02=A,S._rotation10=Z,S._rotation11=L,S._rotation12=E,S._rotation20=T,S._rotation21=P,S._rotation22=N;let R,k,O;R=X._rotation00*V._positionX+X._rotation01*V._positionY+X._rotation02*V._positionZ,k=X._rotation10*V._positionX+X._rotation11*V._positionY+X._rotation12*V._positionZ,O=X._rotation20*V._positionX+X._rotation21*V._positionY+X._rotation22*V._positionZ,S._positionX=R,S._positionY=k,S._positionZ=O,S._positionX+=X._positionX,S._positionY+=X._positionY,S._positionZ+=X._positionZ;let v=M._transform,D=M._localTransform,B,U,q,tt,Q,nt,H,j,it;B=w._rotation00*D._rotation00+w._rotation01*D._rotation10+w._rotation02*D._rotation20,U=w._rotation00*D._rotation01+w._rotation01*D._rotation11+w._rotation02*D._rotation21,q=w._rotation00*D._rotation02+w._rotation01*D._rotation12+w._rotation02*D._rotation22,tt=w._rotation10*D._rotation00+w._rotation11*D._rotation10+w._rotation12*D._rotation20,Q=w._rotation10*D._rotation01+w._rotation11*D._rotation11+w._rotation12*D._rotation21,nt=w._rotation10*D._rotation02+w._rotation11*D._rotation12+w._rotation12*D._rotation22,H=w._rotation20*D._rotation00+w._rotation21*D._rotation10+w._rotation22*D._rotation20,j=w._rotation20*D._rotation01+w._rotation21*D._rotation11+w._rotation22*D._rotation21,it=w._rotation20*D._rotation02+w._rotation21*D._rotation12+w._rotation22*D._rotation22,v._rotation00=B,v._rotation01=U,v._rotation02=q,v._rotation10=tt,v._rotation11=Q,v._rotation12=nt,v._rotation20=H,v._rotation21=j,v._rotation22=it;let et,G,W;et=w._rotation00*D._positionX+w._rotation01*D._positionY+w._rotation02*D._positionZ,G=w._rotation10*D._positionX+w._rotation11*D._positionY+w._rotation12*D._positionZ,W=w._rotation20*D._positionX+w._rotation21*D._positionY+w._rotation22*D._positionZ,v._positionX=et,v._positionY=G,v._positionZ=W,v._positionX+=w._positionX,v._positionY+=w._positionY,v._positionZ+=w._positionZ;let lt,ht,ft,pt,K,J;if(M._geom._computeAabb(M._aabb,M._ptransform),lt=M._aabb._minX,ht=M._aabb._minY,ft=M._aabb._minZ,pt=M._aabb._maxX,K=M._aabb._maxY,J=M._aabb._maxZ,M._geom._computeAabb(M._aabb,M._transform),M._aabb._minX=lt<M._aabb._minX?lt:M._aabb._minX,M._aabb._minY=ht<M._aabb._minY?ht:M._aabb._minY,M._aabb._minZ=ft<M._aabb._minZ?ft:M._aabb._minZ,M._aabb._maxX=pt>M._aabb._maxX?pt:M._aabb._maxX,M._aabb._maxY=K>M._aabb._maxY?K:M._aabb._maxY,M._aabb._maxZ=J>M._aabb._maxZ?J:M._aabb._maxZ,M._proxy!=null){let rt,mt,xt;rt=M._transform._positionX-M._ptransform._positionX,mt=M._transform._positionY-M._ptransform._positionY,xt=M._transform._positionZ-M._ptransform._positionZ;let vt=M.displacement;vt.x=rt,vt.y=mt,vt.z=xt,M._rigidBody._world._broadPhase.moveProxy(M._proxy,M._aabb,M.displacement)}M=Y}this._sleeping=!1,this._sleepTime=0}getMass(){return this._mass}getLocalInertia(){let t=new I.common.Mat3;return t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22,t}getLocalInertiaTo(t){t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22}getMassData(){let t=new I.dynamics.rigidbody.MassData;t.mass=this._mass;let e=t.localInertia;return e.e00=this._localInertia00,e.e01=this._localInertia01,e.e02=this._localInertia02,e.e10=this._localInertia10,e.e11=this._localInertia11,e.e12=this._localInertia12,e.e20=this._localInertia20,e.e21=this._localInertia21,e.e22=this._localInertia22,t}getMassDataTo(t){t.mass=this._mass;let e=t.localInertia;e.e00=this._localInertia00,e.e01=this._localInertia01,e.e02=this._localInertia02,e.e10=this._localInertia10,e.e11=this._localInertia11,e.e12=this._localInertia12,e.e20=this._localInertia20,e.e21=this._localInertia21,e.e22=this._localInertia22}setMassData(t){this._mass=t.mass;let e=t.localInertia;if(this._localInertia00=e.e00,this._localInertia01=e.e01,this._localInertia02=e.e02,this._localInertia10=e.e10,this._localInertia11=e.e11,this._localInertia12=e.e12,this._localInertia20=e.e20,this._localInertia21=e.e21,this._localInertia22=e.e22,this._mass>0&&this._localInertia00*(this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21)-this._localInertia01*(this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20)+this._localInertia02*(this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20)>0&&this._type==0){this._invMass=1/this._mass;let z=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,M=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,Y=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,X=this._localInertia00*z-this._localInertia01*M+this._localInertia02*Y;(X<-1e-32||X>1e-32)&&(X=1/X),this._invLocalInertia00=z*X,this._invLocalInertia01=-(this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21)*X,this._invLocalInertia02=(this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11)*X,this._invLocalInertia10=-M*X,this._invLocalInertia11=(this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20)*X,this._invLocalInertia12=-(this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10)*X,this._invLocalInertia20=Y*X,this._invLocalInertia21=-(this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20)*X,this._invLocalInertia22=(this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10)*X,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._type==0&&(this._type=1);let i,n,s,o,r,_,a,l,h;i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,n=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,s=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,r=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,_=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,a=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,l=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=n,this._invInertia02=s,this._invInertia10=o,this._invInertia11=r,this._invInertia12=_,this._invInertia20=a,this._invInertia21=l,this._invInertia22=h;let u,f,m,d,p,g,x,b,y;u=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,f=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,d=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,p=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,g=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,x=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,b=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,y=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=u,this._invInertia01=f,this._invInertia02=m,this._invInertia10=d,this._invInertia11=p,this._invInertia12=g,this._invInertia20=x,this._invInertia21=b,this._invInertia22=y,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getRotationFactor(){let t=this._rotFactor;return new I.common.Vec3(t.x,t.y,t.z)}setRotationFactor(t){let e=this._rotFactor;e.x=t.x,e.y=t.y,e.z=t.z;let i,n,s,o,r,_,a,l,h;i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,n=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,s=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,r=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,_=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,a=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,l=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=n,this._invInertia02=s,this._invInertia10=o,this._invInertia11=r,this._invInertia12=_,this._invInertia20=a,this._invInertia21=l,this._invInertia22=h;let u,f,m,d,p,g,x,b,y;u=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,f=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,d=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,p=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,g=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,x=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,b=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,y=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=u,this._invInertia01=f,this._invInertia02=m,this._invInertia10=d,this._invInertia11=p,this._invInertia12=g,this._invInertia20=x,this._invInertia21=b,this._invInertia22=y,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getLinearVelocity(){let t=new I.common.Vec3;return t.x=this._velX,t.y=this._velY,t.z=this._velZ,t}getLinearVelocityTo(t){t.x=this._velX,t.y=this._velY,t.z=this._velZ}setLinearVelocity(t){this._type==1?(this._velX=0,this._velY=0,this._velZ=0):(this._velX=t.x,this._velY=t.y,this._velZ=t.z),this._sleeping=!1,this._sleepTime=0}getAngularVelocity(){let t=new I.common.Vec3;return t.x=this._angVelX,t.y=this._angVelY,t.z=this._angVelZ,t}getAngularVelocityTo(t){t.x=this._velX,t.y=this._velY,t.z=this._velZ}setAngularVelocity(t){this._type==1?(this._angVelX=0,this._angVelY=0,this._angVelZ=0):(this._angVelX=t.x,this._angVelY=t.y,this._angVelZ=t.z),this._sleeping=!1,this._sleepTime=0}addLinearVelocity(t){if(this._type!=1){let e,i,n;e=t.x,i=t.y,n=t.z,this._velX+=e,this._velY+=i,this._velZ+=n}this._sleeping=!1,this._sleepTime=0}addAngularVelocity(t){if(this._type!=1){let e,i,n;e=t.x,i=t.y,n=t.z,this._angVelX+=e,this._angVelY+=i,this._angVelZ+=n}this._sleeping=!1,this._sleepTime=0}applyImpulse(t,e){let i,n,s;i=t.x,n=t.y,s=t.z,this._velX+=i*this._invMass,this._velY+=n*this._invMass,this._velZ+=s*this._invMass;let o,r,_,a,l,h;a=e.x,l=e.y,h=e.z,a-=this._transform._positionX,l-=this._transform._positionY,h-=this._transform._positionZ,o=l*s-h*n,r=h*i-a*s,_=a*n-l*i;let u,f,m;u=this._invInertia00*o+this._invInertia01*r+this._invInertia02*_,f=this._invInertia10*o+this._invInertia11*r+this._invInertia12*_,m=this._invInertia20*o+this._invInertia21*r+this._invInertia22*_,o=u,r=f,_=m,this._angVelX+=o,this._angVelY+=r,this._angVelZ+=_,this._sleeping=!1,this._sleepTime=0}applyLinearImpulse(t){let e,i,n;e=t.x,i=t.y,n=t.z,this._velX+=e*this._invMass,this._velY+=i*this._invMass,this._velZ+=n*this._invMass,this._sleeping=!1,this._sleepTime=0}applyAngularImpulse(t){let e,i,n;e=t.x,i=t.y,n=t.z;let s,o,r;s=this._invInertia00*e+this._invInertia01*i+this._invInertia02*n,o=this._invInertia10*e+this._invInertia11*i+this._invInertia12*n,r=this._invInertia20*e+this._invInertia21*i+this._invInertia22*n,e=s,i=o,n=r,this._angVelX+=e,this._angVelY+=i,this._angVelZ+=n,this._sleeping=!1,this._sleepTime=0}applyForce(t,e){let i,n,s;i=t.x,n=t.y,s=t.z,this._forceX+=i,this._forceY+=n,this._forceZ+=s;let o,r,_,a,l,h;a=e.x,l=e.y,h=e.z,a-=this._transform._positionX,l-=this._transform._positionY,h-=this._transform._positionZ,o=l*s-h*n,r=h*i-a*s,_=a*n-l*i,this._torqueX+=o,this._torqueY+=r,this._torqueZ+=_,this._sleeping=!1,this._sleepTime=0}applyForceToCenter(t){let e,i,n;e=t.x,i=t.y,n=t.z,this._forceX+=e,this._forceY+=i,this._forceZ+=n,this._sleeping=!1,this._sleepTime=0}applyTorque(t){let e,i,n;e=t.x,i=t.y,n=t.z,this._torqueX+=e,this._torqueY+=i,this._torqueZ+=n,this._sleeping=!1,this._sleepTime=0}getLinearContactImpulse(){let t=new I.common.Vec3;return t.x=this._linearContactImpulseX,t.y=this._linearContactImpulseY,t.z=this._linearContactImpulseZ,t}getLinearContactImpulseTo(t){t.x=this._linearContactImpulseX,t.y=this._linearContactImpulseY,t.z=this._linearContactImpulseZ}getAngularContactImpulse(){let t=new I.common.Vec3;return t.x=this._angularContactImpulseX,t.y=this._angularContactImpulseY,t.z=this._angularContactImpulseZ,t}getAngularContactImpulseTo(t){t.x=this._angularContactImpulseX,t.y=this._angularContactImpulseY,t.z=this._angularContactImpulseZ}getGravityScale(){return this._gravityScale}setGravityScale(t){this._gravityScale=t,this._sleeping=!1,this._sleepTime=0}getLocalPoint(t){let e,i,n;e=t.x,i=t.y,n=t.z,e-=this._transform._positionX,i-=this._transform._positionY,n-=this._transform._positionZ;let s,o,r;s=this._transform._rotation00*e+this._transform._rotation10*i+this._transform._rotation20*n,o=this._transform._rotation01*e+this._transform._rotation11*i+this._transform._rotation21*n,r=this._transform._rotation02*e+this._transform._rotation12*i+this._transform._rotation22*n,e=s,i=o,n=r;let _=new I.common.Vec3;return _.x=e,_.y=i,_.z=n,_}getLocalPointTo(t,e){let i,n,s;i=t.x,n=t.y,s=t.z,i-=this._transform._positionX,n-=this._transform._positionY,s-=this._transform._positionZ;let o,r,_;o=this._transform._rotation00*i+this._transform._rotation10*n+this._transform._rotation20*s,r=this._transform._rotation01*i+this._transform._rotation11*n+this._transform._rotation21*s,_=this._transform._rotation02*i+this._transform._rotation12*n+this._transform._rotation22*s,i=o,n=r,s=_,e.x=i,e.y=n,e.z=s}getLocalVector(t){let e,i,n;e=t.x,i=t.y,n=t.z;let s,o,r;s=this._transform._rotation00*e+this._transform._rotation10*i+this._transform._rotation20*n,o=this._transform._rotation01*e+this._transform._rotation11*i+this._transform._rotation21*n,r=this._transform._rotation02*e+this._transform._rotation12*i+this._transform._rotation22*n,e=s,i=o,n=r;let _=new I.common.Vec3;return _.x=e,_.y=i,_.z=n,_}getLocalVectorTo(t,e){let i,n,s;i=t.x,n=t.y,s=t.z;let o,r,_;o=this._transform._rotation00*i+this._transform._rotation10*n+this._transform._rotation20*s,r=this._transform._rotation01*i+this._transform._rotation11*n+this._transform._rotation21*s,_=this._transform._rotation02*i+this._transform._rotation12*n+this._transform._rotation22*s,i=o,n=r,s=_,e.x=i,e.y=n,e.z=s}getWorldPoint(t){let e,i,n;e=t.x,i=t.y,n=t.z;let s,o,r;s=this._transform._rotation00*e+this._transform._rotation01*i+this._transform._rotation02*n,o=this._transform._rotation10*e+this._transform._rotation11*i+this._transform._rotation12*n,r=this._transform._rotation20*e+this._transform._rotation21*i+this._transform._rotation22*n,e=s,i=o,n=r,e+=this._transform._positionX,i+=this._transform._positionY,n+=this._transform._positionZ;let _=new I.common.Vec3;return _.x=e,_.y=i,_.z=n,_}getWorldPointTo(t,e){let i,n,s;i=t.x,n=t.y,s=t.z;let o,r,_;o=this._transform._rotation00*i+this._transform._rotation01*n+this._transform._rotation02*s,r=this._transform._rotation10*i+this._transform._rotation11*n+this._transform._rotation12*s,_=this._transform._rotation20*i+this._transform._rotation21*n+this._transform._rotation22*s,i=o,n=r,s=_,i+=this._transform._positionX,n+=this._transform._positionY,s+=this._transform._positionZ,e.x=i,e.y=n,e.z=s}getWorldVector(t){let e,i,n;e=t.x,i=t.y,n=t.z;let s,o,r;s=this._transform._rotation00*e+this._transform._rotation01*i+this._transform._rotation02*n,o=this._transform._rotation10*e+this._transform._rotation11*i+this._transform._rotation12*n,r=this._transform._rotation20*e+this._transform._rotation21*i+this._transform._rotation22*n,e=s,i=o,n=r;let _=new I.common.Vec3;return _.x=e,_.y=i,_.z=n,_}getWorldVectorTo(t,e){let i,n,s;i=t.x,n=t.y,s=t.z;let o,r,_;o=this._transform._rotation00*i+this._transform._rotation01*n+this._transform._rotation02*s,r=this._transform._rotation10*i+this._transform._rotation11*n+this._transform._rotation12*s,_=this._transform._rotation20*i+this._transform._rotation21*n+this._transform._rotation22*s,i=o,n=r,s=_,e.x=i,e.y=n,e.z=s}getNumShapes(){return this._numShapes}getShapeList(){return this._shapeList}getNumContactLinks(){return this._numContactLinks}getContactLinkList(){return this._contactLinkList}getNumJointLinks(){return this._numJointLinks}getJointLinkList(){return this._jointLinkList}addShape(t){if(this._shapeList==null?(this._shapeList=t,this._shapeListLast=t):(this._shapeListLast._next=t,t._prev=this._shapeListLast,this._shapeListLast=t),this._numShapes++,t._rigidBody=this,this._world!=null){let i=this._world;t._proxy=i._broadPhase.createProxy(t,t._aabb),t._id=i._shapeIdCount++,i._numShapes++}this.updateMass();let e=this._shapeList;for(;e!=null;){let i=e._next,n=this._ptransform,s=this._transform,o=e._ptransform,r=e._localTransform,_,a,l,h,u,f,m,d,p;_=n._rotation00*r._rotation00+n._rotation01*r._rotation10+n._rotation02*r._rotation20,a=n._rotation00*r._rotation01+n._rotation01*r._rotation11+n._rotation02*r._rotation21,l=n._rotation00*r._rotation02+n._rotation01*r._rotation12+n._rotation02*r._rotation22,h=n._rotation10*r._rotation00+n._rotation11*r._rotation10+n._rotation12*r._rotation20,u=n._rotation10*r._rotation01+n._rotation11*r._rotation11+n._rotation12*r._rotation21,f=n._rotation10*r._rotation02+n._rotation11*r._rotation12+n._rotation12*r._rotation22,m=n._rotation20*r._rotation00+n._rotation21*r._rotation10+n._rotation22*r._rotation20,d=n._rotation20*r._rotation01+n._rotation21*r._rotation11+n._rotation22*r._rotation21,p=n._rotation20*r._rotation02+n._rotation21*r._rotation12+n._rotation22*r._rotation22,o._rotation00=_,o._rotation01=a,o._rotation02=l,o._rotation10=h,o._rotation11=u,o._rotation12=f,o._rotation20=m,o._rotation21=d,o._rotation22=p;let g,x,b;g=n._rotation00*r._positionX+n._rotation01*r._positionY+n._rotation02*r._positionZ,x=n._rotation10*r._positionX+n._rotation11*r._positionY+n._rotation12*r._positionZ,b=n._rotation20*r._positionX+n._rotation21*r._positionY+n._rotation22*r._positionZ,o._positionX=g,o._positionY=x,o._positionZ=b,o._positionX+=n._positionX,o._positionY+=n._positionY,o._positionZ+=n._positionZ;let y=e._transform,z=e._localTransform,M,Y,X,w,S,V,F,C,A;M=s._rotation00*z._rotation00+s._rotation01*z._rotation10+s._rotation02*z._rotation20,Y=s._rotation00*z._rotation01+s._rotation01*z._rotation11+s._rotation02*z._rotation21,X=s._rotation00*z._rotation02+s._rotation01*z._rotation12+s._rotation02*z._rotation22,w=s._rotation10*z._rotation00+s._rotation11*z._rotation10+s._rotation12*z._rotation20,S=s._rotation10*z._rotation01+s._rotation11*z._rotation11+s._rotation12*z._rotation21,V=s._rotation10*z._rotation02+s._rotation11*z._rotation12+s._rotation12*z._rotation22,F=s._rotation20*z._rotation00+s._rotation21*z._rotation10+s._rotation22*z._rotation20,C=s._rotation20*z._rotation01+s._rotation21*z._rotation11+s._rotation22*z._rotation21,A=s._rotation20*z._rotation02+s._rotation21*z._rotation12+s._rotation22*z._rotation22,y._rotation00=M,y._rotation01=Y,y._rotation02=X,y._rotation10=w,y._rotation11=S,y._rotation12=V,y._rotation20=F,y._rotation21=C,y._rotation22=A;let Z,L,E;Z=s._rotation00*z._positionX+s._rotation01*z._positionY+s._rotation02*z._positionZ,L=s._rotation10*z._positionX+s._rotation11*z._positionY+s._rotation12*z._positionZ,E=s._rotation20*z._positionX+s._rotation21*z._positionY+s._rotation22*z._positionZ,y._positionX=Z,y._positionY=L,y._positionZ=E,y._positionX+=s._positionX,y._positionY+=s._positionY,y._positionZ+=s._positionZ;let T,P,N,R,k,O;if(e._geom._computeAabb(e._aabb,e._ptransform),T=e._aabb._minX,P=e._aabb._minY,N=e._aabb._minZ,R=e._aabb._maxX,k=e._aabb._maxY,O=e._aabb._maxZ,e._geom._computeAabb(e._aabb,e._transform),e._aabb._minX=T<e._aabb._minX?T:e._aabb._minX,e._aabb._minY=P<e._aabb._minY?P:e._aabb._minY,e._aabb._minZ=N<e._aabb._minZ?N:e._aabb._minZ,e._aabb._maxX=R>e._aabb._maxX?R:e._aabb._maxX,e._aabb._maxY=k>e._aabb._maxY?k:e._aabb._maxY,e._aabb._maxZ=O>e._aabb._maxZ?O:e._aabb._maxZ,e._proxy!=null){let v,D,B;v=e._transform._positionX-e._ptransform._positionX,D=e._transform._positionY-e._ptransform._positionY,B=e._transform._positionZ-e._ptransform._positionZ;let U=e.displacement;U.x=v,U.y=D,U.z=B,e._rigidBody._world._broadPhase.moveProxy(e._proxy,e._aabb,e.displacement)}e=i}}removeShape(t){let e=t._prev,i=t._next;if(e!=null&&(e._next=i),i!=null&&(i._prev=e),t==this._shapeList&&(this._shapeList=this._shapeList._next),t==this._shapeListLast&&(this._shapeListLast=this._shapeListLast._prev),t._next=null,t._prev=null,this._numShapes--,t._rigidBody=null,this._world!=null){let s=this._world;s._broadPhase.destroyProxy(t._proxy),t._proxy=null,t._id=-1;let o=t._rigidBody._contactLinkList;for(;o!=null;){let r=o._next,_=o._contact;if(_._s1==t||_._s2==t){let a=o._other;a._sleeping=!1,a._sleepTime=0;let l=s._contactManager,h=_._prev,u=_._next;if(h!=null&&(h._next=u),u!=null&&(u._prev=h),_==l._contactList&&(l._contactList=l._contactList._next),_==l._contactListLast&&(l._contactListLast=l._contactListLast._prev),_._next=null,_._prev=null,_._touching){let x=_._s1._contactCallback,b=_._s2._contactCallback;x==b&&(b=null),x!=null&&x.endContact(_),b!=null&&b.endContact(_)}let f=_._link1._prev,m=_._link1._next;f!=null&&(f._next=m),m!=null&&(m._prev=f),_._link1==_._b1._contactLinkList&&(_._b1._contactLinkList=_._b1._contactLinkList._next),_._link1==_._b1._contactLinkListLast&&(_._b1._contactLinkListLast=_._b1._contactLinkListLast._prev),_._link1._next=null,_._link1._prev=null;let d=_._link2._prev,p=_._link2._next;d!=null&&(d._next=p),p!=null&&(p._prev=d),_._link2==_._b2._contactLinkList&&(_._b2._contactLinkList=_._b2._contactLinkList._next),_._link2==_._b2._contactLinkListLast&&(_._b2._contactLinkListLast=_._b2._contactLinkListLast._prev),_._link2._next=null,_._link2._prev=null,_._b1._numContactLinks--,_._b2._numContactLinks--,_._link1._other=null,_._link2._other=null,_._link1._contact=null,_._link2._contact=null,_._s1=null,_._s2=null,_._b1=null,_._b2=null,_._touching=!1,_._cachedDetectorData._clear(),_._manifold._clear(),_._detector=null;let g=_._contactConstraint;g._s1=null,g._s2=null,g._b1=null,g._b2=null,g._tf1=null,g._tf2=null,_._next=l._contactPool,l._contactPool=_,l._numContacts--}o=r}s._numShapes--}this.updateMass();let n=this._shapeList;for(;n!=null;){let s=n._next,o=this._ptransform,r=this._transform,_=n._ptransform,a=n._localTransform,l,h,u,f,m,d,p,g,x;l=o._rotation00*a._rotation00+o._rotation01*a._rotation10+o._rotation02*a._rotation20,h=o._rotation00*a._rotation01+o._rotation01*a._rotation11+o._rotation02*a._rotation21,u=o._rotation00*a._rotation02+o._rotation01*a._rotation12+o._rotation02*a._rotation22,f=o._rotation10*a._rotation00+o._rotation11*a._rotation10+o._rotation12*a._rotation20,m=o._rotation10*a._rotation01+o._rotation11*a._rotation11+o._rotation12*a._rotation21,d=o._rotation10*a._rotation02+o._rotation11*a._rotation12+o._rotation12*a._rotation22,p=o._rotation20*a._rotation00+o._rotation21*a._rotation10+o._rotation22*a._rotation20,g=o._rotation20*a._rotation01+o._rotation21*a._rotation11+o._rotation22*a._rotation21,x=o._rotation20*a._rotation02+o._rotation21*a._rotation12+o._rotation22*a._rotation22,_._rotation00=l,_._rotation01=h,_._rotation02=u,_._rotation10=f,_._rotation11=m,_._rotation12=d,_._rotation20=p,_._rotation21=g,_._rotation22=x;let b,y,z;b=o._rotation00*a._positionX+o._rotation01*a._positionY+o._rotation02*a._positionZ,y=o._rotation10*a._positionX+o._rotation11*a._positionY+o._rotation12*a._positionZ,z=o._rotation20*a._positionX+o._rotation21*a._positionY+o._rotation22*a._positionZ,_._positionX=b,_._positionY=y,_._positionZ=z,_._positionX+=o._positionX,_._positionY+=o._positionY,_._positionZ+=o._positionZ;let M=n._transform,Y=n._localTransform,X,w,S,V,F,C,A,Z,L;X=r._rotation00*Y._rotation00+r._rotation01*Y._rotation10+r._rotation02*Y._rotation20,w=r._rotation00*Y._rotation01+r._rotation01*Y._rotation11+r._rotation02*Y._rotation21,S=r._rotation00*Y._rotation02+r._rotation01*Y._rotation12+r._rotation02*Y._rotation22,V=r._rotation10*Y._rotation00+r._rotation11*Y._rotation10+r._rotation12*Y._rotation20,F=r._rotation10*Y._rotation01+r._rotation11*Y._rotation11+r._rotation12*Y._rotation21,C=r._rotation10*Y._rotation02+r._rotation11*Y._rotation12+r._rotation12*Y._rotation22,A=r._rotation20*Y._rotation00+r._rotation21*Y._rotation10+r._rotation22*Y._rotation20,Z=r._rotation20*Y._rotation01+r._rotation21*Y._rotation11+r._rotation22*Y._rotation21,L=r._rotation20*Y._rotation02+r._rotation21*Y._rotation12+r._rotation22*Y._rotation22,M._rotation00=X,M._rotation01=w,M._rotation02=S,M._rotation10=V,M._rotation11=F,M._rotation12=C,M._rotation20=A,M._rotation21=Z,M._rotation22=L;let E,T,P;E=r._rotation00*Y._positionX+r._rotation01*Y._positionY+r._rotation02*Y._positionZ,T=r._rotation10*Y._positionX+r._rotation11*Y._positionY+r._rotation12*Y._positionZ,P=r._rotation20*Y._positionX+r._rotation21*Y._positionY+r._rotation22*Y._positionZ,M._positionX=E,M._positionY=T,M._positionZ=P,M._positionX+=r._positionX,M._positionY+=r._positionY,M._positionZ+=r._positionZ;let N,R,k,O,v,D;if(n._geom._computeAabb(n._aabb,n._ptransform),N=n._aabb._minX,R=n._aabb._minY,k=n._aabb._minZ,O=n._aabb._maxX,v=n._aabb._maxY,D=n._aabb._maxZ,n._geom._computeAabb(n._aabb,n._transform),n._aabb._minX=N<n._aabb._minX?N:n._aabb._minX,n._aabb._minY=R<n._aabb._minY?R:n._aabb._minY,n._aabb._minZ=k<n._aabb._minZ?k:n._aabb._minZ,n._aabb._maxX=O>n._aabb._maxX?O:n._aabb._maxX,n._aabb._maxY=v>n._aabb._maxY?v:n._aabb._maxY,n._aabb._maxZ=D>n._aabb._maxZ?D:n._aabb._maxZ,n._proxy!=null){let B,U,q;B=n._transform._positionX-n._ptransform._positionX,U=n._transform._positionY-n._ptransform._positionY,q=n._transform._positionZ-n._ptransform._positionZ;let tt=n.displacement;tt.x=B,tt.y=U,tt.z=q,n._rigidBody._world._broadPhase.moveProxy(n._proxy,n._aabb,n.displacement)}n=s}}getType(){return this._type}setType(t){this._type=t,this.updateMass()}wakeUp(){this._sleeping=!1,this._sleepTime=0}sleep(){this._sleeping=!0,this._sleepTime=0}isSleeping(){return this._sleeping}getSleepTime(){return this._sleepTime}setAutoSleep(t){this._autoSleep=t,this._sleeping=!1,this._sleepTime=0}getLinearDamping(){return this._linearDamping}setLinearDamping(t){this._linearDamping=t}getAngularDamping(){return this._angularDamping}setAngularDamping(t){this._angularDamping=t}getPrev(){return this._prev}getNext(){return this._next}};I.dynamics.rigidbody.RigidBodyConfig=class{constructor(){this.position=new I.common.Vec3,this.rotation=new I.common.Mat3,this.linearVelocity=new I.common.Vec3,this.angularVelocity=new I.common.Vec3,this.type=0,this.autoSleep=!0,this.linearDamping=0,this.angularDamping=0}};I.dynamics.rigidbody.RigidBodyType=class{};I.dynamics.rigidbody.Shape=class{constructor(t){this._id=-1,this._localTransform=new I.common.Transform,this._ptransform=new I.common.Transform,this._transform=new I.common.Transform;let e=t.position;this._localTransform._positionX=e.x,this._localTransform._positionY=e.y,this._localTransform._positionZ=e.z;let i=t.rotation;this._localTransform._rotation00=i.e00,this._localTransform._rotation01=i.e01,this._localTransform._rotation02=i.e02,this._localTransform._rotation10=i.e10,this._localTransform._rotation11=i.e11,this._localTransform._rotation12=i.e12,this._localTransform._rotation20=i.e20,this._localTransform._rotation21=i.e21,this._localTransform._rotation22=i.e22;let n=this._ptransform,s=this._localTransform;n._positionX=s._positionX,n._positionY=s._positionY,n._positionZ=s._positionZ,n._rotation00=s._rotation00,n._rotation01=s._rotation01,n._rotation02=s._rotation02,n._rotation10=s._rotation10,n._rotation11=s._rotation11,n._rotation12=s._rotation12,n._rotation20=s._rotation20,n._rotation21=s._rotation21,n._rotation22=s._rotation22;let o=this._transform,r=this._localTransform;o._positionX=r._positionX,o._positionY=r._positionY,o._positionZ=r._positionZ,o._rotation00=r._rotation00,o._rotation01=r._rotation01,o._rotation02=r._rotation02,o._rotation10=r._rotation10,o._rotation11=r._rotation11,o._rotation12=r._rotation12,o._rotation20=r._rotation20,o._rotation21=r._rotation21,o._rotation22=r._rotation22,this._restitution=t.restitution,this._friction=t.friction,this._density=t.density,this._geom=t.geometry,this._collisionGroup=t.collisionGroup,this._collisionMask=t.collisionMask,this._contactCallback=t.contactCallback,this._aabb=new I.collision.geometry.Aabb,this._proxy=null,this.displacement=new I.common.Vec3}getFriction(){return this._friction}setFriction(t){this._friction=t}getRestitution(){return this._restitution}setRestitution(t){this._restitution=t}getLocalTransform(){let t=this._localTransform,e=new I.common.Transform;return e._positionX=t._positionX,e._positionY=t._positionY,e._positionZ=t._positionZ,e._rotation00=t._rotation00,e._rotation01=t._rotation01,e._rotation02=t._rotation02,e._rotation10=t._rotation10,e._rotation11=t._rotation11,e._rotation12=t._rotation12,e._rotation20=t._rotation20,e._rotation21=t._rotation21,e._rotation22=t._rotation22,e}getLocalTransformTo(t){let e=this._localTransform;t._positionX=e._positionX,t._positionY=e._positionY,t._positionZ=e._positionZ,t._rotation00=e._rotation00,t._rotation01=e._rotation01,t._rotation02=e._rotation02,t._rotation10=e._rotation10,t._rotation11=e._rotation11,t._rotation12=e._rotation12,t._rotation20=e._rotation20,t._rotation21=e._rotation21,t._rotation22=e._rotation22}getTransform(){let t=this._transform,e=new I.common.Transform;return e._positionX=t._positionX,e._positionY=t._positionY,e._positionZ=t._positionZ,e._rotation00=t._rotation00,e._rotation01=t._rotation01,e._rotation02=t._rotation02,e._rotation10=t._rotation10,e._rotation11=t._rotation11,e._rotation12=t._rotation12,e._rotation20=t._rotation20,e._rotation21=t._rotation21,e._rotation22=t._rotation22,e}getTransformTo(t){let e=this._transform;t._positionX=e._positionX,t._positionY=e._positionY,t._positionZ=e._positionZ,t._rotation00=e._rotation00,t._rotation01=e._rotation01,t._rotation02=e._rotation02,t._rotation10=e._rotation10,t._rotation11=e._rotation11,t._rotation12=e._rotation12,t._rotation20=e._rotation20,t._rotation21=e._rotation21,t._rotation22=e._rotation22}setLocalTransform(t){let e=this._localTransform;if(e._positionX=t._positionX,e._positionY=t._positionY,e._positionZ=t._positionZ,e._rotation00=t._rotation00,e._rotation01=t._rotation01,e._rotation02=t._rotation02,e._rotation10=t._rotation10,e._rotation11=t._rotation11,e._rotation12=t._rotation12,e._rotation20=t._rotation20,e._rotation21=t._rotation21,e._rotation22=t._rotation22,this._rigidBody!=null){let i=this._rigidBody;i.updateMass();let n=i._shapeList;for(;n!=null;){let s=n._next,o=i._ptransform,r=i._transform,_=n._ptransform,a=n._localTransform,l,h,u,f,m,d,p,g,x;l=o._rotation00*a._rotation00+o._rotation01*a._rotation10+o._rotation02*a._rotation20,h=o._rotation00*a._rotation01+o._rotation01*a._rotation11+o._rotation02*a._rotation21,u=o._rotation00*a._rotation02+o._rotation01*a._rotation12+o._rotation02*a._rotation22,f=o._rotation10*a._rotation00+o._rotation11*a._rotation10+o._rotation12*a._rotation20,m=o._rotation10*a._rotation01+o._rotation11*a._rotation11+o._rotation12*a._rotation21,d=o._rotation10*a._rotation02+o._rotation11*a._rotation12+o._rotation12*a._rotation22,p=o._rotation20*a._rotation00+o._rotation21*a._rotation10+o._rotation22*a._rotation20,g=o._rotation20*a._rotation01+o._rotation21*a._rotation11+o._rotation22*a._rotation21,x=o._rotation20*a._rotation02+o._rotation21*a._rotation12+o._rotation22*a._rotation22,_._rotation00=l,_._rotation01=h,_._rotation02=u,_._rotation10=f,_._rotation11=m,_._rotation12=d,_._rotation20=p,_._rotation21=g,_._rotation22=x;let b,y,z;b=o._rotation00*a._positionX+o._rotation01*a._positionY+o._rotation02*a._positionZ,y=o._rotation10*a._positionX+o._rotation11*a._positionY+o._rotation12*a._positionZ,z=o._rotation20*a._positionX+o._rotation21*a._positionY+o._rotation22*a._positionZ,_._positionX=b,_._positionY=y,_._positionZ=z,_._positionX+=o._positionX,_._positionY+=o._positionY,_._positionZ+=o._positionZ;let M=n._transform,Y=n._localTransform,X,w,S,V,F,C,A,Z,L;X=r._rotation00*Y._rotation00+r._rotation01*Y._rotation10+r._rotation02*Y._rotation20,w=r._rotation00*Y._rotation01+r._rotation01*Y._rotation11+r._rotation02*Y._rotation21,S=r._rotation00*Y._rotation02+r._rotation01*Y._rotation12+r._rotation02*Y._rotation22,V=r._rotation10*Y._rotation00+r._rotation11*Y._rotation10+r._rotation12*Y._rotation20,F=r._rotation10*Y._rotation01+r._rotation11*Y._rotation11+r._rotation12*Y._rotation21,C=r._rotation10*Y._rotation02+r._rotation11*Y._rotation12+r._rotation12*Y._rotation22,A=r._rotation20*Y._rotation00+r._rotation21*Y._rotation10+r._rotation22*Y._rotation20,Z=r._rotation20*Y._rotation01+r._rotation21*Y._rotation11+r._rotation22*Y._rotation21,L=r._rotation20*Y._rotation02+r._rotation21*Y._rotation12+r._rotation22*Y._rotation22,M._rotation00=X,M._rotation01=w,M._rotation02=S,M._rotation10=V,M._rotation11=F,M._rotation12=C,M._rotation20=A,M._rotation21=Z,M._rotation22=L;let E,T,P;E=r._rotation00*Y._positionX+r._rotation01*Y._positionY+r._rotation02*Y._positionZ,T=r._rotation10*Y._positionX+r._rotation11*Y._positionY+r._rotation12*Y._positionZ,P=r._rotation20*Y._positionX+r._rotation21*Y._positionY+r._rotation22*Y._positionZ,M._positionX=E,M._positionY=T,M._positionZ=P,M._positionX+=r._positionX,M._positionY+=r._positionY,M._positionZ+=r._positionZ;let N,R,k,O,v,D;if(n._geom._computeAabb(n._aabb,n._ptransform),N=n._aabb._minX,R=n._aabb._minY,k=n._aabb._minZ,O=n._aabb._maxX,v=n._aabb._maxY,D=n._aabb._maxZ,n._geom._computeAabb(n._aabb,n._transform),n._aabb._minX=N<n._aabb._minX?N:n._aabb._minX,n._aabb._minY=R<n._aabb._minY?R:n._aabb._minY,n._aabb._minZ=k<n._aabb._minZ?k:n._aabb._minZ,n._aabb._maxX=O>n._aabb._maxX?O:n._aabb._maxX,n._aabb._maxY=v>n._aabb._maxY?v:n._aabb._maxY,n._aabb._maxZ=D>n._aabb._maxZ?D:n._aabb._maxZ,n._proxy!=null){let B,U,q;B=n._transform._positionX-n._ptransform._positionX,U=n._transform._positionY-n._ptransform._positionY,q=n._transform._positionZ-n._ptransform._positionZ;let tt=n.displacement;tt.x=B,tt.y=U,tt.z=q,n._rigidBody._world._broadPhase.moveProxy(n._proxy,n._aabb,n.displacement)}n=s}}}getDensity(){return this._density}setDensity(t){if(this._density=t,this._rigidBody!=null){let e=this._rigidBody;e.updateMass();let i=e._shapeList;for(;i!=null;){let n=i._next,s=e._ptransform,o=e._transform,r=i._ptransform,_=i._localTransform,a,l,h,u,f,m,d,p,g;a=s._rotation00*_._rotation00+s._rotation01*_._rotation10+s._rotation02*_._rotation20,l=s._rotation00*_._rotation01+s._rotation01*_._rotation11+s._rotation02*_._rotation21,h=s._rotation00*_._rotation02+s._rotation01*_._rotation12+s._rotation02*_._rotation22,u=s._rotation10*_._rotation00+s._rotation11*_._rotation10+s._rotation12*_._rotation20,f=s._rotation10*_._rotation01+s._rotation11*_._rotation11+s._rotation12*_._rotation21,m=s._rotation10*_._rotation02+s._rotation11*_._rotation12+s._rotation12*_._rotation22,d=s._rotation20*_._rotation00+s._rotation21*_._rotation10+s._rotation22*_._rotation20,p=s._rotation20*_._rotation01+s._rotation21*_._rotation11+s._rotation22*_._rotation21,g=s._rotation20*_._rotation02+s._rotation21*_._rotation12+s._rotation22*_._rotation22,r._rotation00=a,r._rotation01=l,r._rotation02=h,r._rotation10=u,r._rotation11=f,r._rotation12=m,r._rotation20=d,r._rotation21=p,r._rotation22=g;let x,b,y;x=s._rotation00*_._positionX+s._rotation01*_._positionY+s._rotation02*_._positionZ,b=s._rotation10*_._positionX+s._rotation11*_._positionY+s._rotation12*_._positionZ,y=s._rotation20*_._positionX+s._rotation21*_._positionY+s._rotation22*_._positionZ,r._positionX=x,r._positionY=b,r._positionZ=y,r._positionX+=s._positionX,r._positionY+=s._positionY,r._positionZ+=s._positionZ;let z=i._transform,M=i._localTransform,Y,X,w,S,V,F,C,A,Z;Y=o._rotation00*M._rotation00+o._rotation01*M._rotation10+o._rotation02*M._rotation20,X=o._rotation00*M._rotation01+o._rotation01*M._rotation11+o._rotation02*M._rotation21,w=o._rotation00*M._rotation02+o._rotation01*M._rotation12+o._rotation02*M._rotation22,S=o._rotation10*M._rotation00+o._rotation11*M._rotation10+o._rotation12*M._rotation20,V=o._rotation10*M._rotation01+o._rotation11*M._rotation11+o._rotation12*M._rotation21,F=o._rotation10*M._rotation02+o._rotation11*M._rotation12+o._rotation12*M._rotation22,C=o._rotation20*M._rotation00+o._rotation21*M._rotation10+o._rotation22*M._rotation20,A=o._rotation20*M._rotation01+o._rotation21*M._rotation11+o._rotation22*M._rotation21,Z=o._rotation20*M._rotation02+o._rotation21*M._rotation12+o._rotation22*M._rotation22,z._rotation00=Y,z._rotation01=X,z._rotation02=w,z._rotation10=S,z._rotation11=V,z._rotation12=F,z._rotation20=C,z._rotation21=A,z._rotation22=Z;let L,E,T;L=o._rotation00*M._positionX+o._rotation01*M._positionY+o._rotation02*M._positionZ,E=o._rotation10*M._positionX+o._rotation11*M._positionY+o._rotation12*M._positionZ,T=o._rotation20*M._positionX+o._rotation21*M._positionY+o._rotation22*M._positionZ,z._positionX=L,z._positionY=E,z._positionZ=T,z._positionX+=o._positionX,z._positionY+=o._positionY,z._positionZ+=o._positionZ;let P,N,R,k,O,v;if(i._geom._computeAabb(i._aabb,i._ptransform),P=i._aabb._minX,N=i._aabb._minY,R=i._aabb._minZ,k=i._aabb._maxX,O=i._aabb._maxY,v=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=P<i._aabb._minX?P:i._aabb._minX,i._aabb._minY=N<i._aabb._minY?N:i._aabb._minY,i._aabb._minZ=R<i._aabb._minZ?R:i._aabb._minZ,i._aabb._maxX=k>i._aabb._maxX?k:i._aabb._maxX,i._aabb._maxY=O>i._aabb._maxY?O:i._aabb._maxY,i._aabb._maxZ=v>i._aabb._maxZ?v:i._aabb._maxZ,i._proxy!=null){let D,B,U;D=i._transform._positionX-i._ptransform._positionX,B=i._transform._positionY-i._ptransform._positionY,U=i._transform._positionZ-i._ptransform._positionZ;let q=i.displacement;q.x=D,q.y=B,q.z=U,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=n}}}getAabb(){return this._aabb.clone()}getAabbTo(t){t.copyFrom(this._aabb)}getGeometry(){return this._geom}getRigidBody(){return this._rigidBody}getCollisionGroup(){return this._collisionGroup}setCollisionGroup(t){this._collisionGroup=t}getCollisionMask(){return this._collisionMask}setCollisionMask(t){this._collisionMask=t}getContactCallback(){return this._contactCallback}setContactCallback(t){this._contactCallback=t}getPrev(){return this._prev}getNext(){return this._next}};I.dynamics.rigidbody.ShapeConfig=class{constructor(){this.position=new I.common.Vec3,this.rotation=new I.common.Mat3,this.friction=I.common.Setting.defaultFriction,this.restitution=I.common.Setting.defaultRestitution,this.density=I.common.Setting.defaultDensity,this.collisionGroup=I.common.Setting.defaultCollisionGroup,this.collisionMask=I.common.Setting.defaultCollisionMask,this.geometry=null,this.contactCallback=null}};I.m||(I.m={});I.m.M=class{};I.collision.broadphase.BroadPhaseType._BRUTE_FORCE=1;I.collision.broadphase.BroadPhaseType._BVH=2;I.collision.broadphase.BroadPhaseType.BRUTE_FORCE=1;I.collision.broadphase.BroadPhaseType.BVH=2;I.collision.broadphase.bvh.BvhInsertionStrategy.SIMPLE=0;I.collision.broadphase.bvh.BvhInsertionStrategy.MINIMIZE_SURFACE_AREA=1;I.collision.geometry.GeometryType._SPHERE=0;I.collision.geometry.GeometryType._BOX=1;I.collision.geometry.GeometryType._CYLINDER=2;I.collision.geometry.GeometryType._CONE=3;I.collision.geometry.GeometryType._CAPSULE=4;I.collision.geometry.GeometryType._CONVEX_HULL=5;I.collision.geometry.GeometryType._CONVEX_MIN=0;I.collision.geometry.GeometryType._CONVEX_MAX=5;I.collision.geometry.GeometryType.SPHERE=0;I.collision.geometry.GeometryType.BOX=1;I.collision.geometry.GeometryType.CYLINDER=2;I.collision.geometry.GeometryType.CONE=3;I.collision.geometry.GeometryType.CAPSULE=4;I.collision.geometry.GeometryType.CONVEX_HULL=5;I.collision.narrowphase.detector.BoxBoxDetector.EDGE_BIAS_MULT=1;I.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.OK=0;I.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.INVALID_TRIANGLE=1;I.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_PAIR_INDEX=2;I.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_TRIANGLE=3;I.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.EDGE_LOOP_BROKEN=4;I.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_OUTER_TRIANGLE=5;I.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.TRIANGLE_INVISIBLE=6;I.collision.narrowphase.detector.gjkepa.EpaTriangle.count=0;I.common.Vec3.numCreations=0;I.common.Setting.defaultFriction=.2;I.common.Setting.defaultRestitution=.2;I.common.Setting.defaultDensity=1;I.common.Setting.defaultCollisionGroup=1;I.common.Setting.defaultCollisionMask=1;I.common.Setting.maxTranslationPerStep=20;I.common.Setting.maxRotationPerStep=3.14159265358979;I.common.Setting.bvhProxyPadding=.1;I.common.Setting.bvhIncrementalCollisionThreshold=.45;I.common.Setting.defaultGJKMargin=.05;I.common.Setting.enableGJKCaching=!0;I.common.Setting.maxEPAVertices=128;I.common.Setting.maxEPAPolyhedronFaces=128;I.common.Setting.contactEnableBounceThreshold=.5;I.common.Setting.velocityBaumgarte=.2;I.common.Setting.positionSplitImpulseBaumgarte=.4;I.common.Setting.positionNgsBaumgarte=1;I.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold=.05;I.common.Setting.defaultContactPositionCorrectionAlgorithm=0;I.common.Setting.alternativeContactPositionCorrectionAlgorithm=1;I.common.Setting.contactPersistenceThreshold=.05;I.common.Setting.maxManifoldPoints=4;I.common.Setting.defaultJointConstraintSolverType=0;I.common.Setting.defaultJointPositionCorrectionAlgorithm=0;I.common.Setting.jointWarmStartingFactorForBaungarte=.8;I.common.Setting.jointWarmStartingFactor=.95;I.common.Setting.minSpringDamperDampingRatio=1e-6;I.common.Setting.minRagdollMaxSwingAngle=1e-6;I.common.Setting.maxJacobianRows=6;I.common.Setting.directMlcpSolverEps=1e-9;I.common.Setting.islandInitialRigidBodyArraySize=128;I.common.Setting.islandInitialConstraintArraySize=128;I.common.Setting.sleepingVelocityThreshold=.2;I.common.Setting.sleepingAngularVelocityThreshold=.5;I.common.Setting.sleepingTimeThreshold=1;I.common.Setting.disableSleeping=!1;I.common.Setting.linearSlop=.005;I.common.Setting.angularSlop=.017453292519943278;I.collision.narrowphase.detector.gjkepa.GjkEpa.instance=new I.collision.narrowphase.detector.gjkepa.GjkEpa;I.collision.narrowphase.detector.gjkepa.GjkEpaResultState._SUCCEEDED=0;I.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_FAILED_TO_MAKE_TETRAHEDRON=1;I.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_DID_NOT_CONVERGE=2;I.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_INIT=257;I.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_ADD_VERTEX=258;I.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_DID_NOT_CONVERGE=259;I.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED=0;I.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_FAILED_TO_MAKE_TETRAHEDRON=1;I.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_DID_NOT_CONVERGE=2;I.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT=257;I.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX=258;I.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE=259;I.common.Mat3.numCreations=0;I.common.Mat4.numCreations=0;I.common.MathUtil.POSITIVE_INFINITY=1/0;I.common.MathUtil.NEGATIVE_INFINITY=-1/0;I.common.MathUtil.PI=3.14159265358979;I.common.MathUtil.TWO_PI=6.28318530717958;I.common.MathUtil.HALF_PI=1.570796326794895;I.common.MathUtil.TO_RADIANS=.017453292519943278;I.common.MathUtil.TO_DEGREES=57.29577951308238;I.common.Quat.numCreations=0;I.dynamics.common.DebugDraw.SPHERE_PHI_DIVISION=8;I.dynamics.common.DebugDraw.SPHERE_THETA_DIVISION=4;I.dynamics.common.DebugDraw.CIRCLE_THETA_DIVISION=8;I.dynamics.common.Performance.broadPhaseCollisionTime=0;I.dynamics.common.Performance.narrowPhaseCollisionTime=0;I.dynamics.common.Performance.dynamicsTime=0;I.dynamics.common.Performance.totalTime=0;I.dynamics.constraint.PositionCorrectionAlgorithm._BAUMGARTE=0;I.dynamics.constraint.PositionCorrectionAlgorithm._SPLIT_IMPULSE=1;I.dynamics.constraint.PositionCorrectionAlgorithm._NGS=2;I.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE=0;I.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE=1;I.dynamics.constraint.PositionCorrectionAlgorithm.NGS=2;I.dynamics.constraint.info.JacobianRow.BIT_LINEAR_SET=1;I.dynamics.constraint.info.JacobianRow.BIT_ANGULAR_SET=2;I.dynamics.constraint.joint.JointType._SPHERICAL=0;I.dynamics.constraint.joint.JointType._REVOLUTE=1;I.dynamics.constraint.joint.JointType._CYLINDRICAL=2;I.dynamics.constraint.joint.JointType._PRISMATIC=3;I.dynamics.constraint.joint.JointType._UNIVERSAL=4;I.dynamics.constraint.joint.JointType._RAGDOLL=5;I.dynamics.constraint.joint.JointType._GENERIC=6;I.dynamics.constraint.joint.JointType.SPHERICAL=0;I.dynamics.constraint.joint.JointType.REVOLUTE=1;I.dynamics.constraint.joint.JointType.CYLINDRICAL=2;I.dynamics.constraint.joint.JointType.PRISMATIC=3;I.dynamics.constraint.joint.JointType.UNIVERSAL=4;I.dynamics.constraint.joint.JointType.RAGDOLL=5;I.dynamics.constraint.joint.JointType.GENERIC=6;I.dynamics.constraint.solver.ConstraintSolverType._ITERATIVE=0;I.dynamics.constraint.solver.ConstraintSolverType._DIRECT=1;I.dynamics.constraint.solver.ConstraintSolverType.ITERATIVE=0;I.dynamics.constraint.solver.ConstraintSolverType.DIRECT=1;I.dynamics.rigidbody.RigidBodyType._DYNAMIC=0;I.dynamics.rigidbody.RigidBodyType._STATIC=1;I.dynamics.rigidbody.RigidBodyType._KINEMATIC=2;I.dynamics.rigidbody.RigidBodyType.DYNAMIC=0;I.dynamics.rigidbody.RigidBodyType.STATIC=1;I.dynamics.rigidbody.RigidBodyType.KINEMATIC=2;I.dynamics.World;I.dynamics.rigidbody.RigidBodyType;I.dynamics.rigidbody.RigidBodyConfig;I.dynamics.rigidbody.RigidBody;I.dynamics.rigidbody.ShapeConfig;I.dynamics.rigidbody.Shape;I.dynamics.constraint.joint.SphericalJointConfig;I.dynamics.constraint.joint.SphericalJoint;I.dynamics.constraint.joint.RevoluteJointConfig;I.dynamics.constraint.joint.RevoluteJoint;I.dynamics.constraint.joint.CylindricalJointConfig;I.dynamics.constraint.joint.CylindricalJoint;I.dynamics.constraint.joint.PrismaticJointConfig;I.dynamics.constraint.joint.PrismaticJoint;I.dynamics.constraint.joint.UniversalJointConfig;I.dynamics.constraint.joint.UniversalJoint;I.dynamics.constraint.joint.RagdollJointConfig;I.dynamics.constraint.joint.RagdollJoint;I.dynamics.constraint.joint.GenericJointConfig;I.dynamics.constraint.joint.GenericJoint;I.dynamics.constraint.joint.JointConfig;I.dynamics.constraint.joint.Joint;I.dynamics.constraint.joint.SpringDamper;I.dynamics.constraint.joint.TranslationalLimitMotor;I.dynamics.constraint.joint.RotationalLimitMotor;I.common.Vec3;I.common.Quat;I.common.Mat3;I.common.MathUtil;I.common.Transform;I.common.Setting;I.collision.geometry.CapsuleGeometry;I.collision.geometry.ConvexHullGeometry;I.collision.geometry.BoxGeometry;I.collision.geometry.SphereGeometry;I.collision.geometry.CylinderGeometry;I.collision.geometry.ConeGeometry;I.collision.geometry.Geometry;I.dynamics.callback.RayCastClosest;I.dynamics.callback.ContactCallback;I.dynamics.World;I.dynamics.rigidbody.RigidBodyType;I.dynamics.rigidbody.RigidBodyConfig;I.dynamics.rigidbody.RigidBody;I.dynamics.rigidbody.ShapeConfig;I.dynamics.rigidbody.Shape;I.dynamics.constraint.joint.SphericalJointConfig;I.dynamics.constraint.joint.SphericalJoint;I.dynamics.constraint.joint.RevoluteJointConfig;I.dynamics.constraint.joint.RevoluteJoint;I.dynamics.constraint.joint.CylindricalJointConfig;I.dynamics.constraint.joint.CylindricalJoint;I.dynamics.constraint.joint.PrismaticJointConfig;I.dynamics.constraint.joint.PrismaticJoint;I.dynamics.constraint.joint.UniversalJointConfig;I.dynamics.constraint.joint.UniversalJoint;I.dynamics.constraint.joint.RagdollJointConfig;I.dynamics.constraint.joint.RagdollJoint;I.dynamics.constraint.joint.GenericJointConfig;I.dynamics.constraint.joint.GenericJoint;I.dynamics.constraint.joint.Joint;I.common.Vec3;I.common.Quat;I.collision.geometry.BoxGeometry;I.collision.geometry.SphereGeometry;I.dynamics.callback.ContactCallback;var Sx=`
float random(vec2 co) {
    float a = 12.9898;
    float b = 78.233;
    float c = 43758.5453;
    float dt = dot(co.xy, vec2(a, b));
    float sn = mod(dt, 3.14);
    return fract(sin(sn) * c);
}
`,Yx=`
${Sx}

vec3 dither(vec3 color) {
    // Calculate grid position
    float grid_position = random(gl_FragCoord.xy);

    // Shift the individual colors differently, thus making it even harder to see the dithering pattern
    vec3 dither_shift_RGB = vec3(0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0);

    // Modify shift acording to grid position
    dither_shift_RGB = mix(2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position);

    // Shift the color by dither_shift
    return color + dither_shift_RGB;
}
`,Zx=`
in vec3 position;
in vec2 uv;

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;

uniform mat3 uMapTransform;
uniform mat4 uMatrix;

out vec2 vUv;
out vec4 vCoord;

void main() {
    vUv = (uMapTransform * vec3(uv, 1.0)).xy;
    vCoord = uMatrix * vec4(position, 1.0);

    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,Lx=`
float blendOverlay(float x, float y) {
    return (x < 0.5) ? (2.0 * x * y) : (1.0 - 2.0 * (1.0 - x) * (1.0 - y));
}

vec4 blendOverlay(vec4 x, vec4 y, float opacity) {
    vec4 z = vec4(blendOverlay(x.r, y.r), blendOverlay(x.g, y.g), blendOverlay(x.b, y.b), blendOverlay(x.a, y.a));
    return z * opacity + x * (1.0 - opacity);
}
`,Ax=`
precision highp float;

uniform sampler2D tMap;
uniform sampler2D tReflect;
uniform vec3 uColor;

#ifdef USE_FOG
    uniform vec3 uFogColor;
    uniform float uFogNear;
    uniform float uFogFar;
#endif

in vec2 vUv;
in vec4 vCoord;

out vec4 FragColor;

${Lx}
${Yx}

void main() {
    vec4 base = texture(tMap, vUv);
    vec4 blend = textureProj(tReflect, vCoord);

    FragColor = base * blend;

    base = FragColor;
    blend = vec4(uColor, 1.0);

    FragColor = blendOverlay(base, blend, 1.0);

    #ifdef USE_FOG
        float fogDepth = gl_FragCoord.z / gl_FragCoord.w;
        float fogFactor = smoothstep(uFogNear, uFogFar, fogDepth);

        FragColor.rgb = mix(FragColor.rgb, uFogColor, fogFactor);
    #endif

    #ifdef DITHERING
        FragColor.rgb = dither(FragColor.rgb);
    #endif

    FragColor.a = 1.0;
}
`;class Tx extends lr{constructor({color:t=new fi(8355711),map:e=null,fog:i=null,dithering:n=!1}={}){const s={glslVersion:Fo,defines:{},uniforms:{tMap:new Ui(null),tReflect:new Ui(null),uMapTransform:new Ui(new qi),uMatrix:new Ui(new vi),uColor:new Ui(t instanceof fi?t:new fi(t))},vertexShader:Zx,fragmentShader:Ax,blending:Ln};e&&(e.updateMatrix(),s.uniforms=Object.assign(s.uniforms,{tMap:new Ui(e),uMapTransform:new Ui(e.matrix)})),i&&(s.defines=Object.assign(s.defines,{USE_FOG:""}),s.uniforms=Object.assign(s.uniforms,{uFogColor:new Ui(i.color),uFogNear:new Ui(i.near),uFogFar:new Ui(i.far)})),n&&(s.defines=Object.assign(s.defines,{DITHERING:""})),super(s)}}class Vx{constructor(){li(this,"camera",new ec);li(this,"orbitControl");this.camera.fov=75}init(){}setOrbitControl(t){const e=new n1(this.camera,t);e.enableDamping=!0,this.orbitControl=e}}class Ex{constructor(){li(this,"axesHelper",new s1(1));li(this,"scene",new a1);li(this,"setAxesHelper",(t=!0)=>{(typeof t=="boolean"?t:!1)?this.scene.add(this.axesHelper):this.scene.remove(this.axesHelper)})}}class Cx{constructor(t){li(this,"renderer");this.renderer=new o1({canvas:t,alpha:!1})}init(){}}class Px{constructor(t,e){li(this,"worldController");li(this,"gui",new r1({closed:!0}));this.worldController=t,this.fixGui(e)}fixGui(t){const e=this.gui.domElement.parentElement;t.appendChild(e)}init(){const{testLight:t,cameraController:e,animationController:i}=this.worldController;this.gui.add(t.position,"y").setValue(20).min(-100).max(100).step(.1),this.gui.add(t.position,"z").setValue(100).min(-100).max(100).step(.1),this.gui.add(i,"isScroll").setValue(!0),this.gui.add(e.camera.position,"z").setValue(37).min(-200).max(37).step(.1);const n={color:"#ffffff"};this.gui.addColor(n,"color").onChange(o=>{bn.material.emissive.setHex(parseInt(o.slice(1),16)),bn.material.color.setHex(parseInt(o.slice(1),16))});const s={metalness:0};this.gui.add(s,"metalness").min(0).max(1).step(.01).onChange(o=>{bn.material.metalness=o})}}class Rx{constructor(t){li(this,"clock");li(this,"worldController");li(this,"isStop",!1);li(this,"privateTime",0);li(this,"isScroll",!0);li(this,"scrollProgress",0);li(this,"onScroll",()=>{const t=document.documentElement.scrollTop||document.body.scrollTop,e=document.documentElement.clientHeight,i=document.documentElement.offsetHeight,n=t/(i-e);this.scrollProgress=n});this.worldController=t,this.clock=t.clock}update(){if(this.isStop)return;const t=this.clock.getElapsedTime(),e=t-this.privateTime;this.privateTime=t;const i=[-100,75],n=[0,80],s=this.worldController.testLight;let r=s.position.z+e*30;r=r+(r>i[1]?i[0]-i[1]:0),s.position.z=r;const _=(r-i[0])/(i[1]-i[0]),a=.7,l=.58;if(_>a){const p=n[0]+(n[1]-n[0])*(1-(_-a)/(1-a));s.intensity=p}else if(_<l){const p=n[0]+(n[1]-n[0])*(_/(1-l));s.intensity=p}else _<.7&&(s.intensity=n[0]);const h=[5,20],f=this.worldController.cameraController.camera.position.z;let m=0,d=0;if(f<h[0]?(d=255,m=0):f<h[1]||(d=0,m=1),bn.material.emissive.setRGB(d,d,d),bn.material.color.setRGB(d,d,d),bn.material.metalness=m,this.isScroll){const p=[-192,37],g=p[0]+(p[1]-p[0])*this.scrollProgress;this.worldController.cameraController.camera.position.z=g}}}class kx{constructor(t){li(this,"view");li(this,"clock",new e1);li(this,"cameraController",new Vx);li(this,"sceneController",new Ex);li(this,"animationController",new Rx(this));li(this,"renderManager");li(this,"guiController");li(this,"testLight");this.view=t,this.renderManager=new Cx(this.view.canvasEl)}addGui(t){this.guiController=new Px(this,t)}async init(){var r;this.sceneController.setAxesHelper(),this.cameraController.init(),this.sceneController.scene.add(this.cameraController.camera),this.cameraController.camera.position.x=0,this.cameraController.camera.position.y=1.7,this.cameraController.camera.position.z=20,this.cameraController.camera.lookAt(0,1.7,-200),this.renderManager.init(),this.testLight=new qh(16777215,50,1e3),this.sceneController.scene.add(this.testLight),this.testLight.position.set(0,20,100);const t=new i1({color:0,emissive:1118481,flatShading:!0}),e=await Zn.gltfLoader.loadAsync(N1);this.sceneController.scene.add(e.scene),e.scene.traverse(_=>{const a=_;a.isMesh&&(a.material=t)});let i;Array(10).fill([-200,20]).map((_,a)=>{const l=_[0]+_[1]*a;i=new bn,i.initMesh(),i.position.z=l,this.sceneController.scene.add(i)});const n=this.sceneController.scene;class s extends Ks{constructor(){super();li(this,"reflector",new jh);li(this,"resize",(l,h)=>{l=O1(l)/2,h=1024,this.reflector.setSize(l,h)});this.initReflector()}initReflector(){this.reflector=new jh}async initMesh(){const l=new l1(100,500),h=new Qh,u=new nc("/assets/materials/freepbr-pitted-pbr-1/polished_concrete_basecolor.jpg").url,f=await h.loadAsync(u);f.wrapS=ka,f.wrapT=ka,f.repeat.set(16,16);const{fog:m}=n,d=new Tx({map:f,fog:m,dithering:!0});d.uniforms.tReflect=this.reflector.renderTargetUniform,d.uniforms.uMatrix=this.reflector.textureMatrixUniform;const p=new wl(l,d);p.position.z=-200,p.rotation.x=-Math.PI/2,p.add(this.reflector),p.onBeforeRender=(g,x,b)=>{this.visible=!1,this.reflector.update(g,x,b),this.visible=!0},this.add(p)}}const o=new s;this.sceneController.scene.add(o),o.initMesh(),(r=this.guiController)==null||r.init()}resize(t,e){this.cameraController.camera.aspect=t/e,this.cameraController.camera.updateProjectionMatrix(),this.renderManager.renderer.setSize(t,e),this.renderManager.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2))}render(){var t;(t=this.cameraController.orbitControl)==null||t.update(),this.animationController.update(),this.renderManager.renderer.render(this.sceneController.scene,this.cameraController.camera)}}const $s=class{constructor(t,e){li(this,"canvasEl");li(this,"viewraperEl");li(this,"size",new $s.Size);li(this,"worldController");li(this,"resize",()=>{this.size.width/this.size.height>1;const t=this.viewraperEl?this.viewraperEl.offsetWidth:0,e=this.viewraperEl?this.viewraperEl.offsetHeight:0;this.size.width=t,this.size.height=e,this.worldController.resize(t,e)});this.canvasEl=t,this.viewraperEl=e;const i=new nc("/assets/draco/").url;$s.dracoLoader.setDecoderPath(i),$s.gltfLoader.setDRACOLoader($s.dracoLoader),this.worldController=new kx(this)}init(){this.size.width=this.viewraperEl.offsetWidth,this.size.height=this.viewraperEl.offsetHeight,this.worldController.init(),this.resize()}render(){this.worldController.render(),window.requestAnimationFrame(()=>this.render())}addEventListener(){window.addEventListener("resize",this.resize),window.addEventListener("scroll",this.worldController.animationController.onScroll)}removeEventListener(){var t;window.removeEventListener("resize",this.resize),window.removeEventListener("scroll",this.worldController.animationController.onScroll),(t=this.worldController.guiController)==null||t.gui.destroy()}};let Zn=$s;li(Zn,"dracoLoader",new B1),li(Zn,"gltfLoader",new h1),li(Zn,"svgLoader",new qo);(c=>{class t{constructor(){li(this,"width",1920);li(this,"height",1080)}}c.Size=t})(Zn||(Zn={}));var Bx=Zn;const jo=class extends Ks{constructor(){super()}async initMesh(){const t=await jo.geometrysPromise,e=new Ks;e.position.set(0,3,0),e.scale.y*=-1,t.forEach(i=>{const n=new wl(i,jo.material);e.add(n)}),this.add(e)}};let bn=jo;li(bn,"geometrysPromise",Zn.svgLoader.loadAsync('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg"><path stroke-width="0.25" d="M 3 0 L 0 5 H 6 Z"/></svg>').then(t=>{var n;const e=[],i=t.paths;for(let s=0,o=i.length;s<o;s++){const r=i[s];for(let _=0,a=r.subPaths.length;_<a;_++){const l=r.subPaths[_],h=qo.pointsToStroke(l.getPoints(),(n=r==null?void 0:r.userData)==null?void 0:n.style);h&&(h.center(),e.push(h))}}return e})),li(bn,"material",new Ms({color:16777215,emissive:16777215}));const Dx=c=>(m0("data-v-65677168"),c=c(),f0(),c),Nx=Dx(()=>Eo("div",{class:"container"},null,-1)),Fx=r0({name:"l00-view",setup(c){const t=_r(),e=_r(),i=_r();let n;return l0(()=>{n==null||n.removeEventListener()}),_0(()=>{const s=t.value,o=i.value,r=e.value;n=new Bx(s,o),n.init(),n.worldController.addGui(r),n.addEventListener(),n.render()}),(s,o)=>(e_(),h0(p0,null,[(e_(),c0(u0,{to:"body"},[Eo("div",{class:"guiwraper",ref_key:"guiwraper",ref:e},null,512)])),Eo("div",{class:"viewraper",ref_key:"viewraper",ref:i},[Eo("canvas",{ref_key:"canvas",ref:t},null,512)],512),Nx],64))}});var cy=_1(Fx,[["__scopeId","data-v-65677168"],["__file","/Volumes/Work/l00 Studio/l00/source/src/graphics-components/l00-view/l00-view.vue"]]);export{cy as default};
