var y=Object.defineProperty;var z=(n,e,s)=>e in n?y(n,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[e]=s;var t=(n,e,s)=>(z(n,typeof e!="symbol"?e+"":e,s),s);import{M as l,d as v,h as m,i as b,l as A,o as L,b as x,e as M,Q as T,p as D,g as S,s as C}from"./vendor-1d624232.js";import{G as p,D as P,P as E,T as F,C as G,a as k,O as W,p as H,r as f,t as U,s as c,W as j,R as g,b as N,N as O,c as I,d as B,A as V,e as w,M as d,f as $,g as q,k as J,S as Q}from"./OrbitControls-f9727bec.js";import{F as X}from"./FontLoader-e4f92b51.js";import{E as Y,R as Z,S as R,G as K,a as ee}from"./GammaCorrectionShader-98453a89.js";import{_}from"./plugin-vue_export-helper-4223c0cf.js";class te{constructor(e){t(this,"main");t(this,"isActive",!1);t(this,"ui");this.main=e,window.location.hash.includes("debug")&&this.active()}active(){this.isActive=!0,this.ui=new l,this.fixGui(),this.toWindowTest()}fixGui(){var i;const e=this.main.viewArea,s=(i=this.ui)==null?void 0:i.domElement.parentElement;e.appendChild(s),s.style.position="absolute"}toWindowTest(){window.debugView=this.main}addFolder(e){if(!this.ui||!(this.ui instanceof l))return i=>{};const s=this.ui.addFolder(e);return i=>{i(s)}}destroy(){var e;(e=this.ui)==null||e.destroy(),delete window.debugView}}class se{constructor(e,s){t(this,"function");t(this,"isOnce");this.function=e,this.isOnce=s.isOnce?s.isOnce:!1}}class h{constructor(){t(this,"__emittersMap__",new WeakMap);t(this,"__emitters__",new Map)}on(e,s){if(typeof e!="string"||e===""||typeof s!="function")return!1;let i=this.__emitters__.get(e);if(i||(i=new Set,this.__emitters__.set(e,i)),this.__emittersMap__.has(s))return!1;{const r=new se(s,{isOnce:!1});this.__emittersMap__.set(s,r),i.add(r)}return!0}once(e,s){if(this.on(e,s)){const i=this.__emittersMap__.get(s);if(!i)return!1;i.isOnce=!0}else return!1;return!0}off(e,s){const i=this.__emitters__.get(e);if(!i)return!1;const r=this.__emittersMap__.get(s);return r?(this.__emittersMap__.delete(s),i.delete(r),i.size===0&&this.__emitters__.delete(e),!0):!1}offAll(e){const s=this.__emitters__.get(e);return s?(s.clear(),this.__emitters__.delete(e),!0):!1}clearEvents(){return this.__emitters__.clear(),!0}async emit(e,...s){const i=this.__emitters__.get(e);if(!!i)for(let r of i.values()){try{await r.function.apply(void 0,s)}catch(a){console.error(a)}r.isOnce&&this.off(e,r.function)}}}class ie extends h{constructor(s){super();t(this,"viewArea");t(this,"width",0);t(this,"height",0);t(this,"pixelRatio",0);t(this,"onWindowResizeListener",()=>{this.updateSize(),this.emit("resize")});this.viewArea=s,this.updateSize(),this.setWindowResizeEmitter()}updateSize(){this.width=this.viewArea.offsetWidth,this.height=this.viewArea.offsetHeight,this.pixelRatio=Math.min(window.devicePixelRatio,2)}setWindowResizeEmitter(){window.addEventListener("resize",this.onWindowResizeListener)}removeWindowResizeEmitter(){window.removeEventListener("resize",this.onWindowResizeListener)}onResize(s){return this.on("resize",s)}destroy(){return this.removeWindowResizeEmitter(),this.clearEvents()}}class ne extends h{constructor(){super();t(this,"start");t(this,"current");t(this,"elapsed");t(this,"delta");t(this,"onTickLoopFunction",()=>{const s=Date.now();this.delta=s-this.current,this.current=s,this.elapsed=this.current-this.start,this.emit("tick"),window.requestAnimationFrame(this.currentTickLoopFunction)});t(this,"currentTickLoopFunction",()=>{});this.start=Date.now(),this.current=this.start,this.elapsed=0,this.delta=16}tick(){this.currentTickLoopFunction!==this.onTickLoopFunction&&(this.currentTickLoopFunction=this.onTickLoopFunction,this.currentTickLoopFunction())}onTick(s){return this.on("tick",s)}destroy(){return this.currentTickLoopFunction=()=>{},this.clearEvents()}}class re extends h{constructor(s){super();t(this,"sources");t(this,"items");t(this,"toLoad");t(this,"loaded");t(this,"loaders",{gltfLoader:new p,gltfDracoLoader:new p().setDRACOLoader(new P().setDecoderPath(new E("/assets/draco/").url)),textureLoader:new F,cubeTextureLoader:new G,fontLoader:new X});t(this,"isReady",!1);this.sources=s,this.items={},this.toLoad=this.sources.length,this.loaded=0,this.startLoading()}startLoading(){if(this.sources.length===0)return this.ready();for(const s of this.sources)if(s.type==="gltfModel")this.loaders.gltfLoader.load(s.path,i=>{this.sourceLoaded(s,i)});else if(s.type==="gltfDracoModel")this.loaders.gltfDracoLoader.load(s.path,i=>{this.sourceLoaded(s,i)});else if(s.type==="texture")this.loaders.textureLoader.load(s.path,i=>{this.sourceLoaded(s,i)});else if(s.type==="cubeTexture")this.loaders.cubeTextureLoader.load(s.path,i=>{this.sourceLoaded(s,i)});else if(s.type==="fontJSON")this.loaders.fontLoader.load(s.path,i=>{this.sourceLoaded(s,i)});else throw`Unknow source.type: ${s.type}`}sourceLoaded(s,i){this.items[s.name]=i,this.loaded++,this.loaded===this.toLoad&&this.ready()}ready(){this.isReady=!0,this.emit("ready")}onReady(s){return this.isReady?s():this.once("ready",s)}}class ae{constructor(e){t(this,"main");t(this,"sizes");t(this,"scene");t(this,"canvas");t(this,"instance");t(this,"controls");this.main=e,this.sizes=this.main.sizes,this.scene=this.main.scene,this.canvas=this.main.canvas,this.setInstance(),this.setOrbitControls()}setInstance(){this.instance=new k(75,this.sizes.width/this.sizes.height,.1,100),this.instance.position.set(8,2,-4),this.instance.lookAt(0,0,0),this.scene.add(this.instance)}setOrbitControls(){this.controls=new W(this.instance,this.canvas),this.controls.enableDamping=!0}resize(){this.instance.aspect=this.sizes.width/this.sizes.height,this.instance.updateProjectionMatrix()}update(){this.controls.update()}}class oe{constructor(e){t(this,"renderer");t(this,"coreRenderer");t(this,"sizes");t(this,"scene");t(this,"resources");t(this,"camera");t(this,"webGLRenderTargetResize");t(this,"webGLRenderTargetDestroy");t(this,"webGLRenderTarget");t(this,"effectComposer");t(this,"renderPass");t(this,"resize",()=>{this.effectComposer.setSize(this.sizes.width,this.sizes.height),this.effectComposer.setPixelRatio(this.sizes.pixelRatio)});t(this,"render",()=>{this.effectComposer.render()});this.renderer=e,this.coreRenderer=this.renderer.coreRenderer,{sizes:this.sizes,scene:this.scene,resources:this.resources,camera:this.camera}=this.renderer.main,this.setWebGLRenderTarget(),this.setEffectComposer(),this.resources.onReady(()=>{this.setRenderEffectPass()}),this.renderer.onResize(this.resize),this.renderer.finalRender=this.render}setWebGLRenderTarget(){const e={minFilter:f,magFilter:f,format:U,encoding:c},s=this.coreRenderer.instance;s.getPixelRatio()===1&&(this.webGLRenderTarget=new H(this.sizes.width,this.sizes.height,e),s.getPixelRatio()===1&&s.capabilities.isWebGL2&&(this.webGLRenderTarget.samples=4),this.webGLRenderTargetDestroy=()=>{var i;(i=this.webGLRenderTarget)==null||i.dispose()},this.renderer.onDestroy(this.webGLRenderTargetDestroy))}setEffectComposer(){this.effectComposer=new Y(this.coreRenderer.instance,this.webGLRenderTarget),this.resize()}setRenderEffectPass(){this.renderPass=new Z(this.scene,this.camera.instance),this.effectComposer.addPass(this.renderPass);const e=new o(this.resources.items.interfaceNormalMap);this.effectComposer.addPass(e);const s=new R(K);this.effectComposer.addPass(s),this.setSMAAPass()}setSMAAPass(){const e=this.renderer.coreRenderer.instance;if(e.getPixelRatio()!==1||e.capabilities.isWebGL2)return;const s=new ee(0,0);this.effectComposer.addPass(s)}}const u=class extends R{constructor(e){super(u._shader_),this.material.uniforms.uNormalMap.value=e}};let o=u;t(o,"_shader_",{uniforms:{tDiffuse:{value:null},uNormalMap:{value:null}},vertexShader:`
varying vec2 vUv;
void main()
{
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    
    vUv = uv;
}`,fragmentShader:`
uniform sampler2D tDiffuse;
uniform sampler2D uNormalMap;

varying vec2 vUv;
    
void main()
{
    vec3 normalColor = texture2D(uNormalMap, vUv).xyz * 2.0 - 1.0;

    vec2 newUv = vUv + normalColor.xy * 0.1;
    vec4 color = texture2D(tDiffuse, newUv);

    // \u6DFB\u52A0\u5149\u6548
    vec3 lightDirection = normalize(vec3(- 1.0, 1.0, 0.0));
    float lightness = clamp(dot(normalColor, lightDirection), 0.0, 1.0);
    color.rgb += lightness * 0.25;
    
    gl_FragColor = color;
}`});class he extends h{constructor(s){super();t(this,"main");t(this,"finalRender");t(this,"coreRenderer");this.main=s,this.coreRenderer=new ce(this),new oe(this)}onDestroy(s){this.on("destroy",s)}destroy(){this.coreRenderer.instance.dispose(),this.emit("destroy")}onResize(s){this.on("resize",s)}resize(){this.emit("resize")}update(){this.finalRender()}}class ce{constructor(e){t(this,"renderer");t(this,"main");t(this,"canvas");t(this,"sizes");t(this,"scene");t(this,"camera");t(this,"renderToneMappingDebug");t(this,"instance");t(this,"resize",()=>{this.instance.setSize(this.sizes.width,this.sizes.height),this.instance.setPixelRatio(this.sizes.pixelRatio)});t(this,"render",()=>{this.instance.render(this.scene,this.camera.instance)});this.renderer=e,this.main=this.renderer.main,this.canvas=this.main.canvas,this.sizes=this.main.sizes,this.scene=this.main.scene,this.camera=this.main.camera,this.renderToneMappingDebug=this.main.debug.addFolder("RenderToneMapping"),this.setInstance()}setInstance(){this.instance=new j({canvas:this.canvas,antialias:!0,alpha:!1}),this.instance.physicallyCorrectLights=!0,this.instance.outputEncoding=c,this.instance.toneMapping=g,this.instance.toneMappingExposure=1.5,this.instance.shadowMap.enabled=!0,this.instance.shadowMap.type=N,this.resize(),this.renderToneMappingDebug(e=>{e.add(this.instance,"toneMapping",{No:O,Linear:I,Reinhard:g,Cineon:B,ACESFilmic:V}).onFinishChange(()=>{this.instance.toneMapping=Number(this.instance.toneMapping)}),e.add(this.instance,"toneMappingExposure").min(0).max(10).step(.001)}),this.renderer.onResize(this.resize),this.renderer.finalRender=this.render}}class de{constructor(e){t(this,"main");t(this,"scene");t(this,"resources");t(this,"addDebug");t(this,"directionalLight");t(this,"sunLight");t(this,"environmentMap");this.main=e,this.scene=this.main.scene,this.resources=this.main.resources,this.addDebug=this.main.debug.addFolder("environment"),this.setDirectionalLight(),this.setEnvironmentMap()}setDirectionalLight(){this.directionalLight=new w("#ffffff",3),this.directionalLight.castShadow=!0,this.directionalLight.shadow.mapSize.set(1024,1024),this.directionalLight.shadow.camera.far=15,this.directionalLight.shadow.normalBias=.05,this.directionalLight.position.set(.25,2,-2.25),this.scene.add(this.directionalLight)}setSunLight(){this.sunLight=new w("#ffffff",4),this.sunLight.castShadow=!0,this.sunLight.shadow.camera.far=15,this.sunLight.shadow.mapSize.set(1024,1024),this.sunLight.shadow.normalBias=.05,this.sunLight.position.set(3.5,2,-1.25),this.scene.add(this.sunLight),this.addDebug(e=>{e.add(this.sunLight,"intensity").name("sunLightIntensity").min(0).max(10).step(.001),e.add(this.sunLight.position,"x").name("sunLightX").min(-5).max(5).step(.001),e.add(this.sunLight.position,"y").name("sunLightY").min(-5).max(5).step(.001),e.add(this.sunLight.position,"z").name("sunLightZ").min(-5).max(5).step(.001)})}setEnvironmentMap(){this.environmentMap={},this.environmentMap.intensity=5,this.environmentMap.texture=this.resources.items.environmentMapTexture,this.environmentMap.texture.encoding=c,this.scene.background=this.environmentMap.texture,this.scene.environment=this.environmentMap.texture,this.environmentMap.updateMaterials=()=>{this.scene.traverse(e=>{e instanceof d&&e.material instanceof $&&(e.material.envMap=this.environmentMap.texture,e.material.envMapIntensity=this.environmentMap.intensity,e.material.needsUpdate=!0,e.castShadow=!0,e.receiveShadow=!0)})},this.environmentMap.updateMaterials(),this.addDebug(e=>{e.add(this.environmentMap,"intensity").name("envMapIntensity").min(0).max(4).step(.001).onChange(()=>{this.environmentMap.updateMaterials()})})}}class ue{constructor(e){t(this,"main");t(this,"scene");t(this,"addDebug");t(this,"isShowAxesHelper",!0);t(this,"axesHelper");this.main=e,this.scene=this.main.scene,this.addDebug=this.main.debug.addFolder("AxesHelper"),this.setAxesHelper()}setAxesHelper(){this.addDebug(e=>{this.axesHelper=new q(1),this.toggleAxesHelper(),e.open(),e.add(this,"isShowAxesHelper").onChange(s=>{this.toggleAxesHelper()})})}toggleAxesHelper(e){(typeof e=="boolean"?e:this.isShowAxesHelper)?this.scene.add(this.axesHelper):this.scene.remove(this.axesHelper)}}class le{constructor(e){t(this,"main");t(this,"scene");t(this,"resources");t(this,"time");t(this,"addDebug");t(this,"resource");t(this,"model");t(this,"animation");this.main=e,this.scene=this.main.scene,this.resources=this.main.resources,this.time=this.main.time,this.addDebug=this.main.debug.addFolder("Model"),this.setModel()}setModel(){this.resource=this.main.resources.items.model,this.model=this.resource.scene.children[0],this.model.scale.set(2,2,2),this.model.rotation.z=-Math.PI*.5,this.scene.add(this.model),this.model.traverse(e=>{e instanceof d&&(e.castShadow=!0)})}setAnimation(){this.animation={},this.animation.mixer=new J(this.model),this.animation.actions={},this.animation.actions.idle=this.animation.mixer.clipAction(this.resource.animations[0]),this.animation.actions.walking=this.animation.mixer.clipAction(this.resource.animations[1]),this.animation.actions.running=this.animation.mixer.clipAction(this.resource.animations[2]),this.animation.actions.current=this.animation.actions.idle,this.animation.actions.current.play(),this.animation.play=e=>{const s=this.animation.actions[e],i=this.animation.actions.current;s.reset(),s.play(),s.crossFadeFrom(i,1),this.animation.actions.current=s}}update(){}}class me{constructor(e){t(this,"main");t(this,"scene");t(this,"environment");t(this,"resources");t(this,"axesHelper");t(this,"model");this.main=e,this.scene=this.main.scene,this.resources=this.main.resources,this.resources.onReady(()=>{this.model=new le(this.main),this.environment=new de(this.main),this.axesHelper=new ue(this.main)})}resize(){}update(){var e;(e=this.model)==null||e.update()}}var pe=[{name:"environmentMapTexture",type:"cubeTexture",path:[new URL("/l00/static/jpg/px-a0e41bf9.jpg?url",self.location).href,new URL("/l00/static/jpg/nx-57f73ba7.jpg?url",self.location).href,new URL("/l00/static/jpg/py-7322f97e.jpg?url",self.location).href,new URL("/l00/static/jpg/ny-d209a134.jpg?url",self.location).href,new URL("/l00/static/jpg/pz-b0eb9498.jpg?url",self.location).href,new URL("/l00/static/jpg/nz-fc946930.jpg?url",self.location).href]},{name:"model",type:"gltfDracoModel",path:new URL("/l00/static/gltf/DamagedHelmet-c0fa7be5.gltf?url",self.location).href},{name:"interfaceNormalMap",type:"texture",path:new URL("/l00/static/png/interfaceNormalMap-6db0fb12.png?url",self.location).href}];class fe{constructor(e,s){t(this,"canvas");t(this,"viewArea");t(this,"sizes");t(this,"time");t(this,"scene");t(this,"resources");t(this,"camera");t(this,"renderer");t(this,"world");t(this,"isPlayAnimation",!0);t(this,"debug");this.canvas=e,this.viewArea=s,this.debug=new te(this),this.sizes=new ie(s),this.time=new ne,this.scene=new Q,this.resources=new re(pe),this.camera=new ae(this),this.renderer=new he(this),this.world=new me(this),this.sizes.onResize(()=>this.resize()),this.time.onTick(()=>this.update())}resize(){this.camera.resize(),this.world.resize(),this.renderer.resize()}update(){this.camera.update(),this.world.update(),this.renderer.update()}render(){this.time.tick()}destroy(){this.sizes.destroy(),this.time.destroy(),this.renderer.destroy(),this.camera.controls.dispose(),this.debug.destroy(),this.scene.traverse(e=>{if(e instanceof d){e.geometry.dispose();for(const s in e.material){const i=e.material[s];i&&typeof i.dispose=="function"&&i.dispose()}}})}}const ge=n=>(D("data-v-53e3f5bb"),n=n(),S(),n),we=ge(()=>M("div",{class:"background"},null,-1)),ve=v({name:"l00-PostProcessing",props:{onMounted:{type:Function,required:!1}},setup(n){const e=m(),s=m();let i;return b(async()=>{const r=e.value,a=s.value;i=new fe(r,a),i.render()}),A(()=>{i==null||i.destroy()}),(r,a)=>(L(),x("section",T(r.$attrs,{ref_key:"viewArea",ref:s}),[we,M("canvas",{class:"",ref_key:"canvas",ref:e},null,512)],16))}});var Le=_(ve,[["__scopeId","data-v-53e3f5bb"],["__file","/Volumes/Work/l00 Studio/l00/source/src/graphics-components/test-post-processing/l00-PostProcessing.vue"]]);const xe=v({name:"index",setup(n){return(e,s)=>(L(),x("div",null,[C(Le)]))}});var Ae=_(xe,[["__file","/Volumes/Work/l00 Studio/l00/source/src/graphics-components/test-post-processing/index.vue"]]);export{Ae as default};
