var _c=Object.defineProperty;var hc=(c,t,e)=>t in c?_c(c,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[t]=e;var li=(c,t,e)=>(hc(c,typeof t!="symbol"?t+"":t,e),e);import{N as cc,d as pc,h as Fo,l as mc,i as uc,o as Ml,b as fc,a as dc,e as mo,I as gc,F as vc,p as xc,g as bc}from"./vendor-f8719ffa.js";import{_ as yc}from"./preload-helper-33ac5944.js";import{D as Mc,G as wc,P as Xc,l as Sr,i as zc,M as lh,I as Ic,a3 as Yc,a4 as Zc,a as Sc,O as Lc,g as Ac,S as Tc,W as Vc,h as Ec,T as Cc,a2 as wl}from"./OrbitControls-f9727bec.js";import{S as _h}from"./SVGLoader-75ba3533.js";import{_ as Pc}from"./plugin-vue_export-helper-46f75680.js";var Rc="/l00/static/glb/one-f83feb52.glb";const xa=class{};let ts=xa;li(ts,"agent",navigator.userAgent.toLowerCase()),li(ts,"mobile",!!navigator.maxTouchPoints),li(ts,"tablet",xa.mobile&&Math.max(screen.width,screen.height)>1e3),li(ts,"phone",xa.mobile&&!xa.tablet),li(ts,"webgl",(()=>{if(typeof window=="undefined")return;const t={failIfMajorPerformanceCaveat:!0};let e=document.createElement("canvas"),i=e.getContext("webgl2",t);const n=!!i;return i=null,e=null,n})());class Pi{}li(Pi,"STATE_CHANGE","state_change"),li(Pi,"VIEW_CHANGE","view_change"),li(Pi,"KEY_DOWN","key_down"),li(Pi,"KEY_UP","key_up"),li(Pi,"KEY_PRESS","key_press"),li(Pi,"RESIZE","resize"),li(Pi,"VISIBILITY","visibility"),li(Pi,"PROGRESS","progress"),li(Pi,"COMPLETE","complete"),li(Pi,"UPDATE","update"),li(Pi,"HOVER","hover"),li(Pi,"CLICK","click"),li(Pi,"COLOR_PICKER","color_picker"),li(Pi,"INVERT","invert"),li(Pi,"SELECT","select");for(let c=0;c<256;c++)(c<16?"0":"")+c.toString(16);function kc(c,t){return c+Math.floor(Math.random()*(t-c+1))}function Bc(c){return Math.pow(2,Math.floor(Math.log(c)/Math.LN2))}function Dc(){return(Date.now()+kc(0,99999)).toString()}class Wn{static add(t,e){!this.cache||(this.files[t]=e)}static get(t){if(!!this.cache)return this.files[t]}static remove(t){delete this.files[t]}static clear(){this.files={}}static filter(t){return Object.keys(this.files).filter(t).reduce((i,n)=>(i[n]=this.files[n],i),{})}static getPath(t){return this.path+t}static loadImage(t,e){const i=new Image;i.crossOrigin=this.crossOrigin,i.src=this.getPath(t);const n=new Promise((s,o)=>{i.onload=()=>{s(i),i.onload=null},i.onerror=r=>{o(r),i.onerror=null}});return e&&n.then(e),n}static loadData(t,e){const i=fetch(`${this.getPath(t)}?${Dc()}`,this.options).then(n=>n.json());return e&&i.then(e),i}}li(Wn,"path",""),li(Wn,"crossOrigin"),li(Wn,"options"),li(Wn,"cache",!1),li(Wn,"files",{});class Fc{constructor(){this.callbacks={}}on(t,e){this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e)}off(t,e){if(!!this.callbacks[t])if(e){const i=this.callbacks[t].indexOf(e);~i&&this.callbacks[t].splice(i,1)}else delete this.callbacks[t]}emit(t,e={}){if(!this.callbacks[t])return;const i=this.callbacks[t].slice();for(let n=0,s=i.length;n<s;n++)i[n].call(this,e)}destroy(){for(const t in this)this[t]=null;return null}}/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Gr="140",Nc=0,Xl=1,Oc=2,hh=1,Uc=2,ma=3,ba=0,xn=1,Ns=2,ch=1,Yn=0,Ds=1,zl=2,Il=3,Yl=4,Gc=5,Vs=100,Hc=101,Wc=102,Zl=103,Sl=104,jc=200,qc=201,Jc=202,$c=203,ph=204,mh=205,Qc=206,Kc=207,t0=208,e0=209,i0=210,n0=0,s0=1,a0=2,Lr=3,o0=4,r0=5,l0=6,_0=7,Zo=0,h0=1,c0=2,kn=0,p0=1,m0=2,u0=3,f0=4,d0=5,uh=300,Os=301,Us=302,Ar=303,Tr=304,So=306,Vr=1e3,dn=1001,Er=1002,Hi=1003,Ll=1004,Al=1005,an=1006,g0=1007,Lo=1008,cs=1009,v0=1010,x0=1011,ya=1012,b0=1013,uo=1014,rs=1015,Ma=1016,y0=1017,M0=1018,Fs=1020,w0=1021,X0=1022,gn=1023,z0=1024,I0=1025,_s=1026,Gs=1027,Y0=1028,Z0=1029,S0=1030,L0=1031,A0=1033,No=33776,Oo=33777,Uo=33778,Go=33779,Tl=35840,Vl=35841,El=35842,Cl=35843,T0=36196,Pl=37492,Rl=37496,kl=37808,Bl=37809,Dl=37810,Fl=37811,Nl=37812,Ol=37813,Ul=37814,Gl=37815,Hl=37816,Wl=37817,jl=37818,ql=37819,Jl=37820,$l=37821,Ql=36492,V0=2200,E0=2201,C0=2202,go=2300,vo=2301,Ho=2302,Es=2400,Cs=2401,xo=2402,Hr=2500,fh=2501,P0=0,Jn=3e3,Vi=3001,R0=3200,k0=3201,js=0,B0=1,Rn="srgb",ls="srgb-linear",Wo=7680,D0=519,wa=35044,bo=35048,yo="300 es",Cr=1035;class ps{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const i=this._listeners;return i[t]!==void 0&&i[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const n=this._listeners[t];if(n!==void 0){const s=n.indexOf(e);s!==-1&&n.splice(s,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const i=this._listeners[t.type];if(i!==void 0){t.target=this;const n=i.slice(0);for(let s=0,o=n.length;s<o;s++)n[s].call(this,t);t.target=null}}}const Ji=[];for(let c=0;c<256;c++)Ji[c]=(c<16?"0":"")+c.toString(16);const jo=Math.PI/180,Pr=180/Math.PI;function Zn(){const c=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Ji[c&255]+Ji[c>>8&255]+Ji[c>>16&255]+Ji[c>>24&255]+"-"+Ji[t&255]+Ji[t>>8&255]+"-"+Ji[t>>16&15|64]+Ji[t>>24&255]+"-"+Ji[e&63|128]+Ji[e>>8&255]+"-"+Ji[e>>16&255]+Ji[e>>24&255]+Ji[i&255]+Ji[i>>8&255]+Ji[i>>16&255]+Ji[i>>24&255]).toLowerCase()}function Qi(c,t,e){return Math.max(t,Math.min(e,c))}function F0(c,t){return(c%t+t)%t}function qo(c,t,e){return(1-e)*c+e*t}function Kl(c){return(c&c-1)===0&&c!==0}function Rr(c){return Math.pow(2,Math.floor(Math.log(c)/Math.LN2))}class Fe{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return e!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return e!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,i){return i!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),s=this.x-t.x,o=this.y-t.y;return this.x=s*i-o*n+t.x,this.y=s*n+o*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}Fe.prototype.isVector2=!0;class Wi{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,s,o,r,_,a){const l=this.elements;return l[0]=t,l[1]=n,l[2]=r,l[3]=e,l[4]=s,l[5]=_,l[6]=i,l[7]=o,l[8]=a,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,s=this.elements,o=i[0],r=i[3],_=i[6],a=i[1],l=i[4],h=i[7],m=i[2],f=i[5],p=i[8],d=n[0],u=n[3],g=n[6],v=n[1],x=n[4],b=n[7],Y=n[2],w=n[5],Z=n[8];return s[0]=o*d+r*v+_*Y,s[3]=o*u+r*x+_*w,s[6]=o*g+r*b+_*Z,s[1]=a*d+l*v+h*Y,s[4]=a*u+l*x+h*w,s[7]=a*g+l*b+h*Z,s[2]=m*d+f*v+p*Y,s[5]=m*u+f*x+p*w,s[8]=m*g+f*b+p*Z,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],o=t[4],r=t[5],_=t[6],a=t[7],l=t[8];return e*o*l-e*r*a-i*s*l+i*r*_+n*s*a-n*o*_}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],o=t[4],r=t[5],_=t[6],a=t[7],l=t[8],h=l*o-r*a,m=r*_-l*s,f=a*s-o*_,p=e*h+i*m+n*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const d=1/p;return t[0]=h*d,t[1]=(n*a-l*i)*d,t[2]=(r*i-n*o)*d,t[3]=m*d,t[4]=(l*e-n*_)*d,t[5]=(n*s-r*e)*d,t[6]=f*d,t[7]=(i*_-a*e)*d,t[8]=(o*e-i*s)*d,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,n,s,o,r){const _=Math.cos(s),a=Math.sin(s);return this.set(i*_,i*a,-i*(_*o+a*r)+o+t,-n*a,n*_,-n*(-a*o+_*r)+r+e,0,0,1),this}scale(t,e){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.elements,s=n[0],o=n[3],r=n[6],_=n[1],a=n[4],l=n[7];return n[0]=e*s+i*_,n[3]=e*o+i*a,n[6]=e*r+i*l,n[1]=-i*s+e*_,n[4]=-i*o+e*a,n[7]=-i*r+e*l,this}translate(t,e){const i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}equals(t){const e=this.elements,i=t.elements;for(let n=0;n<9;n++)if(e[n]!==i[n])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return new this.constructor().fromArray(this.elements)}}Wi.prototype.isMatrix3=!0;function dh(c){for(let t=c.length-1;t>=0;--t)if(c[t]>65535)return!0;return!1}function Xa(c){return document.createElementNS("http://www.w3.org/1999/xhtml",c)}function hs(c){return c<.04045?c*.0773993808:Math.pow(c*.9478672986+.0521327014,2.4)}function fo(c){return c<.0031308?c*12.92:1.055*Math.pow(c,.41666)-.055}const Jo={[Rn]:{[ls]:hs},[ls]:{[Rn]:fo}},pn={legacyMode:!0,get workingColorSpace(){return ls},set workingColorSpace(c){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(c,t,e){if(this.legacyMode||t===e||!t||!e)return c;if(Jo[t]&&Jo[t][e]!==void 0){const i=Jo[t][e];return c.r=i(c.r),c.g=i(c.g),c.b=i(c.b),c}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(c,t){return this.convert(c,this.workingColorSpace,t)},toWorkingColorSpace:function(c,t){return this.convert(c,t,this.workingColorSpace)}},gh={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Fi={r:0,g:0,b:0},mn={h:0,s:0,l:0},Ea={h:0,s:0,l:0};function $o(c,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?c+(t-c)*6*e:e<1/2?t:e<2/3?c+(t-c)*6*(2/3-e):c}function Ca(c,t){return t.r=c.r,t.g=c.g,t.b=c.b,t}class fi{constructor(t,e,i){return e===void 0&&i===void 0?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=Rn){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,pn.toWorkingColorSpace(this,e),this}setRGB(t,e,i,n=ls){return this.r=t,this.g=e,this.b=i,pn.toWorkingColorSpace(this,n),this}setHSL(t,e,i,n=ls){if(t=F0(t,1),e=Qi(e,0,1),i=Qi(i,0,1),e===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+e):i+e-i*e,o=2*i-s;this.r=$o(o,s,t+1/3),this.g=$o(o,s,t),this.b=$o(o,s,t-1/3)}return pn.toWorkingColorSpace(this,n),this}setStyle(t,e=Rn){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let s;const o=n[1],r=n[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(s[1],10))/255,this.g=Math.min(255,parseInt(s[2],10))/255,this.b=Math.min(255,parseInt(s[3],10))/255,pn.toWorkingColorSpace(this,e),i(s[4]),this;if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(s[1],10))/100,this.g=Math.min(100,parseInt(s[2],10))/100,this.b=Math.min(100,parseInt(s[3],10))/100,pn.toWorkingColorSpace(this,e),i(s[4]),this;break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r)){const _=parseFloat(s[1])/360,a=parseInt(s[2],10)/100,l=parseInt(s[3],10)/100;return i(s[4]),this.setHSL(_,a,l,e)}break}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=n[1],o=s.length;if(o===3)return this.r=parseInt(s.charAt(0)+s.charAt(0),16)/255,this.g=parseInt(s.charAt(1)+s.charAt(1),16)/255,this.b=parseInt(s.charAt(2)+s.charAt(2),16)/255,pn.toWorkingColorSpace(this,e),this;if(o===6)return this.r=parseInt(s.charAt(0)+s.charAt(1),16)/255,this.g=parseInt(s.charAt(2)+s.charAt(3),16)/255,this.b=parseInt(s.charAt(4)+s.charAt(5),16)/255,pn.toWorkingColorSpace(this,e),this}return t&&t.length>0?this.setColorName(t,e):this}setColorName(t,e=Rn){const i=gh[t.toLowerCase()];return i!==void 0?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=hs(t.r),this.g=hs(t.g),this.b=hs(t.b),this}copyLinearToSRGB(t){return this.r=fo(t.r),this.g=fo(t.g),this.b=fo(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Rn){return pn.fromWorkingColorSpace(Ca(this,Fi),t),Qi(Fi.r*255,0,255)<<16^Qi(Fi.g*255,0,255)<<8^Qi(Fi.b*255,0,255)<<0}getHexString(t=Rn){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=ls){pn.fromWorkingColorSpace(Ca(this,Fi),e);const i=Fi.r,n=Fi.g,s=Fi.b,o=Math.max(i,n,s),r=Math.min(i,n,s);let _,a;const l=(r+o)/2;if(r===o)_=0,a=0;else{const h=o-r;switch(a=l<=.5?h/(o+r):h/(2-o-r),o){case i:_=(n-s)/h+(n<s?6:0);break;case n:_=(s-i)/h+2;break;case s:_=(i-n)/h+4;break}_/=6}return t.h=_,t.s=a,t.l=l,t}getRGB(t,e=ls){return pn.fromWorkingColorSpace(Ca(this,Fi),e),t.r=Fi.r,t.g=Fi.g,t.b=Fi.b,t}getStyle(t=Rn){return pn.fromWorkingColorSpace(Ca(this,Fi),t),t!==Rn?`color(${t} ${Fi.r} ${Fi.g} ${Fi.b})`:`rgb(${Fi.r*255|0},${Fi.g*255|0},${Fi.b*255|0})`}offsetHSL(t,e,i){return this.getHSL(mn),mn.h+=t,mn.s+=e,mn.l+=i,this.setHSL(mn.h,mn.s,mn.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(mn),t.getHSL(Ea);const i=qo(mn.h,Ea.h,e),n=qo(mn.s,Ea.s,e),s=qo(mn.l,Ea.l,e);return this.setHSL(i,n,s),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),t.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}fi.NAMES=gh;fi.prototype.isColor=!0;fi.prototype.r=1;fi.prototype.g=1;fi.prototype.b=1;let fs;class ms{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement=="undefined")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{fs===void 0&&(fs=Xa("canvas")),fs.width=t.width,fs.height=t.height;const i=fs.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=fs}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement!="undefined"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&t instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&t instanceof ImageBitmap){const e=Xa("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const n=i.getImageData(0,0,t.width,t.height),s=n.data;for(let o=0;o<s.length;o++)s[o]=hs(s[o]/255)*255;return i.putImageData(n,0,0),e}else if(t.data){const e=t.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(hs(e[i]/255)*255):e[i]=hs(e[i]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}class Wr{constructor(t=null){this.uuid=Zn(),this.data=t,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(n!==null){let s;if(Array.isArray(n)){s=[];for(let o=0,r=n.length;o<r;o++)n[o].isDataTexture?s.push(Qo(n[o].image)):s.push(Qo(n[o]))}else s=Qo(n);i.url=s}return e||(t.images[this.uuid]=i),i}}function Qo(c){return typeof HTMLImageElement!="undefined"&&c instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&c instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&c instanceof ImageBitmap?ms.getDataURL(c):c.data?{data:Array.prototype.slice.call(c.data),width:c.width,height:c.height,type:c.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Wr.prototype.isSource=!0;let N0=0;class qi extends ps{constructor(t=qi.DEFAULT_IMAGE,e=qi.DEFAULT_MAPPING,i=dn,n=dn,s=an,o=Lo,r=gn,_=cs,a=1,l=Jn){super(),Object.defineProperty(this,"id",{value:N0++}),this.uuid=Zn(),this.name="",this.source=new Wr(t),this.mipmaps=[],this.mapping=e,this.wrapS=i,this.wrapT=n,this.magFilter=s,this.minFilter=o,this.anisotropy=a,this.format=r,this.internalFormat=null,this.type=_,this.offset=new Fe(0,0),this.repeat=new Fe(1,1),this.center=new Fe(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Wi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=l,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==uh)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Vr:t.x=t.x-Math.floor(t.x);break;case dn:t.x=t.x<0?0:1;break;case Er:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Vr:t.y=t.y-Math.floor(t.y);break;case dn:t.y=t.y<0?0:1;break;case Er:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}}qi.DEFAULT_IMAGE=null;qi.DEFAULT_MAPPING=uh;qi.prototype.isTexture=!0;class Zi{constructor(t=0,e=0,i=0,n=1){this.x=t,this.y=e,this.z=i,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t,e){return e!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return e!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,s=this.w,o=t.elements;return this.x=o[0]*e+o[4]*i+o[8]*n+o[12]*s,this.y=o[1]*e+o[5]*i+o[9]*n+o[13]*s,this.z=o[2]*e+o[6]*i+o[10]*n+o[14]*s,this.w=o[3]*e+o[7]*i+o[11]*n+o[15]*s,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,n,s;const _=t.elements,a=_[0],l=_[4],h=_[8],m=_[1],f=_[5],p=_[9],d=_[2],u=_[6],g=_[10];if(Math.abs(l-m)<.01&&Math.abs(h-d)<.01&&Math.abs(p-u)<.01){if(Math.abs(l+m)<.1&&Math.abs(h+d)<.1&&Math.abs(p+u)<.1&&Math.abs(a+f+g-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const x=(a+1)/2,b=(f+1)/2,Y=(g+1)/2,w=(l+m)/4,Z=(h+d)/4,X=(p+u)/4;return x>b&&x>Y?x<.01?(i=0,n=.707106781,s=.707106781):(i=Math.sqrt(x),n=w/i,s=Z/i):b>Y?b<.01?(i=.707106781,n=0,s=.707106781):(n=Math.sqrt(b),i=w/n,s=X/n):Y<.01?(i=.707106781,n=.707106781,s=0):(s=Math.sqrt(Y),i=Z/s,n=X/s),this.set(i,n,s,e),this}let v=Math.sqrt((u-p)*(u-p)+(h-d)*(h-d)+(m-l)*(m-l));return Math.abs(v)<.001&&(v=1),this.x=(u-p)/v,this.y=(h-d)/v,this.z=(m-l)/v,this.w=Math.acos((a+f+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,i){return i!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Zi.prototype.isVector4=!0;class on extends ps{constructor(t,e,i={}){super(),this.width=t,this.height=e,this.depth=1,this.scissor=new Zi(0,0,t,e),this.scissorTest=!1,this.viewport=new Zi(0,0,t,e);const n={width:t,height:e,depth:1};this.texture=new qi(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:an,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(t,e,i=1){(this.width!==t||this.height!==e||this.depth!==i)&&(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new Wr(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}on.prototype.isWebGLRenderTarget=!0;class Ao extends qi{constructor(t=null,e=1,i=1,n=1){super(null),this.image={data:t,width:e,height:i,depth:n},this.magFilter=Hi,this.minFilter=Hi,this.wrapR=dn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Ao.prototype.isDataArrayTexture=!0;class O0 extends on{constructor(t,e,i){super(t,e),this.depth=i,this.texture=new Ao(null,t,e,i),this.texture.isRenderTargetTexture=!0}}O0.prototype.isWebGLArrayRenderTarget=!0;class jr extends qi{constructor(t=null,e=1,i=1,n=1){super(null),this.image={data:t,width:e,height:i,depth:n},this.magFilter=Hi,this.minFilter=Hi,this.wrapR=dn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}jr.prototype.isData3DTexture=!0;class U0 extends on{constructor(t,e,i){super(t,e),this.depth=i,this.texture=new jr(null,t,e,i),this.texture.isRenderTargetTexture=!0}}U0.prototype.isWebGL3DRenderTarget=!0;class G0 extends on{constructor(t,e,i,n={}){super(t,e,n);const s=this.texture;this.texture=[];for(let o=0;o<i;o++)this.texture[o]=s.clone(),this.texture[o].isRenderTargetTexture=!0}setSize(t,e,i=1){if(this.width!==t||this.height!==e||this.depth!==i){this.width=t,this.height=e,this.depth=i;for(let n=0,s=this.texture.length;n<s;n++)this.texture[n].image.width=t,this.texture[n].image.height=e,this.texture[n].image.depth=i;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.texture.length=0;for(let e=0,i=t.texture.length;e<i;e++)this.texture[e]=t.texture[e].clone(),this.texture[e].isRenderTargetTexture=!0;return this}}G0.prototype.isWebGLMultipleRenderTargets=!0;class rn{constructor(t=0,e=0,i=0,n=1){this._x=t,this._y=e,this._z=i,this._w=n}static slerp(t,e,i,n){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(t,e,n)}static slerpFlat(t,e,i,n,s,o,r){let _=i[n+0],a=i[n+1],l=i[n+2],h=i[n+3];const m=s[o+0],f=s[o+1],p=s[o+2],d=s[o+3];if(r===0){t[e+0]=_,t[e+1]=a,t[e+2]=l,t[e+3]=h;return}if(r===1){t[e+0]=m,t[e+1]=f,t[e+2]=p,t[e+3]=d;return}if(h!==d||_!==m||a!==f||l!==p){let u=1-r;const g=_*m+a*f+l*p+h*d,v=g>=0?1:-1,x=1-g*g;if(x>Number.EPSILON){const Y=Math.sqrt(x),w=Math.atan2(Y,g*v);u=Math.sin(u*w)/Y,r=Math.sin(r*w)/Y}const b=r*v;if(_=_*u+m*b,a=a*u+f*b,l=l*u+p*b,h=h*u+d*b,u===1-r){const Y=1/Math.sqrt(_*_+a*a+l*l+h*h);_*=Y,a*=Y,l*=Y,h*=Y}}t[e]=_,t[e+1]=a,t[e+2]=l,t[e+3]=h}static multiplyQuaternionsFlat(t,e,i,n,s,o){const r=i[n],_=i[n+1],a=i[n+2],l=i[n+3],h=s[o],m=s[o+1],f=s[o+2],p=s[o+3];return t[e]=r*p+l*h+_*f-a*m,t[e+1]=_*p+l*m+a*h-r*f,t[e+2]=a*p+l*f+r*m-_*h,t[e+3]=l*p-r*h-_*m-a*f,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!(t&&t.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,n=t._y,s=t._z,o=t._order,r=Math.cos,_=Math.sin,a=r(i/2),l=r(n/2),h=r(s/2),m=_(i/2),f=_(n/2),p=_(s/2);switch(o){case"XYZ":this._x=m*l*h+a*f*p,this._y=a*f*h-m*l*p,this._z=a*l*p+m*f*h,this._w=a*l*h-m*f*p;break;case"YXZ":this._x=m*l*h+a*f*p,this._y=a*f*h-m*l*p,this._z=a*l*p-m*f*h,this._w=a*l*h+m*f*p;break;case"ZXY":this._x=m*l*h-a*f*p,this._y=a*f*h+m*l*p,this._z=a*l*p+m*f*h,this._w=a*l*h-m*f*p;break;case"ZYX":this._x=m*l*h-a*f*p,this._y=a*f*h+m*l*p,this._z=a*l*p-m*f*h,this._w=a*l*h+m*f*p;break;case"YZX":this._x=m*l*h+a*f*p,this._y=a*f*h+m*l*p,this._z=a*l*p-m*f*h,this._w=a*l*h-m*f*p;break;case"XZY":this._x=m*l*h-a*f*p,this._y=a*f*h-m*l*p,this._z=a*l*p+m*f*h,this._w=a*l*h+m*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],n=e[4],s=e[8],o=e[1],r=e[5],_=e[9],a=e[2],l=e[6],h=e[10],m=i+r+h;if(m>0){const f=.5/Math.sqrt(m+1);this._w=.25/f,this._x=(l-_)*f,this._y=(s-a)*f,this._z=(o-n)*f}else if(i>r&&i>h){const f=2*Math.sqrt(1+i-r-h);this._w=(l-_)/f,this._x=.25*f,this._y=(n+o)/f,this._z=(s+a)/f}else if(r>h){const f=2*Math.sqrt(1+r-i-h);this._w=(s-a)/f,this._x=(n+o)/f,this._y=.25*f,this._z=(_+l)/f}else{const f=2*Math.sqrt(1+h-i-r);this._w=(o-n)/f,this._x=(s+a)/f,this._y=(_+l)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Qi(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(i===0)return this;const n=Math.min(1,e/i);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return e!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,n=t._y,s=t._z,o=t._w,r=e._x,_=e._y,a=e._z,l=e._w;return this._x=i*l+o*r+n*a-s*_,this._y=n*l+o*_+s*r-i*a,this._z=s*l+o*a+i*_-n*r,this._w=o*l-i*r-n*_-s*a,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const i=this._x,n=this._y,s=this._z,o=this._w;let r=o*t._w+i*t._x+n*t._y+s*t._z;if(r<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,r=-r):this.copy(t),r>=1)return this._w=o,this._x=i,this._y=n,this._z=s,this;const _=1-r*r;if(_<=Number.EPSILON){const f=1-e;return this._w=f*o+e*this._w,this._x=f*i+e*this._x,this._y=f*n+e*this._y,this._z=f*s+e*this._z,this.normalize(),this._onChangeCallback(),this}const a=Math.sqrt(_),l=Math.atan2(a,r),h=Math.sin((1-e)*l)/a,m=Math.sin(e*l)/a;return this._w=o*h+this._w*m,this._x=i*h+this._x*m,this._y=n*h+this._y*m,this._z=s*h+this._z*m,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),n=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(e*Math.cos(n),i*Math.sin(s),i*Math.cos(s),e*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}rn.prototype.isQuaternion=!0;class wt{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}set(t,e,i){return i===void 0&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return e!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return e!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return e!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(t_.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(t_.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6]*n,this.y=s[1]*e+s[4]*i+s[7]*n,this.z=s[2]*e+s[5]*i+s[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,s=t.elements,o=1/(s[3]*e+s[7]*i+s[11]*n+s[15]);return this.x=(s[0]*e+s[4]*i+s[8]*n+s[12])*o,this.y=(s[1]*e+s[5]*i+s[9]*n+s[13])*o,this.z=(s[2]*e+s[6]*i+s[10]*n+s[14])*o,this}applyQuaternion(t){const e=this.x,i=this.y,n=this.z,s=t.x,o=t.y,r=t.z,_=t.w,a=_*e+o*n-r*i,l=_*i+r*e-s*n,h=_*n+s*i-o*e,m=-s*e-o*i-r*n;return this.x=a*_+m*-s+l*-r-h*-o,this.y=l*_+m*-o+h*-s-a*-r,this.z=h*_+m*-r+a*-o-l*-s,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n,this.y=s[1]*e+s[5]*i+s[9]*n,this.z=s[2]*e+s[6]*i+s[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t,e){return e!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,n=t.y,s=t.z,o=e.x,r=e.y,_=e.z;return this.x=n*_-s*r,this.y=s*o-i*_,this.z=i*r-n*o,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return Ko.copy(this).projectOnVector(t),this.sub(Ko)}reflect(t){return this.sub(Ko.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(Qi(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,i){return i!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}wt.prototype.isVector3=!0;const Ko=new wt,t_=new rn;class yn{constructor(t=new wt(1/0,1/0,1/0),e=new wt(-1/0,-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,i=1/0,n=1/0,s=-1/0,o=-1/0,r=-1/0;for(let _=0,a=t.length;_<a;_+=3){const l=t[_],h=t[_+1],m=t[_+2];l<e&&(e=l),h<i&&(i=h),m<n&&(n=m),l>s&&(s=l),h>o&&(o=h),m>r&&(r=m)}return this.min.set(e,i,n),this.max.set(s,o,r),this}setFromBufferAttribute(t){let e=1/0,i=1/0,n=1/0,s=-1/0,o=-1/0,r=-1/0;for(let _=0,a=t.count;_<a;_++){const l=t.getX(_),h=t.getY(_),m=t.getZ(_);l<e&&(e=l),h<i&&(i=h),m<n&&(n=m),l>s&&(s=l),h>o&&(o=h),m>r&&(r=m)}return this.min.set(e,i,n),this.max.set(s,o,r),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=es.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(i!==void 0)if(e&&i.attributes!=null&&i.attributes.position!==void 0){const s=i.attributes.position;for(let o=0,r=s.count;o<r;o++)es.fromBufferAttribute(s,o).applyMatrix4(t.matrixWorld),this.expandByPoint(es)}else i.boundingBox===null&&i.computeBoundingBox(),tr.copy(i.boundingBox),tr.applyMatrix4(t.matrixWorld),this.union(tr);const n=t.children;for(let s=0,o=n.length;s<o;s++)this.expandByObject(n[s],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,es),es.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(aa),Pa.subVectors(this.max,aa),ds.subVectors(t.a,aa),gs.subVectors(t.b,aa),vs.subVectors(t.c,aa),Bn.subVectors(gs,ds),Dn.subVectors(vs,gs),is.subVectors(ds,vs);let e=[0,-Bn.z,Bn.y,0,-Dn.z,Dn.y,0,-is.z,is.y,Bn.z,0,-Bn.x,Dn.z,0,-Dn.x,is.z,0,-is.x,-Bn.y,Bn.x,0,-Dn.y,Dn.x,0,-is.y,is.x,0];return!er(e,ds,gs,vs,Pa)||(e=[1,0,0,0,1,0,0,0,1],!er(e,ds,gs,vs,Pa))?!1:(Ra.crossVectors(Bn,Dn),e=[Ra.x,Ra.y,Ra.z],er(e,ds,gs,vs,Pa))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return es.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=this.getSize(es).length()*.5,t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(An[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),An[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),An[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),An[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),An[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),An[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),An[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),An[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(An),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}yn.prototype.isBox3=!0;const An=[new wt,new wt,new wt,new wt,new wt,new wt,new wt,new wt],es=new wt,tr=new yn,ds=new wt,gs=new wt,vs=new wt,Bn=new wt,Dn=new wt,is=new wt,aa=new wt,Pa=new wt,Ra=new wt,ns=new wt;function er(c,t,e,i,n){for(let s=0,o=c.length-3;s<=o;s+=3){ns.fromArray(c,s);const r=n.x*Math.abs(ns.x)+n.y*Math.abs(ns.y)+n.z*Math.abs(ns.z),_=t.dot(ns),a=e.dot(ns),l=i.dot(ns);if(Math.max(-Math.max(_,a,l),Math.min(_,a,l))>r)return!1}return!0}const H0=new yn,e_=new wt,ka=new wt,ir=new wt;class qs{constructor(t=new wt,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;e!==void 0?i.copy(e):H0.setFromPoints(t).getCenter(i);let n=0;for(let s=0,o=t.length;s<o;s++)n=Math.max(n,i.distanceToSquared(t[s]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){ir.subVectors(t,this.center);const e=ir.lengthSq();if(e>this.radius*this.radius){const i=Math.sqrt(e),n=(i-this.radius)*.5;this.center.add(ir.multiplyScalar(n/i)),this.radius+=n}return this}union(t){return this.center.equals(t.center)===!0?ka.set(0,0,1).multiplyScalar(t.radius):ka.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(e_.copy(t.center).add(ka)),this.expandByPoint(e_.copy(t.center).sub(ka)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Tn=new wt,nr=new wt,Ba=new wt,Fn=new wt,sr=new wt,Da=new wt,ar=new wt;class Js{constructor(t=new wt,e=new wt(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Tn)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Tn.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Tn.copy(this.direction).multiplyScalar(e).add(this.origin),Tn.distanceToSquared(t))}distanceSqToSegment(t,e,i,n){nr.copy(t).add(e).multiplyScalar(.5),Ba.copy(e).sub(t).normalize(),Fn.copy(this.origin).sub(nr);const s=t.distanceTo(e)*.5,o=-this.direction.dot(Ba),r=Fn.dot(this.direction),_=-Fn.dot(Ba),a=Fn.lengthSq(),l=Math.abs(1-o*o);let h,m,f,p;if(l>0)if(h=o*_-r,m=o*r-_,p=s*l,h>=0)if(m>=-p)if(m<=p){const d=1/l;h*=d,m*=d,f=h*(h+o*m+2*r)+m*(o*h+m+2*_)+a}else m=s,h=Math.max(0,-(o*m+r)),f=-h*h+m*(m+2*_)+a;else m=-s,h=Math.max(0,-(o*m+r)),f=-h*h+m*(m+2*_)+a;else m<=-p?(h=Math.max(0,-(-o*s+r)),m=h>0?-s:Math.min(Math.max(-s,-_),s),f=-h*h+m*(m+2*_)+a):m<=p?(h=0,m=Math.min(Math.max(-s,-_),s),f=m*(m+2*_)+a):(h=Math.max(0,-(o*s+r)),m=h>0?s:Math.min(Math.max(-s,-_),s),f=-h*h+m*(m+2*_)+a);else m=o>0?-s:s,h=Math.max(0,-(o*m+r)),f=-h*h+m*(m+2*_)+a;return i&&i.copy(this.direction).multiplyScalar(h).add(this.origin),n&&n.copy(Ba).multiplyScalar(m).add(nr),f}intersectSphere(t,e){Tn.subVectors(t.center,this.origin);const i=Tn.dot(this.direction),n=Tn.dot(Tn)-i*i,s=t.radius*t.radius;if(n>s)return null;const o=Math.sqrt(s-n),r=i-o,_=i+o;return r<0&&_<0?null:r<0?this.at(_,e):this.at(r,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return i===null?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,n,s,o,r,_;const a=1/this.direction.x,l=1/this.direction.y,h=1/this.direction.z,m=this.origin;return a>=0?(i=(t.min.x-m.x)*a,n=(t.max.x-m.x)*a):(i=(t.max.x-m.x)*a,n=(t.min.x-m.x)*a),l>=0?(s=(t.min.y-m.y)*l,o=(t.max.y-m.y)*l):(s=(t.max.y-m.y)*l,o=(t.min.y-m.y)*l),i>o||s>n||((s>i||i!==i)&&(i=s),(o<n||n!==n)&&(n=o),h>=0?(r=(t.min.z-m.z)*h,_=(t.max.z-m.z)*h):(r=(t.max.z-m.z)*h,_=(t.min.z-m.z)*h),i>_||r>n)||((r>i||i!==i)&&(i=r),(_<n||n!==n)&&(n=_),n<0)?null:this.at(i>=0?i:n,e)}intersectsBox(t){return this.intersectBox(t,Tn)!==null}intersectTriangle(t,e,i,n,s){sr.subVectors(e,t),Da.subVectors(i,t),ar.crossVectors(sr,Da);let o=this.direction.dot(ar),r;if(o>0){if(n)return null;r=1}else if(o<0)r=-1,o=-o;else return null;Fn.subVectors(this.origin,t);const _=r*this.direction.dot(Da.crossVectors(Fn,Da));if(_<0)return null;const a=r*this.direction.dot(sr.cross(Fn));if(a<0||_+a>o)return null;const l=-r*Fn.dot(ar);return l<0?null:this.at(l/o,s)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class xi{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,s,o,r,_,a,l,h,m,f,p,d,u){const g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=n,g[1]=s,g[5]=o,g[9]=r,g[13]=_,g[2]=a,g[6]=l,g[10]=h,g[14]=m,g[3]=f,g[7]=p,g[11]=d,g[15]=u,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new xi().fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,n=1/xs.setFromMatrixColumn(t,0).length(),s=1/xs.setFromMatrixColumn(t,1).length(),o=1/xs.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*s,e[5]=i[5]*s,e[6]=i[6]*s,e[7]=0,e[8]=i[8]*o,e[9]=i[9]*o,e[10]=i[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,i=t.x,n=t.y,s=t.z,o=Math.cos(i),r=Math.sin(i),_=Math.cos(n),a=Math.sin(n),l=Math.cos(s),h=Math.sin(s);if(t.order==="XYZ"){const m=o*l,f=o*h,p=r*l,d=r*h;e[0]=_*l,e[4]=-_*h,e[8]=a,e[1]=f+p*a,e[5]=m-d*a,e[9]=-r*_,e[2]=d-m*a,e[6]=p+f*a,e[10]=o*_}else if(t.order==="YXZ"){const m=_*l,f=_*h,p=a*l,d=a*h;e[0]=m+d*r,e[4]=p*r-f,e[8]=o*a,e[1]=o*h,e[5]=o*l,e[9]=-r,e[2]=f*r-p,e[6]=d+m*r,e[10]=o*_}else if(t.order==="ZXY"){const m=_*l,f=_*h,p=a*l,d=a*h;e[0]=m-d*r,e[4]=-o*h,e[8]=p+f*r,e[1]=f+p*r,e[5]=o*l,e[9]=d-m*r,e[2]=-o*a,e[6]=r,e[10]=o*_}else if(t.order==="ZYX"){const m=o*l,f=o*h,p=r*l,d=r*h;e[0]=_*l,e[4]=p*a-f,e[8]=m*a+d,e[1]=_*h,e[5]=d*a+m,e[9]=f*a-p,e[2]=-a,e[6]=r*_,e[10]=o*_}else if(t.order==="YZX"){const m=o*_,f=o*a,p=r*_,d=r*a;e[0]=_*l,e[4]=d-m*h,e[8]=p*h+f,e[1]=h,e[5]=o*l,e[9]=-r*l,e[2]=-a*l,e[6]=f*h+p,e[10]=m-d*h}else if(t.order==="XZY"){const m=o*_,f=o*a,p=r*_,d=r*a;e[0]=_*l,e[4]=-h,e[8]=a*l,e[1]=m*h+d,e[5]=o*l,e[9]=f*h-p,e[2]=p*h-f,e[6]=r*l,e[10]=d*h+m}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(W0,t,j0)}lookAt(t,e,i){const n=this.elements;return ln.subVectors(t,e),ln.lengthSq()===0&&(ln.z=1),ln.normalize(),Nn.crossVectors(i,ln),Nn.lengthSq()===0&&(Math.abs(i.z)===1?ln.x+=1e-4:ln.z+=1e-4,ln.normalize(),Nn.crossVectors(i,ln)),Nn.normalize(),Fa.crossVectors(ln,Nn),n[0]=Nn.x,n[4]=Fa.x,n[8]=ln.x,n[1]=Nn.y,n[5]=Fa.y,n[9]=ln.y,n[2]=Nn.z,n[6]=Fa.z,n[10]=ln.z,this}multiply(t,e){return e!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,s=this.elements,o=i[0],r=i[4],_=i[8],a=i[12],l=i[1],h=i[5],m=i[9],f=i[13],p=i[2],d=i[6],u=i[10],g=i[14],v=i[3],x=i[7],b=i[11],Y=i[15],w=n[0],Z=n[4],X=n[8],M=n[12],z=n[1],T=n[5],F=n[9],P=n[13],A=n[2],L=n[6],S=n[10],R=n[14],E=n[3],C=n[7],k=n[11],V=n[15];return s[0]=o*w+r*z+_*A+a*E,s[4]=o*Z+r*T+_*L+a*C,s[8]=o*X+r*F+_*S+a*k,s[12]=o*M+r*P+_*R+a*V,s[1]=l*w+h*z+m*A+f*E,s[5]=l*Z+h*T+m*L+f*C,s[9]=l*X+h*F+m*S+f*k,s[13]=l*M+h*P+m*R+f*V,s[2]=p*w+d*z+u*A+g*E,s[6]=p*Z+d*T+u*L+g*C,s[10]=p*X+d*F+u*S+g*k,s[14]=p*M+d*P+u*R+g*V,s[3]=v*w+x*z+b*A+Y*E,s[7]=v*Z+x*T+b*L+Y*C,s[11]=v*X+x*F+b*S+Y*k,s[15]=v*M+x*P+b*R+Y*V,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],n=t[8],s=t[12],o=t[1],r=t[5],_=t[9],a=t[13],l=t[2],h=t[6],m=t[10],f=t[14],p=t[3],d=t[7],u=t[11],g=t[15];return p*(+s*_*h-n*a*h-s*r*m+i*a*m+n*r*f-i*_*f)+d*(+e*_*f-e*a*m+s*o*m-n*o*f+n*a*l-s*_*l)+u*(+e*a*h-e*r*f-s*o*h+i*o*f+s*r*l-i*a*l)+g*(-n*r*l-e*_*h+e*r*m+n*o*h-i*o*m+i*_*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],o=t[4],r=t[5],_=t[6],a=t[7],l=t[8],h=t[9],m=t[10],f=t[11],p=t[12],d=t[13],u=t[14],g=t[15],v=h*u*a-d*m*a+d*_*f-r*u*f-h*_*g+r*m*g,x=p*m*a-l*u*a-p*_*f+o*u*f+l*_*g-o*m*g,b=l*d*a-p*h*a+p*r*f-o*d*f-l*r*g+o*h*g,Y=p*h*_-l*d*_-p*r*m+o*d*m+l*r*u-o*h*u,w=e*v+i*x+n*b+s*Y;if(w===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Z=1/w;return t[0]=v*Z,t[1]=(d*m*s-h*u*s-d*n*f+i*u*f+h*n*g-i*m*g)*Z,t[2]=(r*u*s-d*_*s+d*n*a-i*u*a-r*n*g+i*_*g)*Z,t[3]=(h*_*s-r*m*s-h*n*a+i*m*a+r*n*f-i*_*f)*Z,t[4]=x*Z,t[5]=(l*u*s-p*m*s+p*n*f-e*u*f-l*n*g+e*m*g)*Z,t[6]=(p*_*s-o*u*s-p*n*a+e*u*a+o*n*g-e*_*g)*Z,t[7]=(o*m*s-l*_*s+l*n*a-e*m*a-o*n*f+e*_*f)*Z,t[8]=b*Z,t[9]=(p*h*s-l*d*s-p*i*f+e*d*f+l*i*g-e*h*g)*Z,t[10]=(o*d*s-p*r*s+p*i*a-e*d*a-o*i*g+e*r*g)*Z,t[11]=(l*r*s-o*h*s-l*i*a+e*h*a+o*i*f-e*r*f)*Z,t[12]=Y*Z,t[13]=(l*d*n-p*h*n+p*i*m-e*d*m-l*i*u+e*h*u)*Z,t[14]=(p*r*n-o*d*n-p*i*_+e*d*_+o*i*u-e*r*u)*Z,t[15]=(o*h*n-l*r*n+l*i*_-e*h*_-o*i*m+e*r*m)*Z,this}scale(t){const e=this.elements,i=t.x,n=t.y,s=t.z;return e[0]*=i,e[4]*=n,e[8]*=s,e[1]*=i,e[5]*=n,e[9]*=s,e[2]*=i,e[6]*=n,e[10]*=s,e[3]*=i,e[7]*=n,e[11]*=s,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),n=Math.sin(e),s=1-i,o=t.x,r=t.y,_=t.z,a=s*o,l=s*r;return this.set(a*o+i,a*r-n*_,a*_+n*r,0,a*r+n*_,l*r+i,l*_-n*o,0,a*_-n*r,l*_+n*o,s*_*_+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,n,s,o){return this.set(1,i,s,0,t,1,o,0,e,n,1,0,0,0,0,1),this}compose(t,e,i){const n=this.elements,s=e._x,o=e._y,r=e._z,_=e._w,a=s+s,l=o+o,h=r+r,m=s*a,f=s*l,p=s*h,d=o*l,u=o*h,g=r*h,v=_*a,x=_*l,b=_*h,Y=i.x,w=i.y,Z=i.z;return n[0]=(1-(d+g))*Y,n[1]=(f+b)*Y,n[2]=(p-x)*Y,n[3]=0,n[4]=(f-b)*w,n[5]=(1-(m+g))*w,n[6]=(u+v)*w,n[7]=0,n[8]=(p+x)*Z,n[9]=(u-v)*Z,n[10]=(1-(m+d))*Z,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,i){const n=this.elements;let s=xs.set(n[0],n[1],n[2]).length();const o=xs.set(n[4],n[5],n[6]).length(),r=xs.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),t.x=n[12],t.y=n[13],t.z=n[14],un.copy(this);const a=1/s,l=1/o,h=1/r;return un.elements[0]*=a,un.elements[1]*=a,un.elements[2]*=a,un.elements[4]*=l,un.elements[5]*=l,un.elements[6]*=l,un.elements[8]*=h,un.elements[9]*=h,un.elements[10]*=h,e.setFromRotationMatrix(un),i.x=s,i.y=o,i.z=r,this}makePerspective(t,e,i,n,s,o){o===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const r=this.elements,_=2*s/(e-t),a=2*s/(i-n),l=(e+t)/(e-t),h=(i+n)/(i-n),m=-(o+s)/(o-s),f=-2*o*s/(o-s);return r[0]=_,r[4]=0,r[8]=l,r[12]=0,r[1]=0,r[5]=a,r[9]=h,r[13]=0,r[2]=0,r[6]=0,r[10]=m,r[14]=f,r[3]=0,r[7]=0,r[11]=-1,r[15]=0,this}makeOrthographic(t,e,i,n,s,o){const r=this.elements,_=1/(e-t),a=1/(i-n),l=1/(o-s),h=(e+t)*_,m=(i+n)*a,f=(o+s)*l;return r[0]=2*_,r[4]=0,r[8]=0,r[12]=-h,r[1]=0,r[5]=2*a,r[9]=0,r[13]=-m,r[2]=0,r[6]=0,r[10]=-2*l,r[14]=-f,r[3]=0,r[7]=0,r[11]=0,r[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let n=0;n<16;n++)if(e[n]!==i[n])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}xi.prototype.isMatrix4=!0;const xs=new wt,un=new xi,W0=new wt(0,0,0),j0=new wt(1,1,1),Nn=new wt,Fa=new wt,ln=new wt,i_=new xi,n_=new rn;class us{constructor(t=0,e=0,i=0,n=us.DefaultOrder){this._x=t,this._y=e,this._z=i,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,n=this._order){return this._x=t,this._y=e,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const n=t.elements,s=n[0],o=n[4],r=n[8],_=n[1],a=n[5],l=n[9],h=n[2],m=n[6],f=n[10];switch(e){case"XYZ":this._y=Math.asin(Qi(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(-l,f),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(m,a),this._z=0);break;case"YXZ":this._x=Math.asin(-Qi(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(r,f),this._z=Math.atan2(_,a)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(Qi(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-o,a)):(this._y=0,this._z=Math.atan2(_,s));break;case"ZYX":this._y=Math.asin(-Qi(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(m,f),this._z=Math.atan2(_,s)):(this._x=0,this._z=Math.atan2(-o,a));break;case"YZX":this._z=Math.asin(Qi(_,-1,1)),Math.abs(_)<.9999999?(this._x=Math.atan2(-l,a),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(r,f));break;case"XZY":this._z=Math.asin(-Qi(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(m,a),this._y=Math.atan2(r,s)):(this._x=Math.atan2(-l,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,i===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return i_.makeRotationFromQuaternion(t),this.setFromRotationMatrix(i_,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return n_.setFromEuler(this),this.setFromQuaternion(n_,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}us.prototype.isEuler=!0;us.DefaultOrder="XYZ";us.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class vh{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let q0=0;const s_=new wt,bs=new rn,Vn=new xi,Na=new wt,oa=new wt,J0=new wt,$0=new rn,a_=new wt(1,0,0),o_=new wt(0,1,0),r_=new wt(0,0,1),Q0={type:"added"},l_={type:"removed"};class Li extends ps{constructor(){super(),Object.defineProperty(this,"id",{value:q0++}),this.uuid=Zn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Li.DefaultUp.clone();const t=new wt,e=new us,i=new rn,n=new wt(1,1,1);function s(){i.setFromEuler(e,!1)}function o(){e.setFromQuaternion(i,void 0,!1)}e._onChange(s),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new xi},normalMatrix:{value:new Wi}}),this.matrix=new xi,this.matrixWorld=new xi,this.matrixAutoUpdate=Li.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new vh,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return bs.setFromAxisAngle(t,e),this.quaternion.multiply(bs),this}rotateOnWorldAxis(t,e){return bs.setFromAxisAngle(t,e),this.quaternion.premultiply(bs),this}rotateX(t){return this.rotateOnAxis(a_,t)}rotateY(t){return this.rotateOnAxis(o_,t)}rotateZ(t){return this.rotateOnAxis(r_,t)}translateOnAxis(t,e){return s_.copy(t).applyQuaternion(this.quaternion),this.position.add(s_.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(a_,t)}translateY(t){return this.translateOnAxis(o_,t)}translateZ(t){return this.translateOnAxis(r_,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(Vn.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?Na.copy(t):Na.set(t,e,i);const n=this.parent;this.updateWorldMatrix(!0,!1),oa.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Vn.lookAt(oa,Na,this.up):Vn.lookAt(Na,oa,this.up),this.quaternion.setFromRotationMatrix(Vn),n&&(Vn.extractRotation(n.matrixWorld),bs.setFromRotationMatrix(Vn),this.quaternion.premultiply(bs.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Q0)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(l_)),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(l_)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Vn.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),Vn.multiply(t.parent.matrixWorld)),t.applyMatrix4(Vn),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,n=this.children.length;i<n;i++){const o=this.children[i].getObjectByProperty(t,e);if(o!==void 0)return o}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(oa,t,J0),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(oa,$0,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].updateMatrixWorld(t)}updateWorldMatrix(t,e){const i=this.parent;if(t===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){const n=this.children;for(let s=0,o=n.length;s<o;s++)n[s].updateWorldMatrix(!1,!0)}}toJSON(t){const e=t===void 0||typeof t=="string",i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON()));function s(r,_){return r[_.uuid]===void 0&&(r[_.uuid]=_.toJSON(t)),_.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=s(t.geometries,this.geometry);const r=this.geometry.parameters;if(r!==void 0&&r.shapes!==void 0){const _=r.shapes;if(Array.isArray(_))for(let a=0,l=_.length;a<l;a++){const h=_[a];s(t.shapes,h)}else s(t.shapes,_)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const r=[];for(let _=0,a=this.material.length;_<a;_++)r.push(s(t.materials,this.material[_]));n.material=r}else n.material=s(t.materials,this.material);if(this.children.length>0){n.children=[];for(let r=0;r<this.children.length;r++)n.children.push(this.children[r].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let r=0;r<this.animations.length;r++){const _=this.animations[r];n.animations.push(s(t.animations,_))}}if(e){const r=o(t.geometries),_=o(t.materials),a=o(t.textures),l=o(t.images),h=o(t.shapes),m=o(t.skeletons),f=o(t.animations),p=o(t.nodes);r.length>0&&(i.geometries=r),_.length>0&&(i.materials=_),a.length>0&&(i.textures=a),l.length>0&&(i.images=l),h.length>0&&(i.shapes=h),m.length>0&&(i.skeletons=m),f.length>0&&(i.animations=f),p.length>0&&(i.nodes=p)}return i.object=n,i;function o(r){const _=[];for(const a in r){const l=r[a];delete l.metadata,_.push(l)}return _}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let i=0;i<t.children.length;i++){const n=t.children[i];this.add(n.clone())}return this}}Li.DefaultUp=new wt(0,1,0);Li.DefaultMatrixAutoUpdate=!0;Li.prototype.isObject3D=!0;const fn=new wt,En=new wt,or=new wt,Cn=new wt,ys=new wt,Ms=new wt,__=new wt,rr=new wt,lr=new wt,_r=new wt;class Di{constructor(t=new wt,e=new wt,i=new wt){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,n){n.subVectors(i,e),fn.subVectors(t,e),n.cross(fn);const s=n.lengthSq();return s>0?n.multiplyScalar(1/Math.sqrt(s)):n.set(0,0,0)}static getBarycoord(t,e,i,n,s){fn.subVectors(n,e),En.subVectors(i,e),or.subVectors(t,e);const o=fn.dot(fn),r=fn.dot(En),_=fn.dot(or),a=En.dot(En),l=En.dot(or),h=o*a-r*r;if(h===0)return s.set(-2,-1,-1);const m=1/h,f=(a*_-r*l)*m,p=(o*l-r*_)*m;return s.set(1-f-p,p,f)}static containsPoint(t,e,i,n){return this.getBarycoord(t,e,i,n,Cn),Cn.x>=0&&Cn.y>=0&&Cn.x+Cn.y<=1}static getUV(t,e,i,n,s,o,r,_){return this.getBarycoord(t,e,i,n,Cn),_.set(0,0),_.addScaledVector(s,Cn.x),_.addScaledVector(o,Cn.y),_.addScaledVector(r,Cn.z),_}static isFrontFacing(t,e,i,n){return fn.subVectors(i,e),En.subVectors(t,e),fn.cross(En).dot(n)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,e,i,n){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,n),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return fn.subVectors(this.c,this.b),En.subVectors(this.a,this.b),fn.cross(En).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Di.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Di.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,n,s){return Di.getUV(t,this.a,this.b,this.c,e,i,n,s)}containsPoint(t){return Di.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Di.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,n=this.b,s=this.c;let o,r;ys.subVectors(n,i),Ms.subVectors(s,i),rr.subVectors(t,i);const _=ys.dot(rr),a=Ms.dot(rr);if(_<=0&&a<=0)return e.copy(i);lr.subVectors(t,n);const l=ys.dot(lr),h=Ms.dot(lr);if(l>=0&&h<=l)return e.copy(n);const m=_*h-l*a;if(m<=0&&_>=0&&l<=0)return o=_/(_-l),e.copy(i).addScaledVector(ys,o);_r.subVectors(t,s);const f=ys.dot(_r),p=Ms.dot(_r);if(p>=0&&f<=p)return e.copy(s);const d=f*a-_*p;if(d<=0&&a>=0&&p<=0)return r=a/(a-p),e.copy(i).addScaledVector(Ms,r);const u=l*p-f*h;if(u<=0&&h-l>=0&&f-p>=0)return __.subVectors(s,n),r=(h-l)/(h-l+(f-p)),e.copy(n).addScaledVector(__,r);const g=1/(u+d+m);return o=d*g,r=m*g,e.copy(i).addScaledVector(ys,o).addScaledVector(Ms,r)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let K0=0;class Oi extends ps{constructor(){super(),Object.defineProperty(this,"id",{value:K0++}),this.uuid=Zn(),this.name="",this.type="Material",this.blending=Ds,this.side=ba,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=ph,this.blendDst=mh,this.blendEquation=Vs,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Lr,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=D0,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Wo,this.stencilZFail=Wo,this.stencilZPass=Wo,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const i=t[e];if(i===void 0){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if(e==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===ch;continue}const n=this[e];if(n===void 0){console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.");continue}n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Ds&&(i.blending=this.blending),this.side!==ba&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData);function n(s){const o=[];for(const r in s){const _=s[r];delete _.metadata,o.push(_)}return o}if(e){const s=n(t.textures),o=n(t.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(e!==null){const n=e.length;i=new Array(n);for(let s=0;s!==n;++s)i[s]=e[s].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}}Oi.prototype.isMaterial=!0;Oi.fromType=function(){return null};class To extends Oi{constructor(t){super(),this.type="MeshBasicMaterial",this.color=new fi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Zo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}To.prototype.isMeshBasicMaterial=!0;const Bi=new wt,Oa=new Fe;class Ri{constructor(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=i===!0,this.usage=wa,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[t+n]=e.array[i+n];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){const e=this.array;let i=0;for(let n=0,s=t.length;n<s;n++){let o=t[n];o===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),o=new fi),e[i++]=o.r,e[i++]=o.g,e[i++]=o.b}return this}copyVector2sArray(t){const e=this.array;let i=0;for(let n=0,s=t.length;n<s;n++){let o=t[n];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),o=new Fe),e[i++]=o.x,e[i++]=o.y}return this}copyVector3sArray(t){const e=this.array;let i=0;for(let n=0,s=t.length;n<s;n++){let o=t[n];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),o=new wt),e[i++]=o.x,e[i++]=o.y,e[i++]=o.z}return this}copyVector4sArray(t){const e=this.array;let i=0;for(let n=0,s=t.length;n<s;n++){let o=t[n];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),o=new Zi),e[i++]=o.x,e[i++]=o.y,e[i++]=o.z,e[i++]=o.w}return this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,i=this.count;e<i;e++)Oa.fromBufferAttribute(this,e),Oa.applyMatrix3(t),this.setXY(e,Oa.x,Oa.y);else if(this.itemSize===3)for(let e=0,i=this.count;e<i;e++)Bi.fromBufferAttribute(this,e),Bi.applyMatrix3(t),this.setXYZ(e,Bi.x,Bi.y,Bi.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)Bi.fromBufferAttribute(this,e),Bi.applyMatrix4(t),this.setXYZ(e,Bi.x,Bi.y,Bi.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)Bi.fromBufferAttribute(this,e),Bi.applyNormalMatrix(t),this.setXYZ(e,Bi.x,Bi.y,Bi.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)Bi.fromBufferAttribute(this,e),Bi.transformDirection(t),this.setXYZ(e,Bi.x,Bi.y,Bi.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this}setXYZW(t,e,i,n,s){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=s,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==wa&&(t.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(t.updateRange=this.updateRange),t}}Ri.prototype.isBufferAttribute=!0;class xh extends Ri{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class bh extends Ri{constructor(t,e,i){super(new Uint32Array(t),e,i)}}class t1 extends Ri{constructor(t,e,i){super(new Uint16Array(t),e,i)}}t1.prototype.isFloat16BufferAttribute=!0;class ji extends Ri{constructor(t,e,i){super(new Float32Array(t),e,i)}}let e1=0;const hn=new xi,hr=new Li,ws=new wt,_n=new yn,ra=new yn,Ui=new wt;class Ti extends ps{constructor(){super(),Object.defineProperty(this,"id",{value:e1++}),this.uuid=Zn(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(dh(t)?bh:xh)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const s=new Wi().getNormalMatrix(t);i.applyNormalMatrix(s),i.needsUpdate=!0}const n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(t),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return hn.makeRotationFromQuaternion(t),this.applyMatrix4(hn),this}rotateX(t){return hn.makeRotationX(t),this.applyMatrix4(hn),this}rotateY(t){return hn.makeRotationY(t),this.applyMatrix4(hn),this}rotateZ(t){return hn.makeRotationZ(t),this.applyMatrix4(hn),this}translate(t,e,i){return hn.makeTranslation(t,e,i),this.applyMatrix4(hn),this}scale(t,e,i){return hn.makeScale(t,e,i),this.applyMatrix4(hn),this}lookAt(t){return hr.lookAt(t),hr.updateMatrix(),this.applyMatrix4(hr.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ws).negate(),this.translate(ws.x,ws.y,ws.z),this}setFromPoints(t){const e=[];for(let i=0,n=t.length;i<n;i++){const s=t[i];e.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new ji(e,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new yn);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new wt(-1/0,-1/0,-1/0),new wt(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let i=0,n=e.length;i<n;i++){const s=e[i];_n.setFromBufferAttribute(s),this.morphTargetsRelative?(Ui.addVectors(this.boundingBox.min,_n.min),this.boundingBox.expandByPoint(Ui),Ui.addVectors(this.boundingBox.max,_n.max),this.boundingBox.expandByPoint(Ui)):(this.boundingBox.expandByPoint(_n.min),this.boundingBox.expandByPoint(_n.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new qs);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new wt,1/0);return}if(t){const i=this.boundingSphere.center;if(_n.setFromBufferAttribute(t),e)for(let s=0,o=e.length;s<o;s++){const r=e[s];ra.setFromBufferAttribute(r),this.morphTargetsRelative?(Ui.addVectors(_n.min,ra.min),_n.expandByPoint(Ui),Ui.addVectors(_n.max,ra.max),_n.expandByPoint(Ui)):(_n.expandByPoint(ra.min),_n.expandByPoint(ra.max))}_n.getCenter(i);let n=0;for(let s=0,o=t.count;s<o;s++)Ui.fromBufferAttribute(t,s),n=Math.max(n,i.distanceToSquared(Ui));if(e)for(let s=0,o=e.length;s<o;s++){const r=e[s],_=this.morphTargetsRelative;for(let a=0,l=r.count;a<l;a++)Ui.fromBufferAttribute(r,a),_&&(ws.fromBufferAttribute(t,a),Ui.add(ws)),n=Math.max(n,i.distanceToSquared(Ui))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.array,n=e.position.array,s=e.normal.array,o=e.uv.array,r=n.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ri(new Float32Array(4*r),4));const _=this.getAttribute("tangent").array,a=[],l=[];for(let z=0;z<r;z++)a[z]=new wt,l[z]=new wt;const h=new wt,m=new wt,f=new wt,p=new Fe,d=new Fe,u=new Fe,g=new wt,v=new wt;function x(z,T,F){h.fromArray(n,z*3),m.fromArray(n,T*3),f.fromArray(n,F*3),p.fromArray(o,z*2),d.fromArray(o,T*2),u.fromArray(o,F*2),m.sub(h),f.sub(h),d.sub(p),u.sub(p);const P=1/(d.x*u.y-u.x*d.y);!isFinite(P)||(g.copy(m).multiplyScalar(u.y).addScaledVector(f,-d.y).multiplyScalar(P),v.copy(f).multiplyScalar(d.x).addScaledVector(m,-u.x).multiplyScalar(P),a[z].add(g),a[T].add(g),a[F].add(g),l[z].add(v),l[T].add(v),l[F].add(v))}let b=this.groups;b.length===0&&(b=[{start:0,count:i.length}]);for(let z=0,T=b.length;z<T;++z){const F=b[z],P=F.start,A=F.count;for(let L=P,S=P+A;L<S;L+=3)x(i[L+0],i[L+1],i[L+2])}const Y=new wt,w=new wt,Z=new wt,X=new wt;function M(z){Z.fromArray(s,z*3),X.copy(Z);const T=a[z];Y.copy(T),Y.sub(Z.multiplyScalar(Z.dot(T))).normalize(),w.crossVectors(X,T);const P=w.dot(l[z])<0?-1:1;_[z*4]=Y.x,_[z*4+1]=Y.y,_[z*4+2]=Y.z,_[z*4+3]=P}for(let z=0,T=b.length;z<T;++z){const F=b[z],P=F.start,A=F.count;for(let L=P,S=P+A;L<S;L+=3)M(i[L+0]),M(i[L+1]),M(i[L+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Ri(new Float32Array(e.count*3),3),this.setAttribute("normal",i);else for(let m=0,f=i.count;m<f;m++)i.setXYZ(m,0,0,0);const n=new wt,s=new wt,o=new wt,r=new wt,_=new wt,a=new wt,l=new wt,h=new wt;if(t)for(let m=0,f=t.count;m<f;m+=3){const p=t.getX(m+0),d=t.getX(m+1),u=t.getX(m+2);n.fromBufferAttribute(e,p),s.fromBufferAttribute(e,d),o.fromBufferAttribute(e,u),l.subVectors(o,s),h.subVectors(n,s),l.cross(h),r.fromBufferAttribute(i,p),_.fromBufferAttribute(i,d),a.fromBufferAttribute(i,u),r.add(l),_.add(l),a.add(l),i.setXYZ(p,r.x,r.y,r.z),i.setXYZ(d,_.x,_.y,_.z),i.setXYZ(u,a.x,a.y,a.z)}else for(let m=0,f=e.count;m<f;m+=3)n.fromBufferAttribute(e,m+0),s.fromBufferAttribute(e,m+1),o.fromBufferAttribute(e,m+2),l.subVectors(o,s),h.subVectors(n,s),l.cross(h),i.setXYZ(m+0,l.x,l.y,l.z),i.setXYZ(m+1,l.x,l.y,l.z),i.setXYZ(m+2,l.x,l.y,l.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(t,e){if(!(t&&t.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);return}e===void 0&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const n in i){if(t.attributes[n]===void 0)continue;const o=i[n].array,r=t.attributes[n],_=r.array,a=r.itemSize*e,l=Math.min(_.length,o.length-a);for(let h=0,m=a;h<l;h++,m++)o[m]=_[h]}return this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)Ui.fromBufferAttribute(t,e),Ui.normalize(),t.setXYZ(e,Ui.x,Ui.y,Ui.z)}toNonIndexed(){function t(r,_){const a=r.array,l=r.itemSize,h=r.normalized,m=new a.constructor(_.length*l);let f=0,p=0;for(let d=0,u=_.length;d<u;d++){r.isInterleavedBufferAttribute?f=_[d]*r.data.stride+r.offset:f=_[d]*l;for(let g=0;g<l;g++)m[p++]=a[f++]}return new Ri(m,l,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Ti,i=this.index.array,n=this.attributes;for(const r in n){const _=n[r],a=t(_,i);e.setAttribute(r,a)}const s=this.morphAttributes;for(const r in s){const _=[],a=s[r];for(let l=0,h=a.length;l<h;l++){const m=a[l],f=t(m,i);_.push(f)}e.morphAttributes[r]=_}e.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let r=0,_=o.length;r<_;r++){const a=o[r];e.addGroup(a.start,a.count,a.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const _=this.parameters;for(const a in _)_[a]!==void 0&&(t[a]=_[a]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const _ in i){const a=i[_];t.data.attributes[_]=a.toJSON(t.data)}const n={};let s=!1;for(const _ in this.morphAttributes){const a=this.morphAttributes[_],l=[];for(let h=0,m=a.length;h<m;h++){const f=a[h];l.push(f.toJSON(t.data))}l.length>0&&(n[_]=l,s=!0)}s&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(t.data.groups=JSON.parse(JSON.stringify(o)));const r=this.boundingSphere;return r!==null&&(t.data.boundingSphere={center:r.center.toArray(),radius:r.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;i!==null&&this.setIndex(i.clone(e));const n=t.attributes;for(const a in n){const l=n[a];this.setAttribute(a,l.clone(e))}const s=t.morphAttributes;for(const a in s){const l=[],h=s[a];for(let m=0,f=h.length;m<f;m++)l.push(h[m].clone(e));this.morphAttributes[a]=l}this.morphTargetsRelative=t.morphTargetsRelative;const o=t.groups;for(let a=0,l=o.length;a<l;a++){const h=o[a];this.addGroup(h.start,h.count,h.materialIndex)}const r=t.boundingBox;r!==null&&(this.boundingBox=r.clone());const _=t.boundingSphere;return _!==null&&(this.boundingSphere=_.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,t.parameters!==void 0&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}Ti.prototype.isBufferGeometry=!0;const h_=new xi,Xs=new Js,cr=new qs,On=new wt,Un=new wt,Gn=new wt,pr=new wt,mr=new wt,ur=new wt,Ua=new wt,Ga=new wt,Ha=new wt,Wa=new Fe,ja=new Fe,qa=new Fe,fr=new wt,Ja=new wt;class en extends Li{constructor(t=new Ti,e=new To){super(),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const n=e[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=n.length;s<o;s++){const r=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=s}}}}else{const e=t.morphTargets;e!==void 0&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(t,e){const i=this.geometry,n=this.material,s=this.matrixWorld;if(n===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),cr.copy(i.boundingSphere),cr.applyMatrix4(s),t.ray.intersectsSphere(cr)===!1)||(h_.copy(s).invert(),Xs.copy(t.ray).applyMatrix4(h_),i.boundingBox!==null&&Xs.intersectsBox(i.boundingBox)===!1))return;let o;if(i.isBufferGeometry){const r=i.index,_=i.attributes.position,a=i.morphAttributes.position,l=i.morphTargetsRelative,h=i.attributes.uv,m=i.attributes.uv2,f=i.groups,p=i.drawRange;if(r!==null)if(Array.isArray(n))for(let d=0,u=f.length;d<u;d++){const g=f[d],v=n[g.materialIndex],x=Math.max(g.start,p.start),b=Math.min(r.count,Math.min(g.start+g.count,p.start+p.count));for(let Y=x,w=b;Y<w;Y+=3){const Z=r.getX(Y),X=r.getX(Y+1),M=r.getX(Y+2);o=$a(this,v,t,Xs,_,a,l,h,m,Z,X,M),o&&(o.faceIndex=Math.floor(Y/3),o.face.materialIndex=g.materialIndex,e.push(o))}}else{const d=Math.max(0,p.start),u=Math.min(r.count,p.start+p.count);for(let g=d,v=u;g<v;g+=3){const x=r.getX(g),b=r.getX(g+1),Y=r.getX(g+2);o=$a(this,n,t,Xs,_,a,l,h,m,x,b,Y),o&&(o.faceIndex=Math.floor(g/3),e.push(o))}}else if(_!==void 0)if(Array.isArray(n))for(let d=0,u=f.length;d<u;d++){const g=f[d],v=n[g.materialIndex],x=Math.max(g.start,p.start),b=Math.min(_.count,Math.min(g.start+g.count,p.start+p.count));for(let Y=x,w=b;Y<w;Y+=3){const Z=Y,X=Y+1,M=Y+2;o=$a(this,v,t,Xs,_,a,l,h,m,Z,X,M),o&&(o.faceIndex=Math.floor(Y/3),o.face.materialIndex=g.materialIndex,e.push(o))}}else{const d=Math.max(0,p.start),u=Math.min(_.count,p.start+p.count);for(let g=d,v=u;g<v;g+=3){const x=g,b=g+1,Y=g+2;o=$a(this,n,t,Xs,_,a,l,h,m,x,b,Y),o&&(o.faceIndex=Math.floor(g/3),e.push(o))}}}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}en.prototype.isMesh=!0;function i1(c,t,e,i,n,s,o,r){let _;if(t.side===xn?_=i.intersectTriangle(o,s,n,!0,r):_=i.intersectTriangle(n,s,o,t.side!==Ns,r),_===null)return null;Ja.copy(r),Ja.applyMatrix4(c.matrixWorld);const a=e.ray.origin.distanceTo(Ja);return a<e.near||a>e.far?null:{distance:a,point:Ja.clone(),object:c}}function $a(c,t,e,i,n,s,o,r,_,a,l,h){On.fromBufferAttribute(n,a),Un.fromBufferAttribute(n,l),Gn.fromBufferAttribute(n,h);const m=c.morphTargetInfluences;if(s&&m){Ua.set(0,0,0),Ga.set(0,0,0),Ha.set(0,0,0);for(let p=0,d=s.length;p<d;p++){const u=m[p],g=s[p];u!==0&&(pr.fromBufferAttribute(g,a),mr.fromBufferAttribute(g,l),ur.fromBufferAttribute(g,h),o?(Ua.addScaledVector(pr,u),Ga.addScaledVector(mr,u),Ha.addScaledVector(ur,u)):(Ua.addScaledVector(pr.sub(On),u),Ga.addScaledVector(mr.sub(Un),u),Ha.addScaledVector(ur.sub(Gn),u)))}On.add(Ua),Un.add(Ga),Gn.add(Ha)}c.isSkinnedMesh&&(c.boneTransform(a,On),c.boneTransform(l,Un),c.boneTransform(h,Gn));const f=i1(c,t,e,i,On,Un,Gn,fr);if(f){r&&(Wa.fromBufferAttribute(r,a),ja.fromBufferAttribute(r,l),qa.fromBufferAttribute(r,h),f.uv=Di.getUV(fr,On,Un,Gn,Wa,ja,qa,new Fe)),_&&(Wa.fromBufferAttribute(_,a),ja.fromBufferAttribute(_,l),qa.fromBufferAttribute(_,h),f.uv2=Di.getUV(fr,On,Un,Gn,Wa,ja,qa,new Fe));const p={a,b:l,c:h,normal:new wt,materialIndex:0};Di.getNormal(On,Un,Gn,p.normal),f.face=p}return f}class Sa extends Ti{constructor(t=1,e=1,i=1,n=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:s,depthSegments:o};const r=this;n=Math.floor(n),s=Math.floor(s),o=Math.floor(o);const _=[],a=[],l=[],h=[];let m=0,f=0;p("z","y","x",-1,-1,i,e,t,o,s,0),p("z","y","x",1,-1,i,e,-t,o,s,1),p("x","z","y",1,1,t,i,e,n,o,2),p("x","z","y",1,-1,t,i,-e,n,o,3),p("x","y","z",1,-1,t,e,i,n,s,4),p("x","y","z",-1,-1,t,e,-i,n,s,5),this.setIndex(_),this.setAttribute("position",new ji(a,3)),this.setAttribute("normal",new ji(l,3)),this.setAttribute("uv",new ji(h,2));function p(d,u,g,v,x,b,Y,w,Z,X,M){const z=b/Z,T=Y/X,F=b/2,P=Y/2,A=w/2,L=Z+1,S=X+1;let R=0,E=0;const C=new wt;for(let k=0;k<S;k++){const V=k*T-P;for(let B=0;B<L;B++){const J=B*z-F;C[d]=J*v,C[u]=V*x,C[g]=A,a.push(C.x,C.y,C.z),C[d]=0,C[u]=0,C[g]=w>0?1:-1,l.push(C.x,C.y,C.z),h.push(B/Z),h.push(1-k/X),R+=1}}for(let k=0;k<X;k++)for(let V=0;V<Z;V++){const B=m+V+L*k,J=m+V+L*(k+1),I=m+(V+1)+L*(k+1),G=m+(V+1)+L*k;_.push(B,J,G),_.push(J,I,G),E+=6}r.addGroup(f,E,M),f+=E,m+=R}}static fromJSON(t){return new Sa(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Hs(c){const t={};for(const e in c){t[e]={};for(const i in c[e]){const n=c[e][i];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?t[e][i]=n.clone():Array.isArray(n)?t[e][i]=n.slice():t[e][i]=n}}return t}function $i(c){const t={};for(let e=0;e<c.length;e++){const i=Hs(c[e]);for(const n in i)t[n]=i[n]}return t}const n1={clone:Hs,merge:$i};var s1=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,a1=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class bn extends Oi{constructor(t){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=s1,this.fragmentShader=a1,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&(t.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Hs(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const o=this.uniforms[n].value;o&&o.isTexture?e.uniforms[n]={type:"t",value:o.toJSON(t).uuid}:o&&o.isColor?e.uniforms[n]={type:"c",value:o.getHex()}:o&&o.isVector2?e.uniforms[n]={type:"v2",value:o.toArray()}:o&&o.isVector3?e.uniforms[n]={type:"v3",value:o.toArray()}:o&&o.isVector4?e.uniforms[n]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?e.uniforms[n]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?e.uniforms[n]={type:"m4",value:o.toArray()}:e.uniforms[n]={value:o}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const i={};for(const n in this.extensions)this.extensions[n]===!0&&(i[n]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}bn.prototype.isShaderMaterial=!0;class qr extends Li{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new xi,this.projectionMatrix=new xi,this.projectionMatrixInverse=new xi}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}qr.prototype.isCamera=!0;class tn extends qr{constructor(t=50,e=1,i=.1,n=2e3){super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=Pr*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(jo*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return Pr*2*Math.atan(Math.tan(jo*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,n,s,o){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(jo*.5*this.fov)/this.zoom,i=2*e,n=this.aspect*i,s=-.5*n;const o=this.view;if(this.view!==null&&this.view.enabled){const _=o.fullWidth,a=o.fullHeight;s+=o.offsetX*n/_,e-=o.offsetY*i/a,n*=o.width/_,i*=o.height/a}const r=this.filmOffset;r!==0&&(s+=t*r/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}tn.prototype.isPerspectiveCamera=!0;const zs=90,Is=1;class Jr extends Li{constructor(t,e,i){if(super(),this.type="CubeCamera",i.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=i;const n=new tn(zs,Is,t,e);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new wt(1,0,0)),this.add(n);const s=new tn(zs,Is,t,e);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new wt(-1,0,0)),this.add(s);const o=new tn(zs,Is,t,e);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new wt(0,1,0)),this.add(o);const r=new tn(zs,Is,t,e);r.layers=this.layers,r.up.set(0,0,-1),r.lookAt(new wt(0,-1,0)),this.add(r);const _=new tn(zs,Is,t,e);_.layers=this.layers,_.up.set(0,-1,0),_.lookAt(new wt(0,0,1)),this.add(_);const a=new tn(zs,Is,t,e);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new wt(0,0,-1)),this.add(a)}update(t,e){this.parent===null&&this.updateMatrixWorld();const i=this.renderTarget,[n,s,o,r,_,a]=this.children,l=t.getRenderTarget(),h=t.toneMapping,m=t.xr.enabled;t.toneMapping=kn,t.xr.enabled=!1;const f=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,n),t.setRenderTarget(i,1),t.render(e,s),t.setRenderTarget(i,2),t.render(e,o),t.setRenderTarget(i,3),t.render(e,r),t.setRenderTarget(i,4),t.render(e,_),i.texture.generateMipmaps=f,t.setRenderTarget(i,5),t.render(e,a),t.setRenderTarget(l),t.toneMapping=h,t.xr.enabled=m,i.texture.needsPMREMUpdate=!0}}class Vo extends qi{constructor(t,e,i,n,s,o,r,_,a,l){t=t!==void 0?t:[],e=e!==void 0?e:Os,super(t,e,i,n,s,o,r,_,a,l),this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}Vo.prototype.isCubeTexture=!0;class yh extends on{constructor(t,e={}){super(t,t,e);const i={width:t,height:t,depth:1},n=[i,i,i,i,i,i];this.texture=new Vo(n,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=e.generateMipmaps!==void 0?e.generateMipmaps:!1,this.texture.minFilter=e.minFilter!==void 0?e.minFilter:an}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new Sa(5,5,5),s=new bn({name:"CubemapFromEquirect",uniforms:Hs(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:xn,blending:Yn});s.uniforms.tEquirect.value=e;const o=new en(n,s),r=e.minFilter;return e.minFilter===Lo&&(e.minFilter=an),new Jr(1,10,this).update(t,o),e.minFilter=r,o.geometry.dispose(),o.material.dispose(),this}clear(t,e,i,n){const s=t.getRenderTarget();for(let o=0;o<6;o++)t.setRenderTarget(this,o),t.clear(e,i,n);t.setRenderTarget(s)}}yh.prototype.isWebGLCubeRenderTarget=!0;const dr=new wt,o1=new wt,r1=new Wi;class Xn{constructor(t=new wt(1,0,0),e=0){this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const n=dr.subVectors(i,e).cross(o1.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const i=t.delta(dr),n=this.normal.dot(i);if(n===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;const s=-(t.start.dot(this.normal)+this.constant)/n;return s<0||s>1?null:e.copy(i).multiplyScalar(s).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||r1.getNormalMatrix(t),n=this.coplanarPoint(dr).applyMatrix4(t),s=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(s),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}Xn.prototype.isPlane=!0;const Ys=new qs,Qa=new wt;class Eo{constructor(t=new Xn,e=new Xn,i=new Xn,n=new Xn,s=new Xn,o=new Xn){this.planes=[t,e,i,n,s,o]}set(t,e,i,n,s,o){const r=this.planes;return r[0].copy(t),r[1].copy(e),r[2].copy(i),r[3].copy(n),r[4].copy(s),r[5].copy(o),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){const e=this.planes,i=t.elements,n=i[0],s=i[1],o=i[2],r=i[3],_=i[4],a=i[5],l=i[6],h=i[7],m=i[8],f=i[9],p=i[10],d=i[11],u=i[12],g=i[13],v=i[14],x=i[15];return e[0].setComponents(r-n,h-_,d-m,x-u).normalize(),e[1].setComponents(r+n,h+_,d+m,x+u).normalize(),e[2].setComponents(r+s,h+a,d+f,x+g).normalize(),e[3].setComponents(r-s,h-a,d-f,x-g).normalize(),e[4].setComponents(r-o,h-l,d-p,x-v).normalize(),e[5].setComponents(r+o,h+l,d+p,x+v).normalize(),this}intersectsObject(t){const e=t.geometry;return e.boundingSphere===null&&e.computeBoundingSphere(),Ys.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Ys)}intersectsSprite(t){return Ys.center.set(0,0,0),Ys.radius=.7071067811865476,Ys.applyMatrix4(t.matrixWorld),this.intersectsSphere(Ys)}intersectsSphere(t){const e=this.planes,i=t.center,n=-t.radius;for(let s=0;s<6;s++)if(e[s].distanceToPoint(i)<n)return!1;return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const n=e[i];if(Qa.x=n.normal.x>0?t.max.x:t.min.x,Qa.y=n.normal.y>0?t.max.y:t.min.y,Qa.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(Qa)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function Mh(){let c=null,t=!1,e=null,i=null;function n(s,o){e(s,o),i=c.requestAnimationFrame(n)}return{start:function(){t!==!0&&e!==null&&(i=c.requestAnimationFrame(n),t=!0)},stop:function(){c.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(s){e=s},setContext:function(s){c=s}}}function l1(c,t){const e=t.isWebGL2,i=new WeakMap;function n(a,l){const h=a.array,m=a.usage,f=c.createBuffer();c.bindBuffer(l,f),c.bufferData(l,h,m),a.onUploadCallback();let p;if(h instanceof Float32Array)p=5126;else if(h instanceof Uint16Array)if(a.isFloat16BufferAttribute)if(e)p=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else p=5123;else if(h instanceof Int16Array)p=5122;else if(h instanceof Uint32Array)p=5125;else if(h instanceof Int32Array)p=5124;else if(h instanceof Int8Array)p=5120;else if(h instanceof Uint8Array)p=5121;else if(h instanceof Uint8ClampedArray)p=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:f,type:p,bytesPerElement:h.BYTES_PER_ELEMENT,version:a.version}}function s(a,l,h){const m=l.array,f=l.updateRange;c.bindBuffer(h,a),f.count===-1?c.bufferSubData(h,0,m):(e?c.bufferSubData(h,f.offset*m.BYTES_PER_ELEMENT,m,f.offset,f.count):c.bufferSubData(h,f.offset*m.BYTES_PER_ELEMENT,m.subarray(f.offset,f.offset+f.count)),f.count=-1)}function o(a){return a.isInterleavedBufferAttribute&&(a=a.data),i.get(a)}function r(a){a.isInterleavedBufferAttribute&&(a=a.data);const l=i.get(a);l&&(c.deleteBuffer(l.buffer),i.delete(a))}function _(a,l){if(a.isGLBufferAttribute){const m=i.get(a);(!m||m.version<a.version)&&i.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}a.isInterleavedBufferAttribute&&(a=a.data);const h=i.get(a);h===void 0?i.set(a,n(a,l)):h.version<a.version&&(s(h.buffer,a,l),h.version=a.version)}return{get:o,remove:r,update:_}}class $r extends Ti{constructor(t=1,e=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};const s=t/2,o=e/2,r=Math.floor(i),_=Math.floor(n),a=r+1,l=_+1,h=t/r,m=e/_,f=[],p=[],d=[],u=[];for(let g=0;g<l;g++){const v=g*m-o;for(let x=0;x<a;x++){const b=x*h-s;p.push(b,-v,0),d.push(0,0,1),u.push(x/r),u.push(1-g/_)}}for(let g=0;g<_;g++)for(let v=0;v<r;v++){const x=v+a*g,b=v+a*(g+1),Y=v+1+a*(g+1),w=v+1+a*g;f.push(x,b,w),f.push(b,Y,w)}this.setIndex(f),this.setAttribute("position",new ji(p,3)),this.setAttribute("normal",new ji(d,3)),this.setAttribute("uv",new ji(u,2))}static fromJSON(t){return new $r(t.width,t.height,t.widthSegments,t.heightSegments)}}var _1=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,h1=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,c1=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,p1=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,m1=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,u1=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,f1="vec3 transformed = vec3( position );",d1=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,g1=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,v1=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,x1=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,b1=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,y1=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,M1=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,w1=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,X1=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,z1=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,I1=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Y1=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,Z1=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,S1=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,L1=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,A1=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,T1=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,V1=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,E1="gl_FragColor = linearToOutputTexel( gl_FragColor );",C1=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,P1=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,R1=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,k1=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,B1=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,D1=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,F1=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,N1=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,O1=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,U1=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,G1=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,H1=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,W1=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,j1=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointLightInfo( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotLightInfo( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
		#endif
	}
	#pragma unroll_loop_end
#endif`,q1=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,J1=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,$1=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Q1=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,K1=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,tp=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,ep=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,ip=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,np=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,sp=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,ap=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,op=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,rp=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,lp=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,_p=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,hp=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,cp=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,pp=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,mp=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,up=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,fp=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,dp=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,gp=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,vp=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,xp=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,bp=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,yp=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Mp=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,wp=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Xp=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,zp=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,Ip=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,Yp=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,Zp=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,Sp=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Lp=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,Ap=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Tp=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Vp=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Ep=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Cp=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Pp=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Rp=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,kp=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Bp=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,Dp=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Fp=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Np=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,Op=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Up=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Gp=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Hp=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Wp=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,jp=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,qp=`#ifdef USE_TRANSMISSION
	float transmissionAlpha = 1.0;
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationColor, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );
	transmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );
#endif`,Jp=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,$p=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,Qp=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,Kp=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,tm=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,em=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,im=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,nm=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const sm=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,am=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,om=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,rm=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,lm=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,_m=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,hm=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,cm=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,pm=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,mm=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,um=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fm=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,dm=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,gm=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vm=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,xm=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,bm=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,ym=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Mm=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,wm=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Xm=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,zm=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Im=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Ym=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Zm=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Sm=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Lm=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Am=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Tm=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Vm=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Em=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Cm=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,zi={alphamap_fragment:_1,alphamap_pars_fragment:h1,alphatest_fragment:c1,alphatest_pars_fragment:p1,aomap_fragment:m1,aomap_pars_fragment:u1,begin_vertex:f1,beginnormal_vertex:d1,bsdfs:g1,bumpmap_pars_fragment:v1,clipping_planes_fragment:x1,clipping_planes_pars_fragment:b1,clipping_planes_pars_vertex:y1,clipping_planes_vertex:M1,color_fragment:w1,color_pars_fragment:X1,color_pars_vertex:z1,color_vertex:I1,common:Y1,cube_uv_reflection_fragment:Z1,defaultnormal_vertex:S1,displacementmap_pars_vertex:L1,displacementmap_vertex:A1,emissivemap_fragment:T1,emissivemap_pars_fragment:V1,encodings_fragment:E1,encodings_pars_fragment:C1,envmap_fragment:P1,envmap_common_pars_fragment:R1,envmap_pars_fragment:k1,envmap_pars_vertex:B1,envmap_physical_pars_fragment:J1,envmap_vertex:D1,fog_vertex:F1,fog_pars_vertex:N1,fog_fragment:O1,fog_pars_fragment:U1,gradientmap_pars_fragment:G1,lightmap_fragment:H1,lightmap_pars_fragment:W1,lights_lambert_vertex:j1,lights_pars_begin:q1,lights_toon_fragment:$1,lights_toon_pars_fragment:Q1,lights_phong_fragment:K1,lights_phong_pars_fragment:tp,lights_physical_fragment:ep,lights_physical_pars_fragment:ip,lights_fragment_begin:np,lights_fragment_maps:sp,lights_fragment_end:ap,logdepthbuf_fragment:op,logdepthbuf_pars_fragment:rp,logdepthbuf_pars_vertex:lp,logdepthbuf_vertex:_p,map_fragment:hp,map_pars_fragment:cp,map_particle_fragment:pp,map_particle_pars_fragment:mp,metalnessmap_fragment:up,metalnessmap_pars_fragment:fp,morphcolor_vertex:dp,morphnormal_vertex:gp,morphtarget_pars_vertex:vp,morphtarget_vertex:xp,normal_fragment_begin:bp,normal_fragment_maps:yp,normal_pars_fragment:Mp,normal_pars_vertex:wp,normal_vertex:Xp,normalmap_pars_fragment:zp,clearcoat_normal_fragment_begin:Ip,clearcoat_normal_fragment_maps:Yp,clearcoat_pars_fragment:Zp,output_fragment:Sp,packing:Lp,premultiplied_alpha_fragment:Ap,project_vertex:Tp,dithering_fragment:Vp,dithering_pars_fragment:Ep,roughnessmap_fragment:Cp,roughnessmap_pars_fragment:Pp,shadowmap_pars_fragment:Rp,shadowmap_pars_vertex:kp,shadowmap_vertex:Bp,shadowmask_pars_fragment:Dp,skinbase_vertex:Fp,skinning_pars_vertex:Np,skinning_vertex:Op,skinnormal_vertex:Up,specularmap_fragment:Gp,specularmap_pars_fragment:Hp,tonemapping_fragment:Wp,tonemapping_pars_fragment:jp,transmission_fragment:qp,transmission_pars_fragment:Jp,uv_pars_fragment:$p,uv_pars_vertex:Qp,uv_vertex:Kp,uv2_pars_fragment:tm,uv2_pars_vertex:em,uv2_vertex:im,worldpos_vertex:nm,background_vert:sm,background_frag:am,cube_vert:om,cube_frag:rm,depth_vert:lm,depth_frag:_m,distanceRGBA_vert:hm,distanceRGBA_frag:cm,equirect_vert:pm,equirect_frag:mm,linedashed_vert:um,linedashed_frag:fm,meshbasic_vert:dm,meshbasic_frag:gm,meshlambert_vert:vm,meshlambert_frag:xm,meshmatcap_vert:bm,meshmatcap_frag:ym,meshnormal_vert:Mm,meshnormal_frag:wm,meshphong_vert:Xm,meshphong_frag:zm,meshphysical_vert:Im,meshphysical_frag:Ym,meshtoon_vert:Zm,meshtoon_frag:Sm,points_vert:Lm,points_frag:Am,shadow_vert:Tm,shadow_frag:Vm,sprite_vert:Em,sprite_frag:Cm},ni={common:{diffuse:{value:new fi(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Wi},uv2Transform:{value:new Wi},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Fe(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new fi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new fi(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Wi}},sprite:{diffuse:{value:new fi(16777215)},opacity:{value:1},center:{value:new Fe(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Wi}}},zn={basic:{uniforms:$i([ni.common,ni.specularmap,ni.envmap,ni.aomap,ni.lightmap,ni.fog]),vertexShader:zi.meshbasic_vert,fragmentShader:zi.meshbasic_frag},lambert:{uniforms:$i([ni.common,ni.specularmap,ni.envmap,ni.aomap,ni.lightmap,ni.emissivemap,ni.fog,ni.lights,{emissive:{value:new fi(0)}}]),vertexShader:zi.meshlambert_vert,fragmentShader:zi.meshlambert_frag},phong:{uniforms:$i([ni.common,ni.specularmap,ni.envmap,ni.aomap,ni.lightmap,ni.emissivemap,ni.bumpmap,ni.normalmap,ni.displacementmap,ni.fog,ni.lights,{emissive:{value:new fi(0)},specular:{value:new fi(1118481)},shininess:{value:30}}]),vertexShader:zi.meshphong_vert,fragmentShader:zi.meshphong_frag},standard:{uniforms:$i([ni.common,ni.envmap,ni.aomap,ni.lightmap,ni.emissivemap,ni.bumpmap,ni.normalmap,ni.displacementmap,ni.roughnessmap,ni.metalnessmap,ni.fog,ni.lights,{emissive:{value:new fi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:zi.meshphysical_vert,fragmentShader:zi.meshphysical_frag},toon:{uniforms:$i([ni.common,ni.aomap,ni.lightmap,ni.emissivemap,ni.bumpmap,ni.normalmap,ni.displacementmap,ni.gradientmap,ni.fog,ni.lights,{emissive:{value:new fi(0)}}]),vertexShader:zi.meshtoon_vert,fragmentShader:zi.meshtoon_frag},matcap:{uniforms:$i([ni.common,ni.bumpmap,ni.normalmap,ni.displacementmap,ni.fog,{matcap:{value:null}}]),vertexShader:zi.meshmatcap_vert,fragmentShader:zi.meshmatcap_frag},points:{uniforms:$i([ni.points,ni.fog]),vertexShader:zi.points_vert,fragmentShader:zi.points_frag},dashed:{uniforms:$i([ni.common,ni.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:zi.linedashed_vert,fragmentShader:zi.linedashed_frag},depth:{uniforms:$i([ni.common,ni.displacementmap]),vertexShader:zi.depth_vert,fragmentShader:zi.depth_frag},normal:{uniforms:$i([ni.common,ni.bumpmap,ni.normalmap,ni.displacementmap,{opacity:{value:1}}]),vertexShader:zi.meshnormal_vert,fragmentShader:zi.meshnormal_frag},sprite:{uniforms:$i([ni.sprite,ni.fog]),vertexShader:zi.sprite_vert,fragmentShader:zi.sprite_frag},background:{uniforms:{uvTransform:{value:new Wi},t2D:{value:null}},vertexShader:zi.background_vert,fragmentShader:zi.background_frag},cube:{uniforms:$i([ni.envmap,{opacity:{value:1}}]),vertexShader:zi.cube_vert,fragmentShader:zi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:zi.equirect_vert,fragmentShader:zi.equirect_frag},distanceRGBA:{uniforms:$i([ni.common,ni.displacementmap,{referencePosition:{value:new wt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:zi.distanceRGBA_vert,fragmentShader:zi.distanceRGBA_frag},shadow:{uniforms:$i([ni.lights,ni.fog,{color:{value:new fi(0)},opacity:{value:1}}]),vertexShader:zi.shadow_vert,fragmentShader:zi.shadow_frag}};zn.physical={uniforms:$i([zn.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Fe(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new fi(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Fe},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new fi(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new fi(1,1,1)},specularColorMap:{value:null}}]),vertexShader:zi.meshphysical_vert,fragmentShader:zi.meshphysical_frag};function Pm(c,t,e,i,n,s){const o=new fi(0);let r=n===!0?0:1,_,a,l=null,h=0,m=null;function f(d,u){let g=!1,v=u.isScene===!0?u.background:null;v&&v.isTexture&&(v=t.get(v));const x=c.xr,b=x.getSession&&x.getSession();b&&b.environmentBlendMode==="additive"&&(v=null),v===null?p(o,r):v&&v.isColor&&(p(v,1),g=!0),(c.autoClear||g)&&c.clear(c.autoClearColor,c.autoClearDepth,c.autoClearStencil),v&&(v.isCubeTexture||v.mapping===So)?(a===void 0&&(a=new en(new Sa(1,1,1),new bn({name:"BackgroundCubeMaterial",uniforms:Hs(zn.cube.uniforms),vertexShader:zn.cube.vertexShader,fragmentShader:zn.cube.fragmentShader,side:xn,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(Y,w,Z){this.matrixWorld.copyPosition(Z.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(a)),a.material.uniforms.envMap.value=v,a.material.uniforms.flipEnvMap.value=v.isCubeTexture&&v.isRenderTargetTexture===!1?-1:1,(l!==v||h!==v.version||m!==c.toneMapping)&&(a.material.needsUpdate=!0,l=v,h=v.version,m=c.toneMapping),a.layers.enableAll(),d.unshift(a,a.geometry,a.material,0,0,null)):v&&v.isTexture&&(_===void 0&&(_=new en(new $r(2,2),new bn({name:"BackgroundMaterial",uniforms:Hs(zn.background.uniforms),vertexShader:zn.background.vertexShader,fragmentShader:zn.background.fragmentShader,side:ba,depthTest:!1,depthWrite:!1,fog:!1})),_.geometry.deleteAttribute("normal"),Object.defineProperty(_.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(_)),_.material.uniforms.t2D.value=v,v.matrixAutoUpdate===!0&&v.updateMatrix(),_.material.uniforms.uvTransform.value.copy(v.matrix),(l!==v||h!==v.version||m!==c.toneMapping)&&(_.material.needsUpdate=!0,l=v,h=v.version,m=c.toneMapping),_.layers.enableAll(),d.unshift(_,_.geometry,_.material,0,0,null))}function p(d,u){e.buffers.color.setClear(d.r,d.g,d.b,u,s)}return{getClearColor:function(){return o},setClearColor:function(d,u=1){o.set(d),r=u,p(o,r)},getClearAlpha:function(){return r},setClearAlpha:function(d){r=d,p(o,r)},render:f}}function Rm(c,t,e,i){const n=c.getParameter(34921),s=i.isWebGL2?null:t.get("OES_vertex_array_object"),o=i.isWebGL2||s!==null,r={},_=u(null);let a=_,l=!1;function h(A,L,S,R,E){let C=!1;if(o){const k=d(R,S,L);a!==k&&(a=k,f(a.object)),C=g(A,R,S,E),C&&v(A,R,S,E)}else{const k=L.wireframe===!0;(a.geometry!==R.id||a.program!==S.id||a.wireframe!==k)&&(a.geometry=R.id,a.program=S.id,a.wireframe=k,C=!0)}E!==null&&e.update(E,34963),(C||l)&&(l=!1,X(A,L,S,R),E!==null&&c.bindBuffer(34963,e.get(E).buffer))}function m(){return i.isWebGL2?c.createVertexArray():s.createVertexArrayOES()}function f(A){return i.isWebGL2?c.bindVertexArray(A):s.bindVertexArrayOES(A)}function p(A){return i.isWebGL2?c.deleteVertexArray(A):s.deleteVertexArrayOES(A)}function d(A,L,S){const R=S.wireframe===!0;let E=r[A.id];E===void 0&&(E={},r[A.id]=E);let C=E[L.id];C===void 0&&(C={},E[L.id]=C);let k=C[R];return k===void 0&&(k=u(m()),C[R]=k),k}function u(A){const L=[],S=[],R=[];for(let E=0;E<n;E++)L[E]=0,S[E]=0,R[E]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:L,enabledAttributes:S,attributeDivisors:R,object:A,attributes:{},index:null}}function g(A,L,S,R){const E=a.attributes,C=L.attributes;let k=0;const V=S.getAttributes();for(const B in V)if(V[B].location>=0){const I=E[B];let G=C[B];if(G===void 0&&(B==="instanceMatrix"&&A.instanceMatrix&&(G=A.instanceMatrix),B==="instanceColor"&&A.instanceColor&&(G=A.instanceColor)),I===void 0||I.attribute!==G||G&&I.data!==G.data)return!0;k++}return a.attributesNum!==k||a.index!==R}function v(A,L,S,R){const E={},C=L.attributes;let k=0;const V=S.getAttributes();for(const B in V)if(V[B].location>=0){let I=C[B];I===void 0&&(B==="instanceMatrix"&&A.instanceMatrix&&(I=A.instanceMatrix),B==="instanceColor"&&A.instanceColor&&(I=A.instanceColor));const G={};G.attribute=I,I&&I.data&&(G.data=I.data),E[B]=G,k++}a.attributes=E,a.attributesNum=k,a.index=R}function x(){const A=a.newAttributes;for(let L=0,S=A.length;L<S;L++)A[L]=0}function b(A){Y(A,0)}function Y(A,L){const S=a.newAttributes,R=a.enabledAttributes,E=a.attributeDivisors;S[A]=1,R[A]===0&&(c.enableVertexAttribArray(A),R[A]=1),E[A]!==L&&((i.isWebGL2?c:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](A,L),E[A]=L)}function w(){const A=a.newAttributes,L=a.enabledAttributes;for(let S=0,R=L.length;S<R;S++)L[S]!==A[S]&&(c.disableVertexAttribArray(S),L[S]=0)}function Z(A,L,S,R,E,C){i.isWebGL2===!0&&(S===5124||S===5125)?c.vertexAttribIPointer(A,L,S,E,C):c.vertexAttribPointer(A,L,S,R,E,C)}function X(A,L,S,R){if(i.isWebGL2===!1&&(A.isInstancedMesh||R.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;x();const E=R.attributes,C=S.getAttributes(),k=L.defaultAttributeValues;for(const V in C){const B=C[V];if(B.location>=0){let J=E[V];if(J===void 0&&(V==="instanceMatrix"&&A.instanceMatrix&&(J=A.instanceMatrix),V==="instanceColor"&&A.instanceColor&&(J=A.instanceColor)),J!==void 0){const I=J.normalized,G=J.itemSize,D=e.get(J);if(D===void 0)continue;const et=D.buffer,$=D.type,j=D.bytesPerElement;if(J.isInterleavedBufferAttribute){const q=J.data,tt=q.stride,W=J.offset;if(q.isInstancedInterleavedBuffer){for(let U=0;U<B.locationSize;U++)Y(B.location+U,q.meshPerAttribute);A.isInstancedMesh!==!0&&R._maxInstanceCount===void 0&&(R._maxInstanceCount=q.meshPerAttribute*q.count)}else for(let U=0;U<B.locationSize;U++)b(B.location+U);c.bindBuffer(34962,et);for(let U=0;U<B.locationSize;U++)Z(B.location+U,G/B.locationSize,$,I,tt*j,(W+G/B.locationSize*U)*j)}else{if(J.isInstancedBufferAttribute){for(let q=0;q<B.locationSize;q++)Y(B.location+q,J.meshPerAttribute);A.isInstancedMesh!==!0&&R._maxInstanceCount===void 0&&(R._maxInstanceCount=J.meshPerAttribute*J.count)}else for(let q=0;q<B.locationSize;q++)b(B.location+q);c.bindBuffer(34962,et);for(let q=0;q<B.locationSize;q++)Z(B.location+q,G/B.locationSize,$,I,G*j,G/B.locationSize*q*j)}}else if(k!==void 0){const I=k[V];if(I!==void 0)switch(I.length){case 2:c.vertexAttrib2fv(B.location,I);break;case 3:c.vertexAttrib3fv(B.location,I);break;case 4:c.vertexAttrib4fv(B.location,I);break;default:c.vertexAttrib1fv(B.location,I)}}}}w()}function M(){F();for(const A in r){const L=r[A];for(const S in L){const R=L[S];for(const E in R)p(R[E].object),delete R[E];delete L[S]}delete r[A]}}function z(A){if(r[A.id]===void 0)return;const L=r[A.id];for(const S in L){const R=L[S];for(const E in R)p(R[E].object),delete R[E];delete L[S]}delete r[A.id]}function T(A){for(const L in r){const S=r[L];if(S[A.id]===void 0)continue;const R=S[A.id];for(const E in R)p(R[E].object),delete R[E];delete S[A.id]}}function F(){P(),l=!0,a!==_&&(a=_,f(a.object))}function P(){_.geometry=null,_.program=null,_.wireframe=!1}return{setup:h,reset:F,resetDefaultState:P,dispose:M,releaseStatesOfGeometry:z,releaseStatesOfProgram:T,initAttributes:x,enableAttribute:b,disableUnusedAttributes:w}}function km(c,t,e,i){const n=i.isWebGL2;let s;function o(a){s=a}function r(a,l){c.drawArrays(s,a,l),e.update(l,s,1)}function _(a,l,h){if(h===0)return;let m,f;if(n)m=c,f="drawArraysInstanced";else if(m=t.get("ANGLE_instanced_arrays"),f="drawArraysInstancedANGLE",m===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}m[f](s,a,l,h),e.update(l,s,h)}this.setMode=o,this.render=r,this.renderInstances=_}function Bm(c,t,e){let i;function n(){if(i!==void 0)return i;if(t.has("EXT_texture_filter_anisotropic")===!0){const Z=t.get("EXT_texture_filter_anisotropic");i=c.getParameter(Z.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function s(Z){if(Z==="highp"){if(c.getShaderPrecisionFormat(35633,36338).precision>0&&c.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";Z="mediump"}return Z==="mediump"&&c.getShaderPrecisionFormat(35633,36337).precision>0&&c.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext!="undefined"&&c instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&c instanceof WebGL2ComputeRenderingContext;let r=e.precision!==void 0?e.precision:"highp";const _=s(r);_!==r&&(console.warn("THREE.WebGLRenderer:",r,"not supported, using",_,"instead."),r=_);const a=o||t.has("WEBGL_draw_buffers"),l=e.logarithmicDepthBuffer===!0,h=c.getParameter(34930),m=c.getParameter(35660),f=c.getParameter(3379),p=c.getParameter(34076),d=c.getParameter(34921),u=c.getParameter(36347),g=c.getParameter(36348),v=c.getParameter(36349),x=m>0,b=o||t.has("OES_texture_float"),Y=x&&b,w=o?c.getParameter(36183):0;return{isWebGL2:o,drawBuffers:a,getMaxAnisotropy:n,getMaxPrecision:s,precision:r,logarithmicDepthBuffer:l,maxTextures:h,maxVertexTextures:m,maxTextureSize:f,maxCubemapSize:p,maxAttributes:d,maxVertexUniforms:u,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:x,floatFragmentTextures:b,floatVertexTextures:Y,maxSamples:w}}function Dm(c){const t=this;let e=null,i=0,n=!1,s=!1;const o=new Xn,r=new Wi,_={value:null,needsUpdate:!1};this.uniform=_,this.numPlanes=0,this.numIntersection=0,this.init=function(h,m,f){const p=h.length!==0||m||i!==0||n;return n=m,e=l(h,f,0),i=h.length,p},this.beginShadows=function(){s=!0,l(null)},this.endShadows=function(){s=!1,a()},this.setState=function(h,m,f){const p=h.clippingPlanes,d=h.clipIntersection,u=h.clipShadows,g=c.get(h);if(!n||p===null||p.length===0||s&&!u)s?l(null):a();else{const v=s?0:i,x=v*4;let b=g.clippingState||null;_.value=b,b=l(p,m,x,f);for(let Y=0;Y!==x;++Y)b[Y]=e[Y];g.clippingState=b,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=v}};function a(){_.value!==e&&(_.value=e,_.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function l(h,m,f,p){const d=h!==null?h.length:0;let u=null;if(d!==0){if(u=_.value,p!==!0||u===null){const g=f+d*4,v=m.matrixWorldInverse;r.getNormalMatrix(v),(u===null||u.length<g)&&(u=new Float32Array(g));for(let x=0,b=f;x!==d;++x,b+=4)o.copy(h[x]).applyMatrix4(v,r),o.normal.toArray(u,b),u[b+3]=o.constant}_.value=u,_.needsUpdate=!0}return t.numPlanes=d,t.numIntersection=0,u}}function Fm(c){let t=new WeakMap;function e(o,r){return r===Ar?o.mapping=Os:r===Tr&&(o.mapping=Us),o}function i(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){const r=o.mapping;if(r===Ar||r===Tr)if(t.has(o)){const _=t.get(o).texture;return e(_,o.mapping)}else{const _=o.image;if(_&&_.height>0){const a=new yh(_.height/2);return a.fromEquirectangularTexture(c,o),t.set(o,a),o.addEventListener("dispose",n),e(a.texture,o.mapping)}else return null}}return o}function n(o){const r=o.target;r.removeEventListener("dispose",n);const _=t.get(r);_!==void 0&&(t.delete(r),_.dispose())}function s(){t=new WeakMap}return{get:i,dispose:s}}class Co extends qr{constructor(t=-1,e=1,i=1,n=-1,s=.1,o=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=n,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,i,n,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=i-t,o=i+t,r=n+e,_=n-e;if(this.view!==null&&this.view.enabled){const a=(this.right-this.left)/this.view.fullWidth/this.zoom,l=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=a*this.view.offsetX,o=s+a*this.view.width,r-=l*this.view.offsetY,_=r-l*this.view.height}this.projectionMatrix.makeOrthographic(s,o,r,_,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}}Co.prototype.isOrthographicCamera=!0;const Ps=4,c_=[.125,.215,.35,.446,.526,.582],as=20,gr=new Co,p_=new fi;let vr=null;const ss=(1+Math.sqrt(5))/2,Zs=1/ss,m_=[new wt(1,1,1),new wt(-1,1,1),new wt(1,1,-1),new wt(-1,1,-1),new wt(0,ss,Zs),new wt(0,ss,-Zs),new wt(Zs,0,ss),new wt(-Zs,0,ss),new wt(ss,Zs,0),new wt(-ss,Zs,0)];class u_{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,n=100){vr=this._renderer.getRenderTarget(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(t,i,n,s),e>0&&this._blur(s,0,0,e),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=g_(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=d_(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(vr),t.scissorTest=!1,Ka(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===Os||t.mapping===Us?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),vr=this._renderer.getRenderTarget();const i=e||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:an,minFilter:an,generateMipmaps:!1,type:Ma,format:gn,encoding:Jn,depthBuffer:!1},n=f_(t,e,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=f_(t,e,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Nm(s)),this._blurMaterial=Om(s,t,e)}return n}_compileMaterial(t){const e=new en(this._lodPlanes[0],t);this._renderer.compile(e,gr)}_sceneToCubeUV(t,e,i,n){const r=new tn(90,1,e,i),_=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],l=this._renderer,h=l.autoClear,m=l.toneMapping;l.getClearColor(p_),l.toneMapping=kn,l.autoClear=!1;const f=new To({name:"PMREM.Background",side:xn,depthWrite:!1,depthTest:!1}),p=new en(new Sa,f);let d=!1;const u=t.background;u?u.isColor&&(f.color.copy(u),t.background=null,d=!0):(f.color.copy(p_),d=!0);for(let g=0;g<6;g++){const v=g%3;v===0?(r.up.set(0,_[g],0),r.lookAt(a[g],0,0)):v===1?(r.up.set(0,0,_[g]),r.lookAt(0,a[g],0)):(r.up.set(0,_[g],0),r.lookAt(0,0,a[g]));const x=this._cubeSize;Ka(n,v*x,g>2?x:0,x,x),l.setRenderTarget(n),d&&l.render(p,r),l.render(t,r)}p.geometry.dispose(),p.material.dispose(),l.toneMapping=m,l.autoClear=h,t.background=u}_textureToCubeUV(t,e){const i=this._renderer,n=t.mapping===Os||t.mapping===Us;n?(this._cubemapMaterial===null&&(this._cubemapMaterial=g_()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=d_());const s=n?this._cubemapMaterial:this._equirectMaterial,o=new en(this._lodPlanes[0],s),r=s.uniforms;r.envMap.value=t;const _=this._cubeSize;Ka(e,0,0,3*_,2*_),i.setRenderTarget(e),i.render(o,gr)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let n=1;n<this._lodPlanes.length;n++){const s=Math.sqrt(this._sigmas[n]*this._sigmas[n]-this._sigmas[n-1]*this._sigmas[n-1]),o=m_[(n-1)%m_.length];this._blur(t,n-1,n,s,o)}e.autoClear=i}_blur(t,e,i,n,s){const o=this._pingPongRenderTarget;this._halfBlur(t,o,e,i,n,"latitudinal",s),this._halfBlur(o,t,i,i,n,"longitudinal",s)}_halfBlur(t,e,i,n,s,o,r){const _=this._renderer,a=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const l=3,h=new en(this._lodPlanes[n],a),m=a.uniforms,f=this._sizeLods[i]-1,p=isFinite(s)?Math.PI/(2*f):2*Math.PI/(2*as-1),d=s/p,u=isFinite(s)?1+Math.floor(l*d):as;u>as&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${u} samples when the maximum is set to ${as}`);const g=[];let v=0;for(let Z=0;Z<as;++Z){const X=Z/d,M=Math.exp(-X*X/2);g.push(M),Z===0?v+=M:Z<u&&(v+=2*M)}for(let Z=0;Z<g.length;Z++)g[Z]=g[Z]/v;m.envMap.value=t.texture,m.samples.value=u,m.weights.value=g,m.latitudinal.value=o==="latitudinal",r&&(m.poleAxis.value=r);const{_lodMax:x}=this;m.dTheta.value=p,m.mipInt.value=x-i;const b=this._sizeLods[n],Y=3*b*(n>x-Ps?n-x+Ps:0),w=4*(this._cubeSize-b);Ka(e,Y,w,3*b,2*b),_.setRenderTarget(e),_.render(h,gr)}}function Nm(c){const t=[],e=[],i=[];let n=c;const s=c-Ps+1+c_.length;for(let o=0;o<s;o++){const r=Math.pow(2,n);e.push(r);let _=1/r;o>c-Ps?_=c_[o-c+Ps-1]:o===0&&(_=0),i.push(_);const a=1/(r-2),l=-a,h=1+a,m=[l,l,h,l,h,h,l,l,h,h,l,h],f=6,p=6,d=3,u=2,g=1,v=new Float32Array(d*p*f),x=new Float32Array(u*p*f),b=new Float32Array(g*p*f);for(let w=0;w<f;w++){const Z=w%3*2/3-1,X=w>2?0:-1,M=[Z,X,0,Z+2/3,X,0,Z+2/3,X+1,0,Z,X,0,Z+2/3,X+1,0,Z,X+1,0];v.set(M,d*p*w),x.set(m,u*p*w);const z=[w,w,w,w,w,w];b.set(z,g*p*w)}const Y=new Ti;Y.setAttribute("position",new Ri(v,d)),Y.setAttribute("uv",new Ri(x,u)),Y.setAttribute("faceIndex",new Ri(b,g)),t.push(Y),n>Ps&&n--}return{lodPlanes:t,sizeLods:e,sigmas:i}}function f_(c,t,e){const i=new on(c,t,e);return i.texture.mapping=So,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Ka(c,t,e,i,n){c.viewport.set(t,e,i,n),c.scissor.set(t,e,i,n)}function Om(c,t,e){const i=new Float32Array(as),n=new wt(0,1,0);return new bn({name:"SphericalGaussianBlur",defines:{n:as,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/e,CUBEUV_MAX_MIP:`${c}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:Qr(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Yn,depthTest:!1,depthWrite:!1})}function d_(){return new bn({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Qr(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Yn,depthTest:!1,depthWrite:!1})}function g_(){return new bn({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Qr(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Yn,depthTest:!1,depthWrite:!1})}function Qr(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Um(c){let t=new WeakMap,e=null;function i(r){if(r&&r.isTexture){const _=r.mapping,a=_===Ar||_===Tr,l=_===Os||_===Us;if(a||l)if(r.isRenderTargetTexture&&r.needsPMREMUpdate===!0){r.needsPMREMUpdate=!1;let h=t.get(r);return e===null&&(e=new u_(c)),h=a?e.fromEquirectangular(r,h):e.fromCubemap(r,h),t.set(r,h),h.texture}else{if(t.has(r))return t.get(r).texture;{const h=r.image;if(a&&h&&h.height>0||l&&h&&n(h)){e===null&&(e=new u_(c));const m=a?e.fromEquirectangular(r):e.fromCubemap(r);return t.set(r,m),r.addEventListener("dispose",s),m.texture}else return null}}}return r}function n(r){let _=0;const a=6;for(let l=0;l<a;l++)r[l]!==void 0&&_++;return _===a}function s(r){const _=r.target;_.removeEventListener("dispose",s);const a=t.get(_);a!==void 0&&(t.delete(_),a.dispose())}function o(){t=new WeakMap,e!==null&&(e.dispose(),e=null)}return{get:i,dispose:o}}function Gm(c){const t={};function e(i){if(t[i]!==void 0)return t[i];let n;switch(i){case"WEBGL_depth_texture":n=c.getExtension("WEBGL_depth_texture")||c.getExtension("MOZ_WEBGL_depth_texture")||c.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=c.getExtension("WEBGL_compressed_texture_s3tc")||c.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||c.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=c.getExtension("WEBGL_compressed_texture_pvrtc")||c.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=c.getExtension(i)}return t[i]=n,n}return{has:function(i){return e(i)!==null},init:function(i){i.isWebGL2?e("EXT_color_buffer_float"):(e("WEBGL_depth_texture"),e("OES_texture_float"),e("OES_texture_half_float"),e("OES_texture_half_float_linear"),e("OES_standard_derivatives"),e("OES_element_index_uint"),e("OES_vertex_array_object"),e("ANGLE_instanced_arrays")),e("OES_texture_float_linear"),e("EXT_color_buffer_half_float"),e("WEBGL_multisampled_render_to_texture")},get:function(i){const n=e(i);return n===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),n}}}function Hm(c,t,e,i){const n={},s=new WeakMap;function o(h){const m=h.target;m.index!==null&&t.remove(m.index);for(const p in m.attributes)t.remove(m.attributes[p]);m.removeEventListener("dispose",o),delete n[m.id];const f=s.get(m);f&&(t.remove(f),s.delete(m)),i.releaseStatesOfGeometry(m),m.isInstancedBufferGeometry===!0&&delete m._maxInstanceCount,e.memory.geometries--}function r(h,m){return n[m.id]===!0||(m.addEventListener("dispose",o),n[m.id]=!0,e.memory.geometries++),m}function _(h){const m=h.attributes;for(const p in m)t.update(m[p],34962);const f=h.morphAttributes;for(const p in f){const d=f[p];for(let u=0,g=d.length;u<g;u++)t.update(d[u],34962)}}function a(h){const m=[],f=h.index,p=h.attributes.position;let d=0;if(f!==null){const v=f.array;d=f.version;for(let x=0,b=v.length;x<b;x+=3){const Y=v[x+0],w=v[x+1],Z=v[x+2];m.push(Y,w,w,Z,Z,Y)}}else{const v=p.array;d=p.version;for(let x=0,b=v.length/3-1;x<b;x+=3){const Y=x+0,w=x+1,Z=x+2;m.push(Y,w,w,Z,Z,Y)}}const u=new(dh(m)?bh:xh)(m,1);u.version=d;const g=s.get(h);g&&t.remove(g),s.set(h,u)}function l(h){const m=s.get(h);if(m){const f=h.index;f!==null&&m.version<f.version&&a(h)}else a(h);return s.get(h)}return{get:r,update:_,getWireframeAttribute:l}}function Wm(c,t,e,i){const n=i.isWebGL2;let s;function o(m){s=m}let r,_;function a(m){r=m.type,_=m.bytesPerElement}function l(m,f){c.drawElements(s,f,r,m*_),e.update(f,s,1)}function h(m,f,p){if(p===0)return;let d,u;if(n)d=c,u="drawElementsInstanced";else if(d=t.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",d===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[u](s,f,r,m*_,p),e.update(f,s,p)}this.setMode=o,this.setIndex=a,this.render=l,this.renderInstances=h}function jm(c){const t={geometries:0,textures:0},e={frame:0,calls:0,triangles:0,points:0,lines:0};function i(s,o,r){switch(e.calls++,o){case 4:e.triangles+=r*(s/3);break;case 1:e.lines+=r*(s/2);break;case 3:e.lines+=r*(s-1);break;case 2:e.lines+=r*s;break;case 0:e.points+=r*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function n(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0}return{memory:t,render:e,programs:null,autoReset:!0,reset:n,update:i}}function qm(c,t){return c[0]-t[0]}function Jm(c,t){return Math.abs(t[1])-Math.abs(c[1])}function xr(c,t){let e=1;const i=t.isInterleavedBufferAttribute?t.data.array:t.array;i instanceof Int8Array?e=127:i instanceof Int16Array?e=32767:i instanceof Int32Array?e=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",i),c.divideScalar(e)}function $m(c,t,e){const i={},n=new Float32Array(8),s=new WeakMap,o=new Zi,r=[];for(let a=0;a<8;a++)r[a]=[a,0];function _(a,l,h,m){const f=a.morphTargetInfluences;if(t.isWebGL2===!0){const p=l.morphAttributes.position||l.morphAttributes.normal||l.morphAttributes.color,d=p!==void 0?p.length:0;let u=s.get(l);if(u===void 0||u.count!==d){let L=function(){P.dispose(),s.delete(l),l.removeEventListener("dispose",L)};u!==void 0&&u.texture.dispose();const x=l.morphAttributes.position!==void 0,b=l.morphAttributes.normal!==void 0,Y=l.morphAttributes.color!==void 0,w=l.morphAttributes.position||[],Z=l.morphAttributes.normal||[],X=l.morphAttributes.color||[];let M=0;x===!0&&(M=1),b===!0&&(M=2),Y===!0&&(M=3);let z=l.attributes.position.count*M,T=1;z>t.maxTextureSize&&(T=Math.ceil(z/t.maxTextureSize),z=t.maxTextureSize);const F=new Float32Array(z*T*4*d),P=new Ao(F,z,T,d);P.type=rs,P.needsUpdate=!0;const A=M*4;for(let S=0;S<d;S++){const R=w[S],E=Z[S],C=X[S],k=z*T*4*S;for(let V=0;V<R.count;V++){const B=V*A;x===!0&&(o.fromBufferAttribute(R,V),R.normalized===!0&&xr(o,R),F[k+B+0]=o.x,F[k+B+1]=o.y,F[k+B+2]=o.z,F[k+B+3]=0),b===!0&&(o.fromBufferAttribute(E,V),E.normalized===!0&&xr(o,E),F[k+B+4]=o.x,F[k+B+5]=o.y,F[k+B+6]=o.z,F[k+B+7]=0),Y===!0&&(o.fromBufferAttribute(C,V),C.normalized===!0&&xr(o,C),F[k+B+8]=o.x,F[k+B+9]=o.y,F[k+B+10]=o.z,F[k+B+11]=C.itemSize===4?o.w:1)}}u={count:d,texture:P,size:new Fe(z,T)},s.set(l,u),l.addEventListener("dispose",L)}let g=0;for(let x=0;x<f.length;x++)g+=f[x];const v=l.morphTargetsRelative?1:1-g;m.getUniforms().setValue(c,"morphTargetBaseInfluence",v),m.getUniforms().setValue(c,"morphTargetInfluences",f),m.getUniforms().setValue(c,"morphTargetsTexture",u.texture,e),m.getUniforms().setValue(c,"morphTargetsTextureSize",u.size)}else{const p=f===void 0?0:f.length;let d=i[l.id];if(d===void 0||d.length!==p){d=[];for(let b=0;b<p;b++)d[b]=[b,0];i[l.id]=d}for(let b=0;b<p;b++){const Y=d[b];Y[0]=b,Y[1]=f[b]}d.sort(Jm);for(let b=0;b<8;b++)b<p&&d[b][1]?(r[b][0]=d[b][0],r[b][1]=d[b][1]):(r[b][0]=Number.MAX_SAFE_INTEGER,r[b][1]=0);r.sort(qm);const u=l.morphAttributes.position,g=l.morphAttributes.normal;let v=0;for(let b=0;b<8;b++){const Y=r[b],w=Y[0],Z=Y[1];w!==Number.MAX_SAFE_INTEGER&&Z?(u&&l.getAttribute("morphTarget"+b)!==u[w]&&l.setAttribute("morphTarget"+b,u[w]),g&&l.getAttribute("morphNormal"+b)!==g[w]&&l.setAttribute("morphNormal"+b,g[w]),n[b]=Z,v+=Z):(u&&l.hasAttribute("morphTarget"+b)===!0&&l.deleteAttribute("morphTarget"+b),g&&l.hasAttribute("morphNormal"+b)===!0&&l.deleteAttribute("morphNormal"+b),n[b]=0)}const x=l.morphTargetsRelative?1:1-v;m.getUniforms().setValue(c,"morphTargetBaseInfluence",x),m.getUniforms().setValue(c,"morphTargetInfluences",n)}}return{update:_}}function Qm(c,t,e,i){let n=new WeakMap;function s(_){const a=i.render.frame,l=_.geometry,h=t.get(_,l);return n.get(h)!==a&&(t.update(h),n.set(h,a)),_.isInstancedMesh&&(_.hasEventListener("dispose",r)===!1&&_.addEventListener("dispose",r),e.update(_.instanceMatrix,34962),_.instanceColor!==null&&e.update(_.instanceColor,34962)),h}function o(){n=new WeakMap}function r(_){const a=_.target;a.removeEventListener("dispose",r),e.remove(a.instanceMatrix),a.instanceColor!==null&&e.remove(a.instanceColor)}return{update:s,dispose:o}}const wh=new qi,Xh=new Ao,zh=new jr,Ih=new Vo,v_=[],x_=[],b_=new Float32Array(16),y_=new Float32Array(9),M_=new Float32Array(4);function $s(c,t,e){const i=c[0];if(i<=0||i>0)return c;const n=t*e;let s=v_[n];if(s===void 0&&(s=new Float32Array(n),v_[n]=s),t!==0){i.toArray(s,0);for(let o=1,r=0;o!==t;++o)r+=e,c[o].toArray(s,r)}return s}function nn(c,t){if(c.length!==t.length)return!1;for(let e=0,i=c.length;e<i;e++)if(c[e]!==t[e])return!1;return!0}function sn(c,t){for(let e=0,i=t.length;e<i;e++)c[e]=t[e]}function Po(c,t){let e=x_[t];e===void 0&&(e=new Int32Array(t),x_[t]=e);for(let i=0;i!==t;++i)e[i]=c.allocateTextureUnit();return e}function Km(c,t){const e=this.cache;e[0]!==t&&(c.uniform1f(this.addr,t),e[0]=t)}function tu(c,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(c.uniform2f(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(nn(e,t))return;c.uniform2fv(this.addr,t),sn(e,t)}}function eu(c,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(c.uniform3f(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else if(t.r!==void 0)(e[0]!==t.r||e[1]!==t.g||e[2]!==t.b)&&(c.uniform3f(this.addr,t.r,t.g,t.b),e[0]=t.r,e[1]=t.g,e[2]=t.b);else{if(nn(e,t))return;c.uniform3fv(this.addr,t),sn(e,t)}}function iu(c,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(c.uniform4f(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(nn(e,t))return;c.uniform4fv(this.addr,t),sn(e,t)}}function nu(c,t){const e=this.cache,i=t.elements;if(i===void 0){if(nn(e,t))return;c.uniformMatrix2fv(this.addr,!1,t),sn(e,t)}else{if(nn(e,i))return;M_.set(i),c.uniformMatrix2fv(this.addr,!1,M_),sn(e,i)}}function su(c,t){const e=this.cache,i=t.elements;if(i===void 0){if(nn(e,t))return;c.uniformMatrix3fv(this.addr,!1,t),sn(e,t)}else{if(nn(e,i))return;y_.set(i),c.uniformMatrix3fv(this.addr,!1,y_),sn(e,i)}}function au(c,t){const e=this.cache,i=t.elements;if(i===void 0){if(nn(e,t))return;c.uniformMatrix4fv(this.addr,!1,t),sn(e,t)}else{if(nn(e,i))return;b_.set(i),c.uniformMatrix4fv(this.addr,!1,b_),sn(e,i)}}function ou(c,t){const e=this.cache;e[0]!==t&&(c.uniform1i(this.addr,t),e[0]=t)}function ru(c,t){const e=this.cache;nn(e,t)||(c.uniform2iv(this.addr,t),sn(e,t))}function lu(c,t){const e=this.cache;nn(e,t)||(c.uniform3iv(this.addr,t),sn(e,t))}function _u(c,t){const e=this.cache;nn(e,t)||(c.uniform4iv(this.addr,t),sn(e,t))}function hu(c,t){const e=this.cache;e[0]!==t&&(c.uniform1ui(this.addr,t),e[0]=t)}function cu(c,t){const e=this.cache;nn(e,t)||(c.uniform2uiv(this.addr,t),sn(e,t))}function pu(c,t){const e=this.cache;nn(e,t)||(c.uniform3uiv(this.addr,t),sn(e,t))}function mu(c,t){const e=this.cache;nn(e,t)||(c.uniform4uiv(this.addr,t),sn(e,t))}function uu(c,t,e){const i=this.cache,n=e.allocateTextureUnit();i[0]!==n&&(c.uniform1i(this.addr,n),i[0]=n),e.setTexture2D(t||wh,n)}function fu(c,t,e){const i=this.cache,n=e.allocateTextureUnit();i[0]!==n&&(c.uniform1i(this.addr,n),i[0]=n),e.setTexture3D(t||zh,n)}function du(c,t,e){const i=this.cache,n=e.allocateTextureUnit();i[0]!==n&&(c.uniform1i(this.addr,n),i[0]=n),e.setTextureCube(t||Ih,n)}function gu(c,t,e){const i=this.cache,n=e.allocateTextureUnit();i[0]!==n&&(c.uniform1i(this.addr,n),i[0]=n),e.setTexture2DArray(t||Xh,n)}function vu(c){switch(c){case 5126:return Km;case 35664:return tu;case 35665:return eu;case 35666:return iu;case 35674:return nu;case 35675:return su;case 35676:return au;case 5124:case 35670:return ou;case 35667:case 35671:return ru;case 35668:case 35672:return lu;case 35669:case 35673:return _u;case 5125:return hu;case 36294:return cu;case 36295:return pu;case 36296:return mu;case 35678:case 36198:case 36298:case 36306:case 35682:return uu;case 35679:case 36299:case 36307:return fu;case 35680:case 36300:case 36308:case 36293:return du;case 36289:case 36303:case 36311:case 36292:return gu}}function xu(c,t){c.uniform1fv(this.addr,t)}function bu(c,t){const e=$s(t,this.size,2);c.uniform2fv(this.addr,e)}function yu(c,t){const e=$s(t,this.size,3);c.uniform3fv(this.addr,e)}function Mu(c,t){const e=$s(t,this.size,4);c.uniform4fv(this.addr,e)}function wu(c,t){const e=$s(t,this.size,4);c.uniformMatrix2fv(this.addr,!1,e)}function Xu(c,t){const e=$s(t,this.size,9);c.uniformMatrix3fv(this.addr,!1,e)}function zu(c,t){const e=$s(t,this.size,16);c.uniformMatrix4fv(this.addr,!1,e)}function Iu(c,t){c.uniform1iv(this.addr,t)}function Yu(c,t){c.uniform2iv(this.addr,t)}function Zu(c,t){c.uniform3iv(this.addr,t)}function Su(c,t){c.uniform4iv(this.addr,t)}function Lu(c,t){c.uniform1uiv(this.addr,t)}function Au(c,t){c.uniform2uiv(this.addr,t)}function Tu(c,t){c.uniform3uiv(this.addr,t)}function Vu(c,t){c.uniform4uiv(this.addr,t)}function Eu(c,t,e){const i=t.length,n=Po(e,i);c.uniform1iv(this.addr,n);for(let s=0;s!==i;++s)e.setTexture2D(t[s]||wh,n[s])}function Cu(c,t,e){const i=t.length,n=Po(e,i);c.uniform1iv(this.addr,n);for(let s=0;s!==i;++s)e.setTexture3D(t[s]||zh,n[s])}function Pu(c,t,e){const i=t.length,n=Po(e,i);c.uniform1iv(this.addr,n);for(let s=0;s!==i;++s)e.setTextureCube(t[s]||Ih,n[s])}function Ru(c,t,e){const i=t.length,n=Po(e,i);c.uniform1iv(this.addr,n);for(let s=0;s!==i;++s)e.setTexture2DArray(t[s]||Xh,n[s])}function ku(c){switch(c){case 5126:return xu;case 35664:return bu;case 35665:return yu;case 35666:return Mu;case 35674:return wu;case 35675:return Xu;case 35676:return zu;case 5124:case 35670:return Iu;case 35667:case 35671:return Yu;case 35668:case 35672:return Zu;case 35669:case 35673:return Su;case 5125:return Lu;case 36294:return Au;case 36295:return Tu;case 36296:return Vu;case 35678:case 36198:case 36298:case 36306:case 35682:return Eu;case 35679:case 36299:case 36307:return Cu;case 35680:case 36300:case 36308:case 36293:return Pu;case 36289:case 36303:case 36311:case 36292:return Ru}}function Bu(c,t,e){this.id=c,this.addr=e,this.cache=[],this.setValue=vu(t.type)}function Du(c,t,e){this.id=c,this.addr=e,this.cache=[],this.size=t.size,this.setValue=ku(t.type)}function Yh(c){this.id=c,this.seq=[],this.map={}}Yh.prototype.setValue=function(c,t,e){const i=this.seq;for(let n=0,s=i.length;n!==s;++n){const o=i[n];o.setValue(c,t[o.id],e)}};const br=/(\w+)(\])?(\[|\.)?/g;function w_(c,t){c.seq.push(t),c.map[t.id]=t}function Fu(c,t,e){const i=c.name,n=i.length;for(br.lastIndex=0;;){const s=br.exec(i),o=br.lastIndex;let r=s[1];const _=s[2]==="]",a=s[3];if(_&&(r=r|0),a===void 0||a==="["&&o+2===n){w_(e,a===void 0?new Bu(r,c,t):new Du(r,c,t));break}else{let h=e.map[r];h===void 0&&(h=new Yh(r),w_(e,h)),e=h}}}function jn(c,t){this.seq=[],this.map={};const e=c.getProgramParameter(t,35718);for(let i=0;i<e;++i){const n=c.getActiveUniform(t,i),s=c.getUniformLocation(t,n.name);Fu(n,s,this)}}jn.prototype.setValue=function(c,t,e,i){const n=this.map[t];n!==void 0&&n.setValue(c,e,i)};jn.prototype.setOptional=function(c,t,e){const i=t[e];i!==void 0&&this.setValue(c,e,i)};jn.upload=function(c,t,e,i){for(let n=0,s=t.length;n!==s;++n){const o=t[n],r=e[o.id];r.needsUpdate!==!1&&o.setValue(c,r.value,i)}};jn.seqWithValue=function(c,t){const e=[];for(let i=0,n=c.length;i!==n;++i){const s=c[i];s.id in t&&e.push(s)}return e};function X_(c,t,e){const i=c.createShader(t);return c.shaderSource(i,e),c.compileShader(i),i}let Nu=0;function Ou(c,t){const e=c.split(`
`),i=[],n=Math.max(t-6,0),s=Math.min(t+6,e.length);for(let o=n;o<s;o++)i.push(o+1+": "+e[o]);return i.join(`
`)}function Uu(c){switch(c){case Jn:return["Linear","( value )"];case Vi:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",c),["Linear","( value )"]}}function z_(c,t,e){const i=c.getShaderParameter(t,35713),n=c.getShaderInfoLog(t).trim();if(i&&n==="")return"";const s=/ERROR: 0:(\d+)/.exec(n);if(s){const o=parseInt(s[0]);return e.toUpperCase()+`

`+n+`

`+Ou(c.getShaderSource(t),o)}else return n}function Gu(c,t){const e=Uu(t);return"vec4 "+c+"( vec4 value ) { return LinearTo"+e[0]+e[1]+"; }"}function Hu(c,t){let e;switch(t){case p0:e="Linear";break;case m0:e="Reinhard";break;case u0:e="OptimizedCineon";break;case f0:e="ACESFilmic";break;case d0:e="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),e="Linear"}return"vec3 "+c+"( vec3 color ) { return "+e+"ToneMapping( color ); }"}function Wu(c){return[c.extensionDerivatives||!!c.envMapCubeUVHeight||c.bumpMap||c.tangentSpaceNormalMap||c.clearcoatNormalMap||c.flatShading||c.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(c.extensionFragDepth||c.logarithmicDepthBuffer)&&c.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",c.extensionDrawBuffers&&c.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(c.extensionShaderTextureLOD||c.envMap||c.transmission)&&c.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ua).join(`
`)}function ju(c){const t=[];for(const e in c){const i=c[e];i!==!1&&t.push("#define "+e+" "+i)}return t.join(`
`)}function qu(c,t){const e={},i=c.getProgramParameter(t,35721);for(let n=0;n<i;n++){const s=c.getActiveAttrib(t,n),o=s.name;let r=1;s.type===35674&&(r=2),s.type===35675&&(r=3),s.type===35676&&(r=4),e[o]={type:s.type,location:c.getAttribLocation(t,o),locationSize:r}}return e}function ua(c){return c!==""}function I_(c,t){return c.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Y_(c,t){return c.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Ju=/^[ \t]*#include +<([\w\d./]+)>/gm;function kr(c){return c.replace(Ju,$u)}function $u(c,t){const e=zi[t];if(e===void 0)throw new Error("Can not resolve #include <"+t+">");return kr(e)}const Qu=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Ku=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Z_(c){return c.replace(Ku,Zh).replace(Qu,tf)}function tf(c,t,e,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Zh(c,t,e,i)}function Zh(c,t,e,i){let n="";for(let s=parseInt(t);s<parseInt(e);s++)n+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function S_(c){let t="precision "+c.precision+` float;
precision `+c.precision+" int;";return c.precision==="highp"?t+=`
#define HIGH_PRECISION`:c.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:c.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function ef(c){let t="SHADOWMAP_TYPE_BASIC";return c.shadowMapType===hh?t="SHADOWMAP_TYPE_PCF":c.shadowMapType===Uc?t="SHADOWMAP_TYPE_PCF_SOFT":c.shadowMapType===ma&&(t="SHADOWMAP_TYPE_VSM"),t}function nf(c){let t="ENVMAP_TYPE_CUBE";if(c.envMap)switch(c.envMapMode){case Os:case Us:t="ENVMAP_TYPE_CUBE";break;case So:t="ENVMAP_TYPE_CUBE_UV";break}return t}function sf(c){let t="ENVMAP_MODE_REFLECTION";if(c.envMap)switch(c.envMapMode){case Us:t="ENVMAP_MODE_REFRACTION";break}return t}function af(c){let t="ENVMAP_BLENDING_NONE";if(c.envMap)switch(c.combine){case Zo:t="ENVMAP_BLENDING_MULTIPLY";break;case h0:t="ENVMAP_BLENDING_MIX";break;case c0:t="ENVMAP_BLENDING_ADD";break}return t}function of(c){const t=c.envMapCubeUVHeight;if(t===null)return null;const e=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:i,maxMip:e}}function rf(c,t,e,i){const n=c.getContext(),s=e.defines;let o=e.vertexShader,r=e.fragmentShader;const _=ef(e),a=nf(e),l=sf(e),h=af(e),m=of(e),f=e.isWebGL2?"":Wu(e),p=ju(s),d=n.createProgram();let u,g,v=e.glslVersion?"#version "+e.glslVersion+`
`:"";e.isRawShaderMaterial?(u=[p].filter(ua).join(`
`),u.length>0&&(u+=`
`),g=[f,p].filter(ua).join(`
`),g.length>0&&(g+=`
`)):(u=[S_(e),"#define SHADER_NAME "+e.shaderName,p,e.instancing?"#define USE_INSTANCING":"",e.instancingColor?"#define USE_INSTANCING_COLOR":"",e.supportsVertexTextures?"#define VERTEX_TEXTURES":"",e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+l:"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMap&&e.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",e.normalMap&&e.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.displacementMap&&e.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",e.specularColorMap?"#define USE_SPECULARCOLORMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.sheenColorMap?"#define USE_SHEENCOLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",e.vertexTangents?"#define USE_TANGENT":"",e.vertexColors?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUvs?"#define USE_UV":"",e.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",e.flatShading?"#define FLAT_SHADED":"",e.skinning?"#define USE_SKINNING":"",e.morphTargets?"#define USE_MORPHTARGETS":"",e.morphNormals&&e.flatShading===!1?"#define USE_MORPHNORMALS":"",e.morphColors&&e.isWebGL2?"#define USE_MORPHCOLORS":"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+e.morphTextureStride:"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_COUNT "+e.morphTargetsCount:"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+_:"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(ua).join(`
`),g=[f,S_(e),"#define SHADER_NAME "+e.shaderName,p,e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.matcap?"#define USE_MATCAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+a:"",e.envMap?"#define "+l:"",e.envMap?"#define "+h:"",m?"#define CUBEUV_TEXEL_WIDTH "+m.texelWidth:"",m?"#define CUBEUV_TEXEL_HEIGHT "+m.texelHeight:"",m?"#define CUBEUV_MAX_MIP "+m.maxMip+".0":"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMap&&e.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",e.normalMap&&e.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",e.clearcoat?"#define USE_CLEARCOAT":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",e.specularColorMap?"#define USE_SPECULARCOLORMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.alphaTest?"#define USE_ALPHATEST":"",e.sheen?"#define USE_SHEEN":"",e.sheenColorMap?"#define USE_SHEENCOLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",e.vertexTangents?"#define USE_TANGENT":"",e.vertexColors||e.instancingColor?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUvs?"#define USE_UV":"",e.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",e.gradientMap?"#define USE_GRADIENTMAP":"",e.flatShading?"#define FLAT_SHADED":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+_:"",e.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",e.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",e.toneMapping!==kn?"#define TONE_MAPPING":"",e.toneMapping!==kn?zi.tonemapping_pars_fragment:"",e.toneMapping!==kn?Hu("toneMapping",e.toneMapping):"",e.dithering?"#define DITHERING":"",e.opaque?"#define OPAQUE":"",zi.encodings_pars_fragment,Gu("linearToOutputTexel",e.outputEncoding),e.useDepthPacking?"#define DEPTH_PACKING "+e.depthPacking:"",`
`].filter(ua).join(`
`)),o=kr(o),o=I_(o,e),o=Y_(o,e),r=kr(r),r=I_(r,e),r=Y_(r,e),o=Z_(o),r=Z_(r),e.isWebGL2&&e.isRawShaderMaterial!==!0&&(v=`#version 300 es
`,u=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+u,g=["#define varying in",e.glslVersion===yo?"":"layout(location = 0) out highp vec4 pc_fragColor;",e.glslVersion===yo?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+g);const x=v+u+o,b=v+g+r,Y=X_(n,35633,x),w=X_(n,35632,b);if(n.attachShader(d,Y),n.attachShader(d,w),e.index0AttributeName!==void 0?n.bindAttribLocation(d,0,e.index0AttributeName):e.morphTargets===!0&&n.bindAttribLocation(d,0,"position"),n.linkProgram(d),c.debug.checkShaderErrors){const M=n.getProgramInfoLog(d).trim(),z=n.getShaderInfoLog(Y).trim(),T=n.getShaderInfoLog(w).trim();let F=!0,P=!0;if(n.getProgramParameter(d,35714)===!1){F=!1;const A=z_(n,Y,"vertex"),L=z_(n,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(d,35715)+`

Program Info Log: `+M+`
`+A+`
`+L)}else M!==""?console.warn("THREE.WebGLProgram: Program Info Log:",M):(z===""||T==="")&&(P=!1);P&&(this.diagnostics={runnable:F,programLog:M,vertexShader:{log:z,prefix:u},fragmentShader:{log:T,prefix:g}})}n.deleteShader(Y),n.deleteShader(w);let Z;this.getUniforms=function(){return Z===void 0&&(Z=new jn(n,d)),Z};let X;return this.getAttributes=function(){return X===void 0&&(X=qu(n,d)),X},this.destroy=function(){i.releaseStatesOfProgram(this),n.deleteProgram(d),this.program=void 0},this.name=e.shaderName,this.id=Nu++,this.cacheKey=t,this.usedTimes=1,this.program=d,this.vertexShader=Y,this.fragmentShader=w,this}let lf=0;class _f{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,i=t.fragmentShader,n=this._getShaderStage(e),s=this._getShaderStage(i),o=this._getShaderCacheForMaterial(t);return o.has(n)===!1&&(o.add(n),n.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const i of e)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;return e.has(t)===!1&&e.set(t,new Set),e.get(t)}_getShaderStage(t){const e=this.shaderCache;if(e.has(t)===!1){const i=new hf(t);e.set(t,i)}return e.get(t)}}class hf{constructor(t){this.id=lf++,this.code=t,this.usedTimes=0}}function cf(c,t,e,i,n,s,o){const r=new vh,_=new _f,a=[],l=n.isWebGL2,h=n.logarithmicDepthBuffer,m=n.vertexTextures;let f=n.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function d(X,M,z,T,F){const P=T.fog,A=F.geometry,L=X.isMeshStandardMaterial?T.environment:null,S=(X.isMeshStandardMaterial?e:t).get(X.envMap||L),R=!!S&&S.mapping===So?S.image.height:null,E=p[X.type];X.precision!==null&&(f=n.getMaxPrecision(X.precision),f!==X.precision&&console.warn("THREE.WebGLProgram.getParameters:",X.precision,"not supported, using",f,"instead."));const C=A.morphAttributes.position||A.morphAttributes.normal||A.morphAttributes.color,k=C!==void 0?C.length:0;let V=0;A.morphAttributes.position!==void 0&&(V=1),A.morphAttributes.normal!==void 0&&(V=2),A.morphAttributes.color!==void 0&&(V=3);let B,J,I,G;if(E){const q=zn[E];B=q.vertexShader,J=q.fragmentShader}else B=X.vertexShader,J=X.fragmentShader,_.update(X),I=_.getVertexShaderID(X),G=_.getFragmentShaderID(X);const D=c.getRenderTarget(),et=X.alphaTest>0,$=X.clearcoat>0;return{isWebGL2:l,shaderID:E,shaderName:X.type,vertexShader:B,fragmentShader:J,defines:X.defines,customVertexShaderID:I,customFragmentShaderID:G,isRawShaderMaterial:X.isRawShaderMaterial===!0,glslVersion:X.glslVersion,precision:f,instancing:F.isInstancedMesh===!0,instancingColor:F.isInstancedMesh===!0&&F.instanceColor!==null,supportsVertexTextures:m,outputEncoding:D===null?c.outputEncoding:D.isXRRenderTarget===!0?D.texture.encoding:Jn,map:!!X.map,matcap:!!X.matcap,envMap:!!S,envMapMode:S&&S.mapping,envMapCubeUVHeight:R,lightMap:!!X.lightMap,aoMap:!!X.aoMap,emissiveMap:!!X.emissiveMap,bumpMap:!!X.bumpMap,normalMap:!!X.normalMap,objectSpaceNormalMap:X.normalMapType===B0,tangentSpaceNormalMap:X.normalMapType===js,decodeVideoTexture:!!X.map&&X.map.isVideoTexture===!0&&X.map.encoding===Vi,clearcoat:$,clearcoatMap:$&&!!X.clearcoatMap,clearcoatRoughnessMap:$&&!!X.clearcoatRoughnessMap,clearcoatNormalMap:$&&!!X.clearcoatNormalMap,displacementMap:!!X.displacementMap,roughnessMap:!!X.roughnessMap,metalnessMap:!!X.metalnessMap,specularMap:!!X.specularMap,specularIntensityMap:!!X.specularIntensityMap,specularColorMap:!!X.specularColorMap,opaque:X.transparent===!1&&X.blending===Ds,alphaMap:!!X.alphaMap,alphaTest:et,gradientMap:!!X.gradientMap,sheen:X.sheen>0,sheenColorMap:!!X.sheenColorMap,sheenRoughnessMap:!!X.sheenRoughnessMap,transmission:X.transmission>0,transmissionMap:!!X.transmissionMap,thicknessMap:!!X.thicknessMap,combine:X.combine,vertexTangents:!!X.normalMap&&!!A.attributes.tangent,vertexColors:X.vertexColors,vertexAlphas:X.vertexColors===!0&&!!A.attributes.color&&A.attributes.color.itemSize===4,vertexUvs:!!X.map||!!X.bumpMap||!!X.normalMap||!!X.specularMap||!!X.alphaMap||!!X.emissiveMap||!!X.roughnessMap||!!X.metalnessMap||!!X.clearcoatMap||!!X.clearcoatRoughnessMap||!!X.clearcoatNormalMap||!!X.displacementMap||!!X.transmissionMap||!!X.thicknessMap||!!X.specularIntensityMap||!!X.specularColorMap||!!X.sheenColorMap||!!X.sheenRoughnessMap,uvsVertexOnly:!(!!X.map||!!X.bumpMap||!!X.normalMap||!!X.specularMap||!!X.alphaMap||!!X.emissiveMap||!!X.roughnessMap||!!X.metalnessMap||!!X.clearcoatNormalMap||X.transmission>0||!!X.transmissionMap||!!X.thicknessMap||!!X.specularIntensityMap||!!X.specularColorMap||X.sheen>0||!!X.sheenColorMap||!!X.sheenRoughnessMap)&&!!X.displacementMap,fog:!!P,useFog:X.fog===!0,fogExp2:P&&P.isFogExp2,flatShading:!!X.flatShading,sizeAttenuation:X.sizeAttenuation,logarithmicDepthBuffer:h,skinning:F.isSkinnedMesh===!0,morphTargets:A.morphAttributes.position!==void 0,morphNormals:A.morphAttributes.normal!==void 0,morphColors:A.morphAttributes.color!==void 0,morphTargetsCount:k,morphTextureStride:V,numDirLights:M.directional.length,numPointLights:M.point.length,numSpotLights:M.spot.length,numRectAreaLights:M.rectArea.length,numHemiLights:M.hemi.length,numDirLightShadows:M.directionalShadowMap.length,numPointLightShadows:M.pointShadowMap.length,numSpotLightShadows:M.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:X.dithering,shadowMapEnabled:c.shadowMap.enabled&&z.length>0,shadowMapType:c.shadowMap.type,toneMapping:X.toneMapped?c.toneMapping:kn,physicallyCorrectLights:c.physicallyCorrectLights,premultipliedAlpha:X.premultipliedAlpha,doubleSided:X.side===Ns,flipSided:X.side===xn,useDepthPacking:!!X.depthPacking,depthPacking:X.depthPacking||0,index0AttributeName:X.index0AttributeName,extensionDerivatives:X.extensions&&X.extensions.derivatives,extensionFragDepth:X.extensions&&X.extensions.fragDepth,extensionDrawBuffers:X.extensions&&X.extensions.drawBuffers,extensionShaderTextureLOD:X.extensions&&X.extensions.shaderTextureLOD,rendererExtensionFragDepth:l||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:l||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:l||i.has("EXT_shader_texture_lod"),customProgramCacheKey:X.customProgramCacheKey()}}function u(X){const M=[];if(X.shaderID?M.push(X.shaderID):(M.push(X.customVertexShaderID),M.push(X.customFragmentShaderID)),X.defines!==void 0)for(const z in X.defines)M.push(z),M.push(X.defines[z]);return X.isRawShaderMaterial===!1&&(g(M,X),v(M,X),M.push(c.outputEncoding)),M.push(X.customProgramCacheKey),M.join()}function g(X,M){X.push(M.precision),X.push(M.outputEncoding),X.push(M.envMapMode),X.push(M.envMapCubeUVHeight),X.push(M.combine),X.push(M.vertexUvs),X.push(M.fogExp2),X.push(M.sizeAttenuation),X.push(M.morphTargetsCount),X.push(M.morphAttributeCount),X.push(M.numDirLights),X.push(M.numPointLights),X.push(M.numSpotLights),X.push(M.numHemiLights),X.push(M.numRectAreaLights),X.push(M.numDirLightShadows),X.push(M.numPointLightShadows),X.push(M.numSpotLightShadows),X.push(M.shadowMapType),X.push(M.toneMapping),X.push(M.numClippingPlanes),X.push(M.numClipIntersection),X.push(M.depthPacking)}function v(X,M){r.disableAll(),M.isWebGL2&&r.enable(0),M.supportsVertexTextures&&r.enable(1),M.instancing&&r.enable(2),M.instancingColor&&r.enable(3),M.map&&r.enable(4),M.matcap&&r.enable(5),M.envMap&&r.enable(6),M.lightMap&&r.enable(7),M.aoMap&&r.enable(8),M.emissiveMap&&r.enable(9),M.bumpMap&&r.enable(10),M.normalMap&&r.enable(11),M.objectSpaceNormalMap&&r.enable(12),M.tangentSpaceNormalMap&&r.enable(13),M.clearcoat&&r.enable(14),M.clearcoatMap&&r.enable(15),M.clearcoatRoughnessMap&&r.enable(16),M.clearcoatNormalMap&&r.enable(17),M.displacementMap&&r.enable(18),M.specularMap&&r.enable(19),M.roughnessMap&&r.enable(20),M.metalnessMap&&r.enable(21),M.gradientMap&&r.enable(22),M.alphaMap&&r.enable(23),M.alphaTest&&r.enable(24),M.vertexColors&&r.enable(25),M.vertexAlphas&&r.enable(26),M.vertexUvs&&r.enable(27),M.vertexTangents&&r.enable(28),M.uvsVertexOnly&&r.enable(29),M.fog&&r.enable(30),X.push(r.mask),r.disableAll(),M.useFog&&r.enable(0),M.flatShading&&r.enable(1),M.logarithmicDepthBuffer&&r.enable(2),M.skinning&&r.enable(3),M.morphTargets&&r.enable(4),M.morphNormals&&r.enable(5),M.morphColors&&r.enable(6),M.premultipliedAlpha&&r.enable(7),M.shadowMapEnabled&&r.enable(8),M.physicallyCorrectLights&&r.enable(9),M.doubleSided&&r.enable(10),M.flipSided&&r.enable(11),M.useDepthPacking&&r.enable(12),M.dithering&&r.enable(13),M.specularIntensityMap&&r.enable(14),M.specularColorMap&&r.enable(15),M.transmission&&r.enable(16),M.transmissionMap&&r.enable(17),M.thicknessMap&&r.enable(18),M.sheen&&r.enable(19),M.sheenColorMap&&r.enable(20),M.sheenRoughnessMap&&r.enable(21),M.decodeVideoTexture&&r.enable(22),M.opaque&&r.enable(23),X.push(r.mask)}function x(X){const M=p[X.type];let z;if(M){const T=zn[M];z=n1.clone(T.uniforms)}else z=X.uniforms;return z}function b(X,M){let z;for(let T=0,F=a.length;T<F;T++){const P=a[T];if(P.cacheKey===M){z=P,++z.usedTimes;break}}return z===void 0&&(z=new rf(c,M,X,s),a.push(z)),z}function Y(X){if(--X.usedTimes===0){const M=a.indexOf(X);a[M]=a[a.length-1],a.pop(),X.destroy()}}function w(X){_.remove(X)}function Z(){_.dispose()}return{getParameters:d,getProgramCacheKey:u,getUniforms:x,acquireProgram:b,releaseProgram:Y,releaseShaderCache:w,programs:a,dispose:Z}}function pf(){let c=new WeakMap;function t(s){let o=c.get(s);return o===void 0&&(o={},c.set(s,o)),o}function e(s){c.delete(s)}function i(s,o,r){c.get(s)[o]=r}function n(){c=new WeakMap}return{get:t,remove:e,update:i,dispose:n}}function mf(c,t){return c.groupOrder!==t.groupOrder?c.groupOrder-t.groupOrder:c.renderOrder!==t.renderOrder?c.renderOrder-t.renderOrder:c.material.id!==t.material.id?c.material.id-t.material.id:c.z!==t.z?c.z-t.z:c.id-t.id}function L_(c,t){return c.groupOrder!==t.groupOrder?c.groupOrder-t.groupOrder:c.renderOrder!==t.renderOrder?c.renderOrder-t.renderOrder:c.z!==t.z?t.z-c.z:c.id-t.id}function A_(){const c=[];let t=0;const e=[],i=[],n=[];function s(){t=0,e.length=0,i.length=0,n.length=0}function o(h,m,f,p,d,u){let g=c[t];return g===void 0?(g={id:h.id,object:h,geometry:m,material:f,groupOrder:p,renderOrder:h.renderOrder,z:d,group:u},c[t]=g):(g.id=h.id,g.object=h,g.geometry=m,g.material=f,g.groupOrder=p,g.renderOrder=h.renderOrder,g.z=d,g.group=u),t++,g}function r(h,m,f,p,d,u){const g=o(h,m,f,p,d,u);f.transmission>0?i.push(g):f.transparent===!0?n.push(g):e.push(g)}function _(h,m,f,p,d,u){const g=o(h,m,f,p,d,u);f.transmission>0?i.unshift(g):f.transparent===!0?n.unshift(g):e.unshift(g)}function a(h,m){e.length>1&&e.sort(h||mf),i.length>1&&i.sort(m||L_),n.length>1&&n.sort(m||L_)}function l(){for(let h=t,m=c.length;h<m;h++){const f=c[h];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:e,transmissive:i,transparent:n,init:s,push:r,unshift:_,finish:l,sort:a}}function uf(){let c=new WeakMap;function t(i,n){let s;return c.has(i)===!1?(s=new A_,c.set(i,[s])):n>=c.get(i).length?(s=new A_,c.get(i).push(s)):s=c.get(i)[n],s}function e(){c=new WeakMap}return{get:t,dispose:e}}function ff(){const c={};return{get:function(t){if(c[t.id]!==void 0)return c[t.id];let e;switch(t.type){case"DirectionalLight":e={direction:new wt,color:new fi};break;case"SpotLight":e={position:new wt,direction:new wt,color:new fi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":e={position:new wt,color:new fi,distance:0,decay:0};break;case"HemisphereLight":e={direction:new wt,skyColor:new fi,groundColor:new fi};break;case"RectAreaLight":e={color:new fi,position:new wt,halfWidth:new wt,halfHeight:new wt};break}return c[t.id]=e,e}}}function df(){const c={};return{get:function(t){if(c[t.id]!==void 0)return c[t.id];let e;switch(t.type){case"DirectionalLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Fe};break;case"SpotLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Fe};break;case"PointLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Fe,shadowCameraNear:1,shadowCameraFar:1e3};break}return c[t.id]=e,e}}}let gf=0;function vf(c,t){return(t.castShadow?1:0)-(c.castShadow?1:0)}function xf(c,t){const e=new ff,i=df(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let l=0;l<9;l++)n.probe.push(new wt);const s=new wt,o=new xi,r=new xi;function _(l,h){let m=0,f=0,p=0;for(let M=0;M<9;M++)n.probe[M].set(0,0,0);let d=0,u=0,g=0,v=0,x=0,b=0,Y=0,w=0;l.sort(vf);const Z=h!==!0?Math.PI:1;for(let M=0,z=l.length;M<z;M++){const T=l[M],F=T.color,P=T.intensity,A=T.distance,L=T.shadow&&T.shadow.map?T.shadow.map.texture:null;if(T.isAmbientLight)m+=F.r*P*Z,f+=F.g*P*Z,p+=F.b*P*Z;else if(T.isLightProbe)for(let S=0;S<9;S++)n.probe[S].addScaledVector(T.sh.coefficients[S],P);else if(T.isDirectionalLight){const S=e.get(T);if(S.color.copy(T.color).multiplyScalar(T.intensity*Z),T.castShadow){const R=T.shadow,E=i.get(T);E.shadowBias=R.bias,E.shadowNormalBias=R.normalBias,E.shadowRadius=R.radius,E.shadowMapSize=R.mapSize,n.directionalShadow[d]=E,n.directionalShadowMap[d]=L,n.directionalShadowMatrix[d]=T.shadow.matrix,b++}n.directional[d]=S,d++}else if(T.isSpotLight){const S=e.get(T);if(S.position.setFromMatrixPosition(T.matrixWorld),S.color.copy(F).multiplyScalar(P*Z),S.distance=A,S.coneCos=Math.cos(T.angle),S.penumbraCos=Math.cos(T.angle*(1-T.penumbra)),S.decay=T.decay,T.castShadow){const R=T.shadow,E=i.get(T);E.shadowBias=R.bias,E.shadowNormalBias=R.normalBias,E.shadowRadius=R.radius,E.shadowMapSize=R.mapSize,n.spotShadow[g]=E,n.spotShadowMap[g]=L,n.spotShadowMatrix[g]=T.shadow.matrix,w++}n.spot[g]=S,g++}else if(T.isRectAreaLight){const S=e.get(T);S.color.copy(F).multiplyScalar(P),S.halfWidth.set(T.width*.5,0,0),S.halfHeight.set(0,T.height*.5,0),n.rectArea[v]=S,v++}else if(T.isPointLight){const S=e.get(T);if(S.color.copy(T.color).multiplyScalar(T.intensity*Z),S.distance=T.distance,S.decay=T.decay,T.castShadow){const R=T.shadow,E=i.get(T);E.shadowBias=R.bias,E.shadowNormalBias=R.normalBias,E.shadowRadius=R.radius,E.shadowMapSize=R.mapSize,E.shadowCameraNear=R.camera.near,E.shadowCameraFar=R.camera.far,n.pointShadow[u]=E,n.pointShadowMap[u]=L,n.pointShadowMatrix[u]=T.shadow.matrix,Y++}n.point[u]=S,u++}else if(T.isHemisphereLight){const S=e.get(T);S.skyColor.copy(T.color).multiplyScalar(P*Z),S.groundColor.copy(T.groundColor).multiplyScalar(P*Z),n.hemi[x]=S,x++}}v>0&&(t.isWebGL2||c.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=ni.LTC_FLOAT_1,n.rectAreaLTC2=ni.LTC_FLOAT_2):c.has("OES_texture_half_float_linear")===!0?(n.rectAreaLTC1=ni.LTC_HALF_1,n.rectAreaLTC2=ni.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=m,n.ambient[1]=f,n.ambient[2]=p;const X=n.hash;(X.directionalLength!==d||X.pointLength!==u||X.spotLength!==g||X.rectAreaLength!==v||X.hemiLength!==x||X.numDirectionalShadows!==b||X.numPointShadows!==Y||X.numSpotShadows!==w)&&(n.directional.length=d,n.spot.length=g,n.rectArea.length=v,n.point.length=u,n.hemi.length=x,n.directionalShadow.length=b,n.directionalShadowMap.length=b,n.pointShadow.length=Y,n.pointShadowMap.length=Y,n.spotShadow.length=w,n.spotShadowMap.length=w,n.directionalShadowMatrix.length=b,n.pointShadowMatrix.length=Y,n.spotShadowMatrix.length=w,X.directionalLength=d,X.pointLength=u,X.spotLength=g,X.rectAreaLength=v,X.hemiLength=x,X.numDirectionalShadows=b,X.numPointShadows=Y,X.numSpotShadows=w,n.version=gf++)}function a(l,h){let m=0,f=0,p=0,d=0,u=0;const g=h.matrixWorldInverse;for(let v=0,x=l.length;v<x;v++){const b=l[v];if(b.isDirectionalLight){const Y=n.directional[m];Y.direction.setFromMatrixPosition(b.matrixWorld),s.setFromMatrixPosition(b.target.matrixWorld),Y.direction.sub(s),Y.direction.transformDirection(g),m++}else if(b.isSpotLight){const Y=n.spot[p];Y.position.setFromMatrixPosition(b.matrixWorld),Y.position.applyMatrix4(g),Y.direction.setFromMatrixPosition(b.matrixWorld),s.setFromMatrixPosition(b.target.matrixWorld),Y.direction.sub(s),Y.direction.transformDirection(g),p++}else if(b.isRectAreaLight){const Y=n.rectArea[d];Y.position.setFromMatrixPosition(b.matrixWorld),Y.position.applyMatrix4(g),r.identity(),o.copy(b.matrixWorld),o.premultiply(g),r.extractRotation(o),Y.halfWidth.set(b.width*.5,0,0),Y.halfHeight.set(0,b.height*.5,0),Y.halfWidth.applyMatrix4(r),Y.halfHeight.applyMatrix4(r),d++}else if(b.isPointLight){const Y=n.point[f];Y.position.setFromMatrixPosition(b.matrixWorld),Y.position.applyMatrix4(g),f++}else if(b.isHemisphereLight){const Y=n.hemi[u];Y.direction.setFromMatrixPosition(b.matrixWorld),Y.direction.transformDirection(g),u++}}}return{setup:_,setupView:a,state:n}}function T_(c,t){const e=new xf(c,t),i=[],n=[];function s(){i.length=0,n.length=0}function o(h){i.push(h)}function r(h){n.push(h)}function _(h){e.setup(i,h)}function a(h){e.setupView(i,h)}return{init:s,state:{lightsArray:i,shadowsArray:n,lights:e},setupLights:_,setupLightsView:a,pushLight:o,pushShadow:r}}function bf(c,t){let e=new WeakMap;function i(s,o=0){let r;return e.has(s)===!1?(r=new T_(c,t),e.set(s,[r])):o>=e.get(s).length?(r=new T_(c,t),e.get(s).push(r)):r=e.get(s)[o],r}function n(){e=new WeakMap}return{get:i,dispose:n}}class Kr extends Oi{constructor(t){super(),this.type="MeshDepthMaterial",this.depthPacking=R0,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}Kr.prototype.isMeshDepthMaterial=!0;class tl extends Oi{constructor(t){super(),this.type="MeshDistanceMaterial",this.referencePosition=new wt,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}tl.prototype.isMeshDistanceMaterial=!0;const yf=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Mf=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Sh(c,t,e){let i=new Eo;const n=new Fe,s=new Fe,o=new Zi,r=new Kr({depthPacking:k0}),_=new tl,a={},l=e.maxTextureSize,h={0:xn,1:ba,2:Ns},m=new bn({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Fe},radius:{value:4}},vertexShader:yf,fragmentShader:Mf}),f=m.clone();f.defines.HORIZONTAL_PASS=1;const p=new Ti;p.setAttribute("position",new Ri(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const d=new en(p,m),u=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=hh,this.render=function(b,Y,w){if(u.enabled===!1||u.autoUpdate===!1&&u.needsUpdate===!1||b.length===0)return;const Z=c.getRenderTarget(),X=c.getActiveCubeFace(),M=c.getActiveMipmapLevel(),z=c.state;z.setBlending(Yn),z.buffers.color.setClear(1,1,1,1),z.buffers.depth.setTest(!0),z.setScissorTest(!1);for(let T=0,F=b.length;T<F;T++){const P=b[T],A=P.shadow;if(A===void 0){console.warn("THREE.WebGLShadowMap:",P,"has no shadow.");continue}if(A.autoUpdate===!1&&A.needsUpdate===!1)continue;n.copy(A.mapSize);const L=A.getFrameExtents();if(n.multiply(L),s.copy(A.mapSize),(n.x>l||n.y>l)&&(n.x>l&&(s.x=Math.floor(l/L.x),n.x=s.x*L.x,A.mapSize.x=s.x),n.y>l&&(s.y=Math.floor(l/L.y),n.y=s.y*L.y,A.mapSize.y=s.y)),A.map===null&&!A.isPointLightShadow&&this.type===ma&&(A.map=new on(n.x,n.y),A.map.texture.name=P.name+".shadowMap",A.mapPass=new on(n.x,n.y),A.camera.updateProjectionMatrix()),A.map===null){const R={minFilter:Hi,magFilter:Hi,format:gn};A.map=new on(n.x,n.y,R),A.map.texture.name=P.name+".shadowMap",A.camera.updateProjectionMatrix()}c.setRenderTarget(A.map),c.clear();const S=A.getViewportCount();for(let R=0;R<S;R++){const E=A.getViewport(R);o.set(s.x*E.x,s.y*E.y,s.x*E.z,s.y*E.w),z.viewport(o),A.updateMatrices(P,R),i=A.getFrustum(),x(Y,w,A.camera,P,this.type)}!A.isPointLightShadow&&this.type===ma&&g(A,w),A.needsUpdate=!1}u.needsUpdate=!1,c.setRenderTarget(Z,X,M)};function g(b,Y){const w=t.update(d);m.defines.VSM_SAMPLES!==b.blurSamples&&(m.defines.VSM_SAMPLES=b.blurSamples,f.defines.VSM_SAMPLES=b.blurSamples,m.needsUpdate=!0,f.needsUpdate=!0),m.uniforms.shadow_pass.value=b.map.texture,m.uniforms.resolution.value=b.mapSize,m.uniforms.radius.value=b.radius,c.setRenderTarget(b.mapPass),c.clear(),c.renderBufferDirect(Y,null,w,m,d,null),f.uniforms.shadow_pass.value=b.mapPass.texture,f.uniforms.resolution.value=b.mapSize,f.uniforms.radius.value=b.radius,c.setRenderTarget(b.map),c.clear(),c.renderBufferDirect(Y,null,w,f,d,null)}function v(b,Y,w,Z,X,M){let z=null;const T=w.isPointLight===!0?b.customDistanceMaterial:b.customDepthMaterial;if(T!==void 0?z=T:z=w.isPointLight===!0?_:r,c.localClippingEnabled&&Y.clipShadows===!0&&Y.clippingPlanes.length!==0||Y.displacementMap&&Y.displacementScale!==0||Y.alphaMap&&Y.alphaTest>0){const F=z.uuid,P=Y.uuid;let A=a[F];A===void 0&&(A={},a[F]=A);let L=A[P];L===void 0&&(L=z.clone(),A[P]=L),z=L}return z.visible=Y.visible,z.wireframe=Y.wireframe,M===ma?z.side=Y.shadowSide!==null?Y.shadowSide:Y.side:z.side=Y.shadowSide!==null?Y.shadowSide:h[Y.side],z.alphaMap=Y.alphaMap,z.alphaTest=Y.alphaTest,z.clipShadows=Y.clipShadows,z.clippingPlanes=Y.clippingPlanes,z.clipIntersection=Y.clipIntersection,z.displacementMap=Y.displacementMap,z.displacementScale=Y.displacementScale,z.displacementBias=Y.displacementBias,z.wireframeLinewidth=Y.wireframeLinewidth,z.linewidth=Y.linewidth,w.isPointLight===!0&&z.isMeshDistanceMaterial===!0&&(z.referencePosition.setFromMatrixPosition(w.matrixWorld),z.nearDistance=Z,z.farDistance=X),z}function x(b,Y,w,Z,X){if(b.visible===!1)return;if(b.layers.test(Y.layers)&&(b.isMesh||b.isLine||b.isPoints)&&(b.castShadow||b.receiveShadow&&X===ma)&&(!b.frustumCulled||i.intersectsObject(b))){b.modelViewMatrix.multiplyMatrices(w.matrixWorldInverse,b.matrixWorld);const T=t.update(b),F=b.material;if(Array.isArray(F)){const P=T.groups;for(let A=0,L=P.length;A<L;A++){const S=P[A],R=F[S.materialIndex];if(R&&R.visible){const E=v(b,R,Z,w.near,w.far,X);c.renderBufferDirect(w,null,T,E,b,S)}}}else if(F.visible){const P=v(b,F,Z,w.near,w.far,X);c.renderBufferDirect(w,null,T,P,b,null)}}const z=b.children;for(let T=0,F=z.length;T<F;T++)x(z[T],Y,w,Z,X)}}function wf(c,t,e){const i=e.isWebGL2;function n(){let K=!1;const lt=new Zi;let rt=null;const Vt=new Zi(0,0,0,0);return{setMask:function(At){rt!==At&&!K&&(c.colorMask(At,At,At,At),rt=At)},setLocked:function(At){K=At},setClear:function(At,Yt,Xt,Nt,ie){ie===!0&&(At*=Nt,Yt*=Nt,Xt*=Nt),lt.set(At,Yt,Xt,Nt),Vt.equals(lt)===!1&&(c.clearColor(At,Yt,Xt,Nt),Vt.copy(lt))},reset:function(){K=!1,rt=null,Vt.set(-1,0,0,0)}}}function s(){let K=!1,lt=null,rt=null,Vt=null;return{setTest:function(At){At?G(2929):D(2929)},setMask:function(At){lt!==At&&!K&&(c.depthMask(At),lt=At)},setFunc:function(At){if(rt!==At){if(At)switch(At){case n0:c.depthFunc(512);break;case s0:c.depthFunc(519);break;case a0:c.depthFunc(513);break;case Lr:c.depthFunc(515);break;case o0:c.depthFunc(514);break;case r0:c.depthFunc(518);break;case l0:c.depthFunc(516);break;case _0:c.depthFunc(517);break;default:c.depthFunc(515)}else c.depthFunc(515);rt=At}},setLocked:function(At){K=At},setClear:function(At){Vt!==At&&(c.clearDepth(At),Vt=At)},reset:function(){K=!1,lt=null,rt=null,Vt=null}}}function o(){let K=!1,lt=null,rt=null,Vt=null,At=null,Yt=null,Xt=null,Nt=null,ie=null;return{setTest:function(ee){K||(ee?G(2960):D(2960))},setMask:function(ee){lt!==ee&&!K&&(c.stencilMask(ee),lt=ee)},setFunc:function(ee,Ze,ze){(rt!==ee||Vt!==Ze||At!==ze)&&(c.stencilFunc(ee,Ze,ze),rt=ee,Vt=Ze,At=ze)},setOp:function(ee,Ze,ze){(Yt!==ee||Xt!==Ze||Nt!==ze)&&(c.stencilOp(ee,Ze,ze),Yt=ee,Xt=Ze,Nt=ze)},setLocked:function(ee){K=ee},setClear:function(ee){ie!==ee&&(c.clearStencil(ee),ie=ee)},reset:function(){K=!1,lt=null,rt=null,Vt=null,At=null,Yt=null,Xt=null,Nt=null,ie=null}}}const r=new n,_=new s,a=new o;let l={},h={},m=new WeakMap,f=[],p=null,d=!1,u=null,g=null,v=null,x=null,b=null,Y=null,w=null,Z=!1,X=null,M=null,z=null,T=null,F=null;const P=c.getParameter(35661);let A=!1,L=0;const S=c.getParameter(7938);S.indexOf("WebGL")!==-1?(L=parseFloat(/^WebGL (\d)/.exec(S)[1]),A=L>=1):S.indexOf("OpenGL ES")!==-1&&(L=parseFloat(/^OpenGL ES (\d)/.exec(S)[1]),A=L>=2);let R=null,E={};const C=c.getParameter(3088),k=c.getParameter(2978),V=new Zi().fromArray(C),B=new Zi().fromArray(k);function J(K,lt,rt){const Vt=new Uint8Array(4),At=c.createTexture();c.bindTexture(K,At),c.texParameteri(K,10241,9728),c.texParameteri(K,10240,9728);for(let Yt=0;Yt<rt;Yt++)c.texImage2D(lt+Yt,0,6408,1,1,0,6408,5121,Vt);return At}const I={};I[3553]=J(3553,3553,1),I[34067]=J(34067,34069,6),r.setClear(0,0,0,1),_.setClear(1),a.setClear(0),G(2929),_.setFunc(Lr),it(!1),Q(Xl),G(2884),W(Yn);function G(K){l[K]!==!0&&(c.enable(K),l[K]=!0)}function D(K){l[K]!==!1&&(c.disable(K),l[K]=!1)}function et(K,lt){return h[K]!==lt?(c.bindFramebuffer(K,lt),h[K]=lt,i&&(K===36009&&(h[36160]=lt),K===36160&&(h[36009]=lt)),!0):!1}function $(K,lt){let rt=f,Vt=!1;if(K)if(rt=m.get(lt),rt===void 0&&(rt=[],m.set(lt,rt)),K.isWebGLMultipleRenderTargets){const At=K.texture;if(rt.length!==At.length||rt[0]!==36064){for(let Yt=0,Xt=At.length;Yt<Xt;Yt++)rt[Yt]=36064+Yt;rt.length=At.length,Vt=!0}}else rt[0]!==36064&&(rt[0]=36064,Vt=!0);else rt[0]!==1029&&(rt[0]=1029,Vt=!0);Vt&&(e.isWebGL2?c.drawBuffers(rt):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(rt))}function j(K){return p!==K?(c.useProgram(K),p=K,!0):!1}const q={[Vs]:32774,[Hc]:32778,[Wc]:32779};if(i)q[Zl]=32775,q[Sl]=32776;else{const K=t.get("EXT_blend_minmax");K!==null&&(q[Zl]=K.MIN_EXT,q[Sl]=K.MAX_EXT)}const tt={[jc]:0,[qc]:1,[Jc]:768,[ph]:770,[i0]:776,[t0]:774,[Qc]:772,[$c]:769,[mh]:771,[e0]:775,[Kc]:773};function W(K,lt,rt,Vt,At,Yt,Xt,Nt){if(K===Yn){d===!0&&(D(3042),d=!1);return}if(d===!1&&(G(3042),d=!0),K!==Gc){if(K!==u||Nt!==Z){if((g!==Vs||b!==Vs)&&(c.blendEquation(32774),g=Vs,b=Vs),Nt)switch(K){case Ds:c.blendFuncSeparate(1,771,1,771);break;case zl:c.blendFunc(1,1);break;case Il:c.blendFuncSeparate(0,769,0,1);break;case Yl:c.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",K);break}else switch(K){case Ds:c.blendFuncSeparate(770,771,1,771);break;case zl:c.blendFunc(770,1);break;case Il:c.blendFuncSeparate(0,769,0,1);break;case Yl:c.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",K);break}v=null,x=null,Y=null,w=null,u=K,Z=Nt}return}At=At||lt,Yt=Yt||rt,Xt=Xt||Vt,(lt!==g||At!==b)&&(c.blendEquationSeparate(q[lt],q[At]),g=lt,b=At),(rt!==v||Vt!==x||Yt!==Y||Xt!==w)&&(c.blendFuncSeparate(tt[rt],tt[Vt],tt[Yt],tt[Xt]),v=rt,x=Vt,Y=Yt,w=Xt),u=K,Z=null}function U(K,lt){K.side===Ns?D(2884):G(2884);let rt=K.side===xn;lt&&(rt=!rt),it(rt),K.blending===Ds&&K.transparent===!1?W(Yn):W(K.blending,K.blendEquation,K.blendSrc,K.blendDst,K.blendEquationAlpha,K.blendSrcAlpha,K.blendDstAlpha,K.premultipliedAlpha),_.setFunc(K.depthFunc),_.setTest(K.depthTest),_.setMask(K.depthWrite),r.setMask(K.colorWrite);const Vt=K.stencilWrite;a.setTest(Vt),Vt&&(a.setMask(K.stencilWriteMask),a.setFunc(K.stencilFunc,K.stencilRef,K.stencilFuncMask),a.setOp(K.stencilFail,K.stencilZFail,K.stencilZPass)),ht(K.polygonOffset,K.polygonOffsetFactor,K.polygonOffsetUnits),K.alphaToCoverage===!0?G(32926):D(32926)}function it(K){X!==K&&(K?c.frontFace(2304):c.frontFace(2305),X=K)}function Q(K){K!==Nc?(G(2884),K!==M&&(K===Xl?c.cullFace(1029):K===Oc?c.cullFace(1028):c.cullFace(1032))):D(2884),M=K}function at(K){K!==z&&(A&&c.lineWidth(K),z=K)}function ht(K,lt,rt){K?(G(32823),(T!==lt||F!==rt)&&(c.polygonOffset(lt,rt),T=lt,F=rt)):D(32823)}function _t(K){K?G(3089):D(3089)}function mt(K){K===void 0&&(K=33984+P-1),R!==K&&(c.activeTexture(K),R=K)}function ft(K,lt){R===null&&mt();let rt=E[R];rt===void 0&&(rt={type:void 0,texture:void 0},E[R]=rt),(rt.type!==K||rt.texture!==lt)&&(c.bindTexture(K,lt||I[K]),rt.type=K,rt.texture=lt)}function ut(){const K=E[R];K!==void 0&&K.type!==void 0&&(c.bindTexture(K.type,null),K.type=void 0,K.texture=void 0)}function H(){try{c.compressedTexImage2D.apply(c,arguments)}catch(K){console.error("THREE.WebGLState:",K)}}function O(){try{c.texSubImage2D.apply(c,arguments)}catch(K){console.error("THREE.WebGLState:",K)}}function ot(){try{c.texSubImage3D.apply(c,arguments)}catch(K){console.error("THREE.WebGLState:",K)}}function pt(){try{c.compressedTexSubImage2D.apply(c,arguments)}catch(K){console.error("THREE.WebGLState:",K)}}function vt(){try{c.texStorage2D.apply(c,arguments)}catch(K){console.error("THREE.WebGLState:",K)}}function xt(){try{c.texStorage3D.apply(c,arguments)}catch(K){console.error("THREE.WebGLState:",K)}}function Mt(){try{c.texImage2D.apply(c,arguments)}catch(K){console.error("THREE.WebGLState:",K)}}function ct(){try{c.texImage3D.apply(c,arguments)}catch(K){console.error("THREE.WebGLState:",K)}}function St(K){V.equals(K)===!1&&(c.scissor(K.x,K.y,K.z,K.w),V.copy(K))}function It(K){B.equals(K)===!1&&(c.viewport(K.x,K.y,K.z,K.w),B.copy(K))}function dt(){c.disable(3042),c.disable(2884),c.disable(2929),c.disable(32823),c.disable(3089),c.disable(2960),c.disable(32926),c.blendEquation(32774),c.blendFunc(1,0),c.blendFuncSeparate(1,0,1,0),c.colorMask(!0,!0,!0,!0),c.clearColor(0,0,0,0),c.depthMask(!0),c.depthFunc(513),c.clearDepth(1),c.stencilMask(4294967295),c.stencilFunc(519,0,4294967295),c.stencilOp(7680,7680,7680),c.clearStencil(0),c.cullFace(1029),c.frontFace(2305),c.polygonOffset(0,0),c.activeTexture(33984),c.bindFramebuffer(36160,null),i===!0&&(c.bindFramebuffer(36009,null),c.bindFramebuffer(36008,null)),c.useProgram(null),c.lineWidth(1),c.scissor(0,0,c.canvas.width,c.canvas.height),c.viewport(0,0,c.canvas.width,c.canvas.height),l={},R=null,E={},h={},m=new WeakMap,f=[],p=null,d=!1,u=null,g=null,v=null,x=null,b=null,Y=null,w=null,Z=!1,X=null,M=null,z=null,T=null,F=null,V.set(0,0,c.canvas.width,c.canvas.height),B.set(0,0,c.canvas.width,c.canvas.height),r.reset(),_.reset(),a.reset()}return{buffers:{color:r,depth:_,stencil:a},enable:G,disable:D,bindFramebuffer:et,drawBuffers:$,useProgram:j,setBlending:W,setMaterial:U,setFlipSided:it,setCullFace:Q,setLineWidth:at,setPolygonOffset:ht,setScissorTest:_t,activeTexture:mt,bindTexture:ft,unbindTexture:ut,compressedTexImage2D:H,texImage2D:Mt,texImage3D:ct,texStorage2D:vt,texStorage3D:xt,texSubImage2D:O,texSubImage3D:ot,compressedTexSubImage2D:pt,scissor:St,viewport:It,reset:dt}}function Xf(c,t,e,i,n,s,o){const r=n.isWebGL2,_=n.maxTextures,a=n.maxCubemapSize,l=n.maxTextureSize,h=n.maxSamples,m=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,f=/OculusBrowser/g.test(navigator.userAgent),p=new WeakMap;let d;const u=new WeakMap;let g=!1;try{g=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function v(H,O){return g?new OffscreenCanvas(H,O):Xa("canvas")}function x(H,O,ot,pt){let vt=1;if((H.width>pt||H.height>pt)&&(vt=pt/Math.max(H.width,H.height)),vt<1||O===!0)if(typeof HTMLImageElement!="undefined"&&H instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&H instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&H instanceof ImageBitmap){const xt=O?Rr:Math.floor,Mt=xt(vt*H.width),ct=xt(vt*H.height);d===void 0&&(d=v(Mt,ct));const St=ot?v(Mt,ct):d;return St.width=Mt,St.height=ct,St.getContext("2d").drawImage(H,0,0,Mt,ct),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+H.width+"x"+H.height+") to ("+Mt+"x"+ct+")."),St}else return"data"in H&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+H.width+"x"+H.height+")."),H;return H}function b(H){return Kl(H.width)&&Kl(H.height)}function Y(H){return r?!1:H.wrapS!==dn||H.wrapT!==dn||H.minFilter!==Hi&&H.minFilter!==an}function w(H,O){return H.generateMipmaps&&O&&H.minFilter!==Hi&&H.minFilter!==an}function Z(H){c.generateMipmap(H)}function X(H,O,ot,pt,vt=!1){if(r===!1)return O;if(H!==null){if(c[H]!==void 0)return c[H];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+H+"'")}let xt=O;return O===6403&&(ot===5126&&(xt=33326),ot===5131&&(xt=33325),ot===5121&&(xt=33321)),O===33319&&(ot===5126&&(xt=33328),ot===5131&&(xt=33327),ot===5121&&(xt=33323)),O===6408&&(ot===5126&&(xt=34836),ot===5131&&(xt=34842),ot===5121&&(xt=pt===Vi&&vt===!1?35907:32856),ot===32819&&(xt=32854),ot===32820&&(xt=32855)),(xt===33325||xt===33326||xt===33327||xt===33328||xt===34842||xt===34836)&&t.get("EXT_color_buffer_float"),xt}function M(H,O,ot){return w(H,ot)===!0||H.isFramebufferTexture&&H.minFilter!==Hi&&H.minFilter!==an?Math.log2(Math.max(O.width,O.height))+1:H.mipmaps!==void 0&&H.mipmaps.length>0?H.mipmaps.length:H.isCompressedTexture&&Array.isArray(H.image)?O.mipmaps.length:1}function z(H){return H===Hi||H===Ll||H===Al?9728:9729}function T(H){const O=H.target;O.removeEventListener("dispose",T),P(O),O.isVideoTexture&&p.delete(O)}function F(H){const O=H.target;O.removeEventListener("dispose",F),L(O)}function P(H){const O=i.get(H);if(O.__webglInit===void 0)return;const ot=H.source,pt=u.get(ot);if(pt){const vt=pt[O.__cacheKey];vt.usedTimes--,vt.usedTimes===0&&A(H),Object.keys(pt).length===0&&u.delete(ot)}i.remove(H)}function A(H){const O=i.get(H);c.deleteTexture(O.__webglTexture);const ot=H.source,pt=u.get(ot);delete pt[O.__cacheKey],o.memory.textures--}function L(H){const O=H.texture,ot=i.get(H),pt=i.get(O);if(pt.__webglTexture!==void 0&&(c.deleteTexture(pt.__webglTexture),o.memory.textures--),H.depthTexture&&H.depthTexture.dispose(),H.isWebGLCubeRenderTarget)for(let vt=0;vt<6;vt++)c.deleteFramebuffer(ot.__webglFramebuffer[vt]),ot.__webglDepthbuffer&&c.deleteRenderbuffer(ot.__webglDepthbuffer[vt]);else c.deleteFramebuffer(ot.__webglFramebuffer),ot.__webglDepthbuffer&&c.deleteRenderbuffer(ot.__webglDepthbuffer),ot.__webglMultisampledFramebuffer&&c.deleteFramebuffer(ot.__webglMultisampledFramebuffer),ot.__webglColorRenderbuffer&&c.deleteRenderbuffer(ot.__webglColorRenderbuffer),ot.__webglDepthRenderbuffer&&c.deleteRenderbuffer(ot.__webglDepthRenderbuffer);if(H.isWebGLMultipleRenderTargets)for(let vt=0,xt=O.length;vt<xt;vt++){const Mt=i.get(O[vt]);Mt.__webglTexture&&(c.deleteTexture(Mt.__webglTexture),o.memory.textures--),i.remove(O[vt])}i.remove(O),i.remove(H)}let S=0;function R(){S=0}function E(){const H=S;return H>=_&&console.warn("THREE.WebGLTextures: Trying to use "+H+" texture units while this GPU supports only "+_),S+=1,H}function C(H){const O=[];return O.push(H.wrapS),O.push(H.wrapT),O.push(H.magFilter),O.push(H.minFilter),O.push(H.anisotropy),O.push(H.internalFormat),O.push(H.format),O.push(H.type),O.push(H.generateMipmaps),O.push(H.premultiplyAlpha),O.push(H.flipY),O.push(H.unpackAlignment),O.push(H.encoding),O.join()}function k(H,O){const ot=i.get(H);if(H.isVideoTexture&&ft(H),H.isRenderTargetTexture===!1&&H.version>0&&ot.__version!==H.version){const pt=H.image;if(pt===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(pt.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{$(ot,H,O);return}}e.activeTexture(33984+O),e.bindTexture(3553,ot.__webglTexture)}function V(H,O){const ot=i.get(H);if(H.version>0&&ot.__version!==H.version){$(ot,H,O);return}e.activeTexture(33984+O),e.bindTexture(35866,ot.__webglTexture)}function B(H,O){const ot=i.get(H);if(H.version>0&&ot.__version!==H.version){$(ot,H,O);return}e.activeTexture(33984+O),e.bindTexture(32879,ot.__webglTexture)}function J(H,O){const ot=i.get(H);if(H.version>0&&ot.__version!==H.version){j(ot,H,O);return}e.activeTexture(33984+O),e.bindTexture(34067,ot.__webglTexture)}const I={[Vr]:10497,[dn]:33071,[Er]:33648},G={[Hi]:9728,[Ll]:9984,[Al]:9986,[an]:9729,[g0]:9985,[Lo]:9987};function D(H,O,ot){if(ot?(c.texParameteri(H,10242,I[O.wrapS]),c.texParameteri(H,10243,I[O.wrapT]),(H===32879||H===35866)&&c.texParameteri(H,32882,I[O.wrapR]),c.texParameteri(H,10240,G[O.magFilter]),c.texParameteri(H,10241,G[O.minFilter])):(c.texParameteri(H,10242,33071),c.texParameteri(H,10243,33071),(H===32879||H===35866)&&c.texParameteri(H,32882,33071),(O.wrapS!==dn||O.wrapT!==dn)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),c.texParameteri(H,10240,z(O.magFilter)),c.texParameteri(H,10241,z(O.minFilter)),O.minFilter!==Hi&&O.minFilter!==an&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),t.has("EXT_texture_filter_anisotropic")===!0){const pt=t.get("EXT_texture_filter_anisotropic");if(O.type===rs&&t.has("OES_texture_float_linear")===!1||r===!1&&O.type===Ma&&t.has("OES_texture_half_float_linear")===!1)return;(O.anisotropy>1||i.get(O).__currentAnisotropy)&&(c.texParameterf(H,pt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(O.anisotropy,n.getMaxAnisotropy())),i.get(O).__currentAnisotropy=O.anisotropy)}}function et(H,O){let ot=!1;H.__webglInit===void 0&&(H.__webglInit=!0,O.addEventListener("dispose",T));const pt=O.source;let vt=u.get(pt);vt===void 0&&(vt={},u.set(pt,vt));const xt=C(O);if(xt!==H.__cacheKey){vt[xt]===void 0&&(vt[xt]={texture:c.createTexture(),usedTimes:0},o.memory.textures++,ot=!0),vt[xt].usedTimes++;const Mt=vt[H.__cacheKey];Mt!==void 0&&(vt[H.__cacheKey].usedTimes--,Mt.usedTimes===0&&A(O)),H.__cacheKey=xt,H.__webglTexture=vt[xt].texture}return ot}function $(H,O,ot){let pt=3553;O.isDataArrayTexture&&(pt=35866),O.isData3DTexture&&(pt=32879);const vt=et(H,O),xt=O.source;if(e.activeTexture(33984+ot),e.bindTexture(pt,H.__webglTexture),xt.version!==xt.__currentVersion||vt===!0){c.pixelStorei(37440,O.flipY),c.pixelStorei(37441,O.premultiplyAlpha),c.pixelStorei(3317,O.unpackAlignment),c.pixelStorei(37443,0);const Mt=Y(O)&&b(O.image)===!1;let ct=x(O.image,Mt,!1,l);ct=ut(O,ct);const St=b(ct)||r,It=s.convert(O.format,O.encoding);let dt=s.convert(O.type),K=X(O.internalFormat,It,dt,O.encoding,O.isVideoTexture);D(pt,O,St);let lt;const rt=O.mipmaps,Vt=r&&O.isVideoTexture!==!0,At=H.__version===void 0||vt===!0,Yt=M(O,ct,St);if(O.isDepthTexture)K=6402,r?O.type===rs?K=36012:O.type===uo?K=33190:O.type===Fs?K=35056:K=33189:O.type===rs&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),O.format===_s&&K===6402&&O.type!==ya&&O.type!==uo&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),O.type=ya,dt=s.convert(O.type)),O.format===Gs&&K===6402&&(K=34041,O.type!==Fs&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),O.type=Fs,dt=s.convert(O.type))),At&&(Vt?e.texStorage2D(3553,1,K,ct.width,ct.height):e.texImage2D(3553,0,K,ct.width,ct.height,0,It,dt,null));else if(O.isDataTexture)if(rt.length>0&&St){Vt&&At&&e.texStorage2D(3553,Yt,K,rt[0].width,rt[0].height);for(let Xt=0,Nt=rt.length;Xt<Nt;Xt++)lt=rt[Xt],Vt?e.texSubImage2D(3553,Xt,0,0,lt.width,lt.height,It,dt,lt.data):e.texImage2D(3553,Xt,K,lt.width,lt.height,0,It,dt,lt.data);O.generateMipmaps=!1}else Vt?(At&&e.texStorage2D(3553,Yt,K,ct.width,ct.height),e.texSubImage2D(3553,0,0,0,ct.width,ct.height,It,dt,ct.data)):e.texImage2D(3553,0,K,ct.width,ct.height,0,It,dt,ct.data);else if(O.isCompressedTexture){Vt&&At&&e.texStorage2D(3553,Yt,K,rt[0].width,rt[0].height);for(let Xt=0,Nt=rt.length;Xt<Nt;Xt++)lt=rt[Xt],O.format!==gn?It!==null?Vt?e.compressedTexSubImage2D(3553,Xt,0,0,lt.width,lt.height,It,lt.data):e.compressedTexImage2D(3553,Xt,K,lt.width,lt.height,0,lt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Vt?e.texSubImage2D(3553,Xt,0,0,lt.width,lt.height,It,dt,lt.data):e.texImage2D(3553,Xt,K,lt.width,lt.height,0,It,dt,lt.data)}else if(O.isDataArrayTexture)Vt?(At&&e.texStorage3D(35866,Yt,K,ct.width,ct.height,ct.depth),e.texSubImage3D(35866,0,0,0,0,ct.width,ct.height,ct.depth,It,dt,ct.data)):e.texImage3D(35866,0,K,ct.width,ct.height,ct.depth,0,It,dt,ct.data);else if(O.isData3DTexture)Vt?(At&&e.texStorage3D(32879,Yt,K,ct.width,ct.height,ct.depth),e.texSubImage3D(32879,0,0,0,0,ct.width,ct.height,ct.depth,It,dt,ct.data)):e.texImage3D(32879,0,K,ct.width,ct.height,ct.depth,0,It,dt,ct.data);else if(O.isFramebufferTexture){if(At)if(Vt)e.texStorage2D(3553,Yt,K,ct.width,ct.height);else{let Xt=ct.width,Nt=ct.height;for(let ie=0;ie<Yt;ie++)e.texImage2D(3553,ie,K,Xt,Nt,0,It,dt,null),Xt>>=1,Nt>>=1}}else if(rt.length>0&&St){Vt&&At&&e.texStorage2D(3553,Yt,K,rt[0].width,rt[0].height);for(let Xt=0,Nt=rt.length;Xt<Nt;Xt++)lt=rt[Xt],Vt?e.texSubImage2D(3553,Xt,0,0,It,dt,lt):e.texImage2D(3553,Xt,K,It,dt,lt);O.generateMipmaps=!1}else Vt?(At&&e.texStorage2D(3553,Yt,K,ct.width,ct.height),e.texSubImage2D(3553,0,0,0,It,dt,ct)):e.texImage2D(3553,0,K,It,dt,ct);w(O,St)&&Z(pt),xt.__currentVersion=xt.version,O.onUpdate&&O.onUpdate(O)}H.__version=O.version}function j(H,O,ot){if(O.image.length!==6)return;const pt=et(H,O),vt=O.source;if(e.activeTexture(33984+ot),e.bindTexture(34067,H.__webglTexture),vt.version!==vt.__currentVersion||pt===!0){c.pixelStorei(37440,O.flipY),c.pixelStorei(37441,O.premultiplyAlpha),c.pixelStorei(3317,O.unpackAlignment),c.pixelStorei(37443,0);const xt=O.isCompressedTexture||O.image[0].isCompressedTexture,Mt=O.image[0]&&O.image[0].isDataTexture,ct=[];for(let Xt=0;Xt<6;Xt++)!xt&&!Mt?ct[Xt]=x(O.image[Xt],!1,!0,a):ct[Xt]=Mt?O.image[Xt].image:O.image[Xt],ct[Xt]=ut(O,ct[Xt]);const St=ct[0],It=b(St)||r,dt=s.convert(O.format,O.encoding),K=s.convert(O.type),lt=X(O.internalFormat,dt,K,O.encoding),rt=r&&O.isVideoTexture!==!0,Vt=H.__version===void 0;let At=M(O,St,It);D(34067,O,It);let Yt;if(xt){rt&&Vt&&e.texStorage2D(34067,At,lt,St.width,St.height);for(let Xt=0;Xt<6;Xt++){Yt=ct[Xt].mipmaps;for(let Nt=0;Nt<Yt.length;Nt++){const ie=Yt[Nt];O.format!==gn?dt!==null?rt?e.compressedTexSubImage2D(34069+Xt,Nt,0,0,ie.width,ie.height,dt,ie.data):e.compressedTexImage2D(34069+Xt,Nt,lt,ie.width,ie.height,0,ie.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):rt?e.texSubImage2D(34069+Xt,Nt,0,0,ie.width,ie.height,dt,K,ie.data):e.texImage2D(34069+Xt,Nt,lt,ie.width,ie.height,0,dt,K,ie.data)}}}else{Yt=O.mipmaps,rt&&Vt&&(Yt.length>0&&At++,e.texStorage2D(34067,At,lt,ct[0].width,ct[0].height));for(let Xt=0;Xt<6;Xt++)if(Mt){rt?e.texSubImage2D(34069+Xt,0,0,0,ct[Xt].width,ct[Xt].height,dt,K,ct[Xt].data):e.texImage2D(34069+Xt,0,lt,ct[Xt].width,ct[Xt].height,0,dt,K,ct[Xt].data);for(let Nt=0;Nt<Yt.length;Nt++){const ee=Yt[Nt].image[Xt].image;rt?e.texSubImage2D(34069+Xt,Nt+1,0,0,ee.width,ee.height,dt,K,ee.data):e.texImage2D(34069+Xt,Nt+1,lt,ee.width,ee.height,0,dt,K,ee.data)}}else{rt?e.texSubImage2D(34069+Xt,0,0,0,dt,K,ct[Xt]):e.texImage2D(34069+Xt,0,lt,dt,K,ct[Xt]);for(let Nt=0;Nt<Yt.length;Nt++){const ie=Yt[Nt];rt?e.texSubImage2D(34069+Xt,Nt+1,0,0,dt,K,ie.image[Xt]):e.texImage2D(34069+Xt,Nt+1,lt,dt,K,ie.image[Xt])}}}w(O,It)&&Z(34067),vt.__currentVersion=vt.version,O.onUpdate&&O.onUpdate(O)}H.__version=O.version}function q(H,O,ot,pt,vt){const xt=s.convert(ot.format,ot.encoding),Mt=s.convert(ot.type),ct=X(ot.internalFormat,xt,Mt,ot.encoding);i.get(O).__hasExternalTextures||(vt===32879||vt===35866?e.texImage3D(vt,0,ct,O.width,O.height,O.depth,0,xt,Mt,null):e.texImage2D(vt,0,ct,O.width,O.height,0,xt,Mt,null)),e.bindFramebuffer(36160,H),mt(O)?m.framebufferTexture2DMultisampleEXT(36160,pt,vt,i.get(ot).__webglTexture,0,_t(O)):c.framebufferTexture2D(36160,pt,vt,i.get(ot).__webglTexture,0),e.bindFramebuffer(36160,null)}function tt(H,O,ot){if(c.bindRenderbuffer(36161,H),O.depthBuffer&&!O.stencilBuffer){let pt=33189;if(ot||mt(O)){const vt=O.depthTexture;vt&&vt.isDepthTexture&&(vt.type===rs?pt=36012:vt.type===uo&&(pt=33190));const xt=_t(O);mt(O)?m.renderbufferStorageMultisampleEXT(36161,xt,pt,O.width,O.height):c.renderbufferStorageMultisample(36161,xt,pt,O.width,O.height)}else c.renderbufferStorage(36161,pt,O.width,O.height);c.framebufferRenderbuffer(36160,36096,36161,H)}else if(O.depthBuffer&&O.stencilBuffer){const pt=_t(O);ot&&mt(O)===!1?c.renderbufferStorageMultisample(36161,pt,35056,O.width,O.height):mt(O)?m.renderbufferStorageMultisampleEXT(36161,pt,35056,O.width,O.height):c.renderbufferStorage(36161,34041,O.width,O.height),c.framebufferRenderbuffer(36160,33306,36161,H)}else{const pt=O.isWebGLMultipleRenderTargets===!0?O.texture[0]:O.texture,vt=s.convert(pt.format,pt.encoding),xt=s.convert(pt.type),Mt=X(pt.internalFormat,vt,xt,pt.encoding),ct=_t(O);ot&&mt(O)===!1?c.renderbufferStorageMultisample(36161,ct,Mt,O.width,O.height):mt(O)?m.renderbufferStorageMultisampleEXT(36161,ct,Mt,O.width,O.height):c.renderbufferStorage(36161,Mt,O.width,O.height)}c.bindRenderbuffer(36161,null)}function W(H,O){if(O&&O.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,H),!(O.depthTexture&&O.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(O.depthTexture).__webglTexture||O.depthTexture.image.width!==O.width||O.depthTexture.image.height!==O.height)&&(O.depthTexture.image.width=O.width,O.depthTexture.image.height=O.height,O.depthTexture.needsUpdate=!0),k(O.depthTexture,0);const pt=i.get(O.depthTexture).__webglTexture,vt=_t(O);if(O.depthTexture.format===_s)mt(O)?m.framebufferTexture2DMultisampleEXT(36160,36096,3553,pt,0,vt):c.framebufferTexture2D(36160,36096,3553,pt,0);else if(O.depthTexture.format===Gs)mt(O)?m.framebufferTexture2DMultisampleEXT(36160,33306,3553,pt,0,vt):c.framebufferTexture2D(36160,33306,3553,pt,0);else throw new Error("Unknown depthTexture format")}function U(H){const O=i.get(H),ot=H.isWebGLCubeRenderTarget===!0;if(H.depthTexture&&!O.__autoAllocateDepthBuffer){if(ot)throw new Error("target.depthTexture not supported in Cube render targets");W(O.__webglFramebuffer,H)}else if(ot){O.__webglDepthbuffer=[];for(let pt=0;pt<6;pt++)e.bindFramebuffer(36160,O.__webglFramebuffer[pt]),O.__webglDepthbuffer[pt]=c.createRenderbuffer(),tt(O.__webglDepthbuffer[pt],H,!1)}else e.bindFramebuffer(36160,O.__webglFramebuffer),O.__webglDepthbuffer=c.createRenderbuffer(),tt(O.__webglDepthbuffer,H,!1);e.bindFramebuffer(36160,null)}function it(H,O,ot){const pt=i.get(H);O!==void 0&&q(pt.__webglFramebuffer,H,H.texture,36064,3553),ot!==void 0&&U(H)}function Q(H){const O=H.texture,ot=i.get(H),pt=i.get(O);H.addEventListener("dispose",F),H.isWebGLMultipleRenderTargets!==!0&&(pt.__webglTexture===void 0&&(pt.__webglTexture=c.createTexture()),pt.__version=O.version,o.memory.textures++);const vt=H.isWebGLCubeRenderTarget===!0,xt=H.isWebGLMultipleRenderTargets===!0,Mt=b(H)||r;if(vt){ot.__webglFramebuffer=[];for(let ct=0;ct<6;ct++)ot.__webglFramebuffer[ct]=c.createFramebuffer()}else if(ot.__webglFramebuffer=c.createFramebuffer(),xt)if(n.drawBuffers){const ct=H.texture;for(let St=0,It=ct.length;St<It;St++){const dt=i.get(ct[St]);dt.__webglTexture===void 0&&(dt.__webglTexture=c.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(r&&H.samples>0&&mt(H)===!1){ot.__webglMultisampledFramebuffer=c.createFramebuffer(),ot.__webglColorRenderbuffer=c.createRenderbuffer(),c.bindRenderbuffer(36161,ot.__webglColorRenderbuffer);const ct=s.convert(O.format,O.encoding),St=s.convert(O.type),It=X(O.internalFormat,ct,St,O.encoding),dt=_t(H);c.renderbufferStorageMultisample(36161,dt,It,H.width,H.height),e.bindFramebuffer(36160,ot.__webglMultisampledFramebuffer),c.framebufferRenderbuffer(36160,36064,36161,ot.__webglColorRenderbuffer),c.bindRenderbuffer(36161,null),H.depthBuffer&&(ot.__webglDepthRenderbuffer=c.createRenderbuffer(),tt(ot.__webglDepthRenderbuffer,H,!0)),e.bindFramebuffer(36160,null)}if(vt){e.bindTexture(34067,pt.__webglTexture),D(34067,O,Mt);for(let ct=0;ct<6;ct++)q(ot.__webglFramebuffer[ct],H,O,36064,34069+ct);w(O,Mt)&&Z(34067),e.unbindTexture()}else if(xt){const ct=H.texture;for(let St=0,It=ct.length;St<It;St++){const dt=ct[St],K=i.get(dt);e.bindTexture(3553,K.__webglTexture),D(3553,dt,Mt),q(ot.__webglFramebuffer,H,dt,36064+St,3553),w(dt,Mt)&&Z(3553)}e.unbindTexture()}else{let ct=3553;(H.isWebGL3DRenderTarget||H.isWebGLArrayRenderTarget)&&(r?ct=H.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),e.bindTexture(ct,pt.__webglTexture),D(ct,O,Mt),q(ot.__webglFramebuffer,H,O,36064,ct),w(O,Mt)&&Z(ct),e.unbindTexture()}H.depthBuffer&&U(H)}function at(H){const O=b(H)||r,ot=H.isWebGLMultipleRenderTargets===!0?H.texture:[H.texture];for(let pt=0,vt=ot.length;pt<vt;pt++){const xt=ot[pt];if(w(xt,O)){const Mt=H.isWebGLCubeRenderTarget?34067:3553,ct=i.get(xt).__webglTexture;e.bindTexture(Mt,ct),Z(Mt),e.unbindTexture()}}}function ht(H){if(r&&H.samples>0&&mt(H)===!1){const O=H.width,ot=H.height;let pt=16384;const vt=[36064],xt=H.stencilBuffer?33306:36096;H.depthBuffer&&vt.push(xt);const Mt=i.get(H),ct=Mt.__ignoreDepthValues!==void 0?Mt.__ignoreDepthValues:!1;ct===!1&&(H.depthBuffer&&(pt|=256),H.stencilBuffer&&(pt|=1024)),e.bindFramebuffer(36008,Mt.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,Mt.__webglFramebuffer),ct===!0&&(c.invalidateFramebuffer(36008,[xt]),c.invalidateFramebuffer(36009,[xt])),c.blitFramebuffer(0,0,O,ot,0,0,O,ot,pt,9728),f&&c.invalidateFramebuffer(36008,vt),e.bindFramebuffer(36008,null),e.bindFramebuffer(36009,Mt.__webglMultisampledFramebuffer)}}function _t(H){return Math.min(h,H.samples)}function mt(H){const O=i.get(H);return r&&H.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&O.__useRenderToTexture!==!1}function ft(H){const O=o.render.frame;p.get(H)!==O&&(p.set(H,O),H.update())}function ut(H,O){const ot=H.encoding,pt=H.format,vt=H.type;return H.isCompressedTexture===!0||H.isVideoTexture===!0||H.format===Cr||ot!==Jn&&(ot===Vi?r===!1?t.has("EXT_sRGB")===!0&&pt===gn?(H.format=Cr,H.minFilter=an,H.generateMipmaps=!1):O=ms.sRGBToLinear(O):(pt!==gn||vt!==cs)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",ot)),O}this.allocateTextureUnit=E,this.resetTextureUnits=R,this.setTexture2D=k,this.setTexture2DArray=V,this.setTexture3D=B,this.setTextureCube=J,this.rebindTextures=it,this.setupRenderTarget=Q,this.updateRenderTargetMipmap=at,this.updateMultisampleRenderTarget=ht,this.setupDepthRenderbuffer=U,this.setupFrameBufferTexture=q,this.useMultisampledRTT=mt}function zf(c,t,e){const i=e.isWebGL2;function n(s,o=null){let r;if(s===cs)return 5121;if(s===y0)return 32819;if(s===M0)return 32820;if(s===v0)return 5120;if(s===x0)return 5122;if(s===ya)return 5123;if(s===b0)return 5124;if(s===uo)return 5125;if(s===rs)return 5126;if(s===Ma)return i?5131:(r=t.get("OES_texture_half_float"),r!==null?r.HALF_FLOAT_OES:null);if(s===w0)return 6406;if(s===gn)return 6408;if(s===z0)return 6409;if(s===I0)return 6410;if(s===_s)return 6402;if(s===Gs)return 34041;if(s===Y0)return 6403;if(s===X0)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(s===Cr)return r=t.get("EXT_sRGB"),r!==null?r.SRGB_ALPHA_EXT:null;if(s===Z0)return 36244;if(s===S0)return 33319;if(s===L0)return 33320;if(s===A0)return 36249;if(s===No||s===Oo||s===Uo||s===Go)if(o===Vi)if(r=t.get("WEBGL_compressed_texture_s3tc_srgb"),r!==null){if(s===No)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===Oo)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===Uo)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===Go)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(r=t.get("WEBGL_compressed_texture_s3tc"),r!==null){if(s===No)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===Oo)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===Uo)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===Go)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===Tl||s===Vl||s===El||s===Cl)if(r=t.get("WEBGL_compressed_texture_pvrtc"),r!==null){if(s===Tl)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===Vl)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===El)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===Cl)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===T0)return r=t.get("WEBGL_compressed_texture_etc1"),r!==null?r.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===Pl||s===Rl)if(r=t.get("WEBGL_compressed_texture_etc"),r!==null){if(s===Pl)return o===Vi?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(s===Rl)return o===Vi?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===kl||s===Bl||s===Dl||s===Fl||s===Nl||s===Ol||s===Ul||s===Gl||s===Hl||s===Wl||s===jl||s===ql||s===Jl||s===$l)if(r=t.get("WEBGL_compressed_texture_astc"),r!==null){if(s===kl)return o===Vi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===Bl)return o===Vi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===Dl)return o===Vi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===Fl)return o===Vi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===Nl)return o===Vi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===Ol)return o===Vi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===Ul)return o===Vi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===Gl)return o===Vi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===Hl)return o===Vi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===Wl)return o===Vi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===jl)return o===Vi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===ql)return o===Vi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===Jl)return o===Vi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===$l)return o===Vi?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===Ql)if(r=t.get("EXT_texture_compression_bptc"),r!==null){if(s===Ql)return o===Vi?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;return s===Fs?i?34042:(r=t.get("WEBGL_depth_texture"),r!==null?r.UNSIGNED_INT_24_8_WEBGL:null):c[s]!==void 0?c[s]:null}return{convert:n}}class Lh extends tn{constructor(t=[]){super(),this.cameras=t}}Lh.prototype.isArrayCamera=!0;class Rs extends Li{constructor(){super(),this.type="Group"}}Rs.prototype.isGroup=!0;const If={type:"move"};class yr{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Rs,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Rs,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new wt,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new wt),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Rs,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new wt,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new wt),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,e,i){let n=null,s=null,o=null;const r=this._targetRay,_=this._grip,a=this._hand;if(t&&e.session.visibilityState!=="visible-blurred")if(r!==null&&(n=e.getPose(t.targetRaySpace,i),n!==null&&(r.matrix.fromArray(n.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),n.linearVelocity?(r.hasLinearVelocity=!0,r.linearVelocity.copy(n.linearVelocity)):r.hasLinearVelocity=!1,n.angularVelocity?(r.hasAngularVelocity=!0,r.angularVelocity.copy(n.angularVelocity)):r.hasAngularVelocity=!1,this.dispatchEvent(If))),a&&t.hand){o=!0;for(const d of t.hand.values()){const u=e.getJointPose(d,i);if(a.joints[d.jointName]===void 0){const v=new Rs;v.matrixAutoUpdate=!1,v.visible=!1,a.joints[d.jointName]=v,a.add(v)}const g=a.joints[d.jointName];u!==null&&(g.matrix.fromArray(u.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.jointRadius=u.radius),g.visible=u!==null}const l=a.joints["index-finger-tip"],h=a.joints["thumb-tip"],m=l.position.distanceTo(h.position),f=.02,p=.005;a.inputState.pinching&&m>f+p?(a.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!a.inputState.pinching&&m<=f-p&&(a.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else _!==null&&t.gripSpace&&(s=e.getPose(t.gripSpace,i),s!==null&&(_.matrix.fromArray(s.transform.matrix),_.matrix.decompose(_.position,_.rotation,_.scale),s.linearVelocity?(_.hasLinearVelocity=!0,_.linearVelocity.copy(s.linearVelocity)):_.hasLinearVelocity=!1,s.angularVelocity?(_.hasAngularVelocity=!0,_.angularVelocity.copy(s.angularVelocity)):_.hasAngularVelocity=!1));return r!==null&&(r.visible=n!==null),_!==null&&(_.visible=s!==null),a!==null&&(a.visible=o!==null),this}}class Ah extends qi{constructor(t,e,i,n,s,o,r,_,a,l){if(l=l!==void 0?l:_s,l!==_s&&l!==Gs)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&l===_s&&(i=ya),i===void 0&&l===Gs&&(i=Fs),super(null,n,s,o,r,_,l,i,a),this.image={width:t,height:e},this.magFilter=r!==void 0?r:Hi,this.minFilter=_!==void 0?_:Hi,this.flipY=!1,this.generateMipmaps=!1}}Ah.prototype.isDepthTexture=!0;class Yf extends ps{constructor(t,e){super();const i=this;let n=null,s=1,o=null,r="local-floor",_=null,a=null,l=null,h=null,m=null,f=null;const p=e.getContextAttributes();let d=null,u=null;const g=[],v=new Map,x=new tn;x.layers.enable(1),x.viewport=new Zi;const b=new tn;b.layers.enable(2),b.viewport=new Zi;const Y=[x,b],w=new Lh;w.layers.enable(1),w.layers.enable(2);let Z=null,X=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(C){let k=g[C];return k===void 0&&(k=new yr,g[C]=k),k.getTargetRaySpace()},this.getControllerGrip=function(C){let k=g[C];return k===void 0&&(k=new yr,g[C]=k),k.getGripSpace()},this.getHand=function(C){let k=g[C];return k===void 0&&(k=new yr,g[C]=k),k.getHandSpace()};function M(C){const k=v.get(C.inputSource);k&&k.dispatchEvent({type:C.type,data:C.inputSource})}function z(){v.forEach(function(C,k){C.disconnect(k)}),v.clear(),Z=null,X=null,t.setRenderTarget(d),m=null,h=null,l=null,n=null,u=null,E.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(C){s=C,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(C){r=C,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return _||o},this.setReferenceSpace=function(C){_=C},this.getBaseLayer=function(){return h!==null?h:m},this.getBinding=function(){return l},this.getFrame=function(){return f},this.getSession=function(){return n},this.setSession=async function(C){if(n=C,n!==null){if(d=t.getRenderTarget(),n.addEventListener("select",M),n.addEventListener("selectstart",M),n.addEventListener("selectend",M),n.addEventListener("squeeze",M),n.addEventListener("squeezestart",M),n.addEventListener("squeezeend",M),n.addEventListener("end",z),n.addEventListener("inputsourceschange",T),p.xrCompatible!==!0&&await e.makeXRCompatible(),n.renderState.layers===void 0||t.capabilities.isWebGL2===!1){const k={antialias:n.renderState.layers===void 0?p.antialias:!0,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:s};m=new XRWebGLLayer(n,e,k),n.updateRenderState({baseLayer:m}),u=new on(m.framebufferWidth,m.framebufferHeight,{format:gn,type:cs,encoding:t.outputEncoding})}else{let k=null,V=null,B=null;p.depth&&(B=p.stencil?35056:33190,k=p.stencil?Gs:_s,V=p.stencil?Fs:ya);const J={colorFormat:t.outputEncoding===Vi?35907:32856,depthFormat:B,scaleFactor:s};l=new XRWebGLBinding(n,e),h=l.createProjectionLayer(J),n.updateRenderState({layers:[h]}),u=new on(h.textureWidth,h.textureHeight,{format:gn,type:cs,depthTexture:new Ah(h.textureWidth,h.textureHeight,V,void 0,void 0,void 0,void 0,void 0,void 0,k),stencilBuffer:p.stencil,encoding:t.outputEncoding,samples:p.antialias?4:0});const I=t.properties.get(u);I.__ignoreDepthValues=h.ignoreDepthValues}u.isXRRenderTarget=!0,this.setFoveation(1),o=await n.requestReferenceSpace(r),E.setContext(n),E.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function T(C){const k=n.inputSources;for(let V=0;V<k.length;V++){const B=k[V].handedness==="right"?1:0;v.set(k[V],g[B])}for(let V=0;V<C.removed.length;V++){const B=C.removed[V],J=v.get(B);J&&(J.dispatchEvent({type:"disconnected",data:B}),v.delete(B))}for(let V=0;V<C.added.length;V++){const B=C.added[V],J=v.get(B);J&&J.dispatchEvent({type:"connected",data:B})}}const F=new wt,P=new wt;function A(C,k,V){F.setFromMatrixPosition(k.matrixWorld),P.setFromMatrixPosition(V.matrixWorld);const B=F.distanceTo(P),J=k.projectionMatrix.elements,I=V.projectionMatrix.elements,G=J[14]/(J[10]-1),D=J[14]/(J[10]+1),et=(J[9]+1)/J[5],$=(J[9]-1)/J[5],j=(J[8]-1)/J[0],q=(I[8]+1)/I[0],tt=G*j,W=G*q,U=B/(-j+q),it=U*-j;k.matrixWorld.decompose(C.position,C.quaternion,C.scale),C.translateX(it),C.translateZ(U),C.matrixWorld.compose(C.position,C.quaternion,C.scale),C.matrixWorldInverse.copy(C.matrixWorld).invert();const Q=G+U,at=D+U,ht=tt-it,_t=W+(B-it),mt=et*D/at*Q,ft=$*D/at*Q;C.projectionMatrix.makePerspective(ht,_t,mt,ft,Q,at)}function L(C,k){k===null?C.matrixWorld.copy(C.matrix):C.matrixWorld.multiplyMatrices(k.matrixWorld,C.matrix),C.matrixWorldInverse.copy(C.matrixWorld).invert()}this.updateCamera=function(C){if(n===null)return;w.near=b.near=x.near=C.near,w.far=b.far=x.far=C.far,(Z!==w.near||X!==w.far)&&(n.updateRenderState({depthNear:w.near,depthFar:w.far}),Z=w.near,X=w.far);const k=C.parent,V=w.cameras;L(w,k);for(let J=0;J<V.length;J++)L(V[J],k);w.matrixWorld.decompose(w.position,w.quaternion,w.scale),C.position.copy(w.position),C.quaternion.copy(w.quaternion),C.scale.copy(w.scale),C.matrix.copy(w.matrix),C.matrixWorld.copy(w.matrixWorld);const B=C.children;for(let J=0,I=B.length;J<I;J++)B[J].updateMatrixWorld(!0);V.length===2?A(w,x,b):w.projectionMatrix.copy(x.projectionMatrix)},this.getCamera=function(){return w},this.getFoveation=function(){if(h!==null)return h.fixedFoveation;if(m!==null)return m.fixedFoveation},this.setFoveation=function(C){h!==null&&(h.fixedFoveation=C),m!==null&&m.fixedFoveation!==void 0&&(m.fixedFoveation=C)};let S=null;function R(C,k){if(a=k.getViewerPose(_||o),f=k,a!==null){const B=a.views;m!==null&&(t.setRenderTargetFramebuffer(u,m.framebuffer),t.setRenderTarget(u));let J=!1;B.length!==w.cameras.length&&(w.cameras.length=0,J=!0);for(let I=0;I<B.length;I++){const G=B[I];let D=null;if(m!==null)D=m.getViewport(G);else{const $=l.getViewSubImage(h,G);D=$.viewport,I===0&&(t.setRenderTargetTextures(u,$.colorTexture,h.ignoreDepthValues?void 0:$.depthStencilTexture),t.setRenderTarget(u))}const et=Y[I];et.matrix.fromArray(G.transform.matrix),et.projectionMatrix.fromArray(G.projectionMatrix),et.viewport.set(D.x,D.y,D.width,D.height),I===0&&w.matrix.copy(et.matrix),J===!0&&w.cameras.push(et)}}const V=n.inputSources;for(let B=0;B<g.length;B++){const J=V[B],I=v.get(J);I!==void 0&&I.update(J,k,_||o)}S&&S(C,k),f=null}const E=new Mh;E.setAnimationLoop(R),this.setAnimationLoop=function(C){S=C},this.dispose=function(){}}}function Zf(c,t){function e(d,u){d.fogColor.value.copy(u.color),u.isFog?(d.fogNear.value=u.near,d.fogFar.value=u.far):u.isFogExp2&&(d.fogDensity.value=u.density)}function i(d,u,g,v,x){u.isMeshBasicMaterial||u.isMeshLambertMaterial?n(d,u):u.isMeshToonMaterial?(n(d,u),l(d,u)):u.isMeshPhongMaterial?(n(d,u),a(d,u)):u.isMeshStandardMaterial?(n(d,u),h(d,u),u.isMeshPhysicalMaterial&&m(d,u,x)):u.isMeshMatcapMaterial?(n(d,u),f(d,u)):u.isMeshDepthMaterial?n(d,u):u.isMeshDistanceMaterial?(n(d,u),p(d,u)):u.isMeshNormalMaterial?n(d,u):u.isLineBasicMaterial?(s(d,u),u.isLineDashedMaterial&&o(d,u)):u.isPointsMaterial?r(d,u,g,v):u.isSpriteMaterial?_(d,u):u.isShadowMaterial?(d.color.value.copy(u.color),d.opacity.value=u.opacity):u.isShaderMaterial&&(u.uniformsNeedUpdate=!1)}function n(d,u){d.opacity.value=u.opacity,u.color&&d.diffuse.value.copy(u.color),u.emissive&&d.emissive.value.copy(u.emissive).multiplyScalar(u.emissiveIntensity),u.map&&(d.map.value=u.map),u.alphaMap&&(d.alphaMap.value=u.alphaMap),u.bumpMap&&(d.bumpMap.value=u.bumpMap,d.bumpScale.value=u.bumpScale,u.side===xn&&(d.bumpScale.value*=-1)),u.displacementMap&&(d.displacementMap.value=u.displacementMap,d.displacementScale.value=u.displacementScale,d.displacementBias.value=u.displacementBias),u.emissiveMap&&(d.emissiveMap.value=u.emissiveMap),u.normalMap&&(d.normalMap.value=u.normalMap,d.normalScale.value.copy(u.normalScale),u.side===xn&&d.normalScale.value.negate()),u.specularMap&&(d.specularMap.value=u.specularMap),u.alphaTest>0&&(d.alphaTest.value=u.alphaTest);const g=t.get(u).envMap;if(g&&(d.envMap.value=g,d.flipEnvMap.value=g.isCubeTexture&&g.isRenderTargetTexture===!1?-1:1,d.reflectivity.value=u.reflectivity,d.ior.value=u.ior,d.refractionRatio.value=u.refractionRatio),u.lightMap){d.lightMap.value=u.lightMap;const b=c.physicallyCorrectLights!==!0?Math.PI:1;d.lightMapIntensity.value=u.lightMapIntensity*b}u.aoMap&&(d.aoMap.value=u.aoMap,d.aoMapIntensity.value=u.aoMapIntensity);let v;u.map?v=u.map:u.specularMap?v=u.specularMap:u.displacementMap?v=u.displacementMap:u.normalMap?v=u.normalMap:u.bumpMap?v=u.bumpMap:u.roughnessMap?v=u.roughnessMap:u.metalnessMap?v=u.metalnessMap:u.alphaMap?v=u.alphaMap:u.emissiveMap?v=u.emissiveMap:u.clearcoatMap?v=u.clearcoatMap:u.clearcoatNormalMap?v=u.clearcoatNormalMap:u.clearcoatRoughnessMap?v=u.clearcoatRoughnessMap:u.specularIntensityMap?v=u.specularIntensityMap:u.specularColorMap?v=u.specularColorMap:u.transmissionMap?v=u.transmissionMap:u.thicknessMap?v=u.thicknessMap:u.sheenColorMap?v=u.sheenColorMap:u.sheenRoughnessMap&&(v=u.sheenRoughnessMap),v!==void 0&&(v.isWebGLRenderTarget&&(v=v.texture),v.matrixAutoUpdate===!0&&v.updateMatrix(),d.uvTransform.value.copy(v.matrix));let x;u.aoMap?x=u.aoMap:u.lightMap&&(x=u.lightMap),x!==void 0&&(x.isWebGLRenderTarget&&(x=x.texture),x.matrixAutoUpdate===!0&&x.updateMatrix(),d.uv2Transform.value.copy(x.matrix))}function s(d,u){d.diffuse.value.copy(u.color),d.opacity.value=u.opacity}function o(d,u){d.dashSize.value=u.dashSize,d.totalSize.value=u.dashSize+u.gapSize,d.scale.value=u.scale}function r(d,u,g,v){d.diffuse.value.copy(u.color),d.opacity.value=u.opacity,d.size.value=u.size*g,d.scale.value=v*.5,u.map&&(d.map.value=u.map),u.alphaMap&&(d.alphaMap.value=u.alphaMap),u.alphaTest>0&&(d.alphaTest.value=u.alphaTest);let x;u.map?x=u.map:u.alphaMap&&(x=u.alphaMap),x!==void 0&&(x.matrixAutoUpdate===!0&&x.updateMatrix(),d.uvTransform.value.copy(x.matrix))}function _(d,u){d.diffuse.value.copy(u.color),d.opacity.value=u.opacity,d.rotation.value=u.rotation,u.map&&(d.map.value=u.map),u.alphaMap&&(d.alphaMap.value=u.alphaMap),u.alphaTest>0&&(d.alphaTest.value=u.alphaTest);let g;u.map?g=u.map:u.alphaMap&&(g=u.alphaMap),g!==void 0&&(g.matrixAutoUpdate===!0&&g.updateMatrix(),d.uvTransform.value.copy(g.matrix))}function a(d,u){d.specular.value.copy(u.specular),d.shininess.value=Math.max(u.shininess,1e-4)}function l(d,u){u.gradientMap&&(d.gradientMap.value=u.gradientMap)}function h(d,u){d.roughness.value=u.roughness,d.metalness.value=u.metalness,u.roughnessMap&&(d.roughnessMap.value=u.roughnessMap),u.metalnessMap&&(d.metalnessMap.value=u.metalnessMap),t.get(u).envMap&&(d.envMapIntensity.value=u.envMapIntensity)}function m(d,u,g){d.ior.value=u.ior,u.sheen>0&&(d.sheenColor.value.copy(u.sheenColor).multiplyScalar(u.sheen),d.sheenRoughness.value=u.sheenRoughness,u.sheenColorMap&&(d.sheenColorMap.value=u.sheenColorMap),u.sheenRoughnessMap&&(d.sheenRoughnessMap.value=u.sheenRoughnessMap)),u.clearcoat>0&&(d.clearcoat.value=u.clearcoat,d.clearcoatRoughness.value=u.clearcoatRoughness,u.clearcoatMap&&(d.clearcoatMap.value=u.clearcoatMap),u.clearcoatRoughnessMap&&(d.clearcoatRoughnessMap.value=u.clearcoatRoughnessMap),u.clearcoatNormalMap&&(d.clearcoatNormalScale.value.copy(u.clearcoatNormalScale),d.clearcoatNormalMap.value=u.clearcoatNormalMap,u.side===xn&&d.clearcoatNormalScale.value.negate())),u.transmission>0&&(d.transmission.value=u.transmission,d.transmissionSamplerMap.value=g.texture,d.transmissionSamplerSize.value.set(g.width,g.height),u.transmissionMap&&(d.transmissionMap.value=u.transmissionMap),d.thickness.value=u.thickness,u.thicknessMap&&(d.thicknessMap.value=u.thicknessMap),d.attenuationDistance.value=u.attenuationDistance,d.attenuationColor.value.copy(u.attenuationColor)),d.specularIntensity.value=u.specularIntensity,d.specularColor.value.copy(u.specularColor),u.specularIntensityMap&&(d.specularIntensityMap.value=u.specularIntensityMap),u.specularColorMap&&(d.specularColorMap.value=u.specularColorMap)}function f(d,u){u.matcap&&(d.matcap.value=u.matcap)}function p(d,u){d.referencePosition.value.copy(u.referencePosition),d.nearDistance.value=u.nearDistance,d.farDistance.value=u.farDistance}return{refreshFogUniforms:e,refreshMaterialUniforms:i}}function Sf(){const c=Xa("canvas");return c.style.display="block",c}function Ai(c={}){const t=c.canvas!==void 0?c.canvas:Sf(),e=c.context!==void 0?c.context:null,i=c.depth!==void 0?c.depth:!0,n=c.stencil!==void 0?c.stencil:!0,s=c.antialias!==void 0?c.antialias:!1,o=c.premultipliedAlpha!==void 0?c.premultipliedAlpha:!0,r=c.preserveDrawingBuffer!==void 0?c.preserveDrawingBuffer:!1,_=c.powerPreference!==void 0?c.powerPreference:"default",a=c.failIfMajorPerformanceCaveat!==void 0?c.failIfMajorPerformanceCaveat:!1;let l;e!==null?l=e.getContextAttributes().alpha:l=c.alpha!==void 0?c.alpha:!1;let h=null,m=null;const f=[],p=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Jn,this.physicallyCorrectLights=!1,this.toneMapping=kn,this.toneMappingExposure=1;const d=this;let u=!1,g=0,v=0,x=null,b=-1,Y=null;const w=new Zi,Z=new Zi;let X=null,M=t.width,z=t.height,T=1,F=null,P=null;const A=new Zi(0,0,M,z),L=new Zi(0,0,M,z);let S=!1;const R=new Eo;let E=!1,C=!1,k=null;const V=new xi,B=new Fe,J=new wt,I={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function G(){return x===null?T:1}let D=e;function et(nt,gt){for(let yt=0;yt<nt.length;yt++){const bt=nt[yt],st=t.getContext(bt,gt);if(st!==null)return st}return null}try{const nt={alpha:!0,depth:i,stencil:n,antialias:s,premultipliedAlpha:o,preserveDrawingBuffer:r,powerPreference:_,failIfMajorPerformanceCaveat:a};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Gr}`),t.addEventListener("webglcontextlost",K,!1),t.addEventListener("webglcontextrestored",lt,!1),D===null){const gt=["webgl2","webgl","experimental-webgl"];if(d.isWebGL1Renderer===!0&&gt.shift(),D=et(gt,nt),D===null)throw et(gt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}D.getShaderPrecisionFormat===void 0&&(D.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(nt){throw console.error("THREE.WebGLRenderer: "+nt.message),nt}let $,j,q,tt,W,U,it,Q,at,ht,_t,mt,ft,ut,H,O,ot,pt,vt,xt,Mt,ct,St;function It(){$=new Gm(D),j=new Bm(D,$,c),$.init(j),ct=new zf(D,$,j),q=new wf(D,$,j),tt=new jm(D),W=new pf,U=new Xf(D,$,q,W,j,ct,tt),it=new Fm(d),Q=new Um(d),at=new l1(D,j),St=new Rm(D,$,at,j),ht=new Hm(D,at,tt,St),_t=new Qm(D,ht,at,tt),vt=new $m(D,j,U),O=new Dm(W),mt=new cf(d,it,Q,$,j,St,O),ft=new Zf(d,W),ut=new uf,H=new bf($,j),pt=new Pm(d,it,q,_t,l,o),ot=new Sh(d,_t,j),xt=new km(D,$,tt,j),Mt=new Wm(D,$,tt,j),tt.programs=mt.programs,d.capabilities=j,d.extensions=$,d.properties=W,d.renderLists=ut,d.shadowMap=ot,d.state=q,d.info=tt}It();const dt=new Yf(d,D);this.xr=dt,this.getContext=function(){return D},this.getContextAttributes=function(){return D.getContextAttributes()},this.forceContextLoss=function(){const nt=$.get("WEBGL_lose_context");nt&&nt.loseContext()},this.forceContextRestore=function(){const nt=$.get("WEBGL_lose_context");nt&&nt.restoreContext()},this.getPixelRatio=function(){return T},this.setPixelRatio=function(nt){nt!==void 0&&(T=nt,this.setSize(M,z,!1))},this.getSize=function(nt){return nt.set(M,z)},this.setSize=function(nt,gt,yt){if(dt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}M=nt,z=gt,t.width=Math.floor(nt*T),t.height=Math.floor(gt*T),yt!==!1&&(t.style.width=nt+"px",t.style.height=gt+"px"),this.setViewport(0,0,nt,gt)},this.getDrawingBufferSize=function(nt){return nt.set(M*T,z*T).floor()},this.setDrawingBufferSize=function(nt,gt,yt){M=nt,z=gt,T=yt,t.width=Math.floor(nt*yt),t.height=Math.floor(gt*yt),this.setViewport(0,0,nt,gt)},this.getCurrentViewport=function(nt){return nt.copy(w)},this.getViewport=function(nt){return nt.copy(A)},this.setViewport=function(nt,gt,yt,bt){nt.isVector4?A.set(nt.x,nt.y,nt.z,nt.w):A.set(nt,gt,yt,bt),q.viewport(w.copy(A).multiplyScalar(T).floor())},this.getScissor=function(nt){return nt.copy(L)},this.setScissor=function(nt,gt,yt,bt){nt.isVector4?L.set(nt.x,nt.y,nt.z,nt.w):L.set(nt,gt,yt,bt),q.scissor(Z.copy(L).multiplyScalar(T).floor())},this.getScissorTest=function(){return S},this.setScissorTest=function(nt){q.setScissorTest(S=nt)},this.setOpaqueSort=function(nt){F=nt},this.setTransparentSort=function(nt){P=nt},this.getClearColor=function(nt){return nt.copy(pt.getClearColor())},this.setClearColor=function(){pt.setClearColor.apply(pt,arguments)},this.getClearAlpha=function(){return pt.getClearAlpha()},this.setClearAlpha=function(){pt.setClearAlpha.apply(pt,arguments)},this.clear=function(nt=!0,gt=!0,yt=!0){let bt=0;nt&&(bt|=16384),gt&&(bt|=256),yt&&(bt|=1024),D.clear(bt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",K,!1),t.removeEventListener("webglcontextrestored",lt,!1),ut.dispose(),H.dispose(),W.dispose(),it.dispose(),Q.dispose(),_t.dispose(),St.dispose(),mt.dispose(),dt.dispose(),dt.removeEventListener("sessionstart",Nt),dt.removeEventListener("sessionend",ie),k&&(k.dispose(),k=null),ee.stop()};function K(nt){nt.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),u=!0}function lt(){console.log("THREE.WebGLRenderer: Context Restored."),u=!1;const nt=tt.autoReset,gt=ot.enabled,yt=ot.autoUpdate,bt=ot.needsUpdate,st=ot.type;It(),tt.autoReset=nt,ot.enabled=gt,ot.autoUpdate=yt,ot.needsUpdate=bt,ot.type=st}function rt(nt){const gt=nt.target;gt.removeEventListener("dispose",rt),Vt(gt)}function Vt(nt){At(nt),W.remove(nt)}function At(nt){const gt=W.get(nt).programs;gt!==void 0&&(gt.forEach(function(yt){mt.releaseProgram(yt)}),nt.isShaderMaterial&&mt.releaseShaderCache(nt))}this.renderBufferDirect=function(nt,gt,yt,bt,st,Pt){gt===null&&(gt=I);const Dt=st.isMesh&&st.matrixWorld.determinant()<0,N=qe(nt,gt,yt,bt,st);q.setMaterial(bt,Dt);let kt=yt.index;const Rt=yt.attributes.position;if(kt===null){if(Rt===void 0||Rt.count===0)return}else if(kt.count===0)return;let Ot=1;bt.wireframe===!0&&(kt=ht.getWireframeAttribute(yt),Ot=2),St.setup(st,bt,N,yt,kt);let Wt,Bt=xt;kt!==null&&(Wt=at.get(kt),Bt=Mt,Bt.setIndex(Wt));const re=kt!==null?kt.count:Rt.count,Ce=yt.drawRange.start*Ot,be=yt.drawRange.count*Ot,Tt=Pt!==null?Pt.start*Ot:0,Lt=Pt!==null?Pt.count*Ot:1/0,Zt=Math.max(Ce,Tt),me=Math.min(re,Ce+be,Tt+Lt)-1,Me=Math.max(0,me-Zt+1);if(Me!==0){if(st.isMesh)bt.wireframe===!0?(q.setLineWidth(bt.wireframeLinewidth*G()),Bt.setMode(1)):Bt.setMode(4);else if(st.isLine){let fe=bt.linewidth;fe===void 0&&(fe=1),q.setLineWidth(fe*G()),st.isLineSegments?Bt.setMode(1):st.isLineLoop?Bt.setMode(2):Bt.setMode(3)}else st.isPoints?Bt.setMode(0):st.isSprite&&Bt.setMode(4);if(st.isInstancedMesh)Bt.renderInstances(Zt,Me,st.count);else if(yt.isInstancedBufferGeometry){const fe=Math.min(yt.instanceCount,yt._maxInstanceCount);Bt.renderInstances(Zt,Me,fe)}else Bt.render(Zt,Me)}},this.compile=function(nt,gt){m=H.get(nt),m.init(),p.push(m),nt.traverseVisible(function(yt){yt.isLight&&yt.layers.test(gt.layers)&&(m.pushLight(yt),yt.castShadow&&m.pushShadow(yt))}),m.setupLights(d.physicallyCorrectLights),nt.traverse(function(yt){const bt=yt.material;if(bt)if(Array.isArray(bt))for(let st=0;st<bt.length;st++){const Pt=bt[st];ue(Pt,nt,yt)}else ue(bt,nt,yt)}),p.pop(),m=null};let Yt=null;function Xt(nt){Yt&&Yt(nt)}function Nt(){ee.stop()}function ie(){ee.start()}const ee=new Mh;ee.setAnimationLoop(Xt),typeof self!="undefined"&&ee.setContext(self),this.setAnimationLoop=function(nt){Yt=nt,dt.setAnimationLoop(nt),nt===null?ee.stop():ee.start()},dt.addEventListener("sessionstart",Nt),dt.addEventListener("sessionend",ie),this.render=function(nt,gt){if(gt!==void 0&&gt.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(u===!0)return;nt.autoUpdate===!0&&nt.updateMatrixWorld(),gt.parent===null&&gt.updateMatrixWorld(),dt.enabled===!0&&dt.isPresenting===!0&&(dt.cameraAutoUpdate===!0&&dt.updateCamera(gt),gt=dt.getCamera()),nt.isScene===!0&&nt.onBeforeRender(d,nt,gt,x),m=H.get(nt,p.length),m.init(),p.push(m),V.multiplyMatrices(gt.projectionMatrix,gt.matrixWorldInverse),R.setFromProjectionMatrix(V),C=this.localClippingEnabled,E=O.init(this.clippingPlanes,C,gt),h=ut.get(nt,f.length),h.init(),f.push(h),Ze(nt,gt,0,d.sortObjects),h.finish(),d.sortObjects===!0&&h.sort(F,P),E===!0&&O.beginShadows();const yt=m.state.shadowsArray;if(ot.render(yt,nt,gt),E===!0&&O.endShadows(),this.info.autoReset===!0&&this.info.reset(),pt.render(h,nt),m.setupLights(d.physicallyCorrectLights),gt.isArrayCamera){const bt=gt.cameras;for(let st=0,Pt=bt.length;st<Pt;st++){const Dt=bt[st];ze(h,nt,Dt,Dt.viewport)}}else ze(h,nt,gt);x!==null&&(U.updateMultisampleRenderTarget(x),U.updateRenderTargetMipmap(x)),nt.isScene===!0&&nt.onAfterRender(d,nt,gt),St.resetDefaultState(),b=-1,Y=null,p.pop(),p.length>0?m=p[p.length-1]:m=null,f.pop(),f.length>0?h=f[f.length-1]:h=null};function Ze(nt,gt,yt,bt){if(nt.visible===!1)return;if(nt.layers.test(gt.layers)){if(nt.isGroup)yt=nt.renderOrder;else if(nt.isLOD)nt.autoUpdate===!0&&nt.update(gt);else if(nt.isLight)m.pushLight(nt),nt.castShadow&&m.pushShadow(nt);else if(nt.isSprite){if(!nt.frustumCulled||R.intersectsSprite(nt)){bt&&J.setFromMatrixPosition(nt.matrixWorld).applyMatrix4(V);const Dt=_t.update(nt),N=nt.material;N.visible&&h.push(nt,Dt,N,yt,J.z,null)}}else if((nt.isMesh||nt.isLine||nt.isPoints)&&(nt.isSkinnedMesh&&nt.skeleton.frame!==tt.render.frame&&(nt.skeleton.update(),nt.skeleton.frame=tt.render.frame),!nt.frustumCulled||R.intersectsObject(nt))){bt&&J.setFromMatrixPosition(nt.matrixWorld).applyMatrix4(V);const Dt=_t.update(nt),N=nt.material;if(Array.isArray(N)){const kt=Dt.groups;for(let Rt=0,Ot=kt.length;Rt<Ot;Rt++){const Wt=kt[Rt],Bt=N[Wt.materialIndex];Bt&&Bt.visible&&h.push(nt,Dt,Bt,yt,J.z,Wt)}}else N.visible&&h.push(nt,Dt,N,yt,J.z,null)}}const Pt=nt.children;for(let Dt=0,N=Pt.length;Dt<N;Dt++)Ze(Pt[Dt],gt,yt,bt)}function ze(nt,gt,yt,bt){const st=nt.opaque,Pt=nt.transmissive,Dt=nt.transparent;m.setupLightsView(yt),Pt.length>0&&pe(st,gt,yt),bt&&q.viewport(w.copy(bt)),st.length>0&&$t(st,gt,yt),Pt.length>0&&$t(Pt,gt,yt),Dt.length>0&&$t(Dt,gt,yt),q.buffers.depth.setTest(!0),q.buffers.depth.setMask(!0),q.buffers.color.setMask(!0),q.setPolygonOffset(!1)}function pe(nt,gt,yt){const bt=j.isWebGL2;k===null&&(k=new on(1,1,{generateMipmaps:!0,type:$.has("EXT_color_buffer_half_float")?Ma:cs,minFilter:Lo,samples:bt&&s===!0?4:0})),d.getDrawingBufferSize(B),bt?k.setSize(B.x,B.y):k.setSize(Rr(B.x),Rr(B.y));const st=d.getRenderTarget();d.setRenderTarget(k),d.clear();const Pt=d.toneMapping;d.toneMapping=kn,$t(nt,gt,yt),d.toneMapping=Pt,U.updateMultisampleRenderTarget(k),U.updateRenderTargetMipmap(k),d.setRenderTarget(st)}function $t(nt,gt,yt){const bt=gt.isScene===!0?gt.overrideMaterial:null;for(let st=0,Pt=nt.length;st<Pt;st++){const Dt=nt[st],N=Dt.object,kt=Dt.geometry,Rt=bt===null?Dt.material:bt,Ot=Dt.group;N.layers.test(yt.layers)&&Ht(N,gt,yt,kt,Rt,Ot)}}function Ht(nt,gt,yt,bt,st,Pt){nt.onBeforeRender(d,gt,yt,bt,st,Pt),nt.modelViewMatrix.multiplyMatrices(yt.matrixWorldInverse,nt.matrixWorld),nt.normalMatrix.getNormalMatrix(nt.modelViewMatrix),st.onBeforeRender(d,gt,yt,bt,nt,Pt),st.transparent===!0&&st.side===Ns?(st.side=xn,st.needsUpdate=!0,d.renderBufferDirect(yt,gt,bt,st,nt,Pt),st.side=ba,st.needsUpdate=!0,d.renderBufferDirect(yt,gt,bt,st,nt,Pt),st.side=Ns):d.renderBufferDirect(yt,gt,bt,st,nt,Pt),nt.onAfterRender(d,gt,yt,bt,st,Pt)}function ue(nt,gt,yt){gt.isScene!==!0&&(gt=I);const bt=W.get(nt),st=m.state.lights,Pt=m.state.shadowsArray,Dt=st.state.version,N=mt.getParameters(nt,st.state,Pt,gt,yt),kt=mt.getProgramCacheKey(N);let Rt=bt.programs;bt.environment=nt.isMeshStandardMaterial?gt.environment:null,bt.fog=gt.fog,bt.envMap=(nt.isMeshStandardMaterial?Q:it).get(nt.envMap||bt.environment),Rt===void 0&&(nt.addEventListener("dispose",rt),Rt=new Map,bt.programs=Rt);let Ot=Rt.get(kt);if(Ot!==void 0){if(bt.currentProgram===Ot&&bt.lightsStateVersion===Dt)return Ie(nt,N),Ot}else N.uniforms=mt.getUniforms(nt),nt.onBuild(yt,N,d),nt.onBeforeCompile(N,d),Ot=mt.acquireProgram(N,kt),Rt.set(kt,Ot),bt.uniforms=N.uniforms;const Wt=bt.uniforms;(!nt.isShaderMaterial&&!nt.isRawShaderMaterial||nt.clipping===!0)&&(Wt.clippingPlanes=O.uniform),Ie(nt,N),bt.needsLights=Ut(nt),bt.lightsStateVersion=Dt,bt.needsLights&&(Wt.ambientLightColor.value=st.state.ambient,Wt.lightProbe.value=st.state.probe,Wt.directionalLights.value=st.state.directional,Wt.directionalLightShadows.value=st.state.directionalShadow,Wt.spotLights.value=st.state.spot,Wt.spotLightShadows.value=st.state.spotShadow,Wt.rectAreaLights.value=st.state.rectArea,Wt.ltc_1.value=st.state.rectAreaLTC1,Wt.ltc_2.value=st.state.rectAreaLTC2,Wt.pointLights.value=st.state.point,Wt.pointLightShadows.value=st.state.pointShadow,Wt.hemisphereLights.value=st.state.hemi,Wt.directionalShadowMap.value=st.state.directionalShadowMap,Wt.directionalShadowMatrix.value=st.state.directionalShadowMatrix,Wt.spotShadowMap.value=st.state.spotShadowMap,Wt.spotShadowMatrix.value=st.state.spotShadowMatrix,Wt.pointShadowMap.value=st.state.pointShadowMap,Wt.pointShadowMatrix.value=st.state.pointShadowMatrix);const Bt=Ot.getUniforms(),re=jn.seqWithValue(Bt.seq,Wt);return bt.currentProgram=Ot,bt.uniformsList=re,Ot}function Ie(nt,gt){const yt=W.get(nt);yt.outputEncoding=gt.outputEncoding,yt.instancing=gt.instancing,yt.skinning=gt.skinning,yt.morphTargets=gt.morphTargets,yt.morphNormals=gt.morphNormals,yt.morphColors=gt.morphColors,yt.morphTargetsCount=gt.morphTargetsCount,yt.numClippingPlanes=gt.numClippingPlanes,yt.numIntersection=gt.numClipIntersection,yt.vertexAlphas=gt.vertexAlphas,yt.vertexTangents=gt.vertexTangents,yt.toneMapping=gt.toneMapping}function qe(nt,gt,yt,bt,st){gt.isScene!==!0&&(gt=I),U.resetTextureUnits();const Pt=gt.fog,Dt=bt.isMeshStandardMaterial?gt.environment:null,N=x===null?d.outputEncoding:x.isXRRenderTarget===!0?x.texture.encoding:Jn,kt=(bt.isMeshStandardMaterial?Q:it).get(bt.envMap||Dt),Rt=bt.vertexColors===!0&&!!yt.attributes.color&&yt.attributes.color.itemSize===4,Ot=!!bt.normalMap&&!!yt.attributes.tangent,Wt=!!yt.morphAttributes.position,Bt=!!yt.morphAttributes.normal,re=!!yt.morphAttributes.color,Ce=bt.toneMapped?d.toneMapping:kn,be=yt.morphAttributes.position||yt.morphAttributes.normal||yt.morphAttributes.color,Tt=be!==void 0?be.length:0,Lt=W.get(bt),Zt=m.state.lights;if(E===!0&&(C===!0||nt!==Y)){const he=nt===Y&&bt.id===b;O.setState(bt,nt,he)}let me=!1;bt.version===Lt.__version?(Lt.needsLights&&Lt.lightsStateVersion!==Zt.state.version||Lt.outputEncoding!==N||st.isInstancedMesh&&Lt.instancing===!1||!st.isInstancedMesh&&Lt.instancing===!0||st.isSkinnedMesh&&Lt.skinning===!1||!st.isSkinnedMesh&&Lt.skinning===!0||Lt.envMap!==kt||bt.fog===!0&&Lt.fog!==Pt||Lt.numClippingPlanes!==void 0&&(Lt.numClippingPlanes!==O.numPlanes||Lt.numIntersection!==O.numIntersection)||Lt.vertexAlphas!==Rt||Lt.vertexTangents!==Ot||Lt.morphTargets!==Wt||Lt.morphNormals!==Bt||Lt.morphColors!==re||Lt.toneMapping!==Ce||j.isWebGL2===!0&&Lt.morphTargetsCount!==Tt)&&(me=!0):(me=!0,Lt.__version=bt.version);let Me=Lt.currentProgram;me===!0&&(Me=ue(bt,gt,st));let fe=!1,ti=!1,di=!1;const Le=Me.getUniforms(),_i=Lt.uniforms;if(q.useProgram(Me.program)&&(fe=!0,ti=!0,di=!0),bt.id!==b&&(b=bt.id,ti=!0),fe||Y!==nt){if(Le.setValue(D,"projectionMatrix",nt.projectionMatrix),j.logarithmicDepthBuffer&&Le.setValue(D,"logDepthBufFC",2/(Math.log(nt.far+1)/Math.LN2)),Y!==nt&&(Y=nt,ti=!0,di=!0),bt.isShaderMaterial||bt.isMeshPhongMaterial||bt.isMeshToonMaterial||bt.isMeshStandardMaterial||bt.envMap){const he=Le.map.cameraPosition;he!==void 0&&he.setValue(D,J.setFromMatrixPosition(nt.matrixWorld))}(bt.isMeshPhongMaterial||bt.isMeshToonMaterial||bt.isMeshLambertMaterial||bt.isMeshBasicMaterial||bt.isMeshStandardMaterial||bt.isShaderMaterial)&&Le.setValue(D,"isOrthographic",nt.isOrthographicCamera===!0),(bt.isMeshPhongMaterial||bt.isMeshToonMaterial||bt.isMeshLambertMaterial||bt.isMeshBasicMaterial||bt.isMeshStandardMaterial||bt.isShaderMaterial||bt.isShadowMaterial||st.isSkinnedMesh)&&Le.setValue(D,"viewMatrix",nt.matrixWorldInverse)}if(st.isSkinnedMesh){Le.setOptional(D,st,"bindMatrix"),Le.setOptional(D,st,"bindMatrixInverse");const he=st.skeleton;he&&(j.floatVertexTextures?(he.boneTexture===null&&he.computeBoneTexture(),Le.setValue(D,"boneTexture",he.boneTexture,U),Le.setValue(D,"boneTextureSize",he.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const yi=yt.morphAttributes;return(yi.position!==void 0||yi.normal!==void 0||yi.color!==void 0&&j.isWebGL2===!0)&&vt.update(st,yt,bt,Me),(ti||Lt.receiveShadow!==st.receiveShadow)&&(Lt.receiveShadow=st.receiveShadow,Le.setValue(D,"receiveShadow",st.receiveShadow)),ti&&(Le.setValue(D,"toneMappingExposure",d.toneMappingExposure),Lt.needsLights&&Ee(_i,di),Pt&&bt.fog===!0&&ft.refreshFogUniforms(_i,Pt),ft.refreshMaterialUniforms(_i,bt,T,z,k),jn.upload(D,Lt.uniformsList,_i,U)),bt.isShaderMaterial&&bt.uniformsNeedUpdate===!0&&(jn.upload(D,Lt.uniformsList,_i,U),bt.uniformsNeedUpdate=!1),bt.isSpriteMaterial&&Le.setValue(D,"center",st.center),Le.setValue(D,"modelViewMatrix",st.modelViewMatrix),Le.setValue(D,"normalMatrix",st.normalMatrix),Le.setValue(D,"modelMatrix",st.matrixWorld),Me}function Ee(nt,gt){nt.ambientLightColor.needsUpdate=gt,nt.lightProbe.needsUpdate=gt,nt.directionalLights.needsUpdate=gt,nt.directionalLightShadows.needsUpdate=gt,nt.pointLights.needsUpdate=gt,nt.pointLightShadows.needsUpdate=gt,nt.spotLights.needsUpdate=gt,nt.spotLightShadows.needsUpdate=gt,nt.rectAreaLights.needsUpdate=gt,nt.hemisphereLights.needsUpdate=gt}function Ut(nt){return nt.isMeshLambertMaterial||nt.isMeshToonMaterial||nt.isMeshPhongMaterial||nt.isMeshStandardMaterial||nt.isShadowMaterial||nt.isShaderMaterial&&nt.lights===!0}this.getActiveCubeFace=function(){return g},this.getActiveMipmapLevel=function(){return v},this.getRenderTarget=function(){return x},this.setRenderTargetTextures=function(nt,gt,yt){W.get(nt.texture).__webglTexture=gt,W.get(nt.depthTexture).__webglTexture=yt;const bt=W.get(nt);bt.__hasExternalTextures=!0,bt.__hasExternalTextures&&(bt.__autoAllocateDepthBuffer=yt===void 0,bt.__autoAllocateDepthBuffer||$.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),bt.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(nt,gt){const yt=W.get(nt);yt.__webglFramebuffer=gt,yt.__useDefaultFramebuffer=gt===void 0},this.setRenderTarget=function(nt,gt=0,yt=0){x=nt,g=gt,v=yt;let bt=!0;if(nt){const kt=W.get(nt);kt.__useDefaultFramebuffer!==void 0?(q.bindFramebuffer(36160,null),bt=!1):kt.__webglFramebuffer===void 0?U.setupRenderTarget(nt):kt.__hasExternalTextures&&U.rebindTextures(nt,W.get(nt.texture).__webglTexture,W.get(nt.depthTexture).__webglTexture)}let st=null,Pt=!1,Dt=!1;if(nt){const kt=nt.texture;(kt.isData3DTexture||kt.isDataArrayTexture)&&(Dt=!0);const Rt=W.get(nt).__webglFramebuffer;nt.isWebGLCubeRenderTarget?(st=Rt[gt],Pt=!0):j.isWebGL2&&nt.samples>0&&U.useMultisampledRTT(nt)===!1?st=W.get(nt).__webglMultisampledFramebuffer:st=Rt,w.copy(nt.viewport),Z.copy(nt.scissor),X=nt.scissorTest}else w.copy(A).multiplyScalar(T).floor(),Z.copy(L).multiplyScalar(T).floor(),X=S;if(q.bindFramebuffer(36160,st)&&j.drawBuffers&&bt&&q.drawBuffers(nt,st),q.viewport(w),q.scissor(Z),q.setScissorTest(X),Pt){const kt=W.get(nt.texture);D.framebufferTexture2D(36160,36064,34069+gt,kt.__webglTexture,yt)}else if(Dt){const kt=W.get(nt.texture),Rt=gt||0;D.framebufferTextureLayer(36160,36064,kt.__webglTexture,yt||0,Rt)}b=-1},this.readRenderTargetPixels=function(nt,gt,yt,bt,st,Pt,Dt){if(!(nt&&nt.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let N=W.get(nt).__webglFramebuffer;if(nt.isWebGLCubeRenderTarget&&Dt!==void 0&&(N=N[Dt]),N){q.bindFramebuffer(36160,N);try{const kt=nt.texture,Rt=kt.format,Ot=kt.type;if(Rt!==gn&&ct.convert(Rt)!==D.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Wt=Ot===Ma&&($.has("EXT_color_buffer_half_float")||j.isWebGL2&&$.has("EXT_color_buffer_float"));if(Ot!==cs&&ct.convert(Ot)!==D.getParameter(35738)&&!(Ot===rs&&(j.isWebGL2||$.has("OES_texture_float")||$.has("WEBGL_color_buffer_float")))&&!Wt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}gt>=0&&gt<=nt.width-bt&&yt>=0&&yt<=nt.height-st&&D.readPixels(gt,yt,bt,st,ct.convert(Rt),ct.convert(Ot),Pt)}finally{const kt=x!==null?W.get(x).__webglFramebuffer:null;q.bindFramebuffer(36160,kt)}}},this.copyFramebufferToTexture=function(nt,gt,yt=0){if(gt.isFramebufferTexture!==!0){console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");return}const bt=Math.pow(2,-yt),st=Math.floor(gt.image.width*bt),Pt=Math.floor(gt.image.height*bt);U.setTexture2D(gt,0),D.copyTexSubImage2D(3553,yt,0,0,nt.x,nt.y,st,Pt),q.unbindTexture()},this.copyTextureToTexture=function(nt,gt,yt,bt=0){const st=gt.image.width,Pt=gt.image.height,Dt=ct.convert(yt.format),N=ct.convert(yt.type);U.setTexture2D(yt,0),D.pixelStorei(37440,yt.flipY),D.pixelStorei(37441,yt.premultiplyAlpha),D.pixelStorei(3317,yt.unpackAlignment),gt.isDataTexture?D.texSubImage2D(3553,bt,nt.x,nt.y,st,Pt,Dt,N,gt.image.data):gt.isCompressedTexture?D.compressedTexSubImage2D(3553,bt,nt.x,nt.y,gt.mipmaps[0].width,gt.mipmaps[0].height,Dt,gt.mipmaps[0].data):D.texSubImage2D(3553,bt,nt.x,nt.y,Dt,N,gt.image),bt===0&&yt.generateMipmaps&&D.generateMipmap(3553),q.unbindTexture()},this.copyTextureToTexture3D=function(nt,gt,yt,bt,st=0){if(d.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const Pt=nt.max.x-nt.min.x+1,Dt=nt.max.y-nt.min.y+1,N=nt.max.z-nt.min.z+1,kt=ct.convert(bt.format),Rt=ct.convert(bt.type);let Ot;if(bt.isData3DTexture)U.setTexture3D(bt,0),Ot=32879;else if(bt.isDataArrayTexture)U.setTexture2DArray(bt,0),Ot=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}D.pixelStorei(37440,bt.flipY),D.pixelStorei(37441,bt.premultiplyAlpha),D.pixelStorei(3317,bt.unpackAlignment);const Wt=D.getParameter(3314),Bt=D.getParameter(32878),re=D.getParameter(3316),Ce=D.getParameter(3315),be=D.getParameter(32877),Tt=yt.isCompressedTexture?yt.mipmaps[0]:yt.image;D.pixelStorei(3314,Tt.width),D.pixelStorei(32878,Tt.height),D.pixelStorei(3316,nt.min.x),D.pixelStorei(3315,nt.min.y),D.pixelStorei(32877,nt.min.z),yt.isDataTexture||yt.isData3DTexture?D.texSubImage3D(Ot,st,gt.x,gt.y,gt.z,Pt,Dt,N,kt,Rt,Tt.data):yt.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),D.compressedTexSubImage3D(Ot,st,gt.x,gt.y,gt.z,Pt,Dt,N,kt,Tt.data)):D.texSubImage3D(Ot,st,gt.x,gt.y,gt.z,Pt,Dt,N,kt,Rt,Tt),D.pixelStorei(3314,Wt),D.pixelStorei(32878,Bt),D.pixelStorei(3316,re),D.pixelStorei(3315,Ce),D.pixelStorei(32877,be),st===0&&bt.generateMipmaps&&D.generateMipmap(Ot),q.unbindTexture()},this.initTexture=function(nt){U.setTexture2D(nt,0),q.unbindTexture()},this.resetState=function(){g=0,v=0,x=null,q.reset(),St.reset()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Ai.prototype.isWebGLRenderer=!0;class Lf extends Ai{}Lf.prototype.isWebGL1Renderer=!0;class el extends Li{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),e}}el.prototype.isScene=!0;class La{constructor(t,e){this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=wa,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Zn()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let n=0,s=this.stride;n<s;n++)this.array[t+n]=e.array[i+n];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Zn()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Zn()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}La.prototype.isInterleavedBuffer=!0;const Ki=new wt;class za{constructor(t,e,i,n=!1){this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=n===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)Ki.fromBufferAttribute(this,e),Ki.applyMatrix4(t),this.setXYZ(e,Ki.x,Ki.y,Ki.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)Ki.fromBufferAttribute(this,e),Ki.applyNormalMatrix(t),this.setXYZ(e,Ki.x,Ki.y,Ki.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)Ki.fromBufferAttribute(this,e),Ki.transformDirection(t),this.setXYZ(e,Ki.x,Ki.y,Ki.z);return this}setX(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this}setXYZW(t,e,i,n,s){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this.data.array[t+3]=s,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let i=0;i<this.count;i++){const n=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)e.push(this.data.array[n+s])}return new Ri(new this.array.constructor(e),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new za(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let i=0;i<this.count;i++){const n=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)e.push(this.data.array[n+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}za.prototype.isInterleavedBufferAttribute=!0;class il extends Oi{constructor(t){super(),this.type="SpriteMaterial",this.color=new fi(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}il.prototype.isSpriteMaterial=!0;let Ss;const la=new wt,Ls=new wt,As=new wt,Ts=new Fe,_a=new Fe,Th=new xi,to=new wt,ha=new wt,eo=new wt,V_=new Fe,Mr=new Fe,E_=new Fe;class Af extends Li{constructor(t){if(super(),this.type="Sprite",Ss===void 0){Ss=new Ti;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new La(e,5);Ss.setIndex([0,1,2,0,2,3]),Ss.setAttribute("position",new za(i,3,0,!1)),Ss.setAttribute("uv",new za(i,2,3,!1))}this.geometry=Ss,this.material=t!==void 0?t:new il,this.center=new Fe(.5,.5)}raycast(t,e){t.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ls.setFromMatrixScale(this.matrixWorld),Th.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),As.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Ls.multiplyScalar(-As.z);const i=this.material.rotation;let n,s;i!==0&&(s=Math.cos(i),n=Math.sin(i));const o=this.center;io(to.set(-.5,-.5,0),As,o,Ls,n,s),io(ha.set(.5,-.5,0),As,o,Ls,n,s),io(eo.set(.5,.5,0),As,o,Ls,n,s),V_.set(0,0),Mr.set(1,0),E_.set(1,1);let r=t.ray.intersectTriangle(to,ha,eo,!1,la);if(r===null&&(io(ha.set(-.5,.5,0),As,o,Ls,n,s),Mr.set(0,1),r=t.ray.intersectTriangle(to,eo,ha,!1,la),r===null))return;const _=t.ray.origin.distanceTo(la);_<t.near||_>t.far||e.push({distance:_,point:la.clone(),uv:Di.getUV(la,to,ha,eo,V_,Mr,E_,new Fe),face:null,object:this})}copy(t){return super.copy(t),t.center!==void 0&&this.center.copy(t.center),this.material=t.material,this}}Af.prototype.isSprite=!0;function io(c,t,e,i,n,s){Ts.subVectors(c,e).addScalar(.5).multiply(i),n!==void 0?(_a.x=s*Ts.x-n*Ts.y,_a.y=n*Ts.x+s*Ts.y):_a.copy(Ts),c.copy(t),c.x+=_a.x,c.y+=_a.y,c.applyMatrix4(Th)}const C_=new wt,P_=new Zi,R_=new Zi,Tf=new wt,k_=new xi;class Vh extends en{constructor(t,e){super(t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new xi,this.bindMatrixInverse=new xi}copy(t){return super.copy(t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Zi,e=this.geometry.attributes.skinWeight;for(let i=0,n=e.count;i<n;i++){t.fromBufferAttribute(e,i);const s=1/t.manhattanLength();s!==1/0?t.multiplyScalar(s):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,e){const i=this.skeleton,n=this.geometry;P_.fromBufferAttribute(n.attributes.skinIndex,t),R_.fromBufferAttribute(n.attributes.skinWeight,t),C_.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let s=0;s<4;s++){const o=R_.getComponent(s);if(o!==0){const r=P_.getComponent(s);k_.multiplyMatrices(i.bones[r].matrixWorld,i.boneInverses[r]),e.addScaledVector(Tf.copy(C_).applyMatrix4(k_),o)}}return e.applyMatrix4(this.bindMatrixInverse)}}Vh.prototype.isSkinnedMesh=!0;class Vf extends Li{constructor(){super(),this.type="Bone"}}Vf.prototype.isBone=!0;class Ef extends qi{constructor(t=null,e=1,i=1,n,s,o,r,_,a=Hi,l=Hi,h,m){super(null,o,r,_,a,l,n,s,h,m),this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Ef.prototype.isDataTexture=!0;class Br extends Ri{constructor(t,e,i,n=1){typeof i=="number"&&(n=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(t,e,i),this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}Br.prototype.isInstancedBufferAttribute=!0;const B_=new xi,D_=new xi,no=[],ca=new en;class Cf extends en{constructor(t,e,i){super(t,e),this.instanceMatrix=new Br(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(t){return super.copy(t),this.instanceMatrix.copy(t.instanceMatrix),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,t*16)}raycast(t,e){const i=this.matrixWorld,n=this.count;if(ca.geometry=this.geometry,ca.material=this.material,ca.material!==void 0)for(let s=0;s<n;s++){this.getMatrixAt(s,B_),D_.multiplyMatrices(i,B_),ca.matrixWorld=D_,ca.raycast(t,no);for(let o=0,r=no.length;o<r;o++){const _=no[o];_.instanceId=s,_.object=this,e.push(_)}no.length=0}}setColorAt(t,e){this.instanceColor===null&&(this.instanceColor=new Br(new Float32Array(this.instanceMatrix.count*3),3)),e.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,t*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}Cf.prototype.isInstancedMesh=!0;class Qs extends Oi{constructor(t){super(),this.type="LineBasicMaterial",this.color=new fi(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}Qs.prototype.isLineBasicMaterial=!0;const F_=new wt,N_=new wt,O_=new xi,wr=new Js,so=new qs;class nl extends Li{constructor(t=new Ti,e=new Qs){super(),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(t.index===null){const e=t.attributes.position,i=[0];for(let n=1,s=e.count;n<s;n++)F_.fromBufferAttribute(e,n-1),N_.fromBufferAttribute(e,n),i[n]=i[n-1],i[n]+=F_.distanceTo(N_);t.setAttribute("lineDistance",new ji(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,s=t.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),so.copy(i.boundingSphere),so.applyMatrix4(n),so.radius+=s,t.ray.intersectsSphere(so)===!1)return;O_.copy(n).invert(),wr.copy(t.ray).applyMatrix4(O_);const r=s/((this.scale.x+this.scale.y+this.scale.z)/3),_=r*r,a=new wt,l=new wt,h=new wt,m=new wt,f=this.isLineSegments?2:1;if(i.isBufferGeometry){const p=i.index,u=i.attributes.position;if(p!==null){const g=Math.max(0,o.start),v=Math.min(p.count,o.start+o.count);for(let x=g,b=v-1;x<b;x+=f){const Y=p.getX(x),w=p.getX(x+1);if(a.fromBufferAttribute(u,Y),l.fromBufferAttribute(u,w),wr.distanceSqToSegment(a,l,m,h)>_)continue;m.applyMatrix4(this.matrixWorld);const X=t.ray.origin.distanceTo(m);X<t.near||X>t.far||e.push({distance:X,point:h.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}else{const g=Math.max(0,o.start),v=Math.min(u.count,o.start+o.count);for(let x=g,b=v-1;x<b;x+=f){if(a.fromBufferAttribute(u,x),l.fromBufferAttribute(u,x+1),wr.distanceSqToSegment(a,l,m,h)>_)continue;m.applyMatrix4(this.matrixWorld);const w=t.ray.origin.distanceTo(m);w<t.near||w>t.far||e.push({distance:w,point:h.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const n=e[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=n.length;s<o;s++){const r=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=s}}}}else{const e=t.morphTargets;e!==void 0&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}nl.prototype.isLine=!0;const U_=new wt,G_=new wt;class sl extends nl{constructor(t,e){super(t,e),this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(t.index===null){const e=t.attributes.position,i=[];for(let n=0,s=e.count;n<s;n+=2)U_.fromBufferAttribute(e,n),G_.fromBufferAttribute(e,n+1),i[n]=n===0?0:i[n-1],i[n+1]=i[n]+U_.distanceTo(G_);t.setAttribute("lineDistance",new ji(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}sl.prototype.isLineSegments=!0;class Pf extends nl{constructor(t,e){super(t,e),this.type="LineLoop"}}Pf.prototype.isLineLoop=!0;class al extends Oi{constructor(t){super(),this.type="PointsMaterial",this.color=new fi(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}al.prototype.isPointsMaterial=!0;const H_=new xi,Dr=new Js,ao=new qs,oo=new wt;class Rf extends Li{constructor(t=new Ti,e=new al){super(),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,s=t.params.Points.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),ao.copy(i.boundingSphere),ao.applyMatrix4(n),ao.radius+=s,t.ray.intersectsSphere(ao)===!1)return;H_.copy(n).invert(),Dr.copy(t.ray).applyMatrix4(H_);const r=s/((this.scale.x+this.scale.y+this.scale.z)/3),_=r*r;if(i.isBufferGeometry){const a=i.index,h=i.attributes.position;if(a!==null){const m=Math.max(0,o.start),f=Math.min(a.count,o.start+o.count);for(let p=m,d=f;p<d;p++){const u=a.getX(p);oo.fromBufferAttribute(h,u),W_(oo,u,_,n,t,e,this)}}else{const m=Math.max(0,o.start),f=Math.min(h.count,o.start+o.count);for(let p=m,d=f;p<d;p++)oo.fromBufferAttribute(h,p),W_(oo,p,_,n,t,e,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const n=e[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=n.length;s<o;s++){const r=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=s}}}}else{const e=t.morphTargets;e!==void 0&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Rf.prototype.isPoints=!0;function W_(c,t,e,i,n,s,o){const r=Dr.distanceSqToPoint(c);if(r<e){const _=new wt;Dr.closestPointToPoint(c,_),_.applyMatrix4(i);const a=n.ray.origin.distanceTo(_);if(a<n.near||a>n.far)return;s.push({distance:a,distanceToRay:Math.sqrt(r),point:_,index:t,face:null,object:o})}}class kf extends qi{constructor(t,e,i,n,s,o,r,_,a){super(t,e,i,n,s,o,r,_,a),this.minFilter=o!==void 0?o:an,this.magFilter=s!==void 0?s:an,this.generateMipmaps=!1;const l=this;function h(){l.needsUpdate=!0,t.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(h)}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;"requestVideoFrameCallback"in t===!1&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}kf.prototype.isVideoTexture=!0;class Bf extends qi{constructor(t,e,i){super({width:t,height:e}),this.format=i,this.magFilter=Hi,this.minFilter=Hi,this.generateMipmaps=!1,this.needsUpdate=!0}}Bf.prototype.isFramebufferTexture=!0;class Df extends qi{constructor(t,e,i,n,s,o,r,_,a,l,h,m){super(null,o,r,_,a,l,n,s,h,m),this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}Df.prototype.isCompressedTexture=!0;class Ff extends qi{constructor(t,e,i,n,s,o,r,_,a){super(t,e,i,n,s,o,r,_,a),this.needsUpdate=!0}}Ff.prototype.isCanvasTexture=!0;class cn{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const i=this.getUtoTmapping(t);return this.getPoint(i,e)}getPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e}getSpacedPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let i,n=this.getPoint(0),s=0;e.push(0);for(let o=1;o<=t;o++)i=this.getPoint(o/t),s+=i.distanceTo(n),e.push(s),n=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const i=this.getLengths();let n=0;const s=i.length;let o;e?o=e:o=t*i[s-1];let r=0,_=s-1,a;for(;r<=_;)if(n=Math.floor(r+(_-r)/2),a=i[n]-o,a<0)r=n+1;else if(a>0)_=n-1;else{_=n;break}if(n=_,i[n]===o)return n/(s-1);const l=i[n],m=i[n+1]-l,f=(o-l)/m;return(n+f)/(s-1)}getTangent(t,e){let n=t-1e-4,s=t+1e-4;n<0&&(n=0),s>1&&(s=1);const o=this.getPoint(n),r=this.getPoint(s),_=e||(o.isVector2?new Fe:new wt);return _.copy(r).sub(o).normalize(),_}getTangentAt(t,e){const i=this.getUtoTmapping(t);return this.getTangent(i,e)}computeFrenetFrames(t,e){const i=new wt,n=[],s=[],o=[],r=new wt,_=new xi;for(let f=0;f<=t;f++){const p=f/t;n[f]=this.getTangentAt(p,new wt)}s[0]=new wt,o[0]=new wt;let a=Number.MAX_VALUE;const l=Math.abs(n[0].x),h=Math.abs(n[0].y),m=Math.abs(n[0].z);l<=a&&(a=l,i.set(1,0,0)),h<=a&&(a=h,i.set(0,1,0)),m<=a&&i.set(0,0,1),r.crossVectors(n[0],i).normalize(),s[0].crossVectors(n[0],r),o[0].crossVectors(n[0],s[0]);for(let f=1;f<=t;f++){if(s[f]=s[f-1].clone(),o[f]=o[f-1].clone(),r.crossVectors(n[f-1],n[f]),r.length()>Number.EPSILON){r.normalize();const p=Math.acos(Qi(n[f-1].dot(n[f]),-1,1));s[f].applyMatrix4(_.makeRotationAxis(r,p))}o[f].crossVectors(n[f],s[f])}if(e===!0){let f=Math.acos(Qi(s[0].dot(s[t]),-1,1));f/=t,n[0].dot(r.crossVectors(s[0],s[t]))>0&&(f=-f);for(let p=1;p<=t;p++)s[p].applyMatrix4(_.makeRotationAxis(n[p],f*p)),o[p].crossVectors(n[p],s[p])}return{tangents:n,normals:s,binormals:o}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class Ro extends cn{constructor(t=0,e=0,i=1,n=1,s=0,o=Math.PI*2,r=!1,_=0){super(),this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=n,this.aStartAngle=s,this.aEndAngle=o,this.aClockwise=r,this.aRotation=_}getPoint(t,e){const i=e||new Fe,n=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const o=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=n;for(;s>n;)s-=n;s<Number.EPSILON&&(o?s=0:s=n),this.aClockwise===!0&&!o&&(s===n?s=-n:s=s-n);const r=this.aStartAngle+t*s;let _=this.aX+this.xRadius*Math.cos(r),a=this.aY+this.yRadius*Math.sin(r);if(this.aRotation!==0){const l=Math.cos(this.aRotation),h=Math.sin(this.aRotation),m=_-this.aX,f=a-this.aY;_=m*l-f*h+this.aX,a=m*h+f*l+this.aY}return i.set(_,a)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}Ro.prototype.isEllipseCurve=!0;class Eh extends Ro{constructor(t,e,i,n,s,o){super(t,e,i,i,n,s,o),this.type="ArcCurve"}}Eh.prototype.isArcCurve=!0;function ol(){let c=0,t=0,e=0,i=0;function n(s,o,r,_){c=s,t=r,e=-3*s+3*o-2*r-_,i=2*s-2*o+r+_}return{initCatmullRom:function(s,o,r,_,a){n(o,r,a*(r-s),a*(_-o))},initNonuniformCatmullRom:function(s,o,r,_,a,l,h){let m=(o-s)/a-(r-s)/(a+l)+(r-o)/l,f=(r-o)/l-(_-o)/(l+h)+(_-r)/h;m*=l,f*=l,n(o,r,m,f)},calc:function(s){const o=s*s,r=o*s;return c+t*s+e*o+i*r}}}const ro=new wt,Xr=new ol,zr=new ol,Ir=new ol;class Ch extends cn{constructor(t=[],e=!1,i="centripetal",n=.5){super(),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=i,this.tension=n}getPoint(t,e=new wt){const i=e,n=this.points,s=n.length,o=(s-(this.closed?0:1))*t;let r=Math.floor(o),_=o-r;this.closed?r+=r>0?0:(Math.floor(Math.abs(r)/s)+1)*s:_===0&&r===s-1&&(r=s-2,_=1);let a,l;this.closed||r>0?a=n[(r-1)%s]:(ro.subVectors(n[0],n[1]).add(n[0]),a=ro);const h=n[r%s],m=n[(r+1)%s];if(this.closed||r+2<s?l=n[(r+2)%s]:(ro.subVectors(n[s-1],n[s-2]).add(n[s-1]),l=ro),this.curveType==="centripetal"||this.curveType==="chordal"){const f=this.curveType==="chordal"?.5:.25;let p=Math.pow(a.distanceToSquared(h),f),d=Math.pow(h.distanceToSquared(m),f),u=Math.pow(m.distanceToSquared(l),f);d<1e-4&&(d=1),p<1e-4&&(p=d),u<1e-4&&(u=d),Xr.initNonuniformCatmullRom(a.x,h.x,m.x,l.x,p,d,u),zr.initNonuniformCatmullRom(a.y,h.y,m.y,l.y,p,d,u),Ir.initNonuniformCatmullRom(a.z,h.z,m.z,l.z,p,d,u)}else this.curveType==="catmullrom"&&(Xr.initCatmullRom(a.x,h.x,m.x,l.x,this.tension),zr.initCatmullRom(a.y,h.y,m.y,l.y,this.tension),Ir.initCatmullRom(a.z,h.z,m.z,l.z,this.tension));return i.set(Xr.calc(_),zr.calc(_),Ir.calc(_)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const n=t.points[e];this.points.push(new wt().fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}Ch.prototype.isCatmullRomCurve3=!0;function j_(c,t,e,i,n){const s=(i-t)*.5,o=(n-e)*.5,r=c*c,_=c*r;return(2*e-2*i+s+o)*_+(-3*e+3*i-2*s-o)*r+s*c+e}function Nf(c,t){const e=1-c;return e*e*t}function Of(c,t){return 2*(1-c)*c*t}function Uf(c,t){return c*c*t}function da(c,t,e,i){return Nf(c,t)+Of(c,e)+Uf(c,i)}function Gf(c,t){const e=1-c;return e*e*e*t}function Hf(c,t){const e=1-c;return 3*e*e*c*t}function Wf(c,t){return 3*(1-c)*c*c*t}function jf(c,t){return c*c*c*t}function ga(c,t,e,i,n){return Gf(c,t)+Hf(c,e)+Wf(c,i)+jf(c,n)}class rl extends cn{constructor(t=new Fe,e=new Fe,i=new Fe,n=new Fe){super(),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new Fe){const i=e,n=this.v0,s=this.v1,o=this.v2,r=this.v3;return i.set(ga(t,n.x,s.x,o.x,r.x),ga(t,n.y,s.y,o.y,r.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}rl.prototype.isCubicBezierCurve=!0;class Ph extends cn{constructor(t=new wt,e=new wt,i=new wt,n=new wt){super(),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new wt){const i=e,n=this.v0,s=this.v1,o=this.v2,r=this.v3;return i.set(ga(t,n.x,s.x,o.x,r.x),ga(t,n.y,s.y,o.y,r.y),ga(t,n.z,s.z,o.z,r.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Ph.prototype.isCubicBezierCurve3=!0;class ko extends cn{constructor(t=new Fe,e=new Fe){super(),this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Fe){const i=e;return t===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const i=e||new Fe;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}ko.prototype.isLineCurve=!0;class qf extends cn{constructor(t=new wt,e=new wt){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=t,this.v2=e}getPoint(t,e=new wt){const i=e;return t===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class ll extends cn{constructor(t=new Fe,e=new Fe,i=new Fe){super(),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new Fe){const i=e,n=this.v0,s=this.v1,o=this.v2;return i.set(da(t,n.x,s.x,o.x),da(t,n.y,s.y,o.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}ll.prototype.isQuadraticBezierCurve=!0;class Rh extends cn{constructor(t=new wt,e=new wt,i=new wt){super(),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new wt){const i=e,n=this.v0,s=this.v1,o=this.v2;return i.set(da(t,n.x,s.x,o.x),da(t,n.y,s.y,o.y),da(t,n.z,s.z,o.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Rh.prototype.isQuadraticBezierCurve3=!0;class _l extends cn{constructor(t=[]){super(),this.type="SplineCurve",this.points=t}getPoint(t,e=new Fe){const i=e,n=this.points,s=(n.length-1)*t,o=Math.floor(s),r=s-o,_=n[o===0?o:o-1],a=n[o],l=n[o>n.length-2?n.length-1:o+1],h=n[o>n.length-3?n.length-1:o+2];return i.set(j_(r,_.x,a.x,l.x,h.x),j_(r,_.y,a.y,l.y,h.y)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const n=t.points[e];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const n=this.points[e];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const n=t.points[e];this.points.push(new Fe().fromArray(n))}return this}}_l.prototype.isSplineCurve=!0;var kh=Object.freeze({__proto__:null,ArcCurve:Eh,CatmullRomCurve3:Ch,CubicBezierCurve:rl,CubicBezierCurve3:Ph,EllipseCurve:Ro,LineCurve:ko,LineCurve3:qf,QuadraticBezierCurve:ll,QuadraticBezierCurve3:Rh,SplineCurve:_l});class Jf extends cn{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new ko(e,t))}getPoint(t,e){const i=t*this.getLength(),n=this.getCurveLengths();let s=0;for(;s<n.length;){if(n[s]>=i){const o=n[s]-i,r=this.curves[s],_=r.getLength(),a=_===0?0:1-o/_;return r.getPointAt(a,e)}s++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let i=0,n=this.curves.length;i<n;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let i;for(let n=0,s=this.curves;n<s.length;n++){const o=s[n],r=o.isEllipseCurve?t*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?t*o.points.length:t,_=o.getPoints(r);for(let a=0;a<_.length;a++){const l=_[a];i&&i.equals(l)||(e.push(l),i=l)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,i=this.curves.length;e<i;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const n=t.curves[e];this.curves.push(new kh[n.type]().fromJSON(n))}return this}}class Fr extends Jf{constructor(t){super(),this.type="Path",this.currentPoint=new Fe,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const i=new ko(this.currentPoint.clone(),new Fe(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,i,n){const s=new ll(this.currentPoint.clone(),new Fe(t,e),new Fe(i,n));return this.curves.push(s),this.currentPoint.set(i,n),this}bezierCurveTo(t,e,i,n,s,o){const r=new rl(this.currentPoint.clone(),new Fe(t,e),new Fe(i,n),new Fe(s,o));return this.curves.push(r),this.currentPoint.set(s,o),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),i=new _l(e);return this.curves.push(i),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,i,n,s,o){const r=this.currentPoint.x,_=this.currentPoint.y;return this.absarc(t+r,e+_,i,n,s,o),this}absarc(t,e,i,n,s,o){return this.absellipse(t,e,i,i,n,s,o),this}ellipse(t,e,i,n,s,o,r,_){const a=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(t+a,e+l,i,n,s,o,r,_),this}absellipse(t,e,i,n,s,o,r,_){const a=new Ro(t,e,i,n,s,o,r,_);if(this.curves.length>0){const h=a.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(a);const l=a.getPoint(1);return this.currentPoint.copy(l),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}new wt;new wt;new wt;new Di;class Aa extends Fr{constructor(t){super(t),this.uuid=Zn(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let i=0,n=this.holes.length;i<n;i++)e[i]=this.holes[i].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const n=t.holes[e];this.holes.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,i=this.holes.length;e<i;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const n=t.holes[e];this.holes.push(new Fr().fromJSON(n))}return this}}const $f={triangulate:function(c,t,e=2){const i=t&&t.length,n=i?t[0]*e:c.length;let s=Bh(c,0,n,e,!0);const o=[];if(!s||s.next===s.prev)return o;let r,_,a,l,h,m,f;if(i&&(s=id(c,t,s,e)),c.length>80*e){r=a=c[0],_=l=c[1];for(let p=e;p<n;p+=e)h=c[p],m=c[p+1],h<r&&(r=h),m<_&&(_=m),h>a&&(a=h),m>l&&(l=m);f=Math.max(a-r,l-_),f=f!==0?1/f:0}return Ia(s,o,e,r,_,f),o}};function Bh(c,t,e,i,n){let s,o;if(n===md(c,t,e,i)>0)for(s=t;s<e;s+=i)o=q_(s,c[s],c[s+1],o);else for(s=e-i;s>=t;s-=i)o=q_(s,c[s],c[s+1],o);return o&&Bo(o,o.next)&&(Za(o),o=o.next),o}function $n(c,t){if(!c)return c;t||(t=c);let e=c,i;do if(i=!1,!e.steiner&&(Bo(e,e.next)||Ci(e.prev,e,e.next)===0)){if(Za(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function Ia(c,t,e,i,n,s,o){if(!c)return;!o&&s&&rd(c,i,n,s);let r=c,_,a;for(;c.prev!==c.next;){if(_=c.prev,a=c.next,s?Kf(c,i,n,s):Qf(c)){t.push(_.i/e),t.push(c.i/e),t.push(a.i/e),Za(c),c=a.next,r=a.next;continue}if(c=a,c===r){o?o===1?(c=td($n(c),t,e),Ia(c,t,e,i,n,s,2)):o===2&&ed(c,t,e,i,n,s):Ia($n(c),t,e,i,n,s,1);break}}}function Qf(c){const t=c.prev,e=c,i=c.next;if(Ci(t,e,i)>=0)return!1;let n=c.next.next;for(;n!==c.prev;){if(ks(t.x,t.y,e.x,e.y,i.x,i.y,n.x,n.y)&&Ci(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function Kf(c,t,e,i){const n=c.prev,s=c,o=c.next;if(Ci(n,s,o)>=0)return!1;const r=n.x<s.x?n.x<o.x?n.x:o.x:s.x<o.x?s.x:o.x,_=n.y<s.y?n.y<o.y?n.y:o.y:s.y<o.y?s.y:o.y,a=n.x>s.x?n.x>o.x?n.x:o.x:s.x>o.x?s.x:o.x,l=n.y>s.y?n.y>o.y?n.y:o.y:s.y>o.y?s.y:o.y,h=Nr(r,_,t,e,i),m=Nr(a,l,t,e,i);let f=c.prevZ,p=c.nextZ;for(;f&&f.z>=h&&p&&p.z<=m;){if(f!==c.prev&&f!==c.next&&ks(n.x,n.y,s.x,s.y,o.x,o.y,f.x,f.y)&&Ci(f.prev,f,f.next)>=0||(f=f.prevZ,p!==c.prev&&p!==c.next&&ks(n.x,n.y,s.x,s.y,o.x,o.y,p.x,p.y)&&Ci(p.prev,p,p.next)>=0))return!1;p=p.nextZ}for(;f&&f.z>=h;){if(f!==c.prev&&f!==c.next&&ks(n.x,n.y,s.x,s.y,o.x,o.y,f.x,f.y)&&Ci(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=m;){if(p!==c.prev&&p!==c.next&&ks(n.x,n.y,s.x,s.y,o.x,o.y,p.x,p.y)&&Ci(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function td(c,t,e){let i=c;do{const n=i.prev,s=i.next.next;!Bo(n,s)&&Dh(n,i,i.next,s)&&Ya(n,s)&&Ya(s,n)&&(t.push(n.i/e),t.push(i.i/e),t.push(s.i/e),Za(i),Za(i.next),i=c=s),i=i.next}while(i!==c);return $n(i)}function ed(c,t,e,i,n,s){let o=c;do{let r=o.next.next;for(;r!==o.prev;){if(o.i!==r.i&&hd(o,r)){let _=Fh(o,r);o=$n(o,o.next),_=$n(_,_.next),Ia(o,t,e,i,n,s),Ia(_,t,e,i,n,s);return}r=r.next}o=o.next}while(o!==c)}function id(c,t,e,i){const n=[];let s,o,r,_,a;for(s=0,o=t.length;s<o;s++)r=t[s]*i,_=s<o-1?t[s+1]*i:c.length,a=Bh(c,r,_,i,!1),a===a.next&&(a.steiner=!0),n.push(_d(a));for(n.sort(nd),s=0;s<n.length;s++)sd(n[s],e),e=$n(e,e.next);return e}function nd(c,t){return c.x-t.x}function sd(c,t){if(t=ad(c,t),t){const e=Fh(t,c);$n(t,t.next),$n(e,e.next)}}function ad(c,t){let e=t;const i=c.x,n=c.y;let s=-1/0,o;do{if(n<=e.y&&n>=e.next.y&&e.next.y!==e.y){const m=e.x+(n-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(m<=i&&m>s){if(s=m,m===i){if(n===e.y)return e;if(n===e.next.y)return e.next}o=e.x<e.next.x?e:e.next}}e=e.next}while(e!==t);if(!o)return null;if(i===s)return o;const r=o,_=o.x,a=o.y;let l=1/0,h;e=o;do i>=e.x&&e.x>=_&&i!==e.x&&ks(n<a?i:s,n,_,a,n<a?s:i,n,e.x,e.y)&&(h=Math.abs(n-e.y)/(i-e.x),Ya(e,c)&&(h<l||h===l&&(e.x>o.x||e.x===o.x&&od(o,e)))&&(o=e,l=h)),e=e.next;while(e!==r);return o}function od(c,t){return Ci(c.prev,c,t.prev)<0&&Ci(t.next,c,c.next)<0}function rd(c,t,e,i){let n=c;do n.z===null&&(n.z=Nr(n.x,n.y,t,e,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==c);n.prevZ.nextZ=null,n.prevZ=null,ld(n)}function ld(c){let t,e,i,n,s,o,r,_,a=1;do{for(e=c,c=null,s=null,o=0;e;){for(o++,i=e,r=0,t=0;t<a&&(r++,i=i.nextZ,!!i);t++);for(_=a;r>0||_>0&&i;)r!==0&&(_===0||!i||e.z<=i.z)?(n=e,e=e.nextZ,r--):(n=i,i=i.nextZ,_--),s?s.nextZ=n:c=n,n.prevZ=s,s=n;e=i}s.nextZ=null,a*=2}while(o>1);return c}function Nr(c,t,e,i,n){return c=32767*(c-e)*n,t=32767*(t-i)*n,c=(c|c<<8)&16711935,c=(c|c<<4)&252645135,c=(c|c<<2)&858993459,c=(c|c<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,c|t<<1}function _d(c){let t=c,e=c;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==c);return e}function ks(c,t,e,i,n,s,o,r){return(n-o)*(t-r)-(c-o)*(s-r)>=0&&(c-o)*(i-r)-(e-o)*(t-r)>=0&&(e-o)*(s-r)-(n-o)*(i-r)>=0}function hd(c,t){return c.next.i!==t.i&&c.prev.i!==t.i&&!cd(c,t)&&(Ya(c,t)&&Ya(t,c)&&pd(c,t)&&(Ci(c.prev,c,t.prev)||Ci(c,t.prev,t))||Bo(c,t)&&Ci(c.prev,c,c.next)>0&&Ci(t.prev,t,t.next)>0)}function Ci(c,t,e){return(t.y-c.y)*(e.x-t.x)-(t.x-c.x)*(e.y-t.y)}function Bo(c,t){return c.x===t.x&&c.y===t.y}function Dh(c,t,e,i){const n=_o(Ci(c,t,e)),s=_o(Ci(c,t,i)),o=_o(Ci(e,i,c)),r=_o(Ci(e,i,t));return!!(n!==s&&o!==r||n===0&&lo(c,e,t)||s===0&&lo(c,i,t)||o===0&&lo(e,c,i)||r===0&&lo(e,t,i))}function lo(c,t,e){return t.x<=Math.max(c.x,e.x)&&t.x>=Math.min(c.x,e.x)&&t.y<=Math.max(c.y,e.y)&&t.y>=Math.min(c.y,e.y)}function _o(c){return c>0?1:c<0?-1:0}function cd(c,t){let e=c;do{if(e.i!==c.i&&e.next.i!==c.i&&e.i!==t.i&&e.next.i!==t.i&&Dh(e,e.next,c,t))return!0;e=e.next}while(e!==c);return!1}function Ya(c,t){return Ci(c.prev,c,c.next)<0?Ci(c,t,c.next)>=0&&Ci(c,c.prev,t)>=0:Ci(c,t,c.prev)<0||Ci(c,c.next,t)<0}function pd(c,t){let e=c,i=!1;const n=(c.x+t.x)/2,s=(c.y+t.y)/2;do e.y>s!=e.next.y>s&&e.next.y!==e.y&&n<(e.next.x-e.x)*(s-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==c);return i}function Fh(c,t){const e=new Or(c.i,c.x,c.y),i=new Or(t.i,t.x,t.y),n=c.next,s=t.prev;return c.next=t,t.prev=c,e.next=n,n.prev=e,i.next=e,e.prev=i,s.next=i,i.prev=s,i}function q_(c,t,e,i){const n=new Or(c,t,e);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Za(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function Or(c,t,e){this.i=c,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function md(c,t,e,i){let n=0;for(let s=t,o=e-i;s<e;s+=i)n+=(c[o]-c[s])*(c[s+1]+c[o+1]),o=s;return n}class qn{static area(t){const e=t.length;let i=0;for(let n=e-1,s=0;s<e;n=s++)i+=t[n].x*t[s].y-t[s].x*t[n].y;return i*.5}static isClockWise(t){return qn.area(t)<0}static triangulateShape(t,e){const i=[],n=[],s=[];J_(t),$_(i,t);let o=t.length;e.forEach(J_);for(let _=0;_<e.length;_++)n.push(o),o+=e[_].length,$_(i,e[_]);const r=$f.triangulate(i,n);for(let _=0;_<r.length;_+=3)s.push(r.slice(_,_+3));return s}}function J_(c){const t=c.length;t>2&&c[t-1].equals(c[0])&&c.pop()}function $_(c,t){for(let e=0;e<t.length;e++)c.push(t[e].x),c.push(t[e].y)}class Ks extends Ti{constructor(t=new Aa([new Fe(.5,.5),new Fe(-.5,.5),new Fe(-.5,-.5),new Fe(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const i=this,n=[],s=[];for(let r=0,_=t.length;r<_;r++){const a=t[r];o(a)}this.setAttribute("position",new ji(n,3)),this.setAttribute("uv",new ji(s,2)),this.computeVertexNormals();function o(r){const _=[],a=e.curveSegments!==void 0?e.curveSegments:12,l=e.steps!==void 0?e.steps:1;let h=e.depth!==void 0?e.depth:1,m=e.bevelEnabled!==void 0?e.bevelEnabled:!0,f=e.bevelThickness!==void 0?e.bevelThickness:.2,p=e.bevelSize!==void 0?e.bevelSize:f-.1,d=e.bevelOffset!==void 0?e.bevelOffset:0,u=e.bevelSegments!==void 0?e.bevelSegments:3;const g=e.extrudePath,v=e.UVGenerator!==void 0?e.UVGenerator:ud;e.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),h=e.amount);let x,b=!1,Y,w,Z,X;g&&(x=g.getSpacedPoints(l),b=!0,m=!1,Y=g.computeFrenetFrames(l,!1),w=new wt,Z=new wt,X=new wt),m||(u=0,f=0,p=0,d=0);const M=r.extractPoints(a);let z=M.shape;const T=M.holes;if(!qn.isClockWise(z)){z=z.reverse();for(let W=0,U=T.length;W<U;W++){const it=T[W];qn.isClockWise(it)&&(T[W]=it.reverse())}}const P=qn.triangulateShape(z,T),A=z;for(let W=0,U=T.length;W<U;W++){const it=T[W];z=z.concat(it)}function L(W,U,it){return U||console.error("THREE.ExtrudeGeometry: vec does not exist"),U.clone().multiplyScalar(it).add(W)}const S=z.length,R=P.length;function E(W,U,it){let Q,at,ht;const _t=W.x-U.x,mt=W.y-U.y,ft=it.x-W.x,ut=it.y-W.y,H=_t*_t+mt*mt,O=_t*ut-mt*ft;if(Math.abs(O)>Number.EPSILON){const ot=Math.sqrt(H),pt=Math.sqrt(ft*ft+ut*ut),vt=U.x-mt/ot,xt=U.y+_t/ot,Mt=it.x-ut/pt,ct=it.y+ft/pt,St=((Mt-vt)*ut-(ct-xt)*ft)/(_t*ut-mt*ft);Q=vt+_t*St-W.x,at=xt+mt*St-W.y;const It=Q*Q+at*at;if(It<=2)return new Fe(Q,at);ht=Math.sqrt(It/2)}else{let ot=!1;_t>Number.EPSILON?ft>Number.EPSILON&&(ot=!0):_t<-Number.EPSILON?ft<-Number.EPSILON&&(ot=!0):Math.sign(mt)===Math.sign(ut)&&(ot=!0),ot?(Q=-mt,at=_t,ht=Math.sqrt(H)):(Q=_t,at=mt,ht=Math.sqrt(H/2))}return new Fe(Q/ht,at/ht)}const C=[];for(let W=0,U=A.length,it=U-1,Q=W+1;W<U;W++,it++,Q++)it===U&&(it=0),Q===U&&(Q=0),C[W]=E(A[W],A[it],A[Q]);const k=[];let V,B=C.concat();for(let W=0,U=T.length;W<U;W++){const it=T[W];V=[];for(let Q=0,at=it.length,ht=at-1,_t=Q+1;Q<at;Q++,ht++,_t++)ht===at&&(ht=0),_t===at&&(_t=0),V[Q]=E(it[Q],it[ht],it[_t]);k.push(V),B=B.concat(V)}for(let W=0;W<u;W++){const U=W/u,it=f*Math.cos(U*Math.PI/2),Q=p*Math.sin(U*Math.PI/2)+d;for(let at=0,ht=A.length;at<ht;at++){const _t=L(A[at],C[at],Q);et(_t.x,_t.y,-it)}for(let at=0,ht=T.length;at<ht;at++){const _t=T[at];V=k[at];for(let mt=0,ft=_t.length;mt<ft;mt++){const ut=L(_t[mt],V[mt],Q);et(ut.x,ut.y,-it)}}}const J=p+d;for(let W=0;W<S;W++){const U=m?L(z[W],B[W],J):z[W];b?(Z.copy(Y.normals[0]).multiplyScalar(U.x),w.copy(Y.binormals[0]).multiplyScalar(U.y),X.copy(x[0]).add(Z).add(w),et(X.x,X.y,X.z)):et(U.x,U.y,0)}for(let W=1;W<=l;W++)for(let U=0;U<S;U++){const it=m?L(z[U],B[U],J):z[U];b?(Z.copy(Y.normals[W]).multiplyScalar(it.x),w.copy(Y.binormals[W]).multiplyScalar(it.y),X.copy(x[W]).add(Z).add(w),et(X.x,X.y,X.z)):et(it.x,it.y,h/l*W)}for(let W=u-1;W>=0;W--){const U=W/u,it=f*Math.cos(U*Math.PI/2),Q=p*Math.sin(U*Math.PI/2)+d;for(let at=0,ht=A.length;at<ht;at++){const _t=L(A[at],C[at],Q);et(_t.x,_t.y,h+it)}for(let at=0,ht=T.length;at<ht;at++){const _t=T[at];V=k[at];for(let mt=0,ft=_t.length;mt<ft;mt++){const ut=L(_t[mt],V[mt],Q);b?et(ut.x,ut.y+x[l-1].y,x[l-1].x+it):et(ut.x,ut.y,h+it)}}}I(),G();function I(){const W=n.length/3;if(m){let U=0,it=S*U;for(let Q=0;Q<R;Q++){const at=P[Q];$(at[2]+it,at[1]+it,at[0]+it)}U=l+u*2,it=S*U;for(let Q=0;Q<R;Q++){const at=P[Q];$(at[0]+it,at[1]+it,at[2]+it)}}else{for(let U=0;U<R;U++){const it=P[U];$(it[2],it[1],it[0])}for(let U=0;U<R;U++){const it=P[U];$(it[0]+S*l,it[1]+S*l,it[2]+S*l)}}i.addGroup(W,n.length/3-W,0)}function G(){const W=n.length/3;let U=0;D(A,U),U+=A.length;for(let it=0,Q=T.length;it<Q;it++){const at=T[it];D(at,U),U+=at.length}i.addGroup(W,n.length/3-W,1)}function D(W,U){let it=W.length;for(;--it>=0;){const Q=it;let at=it-1;at<0&&(at=W.length-1);for(let ht=0,_t=l+u*2;ht<_t;ht++){const mt=S*ht,ft=S*(ht+1),ut=U+Q+mt,H=U+at+mt,O=U+at+ft,ot=U+Q+ft;j(ut,H,O,ot)}}}function et(W,U,it){_.push(W),_.push(U),_.push(it)}function $(W,U,it){q(W),q(U),q(it);const Q=n.length/3,at=v.generateTopUV(i,n,Q-3,Q-2,Q-1);tt(at[0]),tt(at[1]),tt(at[2])}function j(W,U,it,Q){q(W),q(U),q(Q),q(U),q(it),q(Q);const at=n.length/3,ht=v.generateSideWallUV(i,n,at-6,at-3,at-2,at-1);tt(ht[0]),tt(ht[1]),tt(ht[3]),tt(ht[1]),tt(ht[2]),tt(ht[3])}function q(W){n.push(_[W*3+0]),n.push(_[W*3+1]),n.push(_[W*3+2])}function tt(W){s.push(W.x),s.push(W.y)}}}toJSON(){const t=super.toJSON(),e=this.parameters.shapes,i=this.parameters.options;return fd(e,i,t)}static fromJSON(t,e){const i=[];for(let s=0,o=t.shapes.length;s<o;s++){const r=e[t.shapes[s]];i.push(r)}const n=t.options.extrudePath;return n!==void 0&&(t.options.extrudePath=new kh[n.type]().fromJSON(n)),new Ks(i,t.options)}}const ud={generateTopUV:function(c,t,e,i,n){const s=t[e*3],o=t[e*3+1],r=t[i*3],_=t[i*3+1],a=t[n*3],l=t[n*3+1];return[new Fe(s,o),new Fe(r,_),new Fe(a,l)]},generateSideWallUV:function(c,t,e,i,n,s){const o=t[e*3],r=t[e*3+1],_=t[e*3+2],a=t[i*3],l=t[i*3+1],h=t[i*3+2],m=t[n*3],f=t[n*3+1],p=t[n*3+2],d=t[s*3],u=t[s*3+1],g=t[s*3+2];return Math.abs(r-l)<Math.abs(o-a)?[new Fe(o,1-_),new Fe(a,1-h),new Fe(m,1-p),new Fe(d,1-g)]:[new Fe(r,1-_),new Fe(l,1-h),new Fe(f,1-p),new Fe(u,1-g)]}};function fd(c,t,e){if(e.shapes=[],Array.isArray(c))for(let i=0,n=c.length;i<n;i++){const s=c[i];e.shapes.push(s.uuid)}else e.shapes.push(c.uuid);return t.extrudePath!==void 0&&(e.options.extrudePath=t.extrudePath.toJSON()),e}class hl extends Ti{constructor(t=new Aa([new Fe(0,.5),new Fe(-.5,-.5),new Fe(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const i=[],n=[],s=[],o=[];let r=0,_=0;if(Array.isArray(t)===!1)a(t);else for(let l=0;l<t.length;l++)a(t[l]),this.addGroup(r,_,l),r+=_,_=0;this.setIndex(i),this.setAttribute("position",new ji(n,3)),this.setAttribute("normal",new ji(s,3)),this.setAttribute("uv",new ji(o,2));function a(l){const h=n.length/3,m=l.extractPoints(e);let f=m.shape;const p=m.holes;qn.isClockWise(f)===!1&&(f=f.reverse());for(let u=0,g=p.length;u<g;u++){const v=p[u];qn.isClockWise(v)===!0&&(p[u]=v.reverse())}const d=qn.triangulateShape(f,p);for(let u=0,g=p.length;u<g;u++){const v=p[u];f=f.concat(v)}for(let u=0,g=f.length;u<g;u++){const v=f[u];n.push(v.x,v.y,0),s.push(0,0,1),o.push(v.x,v.y)}for(let u=0,g=d.length;u<g;u++){const v=d[u],x=v[0]+h,b=v[1]+h,Y=v[2]+h;i.push(x,b,Y),_+=3}}}toJSON(){const t=super.toJSON(),e=this.parameters.shapes;return dd(e,t)}static fromJSON(t,e){const i=[];for(let n=0,s=t.shapes.length;n<s;n++){const o=e[t.shapes[n]];i.push(o)}return new hl(i,t.curveSegments)}}function dd(c,t){if(t.shapes=[],Array.isArray(c))for(let e=0,i=c.length;e<i;e++){const n=c[e];t.shapes.push(n.uuid)}else t.shapes.push(c.uuid);return t}class Nh extends Oi{constructor(t){super(),this.type="ShadowMaterial",this.color=new fi(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}Nh.prototype.isShadowMaterial=!0;class Do extends bn{constructor(t){super(t),this.type="RawShaderMaterial"}}Do.prototype.isRawShaderMaterial=!0;class cl extends Oi{constructor(t){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new fi(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new fi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=js,this.normalScale=new Fe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}cl.prototype.isMeshStandardMaterial=!0;class Oh extends cl{constructor(t){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Fe(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Qi(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.sheenColor=new fi(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new fi(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new fi(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}Oh.prototype.isMeshPhysicalMaterial=!0;class Uh extends Oi{constructor(t){super(),this.type="MeshPhongMaterial",this.color=new fi(16777215),this.specular=new fi(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new fi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=js,this.normalScale=new Fe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Zo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}Uh.prototype.isMeshPhongMaterial=!0;class Gh extends Oi{constructor(t){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new fi(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new fi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=js,this.normalScale=new Fe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}Gh.prototype.isMeshToonMaterial=!0;class Hh extends Oi{constructor(t){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=js,this.normalScale=new Fe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}Hh.prototype.isMeshNormalMaterial=!0;class Wh extends Oi{constructor(t){super(),this.type="MeshLambertMaterial",this.color=new fi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new fi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Zo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}Wh.prototype.isMeshLambertMaterial=!0;class jh extends Oi{constructor(t){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new fi(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=js,this.normalScale=new Fe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}jh.prototype.isMeshMatcapMaterial=!0;class qh extends Qs{constructor(t){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}qh.prototype.isLineDashedMaterial=!0;const gd={ShadowMaterial:Nh,SpriteMaterial:il,RawShaderMaterial:Do,ShaderMaterial:bn,PointsMaterial:al,MeshPhysicalMaterial:Oh,MeshStandardMaterial:cl,MeshPhongMaterial:Uh,MeshToonMaterial:Gh,MeshNormalMaterial:Hh,MeshLambertMaterial:Wh,MeshDepthMaterial:Kr,MeshDistanceMaterial:tl,MeshBasicMaterial:To,MeshMatcapMaterial:jh,LineDashedMaterial:qh,LineBasicMaterial:Qs,Material:Oi};Oi.fromType=function(c){return new gd[c]};const Ei={arraySlice:function(c,t,e){return Ei.isTypedArray(c)?new c.constructor(c.subarray(t,e!==void 0?e:c.length)):c.slice(t,e)},convertArray:function(c,t,e){return!c||!e&&c.constructor===t?c:typeof t.BYTES_PER_ELEMENT=="number"?new t(c):Array.prototype.slice.call(c)},isTypedArray:function(c){return ArrayBuffer.isView(c)&&!(c instanceof DataView)},getKeyframeOrder:function(c){function t(n,s){return c[n]-c[s]}const e=c.length,i=new Array(e);for(let n=0;n!==e;++n)i[n]=n;return i.sort(t),i},sortedArray:function(c,t,e){const i=c.length,n=new c.constructor(i);for(let s=0,o=0;o!==i;++s){const r=e[s]*t;for(let _=0;_!==t;++_)n[o++]=c[r+_]}return n},flattenJSON:function(c,t,e,i){let n=1,s=c[0];for(;s!==void 0&&s[i]===void 0;)s=c[n++];if(s===void 0)return;let o=s[i];if(o!==void 0)if(Array.isArray(o))do o=s[i],o!==void 0&&(t.push(s.time),e.push.apply(e,o)),s=c[n++];while(s!==void 0);else if(o.toArray!==void 0)do o=s[i],o!==void 0&&(t.push(s.time),o.toArray(e,e.length)),s=c[n++];while(s!==void 0);else do o=s[i],o!==void 0&&(t.push(s.time),e.push(o)),s=c[n++];while(s!==void 0)},subclip:function(c,t,e,i,n=30){const s=c.clone();s.name=t;const o=[];for(let _=0;_<s.tracks.length;++_){const a=s.tracks[_],l=a.getValueSize(),h=[],m=[];for(let f=0;f<a.times.length;++f){const p=a.times[f]*n;if(!(p<e||p>=i)){h.push(a.times[f]);for(let d=0;d<l;++d)m.push(a.values[f*l+d])}}h.length!==0&&(a.times=Ei.convertArray(h,a.times.constructor),a.values=Ei.convertArray(m,a.values.constructor),o.push(a))}s.tracks=o;let r=1/0;for(let _=0;_<s.tracks.length;++_)r>s.tracks[_].times[0]&&(r=s.tracks[_].times[0]);for(let _=0;_<s.tracks.length;++_)s.tracks[_].shift(-1*r);return s.resetDuration(),s},makeClipAdditive:function(c,t=0,e=c,i=30){i<=0&&(i=30);const n=e.tracks.length,s=t/i;for(let o=0;o<n;++o){const r=e.tracks[o],_=r.ValueTypeName;if(_==="bool"||_==="string")continue;const a=c.tracks.find(function(g){return g.name===r.name&&g.ValueTypeName===_});if(a===void 0)continue;let l=0;const h=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=h/3);let m=0;const f=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(m=f/3);const p=r.times.length-1;let d;if(s<=r.times[0]){const g=l,v=h-l;d=Ei.arraySlice(r.values,g,v)}else if(s>=r.times[p]){const g=p*h+l,v=g+h-l;d=Ei.arraySlice(r.values,g,v)}else{const g=r.createInterpolant(),v=l,x=h-l;g.evaluate(s),d=Ei.arraySlice(g.resultBuffer,v,x)}_==="quaternion"&&new rn().fromArray(d).normalize().conjugate().toArray(d);const u=a.times.length;for(let g=0;g<u;++g){const v=g*f+m;if(_==="quaternion")rn.multiplyQuaternionsFlat(a.values,v,d,0,a.values,v);else{const x=f-m*2;for(let b=0;b<x;++b)a.values[v+b]-=d[b]}}}return c.blendMode=fh,c}};class Qn{constructor(t,e,i,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=n!==void 0?n:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let i=this._cachedIndex,n=e[i],s=e[i-1];t:{e:{let o;i:{n:if(!(t<n)){for(let r=i+2;;){if(n===void 0){if(t<s)break n;return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,t,s)}if(i===r)break;if(s=n,n=e[++i],t<n)break e}o=e.length;break i}if(!(t>=s)){const r=e[1];t<r&&(i=2,s=r);for(let _=i-2;;){if(s===void 0)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(i===_)break;if(n=s,s=e[--i-1],t>=s)break e}o=i,i=0;break i}break t}for(;i<o;){const r=i+o>>>1;t<e[r]?o=r:i=r+1}if(n=e[i],s=e[i-1],s===void 0)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(n===void 0)return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,s,t)}this._cachedIndex=i,this.intervalChanged_(i,s,n)}return this.interpolate_(i,s,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,s=t*n;for(let o=0;o!==n;++o)e[o]=i[s+o];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Qn.prototype.beforeStart_=Qn.prototype.copySampleValue_;Qn.prototype.afterEnd_=Qn.prototype.copySampleValue_;class vd extends Qn{constructor(t,e,i,n){super(t,e,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Es,endingEnd:Es}}intervalChanged_(t,e,i){const n=this.parameterPositions;let s=t-2,o=t+1,r=n[s],_=n[o];if(r===void 0)switch(this.getSettings_().endingStart){case Cs:s=t,r=2*e-i;break;case xo:s=n.length-2,r=e+n[s]-n[s+1];break;default:s=t,r=i}if(_===void 0)switch(this.getSettings_().endingEnd){case Cs:o=t,_=2*i-e;break;case xo:o=1,_=i+n[1]-n[0];break;default:o=t-1,_=e}const a=(i-e)*.5,l=this.valueSize;this._weightPrev=a/(e-r),this._weightNext=a/(_-i),this._offsetPrev=s*l,this._offsetNext=o*l}interpolate_(t,e,i,n){const s=this.resultBuffer,o=this.sampleValues,r=this.valueSize,_=t*r,a=_-r,l=this._offsetPrev,h=this._offsetNext,m=this._weightPrev,f=this._weightNext,p=(i-e)/(n-e),d=p*p,u=d*p,g=-m*u+2*m*d-m*p,v=(1+m)*u+(-1.5-2*m)*d+(-.5+m)*p+1,x=(-1-f)*u+(1.5+f)*d+.5*p,b=f*u-f*d;for(let Y=0;Y!==r;++Y)s[Y]=g*o[l+Y]+v*o[a+Y]+x*o[_+Y]+b*o[h+Y];return s}}class Jh extends Qn{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const s=this.resultBuffer,o=this.sampleValues,r=this.valueSize,_=t*r,a=_-r,l=(i-e)/(n-e),h=1-l;for(let m=0;m!==r;++m)s[m]=o[a+m]*h+o[_+m]*l;return s}}class xd extends Qn{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t){return this.copySampleValue_(t-1)}}class Ln{constructor(t,e,i,n){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Ei.convertArray(e,this.TimeBufferType),this.values=Ei.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:Ei.convertArray(t.times,Array),values:Ei.convertArray(t.values,Array)};const n=t.getInterpolation();n!==t.DefaultInterpolation&&(i.interpolation=n)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new xd(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Jh(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new vd(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case go:e=this.InterpolantFactoryMethodDiscrete;break;case vo:e=this.InterpolantFactoryMethodLinear;break;case Ho:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return go;case this.InterpolantFactoryMethodLinear:return vo;case this.InterpolantFactoryMethodSmooth:return Ho}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]+=t}return this}scale(t){if(t!==1){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]*=t}return this}trim(t,e){const i=this.times,n=i.length;let s=0,o=n-1;for(;s!==n&&i[s]<t;)++s;for(;o!==-1&&i[o]>e;)--o;if(++o,s!==0||o!==n){s>=o&&(o=Math.max(o,1),s=o-1);const r=this.getValueSize();this.times=Ei.arraySlice(i,s,o),this.values=Ei.arraySlice(this.values,s*r,o*r)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,n=this.values,s=i.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let o=null;for(let r=0;r!==s;r++){const _=i[r];if(typeof _=="number"&&isNaN(_)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,r,_),t=!1;break}if(o!==null&&o>_){console.error("THREE.KeyframeTrack: Out of order keys.",this,r,_,o),t=!1;break}o=_}if(n!==void 0&&Ei.isTypedArray(n))for(let r=0,_=n.length;r!==_;++r){const a=n[r];if(isNaN(a)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,r,a),t=!1;break}}return t}optimize(){const t=Ei.arraySlice(this.times),e=Ei.arraySlice(this.values),i=this.getValueSize(),n=this.getInterpolation()===Ho,s=t.length-1;let o=1;for(let r=1;r<s;++r){let _=!1;const a=t[r],l=t[r+1];if(a!==l&&(r!==1||a!==t[0]))if(n)_=!0;else{const h=r*i,m=h-i,f=h+i;for(let p=0;p!==i;++p){const d=e[h+p];if(d!==e[m+p]||d!==e[f+p]){_=!0;break}}}if(_){if(r!==o){t[o]=t[r];const h=r*i,m=o*i;for(let f=0;f!==i;++f)e[m+f]=e[h+f]}++o}}if(s>0){t[o]=t[s];for(let r=s*i,_=o*i,a=0;a!==i;++a)e[_+a]=e[r+a];++o}return o!==t.length?(this.times=Ei.arraySlice(t,0,o),this.values=Ei.arraySlice(e,0,o*i)):(this.times=t,this.values=e),this}clone(){const t=Ei.arraySlice(this.times,0),e=Ei.arraySlice(this.values,0),i=this.constructor,n=new i(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}Ln.prototype.TimeBufferType=Float32Array;Ln.prototype.ValueBufferType=Float32Array;Ln.prototype.DefaultInterpolation=vo;class ta extends Ln{}ta.prototype.ValueTypeName="bool";ta.prototype.ValueBufferType=Array;ta.prototype.DefaultInterpolation=go;ta.prototype.InterpolantFactoryMethodLinear=void 0;ta.prototype.InterpolantFactoryMethodSmooth=void 0;class $h extends Ln{}$h.prototype.ValueTypeName="color";class Mo extends Ln{}Mo.prototype.ValueTypeName="number";class bd extends Qn{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const s=this.resultBuffer,o=this.sampleValues,r=this.valueSize,_=(i-e)/(n-e);let a=t*r;for(let l=a+r;a!==l;a+=4)rn.slerpFlat(s,0,o,a-r,o,a,_);return s}}class Ta extends Ln{InterpolantFactoryMethodLinear(t){return new bd(this.times,this.values,this.getValueSize(),t)}}Ta.prototype.ValueTypeName="quaternion";Ta.prototype.DefaultInterpolation=vo;Ta.prototype.InterpolantFactoryMethodSmooth=void 0;class ea extends Ln{}ea.prototype.ValueTypeName="string";ea.prototype.ValueBufferType=Array;ea.prototype.DefaultInterpolation=go;ea.prototype.InterpolantFactoryMethodLinear=void 0;ea.prototype.InterpolantFactoryMethodSmooth=void 0;class wo extends Ln{}wo.prototype.ValueTypeName="vector";class Q_{constructor(t,e=-1,i,n=Hr){this.name=t,this.tracks=i,this.duration=e,this.blendMode=n,this.uuid=Zn(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],i=t.tracks,n=1/(t.fps||1);for(let o=0,r=i.length;o!==r;++o)e.push(Md(i[o]).scale(n));const s=new this(t.name,t.duration,e,t.blendMode);return s.uuid=t.uuid,s}static toJSON(t){const e=[],i=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let s=0,o=i.length;s!==o;++s)e.push(Ln.toJSON(i[s]));return n}static CreateFromMorphTargetSequence(t,e,i,n){const s=e.length,o=[];for(let r=0;r<s;r++){let _=[],a=[];_.push((r+s-1)%s,r,(r+1)%s),a.push(0,1,0);const l=Ei.getKeyframeOrder(_);_=Ei.sortedArray(_,1,l),a=Ei.sortedArray(a,1,l),!n&&_[0]===0&&(_.push(s),a.push(a[0])),o.push(new Mo(".morphTargetInfluences["+e[r].name+"]",_,a).scale(1/i))}return new this(t,-1,o)}static findByName(t,e){let i=t;if(!Array.isArray(t)){const n=t;i=n.geometry&&n.geometry.animations||n.animations}for(let n=0;n<i.length;n++)if(i[n].name===e)return i[n];return null}static CreateClipsFromMorphTargetSequences(t,e,i){const n={},s=/^([\w-]*?)([\d]+)$/;for(let r=0,_=t.length;r<_;r++){const a=t[r],l=a.name.match(s);if(l&&l.length>1){const h=l[1];let m=n[h];m||(n[h]=m=[]),m.push(a)}}const o=[];for(const r in n)o.push(this.CreateFromMorphTargetSequence(r,n[r],e,i));return o}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(h,m,f,p,d){if(f.length!==0){const u=[],g=[];Ei.flattenJSON(f,u,g,p),u.length!==0&&d.push(new h(m,u,g))}},n=[],s=t.name||"default",o=t.fps||30,r=t.blendMode;let _=t.length||-1;const a=t.hierarchy||[];for(let h=0;h<a.length;h++){const m=a[h].keys;if(!(!m||m.length===0))if(m[0].morphTargets){const f={};let p;for(p=0;p<m.length;p++)if(m[p].morphTargets)for(let d=0;d<m[p].morphTargets.length;d++)f[m[p].morphTargets[d]]=-1;for(const d in f){const u=[],g=[];for(let v=0;v!==m[p].morphTargets.length;++v){const x=m[p];u.push(x.time),g.push(x.morphTarget===d?1:0)}n.push(new Mo(".morphTargetInfluence["+d+"]",u,g))}_=f.length*o}else{const f=".bones["+e[h].name+"]";i(wo,f+".position",m,"pos",n),i(Ta,f+".quaternion",m,"rot",n),i(wo,f+".scale",m,"scl",n)}}return n.length===0?null:new this(s,_,n,r)}resetDuration(){const t=this.tracks;let e=0;for(let i=0,n=t.length;i!==n;++i){const s=this.tracks[i];e=Math.max(e,s.times[s.times.length-1])}return this.duration=e,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function yd(c){switch(c.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Mo;case"vector":case"vector2":case"vector3":case"vector4":return wo;case"color":return $h;case"quaternion":return Ta;case"bool":case"boolean":return ta;case"string":return ea}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+c)}function Md(c){if(c.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=yd(c.type);if(c.times===void 0){const e=[],i=[];Ei.flattenJSON(c.keys,e,i,"value"),c.times=e,c.values=i}return t.parse!==void 0?t.parse(c):new t(c.name,c.times,c.values,c.interpolation)}const Ws={enabled:!1,files:{},add:function(c,t){this.enabled!==!1&&(this.files[c]=t)},get:function(c){if(this.enabled!==!1)return this.files[c]},remove:function(c){delete this.files[c]},clear:function(){this.files={}}};class wd{constructor(t,e,i){const n=this;let s=!1,o=0,r=0,_;const a=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(l){r++,s===!1&&n.onStart!==void 0&&n.onStart(l,o,r),s=!0},this.itemEnd=function(l){o++,n.onProgress!==void 0&&n.onProgress(l,o,r),o===r&&(s=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(l){n.onError!==void 0&&n.onError(l)},this.resolveURL=function(l){return _?_(l):l},this.setURLModifier=function(l){return _=l,this},this.addHandler=function(l,h){return a.push(l,h),this},this.removeHandler=function(l){const h=a.indexOf(l);return h!==-1&&a.splice(h,2),this},this.getHandler=function(l){for(let h=0,m=a.length;h<m;h+=2){const f=a[h],p=a[h+1];if(f.global&&(f.lastIndex=0),f.test(l))return p}return null}}}const Xd=new wd;class Kn{constructor(t){this.manager=t!==void 0?t:Xd,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise(function(n,s){i.load(t,n,e,s)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const Pn={};class zd extends Kn{constructor(t){super(t)}load(t,e,i,n){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=Ws.get(t);if(s!==void 0)return this.manager.itemStart(t),setTimeout(()=>{e&&e(s),this.manager.itemEnd(t)},0),s;if(Pn[t]!==void 0){Pn[t].push({onLoad:e,onProgress:i,onError:n});return}Pn[t]=[],Pn[t].push({onLoad:e,onProgress:i,onError:n});const o=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),r=this.mimeType,_=this.responseType;fetch(o).then(a=>{if(a.status===200||a.status===0){if(a.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream=="undefined"||a.body===void 0||a.body.getReader===void 0)return a;const l=Pn[t],h=a.body.getReader(),m=a.headers.get("Content-Length"),f=m?parseInt(m):0,p=f!==0;let d=0;const u=new ReadableStream({start(g){v();function v(){h.read().then(({done:x,value:b})=>{if(x)g.close();else{d+=b.byteLength;const Y=new ProgressEvent("progress",{lengthComputable:p,loaded:d,total:f});for(let w=0,Z=l.length;w<Z;w++){const X=l[w];X.onProgress&&X.onProgress(Y)}g.enqueue(b),v()}})}}});return new Response(u)}else throw Error(`fetch for "${a.url}" responded with ${a.status}: ${a.statusText}`)}).then(a=>{switch(_){case"arraybuffer":return a.arrayBuffer();case"blob":return a.blob();case"document":return a.text().then(l=>new DOMParser().parseFromString(l,r));case"json":return a.json();default:if(r===void 0)return a.text();{const h=/charset="?([^;"\s]*)"?/i.exec(r),m=h&&h[1]?h[1].toLowerCase():void 0,f=new TextDecoder(m);return a.arrayBuffer().then(p=>f.decode(p))}}}).then(a=>{Ws.add(t,a);const l=Pn[t];delete Pn[t];for(let h=0,m=l.length;h<m;h++){const f=l[h];f.onLoad&&f.onLoad(a)}}).catch(a=>{const l=Pn[t];if(l===void 0)throw this.manager.itemError(t),a;delete Pn[t];for(let h=0,m=l.length;h<m;h++){const f=l[h];f.onError&&f.onError(a)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class Qh extends Kn{constructor(t){super(t)}load(t,e,i,n){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,o=Ws.get(t);if(o!==void 0)return s.manager.itemStart(t),setTimeout(function(){e&&e(o),s.manager.itemEnd(t)},0),o;const r=Xa("img");function _(){l(),Ws.add(t,this),e&&e(this),s.manager.itemEnd(t)}function a(h){l(),n&&n(h),s.manager.itemError(t),s.manager.itemEnd(t)}function l(){r.removeEventListener("load",_,!1),r.removeEventListener("error",a,!1)}return r.addEventListener("load",_,!1),r.addEventListener("error",a,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(r.crossOrigin=this.crossOrigin),s.manager.itemStart(t),r.src=t,r}}class Id extends Kn{constructor(t){super(t)}load(t,e,i,n){const s=new Vo,o=new Qh(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let r=0;function _(a){o.load(t[a],function(l){s.images[a]=l,r++,r===6&&(s.needsUpdate=!0,e&&e(s))},void 0,n)}for(let a=0;a<t.length;++a)_(a);return s}}class Yd extends Kn{constructor(t){super(t)}load(t,e,i,n){const s=new qi,o=new Qh(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,function(r){s.image=r,s.needsUpdate=!0,e!==void 0&&e(s)},i,n),s}}class Sn extends Li{constructor(t,e=1){super(),this.type="Light",this.color=new fi(t),this.intensity=e}dispose(){}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),e}}Sn.prototype.isLight=!0;class Zd extends Sn{constructor(t,e,i){super(t,i),this.type="HemisphereLight",this.position.copy(Li.DefaultUp),this.updateMatrix(),this.groundColor=new fi(e)}copy(t){return Sn.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}Zd.prototype.isHemisphereLight=!0;const K_=new xi,th=new wt,eh=new wt;class pl{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Fe(512,512),this.map=null,this.mapPass=null,this.matrix=new xi,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Eo,this._frameExtents=new Fe(1,1),this._viewportCount=1,this._viewports=[new Zi(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,i=this.matrix;th.setFromMatrixPosition(t.matrixWorld),e.position.copy(th),eh.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(eh),e.updateMatrixWorld(),K_.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(K_),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(e.projectionMatrix),i.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class Kh extends pl{constructor(){super(new tn(50,1,.5,500)),this.focus=1}updateMatrices(t){const e=this.camera,i=Pr*2*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,s=t.distance||e.far;(i!==e.fov||n!==e.aspect||s!==e.far)&&(e.fov=i,e.aspect=n,e.far=s,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}Kh.prototype.isSpotLightShadow=!0;class Sd extends Sn{constructor(t,e,i=0,n=Math.PI/3,s=0,o=1){super(t,e),this.type="SpotLight",this.position.copy(Li.DefaultUp),this.updateMatrix(),this.target=new Li,this.distance=i,this.angle=n,this.penumbra=s,this.decay=o,this.shadow=new Kh}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}Sd.prototype.isSpotLight=!0;const ih=new xi,pa=new wt,Yr=new wt;class tc extends pl{constructor(){super(new tn(90,1,.5,500)),this._frameExtents=new Fe(4,2),this._viewportCount=6,this._viewports=[new Zi(2,1,1,1),new Zi(0,1,1,1),new Zi(3,1,1,1),new Zi(1,1,1,1),new Zi(3,0,1,1),new Zi(1,0,1,1)],this._cubeDirections=[new wt(1,0,0),new wt(-1,0,0),new wt(0,0,1),new wt(0,0,-1),new wt(0,1,0),new wt(0,-1,0)],this._cubeUps=[new wt(0,1,0),new wt(0,1,0),new wt(0,1,0),new wt(0,1,0),new wt(0,0,1),new wt(0,0,-1)]}updateMatrices(t,e=0){const i=this.camera,n=this.matrix,s=t.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),pa.setFromMatrixPosition(t.matrixWorld),i.position.copy(pa),Yr.copy(i.position),Yr.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(Yr),i.updateMatrixWorld(),n.makeTranslation(-pa.x,-pa.y,-pa.z),ih.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ih)}}tc.prototype.isPointLightShadow=!0;class Ld extends Sn{constructor(t,e,i=0,n=1){super(t,e),this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new tc}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}Ld.prototype.isPointLight=!0;class ec extends pl{constructor(){super(new Co(-5,5,5,-5,.5,500))}}ec.prototype.isDirectionalLightShadow=!0;class Ad extends Sn{constructor(t,e){super(t,e),this.type="DirectionalLight",this.position.copy(Li.DefaultUp),this.updateMatrix(),this.target=new Li,this.shadow=new ec}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}Ad.prototype.isDirectionalLight=!0;class Td extends Sn{constructor(t,e){super(t,e),this.type="AmbientLight"}}Td.prototype.isAmbientLight=!0;class Vd extends Sn{constructor(t,e,i=10,n=10){super(t,e),this.type="RectAreaLight",this.width=i,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}Vd.prototype.isRectAreaLight=!0;class ic{constructor(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new wt)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const i=t.x,n=t.y,s=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.282095),e.addScaledVector(o[1],.488603*n),e.addScaledVector(o[2],.488603*s),e.addScaledVector(o[3],.488603*i),e.addScaledVector(o[4],1.092548*(i*n)),e.addScaledVector(o[5],1.092548*(n*s)),e.addScaledVector(o[6],.315392*(3*s*s-1)),e.addScaledVector(o[7],1.092548*(i*s)),e.addScaledVector(o[8],.546274*(i*i-n*n)),e}getIrradianceAt(t,e){const i=t.x,n=t.y,s=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.886227),e.addScaledVector(o[1],2*.511664*n),e.addScaledVector(o[2],2*.511664*s),e.addScaledVector(o[3],2*.511664*i),e.addScaledVector(o[4],2*.429043*i*n),e.addScaledVector(o[5],2*.429043*n*s),e.addScaledVector(o[6],.743125*s*s-.247708),e.addScaledVector(o[7],2*.429043*i*s),e.addScaledVector(o[8],.429043*(i*i-n*n)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(t.coefficients[i],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let i=0;i<9;i++)this.coefficients[i].lerp(t.coefficients[i],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(t,e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(t,e+n*3);return this}toArray(t=[],e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(t,e+n*3);return t}static getBasisAt(t,e){const i=t.x,n=t.y,s=t.z;e[0]=.282095,e[1]=.488603*n,e[2]=.488603*s,e[3]=.488603*i,e[4]=1.092548*i*n,e[5]=1.092548*n*s,e[6]=.315392*(3*s*s-1),e[7]=1.092548*i*s,e[8]=.546274*(i*i-n*n)}}ic.prototype.isSphericalHarmonics3=!0;class ml extends Sn{constructor(t=new ic,e=1){super(void 0,e),this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}ml.prototype.isLightProbe=!0;class Ed{static decodeText(t){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(t);let e="";for(let i=0,n=t.length;i<n;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch{return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return e===-1?"./":t.slice(0,e+1)}static resolveURL(t,e){return typeof t!="string"||t===""?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class Cd extends Ti{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}Cd.prototype.isInstancedBufferGeometry=!0;class Pd extends Kn{constructor(t){super(t),typeof createImageBitmap=="undefined"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch=="undefined"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,i,n){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,o=Ws.get(t);if(o!==void 0)return s.manager.itemStart(t),setTimeout(function(){e&&e(o),s.manager.itemEnd(t)},0),o;const r={};r.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",r.headers=this.requestHeader,fetch(t,r).then(function(_){return _.blob()}).then(function(_){return createImageBitmap(_,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(_){Ws.add(t,_),e&&e(_),s.manager.itemEnd(t)}).catch(function(_){n&&n(_),s.manager.itemError(t),s.manager.itemEnd(t)}),s.manager.itemStart(t)}}Pd.prototype.isImageBitmapLoader=!0;let ho;const Rd={getContext:function(){return ho===void 0&&(ho=new(window.AudioContext||window.webkitAudioContext)),ho},setContext:function(c){ho=c}};class kd extends Kn{constructor(t){super(t)}load(t,e,i,n){const s=this,o=new zd(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(r){try{const _=r.slice(0);Rd.getContext().decodeAudioData(_,function(l){e(l)})}catch(_){n?n(_):console.error(_),s.manager.itemError(t)}},i,n)}}class Bd extends ml{constructor(t,e,i=1){super(void 0,i);const n=new fi().set(t),s=new fi().set(e),o=new wt(n.r,n.g,n.b),r=new wt(s.r,s.g,s.b),_=Math.sqrt(Math.PI),a=_*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(r).multiplyScalar(_),this.sh.coefficients[1].copy(o).sub(r).multiplyScalar(a)}}Bd.prototype.isHemisphereLightProbe=!0;class Dd extends ml{constructor(t,e=1){super(void 0,e);const i=new fi().set(t);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}Dd.prototype.isAmbientLightProbe=!0;class Fd extends Li{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),this._connected===!0?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=t,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=t,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}class Nd{constructor(t,e,i){this.binding=t,this.valueSize=i;let n,s,o;switch(e){case"quaternion":n=this._slerp,s=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":n=this._select,s=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:n=this._lerp,s=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=s,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const i=this.buffer,n=this.valueSize,s=t*n+n;let o=this.cumulativeWeight;if(o===0){for(let r=0;r!==n;++r)i[s+r]=i[r];o=e}else{o+=e;const r=e/o;this._mixBufferRegion(i,s,0,r,n)}this.cumulativeWeight=o}accumulateAdditive(t){const e=this.buffer,i=this.valueSize,n=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(e,n,0,t,i),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,i=this.buffer,n=t*e+e,s=this.cumulativeWeight,o=this.cumulativeWeightAdditive,r=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const _=e*this._origIndex;this._mixBufferRegion(i,n,_,1-s,e)}o>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*e,1,e);for(let _=e,a=e+e;_!==a;++_)if(i[_]!==i[_+e]){r.setValue(i,n);break}}saveOriginalState(){const t=this.binding,e=this.buffer,i=this.valueSize,n=i*this._origIndex;t.getValue(e,n);for(let s=i,o=n;s!==o;++s)e[s]=e[n+s%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=this.valueSize*3;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]}_select(t,e,i,n,s){if(n>=.5)for(let o=0;o!==s;++o)t[e+o]=t[i+o]}_slerp(t,e,i,n){rn.slerpFlat(t,e,t,e,t,i,n)}_slerpAdditive(t,e,i,n,s){const o=this._workIndex*s;rn.multiplyQuaternionsFlat(t,o,t,e,t,i),rn.slerpFlat(t,e,t,e,t,o,n)}_lerp(t,e,i,n,s){const o=1-n;for(let r=0;r!==s;++r){const _=e+r;t[_]=t[_]*o+t[i+r]*n}}_lerpAdditive(t,e,i,n,s){for(let o=0;o!==s;++o){const r=e+o;t[r]=t[r]+t[i+o]*n}}}const ul="\\[\\]\\.:\\/",Od=new RegExp("["+ul+"]","g"),fl="[^"+ul+"]",Ud="[^"+ul.replace("\\.","")+"]",Gd=/((?:WC+[\/:])*)/.source.replace("WC",fl),Hd=/(WCOD+)?/.source.replace("WCOD",Ud),Wd=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",fl),jd=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",fl),qd=new RegExp("^"+Gd+Hd+Wd+jd+"$"),Jd=["material","materials","bones"];class $d{constructor(t,e,i){const n=i||Si.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}getValue(t,e){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];n!==void 0&&n.getValue(t,e)}setValue(t,e){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,s=i.length;n!==s;++n)i[n].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}}class Si{constructor(t,e,i){this.path=e,this.parsedPath=i||Si.parseTrackName(e),this.node=Si.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new Si.Composite(t,e,i):new Si(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(Od,"")}static parseTrackName(t){const e=qd.exec(t);if(e===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(n!==void 0&&n!==-1){const s=i.nodeName.substring(n+1);Jd.indexOf(s)!==-1&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=s)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(e===void 0||e===""||e==="."||e===-1||e===t.name||e===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(e);if(i!==void 0)return i}if(t.children){const i=function(s){for(let o=0;o<s.length;o++){const r=s[o];if(r.name===e||r.uuid===e)return r;const _=i(r.children);if(_)return _}return null},n=i(t.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)t[e++]=i[n]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,i=e.objectName,n=e.propertyName;let s=e.propertyIndex;if(t||(t=Si.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let a=e.objectIndex;switch(i){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let l=0;l<t.length;l++)if(t[l].name===a){a=l;break}break;default:if(t[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[i]}if(a!==void 0){if(t[a]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[a]}}const o=t[n];if(o===void 0){const a=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+a+"."+n+" but it wasn't found.",t);return}let r=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?r=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(r=this.Versioning.MatrixWorldNeedsUpdate);let _=this.BindingType.Direct;if(s!==void 0){if(n==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[s]!==void 0&&(s=t.morphTargetDictionary[s])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}_=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=s}else o.fromArray!==void 0&&o.toArray!==void 0?(_=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(_=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=n;this.getValue=this.GetterByBindingType[_],this.setValue=this.SetterByBindingTypeAndVersioning[_][r]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Si.Composite=$d;Si.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Si.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Si.prototype.GetterByBindingType=[Si.prototype._getValue_direct,Si.prototype._getValue_array,Si.prototype._getValue_arrayElement,Si.prototype._getValue_toArray];Si.prototype.SetterByBindingTypeAndVersioning=[[Si.prototype._setValue_direct,Si.prototype._setValue_direct_setNeedsUpdate,Si.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Si.prototype._setValue_array,Si.prototype._setValue_array_setNeedsUpdate,Si.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Si.prototype._setValue_arrayElement,Si.prototype._setValue_arrayElement_setNeedsUpdate,Si.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Si.prototype._setValue_fromArray,Si.prototype._setValue_fromArray_setNeedsUpdate,Si.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Qd{constructor(t,e,i=null,n=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=n;const s=e.tracks,o=s.length,r=new Array(o),_={endingStart:Es,endingEnd:Es};for(let a=0;a!==o;++a){const l=s[a].createInterpolant(null);r[a]=l,l.settings=_}this._interpolantSettings=_,this._interpolants=r,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=E0,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){const n=this._clip.duration,s=t._clip.duration,o=s/n,r=n/s;t.warp(1,o,e),this.warp(r,1,e)}return this}crossFadeTo(t,e,i){return t.crossFadeFrom(this,e,i)}stopFading(){const t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){const n=this._mixer,s=n.time,o=this.timeScale;let r=this._timeScaleInterpolant;r===null&&(r=n._lendControlInterpolant(),this._timeScaleInterpolant=r);const _=r.parameterPositions,a=r.sampleValues;return _[0]=s,_[1]=s+i,a[0]=t/o,a[1]=e/o,this}stopWarping(){const t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,n){if(!this.enabled){this._updateWeight(t);return}const s=this._startTime;if(s!==null){const _=(t-s)*i;if(_<0||i===0)return;this._startTime=null,e=i*_}e*=this._updateTimeScale(t);const o=this._updateTime(e),r=this._updateWeight(t);if(r>0){const _=this._interpolants,a=this._propertyBindings;switch(this.blendMode){case fh:for(let l=0,h=_.length;l!==h;++l)_[l].evaluate(o),a[l].accumulateAdditive(r);break;case Hr:default:for(let l=0,h=_.length;l!==h;++l)_[l].evaluate(o),a[l].accumulate(n,r)}}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const i=this._weightInterpolant;if(i!==null){const n=i.evaluate(t)[0];e*=n,t>i.parameterPositions[1]&&(this.stopFading(),n===0&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const i=this._timeScaleInterpolant;i!==null&&(e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),e===0?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,i=this.loop;let n=this.time+t,s=this._loopCount;const o=i===C0;if(t===0)return s===-1?n:o&&(s&1)===1?e-n:n;if(i===V0){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(n>=e)n=e;else if(n<0)n=0;else{this.time=n;break t}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(s===-1&&(t>=0?(s=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),n>=e||n<0){const r=Math.floor(n/e);n-=e*r,s+=Math.abs(r);const _=this.repetitions-s;if(_<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=t>0?e:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(_===1){const a=t<0;this._setEndings(a,!a,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:r})}}else this.time=n;if(o&&(s&1)===1)return e-n}return n}_setEndings(t,e,i){const n=this._interpolantSettings;i?(n.endingStart=Cs,n.endingEnd=Cs):(t?n.endingStart=this.zeroSlopeAtStart?Cs:Es:n.endingStart=xo,e?n.endingEnd=this.zeroSlopeAtEnd?Cs:Es:n.endingEnd=xo)}_scheduleFading(t,e,i){const n=this._mixer,s=n.time;let o=this._weightInterpolant;o===null&&(o=n._lendControlInterpolant(),this._weightInterpolant=o);const r=o.parameterPositions,_=o.sampleValues;return r[0]=s,_[0]=e,r[1]=s+t,_[1]=i,this}}class Kd extends ps{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const i=t._localRoot||this._root,n=t._clip.tracks,s=n.length,o=t._propertyBindings,r=t._interpolants,_=i.uuid,a=this._bindingsByRootAndName;let l=a[_];l===void 0&&(l={},a[_]=l);for(let h=0;h!==s;++h){const m=n[h],f=m.name;let p=l[f];if(p!==void 0)++p.referenceCount,o[h]=p;else{if(p=o[h],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,_,f));continue}const d=e&&e._propertyBindings[h].binding.parsedPath;p=new Nd(Si.create(i,f,d),m.ValueTypeName,m.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,_,f),o[h]=p}r[h].resultBuffer=p.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){const i=(t._localRoot||this._root).uuid,n=t._clip.uuid,s=this._actionsByClip[n];this._bindAction(t,s&&s.knownActions[0]),this._addInactiveAction(t,n,i)}const e=t._propertyBindings;for(let i=0,n=e.length;i!==n;++i){const s=e[i];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let i=0,n=e.length;i!==n;++i){const s=e[i];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return e!==null&&e<this._nActiveActions}_addInactiveAction(t,e,i){const n=this._actions,s=this._actionsByClip;let o=s[e];if(o===void 0)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,s[e]=o;else{const r=o.knownActions;t._byClipCacheIndex=r.length,r.push(t)}t._cacheIndex=n.length,n.push(t),o.actionByRoot[i]=t}_removeInactiveAction(t){const e=this._actions,i=e[e.length-1],n=t._cacheIndex;i._cacheIndex=n,e[n]=i,e.pop(),t._cacheIndex=null;const s=t._clip.uuid,o=this._actionsByClip,r=o[s],_=r.knownActions,a=_[_.length-1],l=t._byClipCacheIndex;a._byClipCacheIndex=l,_[l]=a,_.pop(),t._byClipCacheIndex=null;const h=r.actionByRoot,m=(t._localRoot||this._root).uuid;delete h[m],_.length===0&&delete o[s],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let i=0,n=e.length;i!==n;++i){const s=e[i];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(t){const e=this._actions,i=t._cacheIndex,n=this._nActiveActions++,s=e[n];t._cacheIndex=n,e[n]=t,s._cacheIndex=i,e[i]=s}_takeBackAction(t){const e=this._actions,i=t._cacheIndex,n=--this._nActiveActions,s=e[n];t._cacheIndex=n,e[n]=t,s._cacheIndex=i,e[i]=s}_addInactiveBinding(t,e,i){const n=this._bindingsByRootAndName,s=this._bindings;let o=n[e];o===void 0&&(o={},n[e]=o),o[i]=t,t._cacheIndex=s.length,s.push(t)}_removeInactiveBinding(t){const e=this._bindings,i=t.binding,n=i.rootNode.uuid,s=i.path,o=this._bindingsByRootAndName,r=o[n],_=e[e.length-1],a=t._cacheIndex;_._cacheIndex=a,e[a]=_,e.pop(),delete r[s],Object.keys(r).length===0&&delete o[n]}_lendBinding(t){const e=this._bindings,i=t._cacheIndex,n=this._nActiveBindings++,s=e[n];t._cacheIndex=n,e[n]=t,s._cacheIndex=i,e[i]=s}_takeBackBinding(t){const e=this._bindings,i=t._cacheIndex,n=--this._nActiveBindings,s=e[n];t._cacheIndex=n,e[n]=t,s._cacheIndex=i,e[i]=s}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let i=t[e];return i===void 0&&(i=new Jh(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=e,t[e]=i),i}_takeBackControlInterpolant(t){const e=this._controlInterpolants,i=t.__cacheIndex,n=--this._nActiveControlInterpolants,s=e[n];t.__cacheIndex=n,e[n]=t,s.__cacheIndex=i,e[i]=s}clipAction(t,e,i){const n=e||this._root,s=n.uuid;let o=typeof t=="string"?Q_.findByName(n,t):t;const r=o!==null?o.uuid:t,_=this._actionsByClip[r];let a=null;if(i===void 0&&(o!==null?i=o.blendMode:i=Hr),_!==void 0){const h=_.actionByRoot[s];if(h!==void 0&&h.blendMode===i)return h;a=_.knownActions[0],o===null&&(o=a._clip)}if(o===null)return null;const l=new Qd(this,o,e,i);return this._bindAction(l,a),this._addInactiveAction(l,r,s),l}existingAction(t,e){const i=e||this._root,n=i.uuid,s=typeof t=="string"?Q_.findByName(i,t):t,o=s?s.uuid:t,r=this._actionsByClip[o];return r!==void 0&&r.actionByRoot[n]||null}stopAllAction(){const t=this._actions,e=this._nActiveActions;for(let i=e-1;i>=0;--i)t[i].stop();return this}update(t){t*=this.timeScale;const e=this._actions,i=this._nActiveActions,n=this.time+=t,s=Math.sign(t),o=this._accuIndex^=1;for(let a=0;a!==i;++a)e[a]._update(n,t,s,o);const r=this._bindings,_=this._nActiveBindings;for(let a=0;a!==_;++a)r[a].apply(o);return this}setTime(t){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,i=t.uuid,n=this._actionsByClip,s=n[i];if(s!==void 0){const o=s.knownActions;for(let r=0,_=o.length;r!==_;++r){const a=o[r];this._deactivateAction(a);const l=a._cacheIndex,h=e[e.length-1];a._cacheIndex=null,a._byClipCacheIndex=null,h._cacheIndex=l,e[l]=h,e.pop(),this._removeInactiveBindingsForAction(a)}delete n[i]}}uncacheRoot(t){const e=t.uuid,i=this._actionsByClip;for(const o in i){const r=i[o].actionByRoot,_=r[e];_!==void 0&&(this._deactivateAction(_),this._removeInactiveAction(_))}const n=this._bindingsByRootAndName,s=n[e];if(s!==void 0)for(const o in s){const r=s[o];r.restoreOriginalState(),this._removeInactiveBinding(r)}}uncacheAction(t,e){const i=this.existingAction(t,e);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}Kd.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class Ni{constructor(t){typeof t=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new Ni(this.value.clone===void 0?this.value:this.value.clone())}}class t2 extends La{constructor(t,e,i=1){super(t,e),this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}t2.prototype.isInstancedInterleavedBuffer=!0;const Hn=new wt,co=new xi,Zr=new xi;class e2 extends sl{constructor(t){const e=nc(t),i=new Ti,n=[],s=[],o=new fi(0,0,1),r=new fi(0,1,0);for(let a=0;a<e.length;a++){const l=e[a];l.parent&&l.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),s.push(o.r,o.g,o.b),s.push(r.r,r.g,r.b))}i.setAttribute("position",new ji(n,3)),i.setAttribute("color",new ji(s,3));const _=new Qs({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,_),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,i=this.geometry,n=i.getAttribute("position");Zr.copy(this.root.matrixWorld).invert();for(let s=0,o=0;s<e.length;s++){const r=e[s];r.parent&&r.parent.isBone&&(co.multiplyMatrices(Zr,r.matrixWorld),Hn.setFromMatrixPosition(co),n.setXYZ(o,Hn.x,Hn.y,Hn.z),co.multiplyMatrices(Zr,r.parent.matrixWorld),Hn.setFromMatrixPosition(co),n.setXYZ(o+1,Hn.x,Hn.y,Hn.z),o+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}function nc(c){const t=[];c.isBone===!0&&t.push(c);for(let e=0;e<c.children.length;e++)t.push.apply(t,nc(c.children[e]));return t}class i2 extends sl{constructor(t=10,e=10,i=4473924,n=8947848){i=new fi(i),n=new fi(n);const s=e/2,o=t/e,r=t/2,_=[],a=[];for(let m=0,f=0,p=-r;m<=e;m++,p+=o){_.push(-r,0,p,r,0,p),_.push(p,0,-r,p,0,r);const d=m===s?i:n;d.toArray(a,f),f+=3,d.toArray(a,f),f+=3,d.toArray(a,f),f+=3,d.toArray(a,f),f+=3}const l=new Ti;l.setAttribute("position",new ji(_,3)),l.setAttribute("color",new ji(a,3));const h=new Qs({vertexColors:!0,toneMapped:!1});super(l,h),this.type="GridHelper"}}const Mn=new Uint32Array(512),wn=new Uint32Array(512);for(let c=0;c<256;++c){const t=c-127;t<-27?(Mn[c]=0,Mn[c|256]=32768,wn[c]=24,wn[c|256]=24):t<-14?(Mn[c]=1024>>-t-14,Mn[c|256]=1024>>-t-14|32768,wn[c]=-t-1,wn[c|256]=-t-1):t<=15?(Mn[c]=t+15<<10,Mn[c|256]=t+15<<10|32768,wn[c]=13,wn[c|256]=13):t<128?(Mn[c]=31744,Mn[c|256]=64512,wn[c]=24,wn[c|256]=24):(Mn[c]=31744,Mn[c|256]=64512,wn[c]=13,wn[c|256]=13)}const sc=new Uint32Array(2048),Va=new Uint32Array(64),n2=new Uint32Array(64);for(let c=1;c<1024;++c){let t=c<<13,e=0;for(;(t&8388608)===0;)t<<=1,e-=8388608;t&=-8388609,e+=947912704,sc[c]=t|e}for(let c=1024;c<2048;++c)sc[c]=939524096+(c-1024<<13);for(let c=1;c<31;++c)Va[c]=c<<23;Va[31]=1199570944;Va[32]=2147483648;for(let c=33;c<63;++c)Va[c]=2147483648+(c-32<<23);Va[63]=3347054592;for(let c=1;c<64;++c)c!==32&&(n2[c]=1024);cn.create=function(c,t){return console.log("THREE.Curve.create() has been deprecated"),c.prototype=Object.create(cn.prototype),c.prototype.constructor=c,c.prototype.getPoint=t,c};Fr.prototype.fromPoints=function(c){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(c)};i2.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};e2.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};Kn.prototype.extractUrlBase=function(c){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Ed.extractUrlBase(c)};Kn.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};yn.prototype.center=function(c){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(c)};yn.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()};yn.prototype.isIntersectionBox=function(c){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(c)};yn.prototype.isIntersectionSphere=function(c){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(c)};yn.prototype.size=function(c){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(c)};us.prototype.toVector3=function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")};qs.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()};Eo.prototype.setFromMatrix=function(c){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(c)};Wi.prototype.flattenToArrayOffset=function(c,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(c,t)};Wi.prototype.multiplyVector3=function(c){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),c.applyMatrix3(this)};Wi.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")};Wi.prototype.applyToBufferAttribute=function(c){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),c.applyMatrix3(this)};Wi.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")};Wi.prototype.getInverse=function(c){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(c).invert()};xi.prototype.extractPosition=function(c){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(c)};xi.prototype.flattenToArrayOffset=function(c,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(c,t)};xi.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new wt().setFromMatrixColumn(this,3)};xi.prototype.setRotationFromQuaternion=function(c){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(c)};xi.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")};xi.prototype.multiplyVector3=function(c){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),c.applyMatrix4(this)};xi.prototype.multiplyVector4=function(c){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),c.applyMatrix4(this)};xi.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")};xi.prototype.rotateAxis=function(c){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),c.transformDirection(this)};xi.prototype.crossVector=function(c){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),c.applyMatrix4(this)};xi.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")};xi.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")};xi.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")};xi.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")};xi.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")};xi.prototype.applyToBufferAttribute=function(c){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),c.applyMatrix4(this)};xi.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")};xi.prototype.makeFrustum=function(c,t,e,i,n,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(c,t,i,e,n,s)};xi.prototype.getInverse=function(c){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(c).invert()};Xn.prototype.isIntersectionLine=function(c){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(c)};rn.prototype.multiplyVector3=function(c){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),c.applyQuaternion(this)};rn.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()};Js.prototype.isIntersectionBox=function(c){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(c)};Js.prototype.isIntersectionPlane=function(c){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(c)};Js.prototype.isIntersectionSphere=function(c){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(c)};Di.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()};Di.prototype.barycoordFromPoint=function(c,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(c,t)};Di.prototype.midpoint=function(c){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(c)};Di.prototypenormal=function(c){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(c)};Di.prototype.plane=function(c){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(c)};Di.barycoordFromPoint=function(c,t,e,i,n){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Di.getBarycoord(c,t,e,i,n)};Di.normal=function(c,t,e,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Di.getNormal(c,t,e,i)};Aa.prototype.extractAllPoints=function(c){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(c)};Aa.prototype.extrude=function(c){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Ks(this,c)};Aa.prototype.makeGeometry=function(c){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new hl(this,c)};Fe.prototype.fromAttribute=function(c,t,e){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(c,t,e)};Fe.prototype.distanceToManhattan=function(c){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(c)};Fe.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};wt.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")};wt.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")};wt.prototype.getPositionFromMatrix=function(c){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(c)};wt.prototype.getScaleFromMatrix=function(c){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(c)};wt.prototype.getColumnFromMatrix=function(c,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,c)};wt.prototype.applyProjection=function(c){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(c)};wt.prototype.fromAttribute=function(c,t,e){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(c,t,e)};wt.prototype.distanceToManhattan=function(c){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(c)};wt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Zi.prototype.fromAttribute=function(c,t,e){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(c,t,e)};Zi.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Li.prototype.getChildByName=function(c){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(c)};Li.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")};Li.prototype.translate=function(c,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,c)};Li.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")};Li.prototype.applyMatrix=function(c){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(c)};Object.defineProperties(Li.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(c){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=c}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});en.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")};Object.defineProperties(en.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),P0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});Vh.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};tn.prototype.setLens=function(c,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),t!==void 0&&(this.filmGauge=t),this.setFocalLength(c)};Object.defineProperties(Sn.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(c){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=c}},shadowCameraLeft:{set:function(c){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=c}},shadowCameraRight:{set:function(c){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=c}},shadowCameraTop:{set:function(c){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=c}},shadowCameraBottom:{set:function(c){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=c}},shadowCameraNear:{set:function(c){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=c}},shadowCameraFar:{set:function(c){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=c}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(c){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=c}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(c){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=c}},shadowMapHeight:{set:function(c){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=c}}});Object.defineProperties(Ri.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===bo},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(bo)}}});Ri.prototype.setDynamic=function(c){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(c===!0?bo:wa),this};Ri.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Ri.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};Ti.prototype.addIndex=function(c){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(c)};Ti.prototype.addAttribute=function(c,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(t&&t.isBufferAttribute)&&!(t&&t.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(c,new Ri(arguments[1],arguments[2]))):c==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(c,t)};Ti.prototype.addDrawCall=function(c,t,e){e!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(c,t)};Ti.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()};Ti.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")};Ti.prototype.removeAttribute=function(c){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(c)};Ti.prototype.applyMatrix=function(c){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(c)};Object.defineProperties(Ti.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});La.prototype.setDynamic=function(c){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(c===!0?bo:wa),this};La.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};Ks.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")};Ks.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")};Ks.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")};el.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")};Ni.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this};Object.defineProperties(Oi.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new fi}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(c){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=c===ch}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(c){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=c}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}});Object.defineProperties(bn.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(c){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=c}}});Ai.prototype.clearTarget=function(c,t,e,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(c),this.clear(t,e,i)};Ai.prototype.animate=function(c){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(c)};Ai.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()};Ai.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()};Ai.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision};Ai.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()};Ai.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")};Ai.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")};Ai.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")};Ai.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")};Ai.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")};Ai.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")};Ai.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures};Ai.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")};Ai.prototype.enableScissorTest=function(c){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(c)};Ai.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};Ai.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};Ai.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};Ai.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};Ai.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")};Ai.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")};Ai.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")};Ai.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")};Ai.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")};Ai.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()};Object.defineProperties(Ai.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(c){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=c}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(c){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=c}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(c){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=c===!0?Vi:Jn}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});Object.defineProperties(Sh.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(on.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(c){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=c}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(c){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=c}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(c){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=c}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(c){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=c}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(c){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=c}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(c){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=c}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(c){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=c}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(c){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=c}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(c){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=c}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(c){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=c}}});Fd.prototype.load=function(c){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return new kd().load(c,function(i){t.setBuffer(i)}),this};Jr.prototype.updateCubeMap=function(c,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(c,t)};Jr.prototype.clear=function(c,t,e,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(c,t,e,i)};ms.crossOrigin=void 0;ms.loadTexture=function(c,t,e,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const n=new Yd;n.setCrossOrigin(this.crossOrigin);const s=n.load(c,e,void 0,i);return t&&(s.mapping=t),s};ms.loadTextureCube=function(c,t,e,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const n=new Id;n.setCrossOrigin(this.crossOrigin);const s=n.load(c,e,void 0,i);return t&&(s.mapping=t),s};ms.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};ms.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Gr}}));typeof window!="undefined"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Gr);var va,Xo;if(typeof window!="undefined")va=window.requestAnimationFrame,Xo=window.cancelAnimationFrame;else{const c=performance.now(),t=1e3/60;va=e=>setTimeout(()=>{e(performance.now()-c)},t),Xo=clearTimeout}class s2{constructor(){li(this,"onTick",t=>{this.isAnimating&&(this.requestId=va(this.onTick)),this.delta=Math.min(150,t-this.last),this.last=t,this.time=t*.001,this.frame++;for(let e=this.callbacks.length-1;e>=0;e--){const i=this.callbacks[e];if(!!i){if(i.fps){const n=t-i.last;if(n<1e3/i.fps)continue;i.last=t,i.frame++,i(this.time,n,i.frame);continue}i(this.time,this.delta,this.frame)}}});this.callbacks=[],this.last=performance.now(),this.time=0,this.delta=0,this.frame=0,this.isAnimating=!1}add(t,e){e&&(t.fps=e,t.last=performance.now(),t.frame=0),this.callbacks.unshift(t)}remove(t){const e=this.callbacks.indexOf(t);~e&&this.callbacks.splice(e,1)}start(){this.isAnimating||(this.isAnimating=!0,this.requestId=va(this.onTick))}stop(){!this.isAnimating||(this.isAnimating=!1,Xo(this.requestId))}setRequestFrame(t){va=t}setCancelFrame(t){Xo=t}}const Ur=new s2,a2=4,o2=.001,r2=1e-7,l2=10,fa=11,po=1/(fa-1),_2=typeof Float32Array=="function";function ac(c,t){return 1-3*t+3*c}function oc(c,t){return 3*t-6*c}function rc(c){return 3*c}function zo(c,t,e){return((ac(t,e)*c+oc(t,e))*c+rc(t))*c}function lc(c,t,e){return 3*ac(t,e)*c*c+2*oc(t,e)*c+rc(t)}function h2(c,t,e,i,n){let s,o,r=0;do o=t+(e-t)/2,s=zo(o,i,n)-c,s>0?e=o:t=o;while(Math.abs(s)>r2&&++r<l2);return o}function c2(c,t,e,i){for(let n=0;n<a2;n++){const s=lc(t,e,i);if(s===0)return t;t-=(zo(t,e,i)-c)/s}return t}function p2(c){return c}function m2(c,t,e,i){if(!(0<=c&&c<=1&&0<=e&&e<=1))throw new Error("Bezier x values must be in [0, 1] range");if(c===t&&e===i)return p2;const n=_2?new Float32Array(fa):new Array(fa);for(let o=0;o<fa;o++)n[o]=zo(o*po,c,e);function s(o){let r=0,_=1;const a=fa-1;for(;_!==a&&n[_]<=o;_++)r+=po;_--;const l=(o-n[_])/(n[_+1]-n[_]),h=r+l*po,m=lc(h,c,e);return m>=o2?c2(o,h,c,e):m===0?h:h2(o,r,r+po,c,e)}return function(r){return r===0||r===1?r:zo(s(r),t,i)}}class nh{static linear(t){return t}static easeInQuad(t){return t*t}static easeOutQuad(t){return t*(2-t)}static easeInOutQuad(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}static easeInCubic(t){return t*t*t}static easeOutCubic(t){return--t*t*t+1}static easeInOutCubic(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}static easeInQuart(t){return t*t*t*t}static easeOutQuart(t){return 1- --t*t*t*t}static easeInOutQuart(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}static easeInQuint(t){return t*t*t*t*t}static easeOutQuint(t){return--t*t*t*t*t+1}static easeInOutQuint(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}static easeInSine(t){return 1-Math.sin((1-t)*Math.PI/2)}static easeOutSine(t){return Math.sin(t*Math.PI/2)}static easeInOutSine(t){return .5*(1-Math.sin(Math.PI*(.5-t)))}static easeInExpo(t){return t===0?0:Math.pow(1024,t-1)}static easeOutExpo(t){return t===1?1:1-Math.pow(2,-10*t)}static easeInOutExpo(t){return t===0||t===1?t:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)}static easeInCirc(t){return 1-Math.sqrt(1-t*t)}static easeOutCirc(t){return Math.sqrt(1- --t*t)}static easeInOutCirc(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}static easeInBack(t){return t===1?1:t*t*((1.70158+1)*t-1.70158)}static easeOutBack(t){return t===0?0:--t*t*((1.70158+1)*t+1.70158)+1}static easeInOutBack(t){const e=2.5949095;return(t*=2)<1?.5*(t*t*((e+1)*t-e)):.5*((t-=2)*t*((e+1)*t+e)+2)}static easeInElastic(t,e=1,i=.3){if(t===0||t===1)return t;const n=Math.PI*2,s=i/n*Math.asin(1/e);return-(e*Math.pow(2,10*--t)*Math.sin((t-s)*n/i))}static easeOutElastic(t,e=1,i=.3){if(t===0||t===1)return t;const n=Math.PI*2,s=i/n*Math.asin(1/e);return e*Math.pow(2,-10*t)*Math.sin((t-s)*n/i)+1}static easeInOutElastic(t,e=1,i=.3*1.5){if(t===0||t===1)return t;const n=Math.PI*2,s=i/n*Math.asin(1/e);return(t*=2)<1?-.5*(e*Math.pow(2,10*--t)*Math.sin((t-s)*n/i)):e*Math.pow(2,-10*--t)*Math.sin((t-s)*n/i)*.5+1}static easeInBounce(t){return 1-this.easeOutBounce(1-t)}static easeOutBounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}static easeInOutBounce(t){return t<.5?this.easeInBounce(t*2)*.5:this.easeOutBounce(t*2-1)*.5+.5}static addBezier(t,e,i,n,s){this[t]=m2(e,i,n,s)}}const os=[];class dl{constructor(t,e,i,n,s=0,o,r){li(this,"onUpdate",(t,e)=>{this.elapsed+=e;const i=Math.max(0,Math.min(1,(this.elapsed-this.delay)/this.duration)),n=this.ease(i,this.spring,this.damping);for(const s in this.from)this.object[s]=this.from[s]+(this.to[s]-this.from[s])*n;this.update&&this.update(),i===1&&(Io(this),this.complete&&this.complete())});typeof s!="number"&&(r=o,o=s,s=0),this.object=t,this.duration=i,this.elapsed=0,this.ease=typeof n=="function"?n:nh[n]||nh.easeOutCubic,this.delay=s,this.complete=o,this.update=r,this.isAnimating=!1,this.from={},this.to=Object.assign({},e),this.spring=this.to.spring,this.damping=this.to.damping,delete this.to.spring,delete this.to.damping;for(const _ in this.to)typeof this.to[_]=="number"&&typeof t[_]=="number"&&(this.from[_]=t[_]);this.start()}start(){this.isAnimating||(this.isAnimating=!0,Ur.add(this.onUpdate))}stop(){!this.isAnimating||(this.isAnimating=!1,Ur.remove(this.onUpdate))}}function u2(c,t){const e=new dl(t,null,c,"linear",0,t);return os.push(e),e}function f2(c,t,e,i,n=0,s,o){typeof n!="number"&&(o=s,s=n,n=0);const r=new Promise(_=>{const a=new dl(c,t,e,i,n,_,o);os.push(a)});return s&&r.then(s),r}function Io(c){if(c instanceof dl){c.stop();const t=os.indexOf(c);~t&&os.splice(t,1)}else for(let t=os.length-1;t>=0;t--)os[t].object===c&&Io(os[t])}const sh=["x","y","z","skewX","skewY","rotation","rotationX","rotationY","rotationZ","scale","scaleX","scaleY","scaleZ"],ah=["blur","brightness","contrast","grayscale","hue","invert","saturate","sepia"],oh=["opacity","zIndex","fontWeight","strokeWidth","strokeDashoffset","stopOpacity"],d2=["opacity","brightness","contrast","saturate","scale","stopOpacity"];class gl{constructor(t,e="div",i){this.events=new Fc,this.children=[],this.timeouts=[],this.style={},this.isTransform=!1,this.isFilter=!1,typeof t=="object"&&t!==null?this.element=t:e!==null&&(this.name=t,this.type=e,e==="svg"?this.element=document.createElementNS("http://www.w3.org/2000/svg",i||"svg"):this.element=document.createElement(e),typeof t=="string"&&(t.startsWith(".")?this.element.className=t.slice(1):this.element.id=t))}add(t){if(!!this.children)return this.children.push(t),t.parent=this,t.element?this.element.appendChild(t.element):t.nodeName&&this.element.appendChild(t),t}remove(t){if(!this.children)return;t.element?t.element.parentNode.removeChild(t.element):t.nodeName&&t.parentNode.removeChild(t);const e=this.children.indexOf(t);~e&&this.children.splice(e,1)}clone(){if(!!this.element)return new gl(this.element.cloneNode(!0))}empty(){if(!!this.element){for(let t=this.children.length-1;t>=0;t--)this.children[t]&&this.children[t].destroy&&this.children[t].destroy();return this.children.length=0,this.element.innerHTML="",this}}attr(t){if(!!this.element){for(const e in t)this.element.setAttribute(e,t[e]);return this}}css(t){if(!this.element)return;const e=this.style;for(const i in t){if(~sh.indexOf(i)){e[i]=t[i],this.isTransform=!0;continue}if(~ah.indexOf(i)){e[i]=t[i],this.isFilter=!0;continue}let n;~oh.indexOf(i)?(n=t[i],e[i]=n):n=typeof t[i]!="string"?t[i]+"px":t[i],this.element.style[i]=n}if(this.isTransform){let i="";if(typeof e.x!="undefined"||typeof e.y!="undefined"||typeof e.z!="undefined"){const n=typeof e.x!="undefined"?e.x:0,s=typeof e.y!="undefined"?e.y:0,o=typeof e.z!="undefined"?e.z:0;i+=`translate3d(${n}px, ${s}px, ${o}px)`}typeof e.skewX!="undefined"&&(i+=`skewX(${e.skewX}deg)`),typeof e.skewY!="undefined"&&(i+=`skewY(${e.skewY}deg)`),typeof e.rotation!="undefined"&&(i+=`rotate(${e.rotation}deg)`),typeof e.rotationX!="undefined"&&(i+=`rotateX(${e.rotationX}deg)`),typeof e.rotationY!="undefined"&&(i+=`rotateY(${e.rotationY}deg)`),typeof e.rotationZ!="undefined"&&(i+=`rotateZ(${e.rotationZ}deg)`),typeof e.scale!="undefined"&&(i+=`scale(${e.scale})`),typeof e.scaleX!="undefined"&&(i+=`scaleX(${e.scaleX})`),typeof e.scaleY!="undefined"&&(i+=`scaleY(${e.scaleY})`),typeof e.scaleZ!="undefined"&&(i+=`scaleZ(${e.scaleZ})`),this.element.style.transform=i}if(this.isFilter){let i="";typeof e.blur!="undefined"&&(i+=`blur(${e.blur}px)`),typeof e.brightness!="undefined"&&(i+=`brightness(${e.brightness})`),typeof e.contrast!="undefined"&&(i+=`contrast(${e.contrast})`),typeof e.grayscale!="undefined"&&(i+=`grayscale(${e.grayscale})`),typeof e.hue!="undefined"&&(i+=`hue-rotate(${e.hue}deg)`),typeof e.invert!="undefined"&&(i+=`invert(${e.invert})`),typeof e.saturate!="undefined"&&(i+=`saturate(${e.saturate})`),typeof e.sepia!="undefined"&&(i+=`sepia(${e.sepia})`),this.element.style.filter=i}return this}tween(t,e,i,n=0,s,o){if(!this.element)return;typeof n!="number"&&(o=s,s=n,n=0);const r=getComputedStyle(this.element);for(const a in t){let l;typeof this.style[a]!="undefined"?l=this.style[a]:~sh.indexOf(a)||~ah.indexOf(a)||~oh.indexOf(a)?l=~d2.indexOf(a)?1:0:typeof r[a]=="string"&&(l=parseFloat(r[a])),isNaN(l)||(this.style[a]=l)}return f2(this.style,t,e,i,n,s,()=>{this.css(this.style),o&&o()})}clearTween(){return Io(this.style),this}delayedCall(t,e){if(!this.timeouts)return;const i=u2(t,()=>{this.clearTimeout(i,!0),e&&e()});return this.timeouts.push(i),i}clearTimeout(t,e){if(!this.timeouts)return;e||Io(t);const i=this.timeouts.indexOf(t);~i&&this.timeouts.splice(i,1)}clearTimeouts(){if(!!this.timeouts)for(let t=this.timeouts.length-1;t>=0;t--)this.clearTimeout(this.timeouts[t])}text(t){if(!!this.element)return typeof t=="undefined"?this.element.textContent:(this.element.textContent=t,this)}html(t){if(!!this.element)return typeof t=="undefined"?this.element.innerHTML:(this.element.innerHTML=t,this)}hide(){return this.css({display:"none"})}show(){return this.css({display:""})}invisible(){return this.css({visibility:"hidden"})}visible(){return this.css({visibility:""})}bg(t,e="contain",i="center",n="no-repeat"){const s={backgroundImage:`url(${Wn.getPath(t)})`,backgroundSize:e,backgroundPosition:i,backgroundRepeat:n};return this.css(s)}line(t=this.progress||0){const e=this.start||0,i=this.offset||0,n=this.element.getTotalLength(),s=n*t,o=n-s,r={strokeDasharray:`${s},${o}`,strokeDashoffset:-n*(e+i)};return this.css(r)}load(t){return fetch(Wn.getPath(t),Wn.options).then(i=>i.text()).then(i=>{this.html(i)})}destroy(){if(!!this.children){this.parent&&this.parent.remove&&this.parent.remove(this),this.clearTimeouts(),this.clearTween(),this.events.destroy();for(let t=this.children.length-1;t>=0;t--)this.children[t]&&this.children[t].destroy&&this.children[t].destroy();this.element.object=null;for(const t in this)this[t]=null;return null}}}var Gi;if(typeof window!="undefined"){let c=function(){window.addEventListener("popstate",t),window.addEventListener("keydown",e),window.addEventListener("keyup",i),window.addEventListener("keypress",n),window.addEventListener("resize",s),document.addEventListener("visibilitychange",o),Ur.start()},t=function(r){Gi.path=location.pathname,Gi.events.emit(Pi.STATE_CHANGE,r)},e=function(r){Gi.events.emit(Pi.KEY_DOWN,r)},i=function(r){Gi.events.emit(Pi.KEY_UP,r)},n=function(r){Gi.events.emit(Pi.KEY_PRESS,r)},s=function(r){Gi.width=document.documentElement.clientWidth,Gi.height=document.documentElement.clientHeight,Gi.dpr=window.devicePixelRatio,Gi.aspect=Gi.width/Gi.height,Gi.events.emit(Pi.RESIZE,r)},o=function(r){Gi.events.emit(Pi.VISIBILITY,r)};Gi=new gl(null,null),Gi.init=r=>{Gi.element=r,c(),t(),s()},Gi.setPath=r=>{r!==location.pathname&&(history.pushState(null,null,r),t())},Gi.setTitle=r=>{document.title=r}}function g2(){const c=new Ti,t=new Float32Array([-1,-1,3,-1,-1,3]),e=new Float32Array([0,0,2,0,0,2]);return c.setAttribute("position",new Ri(t,2)),c.setAttribute("uv",new Ri(e,2)),c}var v2=`
in vec3 position;
in vec2 uv;

out vec2 vUv;

void main() {
    vUv = uv;

    gl_Position = vec4(position, 1.0);
}
`,x2=`
float smootherstep(float edge0, float edge1, float x) {
    x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
    return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);
}
`,b2=`
vec4 blur13(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.411764705882353) * direction;
  vec2 off2 = vec2(3.2941176470588234) * direction;
  vec2 off3 = vec2(5.176470588235294) * direction;
  color += texture(image, uv) * 0.1964825501511404;
  color += texture(image, uv + (off1 / resolution)) * 0.2969069646728344;
  color += texture(image, uv - (off1 / resolution)) * 0.2969069646728344;
  color += texture(image, uv + (off2 / resolution)) * 0.09447039785044732;
  color += texture(image, uv - (off2 / resolution)) * 0.09447039785044732;
  color += texture(image, uv + (off3 / resolution)) * 0.010381362401148057;
  color += texture(image, uv - (off3 / resolution)) * 0.010381362401148057;
  return color;
}
`,y2=`
precision highp float;

uniform sampler2D tMap;
uniform float uBluriness;
uniform vec2 uDirection;
uniform vec2 uResolution;

in vec2 vUv;

out vec4 FragColor;

${x2}
${b2}

void main() {
    FragColor = blur13(tMap, vUv, uResolution, smootherstep(uBluriness, 0.0, vUv.y) * uDirection);
}
`;class M2 extends Do{constructor(){super({glslVersion:yo,uniforms:{tMap:new Ni(null),uBluriness:new Ni(1),uDirection:new Ni(new Fe(1,0)),uResolution:new Ni(new Fe)},vertexShader:v2,fragmentShader:y2,blending:Yn,depthWrite:!1,depthTest:!1})}}class rh extends Rs{constructor({width:t=512,height:e=512,clipBias:i=0,blurIterations:n=8,blurFactor:s=1}={}){super(),this.clipBias=i,this.blurIterations=n,this.reflectorPlane=new Xn,this.normal=new wt,this.reflectorWorldPosition=new wt,this.cameraWorldPosition=new wt,this.rotationMatrix=new xi,this.lookAtPosition=new wt(0,0,-1),this.clipPlane=new Zi,this.view=new wt,this.target=new wt,this.q=new Zi,this.textureMatrix=new xi,this.virtualCamera=new tn,this.textureMatrixUniform=new Ni(this.textureMatrix),this.renderTarget=new on(t,e,{depthBuffer:!1}),this.renderTargetRead=this.renderTarget.clone(),this.renderTargetWrite=this.renderTarget.clone(),this.renderTarget.depthBuffer=!0,this.renderTargetUniform=new Ni(this.blurIterations>0?this.renderTargetRead.texture:this.renderTarget.texture),this.blurMaterial=new M2,this.blurMaterial.uniforms.uBluriness.value=s,this.blurMaterial.uniforms.uResolution.value.set(t,e),this.screenScene=new el,this.screenCamera=new Co(-1,1,1,-1,0,1),this.screenTriangle=g2(),this.screen=new en(this.screenTriangle,this.blurMaterial),this.screen.frustumCulled=!1,this.screenScene.add(this.screen)}setSize(t,e){this.renderTarget.setSize(t,e),this.renderTargetRead.setSize(t,e),this.renderTargetWrite.setSize(t,e),this.blurMaterial.uniforms.uResolution.value.set(t,e)}update(t,e,i){if(this.reflectorWorldPosition.setFromMatrixPosition(this.matrixWorld),this.cameraWorldPosition.setFromMatrixPosition(i.matrixWorld),this.rotationMatrix.extractRotation(this.matrixWorld),this.normal.set(0,0,1),this.normal.applyMatrix4(this.rotationMatrix),this.view.subVectors(this.reflectorWorldPosition,this.cameraWorldPosition),this.view.dot(this.normal)>0)return;this.view.reflect(this.normal).negate(),this.view.add(this.reflectorWorldPosition),this.rotationMatrix.extractRotation(i.matrixWorld),this.lookAtPosition.set(0,0,-1),this.lookAtPosition.applyMatrix4(this.rotationMatrix),this.lookAtPosition.add(this.cameraWorldPosition),this.target.subVectors(this.reflectorWorldPosition,this.lookAtPosition),this.target.reflect(this.normal).negate(),this.target.add(this.reflectorWorldPosition),this.virtualCamera.position.copy(this.view),this.virtualCamera.up.set(0,1,0),this.virtualCamera.up.applyMatrix4(this.rotationMatrix),this.virtualCamera.up.reflect(this.normal),this.virtualCamera.lookAt(this.target),this.virtualCamera.far=i.far,this.virtualCamera.updateMatrixWorld(),this.virtualCamera.projectionMatrix.copy(i.projectionMatrix),this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.virtualCamera.projectionMatrix),this.textureMatrix.multiply(this.virtualCamera.matrixWorldInverse),this.textureMatrix.multiply(this.matrixWorld),this.reflectorPlane.setFromNormalAndCoplanarPoint(this.normal,this.reflectorWorldPosition),this.reflectorPlane.applyMatrix4(this.virtualCamera.matrixWorldInverse),this.clipPlane.set(this.reflectorPlane.normal.x,this.reflectorPlane.normal.y,this.reflectorPlane.normal.z,this.reflectorPlane.constant);const n=this.virtualCamera.projectionMatrix;this.q.x=(Math.sign(this.clipPlane.x)+n.elements[8])/n.elements[0],this.q.y=(Math.sign(this.clipPlane.y)+n.elements[9])/n.elements[5],this.q.z=-1,this.q.w=(1+n.elements[10])/n.elements[14],this.clipPlane.multiplyScalar(2/this.clipPlane.dot(this.q)),n.elements[2]=this.clipPlane.x,n.elements[6]=this.clipPlane.y,n.elements[10]=this.clipPlane.z+1-this.clipBias,n.elements[14]=this.clipPlane.w;const s=t.getRenderTarget(),o=t.xr.enabled,r=t.shadowMap.autoUpdate;t.xr.enabled=!1,t.shadowMap.autoUpdate=!1,t.setRenderTarget(this.renderTarget),t.state.buffers.depth.setMask(!0),t.autoClear===!1&&t.clear(),t.render(e,this.virtualCamera);const _=this.blurIterations;for(let a=0;a<_;a++){a===0?this.blurMaterial.uniforms.tMap.value=this.renderTarget.texture:this.blurMaterial.uniforms.tMap.value=this.renderTargetRead.texture;const l=(_-a-1)*.5;this.blurMaterial.uniforms.uDirection.value.set(a%2===0?l:0,a%2===0?0:l),t.setRenderTarget(this.renderTargetWrite),t.autoClear===!1&&t.clear(),t.render(this.screenScene,this.screenCamera);const h=this.renderTargetRead;this.renderTargetRead=this.renderTargetWrite,this.renderTargetWrite=h,this.renderTargetUniform.value=this.renderTargetRead.texture}t.xr.enabled=o,t.shadowMap.autoUpdate=r,t.setRenderTarget(s)}destroy(){this.renderTargetWrite.dispose(),this.renderTargetRead.dispose(),this.renderTarget.dispose(),this.blurMaterial.dispose(),this.screenTriangle.dispose();for(const t in this)this[t]=null;return null}}var y=y||{};y.collision||(y.collision={});y.collision.broadphase||(y.collision.broadphase={});y.collision.broadphase.BroadPhase=class{constructor(t){this._type=t,this._numProxies=0,this._proxyList=null,this._proxyListLast=null,this._proxyPairList=null,this._incremental=!1,this._testCount=0,this._proxyPairPool=null,this._idCount=0,this._convexSweep=new y.collision.broadphase._BroadPhase.ConvexSweepGeometry,this._aabb=new y.collision.broadphase._BroadPhase.AabbGeometry,this.identity=new y.common.Transform,this.zero=new y.common.Vec3,this.rayCastHit=new y.collision.geometry.RayCastHit}createProxy(t,e){return null}destroyProxy(t){}moveProxy(t,e,i){}isOverlapping(t,e){return t._aabbMinX<e._aabbMaxX&&t._aabbMaxX>e._aabbMinX&&t._aabbMinY<e._aabbMaxY&&t._aabbMaxY>e._aabbMinY&&t._aabbMinZ<e._aabbMaxZ?t._aabbMaxZ>e._aabbMinZ:!1}collectPairs(){}getProxyPairList(){return this._proxyPairList}isIncremental(){return this._incremental}getTestCount(){return this._testCount}rayCast(t,e,i){}convexCast(t,e,i,n){}aabbTest(t,e){}};y.collision.geometry||(y.collision.geometry={});y.collision.geometry.Geometry=class{constructor(t){this._type=t,this._volume=0}_updateMass(){}_computeAabb(t,e){}_rayCastLocal(t,e,i,n,s,o,r){return!1}getType(){return this._type}getVolume(){return this._volume}rayCast(t,e,i,n){let s,o,r,_,a,l;s=t.x,o=t.y,r=t.z,_=e.x,a=e.y,l=e.z,s-=i._positionX,o-=i._positionY,r-=i._positionZ,_-=i._positionX,a-=i._positionY,l-=i._positionZ;let h,m,f;h=i._rotation00*s+i._rotation10*o+i._rotation20*r,m=i._rotation01*s+i._rotation11*o+i._rotation21*r,f=i._rotation02*s+i._rotation12*o+i._rotation22*r,s=h,o=m,r=f;let p,d,u;if(p=i._rotation00*_+i._rotation10*a+i._rotation20*l,d=i._rotation01*_+i._rotation11*a+i._rotation21*l,u=i._rotation02*_+i._rotation12*a+i._rotation22*l,_=p,a=d,l=u,this._rayCastLocal(s,o,r,_,a,l,n)){let g,v,x,b,Y,w,Z=n.position;g=Z.x,v=Z.y,x=Z.z;let X=n.normal;b=X.x,Y=X.y,w=X.z;let M,z,T;M=i._rotation00*g+i._rotation01*v+i._rotation02*x,z=i._rotation10*g+i._rotation11*v+i._rotation12*x,T=i._rotation20*g+i._rotation21*v+i._rotation22*x,g=M,v=z,x=T;let F,P,A;F=i._rotation00*b+i._rotation01*Y+i._rotation02*w,P=i._rotation10*b+i._rotation11*Y+i._rotation12*w,A=i._rotation20*b+i._rotation21*Y+i._rotation22*w,b=F,Y=P,w=A,g+=i._positionX,v+=i._positionY,x+=i._positionZ;let L=n.position;L.x=g,L.y=v,L.z=x;let S=n.normal;return S.x=b,S.y=Y,S.z=w,!0}return!1}};y.collision.geometry.ConvexGeometry=class extends y.collision.geometry.Geometry{constructor(t){super(t),this._gjkMargin=y.common.Setting.defaultGJKMargin,this._useGjkRayCast=!1}getGjkMergin(){return this._gjkMargin}setGjkMergin(t){t<0&&(t=0),this._gjkMargin=t}computeLocalSupportingVertex(t,e){}rayCast(t,e,i,n){return this._useGjkRayCast?y.collision.narrowphase.detector.gjkepa.GjkEpa.instance.rayCast(this,i,t,e,n):super.rayCast(t,e,i,n)}};y.collision.broadphase._BroadPhase||(y.collision.broadphase._BroadPhase={});y.collision.broadphase._BroadPhase.ConvexSweepGeometry=class extends y.collision.geometry.ConvexGeometry{constructor(){super(-1)}init(t,e,i){this.c=t;let n,s,o;n=i.x,s=i.y,o=i.z;let r,_,a,l,h,m;l=e._rotation00*n+e._rotation10*s+e._rotation20*o,h=e._rotation01*n+e._rotation11*s+e._rotation21*o,m=e._rotation02*n+e._rotation12*s+e._rotation22*o,r=l,_=h,a=m,this.localTranslation=new y.common.Vec3;let f=this.localTranslation;f.x=r,f.y=_,f.z=a,this._gjkMargin=t._gjkMargin}computeLocalSupportingVertex(t,e){this.c.computeLocalSupportingVertex(t,e);let i=this.localTranslation;if(t.x*i.x+t.y*i.y+t.z*i.z>0){let n=this.localTranslation;e.x+=n.x,e.y+=n.y,e.z+=n.z}}};y.collision.broadphase._BroadPhase.AabbGeometry=class extends y.collision.geometry.ConvexGeometry{constructor(){super(-1),this.min=new y.common.Vec3,this.max=new y.common.Vec3}computeLocalSupportingVertex(t,e){e.x=t.x>0?this.max.x:this.min.x,e.y=t.y>0?this.max.y:this.min.y,e.z=t.z>0?this.max.z:this.min.z}};y.collision.broadphase.BroadPhaseProxyCallback=class{constructor(){}process(t){}};y.collision.broadphase.BroadPhaseType=class{};y.collision.broadphase.Proxy=class{constructor(t,e){this.userData=t,this._id=e,this._prev=null,this._next=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}getId(){return this._id}getFatAabb(){let t=new y.collision.geometry.Aabb;return t._minX=this._aabbMinX,t._minY=this._aabbMinY,t._minZ=this._aabbMinZ,t._maxX=this._aabbMaxX,t._maxY=this._aabbMaxY,t._maxZ=this._aabbMaxZ,t}getFatAabbTo(t){t._minX=this._aabbMinX,t._minY=this._aabbMinY,t._minZ=this._aabbMinZ,t._maxX=this._aabbMaxX,t._maxY=this._aabbMaxY,t._maxZ=this._aabbMaxZ}};y.collision.broadphase.ProxyPair=class{constructor(){this._p1=null,this._p2=null}getProxy1(){return this._p1}getProxy2(){return this._p2}getNext(){return this._next}};y.collision.broadphase.bruteforce||(y.collision.broadphase.bruteforce={});y.collision.broadphase.bruteforce.BruteForceBroadPhase=class extends y.collision.broadphase.BroadPhase{constructor(){super(1),this._incremental=!1}createProxy(t,e){let i=new y.collision.broadphase.Proxy(t,this._idCount++);return this._numProxies++,this._proxyList==null?(this._proxyList=i,this._proxyListLast=i):(this._proxyListLast._next=i,i._prev=this._proxyListLast,this._proxyListLast=i),i._aabbMinX=e._minX,i._aabbMinY=e._minY,i._aabbMinZ=e._minZ,i._aabbMaxX=e._maxX,i._aabbMaxY=e._maxY,i._aabbMaxZ=e._maxZ,i}destroyProxy(t){this._numProxies--;let e=t._prev,i=t._next;e!=null&&(e._next=i),i!=null&&(i._prev=e),t==this._proxyList&&(this._proxyList=this._proxyList._next),t==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),t._next=null,t._prev=null,t.userData=null}moveProxy(t,e,i){t._aabbMinX=e._minX,t._aabbMinY=e._minY,t._aabbMinZ=e._minZ,t._aabbMaxX=e._maxX,t._aabbMaxY=e._maxY,t._aabbMaxZ=e._maxZ}collectPairs(){let t=this._proxyPairList;if(t!=null){for(;t._p1=null,t._p2=null,t=t._next,t!=null;);this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}this._testCount=0;let e=this._proxyList;for(;e!=null;){let i=e._next,n=e._next;for(;n!=null;){let s=n._next;if(this._testCount++,e._aabbMinX<n._aabbMaxX&&e._aabbMaxX>n._aabbMinX&&e._aabbMinY<n._aabbMaxY&&e._aabbMaxY>n._aabbMinY&&e._aabbMinZ<n._aabbMaxZ&&e._aabbMaxZ>n._aabbMinZ){let o=this._proxyPairPool;o!=null?(this._proxyPairPool=o._next,o._next=null):o=new y.collision.broadphase.ProxyPair;let r=o;this._proxyPairList==null?this._proxyPairList=r:(r._next=this._proxyPairList,this._proxyPairList=r),r._p1=e,r._p2=n}n=s}e=i}}rayCast(t,e,i){let n,s,o,r,_,a;n=t.x,s=t.y,o=t.z,r=e.x,_=e.y,a=e.z;let l=this._proxyList;for(;l!=null;){let h=l._next,m=n,f=s,p=o,d=r,u=_,g=a,v=l._aabbMinX,x=l._aabbMinY,b=l._aabbMinZ,Y=l._aabbMaxX,w=l._aabbMaxY,Z=l._aabbMaxZ,X;if(v>(m>d?m:d)||Y<(m<d?m:d)||x>(f>u?f:u)||w<(f<u?f:u)||b>(p>g?p:g)||Z<(p<g?p:g))X=!1;else{let M=d-m,z=u-f,T=g-p,F=M<0?-M:M,P=z<0?-z:z,A=T<0?-T:T,L=(Y-v)*.5,S=(w-x)*.5,R=(Z-b)*.5,E=m-(Y+v)*.5,C=f-(w+x)*.5,k=p-(Z+b)*.5,V,B,J=C*T-k*z;if((J<0?-J:J)-(S*A+R*P)>0)B=!0;else{let I=k*M-E*T;B=(I<0?-I:I)-(R*F+L*A)>0}if(B)V=!0;else{let I=E*z-C*M;V=(I<0?-I:I)-(L*P+S*F)>0}X=!V}X&&i.process(l),l=h}}convexCast(t,e,i,n){let s=this._proxyList;for(;s!=null;){let o=s._next,r=this._aabb.min;r.x=s._aabbMinX,r.y=s._aabbMinY,r.z=s._aabbMinZ;let _=this._aabb.max;_.x=s._aabbMaxX,_.y=s._aabbMaxY,_.z=s._aabbMaxZ,this._convexSweep.init(t,e,i);let a=y.collision.narrowphase.detector.gjkepa.GjkEpa.instance;a.computeClosestPointsImpl(this._convexSweep,this._aabb,e,this.identity,null,!1)==0&&a.distance<=0&&n.process(s),s=o}}aabbTest(t,e){let i=this._proxyList;for(;i!=null;){let n=i._next;t._minX<i._aabbMaxX&&t._maxX>i._aabbMinX&&t._minY<i._aabbMaxY&&t._maxY>i._aabbMinY&&t._minZ<i._aabbMaxZ&&t._maxZ>i._aabbMinZ&&e.process(i),i=n}}};y.collision.broadphase.bvh||(y.collision.broadphase.bvh={});y.collision.broadphase.bvh.BvhBroadPhase=class extends y.collision.broadphase.BroadPhase{constructor(){super(2),this._incremental=!0,this._tree=new y.collision.broadphase.bvh.BvhTree,this.movedProxies=new Array(1024),this.numMovedProxies=0}collide(t,e){this._testCount++;let i=t._height==0,n=e._height==0;if(t==e){if(i)return;this.collide(t._children[0],e),this.collide(t._children[1],e);return}if(t._aabbMinX<e._aabbMaxX&&t._aabbMaxX>e._aabbMinX&&t._aabbMinY<e._aabbMaxY&&t._aabbMaxY>e._aabbMinY&&t._aabbMinZ<e._aabbMaxZ&&t._aabbMaxZ>e._aabbMinZ){if(i&&n){let s=this._proxyPairPool;s!=null?(this._proxyPairPool=s._next,s._next=null):s=new y.collision.broadphase.ProxyPair;let o=s;this._proxyPairList==null?this._proxyPairList=o:(o._next=this._proxyPairList,this._proxyPairList=o),o._p1=t._proxy,o._p2=e._proxy;return}n||t._height>e._height?(this.collide(t._children[0],e),this.collide(t._children[1],e)):(this.collide(e._children[0],t),this.collide(e._children[1],t))}}rayCastRecursive(t,e,i,n,s,o,r,_){let a=e,l=i,h=n,m=s,f=o,p=r,d=t._aabbMinX,u=t._aabbMinY,g=t._aabbMinZ,v=t._aabbMaxX,x=t._aabbMaxY,b=t._aabbMaxZ,Y;if(d>(a>m?a:m)||v<(a<m?a:m)||u>(l>f?l:f)||x<(l<f?l:f)||g>(h>p?h:p)||b<(h<p?h:p))Y=!1;else{let w=m-a,Z=f-l,X=p-h,M=w<0?-w:w,z=Z<0?-Z:Z,T=X<0?-X:X,F=(v-d)*.5,P=(x-u)*.5,A=(b-g)*.5,L=a-(v+d)*.5,S=l-(x+u)*.5,R=h-(b+g)*.5,E,C,k=S*X-R*Z;if((k<0?-k:k)-(P*T+A*z)>0)C=!0;else{let V=R*w-L*X;C=(V<0?-V:V)-(A*M+F*T)>0}if(C)E=!0;else{let V=L*Z-S*w;E=(V<0?-V:V)-(F*z+P*M)>0}Y=!E}if(!!Y){if(t._height==0){_.process(t._proxy);return}this.rayCastRecursive(t._children[0],e,i,n,s,o,r,_),this.rayCastRecursive(t._children[1],e,i,n,s,o,r,_)}}convexCastRecursive(t,e,i,n,s){let o=this._aabb.min;o.x=t._aabbMinX,o.y=t._aabbMinY,o.z=t._aabbMinZ;let r=this._aabb.max;r.x=t._aabbMaxX,r.y=t._aabbMaxY,r.z=t._aabbMaxZ,this._convexSweep.init(e,i,n);let _=y.collision.narrowphase.detector.gjkepa.GjkEpa.instance;if(_.computeClosestPointsImpl(this._convexSweep,this._aabb,i,this.identity,null,!1)==0&&_.distance<=0){if(t._height==0){s.process(t._proxy);return}this.convexCastRecursive(t._children[0],e,i,n,s),this.convexCastRecursive(t._children[1],e,i,n,s)}}aabbTestRecursive(t,e,i){if(t._aabbMinX<e._maxX&&t._aabbMaxX>e._minX&&t._aabbMinY<e._maxY&&t._aabbMaxY>e._minY&&t._aabbMinZ<e._maxZ&&t._aabbMaxZ>e._minZ){if(t._height==0){i.process(t._proxy);return}this.aabbTestRecursive(t._children[0],e,i),this.aabbTestRecursive(t._children[1],e,i)}}createProxy(t,e){let i=new y.collision.broadphase.bvh.BvhProxy(t,this._idCount++);this._numProxies++,this._proxyList==null?(this._proxyList=i,this._proxyListLast=i):(this._proxyListLast._next=i,i._prev=this._proxyListLast,this._proxyListLast=i),i._aabbMinX=e._minX,i._aabbMinY=e._minY,i._aabbMinZ=e._minZ,i._aabbMaxX=e._maxX,i._aabbMaxY=e._maxY,i._aabbMaxZ=e._maxZ;let n=y.common.Setting.bvhProxyPadding;i._aabbMinX-=n,i._aabbMinY-=n,i._aabbMinZ-=n,i._aabbMaxX+=n,i._aabbMaxY+=n,i._aabbMaxZ+=n;let s=this._tree,o=s._nodePool;o!=null?(s._nodePool=o._next,o._next=null):o=new y.collision.broadphase.bvh.BvhNode;let r=o;if(r._proxy=i,i._leaf=r,r._aabbMinX=i._aabbMinX,r._aabbMinY=i._aabbMinY,r._aabbMinZ=i._aabbMinZ,r._aabbMaxX=i._aabbMaxX,r._aabbMaxY=i._aabbMaxY,r._aabbMaxZ=i._aabbMaxZ,s._numLeaves++,s.leafList==null?(s.leafList=r,s.leafListLast=r):(s.leafListLast._nextLeaf=r,r._prevLeaf=s.leafListLast,s.leafListLast=r),s._root==null)s._root=r;else{let _=s._root;for(;_._height>0;){let p=s._strategy._decideInsertion(_,r);if(p==-1)break;_=_._children[p]}let a=_._parent,l=s._nodePool;l!=null?(s._nodePool=l._next,l._next=null):l=new y.collision.broadphase.bvh.BvhNode;let h=l;if(a==null)s._root=h;else{let p=_._childIndex;a._children[p]=h,h._parent=a,h._childIndex=p}let m=_._childIndex;h._children[m]=_,_._parent=h,_._childIndex=m;let f=_._childIndex^1;for(h._children[f]=r,r._parent=h,r._childIndex=f;h!=null;){if(s._strategy._balancingEnabled&&h._height>=2){let v=h._parent,x=h._children[0],b=h._children[1],Y=x._height-b._height,w=h._childIndex;if(Y>1){let Z=x._children[0],X=x._children[1];if(Z._height>X._height){x._children[1]=h,h._parent=x,h._childIndex=1,h._children[0]=X,X._parent=h,X._childIndex=0;let M=x._children[0],z=x._children[1];x._aabbMinX=M._aabbMinX<z._aabbMinX?M._aabbMinX:z._aabbMinX,x._aabbMinY=M._aabbMinY<z._aabbMinY?M._aabbMinY:z._aabbMinY,x._aabbMinZ=M._aabbMinZ<z._aabbMinZ?M._aabbMinZ:z._aabbMinZ,x._aabbMaxX=M._aabbMaxX>z._aabbMaxX?M._aabbMaxX:z._aabbMaxX,x._aabbMaxY=M._aabbMaxY>z._aabbMaxY?M._aabbMaxY:z._aabbMaxY,x._aabbMaxZ=M._aabbMaxZ>z._aabbMaxZ?M._aabbMaxZ:z._aabbMaxZ;let T=x._children[0]._height,F=x._children[1]._height;x._height=(T>F?T:F)+1;let P=h._children[0],A=h._children[1];h._aabbMinX=P._aabbMinX<A._aabbMinX?P._aabbMinX:A._aabbMinX,h._aabbMinY=P._aabbMinY<A._aabbMinY?P._aabbMinY:A._aabbMinY,h._aabbMinZ=P._aabbMinZ<A._aabbMinZ?P._aabbMinZ:A._aabbMinZ,h._aabbMaxX=P._aabbMaxX>A._aabbMaxX?P._aabbMaxX:A._aabbMaxX,h._aabbMaxY=P._aabbMaxY>A._aabbMaxY?P._aabbMaxY:A._aabbMaxY,h._aabbMaxZ=P._aabbMaxZ>A._aabbMaxZ?P._aabbMaxZ:A._aabbMaxZ;let L=h._children[0]._height,S=h._children[1]._height;h._height=(L>S?L:S)+1}else{x._children[0]=h,h._parent=x,h._childIndex=0,h._children[0]=Z,Z._parent=h,Z._childIndex=0;let M=x._children[0],z=x._children[1];x._aabbMinX=M._aabbMinX<z._aabbMinX?M._aabbMinX:z._aabbMinX,x._aabbMinY=M._aabbMinY<z._aabbMinY?M._aabbMinY:z._aabbMinY,x._aabbMinZ=M._aabbMinZ<z._aabbMinZ?M._aabbMinZ:z._aabbMinZ,x._aabbMaxX=M._aabbMaxX>z._aabbMaxX?M._aabbMaxX:z._aabbMaxX,x._aabbMaxY=M._aabbMaxY>z._aabbMaxY?M._aabbMaxY:z._aabbMaxY,x._aabbMaxZ=M._aabbMaxZ>z._aabbMaxZ?M._aabbMaxZ:z._aabbMaxZ;let T=x._children[0]._height,F=x._children[1]._height;x._height=(T>F?T:F)+1;let P=h._children[0],A=h._children[1];h._aabbMinX=P._aabbMinX<A._aabbMinX?P._aabbMinX:A._aabbMinX,h._aabbMinY=P._aabbMinY<A._aabbMinY?P._aabbMinY:A._aabbMinY,h._aabbMinZ=P._aabbMinZ<A._aabbMinZ?P._aabbMinZ:A._aabbMinZ,h._aabbMaxX=P._aabbMaxX>A._aabbMaxX?P._aabbMaxX:A._aabbMaxX,h._aabbMaxY=P._aabbMaxY>A._aabbMaxY?P._aabbMaxY:A._aabbMaxY,h._aabbMaxZ=P._aabbMaxZ>A._aabbMaxZ?P._aabbMaxZ:A._aabbMaxZ;let L=h._children[0]._height,S=h._children[1]._height;h._height=(L>S?L:S)+1}v!=null?(v._children[w]=x,x._parent=v,x._childIndex=w):(s._root=x,x._parent=null),h=x}else if(Y<-1){let Z=b._children[0],X=b._children[1];if(Z._height>X._height){b._children[1]=h,h._parent=b,h._childIndex=1,h._children[1]=X,X._parent=h,X._childIndex=1;let M=b._children[0],z=b._children[1];b._aabbMinX=M._aabbMinX<z._aabbMinX?M._aabbMinX:z._aabbMinX,b._aabbMinY=M._aabbMinY<z._aabbMinY?M._aabbMinY:z._aabbMinY,b._aabbMinZ=M._aabbMinZ<z._aabbMinZ?M._aabbMinZ:z._aabbMinZ,b._aabbMaxX=M._aabbMaxX>z._aabbMaxX?M._aabbMaxX:z._aabbMaxX,b._aabbMaxY=M._aabbMaxY>z._aabbMaxY?M._aabbMaxY:z._aabbMaxY,b._aabbMaxZ=M._aabbMaxZ>z._aabbMaxZ?M._aabbMaxZ:z._aabbMaxZ;let T=b._children[0]._height,F=b._children[1]._height;b._height=(T>F?T:F)+1;let P=h._children[0],A=h._children[1];h._aabbMinX=P._aabbMinX<A._aabbMinX?P._aabbMinX:A._aabbMinX,h._aabbMinY=P._aabbMinY<A._aabbMinY?P._aabbMinY:A._aabbMinY,h._aabbMinZ=P._aabbMinZ<A._aabbMinZ?P._aabbMinZ:A._aabbMinZ,h._aabbMaxX=P._aabbMaxX>A._aabbMaxX?P._aabbMaxX:A._aabbMaxX,h._aabbMaxY=P._aabbMaxY>A._aabbMaxY?P._aabbMaxY:A._aabbMaxY,h._aabbMaxZ=P._aabbMaxZ>A._aabbMaxZ?P._aabbMaxZ:A._aabbMaxZ;let L=h._children[0]._height,S=h._children[1]._height;h._height=(L>S?L:S)+1}else{b._children[0]=h,h._parent=b,h._childIndex=0,h._children[1]=Z,Z._parent=h,Z._childIndex=1;let M=b._children[0],z=b._children[1];b._aabbMinX=M._aabbMinX<z._aabbMinX?M._aabbMinX:z._aabbMinX,b._aabbMinY=M._aabbMinY<z._aabbMinY?M._aabbMinY:z._aabbMinY,b._aabbMinZ=M._aabbMinZ<z._aabbMinZ?M._aabbMinZ:z._aabbMinZ,b._aabbMaxX=M._aabbMaxX>z._aabbMaxX?M._aabbMaxX:z._aabbMaxX,b._aabbMaxY=M._aabbMaxY>z._aabbMaxY?M._aabbMaxY:z._aabbMaxY,b._aabbMaxZ=M._aabbMaxZ>z._aabbMaxZ?M._aabbMaxZ:z._aabbMaxZ;let T=b._children[0]._height,F=b._children[1]._height;b._height=(T>F?T:F)+1;let P=h._children[0],A=h._children[1];h._aabbMinX=P._aabbMinX<A._aabbMinX?P._aabbMinX:A._aabbMinX,h._aabbMinY=P._aabbMinY<A._aabbMinY?P._aabbMinY:A._aabbMinY,h._aabbMinZ=P._aabbMinZ<A._aabbMinZ?P._aabbMinZ:A._aabbMinZ,h._aabbMaxX=P._aabbMaxX>A._aabbMaxX?P._aabbMaxX:A._aabbMaxX,h._aabbMaxY=P._aabbMaxY>A._aabbMaxY?P._aabbMaxY:A._aabbMaxY,h._aabbMaxZ=P._aabbMaxZ>A._aabbMaxZ?P._aabbMaxZ:A._aabbMaxZ;let L=h._children[0]._height,S=h._children[1]._height;h._height=(L>S?L:S)+1}v!=null?(v._children[w]=b,b._parent=v,b._childIndex=w):(s._root=b,b._parent=null),h=b}}let p=h._children[0]._height,d=h._children[1]._height;h._height=(p>d?p:d)+1;let u=h._children[0],g=h._children[1];h._aabbMinX=u._aabbMinX<g._aabbMinX?u._aabbMinX:g._aabbMinX,h._aabbMinY=u._aabbMinY<g._aabbMinY?u._aabbMinY:g._aabbMinY,h._aabbMinZ=u._aabbMinZ<g._aabbMinZ?u._aabbMinZ:g._aabbMinZ,h._aabbMaxX=u._aabbMaxX>g._aabbMaxX?u._aabbMaxX:g._aabbMaxX,h._aabbMaxY=u._aabbMaxY>g._aabbMaxY?u._aabbMaxY:g._aabbMaxY,h._aabbMaxZ=u._aabbMaxZ>g._aabbMaxZ?u._aabbMaxZ:g._aabbMaxZ,h=h._parent}}if(!i._moved){if(i._moved=!0,this.movedProxies.length==this.numMovedProxies){let _=new Array(this.numMovedProxies<<1),a=0,l=this.numMovedProxies;for(;a<l;){let h=a++;_[h]=this.movedProxies[h],this.movedProxies[h]=null}this.movedProxies=_}this.movedProxies[this.numMovedProxies++]=i}return i}destroyProxy(t){this._numProxies--;let e=t._prev,i=t._next;e!=null&&(e._next=i),i!=null&&(i._prev=e),t==this._proxyList&&(this._proxyList=this._proxyList._next),t==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),t._next=null,t._prev=null;let n=t,s=this._tree,o=n._leaf;s._numLeaves--;let r=o._prevLeaf,_=o._nextLeaf;if(r!=null&&(r._nextLeaf=_),_!=null&&(_._prevLeaf=r),o==s.leafList&&(s.leafList=s.leafList._nextLeaf),o==s.leafListLast&&(s.leafListLast=s.leafListLast._prevLeaf),o._nextLeaf=null,o._prevLeaf=null,s._root==o)s._root=null;else{let a=o._parent,l=a._children[o._childIndex^1],h=a._parent;if(h==null)l._parent=null,l._childIndex=0,s._root=l,a._next=null,a._childIndex=0,a._children[0]=null,a._children[1]=null,a._childIndex=0,a._parent=null,a._height=0,a._proxy=null,a._next=s._nodePool,s._nodePool=a;else{l._parent=h;let m=a._childIndex;h._children[m]=l,l._parent=h,l._childIndex=m,a._next=null,a._childIndex=0,a._children[0]=null,a._children[1]=null,a._childIndex=0,a._parent=null,a._height=0,a._proxy=null,a._next=s._nodePool,s._nodePool=a;let f=h;for(;f!=null;){if(s._strategy._balancingEnabled&&f._height>=2){let v=f._parent,x=f._children[0],b=f._children[1],Y=x._height-b._height,w=f._childIndex;if(Y>1){let Z=x._children[0],X=x._children[1];if(Z._height>X._height){x._children[1]=f,f._parent=x,f._childIndex=1,f._children[0]=X,X._parent=f,X._childIndex=0;let M=x._children[0],z=x._children[1];x._aabbMinX=M._aabbMinX<z._aabbMinX?M._aabbMinX:z._aabbMinX,x._aabbMinY=M._aabbMinY<z._aabbMinY?M._aabbMinY:z._aabbMinY,x._aabbMinZ=M._aabbMinZ<z._aabbMinZ?M._aabbMinZ:z._aabbMinZ,x._aabbMaxX=M._aabbMaxX>z._aabbMaxX?M._aabbMaxX:z._aabbMaxX,x._aabbMaxY=M._aabbMaxY>z._aabbMaxY?M._aabbMaxY:z._aabbMaxY,x._aabbMaxZ=M._aabbMaxZ>z._aabbMaxZ?M._aabbMaxZ:z._aabbMaxZ;let T=x._children[0]._height,F=x._children[1]._height;x._height=(T>F?T:F)+1;let P=f._children[0],A=f._children[1];f._aabbMinX=P._aabbMinX<A._aabbMinX?P._aabbMinX:A._aabbMinX,f._aabbMinY=P._aabbMinY<A._aabbMinY?P._aabbMinY:A._aabbMinY,f._aabbMinZ=P._aabbMinZ<A._aabbMinZ?P._aabbMinZ:A._aabbMinZ,f._aabbMaxX=P._aabbMaxX>A._aabbMaxX?P._aabbMaxX:A._aabbMaxX,f._aabbMaxY=P._aabbMaxY>A._aabbMaxY?P._aabbMaxY:A._aabbMaxY,f._aabbMaxZ=P._aabbMaxZ>A._aabbMaxZ?P._aabbMaxZ:A._aabbMaxZ;let L=f._children[0]._height,S=f._children[1]._height;f._height=(L>S?L:S)+1}else{x._children[0]=f,f._parent=x,f._childIndex=0,f._children[0]=Z,Z._parent=f,Z._childIndex=0;let M=x._children[0],z=x._children[1];x._aabbMinX=M._aabbMinX<z._aabbMinX?M._aabbMinX:z._aabbMinX,x._aabbMinY=M._aabbMinY<z._aabbMinY?M._aabbMinY:z._aabbMinY,x._aabbMinZ=M._aabbMinZ<z._aabbMinZ?M._aabbMinZ:z._aabbMinZ,x._aabbMaxX=M._aabbMaxX>z._aabbMaxX?M._aabbMaxX:z._aabbMaxX,x._aabbMaxY=M._aabbMaxY>z._aabbMaxY?M._aabbMaxY:z._aabbMaxY,x._aabbMaxZ=M._aabbMaxZ>z._aabbMaxZ?M._aabbMaxZ:z._aabbMaxZ;let T=x._children[0]._height,F=x._children[1]._height;x._height=(T>F?T:F)+1;let P=f._children[0],A=f._children[1];f._aabbMinX=P._aabbMinX<A._aabbMinX?P._aabbMinX:A._aabbMinX,f._aabbMinY=P._aabbMinY<A._aabbMinY?P._aabbMinY:A._aabbMinY,f._aabbMinZ=P._aabbMinZ<A._aabbMinZ?P._aabbMinZ:A._aabbMinZ,f._aabbMaxX=P._aabbMaxX>A._aabbMaxX?P._aabbMaxX:A._aabbMaxX,f._aabbMaxY=P._aabbMaxY>A._aabbMaxY?P._aabbMaxY:A._aabbMaxY,f._aabbMaxZ=P._aabbMaxZ>A._aabbMaxZ?P._aabbMaxZ:A._aabbMaxZ;let L=f._children[0]._height,S=f._children[1]._height;f._height=(L>S?L:S)+1}v!=null?(v._children[w]=x,x._parent=v,x._childIndex=w):(s._root=x,x._parent=null),f=x}else if(Y<-1){let Z=b._children[0],X=b._children[1];if(Z._height>X._height){b._children[1]=f,f._parent=b,f._childIndex=1,f._children[1]=X,X._parent=f,X._childIndex=1;let M=b._children[0],z=b._children[1];b._aabbMinX=M._aabbMinX<z._aabbMinX?M._aabbMinX:z._aabbMinX,b._aabbMinY=M._aabbMinY<z._aabbMinY?M._aabbMinY:z._aabbMinY,b._aabbMinZ=M._aabbMinZ<z._aabbMinZ?M._aabbMinZ:z._aabbMinZ,b._aabbMaxX=M._aabbMaxX>z._aabbMaxX?M._aabbMaxX:z._aabbMaxX,b._aabbMaxY=M._aabbMaxY>z._aabbMaxY?M._aabbMaxY:z._aabbMaxY,b._aabbMaxZ=M._aabbMaxZ>z._aabbMaxZ?M._aabbMaxZ:z._aabbMaxZ;let T=b._children[0]._height,F=b._children[1]._height;b._height=(T>F?T:F)+1;let P=f._children[0],A=f._children[1];f._aabbMinX=P._aabbMinX<A._aabbMinX?P._aabbMinX:A._aabbMinX,f._aabbMinY=P._aabbMinY<A._aabbMinY?P._aabbMinY:A._aabbMinY,f._aabbMinZ=P._aabbMinZ<A._aabbMinZ?P._aabbMinZ:A._aabbMinZ,f._aabbMaxX=P._aabbMaxX>A._aabbMaxX?P._aabbMaxX:A._aabbMaxX,f._aabbMaxY=P._aabbMaxY>A._aabbMaxY?P._aabbMaxY:A._aabbMaxY,f._aabbMaxZ=P._aabbMaxZ>A._aabbMaxZ?P._aabbMaxZ:A._aabbMaxZ;let L=f._children[0]._height,S=f._children[1]._height;f._height=(L>S?L:S)+1}else{b._children[0]=f,f._parent=b,f._childIndex=0,f._children[1]=Z,Z._parent=f,Z._childIndex=1;let M=b._children[0],z=b._children[1];b._aabbMinX=M._aabbMinX<z._aabbMinX?M._aabbMinX:z._aabbMinX,b._aabbMinY=M._aabbMinY<z._aabbMinY?M._aabbMinY:z._aabbMinY,b._aabbMinZ=M._aabbMinZ<z._aabbMinZ?M._aabbMinZ:z._aabbMinZ,b._aabbMaxX=M._aabbMaxX>z._aabbMaxX?M._aabbMaxX:z._aabbMaxX,b._aabbMaxY=M._aabbMaxY>z._aabbMaxY?M._aabbMaxY:z._aabbMaxY,b._aabbMaxZ=M._aabbMaxZ>z._aabbMaxZ?M._aabbMaxZ:z._aabbMaxZ;let T=b._children[0]._height,F=b._children[1]._height;b._height=(T>F?T:F)+1;let P=f._children[0],A=f._children[1];f._aabbMinX=P._aabbMinX<A._aabbMinX?P._aabbMinX:A._aabbMinX,f._aabbMinY=P._aabbMinY<A._aabbMinY?P._aabbMinY:A._aabbMinY,f._aabbMinZ=P._aabbMinZ<A._aabbMinZ?P._aabbMinZ:A._aabbMinZ,f._aabbMaxX=P._aabbMaxX>A._aabbMaxX?P._aabbMaxX:A._aabbMaxX,f._aabbMaxY=P._aabbMaxY>A._aabbMaxY?P._aabbMaxY:A._aabbMaxY,f._aabbMaxZ=P._aabbMaxZ>A._aabbMaxZ?P._aabbMaxZ:A._aabbMaxZ;let L=f._children[0]._height,S=f._children[1]._height;f._height=(L>S?L:S)+1}v!=null?(v._children[w]=b,b._parent=v,b._childIndex=w):(s._root=b,b._parent=null),f=b}}let p=f._children[0]._height,d=f._children[1]._height;f._height=(p>d?p:d)+1;let u=f._children[0],g=f._children[1];f._aabbMinX=u._aabbMinX<g._aabbMinX?u._aabbMinX:g._aabbMinX,f._aabbMinY=u._aabbMinY<g._aabbMinY?u._aabbMinY:g._aabbMinY,f._aabbMinZ=u._aabbMinZ<g._aabbMinZ?u._aabbMinZ:g._aabbMinZ,f._aabbMaxX=u._aabbMaxX>g._aabbMaxX?u._aabbMaxX:g._aabbMaxX,f._aabbMaxY=u._aabbMaxY>g._aabbMaxY?u._aabbMaxY:g._aabbMaxY,f._aabbMaxZ=u._aabbMaxZ>g._aabbMaxZ?u._aabbMaxZ:g._aabbMaxZ,f=f._parent}}}n._leaf=null,o._next=null,o._childIndex=0,o._children[0]=null,o._children[1]=null,o._childIndex=0,o._parent=null,o._height=0,o._proxy=null,o._next=s._nodePool,s._nodePool=o,n.userData=null,n._next=null,n._prev=null,n._moved&&(n._moved=!1)}moveProxy(t,e,i){let n=t;if(n._aabbMinX<=e._minX&&n._aabbMaxX>=e._maxX&&n._aabbMinY<=e._minY&&n._aabbMaxY>=e._maxY&&n._aabbMinZ<=e._minZ&&n._aabbMaxZ>=e._maxZ)return;n._aabbMinX=e._minX,n._aabbMinY=e._minY,n._aabbMinZ=e._minZ,n._aabbMaxX=e._maxX,n._aabbMaxY=e._maxY,n._aabbMaxZ=e._maxZ;let s=y.common.Setting.bvhProxyPadding;if(n._aabbMinX-=s,n._aabbMinY-=s,n._aabbMinZ-=s,n._aabbMaxX+=s,n._aabbMaxY+=s,n._aabbMaxZ+=s,i!=null){let o,r,_,a,l,h,m,f,p,d,u,g;a=0,l=0,h=0,o=i.x,r=i.y,_=i.z,m=a<o?a:o,f=l<r?l:r,p=h<_?h:_,d=a>o?a:o,u=l>r?l:r,g=h>_?h:_,n._aabbMinX+=m,n._aabbMinY+=f,n._aabbMinZ+=p,n._aabbMaxX+=d,n._aabbMaxY+=u,n._aabbMaxZ+=g}if(!n._moved){if(n._moved=!0,this.movedProxies.length==this.numMovedProxies){let o=new Array(this.numMovedProxies<<1),r=0,_=this.numMovedProxies;for(;r<_;){let a=r++;o[a]=this.movedProxies[a],this.movedProxies[a]=null}this.movedProxies=o}this.movedProxies[this.numMovedProxies++]=n}}collectPairs(){let t=this._proxyPairList;if(t!=null){for(;t._p1=null,t._p2=null,t=t._next,t!=null;);this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}if(this._testCount=0,this._numProxies<2)return;let e=this.numMovedProxies/this._numProxies<y.common.Setting.bvhIncrementalCollisionThreshold,i=0,n=this.numMovedProxies;for(;i<n;){let s=i++,o=this.movedProxies[s];if(o._moved){let r=this._tree,_=o._leaf;r._numLeaves--;let a=_._prevLeaf,l=_._nextLeaf;if(a!=null&&(a._nextLeaf=l),l!=null&&(l._prevLeaf=a),_==r.leafList&&(r.leafList=r.leafList._nextLeaf),_==r.leafListLast&&(r.leafListLast=r.leafListLast._prevLeaf),_._nextLeaf=null,_._prevLeaf=null,r._root==_)r._root=null;else{let p=_._parent,d=p._children[_._childIndex^1],u=p._parent;if(u==null)d._parent=null,d._childIndex=0,r._root=d,p._next=null,p._childIndex=0,p._children[0]=null,p._children[1]=null,p._childIndex=0,p._parent=null,p._height=0,p._proxy=null,p._next=r._nodePool,r._nodePool=p;else{d._parent=u;let g=p._childIndex;u._children[g]=d,d._parent=u,d._childIndex=g,p._next=null,p._childIndex=0,p._children[0]=null,p._children[1]=null,p._childIndex=0,p._parent=null,p._height=0,p._proxy=null,p._next=r._nodePool,r._nodePool=p;let v=u;for(;v!=null;){if(r._strategy._balancingEnabled&&v._height>=2){let Z=v._parent,X=v._children[0],M=v._children[1],z=X._height-M._height,T=v._childIndex;if(z>1){let F=X._children[0],P=X._children[1];if(F._height>P._height){X._children[1]=v,v._parent=X,v._childIndex=1,v._children[0]=P,P._parent=v,P._childIndex=0;let A=X._children[0],L=X._children[1];X._aabbMinX=A._aabbMinX<L._aabbMinX?A._aabbMinX:L._aabbMinX,X._aabbMinY=A._aabbMinY<L._aabbMinY?A._aabbMinY:L._aabbMinY,X._aabbMinZ=A._aabbMinZ<L._aabbMinZ?A._aabbMinZ:L._aabbMinZ,X._aabbMaxX=A._aabbMaxX>L._aabbMaxX?A._aabbMaxX:L._aabbMaxX,X._aabbMaxY=A._aabbMaxY>L._aabbMaxY?A._aabbMaxY:L._aabbMaxY,X._aabbMaxZ=A._aabbMaxZ>L._aabbMaxZ?A._aabbMaxZ:L._aabbMaxZ;let S=X._children[0]._height,R=X._children[1]._height;X._height=(S>R?S:R)+1;let E=v._children[0],C=v._children[1];v._aabbMinX=E._aabbMinX<C._aabbMinX?E._aabbMinX:C._aabbMinX,v._aabbMinY=E._aabbMinY<C._aabbMinY?E._aabbMinY:C._aabbMinY,v._aabbMinZ=E._aabbMinZ<C._aabbMinZ?E._aabbMinZ:C._aabbMinZ,v._aabbMaxX=E._aabbMaxX>C._aabbMaxX?E._aabbMaxX:C._aabbMaxX,v._aabbMaxY=E._aabbMaxY>C._aabbMaxY?E._aabbMaxY:C._aabbMaxY,v._aabbMaxZ=E._aabbMaxZ>C._aabbMaxZ?E._aabbMaxZ:C._aabbMaxZ;let k=v._children[0]._height,V=v._children[1]._height;v._height=(k>V?k:V)+1}else{X._children[0]=v,v._parent=X,v._childIndex=0,v._children[0]=F,F._parent=v,F._childIndex=0;let A=X._children[0],L=X._children[1];X._aabbMinX=A._aabbMinX<L._aabbMinX?A._aabbMinX:L._aabbMinX,X._aabbMinY=A._aabbMinY<L._aabbMinY?A._aabbMinY:L._aabbMinY,X._aabbMinZ=A._aabbMinZ<L._aabbMinZ?A._aabbMinZ:L._aabbMinZ,X._aabbMaxX=A._aabbMaxX>L._aabbMaxX?A._aabbMaxX:L._aabbMaxX,X._aabbMaxY=A._aabbMaxY>L._aabbMaxY?A._aabbMaxY:L._aabbMaxY,X._aabbMaxZ=A._aabbMaxZ>L._aabbMaxZ?A._aabbMaxZ:L._aabbMaxZ;let S=X._children[0]._height,R=X._children[1]._height;X._height=(S>R?S:R)+1;let E=v._children[0],C=v._children[1];v._aabbMinX=E._aabbMinX<C._aabbMinX?E._aabbMinX:C._aabbMinX,v._aabbMinY=E._aabbMinY<C._aabbMinY?E._aabbMinY:C._aabbMinY,v._aabbMinZ=E._aabbMinZ<C._aabbMinZ?E._aabbMinZ:C._aabbMinZ,v._aabbMaxX=E._aabbMaxX>C._aabbMaxX?E._aabbMaxX:C._aabbMaxX,v._aabbMaxY=E._aabbMaxY>C._aabbMaxY?E._aabbMaxY:C._aabbMaxY,v._aabbMaxZ=E._aabbMaxZ>C._aabbMaxZ?E._aabbMaxZ:C._aabbMaxZ;let k=v._children[0]._height,V=v._children[1]._height;v._height=(k>V?k:V)+1}Z!=null?(Z._children[T]=X,X._parent=Z,X._childIndex=T):(r._root=X,X._parent=null),v=X}else if(z<-1){let F=M._children[0],P=M._children[1];if(F._height>P._height){M._children[1]=v,v._parent=M,v._childIndex=1,v._children[1]=P,P._parent=v,P._childIndex=1;let A=M._children[0],L=M._children[1];M._aabbMinX=A._aabbMinX<L._aabbMinX?A._aabbMinX:L._aabbMinX,M._aabbMinY=A._aabbMinY<L._aabbMinY?A._aabbMinY:L._aabbMinY,M._aabbMinZ=A._aabbMinZ<L._aabbMinZ?A._aabbMinZ:L._aabbMinZ,M._aabbMaxX=A._aabbMaxX>L._aabbMaxX?A._aabbMaxX:L._aabbMaxX,M._aabbMaxY=A._aabbMaxY>L._aabbMaxY?A._aabbMaxY:L._aabbMaxY,M._aabbMaxZ=A._aabbMaxZ>L._aabbMaxZ?A._aabbMaxZ:L._aabbMaxZ;let S=M._children[0]._height,R=M._children[1]._height;M._height=(S>R?S:R)+1;let E=v._children[0],C=v._children[1];v._aabbMinX=E._aabbMinX<C._aabbMinX?E._aabbMinX:C._aabbMinX,v._aabbMinY=E._aabbMinY<C._aabbMinY?E._aabbMinY:C._aabbMinY,v._aabbMinZ=E._aabbMinZ<C._aabbMinZ?E._aabbMinZ:C._aabbMinZ,v._aabbMaxX=E._aabbMaxX>C._aabbMaxX?E._aabbMaxX:C._aabbMaxX,v._aabbMaxY=E._aabbMaxY>C._aabbMaxY?E._aabbMaxY:C._aabbMaxY,v._aabbMaxZ=E._aabbMaxZ>C._aabbMaxZ?E._aabbMaxZ:C._aabbMaxZ;let k=v._children[0]._height,V=v._children[1]._height;v._height=(k>V?k:V)+1}else{M._children[0]=v,v._parent=M,v._childIndex=0,v._children[1]=F,F._parent=v,F._childIndex=1;let A=M._children[0],L=M._children[1];M._aabbMinX=A._aabbMinX<L._aabbMinX?A._aabbMinX:L._aabbMinX,M._aabbMinY=A._aabbMinY<L._aabbMinY?A._aabbMinY:L._aabbMinY,M._aabbMinZ=A._aabbMinZ<L._aabbMinZ?A._aabbMinZ:L._aabbMinZ,M._aabbMaxX=A._aabbMaxX>L._aabbMaxX?A._aabbMaxX:L._aabbMaxX,M._aabbMaxY=A._aabbMaxY>L._aabbMaxY?A._aabbMaxY:L._aabbMaxY,M._aabbMaxZ=A._aabbMaxZ>L._aabbMaxZ?A._aabbMaxZ:L._aabbMaxZ;let S=M._children[0]._height,R=M._children[1]._height;M._height=(S>R?S:R)+1;let E=v._children[0],C=v._children[1];v._aabbMinX=E._aabbMinX<C._aabbMinX?E._aabbMinX:C._aabbMinX,v._aabbMinY=E._aabbMinY<C._aabbMinY?E._aabbMinY:C._aabbMinY,v._aabbMinZ=E._aabbMinZ<C._aabbMinZ?E._aabbMinZ:C._aabbMinZ,v._aabbMaxX=E._aabbMaxX>C._aabbMaxX?E._aabbMaxX:C._aabbMaxX,v._aabbMaxY=E._aabbMaxY>C._aabbMaxY?E._aabbMaxY:C._aabbMaxY,v._aabbMaxZ=E._aabbMaxZ>C._aabbMaxZ?E._aabbMaxZ:C._aabbMaxZ;let k=v._children[0]._height,V=v._children[1]._height;v._height=(k>V?k:V)+1}Z!=null?(Z._children[T]=M,M._parent=Z,M._childIndex=T):(r._root=M,M._parent=null),v=M}}let x=v._children[0]._height,b=v._children[1]._height;v._height=(x>b?x:b)+1;let Y=v._children[0],w=v._children[1];v._aabbMinX=Y._aabbMinX<w._aabbMinX?Y._aabbMinX:w._aabbMinX,v._aabbMinY=Y._aabbMinY<w._aabbMinY?Y._aabbMinY:w._aabbMinY,v._aabbMinZ=Y._aabbMinZ<w._aabbMinZ?Y._aabbMinZ:w._aabbMinZ,v._aabbMaxX=Y._aabbMaxX>w._aabbMaxX?Y._aabbMaxX:w._aabbMaxX,v._aabbMaxY=Y._aabbMaxY>w._aabbMaxY?Y._aabbMaxY:w._aabbMaxY,v._aabbMaxZ=Y._aabbMaxZ>w._aabbMaxZ?Y._aabbMaxZ:w._aabbMaxZ,v=v._parent}}}o._leaf=null,_._next=null,_._childIndex=0,_._children[0]=null,_._children[1]=null,_._childIndex=0,_._parent=null,_._height=0,_._proxy=null,_._next=r._nodePool,r._nodePool=_;let h=this._tree,m=h._nodePool;m!=null?(h._nodePool=m._next,m._next=null):m=new y.collision.broadphase.bvh.BvhNode;let f=m;if(f._proxy=o,o._leaf=f,f._aabbMinX=o._aabbMinX,f._aabbMinY=o._aabbMinY,f._aabbMinZ=o._aabbMinZ,f._aabbMaxX=o._aabbMaxX,f._aabbMaxY=o._aabbMaxY,f._aabbMaxZ=o._aabbMaxZ,h._numLeaves++,h.leafList==null?(h.leafList=f,h.leafListLast=f):(h.leafListLast._nextLeaf=f,f._prevLeaf=h.leafListLast,h.leafListLast=f),h._root==null)h._root=f;else{let p=h._root;for(;p._height>0;){let b=h._strategy._decideInsertion(p,f);if(b==-1)break;p=p._children[b]}let d=p._parent,u=h._nodePool;u!=null?(h._nodePool=u._next,u._next=null):u=new y.collision.broadphase.bvh.BvhNode;let g=u;if(d==null)h._root=g;else{let b=p._childIndex;d._children[b]=g,g._parent=d,g._childIndex=b}let v=p._childIndex;g._children[v]=p,p._parent=g,p._childIndex=v;let x=p._childIndex^1;for(g._children[x]=f,f._parent=g,f._childIndex=x;g!=null;){if(h._strategy._balancingEnabled&&g._height>=2){let X=g._parent,M=g._children[0],z=g._children[1],T=M._height-z._height,F=g._childIndex;if(T>1){let P=M._children[0],A=M._children[1];if(P._height>A._height){M._children[1]=g,g._parent=M,g._childIndex=1,g._children[0]=A,A._parent=g,A._childIndex=0;let L=M._children[0],S=M._children[1];M._aabbMinX=L._aabbMinX<S._aabbMinX?L._aabbMinX:S._aabbMinX,M._aabbMinY=L._aabbMinY<S._aabbMinY?L._aabbMinY:S._aabbMinY,M._aabbMinZ=L._aabbMinZ<S._aabbMinZ?L._aabbMinZ:S._aabbMinZ,M._aabbMaxX=L._aabbMaxX>S._aabbMaxX?L._aabbMaxX:S._aabbMaxX,M._aabbMaxY=L._aabbMaxY>S._aabbMaxY?L._aabbMaxY:S._aabbMaxY,M._aabbMaxZ=L._aabbMaxZ>S._aabbMaxZ?L._aabbMaxZ:S._aabbMaxZ;let R=M._children[0]._height,E=M._children[1]._height;M._height=(R>E?R:E)+1;let C=g._children[0],k=g._children[1];g._aabbMinX=C._aabbMinX<k._aabbMinX?C._aabbMinX:k._aabbMinX,g._aabbMinY=C._aabbMinY<k._aabbMinY?C._aabbMinY:k._aabbMinY,g._aabbMinZ=C._aabbMinZ<k._aabbMinZ?C._aabbMinZ:k._aabbMinZ,g._aabbMaxX=C._aabbMaxX>k._aabbMaxX?C._aabbMaxX:k._aabbMaxX,g._aabbMaxY=C._aabbMaxY>k._aabbMaxY?C._aabbMaxY:k._aabbMaxY,g._aabbMaxZ=C._aabbMaxZ>k._aabbMaxZ?C._aabbMaxZ:k._aabbMaxZ;let V=g._children[0]._height,B=g._children[1]._height;g._height=(V>B?V:B)+1}else{M._children[0]=g,g._parent=M,g._childIndex=0,g._children[0]=P,P._parent=g,P._childIndex=0;let L=M._children[0],S=M._children[1];M._aabbMinX=L._aabbMinX<S._aabbMinX?L._aabbMinX:S._aabbMinX,M._aabbMinY=L._aabbMinY<S._aabbMinY?L._aabbMinY:S._aabbMinY,M._aabbMinZ=L._aabbMinZ<S._aabbMinZ?L._aabbMinZ:S._aabbMinZ,M._aabbMaxX=L._aabbMaxX>S._aabbMaxX?L._aabbMaxX:S._aabbMaxX,M._aabbMaxY=L._aabbMaxY>S._aabbMaxY?L._aabbMaxY:S._aabbMaxY,M._aabbMaxZ=L._aabbMaxZ>S._aabbMaxZ?L._aabbMaxZ:S._aabbMaxZ;let R=M._children[0]._height,E=M._children[1]._height;M._height=(R>E?R:E)+1;let C=g._children[0],k=g._children[1];g._aabbMinX=C._aabbMinX<k._aabbMinX?C._aabbMinX:k._aabbMinX,g._aabbMinY=C._aabbMinY<k._aabbMinY?C._aabbMinY:k._aabbMinY,g._aabbMinZ=C._aabbMinZ<k._aabbMinZ?C._aabbMinZ:k._aabbMinZ,g._aabbMaxX=C._aabbMaxX>k._aabbMaxX?C._aabbMaxX:k._aabbMaxX,g._aabbMaxY=C._aabbMaxY>k._aabbMaxY?C._aabbMaxY:k._aabbMaxY,g._aabbMaxZ=C._aabbMaxZ>k._aabbMaxZ?C._aabbMaxZ:k._aabbMaxZ;let V=g._children[0]._height,B=g._children[1]._height;g._height=(V>B?V:B)+1}X!=null?(X._children[F]=M,M._parent=X,M._childIndex=F):(h._root=M,M._parent=null),g=M}else if(T<-1){let P=z._children[0],A=z._children[1];if(P._height>A._height){z._children[1]=g,g._parent=z,g._childIndex=1,g._children[1]=A,A._parent=g,A._childIndex=1;let L=z._children[0],S=z._children[1];z._aabbMinX=L._aabbMinX<S._aabbMinX?L._aabbMinX:S._aabbMinX,z._aabbMinY=L._aabbMinY<S._aabbMinY?L._aabbMinY:S._aabbMinY,z._aabbMinZ=L._aabbMinZ<S._aabbMinZ?L._aabbMinZ:S._aabbMinZ,z._aabbMaxX=L._aabbMaxX>S._aabbMaxX?L._aabbMaxX:S._aabbMaxX,z._aabbMaxY=L._aabbMaxY>S._aabbMaxY?L._aabbMaxY:S._aabbMaxY,z._aabbMaxZ=L._aabbMaxZ>S._aabbMaxZ?L._aabbMaxZ:S._aabbMaxZ;let R=z._children[0]._height,E=z._children[1]._height;z._height=(R>E?R:E)+1;let C=g._children[0],k=g._children[1];g._aabbMinX=C._aabbMinX<k._aabbMinX?C._aabbMinX:k._aabbMinX,g._aabbMinY=C._aabbMinY<k._aabbMinY?C._aabbMinY:k._aabbMinY,g._aabbMinZ=C._aabbMinZ<k._aabbMinZ?C._aabbMinZ:k._aabbMinZ,g._aabbMaxX=C._aabbMaxX>k._aabbMaxX?C._aabbMaxX:k._aabbMaxX,g._aabbMaxY=C._aabbMaxY>k._aabbMaxY?C._aabbMaxY:k._aabbMaxY,g._aabbMaxZ=C._aabbMaxZ>k._aabbMaxZ?C._aabbMaxZ:k._aabbMaxZ;let V=g._children[0]._height,B=g._children[1]._height;g._height=(V>B?V:B)+1}else{z._children[0]=g,g._parent=z,g._childIndex=0,g._children[1]=P,P._parent=g,P._childIndex=1;let L=z._children[0],S=z._children[1];z._aabbMinX=L._aabbMinX<S._aabbMinX?L._aabbMinX:S._aabbMinX,z._aabbMinY=L._aabbMinY<S._aabbMinY?L._aabbMinY:S._aabbMinY,z._aabbMinZ=L._aabbMinZ<S._aabbMinZ?L._aabbMinZ:S._aabbMinZ,z._aabbMaxX=L._aabbMaxX>S._aabbMaxX?L._aabbMaxX:S._aabbMaxX,z._aabbMaxY=L._aabbMaxY>S._aabbMaxY?L._aabbMaxY:S._aabbMaxY,z._aabbMaxZ=L._aabbMaxZ>S._aabbMaxZ?L._aabbMaxZ:S._aabbMaxZ;let R=z._children[0]._height,E=z._children[1]._height;z._height=(R>E?R:E)+1;let C=g._children[0],k=g._children[1];g._aabbMinX=C._aabbMinX<k._aabbMinX?C._aabbMinX:k._aabbMinX,g._aabbMinY=C._aabbMinY<k._aabbMinY?C._aabbMinY:k._aabbMinY,g._aabbMinZ=C._aabbMinZ<k._aabbMinZ?C._aabbMinZ:k._aabbMinZ,g._aabbMaxX=C._aabbMaxX>k._aabbMaxX?C._aabbMaxX:k._aabbMaxX,g._aabbMaxY=C._aabbMaxY>k._aabbMaxY?C._aabbMaxY:k._aabbMaxY,g._aabbMaxZ=C._aabbMaxZ>k._aabbMaxZ?C._aabbMaxZ:k._aabbMaxZ;let V=g._children[0]._height,B=g._children[1]._height;g._height=(V>B?V:B)+1}X!=null?(X._children[F]=z,z._parent=X,z._childIndex=F):(h._root=z,z._parent=null),g=z}}let b=g._children[0]._height,Y=g._children[1]._height;g._height=(b>Y?b:Y)+1;let w=g._children[0],Z=g._children[1];g._aabbMinX=w._aabbMinX<Z._aabbMinX?w._aabbMinX:Z._aabbMinX,g._aabbMinY=w._aabbMinY<Z._aabbMinY?w._aabbMinY:Z._aabbMinY,g._aabbMinZ=w._aabbMinZ<Z._aabbMinZ?w._aabbMinZ:Z._aabbMinZ,g._aabbMaxX=w._aabbMaxX>Z._aabbMaxX?w._aabbMaxX:Z._aabbMaxX,g._aabbMaxY=w._aabbMaxY>Z._aabbMaxY?w._aabbMaxY:Z._aabbMaxY,g._aabbMaxZ=w._aabbMaxZ>Z._aabbMaxZ?w._aabbMaxZ:Z._aabbMaxZ,g=g._parent}}e&&this.collide(this._tree._root,o._leaf),o._moved=!1}this.movedProxies[s]=null}e||this.collide(this._tree._root,this._tree._root),this.numMovedProxies=0}rayCast(t,e,i){if(this._tree._root==null)return;let n,s,o,r,_,a;n=t.x,s=t.y,o=t.z,r=e.x,_=e.y,a=e.z,this.rayCastRecursive(this._tree._root,n,s,o,r,_,a,i)}convexCast(t,e,i,n){this._tree._root!=null&&this.convexCastRecursive(this._tree._root,t,e,i,n)}aabbTest(t,e){this._tree._root!=null&&this.aabbTestRecursive(this._tree._root,t,e)}getTreeBalance(){return this._tree._getBalance()}};y.collision.broadphase.bvh.BvhInsertionStrategy=class{};y.collision.broadphase.bvh.BvhNode=class{constructor(){this._next=null,this._prevLeaf=null,this._nextLeaf=null,this._children=new Array(2),this._childIndex=0,this._parent=null,this._height=0,this._proxy=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}};y.collision.broadphase.bvh.BvhProxy=class extends y.collision.broadphase.Proxy{constructor(t,e){super(t,e),this._leaf=null,this._moved=!1}};y.collision.broadphase.bvh.BvhStrategy=class{constructor(){this._insertionStrategy=0,this._balancingEnabled=!1}_decideInsertion(t,e){switch(this._insertionStrategy){case 0:let i,n,s;i=e._aabbMinX+e._aabbMaxX,n=e._aabbMinY+e._aabbMaxY,s=e._aabbMinZ+e._aabbMaxZ;let o=t._children[0],r=t._children[1],_,a,l,h,m,f;return _=o._aabbMinX+o._aabbMaxX,a=o._aabbMinY+o._aabbMaxY,l=o._aabbMinZ+o._aabbMaxZ,h=r._aabbMinX+r._aabbMaxX,m=r._aabbMinY+r._aabbMaxY,f=r._aabbMinZ+r._aabbMaxZ,_-=i,a-=n,l-=s,h-=i,m-=n,f-=s,_*_+a*a+l*l<h*h+m*m+f*f?0:1;case 1:let p=t._children[0],d=t._children[1],u=t._aabbMaxY-t._aabbMinY,g=t._aabbMaxZ-t._aabbMinZ,v,x,b,Y,w,Z;v=t._aabbMinX<e._aabbMinX?t._aabbMinX:e._aabbMinX,x=t._aabbMinY<e._aabbMinY?t._aabbMinY:e._aabbMinY,b=t._aabbMinZ<e._aabbMinZ?t._aabbMinZ:e._aabbMinZ,Y=t._aabbMaxX>e._aabbMaxX?t._aabbMaxX:e._aabbMaxX,w=t._aabbMaxY>e._aabbMaxY?t._aabbMaxY:e._aabbMaxY,Z=t._aabbMaxZ>e._aabbMaxZ?t._aabbMaxZ:e._aabbMaxZ;let X=w-x,M=Z-b,z=((Y-v)*(X+M)+X*M)*2,T=z*2,F=(z-((t._aabbMaxX-t._aabbMinX)*(u+g)+u*g)*2)*2,P;if(v=p._aabbMinX<e._aabbMinX?p._aabbMinX:e._aabbMinX,x=p._aabbMinY<e._aabbMinY?p._aabbMinY:e._aabbMinY,b=p._aabbMinZ<e._aabbMinZ?p._aabbMinZ:e._aabbMinZ,Y=p._aabbMaxX>e._aabbMaxX?p._aabbMaxX:e._aabbMaxX,w=p._aabbMaxY>e._aabbMaxY?p._aabbMaxY:e._aabbMaxY,Z=p._aabbMaxZ>e._aabbMaxZ?p._aabbMaxZ:e._aabbMaxZ,p._height==0){let L=w-x,S=Z-b;P=F+((Y-v)*(L+S)+L*S)*2}else{let L=w-x,S=Z-b,R=p._aabbMaxY-p._aabbMinY,E=p._aabbMaxZ-p._aabbMinZ;P=F+(((Y-v)*(L+S)+L*S)*2-((p._aabbMaxX-p._aabbMinX)*(R+E)+R*E)*2)}let A;if(v=d._aabbMinX<e._aabbMinX?d._aabbMinX:e._aabbMinX,x=d._aabbMinY<e._aabbMinY?d._aabbMinY:e._aabbMinY,b=d._aabbMinZ<e._aabbMinZ?d._aabbMinZ:e._aabbMinZ,Y=d._aabbMaxX>e._aabbMaxX?d._aabbMaxX:e._aabbMaxX,w=d._aabbMaxY>e._aabbMaxY?d._aabbMaxY:e._aabbMaxY,Z=d._aabbMaxZ>e._aabbMaxZ?d._aabbMaxZ:e._aabbMaxZ,d._height==0){let L=w-x,S=Z-b;A=F+((Y-v)*(L+S)+L*S)*2}else{let L=w-x,S=Z-b,R=d._aabbMaxY-d._aabbMinY,E=d._aabbMaxZ-d._aabbMinZ;A=F+(((Y-v)*(L+S)+L*S)*2-((d._aabbMaxX-d._aabbMinX)*(R+E)+R*E)*2)}return T<P?T<A?-1:1:P<A?0:1;default:return console.log("src/oimo/collision/broadphase/bvh/BvhStrategy.hx:37:","invalid BVH insertion strategy: "+this._insertionStrategy),-1}}_splitLeaves(t,e,i){let n=1/(i-e),s,o,r;s=0,o=0,r=0;let _=e;for(;_<i;){let v=t[_++];v._tmpX=v._aabbMaxX+v._aabbMinX,v._tmpY=v._aabbMaxY+v._aabbMinY,v._tmpZ=v._aabbMaxZ+v._aabbMinZ,s+=v._tmpX,o+=v._tmpY,r+=v._tmpZ}s*=n,o*=n,r*=n;let a,l,h;a=0,l=0,h=0;let m=e;for(;m<i;){let v=t[m++],x,b,Y;x=v._tmpX-s,b=v._tmpY-o,Y=v._tmpZ-r,x*=x,b*=b,Y*=Y,a+=x,l+=b,h+=Y}let f=a,p=l,d=h,u=e,g=i-1;if(f>p)if(f>d){let v=s;for(;;){for(;!(t[u]._tmpX<=v);)++u;for(;!(t[g]._tmpX>=v);)--g;if(u>=g)break;let x=t[u];t[u]=t[g],t[g]=x,++u,--g}}else{let v=r;for(;;){for(;!(t[u]._tmpZ<=v);)++u;for(;!(t[g]._tmpZ>=v);)--g;if(u>=g)break;let x=t[u];t[u]=t[g],t[g]=x,++u,--g}}else if(p>d){let v=o;for(;;){for(;!(t[u]._tmpY<=v);)++u;for(;!(t[g]._tmpY>=v);)--g;if(u>=g)break;let x=t[u];t[u]=t[g],t[g]=x,++u,--g}}else{let v=r;for(;;){for(;!(t[u]._tmpZ<=v);)++u;for(;!(t[g]._tmpZ>=v);)--g;if(u>=g)break;let x=t[u];t[u]=t[g],t[g]=x,++u,--g}}return u}};y.collision.broadphase.bvh.BvhTree=class{constructor(){this._root=null,this._numLeaves=0,this._strategy=new y.collision.broadphase.bvh.BvhStrategy,this._nodePool=null,this.leafList=null,this.leafListLast=null,this.tmp=new Array(1024)}_print(t,e){if(e==null&&(e=""),t!=null)if(t._height==0)console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:39:",e+t._proxy._id);else{this._print(t._children[0],e+"  ");let i,n,s,o;n=t._aabbMaxX-t._aabbMinX,s=t._aabbMaxY-t._aabbMinY,o=t._aabbMaxZ-t._aabbMinZ;let r=s,_=o;if(n*(r+_)+r*_>0){let a,l,h;a=t._aabbMaxX-t._aabbMinX,l=t._aabbMaxY-t._aabbMinY,h=t._aabbMaxZ-t._aabbMinZ;let m=l,f=h;i=((a*(m+f)+m*f)*1e3+.5|0)/1e3}else{let a,l,h;a=t._aabbMaxX-t._aabbMinX,l=t._aabbMaxY-t._aabbMinY,h=t._aabbMaxZ-t._aabbMinZ;let m=l,f=h;i=((a*(m+f)+m*f)*1e3-.5|0)/1e3}console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:42:",e+"#"+t._height+", "+i),this._print(t._children[1],e+"  ")}}_getBalance(){return this.getBalanceRecursive(this._root)}deleteRecursive(t){if(t._height==0){let e=t._prevLeaf,i=t._nextLeaf;e!=null&&(e._nextLeaf=i),i!=null&&(i._prevLeaf=e),t==this.leafList&&(this.leafList=this.leafList._nextLeaf),t==this.leafListLast&&(this.leafListLast=this.leafListLast._prevLeaf),t._nextLeaf=null,t._prevLeaf=null,t._proxy._leaf=null,t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t;return}this.deleteRecursive(t._children[0]),this.deleteRecursive(t._children[1]),t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t}decomposeRecursive(t){if(t._height==0){t._childIndex=0,t._parent=null;return}this.decomposeRecursive(t._children[0]),this.decomposeRecursive(t._children[1]),t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t}buildTopDownRecursive(t,e,i){if(i-e==1){let f=t[e],p=f._proxy;return f._aabbMinX=p._aabbMinX,f._aabbMinY=p._aabbMinY,f._aabbMinZ=p._aabbMinZ,f._aabbMaxX=p._aabbMaxX,f._aabbMaxY=p._aabbMaxY,f._aabbMaxZ=p._aabbMaxZ,f}let n=this._strategy._splitLeaves(t,e,i),s=this.buildTopDownRecursive(t,e,n),o=this.buildTopDownRecursive(t,n,i),r=this._nodePool;r!=null?(this._nodePool=r._next,r._next=null):r=new y.collision.broadphase.bvh.BvhNode;let _=r;_._children[0]=s,s._parent=_,s._childIndex=0,_._children[1]=o,o._parent=_,o._childIndex=1;let a=_._children[0],l=_._children[1];_._aabbMinX=a._aabbMinX<l._aabbMinX?a._aabbMinX:l._aabbMinX,_._aabbMinY=a._aabbMinY<l._aabbMinY?a._aabbMinY:l._aabbMinY,_._aabbMinZ=a._aabbMinZ<l._aabbMinZ?a._aabbMinZ:l._aabbMinZ,_._aabbMaxX=a._aabbMaxX>l._aabbMaxX?a._aabbMaxX:l._aabbMaxX,_._aabbMaxY=a._aabbMaxY>l._aabbMaxY?a._aabbMaxY:l._aabbMaxY,_._aabbMaxZ=a._aabbMaxZ>l._aabbMaxZ?a._aabbMaxZ:l._aabbMaxZ;let h=_._children[0]._height,m=_._children[1]._height;return _._height=(h>m?h:m)+1,_}getBalanceRecursive(t){if(t==null||t._height==0)return 0;let e=t._children[0]._height-t._children[1]._height;return e<0&&(e=-e),e+this.getBalanceRecursive(t._children[0])+this.getBalanceRecursive(t._children[1])}};y.collision.geometry.Aabb=class{constructor(){this._minX=0,this._minY=0,this._minZ=0,this._maxX=0,this._maxY=0,this._maxZ=0}init(t,e){return this._minX=t.x,this._minY=t.y,this._minZ=t.z,this._maxX=e.x,this._maxY=e.y,this._maxZ=e.z,this}getMin(){let t=new y.common.Vec3;return t.x=this._minX,t.y=this._minY,t.z=this._minZ,t}getMinTo(t){t.x=this._minX,t.y=this._minY,t.z=this._minZ}setMin(t){return this._minX=t.x,this._minY=t.y,this._minZ=t.z,this}getMax(){let t=new y.common.Vec3;return t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ,t}getMaxTo(t){t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ}setMax(t){return this._maxX=t.x,this._maxY=t.y,this._maxZ=t.z,this}getCenter(){let t=new y.common.Vec3,e,i,n;return e=this._minX+this._maxX,i=this._minY+this._maxY,n=this._minZ+this._maxZ,e*=.5,i*=.5,n*=.5,t.x=e,t.y=i,t.z=n,t}getCenterTo(t){let e,i,n;e=this._minX+this._maxX,i=this._minY+this._maxY,n=this._minZ+this._maxZ,e*=.5,i*=.5,n*=.5,t.x=e,t.y=i,t.z=n}getExtents(){let t=new y.common.Vec3,e,i,n;return e=this._maxX-this._minX,i=this._maxY-this._minY,n=this._maxZ-this._minZ,e*=.5,i*=.5,n*=.5,t.x=e,t.y=i,t.z=n,t}getExtentsTo(t){let e,i,n;e=this._maxX-this._minX,i=this._maxY-this._minY,n=this._maxZ-this._minZ,e*=.5,i*=.5,n*=.5,t.x=e,t.y=i,t.z=n}combine(t){return this._minX=this._minX<t._minX?this._minX:t._minX,this._minY=this._minY<t._minY?this._minY:t._minY,this._minZ=this._minZ<t._minZ?this._minZ:t._minZ,this._maxX=this._maxX>t._maxX?this._maxX:t._maxX,this._maxY=this._maxY>t._maxY?this._maxY:t._maxY,this._maxZ=this._maxZ>t._maxZ?this._maxZ:t._maxZ,this}combined(t){let e=new y.collision.geometry.Aabb;return e._minX=this._minX<t._minX?this._minX:t._minX,e._minY=this._minY<t._minY?this._minY:t._minY,e._minZ=this._minZ<t._minZ?this._minZ:t._minZ,e._maxX=this._maxX>t._maxX?this._maxX:t._maxX,e._maxY=this._maxY>t._maxY?this._maxY:t._maxY,e._maxZ=this._maxZ>t._maxZ?this._maxZ:t._maxZ,e}overlap(t){return this._minX<t._maxX&&this._maxX>t._minX&&this._minY<t._maxY&&this._maxY>t._minY&&this._minZ<t._maxZ?this._maxZ>t._minZ:!1}getIntersection(t){let e=new y.collision.geometry.Aabb;return e._minX=this._minX>t._minX?this._minX:t._minX,e._minY=this._minY>t._minY?this._minY:t._minY,e._minZ=this._minZ>t._minZ?this._minZ:t._minZ,e._maxX=this._maxX<t._maxX?this._maxX:t._maxX,e._maxY=this._maxY<t._maxY?this._maxY:t._maxY,e._maxZ=this._maxZ<t._maxZ?this._maxZ:t._maxZ,e}getIntersectionTo(t,e){e._minX=this._minX>t._minX?this._minX:t._minX,e._minY=this._minY>t._minY?this._minY:t._minY,e._minZ=this._minZ>t._minZ?this._minZ:t._minZ,e._maxX=this._maxX<t._maxX?this._maxX:t._maxX,e._maxY=this._maxY<t._maxY?this._maxY:t._maxY,e._maxZ=this._maxZ<t._maxZ?this._maxZ:t._maxZ}copyFrom(t){return this._minX=t._minX,this._minY=t._minY,this._minZ=t._minZ,this._maxX=t._maxX,this._maxY=t._maxY,this._maxZ=t._maxZ,this}clone(){let t=new y.collision.geometry.Aabb;return t._minX=this._minX,t._minY=this._minY,t._minZ=this._minZ,t._maxX=this._maxX,t._maxY=this._maxY,t._maxZ=this._maxZ,t}};y.collision.geometry.BoxGeometry=class extends y.collision.geometry.ConvexGeometry{constructor(t){super(1),this._halfExtentsX=t.x,this._halfExtentsY=t.y,this._halfExtentsZ=t.z,this._halfAxisXX=t.x,this._halfAxisXY=0,this._halfAxisXZ=0,this._halfAxisYX=0,this._halfAxisYY=t.y,this._halfAxisYZ=0,this._halfAxisZX=0,this._halfAxisZY=0,this._halfAxisZZ=t.z,this._updateMass();let e=t.x<t.y?t.z<t.x?t.z:t.x:t.z<t.y?t.z:t.y;this._gjkMargin>e*.2&&(this._gjkMargin=e*.2)}getHalfExtents(){let t=new y.common.Vec3;return t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ,t}getHalfExtentsTo(t){t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ}_updateMass(){this._volume=8*(this._halfExtentsX*this._halfExtentsY*this._halfExtentsZ);let t,e,i;t=this._halfExtentsX*this._halfExtentsX,e=this._halfExtentsY*this._halfExtentsY,i=this._halfExtentsZ*this._halfExtentsZ,this._inertiaCoeff00=.3333333333333333*(e+i),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(i+t),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(t+e)}_computeAabb(t,e){let i,n,s,o,r,_,a,l,h,m,f,p;m=e._rotation00*this._halfAxisXX+e._rotation01*this._halfAxisXY+e._rotation02*this._halfAxisXZ,f=e._rotation10*this._halfAxisXX+e._rotation11*this._halfAxisXY+e._rotation12*this._halfAxisXZ,p=e._rotation20*this._halfAxisXX+e._rotation21*this._halfAxisXY+e._rotation22*this._halfAxisXZ,i=m,n=f,s=p;let d,u,g;d=e._rotation00*this._halfAxisYX+e._rotation01*this._halfAxisYY+e._rotation02*this._halfAxisYZ,u=e._rotation10*this._halfAxisYX+e._rotation11*this._halfAxisYY+e._rotation12*this._halfAxisYZ,g=e._rotation20*this._halfAxisYX+e._rotation21*this._halfAxisYY+e._rotation22*this._halfAxisYZ,o=d,r=u,_=g;let v,x,b;v=e._rotation00*this._halfAxisZX+e._rotation01*this._halfAxisZY+e._rotation02*this._halfAxisZZ,x=e._rotation10*this._halfAxisZX+e._rotation11*this._halfAxisZY+e._rotation12*this._halfAxisZZ,b=e._rotation20*this._halfAxisZX+e._rotation21*this._halfAxisZY+e._rotation22*this._halfAxisZZ,a=v,l=x,h=b,i<0&&(i=-i),n<0&&(n=-n),s<0&&(s=-s),o<0&&(o=-o),r<0&&(r=-r),_<0&&(_=-_),a<0&&(a=-a),l<0&&(l=-l),h<0&&(h=-h);let Y,w,Z;Y=i+o,w=n+r,Z=s+_,Y+=a,w+=l,Z+=h,t._minX=e._positionX-Y,t._minY=e._positionY-w,t._minZ=e._positionZ-Z,t._maxX=e._positionX+Y,t._maxY=e._positionY+w,t._maxZ=e._positionZ+Z}computeLocalSupportingVertex(t,e){let i,n,s,o,r,_;i=this._gjkMargin,n=this._gjkMargin,s=this._gjkMargin,i<this._halfExtentsX||(i=this._halfExtentsX),n<this._halfExtentsY||(n=this._halfExtentsY),s<this._halfExtentsZ||(s=this._halfExtentsZ),o=this._halfExtentsX-i,r=this._halfExtentsY-n,_=this._halfExtentsZ-s,e.x=t.x>0?o:-o,e.y=t.y>0?r:-r,e.z=t.z>0?_:-_}_rayCastLocal(t,e,i,n,s,o,r){let _=this._halfExtentsX,a=this._halfExtentsY,l=this._halfExtentsZ,h=n-t,m=s-e,f=o-i,p=0,d=0,u=0,g=1,v=1,x=1;if(h>-1e-6&&h<1e-6){if(t<=-_||t>=_)return!1}else{let Z=1/h,X=(-_-t)*Z,M=(_-t)*Z;if(X>M){let z=X;X=M,M=z}X>0&&(p=X),M<1&&(g=M)}if(m>-1e-6&&m<1e-6){if(e<=-a||e>=a)return!1}else{let Z=1/m,X=(-a-e)*Z,M=(a-e)*Z;if(X>M){let z=X;X=M,M=z}X>0&&(d=X),M<1&&(v=M)}if(f>-1e-6&&f<1e-6){if(i<=-l||i>=l)return!1}else{let Z=1/f,X=(-l-i)*Z,M=(l-i)*Z;if(X>M){let z=X;X=M,M=z}X>0&&(u=X),M<1&&(x=M)}if(p>=1||d>=1||u>=1||g<=0||v<=0||x<=0)return!1;let b=p,Y=g,w=0;if(d>b&&(b=d,w=1),u>b&&(b=u,w=2),v<Y&&(Y=v),x<Y&&(Y=x),b>Y||b==0)return!1;switch(w){case 0:r.normal.init(h>0?-1:1,0,0);break;case 1:r.normal.init(0,m>0?-1:1,0);break;case 2:r.normal.init(0,0,f>0?-1:1);break}return r.position.init(t+b*h,e+b*m,i+b*f),r.fraction=b,!0}};y.collision.geometry.CapsuleGeometry=class extends y.collision.geometry.ConvexGeometry{constructor(t,e){super(4),this._radius=t,this._halfHeight=e,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){let t=this._radius*this._radius,e=this._halfHeight*this._halfHeight,i=6.28318530717958*t*this._halfHeight,n=3.14159265358979*t*this._radius*4/3;this._volume=i+n;let s=this._volume==0?0:1/this._volume,o=s*(i*(t*.25+e/3)+n*(t*.4+this._halfHeight*this._radius*.75+e));this._inertiaCoeff00=o,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=s*(i*t*.5+n*t*.4),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=o}_computeAabb(t,e){let i,n,s;i=this._radius,n=this._radius,s=this._radius;let o,r,_;o=e._rotation01,r=e._rotation11,_=e._rotation21,o<0&&(o=-o),r<0&&(r=-r),_<0&&(_=-_),o*=this._halfHeight,r*=this._halfHeight,_*=this._halfHeight,i+=o,n+=r,s+=_,t._minX=e._positionX-i,t._minY=e._positionY-n,t._minZ=e._positionZ-s,t._maxX=e._positionX+i,t._maxY=e._positionY+n,t._maxZ=e._positionZ+s}computeLocalSupportingVertex(t,e){t.y>0?e.init(0,this._halfHeight,0):e.init(0,-this._halfHeight,0)}_rayCastLocal(t,e,i,n,s,o,r){let _=this._halfHeight,a=n-t,l=o-i,h=0,m,f=a*a+l*l,p=t*a+i*l,d=t*t+i*i-this._radius*this._radius,u=p*p-f*d;if(u<0)return!1;if(f>0){let B=Math.sqrt(u);if(h=(-p-B)/f,m=(-p+B)/f,h>=1||m<=0)return!1}else{if(d>=0)return!1;h=0}let g=e+(s-e)*h,v;if(g>-_&&g<_){if(h>0){v=h;let B=r.normal.init(t+a*v,0,i+l*v),J=Math.sqrt(B.x*B.x+B.y*B.y+B.z*B.z);return J>0&&(J=1/J),B.x*=J,B.y*=J,B.z*=J,r.position.init(t+v*a,g,i+v*l),r.fraction=v,!0}return!1}let x,b,Y,w,Z,X;x=0,b=g<0?-_:_,Y=0,w=t-x,Z=e-b,X=i-Y;let M,z,T;if(M=n-t,z=s-e,T=o-i,f=M*M+z*z+T*T,p=w*M+Z*z+X*T,d=w*w+Z*Z+X*X-this._radius*this._radius,u=p*p-f*d,u<0)return!1;let F=(-p-Math.sqrt(u))/f;if(F<0||F>1)return!1;let P,A,L,S,R,E;P=w+M*F,A=Z+z*F,L=X+T*F;let C=P*P+A*A+L*L;C>0&&(C=1/Math.sqrt(C)),S=P*C,R=A*C,E=L*C,P+=x,A+=b,L+=Y;let k=r.position;k.x=P,k.y=A,k.z=L;let V=r.normal;return V.x=S,V.y=R,V.z=E,r.fraction=F,!0}};y.collision.geometry.ConeGeometry=class extends y.collision.geometry.ConvexGeometry{constructor(t,e){super(3),this._radius=t,this._halfHeight=e,this.sinTheta=t/Math.sqrt(t*t+4*e*e),this.cosTheta=2*e/Math.sqrt(t*t+4*e*e),this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){let t=this._radius*this._radius,e=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2/3,this._inertiaCoeff00=.05*(3*t+2*e),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3*t,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.05*(3*t+2*e)}_computeAabb(t,e){let i,n,s,o,r,_,a,l,h,m,f,p;i=e._rotation01,n=e._rotation11,s=e._rotation21,o=i*i,r=n*n,_=s*s,m=Math.sqrt(1-o),f=Math.sqrt(1-r),p=Math.sqrt(1-_),m*=this._radius,f*=this._radius,p*=this._radius,a=i*this._halfHeight,l=n*this._halfHeight,h=s*this._halfHeight;let d,u,g,v,x,b;d=-a,u=-l,g=-h,d-=m,u-=f,g-=p,v=-a,x=-l,b=-h,v+=m,x+=f,b+=p;let Y,w,Z,X,M,z;Y=d>v?d:v,w=u>x?u:x,Z=g>b?g:b,Y>a||(Y=a),w>l||(w=l),Z>h||(Z=h),X=d<v?d:v,M=u<x?u:x,z=g<b?g:b,X<a||(X=a),M<l||(M=l),z<h||(z=h),t._minX=e._positionX+X,t._minY=e._positionY+M,t._minZ=e._positionZ+z,t._maxX=e._positionX+Y,t._maxY=e._positionY+w,t._maxZ=e._positionZ+Z}computeLocalSupportingVertex(t,e){let i=t.x,n=t.y,s=t.z;if(n>0&&n*n>this.sinTheta*this.sinTheta*(i*i+n*n+s*s)){e.init(0,this._halfHeight-this._gjkMargin/this.sinTheta,0),e.y<0&&(e.y=0);return}let o=t.x,r=t.z,_=o*o+r*r,a=2*this._halfHeight,l=(a-this._gjkMargin)/a*this._radius-this._gjkMargin/this.cosTheta;l<0&&(l=0);let h=_>0?l/Math.sqrt(_):0,m=this._halfHeight-this._gjkMargin;m<0&&(m=0),e.x=o*h,e.y=-m,e.z=r*h}_rayCastLocal(t,e,i,n,s,o,r){let _,a=this._halfHeight,l=n-t,h=s-e,m=o-i,f=0,p=1;if(h>-1e-6&&h<1e-6){if(e<=-a||e>=a)return!1}else{let Z=1/h,X=(-a-e)*Z,M=(a-e)*Z;if(X>M){let z=X;X=M,M=z}X>0&&(f=X),M<1&&(p=M)}if(f>=1||p<=0)return!1;let d=0,u=0;_=e-a;let g=this.cosTheta*this.cosTheta,v=g*(l*l+h*h+m*m)-h*h,x=g*(t*l+_*h+i*m)-_*h,b=g*(t*t+_*_+i*i)-_*_,Y=x*x-v*b;if(v!=0){if(Y<0)return!1;let Z=Math.sqrt(Y);if(v<0){if(h>0){if(d=0,u=(-x+Z)/v,u<=0)return!1}else if(d=(-x-Z)/v,u=1,d>=1)return!1}else if(d=(-x-Z)/v,u=(-x+Z)/v,d>=1||u<=0)return!1}else{let Z=-b/(2*x);if(x>0){if(d=0,u=Z,Z<=0)return!1}else if(d=Z,u=1,Z>=1)return!1}_+=a;let w;if(u<=f||p<=d)return!1;if(d<f){if(w=f,w==0)return!1;r.normal.init(0,h>0?-1:1,0)}else{if(w=d,w==0)return!1;let Z=r.normal.init(t+l*w,0,i+m*w),X=Math.sqrt(Z.x*Z.x+Z.y*Z.y+Z.z*Z.z);X>0&&(X=1/X),Z.x*=X,Z.y*=X,Z.z*=X;let M=this.cosTheta;Z.x*=M,Z.y*=M,Z.z*=M,r.normal.y+=this.sinTheta}return r.position.init(t+w*l,_+w*h,i+w*m),r.fraction=w,!0}};y.collision.geometry.ConvexHullGeometry=class extends y.collision.geometry.ConvexGeometry{constructor(t){super(5),this._numVertices=t.length,this._vertices=new Array(this._numVertices),this._tmpVertices=new Array(this._numVertices);let e=0,i=this._numVertices;for(;e<i;){let n=e++;this._vertices[n]=t[n],this._tmpVertices[n]=new y.common.Vec3}this._useGjkRayCast=!0,this._updateMass()}getVertices(){return this._vertices}_updateMass(){this._volume=1,this._inertiaCoeff00=1,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=1,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=1;let t=this._vertices[0].x,e=this._vertices[0].y,i=this._vertices[0].z,n=this._vertices[0].x,s=this._vertices[0].y,o=this._vertices[0].z,r=1,_=this._numVertices;for(;r<_;){let f=r++,p=this._vertices[f].x,d=this._vertices[f].y,u=this._vertices[f].z;p<t?t=p:p>n&&(n=p),d<e?e=d:d>s&&(s=d),u<i?i=u:u>o&&(o=u)}let a=n-t,l=s-e,h=o-i;this._volume=a*l*h;let m=((t+n)*(t+n)+(e+s)*(e+s)+(i+o)*(i+o))*.25;a=a*a*.25,l=l*l*.25,h=h*h*.25,this._inertiaCoeff00=.3333333333333333*(l+h)+m,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(h+a)+m,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(a+l)+m}_computeAabb(t,e){let i,n,s,o,r,_,a,l,h;a=this._gjkMargin,l=this._gjkMargin,h=this._gjkMargin;let m,f,p,d=this._vertices[0];m=d.x,f=d.y,p=d.z;let u,g,v,x,b,Y;x=e._rotation00*m+e._rotation01*f+e._rotation02*p,b=e._rotation10*m+e._rotation11*f+e._rotation12*p,Y=e._rotation20*m+e._rotation21*f+e._rotation22*p,u=x,g=b,v=Y,u+=e._positionX,g+=e._positionY,v+=e._positionZ,i=u,n=g,s=v,o=u,r=g,_=v;let w=1,Z=this._numVertices;for(;w<Z;){let X=this._vertices[w++];m=X.x,f=X.y,p=X.z;let M,z,T;M=e._rotation00*m+e._rotation01*f+e._rotation02*p,z=e._rotation10*m+e._rotation11*f+e._rotation12*p,T=e._rotation20*m+e._rotation21*f+e._rotation22*p,u=M,g=z,v=T,u+=e._positionX,g+=e._positionY,v+=e._positionZ,i<u||(i=u),n<g||(n=g),s<v||(s=v),o>u||(o=u),r>g||(r=g),_>v||(_=v)}t._minX=i-a,t._minY=n-l,t._minZ=s-h,t._maxX=o+a,t._maxY=r+l,t._maxZ=_+h}computeLocalSupportingVertex(t,e){let i=this._vertices[0],n=i.x*t.x+i.y*t.y+i.z*t.z,s=0,o=1,r=this._numVertices;for(;o<r;){let a=o++,l=this._vertices[a],h=l.x*t.x+l.y*t.y+l.z*t.z;h>n&&(n=h,s=a)}let _=this._vertices[s];e.x=_.x,e.y=_.y,e.z=_.z}};y.collision.geometry.CylinderGeometry=class extends y.collision.geometry.ConvexGeometry{constructor(t,e){super(2),this._radius=t,this._halfHeight=e,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){let t=this._radius*this._radius,e=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2,this._inertiaCoeff00=.08333333333333333*(3*t+e),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.5*t,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.08333333333333333*(3*t+e)}_computeAabb(t,e){let i,n,s,o,r,_,a,l,h,m,f,p;i=e._rotation01,n=e._rotation11,s=e._rotation21,i<0&&(i=-i),n<0&&(n=-n),s<0&&(s=-s),o=i*i,r=n*n,_=s*s,m=Math.sqrt(1-o),f=Math.sqrt(1-r),p=Math.sqrt(1-_),m*=this._radius,f*=this._radius,p*=this._radius,a=i*this._halfHeight,l=n*this._halfHeight,h=s*this._halfHeight;let d,u,g;d=m+a,u=f+l,g=p+h,t._minX=e._positionX-d,t._minY=e._positionY-u,t._minZ=e._positionZ-g,t._maxX=e._positionX+d,t._maxY=e._positionY+u,t._maxZ=e._positionZ+g}computeLocalSupportingVertex(t,e){let i=t.x,n=t.z,s=i*i+n*n,o=this._radius-this._gjkMargin;o<0&&(o=0);let r=s>0?o/Math.sqrt(s):0,_=this._halfHeight-this._gjkMargin;_<0&&(_=0),e.x=i*r,e.y=t.y>0?_:-_,e.z=n*r}_rayCastLocal(t,e,i,n,s,o,r){let _=this._halfHeight,a=n-t,l=s-e,h=o-i,m=0,f=1;if(l>-1e-6&&l<1e-6){if(e<=-_||e>=_)return!1}else{let Y=1/l,w=(-_-e)*Y,Z=(_-e)*Y;if(w>Z){let X=w;w=Z,Z=X}w>0&&(m=w),Z<1&&(f=Z)}if(m>=1||f<=0)return!1;let p=0,d,u=a*a+h*h,g=t*a+i*h,v=t*t+i*i-this._radius*this._radius,x=g*g-u*v;if(x<0)return!1;if(u>0){let Y=Math.sqrt(x);if(p=(-g-Y)/u,d=(-g+Y)/u,p>=1||d<=0)return!1}else{if(v>=0)return!1;p=0,d=1}let b;if(d<=m||f<=p)return!1;if(p<m){if(b=m,b==0)return!1;r.normal.init(0,l>0?-1:1,0)}else{if(b=p,b==0)return!1;let Y=r.normal.init(t+a*b,0,i+h*b),w=Math.sqrt(Y.x*Y.x+Y.y*Y.y+Y.z*Y.z);w>0&&(w=1/w),Y.x*=w,Y.y*=w,Y.z*=w}return r.position.init(t+b*a,e+b*l,i+b*h),r.fraction=b,!0}};y.collision.geometry.GeometryType=class{};y.collision.geometry.RayCastHit=class{constructor(){this.position=new y.common.Vec3,this.normal=new y.common.Vec3,this.fraction=0}};y.collision.geometry.SphereGeometry=class extends y.collision.geometry.ConvexGeometry{constructor(t){super(0),this._radius=t,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}_updateMass(){this._volume=4.188790204786386*this._radius*this._radius*this._radius,this._inertiaCoeff00=.4*this._radius*this._radius,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.4*this._radius*this._radius,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.4*this._radius*this._radius}_computeAabb(t,e){let i,n,s;i=this._radius,n=this._radius,s=this._radius,t._minX=e._positionX-i,t._minY=e._positionY-n,t._minZ=e._positionZ-s,t._maxX=e._positionX+i,t._maxY=e._positionY+n,t._maxZ=e._positionZ+s}computeLocalSupportingVertex(t,e){e.zero()}_rayCastLocal(t,e,i,n,s,o,r){let _,a,l;_=n-t,a=s-e,l=o-i;let h=_*_+a*a+l*l,m=t*_+e*a+i*l,f=m*m-h*(t*t+e*e+i*i-this._radius*this._radius);if(f<0)return!1;let p=(-m-Math.sqrt(f))/h;if(p<0||p>1)return!1;let d,u,g,v,x,b;d=t+_*p,u=e+a*p,g=i+l*p;let Y=d*d+u*u+g*g;Y>0&&(Y=1/Math.sqrt(Y)),v=d*Y,x=u*Y,b=g*Y;let w=r.position;w.x=d,w.y=u,w.z=g;let Z=r.normal;return Z.x=v,Z.y=x,Z.z=b,r.fraction=p,!0}};y.collision.narrowphase||(y.collision.narrowphase={});y.collision.narrowphase.CollisionMatrix=class{constructor(){this.detectors=new Array(8),this.detectors[0]=new Array(8),this.detectors[1]=new Array(8),this.detectors[2]=new Array(8),this.detectors[3]=new Array(8),this.detectors[4]=new Array(8),this.detectors[5]=new Array(8);let t=new y.collision.narrowphase.detector.GjkEpaDetector;this.detectors[0][0]=new y.collision.narrowphase.detector.SphereSphereDetector,this.detectors[0][1]=new y.collision.narrowphase.detector.SphereBoxDetector(!1),this.detectors[0][2]=t,this.detectors[0][3]=t,this.detectors[0][4]=new y.collision.narrowphase.detector.SphereCapsuleDetector(!1),this.detectors[0][5]=t,this.detectors[1][0]=new y.collision.narrowphase.detector.SphereBoxDetector(!0),this.detectors[1][1]=new y.collision.narrowphase.detector.BoxBoxDetector,this.detectors[1][2]=t,this.detectors[1][3]=t,this.detectors[1][4]=t,this.detectors[1][5]=t,this.detectors[2][0]=t,this.detectors[2][1]=t,this.detectors[2][2]=t,this.detectors[2][3]=t,this.detectors[2][4]=t,this.detectors[2][5]=t,this.detectors[3][0]=t,this.detectors[3][1]=t,this.detectors[3][2]=t,this.detectors[3][3]=t,this.detectors[3][4]=t,this.detectors[3][5]=t,this.detectors[4][0]=new y.collision.narrowphase.detector.SphereCapsuleDetector(!0),this.detectors[4][1]=t,this.detectors[4][2]=t,this.detectors[4][3]=t,this.detectors[4][4]=new y.collision.narrowphase.detector.CapsuleCapsuleDetector,this.detectors[4][5]=t,this.detectors[5][0]=t,this.detectors[5][1]=t,this.detectors[5][2]=t,this.detectors[5][3]=t,this.detectors[5][4]=t,this.detectors[5][5]=t}getDetector(t,e){return this.detectors[t][e]}};y.collision.narrowphase.DetectorResult=class{constructor(){this.numPoints=0,this.normal=new y.common.Vec3,this.points=new Array(y.common.Setting.maxManifoldPoints),this.incremental=!1;let t=0,e=y.common.Setting.maxManifoldPoints;for(;t<e;)this.points[t++]=new y.collision.narrowphase.DetectorResultPoint}getMaxDepth(){let t=0,e=0,i=this.numPoints;for(;e<i;){let n=e++;this.points[n].depth>t&&(t=this.points[n].depth)}return t}clear(){this.numPoints=0;let t=0,e=this.points;for(;t<e.length;){let i=e[t];++t,i.position1.zero(),i.position2.zero(),i.depth=0,i.id=0}this.normal.zero()}};y.collision.narrowphase.DetectorResultPoint=class{constructor(){this.position1=new y.common.Vec3,this.position2=new y.common.Vec3,this.depth=0,this.id=0}};y.collision.narrowphase.detector||(y.collision.narrowphase.detector={});y.collision.narrowphase.detector.Detector=class{constructor(t){this.swapped=t}setNormal(t,e,i,n){let s=t.normal;if(s.x=e,s.y=i,s.z=n,this.swapped){let o=t.normal;o.x=-o.x,o.y=-o.y,o.z=-o.z}}addPoint(t,e,i,n,s,o,r,_,a){let l=t.points[t.numPoints++];if(l.depth=_,l.id=a,this.swapped){let h=l.position1;h.x=s,h.y=o,h.z=r;let m=l.position2;m.x=e,m.y=i,m.z=n}else{let h=l.position1;h.x=e,h.y=i,h.z=n;let m=l.position2;m.x=s,m.y=o,m.z=r}}detectImpl(t,e,i,n,s,o){}detect(t,e,i,n,s,o){t.numPoints=0;let r=0,_=t.points;for(;r<_.length;){let a=_[r];++r,a.position1.zero(),a.position2.zero(),a.depth=0,a.id=0}t.normal.zero(),this.swapped?this.detectImpl(t,i,e,s,n,o):this.detectImpl(t,e,i,n,s,o)}};y.collision.narrowphase.detector.BoxBoxDetector=class extends y.collision.narrowphase.detector.Detector{constructor(){super(!1),this.clipper=new y.collision.narrowphase.detector._BoxBoxDetector.FaceClipper}detectImpl(t,e,i,n,s,o){let r=e,_=i;t.incremental=!1;let a,l,h,m,f,p,d,u,g;a=n._positionX,l=n._positionY,h=n._positionZ,m=s._positionX,f=s._positionY,p=s._positionZ,d=m-a,u=f-l,g=p-h;let v,x,b,Y,w,Z,X,M,z,T,F,P,A,L,S,R,E,C;v=n._rotation00,x=n._rotation10,b=n._rotation20,Y=n._rotation01,w=n._rotation11,Z=n._rotation21,X=n._rotation02,M=n._rotation12,z=n._rotation22,T=s._rotation00,F=s._rotation10,P=s._rotation20,A=s._rotation01,L=s._rotation11,S=s._rotation21,R=s._rotation02,E=s._rotation12,C=s._rotation22;let k=r._halfExtentsX,V=r._halfExtentsY,B=r._halfExtentsZ,J=_._halfExtentsX,I=_._halfExtentsY,G=_._halfExtentsZ,D,et,$,j,q,tt,W,U,it,Q,at,ht,_t,mt,ft,ut,H,O;D=v*k,et=x*k,$=b*k,j=Y*V,q=w*V,tt=Z*V,W=X*B,U=M*B,it=z*B,Q=T*J,at=F*J,ht=P*J,_t=A*I,mt=L*I,ft=S*I,ut=R*G,H=E*G,O=C*G;let ot=1/0,pt=-1,vt=0,xt,Mt,ct;xt=0,Mt=0,ct=0;let St=k,It=v*Q+x*at+b*ht,dt=v*_t+x*mt+b*ft,K=v*ut+x*H+b*O;It<0&&(It=-It),dt<0&&(dt=-dt),K<0&&(K=-K);let lt=It+dt+K,rt=v*d+x*u+b*g,Vt=St+lt,At=rt<0,Yt=At?-rt:rt;if(Yt<Vt){let Jt=Vt-Yt;Jt<1/0&&(ot=Jt,pt=0,xt=v,Mt=x,ct=b,vt=At?-1:1)}else return;St=V;let Xt=Y*Q+w*at+Z*ht,Nt=Y*_t+w*mt+Z*ft,ie=Y*ut+w*H+Z*O;Xt<0&&(Xt=-Xt),Nt<0&&(Nt=-Nt),ie<0&&(ie=-ie),lt=Xt+Nt+ie,rt=Y*d+w*u+Z*g;let ee=St+lt,Ze=rt<0,ze=Ze?-rt:rt;if(ze<ee){let Jt=ee-ze;Jt<ot&&(ot=Jt,pt=1,xt=Y,Mt=w,ct=Z,vt=Ze?-1:1)}else return;St=B;let pe=X*Q+M*at+z*ht,$t=X*_t+M*mt+z*ft,Ht=X*ut+M*H+z*O;pe<0&&(pe=-pe),$t<0&&($t=-$t),Ht<0&&(Ht=-Ht),lt=pe+$t+Ht,rt=X*d+M*u+z*g;let ue=St+lt,Ie=rt<0,qe=Ie?-rt:rt;if(qe<ue){let Jt=ue-qe;Jt<ot&&(ot=Jt,pt=2,xt=X,Mt=M,ct=z,vt=Ie?-1:1)}else return;ot>y.common.Setting.linearSlop?ot-=y.common.Setting.linearSlop:ot=0;let Ee=T*D+F*et+P*$,Ut=T*j+F*q+P*tt,nt=T*W+F*U+P*it;Ee<0&&(Ee=-Ee),Ut<0&&(Ut=-Ut),nt<0&&(nt=-nt),St=Ee+Ut+nt,lt=J,rt=T*d+F*u+P*g;let gt=St+lt,yt=rt<0,bt=yt?-rt:rt;if(bt<gt){let Jt=gt-bt;Jt<ot&&(ot=Jt,pt=3,xt=T,Mt=F,ct=P,vt=yt?-1:1)}else return;let st=A*D+L*et+S*$,Pt=A*j+L*q+S*tt,Dt=A*W+L*U+S*it;st<0&&(st=-st),Pt<0&&(Pt=-Pt),Dt<0&&(Dt=-Dt),St=st+Pt+Dt,lt=I,rt=A*d+L*u+S*g;let N=St+lt,kt=rt<0,Rt=kt?-rt:rt;if(Rt<N){let Jt=N-Rt;Jt<ot&&(ot=Jt,pt=4,xt=A,Mt=L,ct=S,vt=kt?-1:1)}else return;let Ot=R*D+E*et+C*$,Wt=R*j+E*q+C*tt,Bt=R*W+E*U+C*it;Ot<0&&(Ot=-Ot),Wt<0&&(Wt=-Wt),Bt<0&&(Bt=-Bt),St=Ot+Wt+Bt,lt=G,rt=R*d+E*u+C*g;let re=St+lt,Ce=rt<0,be=Ce?-rt:rt;if(be<re){let Jt=re-be;Jt<ot&&(ot=Jt,pt=5,xt=R,Mt=E,ct=C,vt=Ce?-1:1)}else return;ot>y.common.Setting.linearSlop?ot-=y.common.Setting.linearSlop:ot=0;let Tt,Lt,Zt;if(Tt=x*P-b*F,Lt=b*T-v*P,Zt=v*F-x*T,!(Tt==0&&Lt==0&&Zt==0)){let Jt=Tt*Tt+Lt*Lt+Zt*Zt;Jt>0&&(Jt=1/Math.sqrt(Jt)),Tt*=Jt,Lt*=Jt,Zt*=Jt;let ve=Tt*j+Lt*q+Zt*tt,Qt=Tt*W+Lt*U+Zt*it;ve<0&&(ve=-ve),Qt<0&&(Qt=-Qt),St=ve+Qt;let zt=Tt*_t+Lt*mt+Zt*ft,Et=Tt*ut+Lt*H+Zt*O;zt<0&&(zt=-zt),Et<0&&(Et=-Et),lt=zt+Et,rt=Tt*d+Lt*u+Zt*g;let Kt=St+lt,te=rt<0,ne=te?-rt:rt;if(ne<Kt){let _e=Kt-ne;_e<ot&&(ot=_e,pt=6,xt=Tt,Mt=Lt,ct=Zt,vt=te?-1:1)}else return}if(Tt=x*S-b*L,Lt=b*A-v*S,Zt=v*L-x*A,!(Tt==0&&Lt==0&&Zt==0)){let Jt=Tt*Tt+Lt*Lt+Zt*Zt;Jt>0&&(Jt=1/Math.sqrt(Jt)),Tt*=Jt,Lt*=Jt,Zt*=Jt;let ve=Tt*j+Lt*q+Zt*tt,Qt=Tt*W+Lt*U+Zt*it;ve<0&&(ve=-ve),Qt<0&&(Qt=-Qt),St=ve+Qt;let zt=Tt*Q+Lt*at+Zt*ht,Et=Tt*ut+Lt*H+Zt*O;zt<0&&(zt=-zt),Et<0&&(Et=-Et),lt=zt+Et,rt=Tt*d+Lt*u+Zt*g;let Kt=St+lt,te=rt<0,ne=te?-rt:rt;if(ne<Kt){let _e=Kt-ne;_e<ot&&(ot=_e,pt=7,xt=Tt,Mt=Lt,ct=Zt,vt=te?-1:1)}else return}if(Tt=x*C-b*E,Lt=b*R-v*C,Zt=v*E-x*R,!(Tt==0&&Lt==0&&Zt==0)){let Jt=Tt*Tt+Lt*Lt+Zt*Zt;Jt>0&&(Jt=1/Math.sqrt(Jt)),Tt*=Jt,Lt*=Jt,Zt*=Jt;let ve=Tt*j+Lt*q+Zt*tt,Qt=Tt*W+Lt*U+Zt*it;ve<0&&(ve=-ve),Qt<0&&(Qt=-Qt),St=ve+Qt;let zt=Tt*Q+Lt*at+Zt*ht,Et=Tt*_t+Lt*mt+Zt*ft;zt<0&&(zt=-zt),Et<0&&(Et=-Et),lt=zt+Et,rt=Tt*d+Lt*u+Zt*g;let Kt=St+lt,te=rt<0,ne=te?-rt:rt;if(ne<Kt){let _e=Kt-ne;_e<ot&&(ot=_e,pt=8,xt=Tt,Mt=Lt,ct=Zt,vt=te?-1:1)}else return}if(Tt=w*P-Z*F,Lt=Z*T-Y*P,Zt=Y*F-w*T,!(Tt==0&&Lt==0&&Zt==0)){let Jt=Tt*Tt+Lt*Lt+Zt*Zt;Jt>0&&(Jt=1/Math.sqrt(Jt)),Tt*=Jt,Lt*=Jt,Zt*=Jt;let ve=Tt*D+Lt*et+Zt*$,Qt=Tt*W+Lt*U+Zt*it;ve<0&&(ve=-ve),Qt<0&&(Qt=-Qt),St=ve+Qt;let zt=Tt*_t+Lt*mt+Zt*ft,Et=Tt*ut+Lt*H+Zt*O;zt<0&&(zt=-zt),Et<0&&(Et=-Et),lt=zt+Et,rt=Tt*d+Lt*u+Zt*g;let Kt=St+lt,te=rt<0,ne=te?-rt:rt;if(ne<Kt){let _e=Kt-ne;_e<ot&&(ot=_e,pt=9,xt=Tt,Mt=Lt,ct=Zt,vt=te?-1:1)}else return}if(Tt=w*S-Z*L,Lt=Z*A-Y*S,Zt=Y*L-w*A,!(Tt==0&&Lt==0&&Zt==0)){let Jt=Tt*Tt+Lt*Lt+Zt*Zt;Jt>0&&(Jt=1/Math.sqrt(Jt)),Tt*=Jt,Lt*=Jt,Zt*=Jt;let ve=Tt*D+Lt*et+Zt*$,Qt=Tt*W+Lt*U+Zt*it;ve<0&&(ve=-ve),Qt<0&&(Qt=-Qt),St=ve+Qt;let zt=Tt*Q+Lt*at+Zt*ht,Et=Tt*ut+Lt*H+Zt*O;zt<0&&(zt=-zt),Et<0&&(Et=-Et),lt=zt+Et,rt=Tt*d+Lt*u+Zt*g;let Kt=St+lt,te=rt<0,ne=te?-rt:rt;if(ne<Kt){let _e=Kt-ne;_e<ot&&(ot=_e,pt=10,xt=Tt,Mt=Lt,ct=Zt,vt=te?-1:1)}else return}if(Tt=w*C-Z*E,Lt=Z*R-Y*C,Zt=Y*E-w*R,!(Tt==0&&Lt==0&&Zt==0)){let Jt=Tt*Tt+Lt*Lt+Zt*Zt;Jt>0&&(Jt=1/Math.sqrt(Jt)),Tt*=Jt,Lt*=Jt,Zt*=Jt;let ve=Tt*D+Lt*et+Zt*$,Qt=Tt*W+Lt*U+Zt*it;ve<0&&(ve=-ve),Qt<0&&(Qt=-Qt),St=ve+Qt;let zt=Tt*Q+Lt*at+Zt*ht,Et=Tt*_t+Lt*mt+Zt*ft;zt<0&&(zt=-zt),Et<0&&(Et=-Et),lt=zt+Et,rt=Tt*d+Lt*u+Zt*g;let Kt=St+lt,te=rt<0,ne=te?-rt:rt;if(ne<Kt){let _e=Kt-ne;_e<ot&&(ot=_e,pt=11,xt=Tt,Mt=Lt,ct=Zt,vt=te?-1:1)}else return}if(Tt=M*P-z*F,Lt=z*T-X*P,Zt=X*F-M*T,!(Tt==0&&Lt==0&&Zt==0)){let Jt=Tt*Tt+Lt*Lt+Zt*Zt;Jt>0&&(Jt=1/Math.sqrt(Jt)),Tt*=Jt,Lt*=Jt,Zt*=Jt;let ve=Tt*D+Lt*et+Zt*$,Qt=Tt*j+Lt*q+Zt*tt;ve<0&&(ve=-ve),Qt<0&&(Qt=-Qt),St=ve+Qt;let zt=Tt*_t+Lt*mt+Zt*ft,Et=Tt*ut+Lt*H+Zt*O;zt<0&&(zt=-zt),Et<0&&(Et=-Et),lt=zt+Et,rt=Tt*d+Lt*u+Zt*g;let Kt=St+lt,te=rt<0,ne=te?-rt:rt;if(ne<Kt){let _e=Kt-ne;_e<ot&&(ot=_e,pt=12,xt=Tt,Mt=Lt,ct=Zt,vt=te?-1:1)}else return}if(Tt=M*S-z*L,Lt=z*A-X*S,Zt=X*L-M*A,!(Tt==0&&Lt==0&&Zt==0)){let Jt=Tt*Tt+Lt*Lt+Zt*Zt;Jt>0&&(Jt=1/Math.sqrt(Jt)),Tt*=Jt,Lt*=Jt,Zt*=Jt;let ve=Tt*D+Lt*et+Zt*$,Qt=Tt*j+Lt*q+Zt*tt;ve<0&&(ve=-ve),Qt<0&&(Qt=-Qt),St=ve+Qt;let zt=Tt*Q+Lt*at+Zt*ht,Et=Tt*ut+Lt*H+Zt*O;zt<0&&(zt=-zt),Et<0&&(Et=-Et),lt=zt+Et,rt=Tt*d+Lt*u+Zt*g;let Kt=St+lt,te=rt<0,ne=te?-rt:rt;if(ne<Kt){let _e=Kt-ne;_e<ot&&(ot=_e,pt=13,xt=Tt,Mt=Lt,ct=Zt,vt=te?-1:1)}else return}if(Tt=M*C-z*E,Lt=z*R-X*C,Zt=X*E-M*R,!(Tt==0&&Lt==0&&Zt==0)){let Jt=Tt*Tt+Lt*Lt+Zt*Zt;Jt>0&&(Jt=1/Math.sqrt(Jt)),Tt*=Jt,Lt*=Jt,Zt*=Jt;let ve=Tt*D+Lt*et+Zt*$,Qt=Tt*j+Lt*q+Zt*tt;ve<0&&(ve=-ve),Qt<0&&(Qt=-Qt),St=ve+Qt;let zt=Tt*Q+Lt*at+Zt*ht,Et=Tt*_t+Lt*mt+Zt*ft;zt<0&&(zt=-zt),Et<0&&(Et=-Et),lt=zt+Et,rt=Tt*d+Lt*u+Zt*g;let Kt=St+lt,te=rt<0,ne=te?-rt:rt;if(ne<Kt){let _e=Kt-ne;_e<ot&&(ot=_e,pt=14,xt=Tt,Mt=Lt,ct=Zt,vt=te?-1:1)}else return}if(pt>=6){xt*=vt,Mt*=vt,ct*=vt;let Jt=(pt-6)/3|0,ve=pt-6-Jt*3,Qt,zt,Et,Kt,te,ne,_e,de,Ye,ye,oe,Ft;switch(Jt){case 0:_e=v,de=x,Ye=b;let ia=W*xt+U*Mt+it*ct>0;j*xt+q*Mt+tt*ct>0?ia?(Qt=j+W,zt=q+U,Et=tt+it):(Qt=j-W,zt=q-U,Et=tt-it):ia?(Qt=W-j,zt=U-q,Et=it-tt):(Qt=j+W,zt=q+U,Et=tt+it,Qt=-Qt,zt=-zt,Et=-Et);break;case 1:_e=Y,de=w,Ye=Z;let na=W*xt+U*Mt+it*ct>0;D*xt+et*Mt+$*ct>0?na?(Qt=D+W,zt=et+U,Et=$+it):(Qt=D-W,zt=et-U,Et=$-it):na?(Qt=W-D,zt=U-et,Et=it-$):(Qt=D+W,zt=et+U,Et=$+it,Qt=-Qt,zt=-zt,Et=-Et);break;default:_e=X,de=M,Ye=z;let sa=j*xt+q*Mt+tt*ct>0;D*xt+et*Mt+$*ct>0?sa?(Qt=D+j,zt=et+q,Et=$+tt):(Qt=D-j,zt=et-q,Et=$-tt):sa?(Qt=j-D,zt=q-et,Et=tt-$):(Qt=D+j,zt=et+q,Et=$+tt,Qt=-Qt,zt=-zt,Et=-Et)}switch(Qt=a+Qt,zt=l+zt,Et=h+Et,ve){case 0:ye=T,oe=F,Ft=P;let ia=ut*xt+H*Mt+O*ct>0;_t*xt+mt*Mt+ft*ct>0?ia?(Kt=_t+ut,te=mt+H,ne=ft+O):(Kt=_t-ut,te=mt-H,ne=ft-O):ia?(Kt=ut-_t,te=H-mt,ne=O-ft):(Kt=_t+ut,te=mt+H,ne=ft+O,Kt=-Kt,te=-te,ne=-ne);break;case 1:ye=A,oe=L,Ft=S;let na=ut*xt+H*Mt+O*ct>0;Q*xt+at*Mt+ht*ct>0?na?(Kt=Q+ut,te=at+H,ne=ht+O):(Kt=Q-ut,te=at-H,ne=ht-O):na?(Kt=ut-Q,te=H-at,ne=O-ht):(Kt=Q+ut,te=at+H,ne=ht+O,Kt=-Kt,te=-te,ne=-ne);break;default:ye=R,oe=E,Ft=C;let sa=_t*xt+mt*Mt+ft*ct>0;Q*xt+at*Mt+ht*ct>0?sa?(Kt=Q+_t,te=at+mt,ne=ht+ft):(Kt=Q-_t,te=at-mt,ne=ht-ft):sa?(Kt=_t-Q,te=mt-at,ne=ft-ht):(Kt=Q+_t,te=at+mt,ne=ht+ft,Kt=-Kt,te=-te,ne=-ne)}Kt=m-Kt,te=f-te,ne=p-ne;let ae,Xe,Oe;ae=Qt-Kt,Xe=zt-te,Oe=Et-ne;let oi=_e*ye+de*oe+Ye*Ft,pi=_e*ae+de*Xe+Ye*Oe,$e=ye*ae+oe*Xe+Ft*Oe,si=1/(1-oi*oi),je=(oi*$e-pi)*si,De=($e-oi*pi)*si,mi,wi,Xi,Yi,ki,vl;mi=Qt+_e*je,wi=zt+de*je,Xi=Et+Ye*je,Yi=Kt+ye*De,ki=te+oe*De,vl=ne+Ft*De;let xl,bl,yl;xl=-xt,bl=-Mt,yl=-ct,this.setNormal(t,xl,bl,yl),this.addPoint(t,mi,wi,Xi,Yi,ki,vl,ot,4);return}let me,Me,fe,ti;pt>=3?(vt=-vt,d=-d,u=-u,g=-g,k=J,V=I,B=G,a=m,l=f,h=p,me=v,Me=x,fe=b,v=T,x=F,b=P,T=me,F=Me,P=fe,me=Y,Me=w,fe=Z,Y=A,w=L,Z=S,A=me,L=Me,S=fe,me=X,Me=M,fe=z,X=R,M=E,z=C,R=me,E=Me,C=fe,me=D,Me=et,fe=$,D=Q,et=at,$=ht,Q=me,at=Me,ht=fe,me=j,Me=q,fe=tt,j=_t,q=mt,tt=ft,_t=me,mt=Me,ft=fe,me=W,Me=U,fe=it,W=ut,U=H,it=O,ut=me,H=Me,O=fe,pt-=3,ti=!0):ti=!1;let di,Le,_i,yi,he,gi,bi,Mi,Ii,He,Je,Ke,ci,hi;switch(pt){case 0:di=D,Le=et,_i=$,yi=v,he=x,gi=b,bi=Y,Mi=w,Ii=Z,He=X,Je=M,Ke=z,ci=V,hi=B;break;case 1:di=j,Le=q,_i=tt,yi=Y,he=w,gi=Z,bi=X,Mi=M,Ii=z,He=v,Je=x,Ke=b,ci=B,hi=k;break;default:di=W,Le=U,_i=it,yi=X,he=M,gi=z,bi=v,Mi=x,Ii=b,He=Y,Je=w,Ke=Z,ci=k,hi=V}if(vt<0){di=-di,Le=-Le,_i=-_i,yi=-yi,he=-he,gi=-gi,me=bi,Me=Mi,fe=Ii,bi=He,Mi=Je,Ii=Ke,He=me,Je=Me,Ke=fe;let Jt=ci;ci=hi,hi=Jt}di+=a,Le+=l,_i+=h;let ei=1,ai=0,Qe=yi*T+he*F+gi*P;Qe<ei&&(ei=Qe,ai=0),-Qe<ei&&(ei=-Qe,ai=1),Qe=yi*A+he*L+gi*S,Qe<ei&&(ei=Qe,ai=2),-Qe<ei&&(ei=-Qe,ai=3),Qe=yi*R+he*E+gi*C,Qe<ei&&(ei=Qe,ai=4),-Qe<ei&&(ai=5);let We,ke,le,ge,jt,Ae,Se,Re,Te,Ne,se,Ct;switch(ai){case 0:We=Q+_t,ke=at+mt,le=ht+ft,We+=ut,ke+=H,le+=O,ge=Q-_t,jt=at-mt,Ae=ht-ft,ge+=ut,jt+=H,Ae+=O,Se=Q-_t,Re=at-mt,Te=ht-ft,Se-=ut,Re-=H,Te-=O,Ne=Q+_t,se=at+mt,Ct=ht+ft,Ne-=ut,se-=H,Ct-=O;break;case 1:We=_t-Q,ke=mt-at,le=ft-ht,We+=ut,ke+=H,le+=O,ge=_t-Q,jt=mt-at,Ae=ft-ht,ge-=ut,jt-=H,Ae-=O,Se=Q+_t,Re=at+mt,Te=ht+ft,Se=-Se,Re=-Re,Te=-Te,Se-=ut,Re-=H,Te-=O,Ne=Q+_t,se=at+mt,Ct=ht+ft,Ne=-Ne,se=-se,Ct=-Ct,Ne+=ut,se+=H,Ct+=O;break;case 2:We=Q+_t,ke=at+mt,le=ht+ft,We+=ut,ke+=H,le+=O,ge=Q+_t,jt=at+mt,Ae=ht+ft,ge-=ut,jt-=H,Ae-=O,Se=_t-Q,Re=mt-at,Te=ft-ht,Se-=ut,Re-=H,Te-=O,Ne=_t-Q,se=mt-at,Ct=ft-ht,Ne+=ut,se+=H,Ct+=O;break;case 3:We=Q-_t,ke=at-mt,le=ht-ft,We+=ut,ke+=H,le+=O,ge=Q+_t,jt=at+mt,Ae=ht+ft,ge=-ge,jt=-jt,Ae=-Ae,ge+=ut,jt+=H,Ae+=O,Se=Q+_t,Re=at+mt,Te=ht+ft,Se=-Se,Re=-Re,Te=-Te,Se-=ut,Re-=H,Te-=O,Ne=Q-_t,se=at-mt,Ct=ht-ft,Ne-=ut,se-=H,Ct-=O;break;case 4:We=Q+_t,ke=at+mt,le=ht+ft,We+=ut,ke+=H,le+=O,ge=_t-Q,jt=mt-at,Ae=ft-ht,ge+=ut,jt+=H,Ae+=O,Se=Q+_t,Re=at+mt,Te=ht+ft,Se=-Se,Re=-Re,Te=-Te,Se+=ut,Re+=H,Te+=O,Ne=Q-_t,se=at-mt,Ct=ht-ft,Ne+=ut,se+=H,Ct+=O;break;default:We=Q+_t,ke=at+mt,le=ht+ft,We-=ut,ke-=H,le-=O,ge=Q-_t,jt=at-mt,Ae=ht-ft,ge-=ut,jt-=H,Ae-=O,Se=Q+_t,Re=at+mt,Te=ht+ft,Se=-Se,Re=-Re,Te=-Te,Se-=ut,Re-=H,Te-=O,Ne=_t-Q,se=mt-at,Ct=ft-ht,Ne-=ut,se-=H,Ct-=O}We+=d,ke+=u,le+=g,ge+=d,jt+=u,Ae+=g,Se+=d,Re+=u,Te+=g,Ne+=d,se+=u,Ct+=g;let Gt=this.clipper;Gt.w=ci,Gt.h=hi,Gt.numVertices=0,Gt.numTmpVertices=0;let Pe=this.clipper,Ve=Pe.vertices[Pe.numVertices++];Ve.x=We*bi+ke*Mi+le*Ii,Ve.y=We*He+ke*Je+le*Ke,Ve.wx=We,Ve.wy=ke,Ve.wz=le;let Ue=this.clipper,ii=Ue.vertices[Ue.numVertices++];ii.x=ge*bi+jt*Mi+Ae*Ii,ii.y=ge*He+jt*Je+Ae*Ke,ii.wx=ge,ii.wy=jt,ii.wz=Ae;let ri=this.clipper,ui=ri.vertices[ri.numVertices++];ui.x=Se*bi+Re*Mi+Te*Ii,ui.y=Se*He+Re*Je+Te*Ke,ui.wx=Se,ui.wy=Re,ui.wz=Te;let vi=this.clipper,ce=vi.vertices[vi.numVertices++];ce.x=Ne*bi+se*Mi+Ct*Ii,ce.y=Ne*He+se*Je+Ct*Ke,ce.wx=Ne,ce.wy=se,ce.wz=Ct,this.clipper.clip(),this.clipper.reduce();let Ge,we,Be;ti?(Ge=yi,we=he,Be=gi):(Ge=-yi,we=-he,Be=-gi),this.setNormal(t,Ge,we,Be);let xe=0,qt=this.clipper.numVertices;for(;xe<qt;){let Jt=xe++,ve=this.clipper.vertices[Jt],Qt,zt,Et;Qt=ve.wx,zt=ve.wy,Et=ve.wz,Qt+=a,zt+=l,Et+=h;let Kt,te,ne;Kt=di-Qt,te=Le-zt,ne=_i-Et;let _e=Kt*yi+te*he+ne*gi,de,Ye,ye;de=Qt+yi*_e,Ye=zt+he*_e,ye=Et+gi*_e,_e>-y.common.Setting.contactPersistenceThreshold&&(ti?this.addPoint(t,Qt,zt,Et,de,Ye,ye,_e,Jt):this.addPoint(t,de,Ye,ye,Qt,zt,Et,_e,Jt))}}};y.collision.narrowphase.detector._BoxBoxDetector||(y.collision.narrowphase.detector._BoxBoxDetector={});y.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex=class{constructor(){this.x=0,this.y=0,this.wx=0,this.wy=0,this.wz=0}};y.collision.narrowphase.detector._BoxBoxDetector.FaceClipper=class{constructor(){this.w=0,this.h=0,this.numVertices=0,this.numTmpVertices=0,this.vertices=new Array(8),this.tmpVertices=new Array(8),this.vertices[0]=new y.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[0]=new y.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[1]=new y.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[1]=new y.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[2]=new y.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[2]=new y.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[3]=new y.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[3]=new y.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[4]=new y.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[4]=new y.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[5]=new y.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[5]=new y.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[6]=new y.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[6]=new y.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[7]=new y.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[7]=new y.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex}clip(){let t=0,e=this.numVertices;for(;t<e;){let f=t++,p=this.vertices[f],d=this.vertices[(f+1)%this.numVertices],u=this.w+p.x,g=this.w+d.x;if(u>0&&g>0){let v=this.tmpVertices[this.numTmpVertices++];v.x=p.x,v.y=p.y,v.wx=p.wx,v.wy=p.wy,v.wz=p.wz}else if(u>0&&g<=0){let v=this.tmpVertices[this.numTmpVertices++];v.x=p.x,v.y=p.y,v.wx=p.wx,v.wy=p.wy,v.wz=p.wz;let x=u/(u-g),b=this.tmpVertices[this.numTmpVertices++];b.x=p.x+(d.x-p.x)*x,b.y=p.y+(d.y-p.y)*x,b.wx=p.wx+(d.wx-p.wx)*x,b.wy=p.wy+(d.wy-p.wy)*x,b.wz=p.wz+(d.wz-p.wz)*x}else if(u<=0&&g>0){let v=u/(u-g),x=this.tmpVertices[this.numTmpVertices++];x.x=p.x+(d.x-p.x)*v,x.y=p.y+(d.y-p.y)*v,x.wx=p.wx+(d.wx-p.wx)*v,x.wy=p.wy+(d.wy-p.wy)*v,x.wz=p.wz+(d.wz-p.wz)*v}}let i=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=i,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;let n=0,s=this.numVertices;for(;n<s;){let f=n++,p=this.vertices[f],d=this.vertices[(f+1)%this.numVertices],u=this.w-p.x,g=this.w-d.x;if(u>0&&g>0){let v=this.tmpVertices[this.numTmpVertices++];v.x=p.x,v.y=p.y,v.wx=p.wx,v.wy=p.wy,v.wz=p.wz}else if(u>0&&g<=0){let v=this.tmpVertices[this.numTmpVertices++];v.x=p.x,v.y=p.y,v.wx=p.wx,v.wy=p.wy,v.wz=p.wz;let x=u/(u-g),b=this.tmpVertices[this.numTmpVertices++];b.x=p.x+(d.x-p.x)*x,b.y=p.y+(d.y-p.y)*x,b.wx=p.wx+(d.wx-p.wx)*x,b.wy=p.wy+(d.wy-p.wy)*x,b.wz=p.wz+(d.wz-p.wz)*x}else if(u<=0&&g>0){let v=u/(u-g),x=this.tmpVertices[this.numTmpVertices++];x.x=p.x+(d.x-p.x)*v,x.y=p.y+(d.y-p.y)*v,x.wx=p.wx+(d.wx-p.wx)*v,x.wy=p.wy+(d.wy-p.wy)*v,x.wz=p.wz+(d.wz-p.wz)*v}}let o=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=o,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;let r=0,_=this.numVertices;for(;r<_;){let f=r++,p=this.vertices[f],d=this.vertices[(f+1)%this.numVertices],u=this.h+p.y,g=this.h+d.y;if(u>0&&g>0){let v=this.tmpVertices[this.numTmpVertices++];v.x=p.x,v.y=p.y,v.wx=p.wx,v.wy=p.wy,v.wz=p.wz}else if(u>0&&g<=0){let v=this.tmpVertices[this.numTmpVertices++];v.x=p.x,v.y=p.y,v.wx=p.wx,v.wy=p.wy,v.wz=p.wz;let x=u/(u-g),b=this.tmpVertices[this.numTmpVertices++];b.x=p.x+(d.x-p.x)*x,b.y=p.y+(d.y-p.y)*x,b.wx=p.wx+(d.wx-p.wx)*x,b.wy=p.wy+(d.wy-p.wy)*x,b.wz=p.wz+(d.wz-p.wz)*x}else if(u<=0&&g>0){let v=u/(u-g),x=this.tmpVertices[this.numTmpVertices++];x.x=p.x+(d.x-p.x)*v,x.y=p.y+(d.y-p.y)*v,x.wx=p.wx+(d.wx-p.wx)*v,x.wy=p.wy+(d.wy-p.wy)*v,x.wz=p.wz+(d.wz-p.wz)*v}}let a=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=a,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;let l=0,h=this.numVertices;for(;l<h;){let f=l++,p=this.vertices[f],d=this.vertices[(f+1)%this.numVertices],u=this.h-p.y,g=this.h-d.y;if(u>0&&g>0){let v=this.tmpVertices[this.numTmpVertices++];v.x=p.x,v.y=p.y,v.wx=p.wx,v.wy=p.wy,v.wz=p.wz}else if(u>0&&g<=0){let v=this.tmpVertices[this.numTmpVertices++];v.x=p.x,v.y=p.y,v.wx=p.wx,v.wy=p.wy,v.wz=p.wz;let x=u/(u-g),b=this.tmpVertices[this.numTmpVertices++];b.x=p.x+(d.x-p.x)*x,b.y=p.y+(d.y-p.y)*x,b.wx=p.wx+(d.wx-p.wx)*x,b.wy=p.wy+(d.wy-p.wy)*x,b.wz=p.wz+(d.wz-p.wz)*x}else if(u<=0&&g>0){let v=u/(u-g),x=this.tmpVertices[this.numTmpVertices++];x.x=p.x+(d.x-p.x)*v,x.y=p.y+(d.y-p.y)*v,x.wx=p.wx+(d.wx-p.wx)*v,x.wy=p.wy+(d.wy-p.wy)*v,x.wz=p.wz+(d.wz-p.wz)*v}}let m=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=m,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}reduce(){if(this.numVertices<4)return;let t=-1/0,e=1/0,i=-1/0,n=1/0,s=null,o=null,r=null,_=null,a=1,l=1,h=-1,m=1,f=0,p=this.numVertices;for(;f<p;){let b=f++,Y=this.vertices[b],w=Y.x*a+Y.y*l,Z=Y.x*h+Y.y*m;b==0?(t=w,s=Y,e=w,o=Y,i=Z,r=Y,n=Z,_=Y):(w>t&&(t=w,s=Y),w<e&&(e=w,o=Y),Z>i&&(i=Z,r=Y),Z<n&&(n=Z,_=Y))}let d=this.tmpVertices[this.numTmpVertices++];d.x=s.x,d.y=s.y,d.wx=s.wx,d.wy=s.wy,d.wz=s.wz;let u=this.tmpVertices[this.numTmpVertices++];u.x=r.x,u.y=r.y,u.wx=r.wx,u.wy=r.wy,u.wz=r.wz;let g=this.tmpVertices[this.numTmpVertices++];g.x=o.x,g.y=o.y,g.wx=o.wx,g.wy=o.wy,g.wz=o.wz;let v=this.tmpVertices[this.numTmpVertices++];v.x=_.x,v.y=_.y,v.wx=_.wx,v.wy=_.wy,v.wz=_.wz;let x=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=x,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}};y.collision.narrowphase.detector.BoxBoxDetectorMacro=class{};y.collision.narrowphase.detector.CachedDetectorData=class{constructor(){}_clear(){this._gjkCache!=null&&this._gjkCache.clear()}};y.collision.narrowphase.detector.CapsuleCapsuleDetector=class extends y.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,e,i,n,s,o){let r=e,_=i;t.incremental=!1;let a,l,h,m,f,p;a=n._rotation01,l=n._rotation11,h=n._rotation21,m=s._rotation01,f=s._rotation11,p=s._rotation21;let d=r._halfHeight,u=_._halfHeight,g=r._radius,v=_._radius,x,b,Y,w,Z,X,M,z,T,F,P,A;x=n._positionX+a*-d,b=n._positionY+l*-d,Y=n._positionZ+h*-d,w=n._positionX+a*d,Z=n._positionY+l*d,X=n._positionZ+h*d,M=s._positionX+m*-u,z=s._positionY+f*-u,T=s._positionZ+p*-u,F=s._positionX+m*u,P=s._positionY+f*u,A=s._positionZ+p*u;let L,S,R;L=x-M,S=b-z,R=Y-T;let E,C,k,V,B,J;E=w-x,C=Z-b,k=X-Y,V=F-M,B=P-z,J=A-T;let I=-(L*E+S*C+R*k),G=L*V+S*B+R*J,D=d*d*4,et=E*V+C*B+k*J,$=u*u*4,j,q;if(D==0&&$==0)j=0,q=0;else if(D==0)j=0,G<0?q=0:G>$?q=1:q=G/$;else if($==0)q=0,I<0?j=0:I>D?j=1:j=I/D;else{let It=D*$-et*et;It==0?j=0:(j=et*G+$*I,j<0?j=0:j>It?j=1:j/=It),q=j*et+G,q<0?(q=0,I<0?j=0:I>D?j=1:j=I/D):q>$?(q=1,j=et+I,j<0?j=0:j>D?j=1:j/=D):q/=$}let tt,W,U,it,Q,at;tt=x+E*j,W=b+C*j,U=Y+k*j,it=M+V*q,Q=z+B*q,at=T+J*q;let ht,_t,mt;ht=tt-it,_t=W-Q,mt=U-at;let ft=ht*ht+_t*_t+mt*mt;if(ft>=(g+v)*(g+v))return;let ut=Math.sqrt(ft),H,O,ot;ut>0?(H=ht*(1/ut),O=_t*(1/ut),ot=mt*(1/ut)):(H=1,O=0,ot=0),this.setNormal(t,H,O,ot);let pt,vt,xt,Mt,ct,St;pt=tt+H*-g,vt=W+O*-g,xt=U+ot*-g,Mt=it+H*v,ct=Q+O*v,St=at+ot*v,this.addPoint(t,pt,vt,xt,Mt,ct,St,g+v-ut,0)}};y.collision.narrowphase.detector.GjkEpaDetector=class extends y.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,e,i,n,s,o){let r=y.collision.narrowphase.detector.gjkepa.GjkEpa.instance,_=e,a=i,l=r.computeClosestPointsImpl(_,a,n,s,y.common.Setting.enableGJKCaching?o:null,!0);if(t.incremental=!0,l!=y.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED){console.log("src/oimo/collision/narrowphase/detector/GjkEpaDetector.hx:28:","GJK/EPA failed: status="+l);return}if(r.distance>_._gjkMargin+a._gjkMargin)return;let h,m,f,p,d,u,g=r.closestPoint1;h=g.x,m=g.y,f=g.z;let v=r.closestPoint2;p=v.x,d=v.y,u=v.z;let x,b,Y;if(x=h-p,b=m-d,Y=f-u,x*x+b*b+Y*Y==0)return;r.distance<0&&(x=-x,b=-b,Y=-Y);let w=x*x+b*b+Y*Y;w>0&&(w=1/Math.sqrt(w)),x*=w,b*=w,Y*=w,this.setNormal(t,x,b,Y),h+=x*-_._gjkMargin,m+=b*-_._gjkMargin,f+=Y*-_._gjkMargin,p+=x*a._gjkMargin,d+=b*a._gjkMargin,u+=Y*a._gjkMargin,this.addPoint(t,h,m,f,p,d,u,_._gjkMargin+a._gjkMargin-r.distance,0)}};y.collision.narrowphase.detector.SphereBoxDetector=class extends y.collision.narrowphase.detector.Detector{constructor(t){super(t)}detectImpl(t,e,i,n,s,o){let r=i;t.incremental=!1;let _,a,l,h,m,f;_=r._halfExtentsX,a=r._halfExtentsY,l=r._halfExtentsZ,h=-_,m=-a,f=-l;let p=e._radius,d,u,g;d=n._positionX-s._positionX,u=n._positionY-s._positionY,g=n._positionZ-s._positionZ;let v,x,b,Y,w,Z;if(Y=s._rotation00*d+s._rotation10*u+s._rotation20*g,w=s._rotation01*d+s._rotation11*u+s._rotation21*g,Z=s._rotation02*d+s._rotation12*u+s._rotation22*g,v=Y,x=w,b=Z,h<v&&_>v&&m<x&&a>x&&f<b&&l>b){let ht,_t,mt;ht=v<0?-v:v,_t=x<0?-x:x,mt=b<0?-b:b,ht=_-ht,_t=a-_t,mt=l-mt;let ft,ut,H,O=ht,ot=_t,pt=mt,vt,xt,Mt,ct;O<ot?O<pt?(v>0?(ft=1,ut=0,H=0):(ft=-1,ut=0,H=0),xt=0,Mt=1,ct=1,vt=O):(b>0?(ft=0,ut=0,H=1):(ft=0,ut=0,H=-1),xt=1,Mt=1,ct=0,vt=pt):ot<pt?(x>0?(ft=0,ut=1,H=0):(ft=0,ut=-1,H=0),xt=1,Mt=0,ct=1,vt=ot):(b>0?(ft=0,ut=0,H=1):(ft=0,ut=0,H=-1),xt=1,Mt=1,ct=0,vt=pt);let St,It,dt;St=xt*v,It=Mt*x,dt=ct*b;let K,lt,rt;K=ft*_,lt=ut*a,rt=H*l,K+=St,lt+=It,rt+=dt;let Vt,At,Yt,Xt,Nt,ie,ee,Ze,ze;ee=s._rotation00*K+s._rotation01*lt+s._rotation02*rt,Ze=s._rotation10*K+s._rotation11*lt+s._rotation12*rt,ze=s._rotation20*K+s._rotation21*lt+s._rotation22*rt,Vt=ee,At=Ze,Yt=ze;let pe,$t,Ht;pe=s._rotation00*ft+s._rotation01*ut+s._rotation02*H,$t=s._rotation10*ft+s._rotation11*ut+s._rotation12*H,Ht=s._rotation20*ft+s._rotation21*ut+s._rotation22*H,Xt=pe,Nt=$t,ie=Ht,this.setNormal(t,Xt,Nt,ie);let ue,Ie,qe,Ee,Ut,nt;ue=n._positionX+Xt*-p,Ie=n._positionY+Nt*-p,qe=n._positionZ+ie*-p,Ee=s._positionX+Vt,Ut=s._positionY+At,nt=s._positionZ+Yt,this.addPoint(t,ue,Ie,qe,Ee,Ut,nt,vt,0);return}let X,M,z;_-=1e-9,a-=1e-9,l-=1e-9,h+=1e-9,m+=1e-9,f+=1e-9,X=v<_?v:_,M=x<a?x:a,z=b<l?b:l,X>h||(X=h),M>m||(M=m),z>f||(z=f);let T,F,P;T=v-X,F=x-M,P=b-z;let A=T*T+F*F+P*P;if(A>=p*p)return;A=Math.sqrt(A);let L,S,R,E,C,k,V,B,J;V=s._rotation00*X+s._rotation01*M+s._rotation02*z,B=s._rotation10*X+s._rotation11*M+s._rotation12*z,J=s._rotation20*X+s._rotation21*M+s._rotation22*z,L=V,S=B,R=J;let I,G,D;I=s._rotation00*T+s._rotation01*F+s._rotation02*P,G=s._rotation10*T+s._rotation11*F+s._rotation12*P,D=s._rotation20*T+s._rotation21*F+s._rotation22*P,E=I,C=G,k=D;let et,$,j,q=E*E+C*C+k*k;q>0&&(q=1/Math.sqrt(q)),et=E*q,$=C*q,j=k*q,this.setNormal(t,et,$,j);let tt,W,U,it,Q,at;tt=n._positionX+et*-p,W=n._positionY+$*-p,U=n._positionZ+j*-p,it=s._positionX+L,Q=s._positionY+S,at=s._positionZ+R,this.addPoint(t,tt,W,U,it,Q,at,p-A,0)}};y.collision.narrowphase.detector.SphereCapsuleDetector=class extends y.collision.narrowphase.detector.Detector{constructor(t){super(t)}detectImpl(t,e,i,n,s,o){let r=i;t.incremental=!1;let _=r._halfHeight,a=e._radius,l=r._radius,h,m,f;h=s._rotation01,m=s._rotation11,f=s._rotation21;let p,d,u;p=n._positionX,d=n._positionY,u=n._positionZ;let g,v,x,b,Y,w;g=s._positionX+h*-_,v=s._positionY+m*-_,x=s._positionZ+f*-_,b=s._positionX+h*_,Y=s._positionY+m*_,w=s._positionZ+f*_;let Z,X,M;Z=p-g,X=d-v,M=u-x;let z,T,F;z=b-g,T=Y-v,F=w-x;let P=_*_*4,A=Z*z+X*T+M*F;A<0?A=0:A>P?A=1:A/=P;let L,S,R;L=g+z*A,S=v+T*A,R=x+F*A;let E,C,k;E=p-L,C=d-S,k=u-R;let V=E*E+C*C+k*k;if(V>=(a+l)*(a+l))return;let B=Math.sqrt(V),J,I,G;B>0?(J=E*(1/B),I=C*(1/B),G=k*(1/B)):(J=1,I=0,G=0),this.setNormal(t,J,I,G);let D,et,$,j,q,tt;D=p+J*-a,et=d+I*-a,$=u+G*-a,j=L+J*l,q=S+I*l,tt=R+G*l,this.addPoint(t,D,et,$,j,q,tt,a+l-B,0)}};y.collision.narrowphase.detector.SphereSphereDetector=class extends y.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,e,i,n,s,o){t.incremental=!1;let r,_,a;r=n._positionX-s._positionX,_=n._positionY-s._positionY,a=n._positionZ-s._positionZ;let l=e._radius,h=i._radius,m=r*r+_*_+a*a;if(m>=(l+h)*(l+h))return;let f=Math.sqrt(m),p,d,u;f>0?(p=r*(1/f),d=_*(1/f),u=a*(1/f)):(p=1,d=0,u=0),this.setNormal(t,p,d,u);let g,v,x,b,Y,w;g=n._positionX+p*-l,v=n._positionY+d*-l,x=n._positionZ+u*-l,b=s._positionX+p*h,Y=s._positionY+d*h,w=s._positionZ+u*h,this.addPoint(t,g,v,x,b,Y,w,l+h-f,0)}};y.collision.narrowphase.detector.gjkepa||(y.collision.narrowphase.detector.gjkepa={});y.collision.narrowphase.detector.gjkepa.EpaPolyhedron=class{constructor(){this._vertices=new Array(y.common.Setting.maxEPAVertices),this._center=new y.common.Vec3,this._numVertices=0,this._triangleList=null,this._triangleListLast=null,this._numTriangles=0,this._trianglePool=null,this._vertexPool=null}dumpHoleEdge(t){}validate(){let t=this._triangleList;for(;t!=null;){if(t._vertices[0]._tmpEdgeLoopOuterTriangle=null,t._vertices[0]._tmpEdgeLoopNext=null,t._adjacentPairIndex[0]==-1)return this._status=2,!1;if(t._adjacentTriangles[0]==null)return this._status=3,!1;if(t._vertices[1]._tmpEdgeLoopOuterTriangle=null,t._vertices[1]._tmpEdgeLoopNext=null,t._adjacentPairIndex[1]==-1)return this._status=2,!1;if(t._adjacentTriangles[1]==null)return this._status=3,!1;if(t._vertices[2]._tmpEdgeLoopOuterTriangle=null,t._vertices[2]._tmpEdgeLoopNext=null,t._adjacentPairIndex[2]==-1)return this._status=2,!1;if(t._adjacentTriangles[2]==null)return this._status=3,!1;t=t._next}return!0}findEdgeLoop(t,e,i){if(e._tmpDfsId==t)return;e._tmpDfsId=t;let n=e.tmp;n.x=i.x,n.y=i.y,n.z=i.z;let s=e._vertices[0].v;n.x-=s.x,n.y-=s.y,n.z-=s.z;let o=e.tmp,r=e._normal;if(e._tmpDfsVisible=o.x*r.x+o.y*r.y+o.z*r.z>0,!e._tmpDfsVisible){this._status=6;return}let _=0;for(;_<3;){let p=_++,d=e._adjacentTriangles[p];if(d==null)continue;let u=d.tmp;u.x=i.x,u.y=i.y,u.z=i.z;let g=d._vertices[0].v;u.x-=g.x,u.y-=g.y,u.z-=g.z;let v=d.tmp,x=d._normal;if(d._tmpDfsVisible=v.x*x.x+v.y*x.y+v.z*x.z>0,d._tmpDfsVisible)this.findEdgeLoop(t,d,i);else{let b=e._vertices[p];b._tmpEdgeLoopNext=e._vertices[e._nextIndex[p]],b._tmpEdgeLoopOuterTriangle=d}}let a=e._adjacentTriangles[0];if(a!=null){let p=e._adjacentPairIndex[0];a._adjacentTriangles[p]=null,a._adjacentPairIndex[p]=-1,e._adjacentTriangles[0]=null,e._adjacentPairIndex[0]=-1}let l=e._adjacentTriangles[1];if(l!=null){let p=e._adjacentPairIndex[1];l._adjacentTriangles[p]=null,l._adjacentPairIndex[p]=-1,e._adjacentTriangles[1]=null,e._adjacentPairIndex[1]=-1}let h=e._adjacentTriangles[2];if(h!=null){let p=e._adjacentPairIndex[2];h._adjacentTriangles[p]=null,h._adjacentPairIndex[p]=-1,e._adjacentTriangles[2]=null,e._adjacentPairIndex[2]=-1}this._numTriangles--;let m=e._prev,f=e._next;m!=null&&(m._next=f),f!=null&&(f._prev=m),e==this._triangleList&&(this._triangleList=this._triangleList._next),e==this._triangleListLast&&(this._triangleListLast=this._triangleListLast._prev),e._next=null,e._prev=null,e.removeReferences(),e._next=this._trianglePool,this._trianglePool=e}_init(t,e,i,n){this._status=0,this._numVertices=4,this._vertices[0]=t,this._vertices[1]=e,this._vertices[2]=i,this._vertices[3]=n;let s=this._center,o=t.v;s.x=o.x,s.y=o.y,s.z=o.z;let r=e.v;s.x+=r.x,s.y+=r.y,s.z+=r.z;let _=i.v;s.x+=_.x,s.y+=_.y,s.z+=_.z;let a=n.v;s.x+=a.x,s.y+=a.y,s.z+=a.z,s.x*=.25,s.y*=.25,s.z*=.25;let l=this._trianglePool;l!=null?(this._trianglePool=l._next,l._next=null):l=new y.collision.narrowphase.detector.gjkepa.EpaTriangle;let h=l,m=this._trianglePool;m!=null?(this._trianglePool=m._next,m._next=null):m=new y.collision.narrowphase.detector.gjkepa.EpaTriangle;let f=m,p=this._trianglePool;p!=null?(this._trianglePool=p._next,p._next=null):p=new y.collision.narrowphase.detector.gjkepa.EpaTriangle;let d=p,u=this._trianglePool;u!=null?(this._trianglePool=u._next,u._next=null):u=new y.collision.narrowphase.detector.gjkepa.EpaTriangle;let g=u;return h.init(t,e,i,this._center,!0)||(this._status=1),f.init(t,e,n,this._center,!0)||(this._status=1),d.init(t,i,n,this._center,!0)||(this._status=1),g.init(e,i,n,this._center,!0)||(this._status=1),h.setAdjacentTriangle(f)||(this._status=1),h.setAdjacentTriangle(d)||(this._status=1),h.setAdjacentTriangle(g)||(this._status=1),f.setAdjacentTriangle(d)||(this._status=1),f.setAdjacentTriangle(g)||(this._status=1),d.setAdjacentTriangle(g)||(this._status=1),this._numTriangles++,this._triangleList==null?(this._triangleList=h,this._triangleListLast=h):(this._triangleListLast._next=h,h._prev=this._triangleListLast,this._triangleListLast=h),this._numTriangles++,this._triangleList==null?(this._triangleList=f,this._triangleListLast=f):(this._triangleListLast._next=f,f._prev=this._triangleListLast,this._triangleListLast=f),this._numTriangles++,this._triangleList==null?(this._triangleList=d,this._triangleListLast=d):(this._triangleListLast._next=d,d._prev=this._triangleListLast,this._triangleListLast=d),this._numTriangles++,this._triangleList==null?(this._triangleList=g,this._triangleListLast=g):(this._triangleListLast._next=g,g._prev=this._triangleListLast,this._triangleListLast=g),this._status==0}_addVertex(t,e){this._vertices[this._numVertices++]=t;let i=e._vertices[0];if(this.findEdgeLoop(this._numVertices,e,t.v),this._status!=0)return!1;let n=i,s=null,o=null;for(;;){if(n._tmpEdgeLoopNext==null)return this._dumpAsObjModel(),this._status=4,!1;if(n._tmpEdgeLoopOuterTriangle==null)return this._status=5,!1;let r=this._trianglePool;r!=null?(this._trianglePool=r._next,r._next=null):r=new y.collision.narrowphase.detector.gjkepa.EpaTriangle;let _=r;if(o==null&&(o=_),_.init(n,n._tmpEdgeLoopNext,t,this._center,!1)||(this._status=1),this._status!=0)return!1;if(this._numTriangles++,this._triangleList==null?(this._triangleList=_,this._triangleListLast=_):(this._triangleListLast._next=_,_._prev=this._triangleListLast,this._triangleListLast=_),_.setAdjacentTriangle(n._tmpEdgeLoopOuterTriangle)||(this._status=1),s!=null&&(_.setAdjacentTriangle(s)||(this._status=1)),s=_,n=n._tmpEdgeLoopNext,n==i)break}return s.setAdjacentTriangle(o)||(this._status=1),this._status==0?this.validate():!1}_dumpAsObjModel(){}};y.collision.narrowphase.detector.gjkepa.EpaPolyhedronState=class{};y.collision.narrowphase.detector.gjkepa.EpaTriangle=class{constructor(){this.id=++y.collision.narrowphase.detector.gjkepa.EpaTriangle.count,this._next=null,this._prev=null,this._normal=new y.common.Vec3,this._distanceSq=0,this._tmpDfsId=0,this._tmpDfsVisible=!1,this._vertices=new Array(3),this._adjacentTriangles=new Array(3),this._adjacentPairIndex=new Array(3),this.tmp=new y.common.Vec3,this._nextIndex=new Array(3),this._nextIndex[0]=1,this._nextIndex[1]=2,this._nextIndex[2]=0}init(t,e,i,n,s){s==null&&(s=!1);let o,r,_,a,l,h,m,f,p,d,u,g,v=t.v;o=v.x,r=v.y,_=v.z;let x=e.v;a=x.x,l=x.y,h=x.z;let b=i.v;m=b.x,f=b.y,p=b.z,d=n.x,u=n.y,g=n.z;let Y,w,Z,X,M,z,T,F,P;Y=a-o,w=l-r,Z=h-_,X=m-o,M=f-r,z=p-_,T=o-d,F=r-u,P=_-g;let A,L,S;A=w*z-Z*M,L=Z*X-Y*z,S=Y*M-w*X;let R=!1;if(T*A+F*L+P*S<0)if(s){let Yt=e;e=i,i=Yt,A*=-1,L*=-1,S*=-1}else R=!0;this._vertices[0]=t,this._vertices[1]=e,this._vertices[2]=i;let E=this._normal;E.x=A,E.y=L,E.z=S;let C=t.v,k=e.v,V=i.v,B=this.tmp,J,I,G,D,et,$,j,q,tt,W,U,it,Q,at,ht,_t,mt,ft;J=C.x,I=C.y,G=C.z,D=k.x,et=k.y,$=k.z,j=V.x,q=V.y,tt=V.z,W=D-J,U=et-I,it=$-G,Q=j-D,at=q-et,ht=tt-$,_t=J-j,mt=I-q,ft=G-tt;let ut,H,O;ut=U*ht-it*at,H=it*Q-W*ht,O=W*at-U*Q;let ot,pt,vt,xt,Mt,ct,St,It,dt;ot=U*O-it*H,pt=it*ut-W*O,vt=W*H-U*ut,xt=at*O-ht*H,Mt=ht*ut-Q*O,ct=Q*H-at*ut,St=mt*O-ft*H,It=ft*ut-_t*O,dt=_t*H-mt*ut;let K=-1,lt,rt,Vt;if(lt=0,rt=0,Vt=0,J*ot+I*pt+G*vt<0){let Yt,Xt,Nt,ie,ee,Ze;Yt=C.x,Xt=C.y,Nt=C.z,ie=k.x,ee=k.y,Ze=k.z;let ze,pe,$t;ze=ie-Yt,pe=ee-Xt,$t=Ze-Nt;let Ht=ze*Yt+pe*Xt+$t*Nt;if(Ht=-Ht/(ze*ze+pe*pe+$t*$t),Ht<0)B.x=Yt,B.y=Xt,B.z=Nt;else if(Ht>1)B.x=ie,B.y=ee,B.z=Ze;else{let ue,Ie,qe;ue=Yt+ze*Ht,Ie=Xt+pe*Ht,qe=Nt+$t*Ht,B.x=ue,B.y=Ie,B.z=qe}K=B.x*B.x+B.y*B.y+B.z*B.z,lt=B.x,rt=B.y,Vt=B.z}if(D*xt+et*Mt+$*ct<0){let Yt,Xt,Nt,ie,ee,Ze;Yt=k.x,Xt=k.y,Nt=k.z,ie=V.x,ee=V.y,Ze=V.z;let ze,pe,$t;ze=ie-Yt,pe=ee-Xt,$t=Ze-Nt;let Ht=ze*Yt+pe*Xt+$t*Nt;if(Ht=-Ht/(ze*ze+pe*pe+$t*$t),Ht<0)B.x=Yt,B.y=Xt,B.z=Nt;else if(Ht>1)B.x=ie,B.y=ee,B.z=Ze;else{let Ie,qe,Ee;Ie=Yt+ze*Ht,qe=Xt+pe*Ht,Ee=Nt+$t*Ht,B.x=Ie,B.y=qe,B.z=Ee}let ue=B.x*B.x+B.y*B.y+B.z*B.z;(K<0||ue<K)&&(K=ue,lt=B.x,rt=B.y,Vt=B.z)}if(j*St+q*It+tt*dt<0){let Yt,Xt,Nt,ie,ee,Ze;Yt=C.x,Xt=C.y,Nt=C.z,ie=V.x,ee=V.y,Ze=V.z;let ze,pe,$t;ze=ie-Yt,pe=ee-Xt,$t=Ze-Nt;let Ht=ze*Yt+pe*Xt+$t*Nt;if(Ht=-Ht/(ze*ze+pe*pe+$t*$t),Ht<0)B.x=Yt,B.y=Xt,B.z=Nt;else if(Ht>1)B.x=ie,B.y=ee,B.z=Ze;else{let Ie,qe,Ee;Ie=Yt+ze*Ht,qe=Xt+pe*Ht,Ee=Nt+$t*Ht,B.x=Ie,B.y=qe,B.z=Ee}let ue=B.x*B.x+B.y*B.y+B.z*B.z;(K<0||ue<K)&&(K=ue,lt=B.x,rt=B.y,Vt=B.z)}if(K>0)B.x=lt,B.y=rt,B.z=Vt;else{let Yt=ut*ut+H*H+O*O;Yt>0&&(Yt=1/Math.sqrt(Yt)),ut*=Yt,H*=Yt,O*=Yt;let Xt=ut*ut+H*H+O*O;Xt=(J*ut+I*H+G*O)/Xt,lt=ut*Xt,rt=H*Xt,Vt=O*Xt,B.x=lt,B.y=rt,B.z=Vt}let At=this.tmp;return this._distanceSq=At.x*At.x+At.y*At.y+At.z*At.z,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=-1,this._adjacentPairIndex[1]=-1,this._adjacentPairIndex[2]=-1,!R}setAdjacentTriangle(t){let e=0;return this._vertices[0]==t._vertices[this._nextIndex[0]]&&this._vertices[this._nextIndex[0]]==t._vertices[0]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=0,e=1),this._vertices[0]==t._vertices[this._nextIndex[1]]&&this._vertices[this._nextIndex[0]]==t._vertices[1]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=0,++e),this._vertices[0]==t._vertices[this._nextIndex[2]]&&this._vertices[this._nextIndex[0]]==t._vertices[2]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=0,++e),this._vertices[1]==t._vertices[this._nextIndex[0]]&&this._vertices[this._nextIndex[1]]==t._vertices[0]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=1,++e),this._vertices[1]==t._vertices[this._nextIndex[1]]&&this._vertices[this._nextIndex[1]]==t._vertices[1]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=1,++e),this._vertices[1]==t._vertices[this._nextIndex[2]]&&this._vertices[this._nextIndex[1]]==t._vertices[2]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=1,++e),this._vertices[2]==t._vertices[this._nextIndex[0]]&&this._vertices[this._nextIndex[2]]==t._vertices[0]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=2,++e),this._vertices[2]==t._vertices[this._nextIndex[1]]&&this._vertices[this._nextIndex[2]]==t._vertices[1]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=2,++e),this._vertices[2]==t._vertices[this._nextIndex[2]]&&this._vertices[this._nextIndex[2]]==t._vertices[2]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=2,++e),e==1}removeAdjacentTriangles(){let t=this._adjacentTriangles[0];if(t!=null){let n=this._adjacentPairIndex[0];t._adjacentTriangles[n]=null,t._adjacentPairIndex[n]=-1,this._adjacentTriangles[0]=null,this._adjacentPairIndex[0]=-1}let e=this._adjacentTriangles[1];if(e!=null){let n=this._adjacentPairIndex[1];e._adjacentTriangles[n]=null,e._adjacentPairIndex[n]=-1,this._adjacentTriangles[1]=null,this._adjacentPairIndex[1]=-1}let i=this._adjacentTriangles[2];if(i!=null){let n=this._adjacentPairIndex[2];i._adjacentTriangles[n]=null,i._adjacentPairIndex[n]=-1,this._adjacentTriangles[2]=null,this._adjacentPairIndex[2]=-1}}removeReferences(){this._next=null,this._prev=null,this._tmpDfsId=0,this._tmpDfsVisible=!1,this._distanceSq=0,this._vertices[0]=null,this._vertices[1]=null,this._vertices[2]=null,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=0,this._adjacentPairIndex[1]=0,this._adjacentPairIndex[2]=0}dump(){}};y.collision.narrowphase.detector.gjkepa.EpaVertex=class{constructor(){this.randId=Math.random()*1e5|0,this.v=new y.common.Vec3,this.w1=new y.common.Vec3,this.w2=new y.common.Vec3}init(t,e,i){let n=this.v;n.x=t.x,n.y=t.y,n.z=t.z;let s=this.w1;s.x=e.x,s.y=e.y,s.z=e.z;let o=this.w2;return o.x=i.x,o.y=i.y,o.z=i.z,this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null,this}removeReferences(){this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null}};y.collision.narrowphase.detector.gjkepa.GjkCache=class{constructor(){this.prevClosestDir=new y.common.Vec3}clear(){this.prevClosestDir.zero()}};y.common||(y.common={});y.common.Vec3=class{constructor(t,e,i){i==null&&(i=0),e==null&&(e=0),t==null&&(t=0),this.x=t,this.y=e,this.z=i,y.common.Vec3.numCreations++}init(t,e,i){return this.x=t,this.y=e,this.z=i,this}zero(){return this.x=0,this.y=0,this.z=0,this}add(t){return new y.common.Vec3(this.x+t.x,this.y+t.y,this.z+t.z)}add3(t,e,i){return new y.common.Vec3(this.x+t,this.y+e,this.z+i)}addScaled(t,e){return new y.common.Vec3(this.x+t.x*e,this.y+t.y*e,this.z+t.z*e)}sub(t){return new y.common.Vec3(this.x-t.x,this.y-t.y,this.z-t.z)}sub3(t,e,i){return new y.common.Vec3(this.x-t,this.y-e,this.z-i)}scale(t){return new y.common.Vec3(this.x*t,this.y*t,this.z*t)}scale3(t,e,i){return new y.common.Vec3(this.x*t,this.y*e,this.z*i)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return new y.common.Vec3(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}addEq(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}add3Eq(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this}addScaledEq(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}subEq(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}sub3Eq(t,e,i){return this.x-=t,this.y-=e,this.z-=i,this}scaleEq(t){return this.x*=t,this.y*=t,this.z*=t,this}scale3Eq(t,e,i){return this.x*=t,this.y*=e,this.z*=i,this}crossEq(t){let e=this.z*t.x-this.x*t.z,i=this.x*t.y-this.y*t.x;return this.x=this.y*t.z-this.z*t.y,this.y=e,this.z=i,this}mulMat3(t){return new y.common.Vec3(this.x*t.e00+this.y*t.e01+this.z*t.e02,this.x*t.e10+this.y*t.e11+this.z*t.e12,this.x*t.e20+this.y*t.e21+this.z*t.e22)}mulMat4(t){return new y.common.Vec3(this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23)}mulTransform(t){let e,i,n;e=this.x,i=this.y,n=this.z;let s,o,r;s=t._rotation00*e+t._rotation01*i+t._rotation02*n,o=t._rotation10*e+t._rotation11*i+t._rotation12*n,r=t._rotation20*e+t._rotation21*i+t._rotation22*n,e=s,i=o,n=r,e+=t._positionX,i+=t._positionY,n+=t._positionZ;let _=new y.common.Vec3;return _.x=e,_.y=i,_.z=n,_}mulMat3Eq(t){let e=this.x*t.e10+this.y*t.e11+this.z*t.e12,i=this.x*t.e20+this.y*t.e21+this.z*t.e22;return this.x=this.x*t.e00+this.y*t.e01+this.z*t.e02,this.y=e,this.z=i,this}mulMat4Eq(t){let e=this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,i=this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23;return this.x=this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,this.y=e,this.z=i,this}mulTransformEq(t){let e,i,n;e=this.x,i=this.y,n=this.z;let s,o,r;return s=t._rotation00*e+t._rotation01*i+t._rotation02*n,o=t._rotation10*e+t._rotation11*i+t._rotation12*n,r=t._rotation20*e+t._rotation21*i+t._rotation22*n,e=s,i=o,n=r,e+=t._positionX,i+=t._positionY,n+=t._positionZ,this.x=e,this.y=i,this.z=n,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}normalized(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>0&&(t=1/t),new y.common.Vec3(this.x*t,this.y*t,this.z*t)}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>0&&(t=1/t),this.x*=t,this.y*=t,this.z*=t,this}negate(){return new y.common.Vec3(-this.x,-this.y,-this.z)}negateEq(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}clone(){return new y.common.Vec3(this.x,this.y,this.z)}toString(){return"Vec3["+(this.x>0?(this.x*1e7+.5|0)/1e7:(this.x*1e7-.5|0)/1e7)+", "+(this.y>0?(this.y*1e7+.5|0)/1e7:(this.y*1e7-.5|0)/1e7)+", "+(this.z>0?(this.z*1e7+.5|0)/1e7:(this.z*1e7-.5|0)/1e7)+"]"}};y.common.Transform=class{constructor(){this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1}identity(){return this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1,this}getPosition(){let t=new y.common.Vec3;return t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ,t}getPositionTo(t){t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ}setPosition(t){return this._positionX=t.x,this._positionY=t.y,this._positionZ=t.z,this}translate(t){let e,i,n;e=t.x,i=t.y,n=t.z,this._positionX+=e,this._positionY+=i,this._positionZ+=n}getRotation(){let t=new y.common.Mat3;return t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22,t}getRotationTo(t){t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22}setRotation(t){return this._rotation00=t.e00,this._rotation01=t.e01,this._rotation02=t.e02,this._rotation10=t.e10,this._rotation11=t.e11,this._rotation12=t.e12,this._rotation20=t.e20,this._rotation21=t.e21,this._rotation22=t.e22,this}setRotationXyz(t){let e,i,n;e=t.x,i=t.y,n=t.z;let s=Math.sin(e),o=Math.sin(i),r=Math.sin(n),_=Math.cos(e),a=Math.cos(i),l=Math.cos(n);this._rotation00=a*l,this._rotation01=-a*r,this._rotation02=o,this._rotation10=_*r+l*s*o,this._rotation11=_*l-s*o*r,this._rotation12=-a*s,this._rotation20=s*r-_*l*o,this._rotation21=l*s+_*o*r,this._rotation22=_*a}rotate(t){let e,i,n,s,o,r,_,a,l;e=t.e00,i=t.e01,n=t.e02,s=t.e10,o=t.e11,r=t.e12,_=t.e20,a=t.e21,l=t.e22;let h,m,f,p,d,u,g,v,x;h=e*this._rotation00+i*this._rotation10+n*this._rotation20,m=e*this._rotation01+i*this._rotation11+n*this._rotation21,f=e*this._rotation02+i*this._rotation12+n*this._rotation22,p=s*this._rotation00+o*this._rotation10+r*this._rotation20,d=s*this._rotation01+o*this._rotation11+r*this._rotation21,u=s*this._rotation02+o*this._rotation12+r*this._rotation22,g=_*this._rotation00+a*this._rotation10+l*this._rotation20,v=_*this._rotation01+a*this._rotation11+l*this._rotation21,x=_*this._rotation02+a*this._rotation12+l*this._rotation22,this._rotation00=h,this._rotation01=m,this._rotation02=f,this._rotation10=p,this._rotation11=d,this._rotation12=u,this._rotation20=g,this._rotation21=v,this._rotation22=x}rotateXyz(t){let e,i,n,s,o,r,_,a,l,h,m,f;e=t.x,i=t.y,n=t.z;let p=Math.sin(e),d=Math.sin(i),u=Math.sin(n),g=Math.cos(e),v=Math.cos(i),x=Math.cos(n);s=v*x,o=-v*u,r=d,_=g*u+x*p*d,a=g*x-p*d*u,l=-v*p,h=p*u-g*x*d,m=x*p+g*d*u,f=g*v;let b,Y,w,Z,X,M,z,T,F;b=s*this._rotation00+o*this._rotation10+r*this._rotation20,Y=s*this._rotation01+o*this._rotation11+r*this._rotation21,w=s*this._rotation02+o*this._rotation12+r*this._rotation22,Z=_*this._rotation00+a*this._rotation10+l*this._rotation20,X=_*this._rotation01+a*this._rotation11+l*this._rotation21,M=_*this._rotation02+a*this._rotation12+l*this._rotation22,z=h*this._rotation00+m*this._rotation10+f*this._rotation20,T=h*this._rotation01+m*this._rotation11+f*this._rotation21,F=h*this._rotation02+m*this._rotation12+f*this._rotation22,this._rotation00=b,this._rotation01=Y,this._rotation02=w,this._rotation10=Z,this._rotation11=X,this._rotation12=M,this._rotation20=z,this._rotation21=T,this._rotation22=F}getOrientation(){let t=new y.common.Quat,e,i,n,s,o=this._rotation00,r=this._rotation11,_=this._rotation22,a=o+r+_,l;return a>0?(l=Math.sqrt(a+1),s=.5*l,l=.5/l,e=(this._rotation21-this._rotation12)*l,i=(this._rotation02-this._rotation20)*l,n=(this._rotation10-this._rotation01)*l):o>r?o>_?(l=Math.sqrt(o-r-_+1),e=.5*l,l=.5/l,i=(this._rotation01+this._rotation10)*l,n=(this._rotation02+this._rotation20)*l,s=(this._rotation21-this._rotation12)*l):(l=Math.sqrt(_-o-r+1),n=.5*l,l=.5/l,e=(this._rotation02+this._rotation20)*l,i=(this._rotation12+this._rotation21)*l,s=(this._rotation10-this._rotation01)*l):r>_?(l=Math.sqrt(r-_-o+1),i=.5*l,l=.5/l,e=(this._rotation01+this._rotation10)*l,n=(this._rotation12+this._rotation21)*l,s=(this._rotation02-this._rotation20)*l):(l=Math.sqrt(_-o-r+1),n=.5*l,l=.5/l,e=(this._rotation02+this._rotation20)*l,i=(this._rotation12+this._rotation21)*l,s=(this._rotation10-this._rotation01)*l),t.x=e,t.y=i,t.z=n,t.w=s,t}getOrientationTo(t){let e,i,n,s,o=this._rotation00,r=this._rotation11,_=this._rotation22,a=o+r+_,l;a>0?(l=Math.sqrt(a+1),s=.5*l,l=.5/l,e=(this._rotation21-this._rotation12)*l,i=(this._rotation02-this._rotation20)*l,n=(this._rotation10-this._rotation01)*l):o>r?o>_?(l=Math.sqrt(o-r-_+1),e=.5*l,l=.5/l,i=(this._rotation01+this._rotation10)*l,n=(this._rotation02+this._rotation20)*l,s=(this._rotation21-this._rotation12)*l):(l=Math.sqrt(_-o-r+1),n=.5*l,l=.5/l,e=(this._rotation02+this._rotation20)*l,i=(this._rotation12+this._rotation21)*l,s=(this._rotation10-this._rotation01)*l):r>_?(l=Math.sqrt(r-_-o+1),i=.5*l,l=.5/l,e=(this._rotation01+this._rotation10)*l,n=(this._rotation12+this._rotation21)*l,s=(this._rotation02-this._rotation20)*l):(l=Math.sqrt(_-o-r+1),n=.5*l,l=.5/l,e=(this._rotation02+this._rotation20)*l,i=(this._rotation12+this._rotation21)*l,s=(this._rotation10-this._rotation01)*l),t.x=e,t.y=i,t.z=n,t.w=s}setOrientation(t){let e,i,n,s;e=t.x,i=t.y,n=t.z,s=t.w;let o=e,r=i,_=n,a=s,l=2*o,h=2*r,m=2*_,f=o*l,p=r*h,d=_*m,u=o*h,g=r*m,v=o*m,x=a*l,b=a*h,Y=a*m;return this._rotation00=1-p-d,this._rotation01=u-Y,this._rotation02=v+b,this._rotation10=u+Y,this._rotation11=1-f-d,this._rotation12=g-x,this._rotation20=v-b,this._rotation21=g+x,this._rotation22=1-f-p,this}clone(){let t=new y.common.Transform;return t._positionX=this._positionX,t._positionY=this._positionY,t._positionZ=this._positionZ,t._rotation00=this._rotation00,t._rotation01=this._rotation01,t._rotation02=this._rotation02,t._rotation10=this._rotation10,t._rotation11=this._rotation11,t._rotation12=this._rotation12,t._rotation20=this._rotation20,t._rotation21=this._rotation21,t._rotation22=this._rotation22,t}copyFrom(t){return this._positionX=t._positionX,this._positionY=t._positionY,this._positionZ=t._positionZ,this._rotation00=t._rotation00,this._rotation01=t._rotation01,this._rotation02=t._rotation02,this._rotation10=t._rotation10,this._rotation11=t._rotation11,this._rotation12=t._rotation12,this._rotation20=t._rotation20,this._rotation21=t._rotation21,this._rotation22=t._rotation22,this}};y.common.Setting=class{};y.collision.narrowphase.detector.gjkepa.GjkEpa=class{constructor(){this.s=new Array(4),this.w1=new Array(4),this.w2=new Array(4),this.baseDirs=new Array(3),this.baseDirs[0]=new y.common.Vec3(1,0,0),this.baseDirs[1]=new y.common.Vec3(0,1,0),this.baseDirs[2]=new y.common.Vec3(0,0,1),this.tl1=new y.common.Vec3,this.tl2=new y.common.Vec3,this.rayX=new y.common.Vec3,this.rayR=new y.common.Vec3,this.tempTransform=new y.common.Transform,this.s[0]=new y.common.Vec3,this.w1[0]=new y.common.Vec3,this.w2[0]=new y.common.Vec3,this.s[1]=new y.common.Vec3,this.w1[1]=new y.common.Vec3,this.w2[1]=new y.common.Vec3,this.s[2]=new y.common.Vec3,this.w1[2]=new y.common.Vec3,this.w2[2]=new y.common.Vec3,this.s[3]=new y.common.Vec3,this.w1[3]=new y.common.Vec3,this.w2[3]=new y.common.Vec3,this.dir=new y.common.Vec3,this.closest=new y.common.Vec3,this.closestPoint1=new y.common.Vec3,this.closestPoint2=new y.common.Vec3,this.polyhedron=new y.collision.narrowphase.detector.gjkepa.EpaPolyhedron}computeClosestPointsImpl(t,e,i,n,s,o){this.c1=t,this.c2=e,this.tf1=i,this.tf2=n;let r=this.s,_=this.w1,a=this.w2,l=this.closest,h=this.dir;if(s!=null?(s._gjkCache==null&&(s._gjkCache=new y.collision.narrowphase.detector.gjkepa.GjkCache),this.loadCache(s._gjkCache)):h.zero(),h.x*h.x+h.y*h.y+h.z*h.z==0){let u,g,v;u=n._positionX-i._positionX,g=n._positionY-i._positionY,v=n._positionZ-i._positionZ,h.x=u,h.y=g,h.z=v,h.x*h.x+h.y*h.y+h.z*h.z<1e-6&&h.init(1,0,0)}this.simplexSize=0,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let m=this.s[this.simplexSize],f=this.w1[this.simplexSize];m.x=f.x,m.y=f.y,m.z=f.z;let p=this.w2[this.simplexSize];m.x-=p.x,m.y-=p.y,m.z-=p.z,this.simplexSize=1;let d=0;for(;d<40;){let u=0;switch(this.simplexSize){case 1:let Y=r[0];l.x=Y.x,l.y=Y.y,l.z=Y.z,u=1;break;case 2:let w,Z,X,M,z,T,F=r[0];w=F.x,Z=F.y,X=F.z;let P=r[1];M=P.x,z=P.y,T=P.z;let A,L,S;A=M-w,L=z-Z,S=T-X;let R=A*w+L*Z+S*X;if(R=-R/(A*A+L*L+S*S),R<0)l.x=w,l.y=Z,l.z=X,u=1;else if(R>1)l.x=M,l.y=z,l.z=T,u=2;else{let He,Je,Ke;He=w+A*R,Je=Z+L*R,Ke=X+S*R,l.x=He,l.y=Je,l.z=Ke,u=3}break;case 3:let E=r[0],C=r[1],k=r[2],V,B,J,I,G,D,et,$,j,q,tt,W,U,it,Q,at,ht,_t;V=E.x,B=E.y,J=E.z,I=C.x,G=C.y,D=C.z,et=k.x,$=k.y,j=k.z,q=I-V,tt=G-B,W=D-J,U=et-I,it=$-G,Q=j-D,at=V-et,ht=B-$,_t=J-j;let mt,ft,ut;mt=tt*Q-W*it,ft=W*U-q*Q,ut=q*it-tt*U;let H,O,ot,pt,vt,xt,Mt,ct,St;H=tt*ut-W*ft,O=W*mt-q*ut,ot=q*ft-tt*mt,pt=it*ut-Q*ft,vt=Q*mt-U*ut,xt=U*ft-it*mt,Mt=ht*ut-_t*ft,ct=_t*mt-at*ut,St=at*ft-ht*mt;let It=-1,dt,K,lt,rt=0;if(dt=0,K=0,lt=0,V*H+B*O+J*ot<0){let He,Je,Ke,ci,hi,ei;He=E.x,Je=E.y,Ke=E.z,ci=C.x,hi=C.y,ei=C.z;let ai,Qe,We;ai=ci-He,Qe=hi-Je,We=ei-Ke;let ke=ai*He+Qe*Je+We*Ke;ke=-ke/(ai*ai+Qe*Qe+We*We);let le;if(ke<0)l.x=He,l.y=Je,l.z=Ke,le=1;else if(ke>1)l.x=ci,l.y=hi,l.z=ei,le=2;else{let ge,jt,Ae;ge=He+ai*ke,jt=Je+Qe*ke,Ae=Ke+We*ke,l.x=ge,l.y=jt,l.z=Ae,le=3}rt=le,It=l.x*l.x+l.y*l.y+l.z*l.z,dt=l.x,K=l.y,lt=l.z}if(I*pt+G*vt+D*xt<0){let He,Je,Ke,ci,hi,ei;He=C.x,Je=C.y,Ke=C.z,ci=k.x,hi=k.y,ei=k.z;let ai,Qe,We;ai=ci-He,Qe=hi-Je,We=ei-Ke;let ke=ai*He+Qe*Je+We*Ke;ke=-ke/(ai*ai+Qe*Qe+We*We);let le;if(ke<0)l.x=He,l.y=Je,l.z=Ke,le=1;else if(ke>1)l.x=ci,l.y=hi,l.z=ei,le=2;else{let jt,Ae,Se;jt=He+ai*ke,Ae=Je+Qe*ke,Se=Ke+We*ke,l.x=jt,l.y=Ae,l.z=Se,le=3}let ge=l.x*l.x+l.y*l.y+l.z*l.z;(It<0||ge<It)&&(rt=le<<1,It=ge,dt=l.x,K=l.y,lt=l.z)}if(et*Mt+$*ct+j*St<0){let He,Je,Ke,ci,hi,ei;He=E.x,Je=E.y,Ke=E.z,ci=k.x,hi=k.y,ei=k.z;let ai,Qe,We;ai=ci-He,Qe=hi-Je,We=ei-Ke;let ke=ai*He+Qe*Je+We*Ke;ke=-ke/(ai*ai+Qe*Qe+We*We);let le;if(ke<0)l.x=He,l.y=Je,l.z=Ke,le=1;else if(ke>1)l.x=ci,l.y=hi,l.z=ei,le=2;else{let jt,Ae,Se;jt=He+ai*ke,Ae=Je+Qe*ke,Se=Ke+We*ke,l.x=jt,l.y=Ae,l.z=Se,le=3}let ge=l.x*l.x+l.y*l.y+l.z*l.z;(It<0||ge<It)&&(rt=le&1|(le&2)<<1,It=ge,dt=l.x,K=l.y,lt=l.z)}if(It>0)l.x=dt,l.y=K,l.z=lt,u=rt;else{let He=mt*mt+ft*ft+ut*ut;He>0&&(He=1/Math.sqrt(He)),mt*=He,ft*=He,ut*=He;let Je=mt*mt+ft*ft+ut*ut;Je=(V*mt+B*ft+J*ut)/Je,dt=mt*Je,K=ft*Je,lt=ut*Je,l.x=dt,l.y=K,l.z=lt,u=7}break;case 4:let Vt=r[0],At=r[1],Yt=r[2],Xt=r[3],Nt,ie,ee,Ze,ze,pe,$t,Ht,ue,Ie,qe,Ee,Ut,nt,gt,yt,bt,st,Pt,Dt,N,kt,Rt,Ot,Wt,Bt,re;Nt=Vt.x,ie=Vt.y,ee=Vt.z,Ze=At.x,ze=At.y,pe=At.z,$t=Yt.x,Ht=Yt.y,ue=Yt.z,Ie=Xt.x,qe=Xt.y,Ee=Xt.z,Ut=Ze-Nt,nt=ze-ie,gt=pe-ee,yt=$t-Nt,bt=Ht-ie,st=ue-ee,Pt=Ie-Nt,Dt=qe-ie,N=Ee-ee,kt=$t-Ze,Rt=Ht-ze,Ot=ue-pe,Wt=Ie-Ze,Bt=qe-ze,re=Ee-pe;let Ce,be,Tt,Lt,Zt,me,Me,fe,ti,di,Le,_i;Ce=nt*st-gt*bt,be=gt*yt-Ut*st,Tt=Ut*bt-nt*yt,Lt=bt*N-st*Dt,Zt=st*Pt-yt*N,me=yt*Dt-bt*Pt,Me=Dt*gt-N*nt,fe=N*Ut-Pt*gt,ti=Pt*nt-Dt*Ut,di=Bt*Ot-re*Rt,Le=re*kt-Wt*Ot,_i=Wt*Rt-Bt*kt;let yi=Ut*di+nt*Le+gt*_i>0?1:-1,he=-1,gi,bi,Mi,Ii=0;if(gi=0,bi=0,Mi=0,(Nt*Ce+ie*be+ee*Tt)*yi<0){let He,Je,Ke,ci,hi,ei,ai,Qe,We,ke,le,ge,jt,Ae,Se,Re,Te,Ne;He=Vt.x,Je=Vt.y,Ke=Vt.z,ci=At.x,hi=At.y,ei=At.z,ai=Yt.x,Qe=Yt.y,We=Yt.z,ke=ci-He,le=hi-Je,ge=ei-Ke,jt=ai-ci,Ae=Qe-hi,Se=We-ei,Re=He-ai,Te=Je-Qe,Ne=Ke-We;let se,Ct,Gt;se=le*Se-ge*Ae,Ct=ge*jt-ke*Se,Gt=ke*Ae-le*jt;let Pe,Ve,Ue,ii,ri,ui,vi,ce,Ge;Pe=le*Gt-ge*Ct,Ve=ge*se-ke*Gt,Ue=ke*Ct-le*se,ii=Ae*Gt-Se*Ct,ri=Se*se-jt*Gt,ui=jt*Ct-Ae*se,vi=Te*Gt-Ne*Ct,ce=Ne*se-Re*Gt,Ge=Re*Ct-Te*se;let we=-1,Be,xe,qt,Jt=0;if(Be=0,xe=0,qt=0,He*Pe+Je*Ve+Ke*Ue<0){let Qt,zt,Et,Kt,te,ne;Qt=Vt.x,zt=Vt.y,Et=Vt.z,Kt=At.x,te=At.y,ne=At.z;let _e,de,Ye;_e=Kt-Qt,de=te-zt,Ye=ne-Et;let ye=_e*Qt+de*zt+Ye*Et;ye=-ye/(_e*_e+de*de+Ye*Ye);let oe;if(ye<0)l.x=Qt,l.y=zt,l.z=Et,oe=1;else if(ye>1)l.x=Kt,l.y=te,l.z=ne,oe=2;else{let Ft,ae,Xe;Ft=Qt+_e*ye,ae=zt+de*ye,Xe=Et+Ye*ye,l.x=Ft,l.y=ae,l.z=Xe,oe=3}Jt=oe,we=l.x*l.x+l.y*l.y+l.z*l.z,Be=l.x,xe=l.y,qt=l.z}if(ci*ii+hi*ri+ei*ui<0){let Qt,zt,Et,Kt,te,ne;Qt=At.x,zt=At.y,Et=At.z,Kt=Yt.x,te=Yt.y,ne=Yt.z;let _e,de,Ye;_e=Kt-Qt,de=te-zt,Ye=ne-Et;let ye=_e*Qt+de*zt+Ye*Et;ye=-ye/(_e*_e+de*de+Ye*Ye);let oe;if(ye<0)l.x=Qt,l.y=zt,l.z=Et,oe=1;else if(ye>1)l.x=Kt,l.y=te,l.z=ne,oe=2;else{let ae,Xe,Oe;ae=Qt+_e*ye,Xe=zt+de*ye,Oe=Et+Ye*ye,l.x=ae,l.y=Xe,l.z=Oe,oe=3}let Ft=l.x*l.x+l.y*l.y+l.z*l.z;(we<0||Ft<we)&&(Jt=oe<<1,we=Ft,Be=l.x,xe=l.y,qt=l.z)}if(ai*vi+Qe*ce+We*Ge<0){let Qt,zt,Et,Kt,te,ne;Qt=Vt.x,zt=Vt.y,Et=Vt.z,Kt=Yt.x,te=Yt.y,ne=Yt.z;let _e,de,Ye;_e=Kt-Qt,de=te-zt,Ye=ne-Et;let ye=_e*Qt+de*zt+Ye*Et;ye=-ye/(_e*_e+de*de+Ye*Ye);let oe;if(ye<0)l.x=Qt,l.y=zt,l.z=Et,oe=1;else if(ye>1)l.x=Kt,l.y=te,l.z=ne,oe=2;else{let ae,Xe,Oe;ae=Qt+_e*ye,Xe=zt+de*ye,Oe=Et+Ye*ye,l.x=ae,l.y=Xe,l.z=Oe,oe=3}let Ft=l.x*l.x+l.y*l.y+l.z*l.z;(we<0||Ft<we)&&(Jt=oe&1|(oe&2)<<1,we=Ft,Be=l.x,xe=l.y,qt=l.z)}let ve;if(we>0)l.x=Be,l.y=xe,l.z=qt,ve=Jt;else{let Qt=se*se+Ct*Ct+Gt*Gt;Qt>0&&(Qt=1/Math.sqrt(Qt)),se*=Qt,Ct*=Qt,Gt*=Qt;let zt=se*se+Ct*Ct+Gt*Gt;zt=(He*se+Je*Ct+Ke*Gt)/zt,Be=se*zt,xe=Ct*zt,qt=Gt*zt,l.x=Be,l.y=xe,l.z=qt,ve=7}Ii=ve,he=l.x*l.x+l.y*l.y+l.z*l.z,gi=l.x,bi=l.y,Mi=l.z}if((Nt*Lt+ie*Zt+ee*me)*yi<0){let He,Je,Ke,ci,hi,ei,ai,Qe,We,ke,le,ge,jt,Ae,Se,Re,Te,Ne;He=Vt.x,Je=Vt.y,Ke=Vt.z,ci=Yt.x,hi=Yt.y,ei=Yt.z,ai=Xt.x,Qe=Xt.y,We=Xt.z,ke=ci-He,le=hi-Je,ge=ei-Ke,jt=ai-ci,Ae=Qe-hi,Se=We-ei,Re=He-ai,Te=Je-Qe,Ne=Ke-We;let se,Ct,Gt;se=le*Se-ge*Ae,Ct=ge*jt-ke*Se,Gt=ke*Ae-le*jt;let Pe,Ve,Ue,ii,ri,ui,vi,ce,Ge;Pe=le*Gt-ge*Ct,Ve=ge*se-ke*Gt,Ue=ke*Ct-le*se,ii=Ae*Gt-Se*Ct,ri=Se*se-jt*Gt,ui=jt*Ct-Ae*se,vi=Te*Gt-Ne*Ct,ce=Ne*se-Re*Gt,Ge=Re*Ct-Te*se;let we=-1,Be,xe,qt,Jt=0;if(Be=0,xe=0,qt=0,He*Pe+Je*Ve+Ke*Ue<0){let zt,Et,Kt,te,ne,_e;zt=Vt.x,Et=Vt.y,Kt=Vt.z,te=Yt.x,ne=Yt.y,_e=Yt.z;let de,Ye,ye;de=te-zt,Ye=ne-Et,ye=_e-Kt;let oe=de*zt+Ye*Et+ye*Kt;oe=-oe/(de*de+Ye*Ye+ye*ye);let Ft;if(oe<0)l.x=zt,l.y=Et,l.z=Kt,Ft=1;else if(oe>1)l.x=te,l.y=ne,l.z=_e,Ft=2;else{let ae,Xe,Oe;ae=zt+de*oe,Xe=Et+Ye*oe,Oe=Kt+ye*oe,l.x=ae,l.y=Xe,l.z=Oe,Ft=3}Jt=Ft,we=l.x*l.x+l.y*l.y+l.z*l.z,Be=l.x,xe=l.y,qt=l.z}if(ci*ii+hi*ri+ei*ui<0){let zt,Et,Kt,te,ne,_e;zt=Yt.x,Et=Yt.y,Kt=Yt.z,te=Xt.x,ne=Xt.y,_e=Xt.z;let de,Ye,ye;de=te-zt,Ye=ne-Et,ye=_e-Kt;let oe=de*zt+Ye*Et+ye*Kt;oe=-oe/(de*de+Ye*Ye+ye*ye);let Ft;if(oe<0)l.x=zt,l.y=Et,l.z=Kt,Ft=1;else if(oe>1)l.x=te,l.y=ne,l.z=_e,Ft=2;else{let Xe,Oe,oi;Xe=zt+de*oe,Oe=Et+Ye*oe,oi=Kt+ye*oe,l.x=Xe,l.y=Oe,l.z=oi,Ft=3}let ae=l.x*l.x+l.y*l.y+l.z*l.z;(we<0||ae<we)&&(Jt=Ft<<1,we=ae,Be=l.x,xe=l.y,qt=l.z)}if(ai*vi+Qe*ce+We*Ge<0){let zt,Et,Kt,te,ne,_e;zt=Vt.x,Et=Vt.y,Kt=Vt.z,te=Xt.x,ne=Xt.y,_e=Xt.z;let de,Ye,ye;de=te-zt,Ye=ne-Et,ye=_e-Kt;let oe=de*zt+Ye*Et+ye*Kt;oe=-oe/(de*de+Ye*Ye+ye*ye);let Ft;if(oe<0)l.x=zt,l.y=Et,l.z=Kt,Ft=1;else if(oe>1)l.x=te,l.y=ne,l.z=_e,Ft=2;else{let Xe,Oe,oi;Xe=zt+de*oe,Oe=Et+Ye*oe,oi=Kt+ye*oe,l.x=Xe,l.y=Oe,l.z=oi,Ft=3}let ae=l.x*l.x+l.y*l.y+l.z*l.z;(we<0||ae<we)&&(Jt=Ft&1|(Ft&2)<<1,we=ae,Be=l.x,xe=l.y,qt=l.z)}let ve;if(we>0)l.x=Be,l.y=xe,l.z=qt,ve=Jt;else{let zt=se*se+Ct*Ct+Gt*Gt;zt>0&&(zt=1/Math.sqrt(zt)),se*=zt,Ct*=zt,Gt*=zt;let Et=se*se+Ct*Ct+Gt*Gt;Et=(He*se+Je*Ct+Ke*Gt)/Et,Be=se*Et,xe=Ct*Et,qt=Gt*Et,l.x=Be,l.y=xe,l.z=qt,ve=7}let Qt=l.x*l.x+l.y*l.y+l.z*l.z;(he<0||Qt<he)&&(Ii=ve&1|(ve&6)<<1,he=Qt,gi=l.x,bi=l.y,Mi=l.z)}if((Nt*Me+ie*fe+ee*ti)*yi<0){let He,Je,Ke,ci,hi,ei,ai,Qe,We,ke,le,ge,jt,Ae,Se,Re,Te,Ne;He=Vt.x,Je=Vt.y,Ke=Vt.z,ci=At.x,hi=At.y,ei=At.z,ai=Xt.x,Qe=Xt.y,We=Xt.z,ke=ci-He,le=hi-Je,ge=ei-Ke,jt=ai-ci,Ae=Qe-hi,Se=We-ei,Re=He-ai,Te=Je-Qe,Ne=Ke-We;let se,Ct,Gt;se=le*Se-ge*Ae,Ct=ge*jt-ke*Se,Gt=ke*Ae-le*jt;let Pe,Ve,Ue,ii,ri,ui,vi,ce,Ge;Pe=le*Gt-ge*Ct,Ve=ge*se-ke*Gt,Ue=ke*Ct-le*se,ii=Ae*Gt-Se*Ct,ri=Se*se-jt*Gt,ui=jt*Ct-Ae*se,vi=Te*Gt-Ne*Ct,ce=Ne*se-Re*Gt,Ge=Re*Ct-Te*se;let we=-1,Be,xe,qt,Jt=0;if(Be=0,xe=0,qt=0,He*Pe+Je*Ve+Ke*Ue<0){let zt,Et,Kt,te,ne,_e;zt=Vt.x,Et=Vt.y,Kt=Vt.z,te=At.x,ne=At.y,_e=At.z;let de,Ye,ye;de=te-zt,Ye=ne-Et,ye=_e-Kt;let oe=de*zt+Ye*Et+ye*Kt;oe=-oe/(de*de+Ye*Ye+ye*ye);let Ft;if(oe<0)l.x=zt,l.y=Et,l.z=Kt,Ft=1;else if(oe>1)l.x=te,l.y=ne,l.z=_e,Ft=2;else{let ae,Xe,Oe;ae=zt+de*oe,Xe=Et+Ye*oe,Oe=Kt+ye*oe,l.x=ae,l.y=Xe,l.z=Oe,Ft=3}Jt=Ft,we=l.x*l.x+l.y*l.y+l.z*l.z,Be=l.x,xe=l.y,qt=l.z}if(ci*ii+hi*ri+ei*ui<0){let zt,Et,Kt,te,ne,_e;zt=At.x,Et=At.y,Kt=At.z,te=Xt.x,ne=Xt.y,_e=Xt.z;let de,Ye,ye;de=te-zt,Ye=ne-Et,ye=_e-Kt;let oe=de*zt+Ye*Et+ye*Kt;oe=-oe/(de*de+Ye*Ye+ye*ye);let Ft;if(oe<0)l.x=zt,l.y=Et,l.z=Kt,Ft=1;else if(oe>1)l.x=te,l.y=ne,l.z=_e,Ft=2;else{let Xe,Oe,oi;Xe=zt+de*oe,Oe=Et+Ye*oe,oi=Kt+ye*oe,l.x=Xe,l.y=Oe,l.z=oi,Ft=3}let ae=l.x*l.x+l.y*l.y+l.z*l.z;(we<0||ae<we)&&(Jt=Ft<<1,we=ae,Be=l.x,xe=l.y,qt=l.z)}if(ai*vi+Qe*ce+We*Ge<0){let zt,Et,Kt,te,ne,_e;zt=Vt.x,Et=Vt.y,Kt=Vt.z,te=Xt.x,ne=Xt.y,_e=Xt.z;let de,Ye,ye;de=te-zt,Ye=ne-Et,ye=_e-Kt;let oe=de*zt+Ye*Et+ye*Kt;oe=-oe/(de*de+Ye*Ye+ye*ye);let Ft;if(oe<0)l.x=zt,l.y=Et,l.z=Kt,Ft=1;else if(oe>1)l.x=te,l.y=ne,l.z=_e,Ft=2;else{let Xe,Oe,oi;Xe=zt+de*oe,Oe=Et+Ye*oe,oi=Kt+ye*oe,l.x=Xe,l.y=Oe,l.z=oi,Ft=3}let ae=l.x*l.x+l.y*l.y+l.z*l.z;(we<0||ae<we)&&(Jt=Ft&1|(Ft&2)<<1,we=ae,Be=l.x,xe=l.y,qt=l.z)}let ve;if(we>0)l.x=Be,l.y=xe,l.z=qt,ve=Jt;else{let zt=se*se+Ct*Ct+Gt*Gt;zt>0&&(zt=1/Math.sqrt(zt)),se*=zt,Ct*=zt,Gt*=zt;let Et=se*se+Ct*Ct+Gt*Gt;Et=(He*se+Je*Ct+Ke*Gt)/Et,Be=se*Et,xe=Ct*Et,qt=Gt*Et,l.x=Be,l.y=xe,l.z=qt,ve=7}let Qt=l.x*l.x+l.y*l.y+l.z*l.z;(he<0||Qt<he)&&(Ii=ve&3|(ve&4)<<1,he=Qt,gi=l.x,bi=l.y,Mi=l.z)}if((Ze*di+ze*Le+pe*_i)*yi<0){let He,Je,Ke,ci,hi,ei,ai,Qe,We,ke,le,ge,jt,Ae,Se,Re,Te,Ne;He=At.x,Je=At.y,Ke=At.z,ci=Yt.x,hi=Yt.y,ei=Yt.z,ai=Xt.x,Qe=Xt.y,We=Xt.z,ke=ci-He,le=hi-Je,ge=ei-Ke,jt=ai-ci,Ae=Qe-hi,Se=We-ei,Re=He-ai,Te=Je-Qe,Ne=Ke-We;let se,Ct,Gt;se=le*Se-ge*Ae,Ct=ge*jt-ke*Se,Gt=ke*Ae-le*jt;let Pe,Ve,Ue,ii,ri,ui,vi,ce,Ge;Pe=le*Gt-ge*Ct,Ve=ge*se-ke*Gt,Ue=ke*Ct-le*se,ii=Ae*Gt-Se*Ct,ri=Se*se-jt*Gt,ui=jt*Ct-Ae*se,vi=Te*Gt-Ne*Ct,ce=Ne*se-Re*Gt,Ge=Re*Ct-Te*se;let we=-1,Be,xe,qt,Jt=0;if(Be=0,xe=0,qt=0,He*Pe+Je*Ve+Ke*Ue<0){let zt,Et,Kt,te,ne,_e;zt=At.x,Et=At.y,Kt=At.z,te=Yt.x,ne=Yt.y,_e=Yt.z;let de,Ye,ye;de=te-zt,Ye=ne-Et,ye=_e-Kt;let oe=de*zt+Ye*Et+ye*Kt;oe=-oe/(de*de+Ye*Ye+ye*ye);let Ft;if(oe<0)l.x=zt,l.y=Et,l.z=Kt,Ft=1;else if(oe>1)l.x=te,l.y=ne,l.z=_e,Ft=2;else{let ae,Xe,Oe;ae=zt+de*oe,Xe=Et+Ye*oe,Oe=Kt+ye*oe,l.x=ae,l.y=Xe,l.z=Oe,Ft=3}Jt=Ft,we=l.x*l.x+l.y*l.y+l.z*l.z,Be=l.x,xe=l.y,qt=l.z}if(ci*ii+hi*ri+ei*ui<0){let zt,Et,Kt,te,ne,_e;zt=Yt.x,Et=Yt.y,Kt=Yt.z,te=Xt.x,ne=Xt.y,_e=Xt.z;let de,Ye,ye;de=te-zt,Ye=ne-Et,ye=_e-Kt;let oe=de*zt+Ye*Et+ye*Kt;oe=-oe/(de*de+Ye*Ye+ye*ye);let Ft;if(oe<0)l.x=zt,l.y=Et,l.z=Kt,Ft=1;else if(oe>1)l.x=te,l.y=ne,l.z=_e,Ft=2;else{let Xe,Oe,oi;Xe=zt+de*oe,Oe=Et+Ye*oe,oi=Kt+ye*oe,l.x=Xe,l.y=Oe,l.z=oi,Ft=3}let ae=l.x*l.x+l.y*l.y+l.z*l.z;(we<0||ae<we)&&(Jt=Ft<<1,we=ae,Be=l.x,xe=l.y,qt=l.z)}if(ai*vi+Qe*ce+We*Ge<0){let zt,Et,Kt,te,ne,_e;zt=At.x,Et=At.y,Kt=At.z,te=Xt.x,ne=Xt.y,_e=Xt.z;let de,Ye,ye;de=te-zt,Ye=ne-Et,ye=_e-Kt;let oe=de*zt+Ye*Et+ye*Kt;oe=-oe/(de*de+Ye*Ye+ye*ye);let Ft;if(oe<0)l.x=zt,l.y=Et,l.z=Kt,Ft=1;else if(oe>1)l.x=te,l.y=ne,l.z=_e,Ft=2;else{let Xe,Oe,oi;Xe=zt+de*oe,Oe=Et+Ye*oe,oi=Kt+ye*oe,l.x=Xe,l.y=Oe,l.z=oi,Ft=3}let ae=l.x*l.x+l.y*l.y+l.z*l.z;(we<0||ae<we)&&(Jt=Ft&1|(Ft&2)<<1,we=ae,Be=l.x,xe=l.y,qt=l.z)}let ve;if(we>0)l.x=Be,l.y=xe,l.z=qt,ve=Jt;else{let zt=se*se+Ct*Ct+Gt*Gt;zt>0&&(zt=1/Math.sqrt(zt)),se*=zt,Ct*=zt,Gt*=zt;let Et=se*se+Ct*Ct+Gt*Gt;Et=(He*se+Je*Ct+Ke*Gt)/Et,Be=se*Et,xe=Ct*Et,qt=Gt*Et,l.x=Be,l.y=xe,l.z=qt,ve=7}let Qt=l.x*l.x+l.y*l.y+l.z*l.z;(he<0||Qt<he)&&(Ii=ve<<1,he=Qt,gi=l.x,bi=l.y,Mi=l.z)}he>0?(l.x=gi,l.y=bi,l.z=Mi,u=Ii):(l.zero(),u=15);break}if(l.x*l.x+l.y*l.y+l.z*l.z<1e-8){if(!o)return this.distance=0,0;switch(this.simplexSize){case 1:this.pointToTetrahedron();break;case 2:this.lineToTetrahedron();break;case 3:this.triangleToTetrahedron();break}if(this.simplexSize==4){let Y=this.computeDepth(t,e,i,n,r,_,a);return Y!=0?(this.distance=0,Y):(this.distance=-this.depth,0)}return this.distance=0,1}this.shrinkSimplex(u),h.x=l.x,h.y=l.y,h.z=l.z,h.x=-h.x,h.y=-h.y,h.z=-h.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let g=this.s[this.simplexSize],v=this.w1[this.simplexSize];g.x=v.x,g.y=v.y,g.z=v.z;let x=this.w2[this.simplexSize];if(g.x-=x.x,g.y-=x.y,g.z-=x.z,h.x*h.x+h.y*h.y+h.z*h.z<1e-8)throw new Error("!?");let b=r[this.simplexSize];if(b.x*h.x+b.y*h.y+b.z*h.z-(l.x*h.x+l.y*h.y+l.z*h.z)<1e-8)return this.interpolateClosestPoints(),this.distance=Math.sqrt(l.x*l.x+l.y*l.y+l.z*l.z),s!=null&&s._gjkCache!=null&&this.saveCache(s._gjkCache),0;this.simplexSize++,++d}return 2}convexCastImpl(t,e,i,n,s,o,r){this.c1=t,this.c2=e,this.tf1=i,this.tf2=n;let _=this.s,a=this.closest,l=this.dir,h,m,f;if(h=n._positionX-i._positionX,m=n._positionY-i._positionY,f=n._positionZ-i._positionZ,l.x=h,l.y=m,l.z=f,l.x*l.x+l.y*l.y+l.z*l.z<1e-6&&l.init(1,0,0),this.simplexSize=0,this.c1!=null)this.computeWitnessPoint1(!0);else{let Y=this.w1[this.simplexSize];Y.x=this.tf1._positionX,Y.y=this.tf1._positionY,Y.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);let p=this.s[this.simplexSize],d=this.w1[this.simplexSize];p.x=d.x,p.y=d.y,p.z=d.z;let u=this.w2[this.simplexSize];p.x-=u.x,p.y-=u.y,p.z-=u.z,this.simplexSize=1;let g=0,v=0,x=this.rayX,b=this.rayR;for(x.zero(),b.x=o.x,b.y=o.y,b.z=o.z,b.x-=s.x,b.y-=s.y,b.z-=s.z;g<40;){let Y=0;switch(this.simplexSize){case 1:let L=_[0];a.x=L.x,a.y=L.y,a.z=L.z,Y=1;break;case 2:let S,R,E,C,k,V,B=_[0];S=B.x,R=B.y,E=B.z;let J=_[1];C=J.x,k=J.y,V=J.z;let I,G,D;I=C-S,G=k-R,D=V-E;let et=I*S+G*R+D*E;if(et=-et/(I*I+G*G+D*D),et<0)a.x=S,a.y=R,a.z=E,Y=1;else if(et>1)a.x=C,a.y=k,a.z=V,Y=2;else{let le,ge,jt;le=S+I*et,ge=R+G*et,jt=E+D*et,a.x=le,a.y=ge,a.z=jt,Y=3}break;case 3:let $=_[0],j=_[1],q=_[2],tt,W,U,it,Q,at,ht,_t,mt,ft,ut,H,O,ot,pt,vt,xt,Mt;tt=$.x,W=$.y,U=$.z,it=j.x,Q=j.y,at=j.z,ht=q.x,_t=q.y,mt=q.z,ft=it-tt,ut=Q-W,H=at-U,O=ht-it,ot=_t-Q,pt=mt-at,vt=tt-ht,xt=W-_t,Mt=U-mt;let ct,St,It;ct=ut*pt-H*ot,St=H*O-ft*pt,It=ft*ot-ut*O;let dt,K,lt,rt,Vt,At,Yt,Xt,Nt;dt=ut*It-H*St,K=H*ct-ft*It,lt=ft*St-ut*ct,rt=ot*It-pt*St,Vt=pt*ct-O*It,At=O*St-ot*ct,Yt=xt*It-Mt*St,Xt=Mt*ct-vt*It,Nt=vt*St-xt*ct;let ie=-1,ee,Ze,ze,pe=0;if(ee=0,Ze=0,ze=0,tt*dt+W*K+U*lt<0){let le,ge,jt,Ae,Se,Re;le=$.x,ge=$.y,jt=$.z,Ae=j.x,Se=j.y,Re=j.z;let Te,Ne,se;Te=Ae-le,Ne=Se-ge,se=Re-jt;let Ct=Te*le+Ne*ge+se*jt;Ct=-Ct/(Te*Te+Ne*Ne+se*se);let Gt;if(Ct<0)a.x=le,a.y=ge,a.z=jt,Gt=1;else if(Ct>1)a.x=Ae,a.y=Se,a.z=Re,Gt=2;else{let Pe,Ve,Ue;Pe=le+Te*Ct,Ve=ge+Ne*Ct,Ue=jt+se*Ct,a.x=Pe,a.y=Ve,a.z=Ue,Gt=3}pe=Gt,ie=a.x*a.x+a.y*a.y+a.z*a.z,ee=a.x,Ze=a.y,ze=a.z}if(it*rt+Q*Vt+at*At<0){let le,ge,jt,Ae,Se,Re;le=j.x,ge=j.y,jt=j.z,Ae=q.x,Se=q.y,Re=q.z;let Te,Ne,se;Te=Ae-le,Ne=Se-ge,se=Re-jt;let Ct=Te*le+Ne*ge+se*jt;Ct=-Ct/(Te*Te+Ne*Ne+se*se);let Gt;if(Ct<0)a.x=le,a.y=ge,a.z=jt,Gt=1;else if(Ct>1)a.x=Ae,a.y=Se,a.z=Re,Gt=2;else{let Ve,Ue,ii;Ve=le+Te*Ct,Ue=ge+Ne*Ct,ii=jt+se*Ct,a.x=Ve,a.y=Ue,a.z=ii,Gt=3}let Pe=a.x*a.x+a.y*a.y+a.z*a.z;(ie<0||Pe<ie)&&(pe=Gt<<1,ie=Pe,ee=a.x,Ze=a.y,ze=a.z)}if(ht*Yt+_t*Xt+mt*Nt<0){let le,ge,jt,Ae,Se,Re;le=$.x,ge=$.y,jt=$.z,Ae=q.x,Se=q.y,Re=q.z;let Te,Ne,se;Te=Ae-le,Ne=Se-ge,se=Re-jt;let Ct=Te*le+Ne*ge+se*jt;Ct=-Ct/(Te*Te+Ne*Ne+se*se);let Gt;if(Ct<0)a.x=le,a.y=ge,a.z=jt,Gt=1;else if(Ct>1)a.x=Ae,a.y=Se,a.z=Re,Gt=2;else{let Ve,Ue,ii;Ve=le+Te*Ct,Ue=ge+Ne*Ct,ii=jt+se*Ct,a.x=Ve,a.y=Ue,a.z=ii,Gt=3}let Pe=a.x*a.x+a.y*a.y+a.z*a.z;(ie<0||Pe<ie)&&(pe=Gt&1|(Gt&2)<<1,ie=Pe,ee=a.x,Ze=a.y,ze=a.z)}if(ie>0)a.x=ee,a.y=Ze,a.z=ze,Y=pe;else{let le=ct*ct+St*St+It*It;le>0&&(le=1/Math.sqrt(le)),ct*=le,St*=le,It*=le;let ge=ct*ct+St*St+It*It;ge=(tt*ct+W*St+U*It)/ge,ee=ct*ge,Ze=St*ge,ze=It*ge,a.x=ee,a.y=Ze,a.z=ze,Y=7}break;case 4:let $t=_[0],Ht=_[1],ue=_[2],Ie=_[3],qe,Ee,Ut,nt,gt,yt,bt,st,Pt,Dt,N,kt,Rt,Ot,Wt,Bt,re,Ce,be,Tt,Lt,Zt,me,Me,fe,ti,di;qe=$t.x,Ee=$t.y,Ut=$t.z,nt=Ht.x,gt=Ht.y,yt=Ht.z,bt=ue.x,st=ue.y,Pt=ue.z,Dt=Ie.x,N=Ie.y,kt=Ie.z,Rt=nt-qe,Ot=gt-Ee,Wt=yt-Ut,Bt=bt-qe,re=st-Ee,Ce=Pt-Ut,be=Dt-qe,Tt=N-Ee,Lt=kt-Ut,Zt=bt-nt,me=st-gt,Me=Pt-yt,fe=Dt-nt,ti=N-gt,di=kt-yt;let Le,_i,yi,he,gi,bi,Mi,Ii,He,Je,Ke,ci;Le=Ot*Ce-Wt*re,_i=Wt*Bt-Rt*Ce,yi=Rt*re-Ot*Bt,he=re*Lt-Ce*Tt,gi=Ce*be-Bt*Lt,bi=Bt*Tt-re*be,Mi=Tt*Wt-Lt*Ot,Ii=Lt*Rt-be*Wt,He=be*Ot-Tt*Rt,Je=ti*Me-di*me,Ke=di*Zt-fe*Me,ci=fe*me-ti*Zt;let hi=Rt*Je+Ot*Ke+Wt*ci>0?1:-1,ei=-1,ai,Qe,We,ke=0;if(ai=0,Qe=0,We=0,(qe*Le+Ee*_i+Ut*yi)*hi<0){let le,ge,jt,Ae,Se,Re,Te,Ne,se,Ct,Gt,Pe,Ve,Ue,ii,ri,ui,vi;le=$t.x,ge=$t.y,jt=$t.z,Ae=Ht.x,Se=Ht.y,Re=Ht.z,Te=ue.x,Ne=ue.y,se=ue.z,Ct=Ae-le,Gt=Se-ge,Pe=Re-jt,Ve=Te-Ae,Ue=Ne-Se,ii=se-Re,ri=le-Te,ui=ge-Ne,vi=jt-se;let ce,Ge,we;ce=Gt*ii-Pe*Ue,Ge=Pe*Ve-Ct*ii,we=Ct*Ue-Gt*Ve;let Be,xe,qt,Jt,ve,Qt,zt,Et,Kt;Be=Gt*we-Pe*Ge,xe=Pe*ce-Ct*we,qt=Ct*Ge-Gt*ce,Jt=Ue*we-ii*Ge,ve=ii*ce-Ve*we,Qt=Ve*Ge-Ue*ce,zt=ui*we-vi*Ge,Et=vi*ce-ri*we,Kt=ri*Ge-ui*ce;let te=-1,ne,_e,de,Ye=0;if(ne=0,_e=0,de=0,le*Be+ge*xe+jt*qt<0){let oe,Ft,ae,Xe,Oe,oi;oe=$t.x,Ft=$t.y,ae=$t.z,Xe=Ht.x,Oe=Ht.y,oi=Ht.z;let pi,$e,si;pi=Xe-oe,$e=Oe-Ft,si=oi-ae;let je=pi*oe+$e*Ft+si*ae;je=-je/(pi*pi+$e*$e+si*si);let De;if(je<0)a.x=oe,a.y=Ft,a.z=ae,De=1;else if(je>1)a.x=Xe,a.y=Oe,a.z=oi,De=2;else{let mi,wi,Xi;mi=oe+pi*je,wi=Ft+$e*je,Xi=ae+si*je,a.x=mi,a.y=wi,a.z=Xi,De=3}Ye=De,te=a.x*a.x+a.y*a.y+a.z*a.z,ne=a.x,_e=a.y,de=a.z}if(Ae*Jt+Se*ve+Re*Qt<0){let oe,Ft,ae,Xe,Oe,oi;oe=Ht.x,Ft=Ht.y,ae=Ht.z,Xe=ue.x,Oe=ue.y,oi=ue.z;let pi,$e,si;pi=Xe-oe,$e=Oe-Ft,si=oi-ae;let je=pi*oe+$e*Ft+si*ae;je=-je/(pi*pi+$e*$e+si*si);let De;if(je<0)a.x=oe,a.y=Ft,a.z=ae,De=1;else if(je>1)a.x=Xe,a.y=Oe,a.z=oi,De=2;else{let wi,Xi,Yi;wi=oe+pi*je,Xi=Ft+$e*je,Yi=ae+si*je,a.x=wi,a.y=Xi,a.z=Yi,De=3}let mi=a.x*a.x+a.y*a.y+a.z*a.z;(te<0||mi<te)&&(Ye=De<<1,te=mi,ne=a.x,_e=a.y,de=a.z)}if(Te*zt+Ne*Et+se*Kt<0){let oe,Ft,ae,Xe,Oe,oi;oe=$t.x,Ft=$t.y,ae=$t.z,Xe=ue.x,Oe=ue.y,oi=ue.z;let pi,$e,si;pi=Xe-oe,$e=Oe-Ft,si=oi-ae;let je=pi*oe+$e*Ft+si*ae;je=-je/(pi*pi+$e*$e+si*si);let De;if(je<0)a.x=oe,a.y=Ft,a.z=ae,De=1;else if(je>1)a.x=Xe,a.y=Oe,a.z=oi,De=2;else{let wi,Xi,Yi;wi=oe+pi*je,Xi=Ft+$e*je,Yi=ae+si*je,a.x=wi,a.y=Xi,a.z=Yi,De=3}let mi=a.x*a.x+a.y*a.y+a.z*a.z;(te<0||mi<te)&&(Ye=De&1|(De&2)<<1,te=mi,ne=a.x,_e=a.y,de=a.z)}let ye;if(te>0)a.x=ne,a.y=_e,a.z=de,ye=Ye;else{let oe=ce*ce+Ge*Ge+we*we;oe>0&&(oe=1/Math.sqrt(oe)),ce*=oe,Ge*=oe,we*=oe;let Ft=ce*ce+Ge*Ge+we*we;Ft=(le*ce+ge*Ge+jt*we)/Ft,ne=ce*Ft,_e=Ge*Ft,de=we*Ft,a.x=ne,a.y=_e,a.z=de,ye=7}ke=ye,ei=a.x*a.x+a.y*a.y+a.z*a.z,ai=a.x,Qe=a.y,We=a.z}if((qe*he+Ee*gi+Ut*bi)*hi<0){let le,ge,jt,Ae,Se,Re,Te,Ne,se,Ct,Gt,Pe,Ve,Ue,ii,ri,ui,vi;le=$t.x,ge=$t.y,jt=$t.z,Ae=ue.x,Se=ue.y,Re=ue.z,Te=Ie.x,Ne=Ie.y,se=Ie.z,Ct=Ae-le,Gt=Se-ge,Pe=Re-jt,Ve=Te-Ae,Ue=Ne-Se,ii=se-Re,ri=le-Te,ui=ge-Ne,vi=jt-se;let ce,Ge,we;ce=Gt*ii-Pe*Ue,Ge=Pe*Ve-Ct*ii,we=Ct*Ue-Gt*Ve;let Be,xe,qt,Jt,ve,Qt,zt,Et,Kt;Be=Gt*we-Pe*Ge,xe=Pe*ce-Ct*we,qt=Ct*Ge-Gt*ce,Jt=Ue*we-ii*Ge,ve=ii*ce-Ve*we,Qt=Ve*Ge-Ue*ce,zt=ui*we-vi*Ge,Et=vi*ce-ri*we,Kt=ri*Ge-ui*ce;let te=-1,ne,_e,de,Ye=0;if(ne=0,_e=0,de=0,le*Be+ge*xe+jt*qt<0){let Ft,ae,Xe,Oe,oi,pi;Ft=$t.x,ae=$t.y,Xe=$t.z,Oe=ue.x,oi=ue.y,pi=ue.z;let $e,si,je;$e=Oe-Ft,si=oi-ae,je=pi-Xe;let De=$e*Ft+si*ae+je*Xe;De=-De/($e*$e+si*si+je*je);let mi;if(De<0)a.x=Ft,a.y=ae,a.z=Xe,mi=1;else if(De>1)a.x=Oe,a.y=oi,a.z=pi,mi=2;else{let wi,Xi,Yi;wi=Ft+$e*De,Xi=ae+si*De,Yi=Xe+je*De,a.x=wi,a.y=Xi,a.z=Yi,mi=3}Ye=mi,te=a.x*a.x+a.y*a.y+a.z*a.z,ne=a.x,_e=a.y,de=a.z}if(Ae*Jt+Se*ve+Re*Qt<0){let Ft,ae,Xe,Oe,oi,pi;Ft=ue.x,ae=ue.y,Xe=ue.z,Oe=Ie.x,oi=Ie.y,pi=Ie.z;let $e,si,je;$e=Oe-Ft,si=oi-ae,je=pi-Xe;let De=$e*Ft+si*ae+je*Xe;De=-De/($e*$e+si*si+je*je);let mi;if(De<0)a.x=Ft,a.y=ae,a.z=Xe,mi=1;else if(De>1)a.x=Oe,a.y=oi,a.z=pi,mi=2;else{let Xi,Yi,ki;Xi=Ft+$e*De,Yi=ae+si*De,ki=Xe+je*De,a.x=Xi,a.y=Yi,a.z=ki,mi=3}let wi=a.x*a.x+a.y*a.y+a.z*a.z;(te<0||wi<te)&&(Ye=mi<<1,te=wi,ne=a.x,_e=a.y,de=a.z)}if(Te*zt+Ne*Et+se*Kt<0){let Ft,ae,Xe,Oe,oi,pi;Ft=$t.x,ae=$t.y,Xe=$t.z,Oe=Ie.x,oi=Ie.y,pi=Ie.z;let $e,si,je;$e=Oe-Ft,si=oi-ae,je=pi-Xe;let De=$e*Ft+si*ae+je*Xe;De=-De/($e*$e+si*si+je*je);let mi;if(De<0)a.x=Ft,a.y=ae,a.z=Xe,mi=1;else if(De>1)a.x=Oe,a.y=oi,a.z=pi,mi=2;else{let Xi,Yi,ki;Xi=Ft+$e*De,Yi=ae+si*De,ki=Xe+je*De,a.x=Xi,a.y=Yi,a.z=ki,mi=3}let wi=a.x*a.x+a.y*a.y+a.z*a.z;(te<0||wi<te)&&(Ye=mi&1|(mi&2)<<1,te=wi,ne=a.x,_e=a.y,de=a.z)}let ye;if(te>0)a.x=ne,a.y=_e,a.z=de,ye=Ye;else{let Ft=ce*ce+Ge*Ge+we*we;Ft>0&&(Ft=1/Math.sqrt(Ft)),ce*=Ft,Ge*=Ft,we*=Ft;let ae=ce*ce+Ge*Ge+we*we;ae=(le*ce+ge*Ge+jt*we)/ae,ne=ce*ae,_e=Ge*ae,de=we*ae,a.x=ne,a.y=_e,a.z=de,ye=7}let oe=a.x*a.x+a.y*a.y+a.z*a.z;(ei<0||oe<ei)&&(ke=ye&1|(ye&6)<<1,ei=oe,ai=a.x,Qe=a.y,We=a.z)}if((qe*Mi+Ee*Ii+Ut*He)*hi<0){let le,ge,jt,Ae,Se,Re,Te,Ne,se,Ct,Gt,Pe,Ve,Ue,ii,ri,ui,vi;le=$t.x,ge=$t.y,jt=$t.z,Ae=Ht.x,Se=Ht.y,Re=Ht.z,Te=Ie.x,Ne=Ie.y,se=Ie.z,Ct=Ae-le,Gt=Se-ge,Pe=Re-jt,Ve=Te-Ae,Ue=Ne-Se,ii=se-Re,ri=le-Te,ui=ge-Ne,vi=jt-se;let ce,Ge,we;ce=Gt*ii-Pe*Ue,Ge=Pe*Ve-Ct*ii,we=Ct*Ue-Gt*Ve;let Be,xe,qt,Jt,ve,Qt,zt,Et,Kt;Be=Gt*we-Pe*Ge,xe=Pe*ce-Ct*we,qt=Ct*Ge-Gt*ce,Jt=Ue*we-ii*Ge,ve=ii*ce-Ve*we,Qt=Ve*Ge-Ue*ce,zt=ui*we-vi*Ge,Et=vi*ce-ri*we,Kt=ri*Ge-ui*ce;let te=-1,ne,_e,de,Ye=0;if(ne=0,_e=0,de=0,le*Be+ge*xe+jt*qt<0){let Ft,ae,Xe,Oe,oi,pi;Ft=$t.x,ae=$t.y,Xe=$t.z,Oe=Ht.x,oi=Ht.y,pi=Ht.z;let $e,si,je;$e=Oe-Ft,si=oi-ae,je=pi-Xe;let De=$e*Ft+si*ae+je*Xe;De=-De/($e*$e+si*si+je*je);let mi;if(De<0)a.x=Ft,a.y=ae,a.z=Xe,mi=1;else if(De>1)a.x=Oe,a.y=oi,a.z=pi,mi=2;else{let wi,Xi,Yi;wi=Ft+$e*De,Xi=ae+si*De,Yi=Xe+je*De,a.x=wi,a.y=Xi,a.z=Yi,mi=3}Ye=mi,te=a.x*a.x+a.y*a.y+a.z*a.z,ne=a.x,_e=a.y,de=a.z}if(Ae*Jt+Se*ve+Re*Qt<0){let Ft,ae,Xe,Oe,oi,pi;Ft=Ht.x,ae=Ht.y,Xe=Ht.z,Oe=Ie.x,oi=Ie.y,pi=Ie.z;let $e,si,je;$e=Oe-Ft,si=oi-ae,je=pi-Xe;let De=$e*Ft+si*ae+je*Xe;De=-De/($e*$e+si*si+je*je);let mi;if(De<0)a.x=Ft,a.y=ae,a.z=Xe,mi=1;else if(De>1)a.x=Oe,a.y=oi,a.z=pi,mi=2;else{let Xi,Yi,ki;Xi=Ft+$e*De,Yi=ae+si*De,ki=Xe+je*De,a.x=Xi,a.y=Yi,a.z=ki,mi=3}let wi=a.x*a.x+a.y*a.y+a.z*a.z;(te<0||wi<te)&&(Ye=mi<<1,te=wi,ne=a.x,_e=a.y,de=a.z)}if(Te*zt+Ne*Et+se*Kt<0){let Ft,ae,Xe,Oe,oi,pi;Ft=$t.x,ae=$t.y,Xe=$t.z,Oe=Ie.x,oi=Ie.y,pi=Ie.z;let $e,si,je;$e=Oe-Ft,si=oi-ae,je=pi-Xe;let De=$e*Ft+si*ae+je*Xe;De=-De/($e*$e+si*si+je*je);let mi;if(De<0)a.x=Ft,a.y=ae,a.z=Xe,mi=1;else if(De>1)a.x=Oe,a.y=oi,a.z=pi,mi=2;else{let Xi,Yi,ki;Xi=Ft+$e*De,Yi=ae+si*De,ki=Xe+je*De,a.x=Xi,a.y=Yi,a.z=ki,mi=3}let wi=a.x*a.x+a.y*a.y+a.z*a.z;(te<0||wi<te)&&(Ye=mi&1|(mi&2)<<1,te=wi,ne=a.x,_e=a.y,de=a.z)}let ye;if(te>0)a.x=ne,a.y=_e,a.z=de,ye=Ye;else{let Ft=ce*ce+Ge*Ge+we*we;Ft>0&&(Ft=1/Math.sqrt(Ft)),ce*=Ft,Ge*=Ft,we*=Ft;let ae=ce*ce+Ge*Ge+we*we;ae=(le*ce+ge*Ge+jt*we)/ae,ne=ce*ae,_e=Ge*ae,de=we*ae,a.x=ne,a.y=_e,a.z=de,ye=7}let oe=a.x*a.x+a.y*a.y+a.z*a.z;(ei<0||oe<ei)&&(ke=ye&3|(ye&4)<<1,ei=oe,ai=a.x,Qe=a.y,We=a.z)}if((nt*Je+gt*Ke+yt*ci)*hi<0){let le,ge,jt,Ae,Se,Re,Te,Ne,se,Ct,Gt,Pe,Ve,Ue,ii,ri,ui,vi;le=Ht.x,ge=Ht.y,jt=Ht.z,Ae=ue.x,Se=ue.y,Re=ue.z,Te=Ie.x,Ne=Ie.y,se=Ie.z,Ct=Ae-le,Gt=Se-ge,Pe=Re-jt,Ve=Te-Ae,Ue=Ne-Se,ii=se-Re,ri=le-Te,ui=ge-Ne,vi=jt-se;let ce,Ge,we;ce=Gt*ii-Pe*Ue,Ge=Pe*Ve-Ct*ii,we=Ct*Ue-Gt*Ve;let Be,xe,qt,Jt,ve,Qt,zt,Et,Kt;Be=Gt*we-Pe*Ge,xe=Pe*ce-Ct*we,qt=Ct*Ge-Gt*ce,Jt=Ue*we-ii*Ge,ve=ii*ce-Ve*we,Qt=Ve*Ge-Ue*ce,zt=ui*we-vi*Ge,Et=vi*ce-ri*we,Kt=ri*Ge-ui*ce;let te=-1,ne,_e,de,Ye=0;if(ne=0,_e=0,de=0,le*Be+ge*xe+jt*qt<0){let Ft,ae,Xe,Oe,oi,pi;Ft=Ht.x,ae=Ht.y,Xe=Ht.z,Oe=ue.x,oi=ue.y,pi=ue.z;let $e,si,je;$e=Oe-Ft,si=oi-ae,je=pi-Xe;let De=$e*Ft+si*ae+je*Xe;De=-De/($e*$e+si*si+je*je);let mi;if(De<0)a.x=Ft,a.y=ae,a.z=Xe,mi=1;else if(De>1)a.x=Oe,a.y=oi,a.z=pi,mi=2;else{let wi,Xi,Yi;wi=Ft+$e*De,Xi=ae+si*De,Yi=Xe+je*De,a.x=wi,a.y=Xi,a.z=Yi,mi=3}Ye=mi,te=a.x*a.x+a.y*a.y+a.z*a.z,ne=a.x,_e=a.y,de=a.z}if(Ae*Jt+Se*ve+Re*Qt<0){let Ft,ae,Xe,Oe,oi,pi;Ft=ue.x,ae=ue.y,Xe=ue.z,Oe=Ie.x,oi=Ie.y,pi=Ie.z;let $e,si,je;$e=Oe-Ft,si=oi-ae,je=pi-Xe;let De=$e*Ft+si*ae+je*Xe;De=-De/($e*$e+si*si+je*je);let mi;if(De<0)a.x=Ft,a.y=ae,a.z=Xe,mi=1;else if(De>1)a.x=Oe,a.y=oi,a.z=pi,mi=2;else{let Xi,Yi,ki;Xi=Ft+$e*De,Yi=ae+si*De,ki=Xe+je*De,a.x=Xi,a.y=Yi,a.z=ki,mi=3}let wi=a.x*a.x+a.y*a.y+a.z*a.z;(te<0||wi<te)&&(Ye=mi<<1,te=wi,ne=a.x,_e=a.y,de=a.z)}if(Te*zt+Ne*Et+se*Kt<0){let Ft,ae,Xe,Oe,oi,pi;Ft=Ht.x,ae=Ht.y,Xe=Ht.z,Oe=Ie.x,oi=Ie.y,pi=Ie.z;let $e,si,je;$e=Oe-Ft,si=oi-ae,je=pi-Xe;let De=$e*Ft+si*ae+je*Xe;De=-De/($e*$e+si*si+je*je);let mi;if(De<0)a.x=Ft,a.y=ae,a.z=Xe,mi=1;else if(De>1)a.x=Oe,a.y=oi,a.z=pi,mi=2;else{let Xi,Yi,ki;Xi=Ft+$e*De,Yi=ae+si*De,ki=Xe+je*De,a.x=Xi,a.y=Yi,a.z=ki,mi=3}let wi=a.x*a.x+a.y*a.y+a.z*a.z;(te<0||wi<te)&&(Ye=mi&1|(mi&2)<<1,te=wi,ne=a.x,_e=a.y,de=a.z)}let ye;if(te>0)a.x=ne,a.y=_e,a.z=de,ye=Ye;else{let Ft=ce*ce+Ge*Ge+we*we;Ft>0&&(Ft=1/Math.sqrt(Ft)),ce*=Ft,Ge*=Ft,we*=Ft;let ae=ce*ce+Ge*Ge+we*we;ae=(le*ce+ge*Ge+jt*we)/ae,ne=ce*ae,_e=Ge*ae,de=we*ae,a.x=ne,a.y=_e,a.z=de,ye=7}let oe=a.x*a.x+a.y*a.y+a.z*a.z;(ei<0||oe<ei)&&(ke=ye<<1,ei=oe,ai=a.x,Qe=a.y,We=a.z)}ei>0?(a.x=ai,a.y=Qe,a.z=We,Y=ke):(a.zero(),Y=15);break}if(this.shrinkSimplex(Y),a.x*a.x+a.y*a.y+a.z*a.z<1e-8){if(v==0||this.simplexSize==4)return r.fraction=v,!1;this.interpolateClosestPoints(),r.fraction=v;let L=r.normal;L.x=l.x,L.y=l.y,L.z=l.z;let S=Math.sqrt(L.x*L.x+L.y*L.y+L.z*L.z);S>0&&(S=1/S),L.x*=S,L.y*=S,L.z*=S;let R=r.position,E=this.closestPoint1;return R.x=E.x,R.y=E.y,R.z=E.z,R.x+=s.x*v,R.y+=s.y*v,R.z+=s.z*v,!0}if(l.x=a.x,l.y=a.y,l.z=a.z,l.x=-l.x,l.y=-l.y,l.z=-l.z,this.c1!=null)this.computeWitnessPoint1(!0);else{let L=this.w1[this.simplexSize];L.x=this.tf1._positionX,L.y=this.tf1._positionY,L.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);let w=this.s[this.simplexSize],Z=this.w1[this.simplexSize];w.x=Z.x,w.y=Z.y,w.z=Z.z;let X=this.w2[this.simplexSize];w.x-=X.x,w.y-=X.y,w.z-=X.z;let M=_[this.simplexSize];if(M.x-=x.x,M.y-=x.y,M.z-=x.z,l.x*l.x+l.y*l.y+l.z*l.z<1e-8)throw new Error("!?");let z=_[this.simplexSize],T=z.x*l.x+z.y*l.y+z.z*l.z;if(T<0){if(b.x*l.x+b.y*l.y+b.z*l.z>=0)return!1;let L=T/(b.x*l.x+b.y*l.y+b.z*l.z);if(v+=L,v>=1)return!1;x.x+=b.x*L,x.y+=b.y*L,x.z+=b.z*L;let S=0,R=this.simplexSize+1;for(;S<R;){let E=_[S++],C=-L;E.x+=b.x*C,E.y+=b.y*C,E.z+=b.z*C}}let F=!1,P=0,A=this.simplexSize;for(;P<A;){let L=P++,S=_[L].x-_[this.simplexSize].x,R=_[L].y-_[this.simplexSize].y,E=_[L].z-_[this.simplexSize].z;if(S*S+R*R+E*E<1e-8){F=!0;break}}F||this.simplexSize++,++g}return!1}interpolateClosestPoints(){switch(this.simplexSize){case 1:let t=this.closestPoint1,e=this.w1[0];t.x=e.x,t.y=e.y,t.z=e.z;let i=this.closestPoint2,n=this.w2[0];i.x=n.x,i.y=n.y,i.z=n.z;break;case 2:let s,o,r,_=this.closest;s=_.x,o=_.y,r=_.z;let a,l,h,m,f,p,d,u,g,v,x,b,Y,w,Z,X,M,z,T=this.s[0];a=T.x,l=T.y,h=T.z;let F=this.w1[0];m=F.x,f=F.y,p=F.z;let P=this.w2[0];d=P.x,u=P.y,g=P.z;let A=this.s[1];v=A.x,x=A.y,b=A.z;let L=this.w1[1];Y=L.x,w=L.y,Z=L.z;let S=this.w2[1];X=S.x,M=S.y,z=S.z;let R,E,C;R=v-a,E=x-l,C=b-h;let k=R*R+E*E+C*C;k!=0&&(k=1/k);let V,B,J;V=s-a,B=o-l,J=r-h;let I=(V*R+B*E+J*C)*k,G,D,et,$,j,q,tt,W,U;G=Y-m,D=w-f,et=Z-p,$=m+G*I,j=f+D*I,q=p+et*I,G=X-d,D=M-u,et=z-g,tt=d+G*I,W=u+D*I,U=g+et*I;let it=this.closestPoint1;it.x=$,it.y=j,it.z=q;let Q=this.closestPoint2;Q.x=tt,Q.y=W,Q.z=U;break;case 3:let at,ht,_t,mt=this.closest;at=mt.x,ht=mt.y,_t=mt.z;let ft,ut,H,O,ot,pt,vt,xt,Mt,ct,St,It,dt,K,lt,rt,Vt,At,Yt,Xt,Nt,ie,ee,Ze,ze,pe,$t,Ht=this.s[0];ft=Ht.x,ut=Ht.y,H=Ht.z;let ue=this.w1[0];O=ue.x,ot=ue.y,pt=ue.z;let Ie=this.w2[0];vt=Ie.x,xt=Ie.y,Mt=Ie.z;let qe=this.s[1];ct=qe.x,St=qe.y,It=qe.z;let Ee=this.w1[1];dt=Ee.x,K=Ee.y,lt=Ee.z;let Ut=this.w2[1];rt=Ut.x,Vt=Ut.y,At=Ut.z;let nt=this.s[2];Yt=nt.x,Xt=nt.y,Nt=nt.z;let gt=this.w1[2];ie=gt.x,ee=gt.y,Ze=gt.z;let yt=this.w2[2];ze=yt.x,pe=yt.y,$t=yt.z;let bt,st,Pt,Dt,N,kt,Rt,Ot,Wt;bt=ct-ft,st=St-ut,Pt=It-H,Dt=Yt-ft,N=Xt-ut,kt=Nt-H,Rt=at-ft,Ot=ht-ut,Wt=_t-H;let Bt=bt*bt+st*st+Pt*Pt,re=bt*Dt+st*N+Pt*kt,Ce=Dt*Dt+N*N+kt*kt,be=bt*Rt+st*Ot+Pt*Wt,Tt=Dt*Rt+N*Ot+kt*Wt,Lt=Bt*Ce-re*re;Lt!=0&&(Lt=1/Lt);let Zt=(be*Ce-Tt*re)*Lt,me=(-be*re+Tt*Bt)*Lt,Me,fe,ti,di,Le,_i,yi,he,gi;Me=dt-O,fe=K-ot,ti=lt-pt,di=O+Me*Zt,Le=ot+fe*Zt,_i=pt+ti*Zt,Me=ie-O,fe=ee-ot,ti=Ze-pt,di+=Me*me,Le+=fe*me,_i+=ti*me,Me=rt-vt,fe=Vt-xt,ti=At-Mt,yi=vt+Me*Zt,he=xt+fe*Zt,gi=Mt+ti*Zt,Me=ze-vt,fe=pe-xt,ti=$t-Mt,yi+=Me*me,he+=fe*me,gi+=ti*me;let bi=this.closestPoint1;bi.x=di,bi.y=Le,bi.z=_i;let Mi=this.closestPoint2;Mi.x=yi,Mi.y=he,Mi.z=gi;break;default:throw new Error("!?")}}loadCache(t){let e=this.dir,i=t.prevClosestDir;e.x=i.x,e.y=i.y,e.z=i.z}saveCache(t){let e=t.prevClosestDir,i=this.closest;e.x=i.x,e.y=i.y,e.z=i.z,e.x=-e.x,e.y=-e.y,e.z=-e.z}shrinkSimplex(t){switch(this.simplexSize=t,this.simplexSize=(this.simplexSize&5)+(this.simplexSize>>1&5),this.simplexSize=(this.simplexSize&3)+(this.simplexSize>>2&3),t){case 2:let e=this.s[0],i=this.s[1];e.x=i.x,e.y=i.y,e.z=i.z;let n=this.w1[0],s=this.w1[1];n.x=s.x,n.y=s.y,n.z=s.z;let o=this.w2[0],r=this.w2[1];o.x=r.x,o.y=r.y,o.z=r.z;break;case 4:let _=this.s[0],a=this.s[2];_.x=a.x,_.y=a.y,_.z=a.z;let l=this.w1[0],h=this.w1[2];l.x=h.x,l.y=h.y,l.z=h.z;let m=this.w2[0],f=this.w2[2];m.x=f.x,m.y=f.y,m.z=f.z;break;case 5:let p=this.s[1],d=this.s[2];p.x=d.x,p.y=d.y,p.z=d.z;let u=this.w1[1],g=this.w1[2];u.x=g.x,u.y=g.y,u.z=g.z;let v=this.w2[1],x=this.w2[2];v.x=x.x,v.y=x.y,v.z=x.z;break;case 6:let b=this.s[0],Y=this.s[2];b.x=Y.x,b.y=Y.y,b.z=Y.z;let w=this.w1[0],Z=this.w1[2];w.x=Z.x,w.y=Z.y,w.z=Z.z;let X=this.w2[0],M=this.w2[2];X.x=M.x,X.y=M.y,X.z=M.z;break;case 8:let z=this.s[0],T=this.s[3];z.x=T.x,z.y=T.y,z.z=T.z;let F=this.w1[0],P=this.w1[3];F.x=P.x,F.y=P.y,F.z=P.z;let A=this.w2[0],L=this.w2[3];A.x=L.x,A.y=L.y,A.z=L.z;break;case 9:let S=this.s[1],R=this.s[3];S.x=R.x,S.y=R.y,S.z=R.z;let E=this.w1[1],C=this.w1[3];E.x=C.x,E.y=C.y,E.z=C.z;let k=this.w2[1],V=this.w2[3];k.x=V.x,k.y=V.y,k.z=V.z;break;case 10:let B=this.s[0],J=this.s[3];B.x=J.x,B.y=J.y,B.z=J.z;let I=this.w1[0],G=this.w1[3];I.x=G.x,I.y=G.y,I.z=G.z;let D=this.w2[0],et=this.w2[3];D.x=et.x,D.y=et.y,D.z=et.z;break;case 11:let $=this.s[2],j=this.s[3];$.x=j.x,$.y=j.y,$.z=j.z;let q=this.w1[2],tt=this.w1[3];q.x=tt.x,q.y=tt.y,q.z=tt.z;let W=this.w2[2],U=this.w2[3];W.x=U.x,W.y=U.y,W.z=U.z;break;case 12:let it=this.s[0],Q=this.s[2];it.x=Q.x,it.y=Q.y,it.z=Q.z;let at=this.w1[0],ht=this.w1[2];at.x=ht.x,at.y=ht.y,at.z=ht.z;let _t=this.w2[0],mt=this.w2[2];_t.x=mt.x,_t.y=mt.y,_t.z=mt.z;let ft=this.s[1],ut=this.s[3];ft.x=ut.x,ft.y=ut.y,ft.z=ut.z;let H=this.w1[1],O=this.w1[3];H.x=O.x,H.y=O.y,H.z=O.z;let ot=this.w2[1],pt=this.w2[3];ot.x=pt.x,ot.y=pt.y,ot.z=pt.z;break;case 13:let vt=this.s[1],xt=this.s[3];vt.x=xt.x,vt.y=xt.y,vt.z=xt.z;let Mt=this.w1[1],ct=this.w1[3];Mt.x=ct.x,Mt.y=ct.y,Mt.z=ct.z;let St=this.w2[1],It=this.w2[3];St.x=It.x,St.y=It.y,St.z=It.z;break;case 14:let dt=this.s[0],K=this.s[3];dt.x=K.x,dt.y=K.y,dt.z=K.z;let lt=this.w1[0],rt=this.w1[3];lt.x=rt.x,lt.y=rt.y,lt.z=rt.z;let Vt=this.w2[0],At=this.w2[3];Vt.x=At.x,Vt.y=At.y,Vt.z=At.z;break}}computeWitnessPoint1(t){let e,i,n,s,o,r,_=this.dir;s=_.x,o=_.y,r=_.z;let a,l,h,m,f,p;m=this.tf1._rotation00*s+this.tf1._rotation10*o+this.tf1._rotation20*r,f=this.tf1._rotation01*s+this.tf1._rotation11*o+this.tf1._rotation21*r,p=this.tf1._rotation02*s+this.tf1._rotation12*o+this.tf1._rotation22*r,a=m,l=f,h=p;let d,u,g,v=this.dir;if(v.x=a,v.y=l,v.z=h,this.c1.computeLocalSupportingVertex(this.dir,this.w1[this.simplexSize]),t){let M=this.dir,z=Math.sqrt(M.x*M.x+M.y*M.y+M.z*M.z);z>0&&(z=1/z),M.x*=z,M.y*=z,M.z*=z;let T=this.w1[this.simplexSize],F=this.dir,P=this.c1._gjkMargin;T.x+=F.x*P,T.y+=F.y*P,T.z+=F.z*P}let x=this.w1[this.simplexSize];e=x.x,i=x.y,n=x.z;let b,Y,w;b=this.tf1._rotation00*e+this.tf1._rotation01*i+this.tf1._rotation02*n,Y=this.tf1._rotation10*e+this.tf1._rotation11*i+this.tf1._rotation12*n,w=this.tf1._rotation20*e+this.tf1._rotation21*i+this.tf1._rotation22*n,d=b,u=Y,g=w,d+=this.tf1._positionX,u+=this.tf1._positionY,g+=this.tf1._positionZ;let Z=this.w1[this.simplexSize];Z.x=d,Z.y=u,Z.z=g;let X=this.dir;X.x=s,X.y=o,X.z=r}computeWitnessPoint2(t){let e,i,n,s,o,r,_=this.dir;s=_.x,o=_.y,r=_.z;let a,l,h,m,f,p;m=this.tf2._rotation00*s+this.tf2._rotation10*o+this.tf2._rotation20*r,f=this.tf2._rotation01*s+this.tf2._rotation11*o+this.tf2._rotation21*r,p=this.tf2._rotation02*s+this.tf2._rotation12*o+this.tf2._rotation22*r,a=m,l=f,h=p,a=-a,l=-l,h=-h;let d,u,g,v=this.dir;if(v.x=a,v.y=l,v.z=h,this.c2.computeLocalSupportingVertex(this.dir,this.w2[this.simplexSize]),t){let M=this.dir,z=Math.sqrt(M.x*M.x+M.y*M.y+M.z*M.z);z>0&&(z=1/z),M.x*=z,M.y*=z,M.z*=z;let T=this.w2[this.simplexSize],F=this.dir,P=this.c2._gjkMargin;T.x+=F.x*P,T.y+=F.y*P,T.z+=F.z*P}let x=this.w2[this.simplexSize];e=x.x,i=x.y,n=x.z;let b,Y,w;b=this.tf2._rotation00*e+this.tf2._rotation01*i+this.tf2._rotation02*n,Y=this.tf2._rotation10*e+this.tf2._rotation11*i+this.tf2._rotation12*n,w=this.tf2._rotation20*e+this.tf2._rotation21*i+this.tf2._rotation22*n,d=b,u=Y,g=w,d+=this.tf2._positionX,u+=this.tf2._positionY,g+=this.tf2._positionZ;let Z=this.w2[this.simplexSize];Z.x=d,Z.y=u,Z.z=g;let X=this.dir;X.x=s,X.y=o,X.z=r}pointToTetrahedron(){let t=0;for(;t<3;){let e=this.dir,i=this.baseDirs[t++];e.x=i.x,e.y=i.y,e.z=i.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let n=this.s[this.simplexSize],s=this.w1[this.simplexSize];n.x=s.x,n.y=s.y,n.z=s.z;let o=this.w2[this.simplexSize];if(n.x-=o.x,n.y-=o.y,n.z-=o.z,this.simplexSize++,this.lineToTetrahedron(),this.simplexSize==4)break;this.simplexSize--;let r=this.dir;r.x=-r.x,r.y=-r.y,r.z=-r.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let _=this.s[this.simplexSize],a=this.w1[this.simplexSize];_.x=a.x,_.y=a.y,_.z=a.z;let l=this.w2[this.simplexSize];if(_.x-=l.x,_.y-=l.y,_.z-=l.z,this.simplexSize++,this.lineToTetrahedron(),this.simplexSize==4)break;this.simplexSize--}}lineToTetrahedron(){let t,e,i,n=this.dir;t=n.x,e=n.y,i=n.z;let s,o,r,_,a,l,h,m,f,p=this.s[0];s=p.x,o=p.y,r=p.z;let d=this.s[1];_=d.x,a=d.y,l=d.z,h=s-_,m=o-a,f=r-l;let u=0;for(;u<3;){let v,x,b,Y=this.baseDirs[u++];v=Y.x,x=Y.y,b=Y.z;let w,Z,X;w=m*b-f*x,Z=f*v-h*b,X=h*x-m*v;let M=this.dir;M.x=w,M.y=Z,M.z=X,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let z=this.s[this.simplexSize],T=this.w1[this.simplexSize];z.x=T.x,z.y=T.y,z.z=T.z;let F=this.w2[this.simplexSize];if(z.x-=F.x,z.y-=F.y,z.z-=F.z,this.simplexSize++,this.triangleToTetrahedron(),this.simplexSize==4)break;this.simplexSize--;let P=this.dir;P.x=-P.x,P.y=-P.y,P.z=-P.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let A=this.s[this.simplexSize],L=this.w1[this.simplexSize];A.x=L.x,A.y=L.y,A.z=L.z;let S=this.w2[this.simplexSize];if(A.x-=S.x,A.y-=S.y,A.z-=S.z,this.simplexSize++,this.triangleToTetrahedron(),this.simplexSize==4)break;this.simplexSize--}let g=this.dir;g.x=t,g.y=e,g.z=i}triangleToTetrahedron(){let t,e,i,n=this.dir;for(t=n.x,e=n.y,i=n.z;;){let o,r,_,a,l,h,m,f,p,d,u,g,v,x,b,Y=this.s[0];o=Y.x,r=Y.y,_=Y.z;let w=this.s[1];a=w.x,l=w.y,h=w.z;let Z=this.s[2];m=Z.x,f=Z.y,p=Z.z,d=a-o,u=l-r,g=h-_,v=m-o,x=f-r,b=p-_;let X,M,z;X=u*b-g*x,M=g*v-d*b,z=d*x-u*v;let T=this.dir;T.x=X,T.y=M,T.z=z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let F=this.s[this.simplexSize],P=this.w1[this.simplexSize];F.x=P.x,F.y=P.y,F.z=P.z;let A=this.w2[this.simplexSize];if(F.x-=A.x,F.y-=A.y,F.z-=A.z,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;let L=this.dir;L.x=-L.x,L.y=-L.y,L.z=-L.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let S=this.s[this.simplexSize],R=this.w1[this.simplexSize];S.x=R.x,S.y=R.y,S.z=R.z;let E=this.w2[this.simplexSize];if(S.x-=E.x,S.y-=E.y,S.z-=E.z,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;break}let s=this.dir;s.x=t,s.y=e,s.z=i}isValidTetrahedron(){let t=this.s[2].x-this.s[0].x,e=this.s[2].y-this.s[0].y,i=this.s[2].z-this.s[0].z,n=this.s[3].x-this.s[0].x,s=this.s[3].y-this.s[0].y,o=this.s[3].z-this.s[0].z,r=(this.s[1].x-this.s[0].x)*(e*o-i*s)-(this.s[1].y-this.s[0].y)*(t*o-i*n)+(this.s[1].z-this.s[0].z)*(t*s-e*n);return r>1e-12?!0:r<-1e-12}computeDepth(t,e,i,n,s,o,r){let _=this.polyhedron;for(;_._numTriangles>0;){let M=_._triangleList;_._numTriangles--;let z=M._prev,T=M._next;z!=null&&(z._next=T),T!=null&&(T._prev=z),M==_._triangleList&&(_._triangleList=_._triangleList._next),M==_._triangleListLast&&(_._triangleListLast=_._triangleListLast._prev),M._next=null,M._prev=null,M.removeReferences(),M._next=_._trianglePool,_._trianglePool=M}for(;_._numVertices>0;){let M=_._vertices[--_._numVertices];M.removeReferences(),M._next=_._vertexPool,_._vertexPool=M}let a=this.polyhedron,l=this.polyhedron,h=l._vertexPool;h!=null?(l._vertexPool=h._next,h._next=null):h=new y.collision.narrowphase.detector.gjkepa.EpaVertex;let m=h.init(s[0],o[0],r[0]),f=this.polyhedron,p=f._vertexPool;p!=null?(f._vertexPool=p._next,p._next=null):p=new y.collision.narrowphase.detector.gjkepa.EpaVertex;let d=p.init(s[1],o[1],r[1]),u=this.polyhedron,g=u._vertexPool;g!=null?(u._vertexPool=g._next,g._next=null):g=new y.collision.narrowphase.detector.gjkepa.EpaVertex;let v=g.init(s[2],o[2],r[2]),x=this.polyhedron,b=x._vertexPool;if(b!=null?(x._vertexPool=b._next,b._next=null):b=new y.collision.narrowphase.detector.gjkepa.EpaVertex,!a._init(m,d,v,b.init(s[3],o[3],r[3])))return y.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT;this.simplexSize=0;let Y=this.s[0],w=this.w1[0],Z=this.w2[0],X=0;for(;X<40;){let M=this.polyhedron._triangleList,z=1/0,T=null;for(;M!=null;)M._distanceSq<z&&(z=M._distanceSq,T=M),M=M._next;let F=T,P=this.dir,A=F._normal;P.x=A.x,P.y=A.y,P.z=A.z;let L=Math.sqrt(P.x*P.x+P.y*P.y+P.z*P.z);L>0&&(L=1/L),P.x*=L,P.y*=L,P.z*=L,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let S=this.s[this.simplexSize],R=this.w1[this.simplexSize];S.x=R.x,S.y=R.y,S.z=R.z;let E=this.w2[this.simplexSize];S.x-=E.x,S.y-=E.y,S.z-=E.z;let C=F._vertices[0],k=F._vertices[1],V=F._vertices[2],B=C.v,J=this.dir,I=this.dir;if(Y.x*I.x+Y.y*I.y+Y.z*I.z-(B.x*J.x+B.y*J.y+B.z*J.z)<1e-6||X==39){let $=this.closest,j=this.dir;$.x=j.x,$.y=j.y,$.z=j.z;let q=this.dir,tt=C.v,W=this.dir,U=(q.x*tt.x+q.y*tt.y+q.z*tt.z)/(W.x*W.x+W.y*W.y+W.z*W.z);$.x*=U,$.y*=U,$.z*=U;let it,Q,at,ht=this.closest;it=ht.x,Q=ht.y,at=ht.z;let _t,mt,ft,ut,H,O,ot,pt,vt,xt,Mt,ct,St,It,dt,K,lt,rt,Vt,At,Yt,Xt,Nt,ie,ee,Ze,ze,pe=C.v;_t=pe.x,mt=pe.y,ft=pe.z;let $t=C.w1;ut=$t.x,H=$t.y,O=$t.z;let Ht=C.w2;ot=Ht.x,pt=Ht.y,vt=Ht.z;let ue=k.v;xt=ue.x,Mt=ue.y,ct=ue.z;let Ie=k.w1;St=Ie.x,It=Ie.y,dt=Ie.z;let qe=k.w2;K=qe.x,lt=qe.y,rt=qe.z;let Ee=V.v;Vt=Ee.x,At=Ee.y,Yt=Ee.z;let Ut=V.w1;Xt=Ut.x,Nt=Ut.y,ie=Ut.z;let nt=V.w2;ee=nt.x,Ze=nt.y,ze=nt.z;let gt,yt,bt,st,Pt,Dt,N,kt,Rt;gt=xt-_t,yt=Mt-mt,bt=ct-ft,st=Vt-_t,Pt=At-mt,Dt=Yt-ft,N=it-_t,kt=Q-mt,Rt=at-ft;let Ot=gt*gt+yt*yt+bt*bt,Wt=gt*st+yt*Pt+bt*Dt,Bt=st*st+Pt*Pt+Dt*Dt,re=gt*N+yt*kt+bt*Rt,Ce=st*N+Pt*kt+Dt*Rt,be=Ot*Bt-Wt*Wt;be!=0&&(be=1/be);let Tt=(re*Bt-Ce*Wt)*be,Lt=(-re*Wt+Ce*Ot)*be,Zt,me,Me,fe,ti,di,Le,_i,yi;Zt=St-ut,me=It-H,Me=dt-O,fe=ut+Zt*Tt,ti=H+me*Tt,di=O+Me*Tt,Zt=Xt-ut,me=Nt-H,Me=ie-O,fe+=Zt*Lt,ti+=me*Lt,di+=Me*Lt,Zt=K-ot,me=lt-pt,Me=rt-vt,Le=ot+Zt*Tt,_i=pt+me*Tt,yi=vt+Me*Tt,Zt=ee-ot,me=Ze-pt,Me=ze-vt,Le+=Zt*Lt,_i+=me*Lt,yi+=Me*Lt;let he=this.closestPoint1;he.x=fe,he.y=ti,he.z=di;let gi=this.closestPoint2;gi.x=Le,gi.y=_i,gi.z=yi;let bi=this.closest;return this.depth=Math.sqrt(bi.x*bi.x+bi.y*bi.y+bi.z*bi.z),y.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED}let G=this.polyhedron,D=G._vertexPool;D!=null?(G._vertexPool=D._next,D._next=null):D=new y.collision.narrowphase.detector.gjkepa.EpaVertex;let et=D.init(Y,w,Z);if(!this.polyhedron._addVertex(et,F))return y.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX;++X}return y.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE}computeClosestPoints(t,e,i,n,s){return this.computeClosestPointsImpl(t,e,i,n,s,!0)}computeDistance(t,e,i,n,s){return this.computeClosestPointsImpl(t,e,i,n,s,!1)}convexCast(t,e,i,n,s,o,r){return this.convexCastImpl(t,e,i,n,s,o,r)}rayCast(t,e,i,n,s){let o=this.tempTransform;o._positionX=i.x,o._positionY=i.y,o._positionZ=i.z;let r=this.tl1,_=this.tl2;return r.x=n.x,r.y=n.y,r.z=n.z,r.x-=i.x,r.y-=i.y,r.z-=i.z,_.zero(),this.convexCastImpl(null,t,o,e,r,_,s)}static getInstance(){return y.collision.narrowphase.detector.gjkepa.GjkEpa.instance}};y.collision.narrowphase.detector.gjkepa.GjkEpaLog=class{};y.collision.narrowphase.detector.gjkepa.GjkEpaResultState=class{};y.collision.narrowphase.detector.gjkepa.SimplexUtil=class{static projectOrigin2(t,e,i){let n,s,o,r,_,a;n=t.x,s=t.y,o=t.z,r=e.x,_=e.y,a=e.z;let l,h,m;l=r-n,h=_-s,m=a-o;let f=l*n+h*s+m*o;if(f=-f/(l*l+h*h+m*m),f<0)return i.x=n,i.y=s,i.z=o,1;if(f>1)return i.x=r,i.y=_,i.z=a,2;let p,d,u;return p=n+l*f,d=s+h*f,u=o+m*f,i.x=p,i.y=d,i.z=u,3}static projectOrigin3(t,e,i,n){let s,o,r,_,a,l,h,m,f,p,d,u,g,v,x,b,Y,w;s=t.x,o=t.y,r=t.z,_=e.x,a=e.y,l=e.z,h=i.x,m=i.y,f=i.z,p=_-s,d=a-o,u=l-r,g=h-_,v=m-a,x=f-l,b=s-h,Y=o-m,w=r-f;let Z,X,M;Z=d*x-u*v,X=u*g-p*x,M=p*v-d*g;let z,T,F,P,A,L,S,R,E;z=d*M-u*X,T=u*Z-p*M,F=p*X-d*Z,P=v*M-x*X,A=x*Z-g*M,L=g*X-v*Z,S=Y*M-w*X,R=w*Z-b*M,E=b*X-Y*Z;let C=-1,k,V,B,J=0;if(k=0,V=0,B=0,s*z+o*T+r*F<0){let D,et,$,j,q,tt;D=t.x,et=t.y,$=t.z,j=e.x,q=e.y,tt=e.z;let W,U,it;W=j-D,U=q-et,it=tt-$;let Q=W*D+U*et+it*$;Q=-Q/(W*W+U*U+it*it);let at;if(Q<0)n.x=D,n.y=et,n.z=$,at=1;else if(Q>1)n.x=j,n.y=q,n.z=tt,at=2;else{let ht,_t,mt;ht=D+W*Q,_t=et+U*Q,mt=$+it*Q,n.x=ht,n.y=_t,n.z=mt,at=3}J=at,C=n.x*n.x+n.y*n.y+n.z*n.z,k=n.x,V=n.y,B=n.z}if(_*P+a*A+l*L<0){let D,et,$,j,q,tt;D=e.x,et=e.y,$=e.z,j=i.x,q=i.y,tt=i.z;let W,U,it;W=j-D,U=q-et,it=tt-$;let Q=W*D+U*et+it*$;Q=-Q/(W*W+U*U+it*it);let at;if(Q<0)n.x=D,n.y=et,n.z=$,at=1;else if(Q>1)n.x=j,n.y=q,n.z=tt,at=2;else{let _t,mt,ft;_t=D+W*Q,mt=et+U*Q,ft=$+it*Q,n.x=_t,n.y=mt,n.z=ft,at=3}let ht=n.x*n.x+n.y*n.y+n.z*n.z;(C<0||ht<C)&&(J=at<<1,C=ht,k=n.x,V=n.y,B=n.z)}if(h*S+m*R+f*E<0){let D,et,$,j,q,tt;D=t.x,et=t.y,$=t.z,j=i.x,q=i.y,tt=i.z;let W,U,it;W=j-D,U=q-et,it=tt-$;let Q=W*D+U*et+it*$;Q=-Q/(W*W+U*U+it*it);let at;if(Q<0)n.x=D,n.y=et,n.z=$,at=1;else if(Q>1)n.x=j,n.y=q,n.z=tt,at=2;else{let _t,mt,ft;_t=D+W*Q,mt=et+U*Q,ft=$+it*Q,n.x=_t,n.y=mt,n.z=ft,at=3}let ht=n.x*n.x+n.y*n.y+n.z*n.z;(C<0||ht<C)&&(J=at&1|(at&2)<<1,C=ht,k=n.x,V=n.y,B=n.z)}if(C>0)return n.x=k,n.y=V,n.z=B,J;let I=Z*Z+X*X+M*M;I>0&&(I=1/Math.sqrt(I)),Z*=I,X*=I,M*=I;let G=Z*Z+X*X+M*M;return G=(s*Z+o*X+r*M)/G,k=Z*G,V=X*G,B=M*G,n.x=k,n.y=V,n.z=B,7}static projectOrigin4(t,e,i,n,s){let o,r,_,a,l,h,m,f,p,d,u,g,v,x,b,Y,w,Z,X,M,z,T,F,P,A,L,S;o=t.x,r=t.y,_=t.z,a=e.x,l=e.y,h=e.z,m=i.x,f=i.y,p=i.z,d=n.x,u=n.y,g=n.z,v=a-o,x=l-r,b=h-_,Y=m-o,w=f-r,Z=p-_,X=d-o,M=u-r,z=g-_,T=m-a,F=f-l,P=p-h,A=d-a,L=u-l,S=g-h;let R,E,C,k,V,B,J,I,G,D,et,$;R=x*Z-b*w,E=b*Y-v*Z,C=v*w-x*Y,k=w*z-Z*M,V=Z*X-Y*z,B=Y*M-w*X,J=M*b-z*x,I=z*v-X*b,G=X*x-M*v,D=L*P-S*F,et=S*T-A*P,$=A*F-L*T;let j=v*D+x*et+b*$>0?1:-1,q=-1,tt,W,U,it=0;if(tt=0,W=0,U=0,(o*R+r*E+_*C)*j<0){let Q,at,ht,_t,mt,ft,ut,H,O,ot,pt,vt,xt,Mt,ct,St,It,dt;Q=t.x,at=t.y,ht=t.z,_t=e.x,mt=e.y,ft=e.z,ut=i.x,H=i.y,O=i.z,ot=_t-Q,pt=mt-at,vt=ft-ht,xt=ut-_t,Mt=H-mt,ct=O-ft,St=Q-ut,It=at-H,dt=ht-O;let K,lt,rt;K=pt*ct-vt*Mt,lt=vt*xt-ot*ct,rt=ot*Mt-pt*xt;let Vt,At,Yt,Xt,Nt,ie,ee,Ze,ze;Vt=pt*rt-vt*lt,At=vt*K-ot*rt,Yt=ot*lt-pt*K,Xt=Mt*rt-ct*lt,Nt=ct*K-xt*rt,ie=xt*lt-Mt*K,ee=It*rt-dt*lt,Ze=dt*K-St*rt,ze=St*lt-It*K;let pe=-1,$t,Ht,ue,Ie=0;if($t=0,Ht=0,ue=0,Q*Vt+at*At+ht*Yt<0){let Ee,Ut,nt,gt,yt,bt;Ee=t.x,Ut=t.y,nt=t.z,gt=e.x,yt=e.y,bt=e.z;let st,Pt,Dt;st=gt-Ee,Pt=yt-Ut,Dt=bt-nt;let N=st*Ee+Pt*Ut+Dt*nt;N=-N/(st*st+Pt*Pt+Dt*Dt);let kt;if(N<0)s.x=Ee,s.y=Ut,s.z=nt,kt=1;else if(N>1)s.x=gt,s.y=yt,s.z=bt,kt=2;else{let Rt,Ot,Wt;Rt=Ee+st*N,Ot=Ut+Pt*N,Wt=nt+Dt*N,s.x=Rt,s.y=Ot,s.z=Wt,kt=3}Ie=kt,pe=s.x*s.x+s.y*s.y+s.z*s.z,$t=s.x,Ht=s.y,ue=s.z}if(_t*Xt+mt*Nt+ft*ie<0){let Ee,Ut,nt,gt,yt,bt;Ee=e.x,Ut=e.y,nt=e.z,gt=i.x,yt=i.y,bt=i.z;let st,Pt,Dt;st=gt-Ee,Pt=yt-Ut,Dt=bt-nt;let N=st*Ee+Pt*Ut+Dt*nt;N=-N/(st*st+Pt*Pt+Dt*Dt);let kt;if(N<0)s.x=Ee,s.y=Ut,s.z=nt,kt=1;else if(N>1)s.x=gt,s.y=yt,s.z=bt,kt=2;else{let Ot,Wt,Bt;Ot=Ee+st*N,Wt=Ut+Pt*N,Bt=nt+Dt*N,s.x=Ot,s.y=Wt,s.z=Bt,kt=3}let Rt=s.x*s.x+s.y*s.y+s.z*s.z;(pe<0||Rt<pe)&&(Ie=kt<<1,pe=Rt,$t=s.x,Ht=s.y,ue=s.z)}if(ut*ee+H*Ze+O*ze<0){let Ee,Ut,nt,gt,yt,bt;Ee=t.x,Ut=t.y,nt=t.z,gt=i.x,yt=i.y,bt=i.z;let st,Pt,Dt;st=gt-Ee,Pt=yt-Ut,Dt=bt-nt;let N=st*Ee+Pt*Ut+Dt*nt;N=-N/(st*st+Pt*Pt+Dt*Dt);let kt;if(N<0)s.x=Ee,s.y=Ut,s.z=nt,kt=1;else if(N>1)s.x=gt,s.y=yt,s.z=bt,kt=2;else{let Ot,Wt,Bt;Ot=Ee+st*N,Wt=Ut+Pt*N,Bt=nt+Dt*N,s.x=Ot,s.y=Wt,s.z=Bt,kt=3}let Rt=s.x*s.x+s.y*s.y+s.z*s.z;(pe<0||Rt<pe)&&(Ie=kt&1|(kt&2)<<1,pe=Rt,$t=s.x,Ht=s.y,ue=s.z)}let qe;if(pe>0)s.x=$t,s.y=Ht,s.z=ue,qe=Ie;else{let Ee=K*K+lt*lt+rt*rt;Ee>0&&(Ee=1/Math.sqrt(Ee)),K*=Ee,lt*=Ee,rt*=Ee;let Ut=K*K+lt*lt+rt*rt;Ut=(Q*K+at*lt+ht*rt)/Ut,$t=K*Ut,Ht=lt*Ut,ue=rt*Ut,s.x=$t,s.y=Ht,s.z=ue,qe=7}it=qe,q=s.x*s.x+s.y*s.y+s.z*s.z,tt=s.x,W=s.y,U=s.z}if((o*k+r*V+_*B)*j<0){let Q,at,ht,_t,mt,ft,ut,H,O,ot,pt,vt,xt,Mt,ct,St,It,dt;Q=t.x,at=t.y,ht=t.z,_t=i.x,mt=i.y,ft=i.z,ut=n.x,H=n.y,O=n.z,ot=_t-Q,pt=mt-at,vt=ft-ht,xt=ut-_t,Mt=H-mt,ct=O-ft,St=Q-ut,It=at-H,dt=ht-O;let K,lt,rt;K=pt*ct-vt*Mt,lt=vt*xt-ot*ct,rt=ot*Mt-pt*xt;let Vt,At,Yt,Xt,Nt,ie,ee,Ze,ze;Vt=pt*rt-vt*lt,At=vt*K-ot*rt,Yt=ot*lt-pt*K,Xt=Mt*rt-ct*lt,Nt=ct*K-xt*rt,ie=xt*lt-Mt*K,ee=It*rt-dt*lt,Ze=dt*K-St*rt,ze=St*lt-It*K;let pe=-1,$t,Ht,ue,Ie=0;if($t=0,Ht=0,ue=0,Q*Vt+at*At+ht*Yt<0){let Ut,nt,gt,yt,bt,st;Ut=t.x,nt=t.y,gt=t.z,yt=i.x,bt=i.y,st=i.z;let Pt,Dt,N;Pt=yt-Ut,Dt=bt-nt,N=st-gt;let kt=Pt*Ut+Dt*nt+N*gt;kt=-kt/(Pt*Pt+Dt*Dt+N*N);let Rt;if(kt<0)s.x=Ut,s.y=nt,s.z=gt,Rt=1;else if(kt>1)s.x=yt,s.y=bt,s.z=st,Rt=2;else{let Ot,Wt,Bt;Ot=Ut+Pt*kt,Wt=nt+Dt*kt,Bt=gt+N*kt,s.x=Ot,s.y=Wt,s.z=Bt,Rt=3}Ie=Rt,pe=s.x*s.x+s.y*s.y+s.z*s.z,$t=s.x,Ht=s.y,ue=s.z}if(_t*Xt+mt*Nt+ft*ie<0){let Ut,nt,gt,yt,bt,st;Ut=i.x,nt=i.y,gt=i.z,yt=n.x,bt=n.y,st=n.z;let Pt,Dt,N;Pt=yt-Ut,Dt=bt-nt,N=st-gt;let kt=Pt*Ut+Dt*nt+N*gt;kt=-kt/(Pt*Pt+Dt*Dt+N*N);let Rt;if(kt<0)s.x=Ut,s.y=nt,s.z=gt,Rt=1;else if(kt>1)s.x=yt,s.y=bt,s.z=st,Rt=2;else{let Wt,Bt,re;Wt=Ut+Pt*kt,Bt=nt+Dt*kt,re=gt+N*kt,s.x=Wt,s.y=Bt,s.z=re,Rt=3}let Ot=s.x*s.x+s.y*s.y+s.z*s.z;(pe<0||Ot<pe)&&(Ie=Rt<<1,pe=Ot,$t=s.x,Ht=s.y,ue=s.z)}if(ut*ee+H*Ze+O*ze<0){let Ut,nt,gt,yt,bt,st;Ut=t.x,nt=t.y,gt=t.z,yt=n.x,bt=n.y,st=n.z;let Pt,Dt,N;Pt=yt-Ut,Dt=bt-nt,N=st-gt;let kt=Pt*Ut+Dt*nt+N*gt;kt=-kt/(Pt*Pt+Dt*Dt+N*N);let Rt;if(kt<0)s.x=Ut,s.y=nt,s.z=gt,Rt=1;else if(kt>1)s.x=yt,s.y=bt,s.z=st,Rt=2;else{let Wt,Bt,re;Wt=Ut+Pt*kt,Bt=nt+Dt*kt,re=gt+N*kt,s.x=Wt,s.y=Bt,s.z=re,Rt=3}let Ot=s.x*s.x+s.y*s.y+s.z*s.z;(pe<0||Ot<pe)&&(Ie=Rt&1|(Rt&2)<<1,pe=Ot,$t=s.x,Ht=s.y,ue=s.z)}let qe;if(pe>0)s.x=$t,s.y=Ht,s.z=ue,qe=Ie;else{let Ut=K*K+lt*lt+rt*rt;Ut>0&&(Ut=1/Math.sqrt(Ut)),K*=Ut,lt*=Ut,rt*=Ut;let nt=K*K+lt*lt+rt*rt;nt=(Q*K+at*lt+ht*rt)/nt,$t=K*nt,Ht=lt*nt,ue=rt*nt,s.x=$t,s.y=Ht,s.z=ue,qe=7}let Ee=s.x*s.x+s.y*s.y+s.z*s.z;(q<0||Ee<q)&&(it=qe&1|(qe&6)<<1,q=Ee,tt=s.x,W=s.y,U=s.z)}if((o*J+r*I+_*G)*j<0){let Q,at,ht,_t,mt,ft,ut,H,O,ot,pt,vt,xt,Mt,ct,St,It,dt;Q=t.x,at=t.y,ht=t.z,_t=e.x,mt=e.y,ft=e.z,ut=n.x,H=n.y,O=n.z,ot=_t-Q,pt=mt-at,vt=ft-ht,xt=ut-_t,Mt=H-mt,ct=O-ft,St=Q-ut,It=at-H,dt=ht-O;let K,lt,rt;K=pt*ct-vt*Mt,lt=vt*xt-ot*ct,rt=ot*Mt-pt*xt;let Vt,At,Yt,Xt,Nt,ie,ee,Ze,ze;Vt=pt*rt-vt*lt,At=vt*K-ot*rt,Yt=ot*lt-pt*K,Xt=Mt*rt-ct*lt,Nt=ct*K-xt*rt,ie=xt*lt-Mt*K,ee=It*rt-dt*lt,Ze=dt*K-St*rt,ze=St*lt-It*K;let pe=-1,$t,Ht,ue,Ie=0;if($t=0,Ht=0,ue=0,Q*Vt+at*At+ht*Yt<0){let Ut,nt,gt,yt,bt,st;Ut=t.x,nt=t.y,gt=t.z,yt=e.x,bt=e.y,st=e.z;let Pt,Dt,N;Pt=yt-Ut,Dt=bt-nt,N=st-gt;let kt=Pt*Ut+Dt*nt+N*gt;kt=-kt/(Pt*Pt+Dt*Dt+N*N);let Rt;if(kt<0)s.x=Ut,s.y=nt,s.z=gt,Rt=1;else if(kt>1)s.x=yt,s.y=bt,s.z=st,Rt=2;else{let Ot,Wt,Bt;Ot=Ut+Pt*kt,Wt=nt+Dt*kt,Bt=gt+N*kt,s.x=Ot,s.y=Wt,s.z=Bt,Rt=3}Ie=Rt,pe=s.x*s.x+s.y*s.y+s.z*s.z,$t=s.x,Ht=s.y,ue=s.z}if(_t*Xt+mt*Nt+ft*ie<0){let Ut,nt,gt,yt,bt,st;Ut=e.x,nt=e.y,gt=e.z,yt=n.x,bt=n.y,st=n.z;let Pt,Dt,N;Pt=yt-Ut,Dt=bt-nt,N=st-gt;let kt=Pt*Ut+Dt*nt+N*gt;kt=-kt/(Pt*Pt+Dt*Dt+N*N);let Rt;if(kt<0)s.x=Ut,s.y=nt,s.z=gt,Rt=1;else if(kt>1)s.x=yt,s.y=bt,s.z=st,Rt=2;else{let Wt,Bt,re;Wt=Ut+Pt*kt,Bt=nt+Dt*kt,re=gt+N*kt,s.x=Wt,s.y=Bt,s.z=re,Rt=3}let Ot=s.x*s.x+s.y*s.y+s.z*s.z;(pe<0||Ot<pe)&&(Ie=Rt<<1,pe=Ot,$t=s.x,Ht=s.y,ue=s.z)}if(ut*ee+H*Ze+O*ze<0){let Ut,nt,gt,yt,bt,st;Ut=t.x,nt=t.y,gt=t.z,yt=n.x,bt=n.y,st=n.z;let Pt,Dt,N;Pt=yt-Ut,Dt=bt-nt,N=st-gt;let kt=Pt*Ut+Dt*nt+N*gt;kt=-kt/(Pt*Pt+Dt*Dt+N*N);let Rt;if(kt<0)s.x=Ut,s.y=nt,s.z=gt,Rt=1;else if(kt>1)s.x=yt,s.y=bt,s.z=st,Rt=2;else{let Wt,Bt,re;Wt=Ut+Pt*kt,Bt=nt+Dt*kt,re=gt+N*kt,s.x=Wt,s.y=Bt,s.z=re,Rt=3}let Ot=s.x*s.x+s.y*s.y+s.z*s.z;(pe<0||Ot<pe)&&(Ie=Rt&1|(Rt&2)<<1,pe=Ot,$t=s.x,Ht=s.y,ue=s.z)}let qe;if(pe>0)s.x=$t,s.y=Ht,s.z=ue,qe=Ie;else{let Ut=K*K+lt*lt+rt*rt;Ut>0&&(Ut=1/Math.sqrt(Ut)),K*=Ut,lt*=Ut,rt*=Ut;let nt=K*K+lt*lt+rt*rt;nt=(Q*K+at*lt+ht*rt)/nt,$t=K*nt,Ht=lt*nt,ue=rt*nt,s.x=$t,s.y=Ht,s.z=ue,qe=7}let Ee=s.x*s.x+s.y*s.y+s.z*s.z;(q<0||Ee<q)&&(it=qe&3|(qe&4)<<1,q=Ee,tt=s.x,W=s.y,U=s.z)}if((a*D+l*et+h*$)*j<0){let Q,at,ht,_t,mt,ft,ut,H,O,ot,pt,vt,xt,Mt,ct,St,It,dt;Q=e.x,at=e.y,ht=e.z,_t=i.x,mt=i.y,ft=i.z,ut=n.x,H=n.y,O=n.z,ot=_t-Q,pt=mt-at,vt=ft-ht,xt=ut-_t,Mt=H-mt,ct=O-ft,St=Q-ut,It=at-H,dt=ht-O;let K,lt,rt;K=pt*ct-vt*Mt,lt=vt*xt-ot*ct,rt=ot*Mt-pt*xt;let Vt,At,Yt,Xt,Nt,ie,ee,Ze,ze;Vt=pt*rt-vt*lt,At=vt*K-ot*rt,Yt=ot*lt-pt*K,Xt=Mt*rt-ct*lt,Nt=ct*K-xt*rt,ie=xt*lt-Mt*K,ee=It*rt-dt*lt,Ze=dt*K-St*rt,ze=St*lt-It*K;let pe=-1,$t,Ht,ue,Ie=0;if($t=0,Ht=0,ue=0,Q*Vt+at*At+ht*Yt<0){let Ut,nt,gt,yt,bt,st;Ut=e.x,nt=e.y,gt=e.z,yt=i.x,bt=i.y,st=i.z;let Pt,Dt,N;Pt=yt-Ut,Dt=bt-nt,N=st-gt;let kt=Pt*Ut+Dt*nt+N*gt;kt=-kt/(Pt*Pt+Dt*Dt+N*N);let Rt;if(kt<0)s.x=Ut,s.y=nt,s.z=gt,Rt=1;else if(kt>1)s.x=yt,s.y=bt,s.z=st,Rt=2;else{let Ot,Wt,Bt;Ot=Ut+Pt*kt,Wt=nt+Dt*kt,Bt=gt+N*kt,s.x=Ot,s.y=Wt,s.z=Bt,Rt=3}Ie=Rt,pe=s.x*s.x+s.y*s.y+s.z*s.z,$t=s.x,Ht=s.y,ue=s.z}if(_t*Xt+mt*Nt+ft*ie<0){let Ut,nt,gt,yt,bt,st;Ut=i.x,nt=i.y,gt=i.z,yt=n.x,bt=n.y,st=n.z;let Pt,Dt,N;Pt=yt-Ut,Dt=bt-nt,N=st-gt;let kt=Pt*Ut+Dt*nt+N*gt;kt=-kt/(Pt*Pt+Dt*Dt+N*N);let Rt;if(kt<0)s.x=Ut,s.y=nt,s.z=gt,Rt=1;else if(kt>1)s.x=yt,s.y=bt,s.z=st,Rt=2;else{let Wt,Bt,re;Wt=Ut+Pt*kt,Bt=nt+Dt*kt,re=gt+N*kt,s.x=Wt,s.y=Bt,s.z=re,Rt=3}let Ot=s.x*s.x+s.y*s.y+s.z*s.z;(pe<0||Ot<pe)&&(Ie=Rt<<1,pe=Ot,$t=s.x,Ht=s.y,ue=s.z)}if(ut*ee+H*Ze+O*ze<0){let Ut,nt,gt,yt,bt,st;Ut=e.x,nt=e.y,gt=e.z,yt=n.x,bt=n.y,st=n.z;let Pt,Dt,N;Pt=yt-Ut,Dt=bt-nt,N=st-gt;let kt=Pt*Ut+Dt*nt+N*gt;kt=-kt/(Pt*Pt+Dt*Dt+N*N);let Rt;if(kt<0)s.x=Ut,s.y=nt,s.z=gt,Rt=1;else if(kt>1)s.x=yt,s.y=bt,s.z=st,Rt=2;else{let Wt,Bt,re;Wt=Ut+Pt*kt,Bt=nt+Dt*kt,re=gt+N*kt,s.x=Wt,s.y=Bt,s.z=re,Rt=3}let Ot=s.x*s.x+s.y*s.y+s.z*s.z;(pe<0||Ot<pe)&&(Ie=Rt&1|(Rt&2)<<1,pe=Ot,$t=s.x,Ht=s.y,ue=s.z)}let qe;if(pe>0)s.x=$t,s.y=Ht,s.z=ue,qe=Ie;else{let Ut=K*K+lt*lt+rt*rt;Ut>0&&(Ut=1/Math.sqrt(Ut)),K*=Ut,lt*=Ut,rt*=Ut;let nt=K*K+lt*lt+rt*rt;nt=(Q*K+at*lt+ht*rt)/nt,$t=K*nt,Ht=lt*nt,ue=rt*nt,s.x=$t,s.y=Ht,s.z=ue,qe=7}let Ee=s.x*s.x+s.y*s.y+s.z*s.z;(q<0||Ee<q)&&(it=qe<<1,q=Ee,tt=s.x,W=s.y,U=s.z)}return q>0?(s.x=tt,s.y=W,s.z=U,it):(s.zero(),15)}};y.common.Mat3=class{constructor(t,e,i,n,s,o,r,_,a){a==null&&(a=1),_==null&&(_=0),r==null&&(r=0),o==null&&(o=0),s==null&&(s=1),n==null&&(n=0),i==null&&(i=0),e==null&&(e=0),t==null&&(t=1),this.e00=t,this.e01=e,this.e02=i,this.e10=n,this.e11=s,this.e12=o,this.e20=r,this.e21=_,this.e22=a,y.common.Mat3.numCreations++}init(t,e,i,n,s,o,r,_,a){return this.e00=t,this.e01=e,this.e02=i,this.e10=n,this.e11=s,this.e12=o,this.e20=r,this.e21=_,this.e22=a,this}identity(){return this.e00=1,this.e01=0,this.e02=0,this.e10=0,this.e11=1,this.e12=0,this.e20=0,this.e21=0,this.e22=1,this}add(t){return new y.common.Mat3(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22)}sub(t){return new y.common.Mat3(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22)}scale(t){return new y.common.Mat3(this.e00*t,this.e01*t,this.e02*t,this.e10*t,this.e11*t,this.e12*t,this.e20*t,this.e21*t,this.e22*t)}mul(t){return new y.common.Mat3(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22)}addEq(t){return this.e00+=t.e00,this.e01+=t.e01,this.e02+=t.e02,this.e10+=t.e10,this.e11+=t.e11,this.e12+=t.e12,this.e20+=t.e20,this.e21+=t.e21,this.e22+=t.e22,this}subEq(t){return this.e00-=t.e00,this.e01-=t.e01,this.e02-=t.e02,this.e10-=t.e10,this.e11-=t.e11,this.e12-=t.e12,this.e20-=t.e20,this.e21-=t.e21,this.e22-=t.e22,this}scaleEq(t){return this.e00*=t,this.e01*=t,this.e02*=t,this.e10*=t,this.e11*=t,this.e12*=t,this.e20*=t,this.e21*=t,this.e22*=t,this}mulEq(t){let e=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,i=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,n=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,s=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,o=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,r=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,_=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,a=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22;return this.e00=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,this.e01=e,this.e02=i,this.e10=n,this.e11=s,this.e12=o,this.e20=r,this.e21=_,this.e22=a,this}prependScale(t,e,i){return new y.common.Mat3(this.e00*t,this.e01*t,this.e02*t,this.e10*e,this.e11*e,this.e12*e,this.e20*i,this.e21*i,this.e22*i)}appendScale(t,e,i){return new y.common.Mat3(this.e00*t,this.e01*e,this.e02*i,this.e10*t,this.e11*e,this.e12*i,this.e20*t,this.e21*e,this.e22*i)}prependRotation(t,e,i,n){let s=Math.sin(t),o=Math.cos(t),r=1-o,_=e*e*r+o,a=e*i*r-n*s,l=e*n*r+i*s,h=i*e*r+n*s,m=i*i*r+o,f=i*n*r-e*s,p=n*e*r-i*s,d=n*i*r+e*s,u=n*n*r+o;return new y.common.Mat3(_*this.e00+a*this.e10+l*this.e20,_*this.e01+a*this.e11+l*this.e21,_*this.e02+a*this.e12+l*this.e22,h*this.e00+m*this.e10+f*this.e20,h*this.e01+m*this.e11+f*this.e21,h*this.e02+m*this.e12+f*this.e22,p*this.e00+d*this.e10+u*this.e20,p*this.e01+d*this.e11+u*this.e21,p*this.e02+d*this.e12+u*this.e22)}appendRotation(t,e,i,n){let s=Math.sin(t),o=Math.cos(t),r=1-o,_=e*e*r+o,a=e*i*r-n*s,l=e*n*r+i*s,h=i*e*r+n*s,m=i*i*r+o,f=i*n*r-e*s,p=n*e*r-i*s,d=n*i*r+e*s,u=n*n*r+o;return new y.common.Mat3(this.e00*_+this.e01*h+this.e02*p,this.e00*a+this.e01*m+this.e02*d,this.e00*l+this.e01*f+this.e02*u,this.e10*_+this.e11*h+this.e12*p,this.e10*a+this.e11*m+this.e12*d,this.e10*l+this.e11*f+this.e12*u,this.e20*_+this.e21*h+this.e22*p,this.e20*a+this.e21*m+this.e22*d,this.e20*l+this.e21*f+this.e22*u)}prependScaleEq(t,e,i){return this.e00*=t,this.e01*=t,this.e02*=t,this.e10*=e,this.e11*=e,this.e12*=e,this.e20*=i,this.e21*=i,this.e22*=i,this}appendScaleEq(t,e,i){return this.e00*=t,this.e01*=e,this.e02*=i,this.e10*=t,this.e11*=e,this.e12*=i,this.e20*=t,this.e21*=e,this.e22*=i,this}prependRotationEq(t,e,i,n){let s=Math.sin(t),o=Math.cos(t),r=1-o,_=e*e*r+o,a=e*i*r-n*s,l=e*n*r+i*s,h=i*e*r+n*s,m=i*i*r+o,f=i*n*r-e*s,p=n*e*r-i*s,d=n*i*r+e*s,u=n*n*r+o,g=h*this.e00+m*this.e10+f*this.e20,v=h*this.e01+m*this.e11+f*this.e21,x=h*this.e02+m*this.e12+f*this.e22,b=p*this.e00+d*this.e10+u*this.e20,Y=p*this.e01+d*this.e11+u*this.e21,w=p*this.e02+d*this.e12+u*this.e22;return this.e00=_*this.e00+a*this.e10+l*this.e20,this.e01=_*this.e01+a*this.e11+l*this.e21,this.e02=_*this.e02+a*this.e12+l*this.e22,this.e10=g,this.e11=v,this.e12=x,this.e20=b,this.e21=Y,this.e22=w,this}appendRotationEq(t,e,i,n){let s=Math.sin(t),o=Math.cos(t),r=1-o,_=e*e*r+o,a=e*i*r-n*s,l=e*n*r+i*s,h=i*e*r+n*s,m=i*i*r+o,f=i*n*r-e*s,p=n*e*r-i*s,d=n*i*r+e*s,u=n*n*r+o,g=this.e00*a+this.e01*m+this.e02*d,v=this.e00*l+this.e01*f+this.e02*u,x=this.e10*a+this.e11*m+this.e12*d,b=this.e10*l+this.e11*f+this.e12*u,Y=this.e20*a+this.e21*m+this.e22*d,w=this.e20*l+this.e21*f+this.e22*u;return this.e00=this.e00*_+this.e01*h+this.e02*p,this.e01=g,this.e02=v,this.e10=this.e10*_+this.e11*h+this.e12*p,this.e11=x,this.e12=b,this.e20=this.e20*_+this.e21*h+this.e22*p,this.e21=Y,this.e22=w,this}transpose(){return new y.common.Mat3(this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22)}transposeEq(){let t=this.e01,e=this.e02,i=this.e12;return this.e01=this.e10,this.e02=this.e20,this.e10=t,this.e12=this.e21,this.e20=e,this.e21=i,this}determinant(){return this.e00*(this.e11*this.e22-this.e12*this.e21)-this.e01*(this.e10*this.e22-this.e12*this.e20)+this.e02*(this.e10*this.e21-this.e11*this.e20)}trace(){return this.e00+this.e11+this.e22}inverse(){let t=this.e11*this.e22-this.e12*this.e21,e=this.e10*this.e22-this.e12*this.e20,i=this.e10*this.e21-this.e11*this.e20,n=this.e00*t-this.e01*e+this.e02*i;return n!=0&&(n=1/n),new y.common.Mat3(t*n,-(this.e01*this.e22-this.e02*this.e21)*n,(this.e01*this.e12-this.e02*this.e11)*n,-e*n,(this.e00*this.e22-this.e02*this.e20)*n,-(this.e00*this.e12-this.e02*this.e10)*n,i*n,-(this.e00*this.e21-this.e01*this.e20)*n,(this.e00*this.e11-this.e01*this.e10)*n)}inverseEq(){let t=this.e11*this.e22-this.e12*this.e21,e=this.e10*this.e22-this.e12*this.e20,i=this.e10*this.e21-this.e11*this.e20,n=this.e00*t-this.e01*e+this.e02*i;n!=0&&(n=1/n);let s=(this.e01*this.e12-this.e02*this.e11)*n,o=(this.e00*this.e22-this.e02*this.e20)*n,r=-(this.e00*this.e12-this.e02*this.e10)*n,_=-(this.e00*this.e21-this.e01*this.e20)*n,a=(this.e00*this.e11-this.e01*this.e10)*n;return this.e00=t*n,this.e01=-(this.e01*this.e22-this.e02*this.e21)*n,this.e02=s,this.e10=-e*n,this.e11=o,this.e12=r,this.e20=i*n,this.e21=_,this.e22=a,this}toArray(t){return t==null&&(t=!1),t?[this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22]:[this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22]}copyFrom(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this}clone(){return new y.common.Mat3(this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22)}fromQuat(t){let e=t.x,i=t.y,n=t.z,s=t.w,o=2*e,r=2*i,_=2*n,a=e*o,l=i*r,h=n*_,m=e*r,f=i*_,p=e*_,d=s*o,u=s*r,g=s*_;return this.e00=1-l-h,this.e01=m-g,this.e02=p+u,this.e10=m+g,this.e11=1-a-h,this.e12=f-d,this.e20=p-u,this.e21=f+d,this.e22=1-a-l,this}toQuat(){let t=new y.common.Quat,e=this.e00,i=this.e11,n=this.e22,s=e+i+n,o;return s>0?(o=Math.sqrt(s+1),t.w=.5*o,o=.5/o,t.x=(this.e21-this.e12)*o,t.y=(this.e02-this.e20)*o,t.z=(this.e10-this.e01)*o):e>i?e>n?(o=Math.sqrt(e-i-n+1),t.x=.5*o,o=.5/o,t.y=(this.e01+this.e10)*o,t.z=(this.e02+this.e20)*o,t.w=(this.e21-this.e12)*o):(o=Math.sqrt(n-e-i+1),t.z=.5*o,o=.5/o,t.x=(this.e02+this.e20)*o,t.y=(this.e12+this.e21)*o,t.w=(this.e10-this.e01)*o):i>n?(o=Math.sqrt(i-n-e+1),t.y=.5*o,o=.5/o,t.x=(this.e01+this.e10)*o,t.z=(this.e12+this.e21)*o,t.w=(this.e02-this.e20)*o):(o=Math.sqrt(n-e-i+1),t.z=.5*o,o=.5/o,t.x=(this.e02+this.e20)*o,t.y=(this.e12+this.e21)*o,t.w=(this.e10-this.e01)*o),t}fromEulerXyz(t){let e=Math.sin(t.x),i=Math.sin(t.y),n=Math.sin(t.z),s=Math.cos(t.x),o=Math.cos(t.y),r=Math.cos(t.z);return this.e00=o*r,this.e01=-o*n,this.e02=i,this.e10=s*n+r*e*i,this.e11=s*r-e*i*n,this.e12=-o*e,this.e20=e*n-s*r*i,this.e21=r*e+s*i*n,this.e22=s*o,this}toEulerXyz(){let t=this.e02;if(t<=-1){let e=Math.atan2(this.e21,this.e11);return new y.common.Vec3(e*.5,-1.570796326794895,-e*.5)}if(t>=1){let e=Math.atan2(this.e21,this.e11);return new y.common.Vec3(e*.5,1.570796326794895,e*.5)}return new y.common.Vec3(Math.atan2(-this.e12,this.e22),Math.asin(t),Math.atan2(-this.e01,this.e00))}getRow(t){return t==0?new y.common.Vec3(this.e00,this.e01,this.e02):t==1?new y.common.Vec3(this.e10,this.e11,this.e12):t==2?new y.common.Vec3(this.e20,this.e21,this.e22):null}getCol(t){return t==0?new y.common.Vec3(this.e00,this.e10,this.e20):t==1?new y.common.Vec3(this.e01,this.e11,this.e21):t==2?new y.common.Vec3(this.e02,this.e12,this.e22):null}getRowTo(t,e){t==0?e.init(this.e00,this.e01,this.e02):t==1?e.init(this.e10,this.e11,this.e12):t==2?e.init(this.e20,this.e21,this.e22):e.zero()}getColTo(t,e){t==0?e.init(this.e00,this.e10,this.e20):t==1?e.init(this.e01,this.e11,this.e21):t==2?e.init(this.e02,this.e12,this.e22):e.zero()}fromRows(t,e,i){return this.e00=t.x,this.e01=t.y,this.e02=t.z,this.e10=e.x,this.e11=e.y,this.e12=e.z,this.e20=i.x,this.e21=i.y,this.e22=i.z,this}fromCols(t,e,i){return this.e00=t.x,this.e01=e.x,this.e02=i.x,this.e10=t.y,this.e11=e.y,this.e12=i.y,this.e20=t.z,this.e21=e.z,this.e22=i.z,this}toString(){return"Mat3["+(this.e00>0?(this.e00*1e7+.5|0)/1e7:(this.e00*1e7-.5|0)/1e7)+", "+(this.e01>0?(this.e01*1e7+.5|0)/1e7:(this.e01*1e7-.5|0)/1e7)+", "+(this.e02>0?(this.e02*1e7+.5|0)/1e7:(this.e02*1e7-.5|0)/1e7)+`,
     `+(this.e10>0?(this.e10*1e7+.5|0)/1e7:(this.e10*1e7-.5|0)/1e7)+", "+(this.e11>0?(this.e11*1e7+.5|0)/1e7:(this.e11*1e7-.5|0)/1e7)+", "+(this.e12>0?(this.e12*1e7+.5|0)/1e7:(this.e12*1e7-.5|0)/1e7)+`,
     `+(this.e20>0?(this.e20*1e7+.5|0)/1e7:(this.e20*1e7-.5|0)/1e7)+", "+(this.e21>0?(this.e21*1e7+.5|0)/1e7:(this.e21*1e7-.5|0)/1e7)+", "+(this.e22>0?(this.e22*1e7+.5|0)/1e7:(this.e22*1e7-.5|0)/1e7)+"]"}};y.common.Mat4=class{constructor(t,e,i,n,s,o,r,_,a,l,h,m,f,p,d,u){u==null&&(u=1),d==null&&(d=0),p==null&&(p=0),f==null&&(f=0),m==null&&(m=0),h==null&&(h=1),l==null&&(l=0),a==null&&(a=0),_==null&&(_=0),r==null&&(r=0),o==null&&(o=1),s==null&&(s=0),n==null&&(n=0),i==null&&(i=0),e==null&&(e=0),t==null&&(t=1),this.e00=t,this.e01=e,this.e02=i,this.e03=n,this.e10=s,this.e11=o,this.e12=r,this.e13=_,this.e20=a,this.e21=l,this.e22=h,this.e23=m,this.e30=f,this.e31=p,this.e32=d,this.e33=u,y.common.Mat4.numCreations++}init(t,e,i,n,s,o,r,_,a,l,h,m,f,p,d,u){return this.e00=t,this.e01=e,this.e02=i,this.e03=n,this.e10=s,this.e11=o,this.e12=r,this.e13=_,this.e20=a,this.e21=l,this.e22=h,this.e23=m,this.e30=f,this.e31=p,this.e32=d,this.e33=u,this}identity(){return this.e00=1,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=1,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=1,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}add(t){return new y.common.Mat4(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e03+t.e03,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e13+t.e13,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22,this.e23+t.e23,this.e30+t.e30,this.e31+t.e31,this.e32+t.e32,this.e33+t.e33)}sub(t){return new y.common.Mat4(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e03-t.e03,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e13-t.e13,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22,this.e23-t.e23,this.e30-t.e30,this.e31-t.e31,this.e32-t.e32,this.e33-t.e33)}scale(t){return new y.common.Mat4(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*t,this.e11*t,this.e12*t,this.e13*t,this.e20*t,this.e21*t,this.e22*t,this.e23*t,this.e30*t,this.e31*t,this.e32*t,this.e33*t)}mul(t){return new y.common.Mat4(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33)}addEq(t){return this.e00+=t.e00,this.e01+=t.e01,this.e02+=t.e02,this.e03+=t.e03,this.e10+=t.e10,this.e11+=t.e11,this.e12+=t.e12,this.e13+=t.e13,this.e20+=t.e20,this.e21+=t.e21,this.e22+=t.e22,this.e23+=t.e23,this.e30+=t.e30,this.e31+=t.e31,this.e32+=t.e32,this.e33+=t.e33,this}subEq(t){return this.e00-=t.e00,this.e01-=t.e01,this.e02-=t.e02,this.e03-=t.e03,this.e10-=t.e10,this.e11-=t.e11,this.e12-=t.e12,this.e13-=t.e13,this.e20-=t.e20,this.e21-=t.e21,this.e22-=t.e22,this.e23-=t.e23,this.e30-=t.e30,this.e31-=t.e31,this.e32-=t.e32,this.e33-=t.e33,this}scaleEq(t){return this.e00*=t,this.e01*=t,this.e02*=t,this.e03*=t,this.e10*=t,this.e11*=t,this.e12*=t,this.e13*=t,this.e20*=t,this.e21*=t,this.e22*=t,this.e23*=t,this.e30*=t,this.e31*=t,this.e32*=t,this.e33*=t,this}mulEq(t){let e=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,i=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,n=this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,s=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,o=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,r=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,_=this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,a=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,l=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,h=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,m=this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,f=this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,p=this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,d=this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,u=this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33;return this.e00=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,this.e01=e,this.e02=i,this.e03=n,this.e10=s,this.e11=o,this.e12=r,this.e13=_,this.e20=a,this.e21=l,this.e22=h,this.e23=m,this.e30=f,this.e31=p,this.e32=d,this.e33=u,this}prependScale(t,e,i){return new y.common.Mat4(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*e,this.e11*e,this.e12*e,this.e13*e,this.e20*i,this.e21*i,this.e22*i,this.e23*i,this.e30,this.e31,this.e32,this.e33)}appendScale(t,e,i){return new y.common.Mat4(this.e00*t,this.e01*e,this.e02*i,this.e03,this.e10*t,this.e11*e,this.e12*i,this.e13,this.e20*t,this.e21*e,this.e22*i,this.e23,this.e30*t,this.e31*e,this.e32*i,this.e33)}prependRotation(t,e,i,n){let s=Math.sin(t),o=Math.cos(t),r=1-o,_=e*e*r+o,a=e*i*r-n*s,l=e*n*r+i*s,h=i*e*r+n*s,m=i*i*r+o,f=i*n*r-e*s,p=n*e*r-i*s,d=n*i*r+e*s,u=n*n*r+o;return new y.common.Mat4(_*this.e00+a*this.e10+l*this.e20,_*this.e01+a*this.e11+l*this.e21,_*this.e02+a*this.e12+l*this.e22,_*this.e03+a*this.e13+l*this.e23,h*this.e00+m*this.e10+f*this.e20,h*this.e01+m*this.e11+f*this.e21,h*this.e02+m*this.e12+f*this.e22,h*this.e03+m*this.e13+f*this.e23,p*this.e00+d*this.e10+u*this.e20,p*this.e01+d*this.e11+u*this.e21,p*this.e02+d*this.e12+u*this.e22,p*this.e03+d*this.e13+u*this.e23,this.e30,this.e31,this.e32,this.e33)}appendRotation(t,e,i,n){let s=Math.sin(t),o=Math.cos(t),r=1-o,_=e*e*r+o,a=e*i*r-n*s,l=e*n*r+i*s,h=i*e*r+n*s,m=i*i*r+o,f=i*n*r-e*s,p=n*e*r-i*s,d=n*i*r+e*s,u=n*n*r+o;return new y.common.Mat4(this.e00*_+this.e01*h+this.e02*p,this.e00*a+this.e01*m+this.e02*d,this.e00*l+this.e01*f+this.e02*u,this.e03,this.e10*_+this.e11*h+this.e12*p,this.e10*a+this.e11*m+this.e12*d,this.e10*l+this.e11*f+this.e12*u,this.e13,this.e20*_+this.e21*h+this.e22*p,this.e20*a+this.e21*m+this.e22*d,this.e20*l+this.e21*f+this.e22*u,this.e23,this.e30*_+this.e31*h+this.e32*p,this.e30*a+this.e31*m+this.e32*d,this.e30*l+this.e31*f+this.e32*u,this.e33)}prependTranslation(t,e,i){return new y.common.Mat4(this.e00+t*this.e30,this.e01+t*this.e31,this.e02+t*this.e32,this.e03+t*this.e33,this.e10+e*this.e30,this.e11+e*this.e31,this.e12+e*this.e32,this.e13+e*this.e33,this.e20+i*this.e30,this.e21+i*this.e31,this.e22+i*this.e32,this.e23+i*this.e33,this.e30,this.e31,this.e32,this.e33)}appendTranslation(t,e,i){return new y.common.Mat4(this.e00,this.e01,this.e02,this.e00*t+this.e01*e+this.e02*i+this.e03,this.e10,this.e11,this.e12,this.e10*t+this.e11*e+this.e12*i+this.e13,this.e20,this.e21,this.e22,this.e20*t+this.e21*e+this.e22*i+this.e23,this.e30,this.e31,this.e32,this.e30*t+this.e31*e+this.e32*i+this.e33)}prependScaleEq(t,e,i){return this.e00*=t,this.e01*=t,this.e02*=t,this.e03*=t,this.e10*=e,this.e11*=e,this.e12*=e,this.e13*=e,this.e20*=i,this.e21*=i,this.e22*=i,this.e23*=i,this}appendScaleEq(t,e,i){return this.e00*=t,this.e01*=e,this.e02*=i,this.e10*=t,this.e11*=e,this.e12*=i,this.e20*=t,this.e21*=e,this.e22*=i,this.e30*=t,this.e31*=e,this.e32*=i,this}prependRotationEq(t,e,i,n){let s=Math.sin(t),o=Math.cos(t),r=1-o,_=e*e*r+o,a=e*i*r-n*s,l=e*n*r+i*s,h=i*e*r+n*s,m=i*i*r+o,f=i*n*r-e*s,p=n*e*r-i*s,d=n*i*r+e*s,u=n*n*r+o,g=h*this.e00+m*this.e10+f*this.e20,v=h*this.e01+m*this.e11+f*this.e21,x=h*this.e02+m*this.e12+f*this.e22,b=h*this.e03+m*this.e13+f*this.e23,Y=p*this.e00+d*this.e10+u*this.e20,w=p*this.e01+d*this.e11+u*this.e21,Z=p*this.e02+d*this.e12+u*this.e22,X=p*this.e03+d*this.e13+u*this.e23;return this.e00=_*this.e00+a*this.e10+l*this.e20,this.e01=_*this.e01+a*this.e11+l*this.e21,this.e02=_*this.e02+a*this.e12+l*this.e22,this.e03=_*this.e03+a*this.e13+l*this.e23,this.e10=g,this.e11=v,this.e12=x,this.e13=b,this.e20=Y,this.e21=w,this.e22=Z,this.e23=X,this}appendRotationEq(t,e,i,n){let s=Math.sin(t),o=Math.cos(t),r=1-o,_=e*e*r+o,a=e*i*r-n*s,l=e*n*r+i*s,h=i*e*r+n*s,m=i*i*r+o,f=i*n*r-e*s,p=n*e*r-i*s,d=n*i*r+e*s,u=n*n*r+o,g=this.e00*a+this.e01*m+this.e02*d,v=this.e00*l+this.e01*f+this.e02*u,x=this.e10*a+this.e11*m+this.e12*d,b=this.e10*l+this.e11*f+this.e12*u,Y=this.e20*a+this.e21*m+this.e22*d,w=this.e20*l+this.e21*f+this.e22*u,Z=this.e30*a+this.e31*m+this.e32*d,X=this.e30*l+this.e31*f+this.e32*u;return this.e00=this.e00*_+this.e01*h+this.e02*p,this.e01=g,this.e02=v,this.e10=this.e10*_+this.e11*h+this.e12*p,this.e11=x,this.e12=b,this.e20=this.e20*_+this.e21*h+this.e22*p,this.e21=Y,this.e22=w,this.e30=this.e30*_+this.e31*h+this.e32*p,this.e31=Z,this.e32=X,this}prependTranslationEq(t,e,i){return this.e00+=t*this.e30,this.e01+=t*this.e31,this.e02+=t*this.e32,this.e03+=t*this.e33,this.e10+=e*this.e30,this.e11+=e*this.e31,this.e12+=e*this.e32,this.e13+=e*this.e33,this.e20+=i*this.e30,this.e21+=i*this.e31,this.e22+=i*this.e32,this.e23+=i*this.e33,this}appendTranslationEq(t,e,i){let n=this.e00*t+this.e01*e+this.e02*i+this.e03,s=this.e10*t+this.e11*e+this.e12*i+this.e13,o=this.e20*t+this.e21*e+this.e22*i+this.e23,r=this.e30*t+this.e31*e+this.e32*i+this.e33;return this.e03=n,this.e13=s,this.e23=o,this.e33=r,this}transpose(){return new y.common.Mat4(this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33)}transposeEq(){let t=this.e01,e=this.e02,i=this.e12,n=this.e03,s=this.e13,o=this.e23;return this.e01=this.e10,this.e02=this.e20,this.e03=this.e30,this.e10=t,this.e12=this.e21,this.e13=this.e31,this.e20=e,this.e21=i,this.e23=this.e32,this.e30=n,this.e31=s,this.e32=o,this}determinant(){let t=this.e20*this.e31-this.e21*this.e30,e=this.e20*this.e32-this.e22*this.e30,i=this.e20*this.e33-this.e23*this.e30,n=this.e21*this.e32-this.e22*this.e31,s=this.e21*this.e33-this.e23*this.e31,o=this.e22*this.e33-this.e23*this.e32;return this.e00*(this.e11*o-this.e12*s+this.e13*n)-this.e01*(this.e10*o-this.e12*i+this.e13*e)+this.e02*(this.e10*s-this.e11*i+this.e13*t)-this.e03*(this.e10*n-this.e11*e+this.e12*t)}trace(){return this.e00+this.e11+this.e22+this.e33}inverse(){let t=this.e00*this.e11-this.e01*this.e10,e=this.e00*this.e12-this.e02*this.e10,i=this.e00*this.e13-this.e03*this.e10,n=this.e01*this.e12-this.e02*this.e11,s=this.e01*this.e13-this.e03*this.e11,o=this.e02*this.e13-this.e03*this.e12,r=this.e20*this.e31-this.e21*this.e30,_=this.e20*this.e32-this.e22*this.e30,a=this.e20*this.e33-this.e23*this.e30,l=this.e21*this.e32-this.e22*this.e31,h=this.e21*this.e33-this.e23*this.e31,m=this.e22*this.e33-this.e23*this.e32,f=this.e11*m-this.e12*h+this.e13*l,p=this.e10*m-this.e12*a+this.e13*_,d=this.e10*h-this.e11*a+this.e13*r,u=this.e10*l-this.e11*_+this.e12*r,g=this.e00*f-this.e01*p+this.e02*d-this.e03*u;return g!=0&&(g=1/g),new y.common.Mat4(f*g,-(this.e01*m-this.e02*h+this.e03*l)*g,(this.e31*o-this.e32*s+this.e33*n)*g,-(this.e21*o-this.e22*s+this.e23*n)*g,-p*g,(this.e00*m-this.e02*a+this.e03*_)*g,-(this.e30*o-this.e32*i+this.e33*e)*g,(this.e20*o-this.e22*i+this.e23*e)*g,d*g,-(this.e00*h-this.e01*a+this.e03*r)*g,(this.e30*s-this.e31*i+this.e33*t)*g,-(this.e20*s-this.e21*i+this.e23*t)*g,-u*g,(this.e00*l-this.e01*_+this.e02*r)*g,-(this.e30*n-this.e31*e+this.e32*t)*g,(this.e20*n-this.e21*e+this.e22*t)*g)}inverseEq(){let t=this.e00*this.e11-this.e01*this.e10,e=this.e00*this.e12-this.e02*this.e10,i=this.e00*this.e13-this.e03*this.e10,n=this.e01*this.e12-this.e02*this.e11,s=this.e01*this.e13-this.e03*this.e11,o=this.e02*this.e13-this.e03*this.e12,r=this.e20*this.e31-this.e21*this.e30,_=this.e20*this.e32-this.e22*this.e30,a=this.e20*this.e33-this.e23*this.e30,l=this.e21*this.e32-this.e22*this.e31,h=this.e21*this.e33-this.e23*this.e31,m=this.e22*this.e33-this.e23*this.e32,f=this.e11*m-this.e12*h+this.e13*l,p=this.e10*m-this.e12*a+this.e13*_,d=this.e10*h-this.e11*a+this.e13*r,u=this.e10*l-this.e11*_+this.e12*r,g=this.e00*f-this.e01*p+this.e02*d-this.e03*u;g!=0&&(g=1/g);let v=(this.e00*m-this.e02*a+this.e03*_)*g,x=-(this.e00*h-this.e01*a+this.e03*r)*g,b=-(this.e20*s-this.e21*i+this.e23*t)*g,Y=(this.e00*l-this.e01*_+this.e02*r)*g,w=-(this.e30*n-this.e31*e+this.e32*t)*g,Z=(this.e20*n-this.e21*e+this.e22*t)*g;return this.e00=f*g,this.e01=-(this.e01*m-this.e02*h+this.e03*l)*g,this.e02=(this.e31*o-this.e32*s+this.e33*n)*g,this.e03=-(this.e21*o-this.e22*s+this.e23*n)*g,this.e10=-p*g,this.e11=v,this.e12=-(this.e30*o-this.e32*i+this.e33*e)*g,this.e13=(this.e20*o-this.e22*i+this.e23*e)*g,this.e20=d*g,this.e21=x,this.e22=(this.e30*s-this.e31*i+this.e33*t)*g,this.e23=b,this.e30=-u*g,this.e31=Y,this.e32=w,this.e33=Z,this}lookAt(t,e,i,n,s,o,r,_,a){let l=t-n,h=e-s,m=i-o,f=1/Math.sqrt(l*l+h*h+m*m);l*=f,h*=f,m*=f;let p=_*m-a*h,d=a*l-r*m,u=r*h-_*l;f=1/Math.sqrt(p*p+d*d+u*u),p*=f,d*=f,u*=f;let g=h*u-m*d,v=m*p-l*u,x=l*d-h*p;return this.e00=p,this.e01=d,this.e02=u,this.e03=-(p*t+d*e+u*i),this.e10=g,this.e11=v,this.e12=x,this.e13=-(g*t+v*e+x*i),this.e20=l,this.e21=h,this.e22=m,this.e23=-(l*t+h*e+m*i),this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}perspective(t,e,i,n){let s=1/Math.tan(t*.5),o=n/(i-n);return this.e00=s/e,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=s,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=o,this.e23=i*o,this.e30=0,this.e31=0,this.e32=-1,this.e33=0,this}ortho(t,e,i,n){let s=1/(i-n);return this.e00=2/t,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=2/e,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=s,this.e23=i*s,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}toArray(t){return t==null&&(t=!1),t?[this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33]:[this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33]}copyFrom(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e03=t.e03,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e13=t.e13,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this.e23=t.e23,this.e30=t.e30,this.e31=t.e31,this.e32=t.e32,this.e33=t.e33,this}fromMat3(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e03=0,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e13=0,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}fromTransform(t){return this.e00=t._rotation00,this.e01=t._rotation01,this.e02=t._rotation02,this.e10=t._rotation10,this.e11=t._rotation11,this.e12=t._rotation12,this.e20=t._rotation20,this.e21=t._rotation21,this.e22=t._rotation22,this.e03=t._positionX,this.e13=t._positionY,this.e23=t._positionZ,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}clone(){return new y.common.Mat4(this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33)}toString(){return"Mat4["+(this.e00>0?(this.e00*1e7+.5|0)/1e7:(this.e00*1e7-.5|0)/1e7)+", "+(this.e01>0?(this.e01*1e7+.5|0)/1e7:(this.e01*1e7-.5|0)/1e7)+", "+(this.e02>0?(this.e02*1e7+.5|0)/1e7:(this.e02*1e7-.5|0)/1e7)+", "+(this.e03>0?(this.e03*1e7+.5|0)/1e7:(this.e03*1e7-.5|0)/1e7)+`,
    `+(this.e10>0?(this.e10*1e7+.5|0)/1e7:(this.e10*1e7-.5|0)/1e7)+", "+(this.e11>0?(this.e11*1e7+.5|0)/1e7:(this.e11*1e7-.5|0)/1e7)+", "+(this.e12>0?(this.e12*1e7+.5|0)/1e7:(this.e12*1e7-.5|0)/1e7)+", "+(this.e13>0?(this.e13*1e7+.5|0)/1e7:(this.e13*1e7-.5|0)/1e7)+`,
    `+(this.e20>0?(this.e20*1e7+.5|0)/1e7:(this.e20*1e7-.5|0)/1e7)+", "+(this.e21>0?(this.e21*1e7+.5|0)/1e7:(this.e21*1e7-.5|0)/1e7)+", "+(this.e22>0?(this.e22*1e7+.5|0)/1e7:(this.e22*1e7-.5|0)/1e7)+", "+(this.e23>0?(this.e23*1e7+.5|0)/1e7:(this.e23*1e7-.5|0)/1e7)+`,
    `+(this.e30>0?(this.e30*1e7+.5|0)/1e7:(this.e30*1e7-.5|0)/1e7)+", "+(this.e31>0?(this.e31*1e7+.5|0)/1e7:(this.e31*1e7-.5|0)/1e7)+", "+(this.e32>0?(this.e32*1e7+.5|0)/1e7:(this.e32*1e7-.5|0)/1e7)+", "+(this.e33>0?(this.e33*1e7+.5|0)/1e7:(this.e33*1e7-.5|0)/1e7)+"]"}};y.common.MathUtil=class{static abs(t){return t>0?t:-t}static sin(t){return Math.sin(t)}static cos(t){return Math.cos(t)}static tan(t){return Math.tan(t)}static asin(t){return Math.asin(t)}static acos(t){return Math.acos(t)}static atan(t){return Math.atan(t)}static safeAsin(t){return t<=-1?-1.570796326794895:t>=1?1.570796326794895:Math.asin(t)}static safeAcos(t){return t<=-1?3.14159265358979:t>=1?0:Math.acos(t)}static atan2(t,e){return Math.atan2(t,e)}static sqrt(t){return Math.sqrt(t)}static clamp(t,e,i){return t<e?e:t>i?i:t}static rand(){return Math.random()}static randIn(t,e){return t+Math.random()*(e-t)}static randVec3In(t,e){return new y.common.Vec3(t+Math.random()*(e-t),t+Math.random()*(e-t),t+Math.random()*(e-t))}static randVec3(){return new y.common.Vec3(-1+Math.random()*2,-1+Math.random()*2,-1+Math.random()*2)}};y.common.Pool=class{constructor(){this.stackVec3=new Array(256),this.sizeVec3=0,this.stackMat3=new Array(256),this.sizeMat3=0,this.stackMat4=new Array(256),this.sizeMat4=0,this.stackQuat=new Array(256),this.sizeQuat=0}vec3(){return this.sizeVec3==0?new y.common.Vec3:this.stackVec3[--this.sizeVec3]}mat3(){return this.sizeMat3==0?new y.common.Mat3:this.stackMat3[--this.sizeMat3]}mat4(){return this.sizeMat4==0?new y.common.Mat4:this.stackMat4[--this.sizeMat4]}quat(){return this.sizeQuat==0?new y.common.Quat:this.stackQuat[--this.sizeQuat]}dispose(t,e,i,n){if(t!=null){if(t.zero(),this.sizeVec3==this.stackVec3.length){let s=new Array(this.sizeVec3<<1),o=0,r=this.sizeVec3;for(;o<r;){let _=o++;s[_]=this.stackVec3[_],this.stackVec3[_]=null}this.stackVec3=s}this.stackVec3[this.sizeVec3++]=t}if(e!=null){if(e.e00=1,e.e01=0,e.e02=0,e.e10=0,e.e11=1,e.e12=0,e.e20=0,e.e21=0,e.e22=1,this.sizeMat3==this.stackMat3.length){let s=new Array(this.sizeMat3<<1),o=0,r=this.sizeMat3;for(;o<r;){let _=o++;s[_]=this.stackMat3[_],this.stackMat3[_]=null}this.stackMat3=s}this.stackMat3[this.sizeMat3++]=e}if(i!=null){if(i.e00=1,i.e01=0,i.e02=0,i.e03=0,i.e10=0,i.e11=1,i.e12=0,i.e13=0,i.e20=0,i.e21=0,i.e22=1,i.e23=0,i.e30=0,i.e31=0,i.e32=0,i.e33=1,this.sizeMat4==this.stackMat4.length){let s=new Array(this.sizeMat4<<1),o=0,r=this.sizeMat4;for(;o<r;){let _=o++;s[_]=this.stackMat4[_],this.stackMat4[_]=null}this.stackMat4=s}this.stackMat4[this.sizeMat4++]=i}if(n!=null){if(n.x=0,n.y=0,n.z=0,n.w=1,this.sizeQuat==this.stackQuat.length){let s=new Array(this.sizeQuat<<1),o=0,r=this.sizeQuat;for(;o<r;){let _=o++;s[_]=this.stackQuat[_],this.stackQuat[_]=null}this.stackQuat=s}this.stackQuat[this.sizeQuat++]=n}}disposeVec3(t){if(t.zero(),this.sizeVec3==this.stackVec3.length){let e=new Array(this.sizeVec3<<1),i=0,n=this.sizeVec3;for(;i<n;){let s=i++;e[s]=this.stackVec3[s],this.stackVec3[s]=null}this.stackVec3=e}this.stackVec3[this.sizeVec3++]=t}disposeMat3(t){if(t.e00=1,t.e01=0,t.e02=0,t.e10=0,t.e11=1,t.e12=0,t.e20=0,t.e21=0,t.e22=1,this.sizeMat3==this.stackMat3.length){let e=new Array(this.sizeMat3<<1),i=0,n=this.sizeMat3;for(;i<n;){let s=i++;e[s]=this.stackMat3[s],this.stackMat3[s]=null}this.stackMat3=e}this.stackMat3[this.sizeMat3++]=t}disposeMat4(t){if(t.e00=1,t.e01=0,t.e02=0,t.e03=0,t.e10=0,t.e11=1,t.e12=0,t.e13=0,t.e20=0,t.e21=0,t.e22=1,t.e23=0,t.e30=0,t.e31=0,t.e32=0,t.e33=1,this.sizeMat4==this.stackMat4.length){let e=new Array(this.sizeMat4<<1),i=0,n=this.sizeMat4;for(;i<n;){let s=i++;e[s]=this.stackMat4[s],this.stackMat4[s]=null}this.stackMat4=e}this.stackMat4[this.sizeMat4++]=t}disposeQuat(t){if(t.x=0,t.y=0,t.z=0,t.w=1,this.sizeQuat==this.stackQuat.length){let e=new Array(this.sizeQuat<<1),i=0,n=this.sizeQuat;for(;i<n;){let s=i++;e[s]=this.stackQuat[s],this.stackQuat[s]=null}this.stackQuat=e}this.stackQuat[this.sizeQuat++]=t}};y.common.Quat=class{constructor(t,e,i,n){n==null&&(n=1),i==null&&(i=0),e==null&&(e=0),t==null&&(t=0),this.x=t,this.y=e,this.z=i,this.w=n,y.common.Quat.numCreations++}identity(){return this.x=0,this.y=0,this.z=0,this.w=1,this}init(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}add(t){return new y.common.Quat(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}sub(t){return new y.common.Quat(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)}scale(t){return new y.common.Quat(this.x*t,this.y*t,this.z*t,this.w*t)}addEq(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}subEq(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}scaleEq(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}normalized(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t>0&&(t=1/t),new y.common.Quat(this.x*t,this.y*t,this.z*t,this.w*t)}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t>0&&(t=1/t),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}setArc(t,e){let i=t.x,n=t.y,s=t.z,o=e.x,r=e.y,_=e.z,a=i*o+n*r+s*_;return this.w=Math.sqrt((1+a)*.5),this.w==0?(o=i*i,r=n*n,_=s*s,o<r?o<_?(a=1/Math.sqrt(r+_),this.x=0,this.y=s*a,this.z=-n*a):(a=1/Math.sqrt(o+r),this.z=0,this.x=n*a,this.y=-i*a):r<_?(a=1/Math.sqrt(_+o),this.y=0,this.z=i*a,this.x=-s*a):(a=1/Math.sqrt(o+r),this.z=0,this.x=n*a,this.y=-i*a),this):(a=.5/this.w,this.x=(n*_-s*r)*a,this.y=(s*o-i*_)*a,this.z=(i*r-n*o)*a,this)}slerp(t,e){let i,n,s,o,r=this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w;if(r<0?(r=-r,i=-t.x,n=-t.y,s=-t.z,o=-t.w):(i=t.x,n=t.y,s=t.z,o=t.w),r>.999999){let m=new y.common.Quat(this.x+(i-this.x)*e,this.y+(n-this.y)*e,this.z+(s-this.z)*e,this.w+(o-this.w)*e),f=Math.sqrt(m.x*m.x+m.y*m.y+m.z*m.z+m.w*m.w);return f>0&&(f=1/f),m.x*=f,m.y*=f,m.z*=f,m.w*=f,m}let _=e*Math.acos(r);i-=this.x*r,n-=this.y*r,s-=this.z*r,o-=this.w*r;let a=1/Math.sqrt(i*i+n*n+s*s+o*o);i*=a,n*=a,s*=a,o*=a;let l=Math.sin(_),h=Math.cos(_);return new y.common.Quat(this.x*h+i*l,this.y*h+n*l,this.z*h+s*l,this.w*h+o*l)}copyFrom(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}clone(){return new y.common.Quat(this.x,this.y,this.z,this.w)}fromMat3(t){let e=t.e00,i=t.e11,n=t.e22,s=e+i+n,o;return s>0?(o=Math.sqrt(s+1),this.w=.5*o,o=.5/o,this.x=(t.e21-t.e12)*o,this.y=(t.e02-t.e20)*o,this.z=(t.e10-t.e01)*o):e>i?e>n?(o=Math.sqrt(e-i-n+1),this.x=.5*o,o=.5/o,this.y=(t.e01+t.e10)*o,this.z=(t.e02+t.e20)*o,this.w=(t.e21-t.e12)*o):(o=Math.sqrt(n-e-i+1),this.z=.5*o,o=.5/o,this.x=(t.e02+t.e20)*o,this.y=(t.e12+t.e21)*o,this.w=(t.e10-t.e01)*o):i>n?(o=Math.sqrt(i-n-e+1),this.y=.5*o,o=.5/o,this.x=(t.e01+t.e10)*o,this.z=(t.e12+t.e21)*o,this.w=(t.e02-t.e20)*o):(o=Math.sqrt(n-e-i+1),this.z=.5*o,o=.5/o,this.x=(t.e02+t.e20)*o,this.y=(t.e12+t.e21)*o,this.w=(t.e10-t.e01)*o),this}toMat3(){let t=new y.common.Mat3,e=this.x,i=this.y,n=this.z,s=this.w,o=2*e,r=2*i,_=2*n,a=e*o,l=i*r,h=n*_,m=e*r,f=i*_,p=e*_,d=s*o,u=s*r,g=s*_;return t.e00=1-l-h,t.e01=m-g,t.e02=p+u,t.e10=m+g,t.e11=1-a-h,t.e12=f-d,t.e20=p-u,t.e21=f+d,t.e22=1-a-l,t}toString(){return"Quat["+(this.x>0?(this.x*1e7+.5|0)/1e7:(this.x*1e7-.5|0)/1e7)+` i,
    `+(this.y>0?(this.y*1e7+.5|0)/1e7:(this.y*1e7-.5|0)/1e7)+` j,
    `+(this.z>0?(this.z*1e7+.5|0)/1e7:(this.z*1e7-.5|0)/1e7)+` k,
    `+(this.w>0?(this.w*1e7+.5|0)/1e7:(this.w*1e7-.5|0)/1e7)+"]"}};y.dynamics||(y.dynamics={});y.dynamics.Contact=class{constructor(){this._next=null,this._prev=null,this._link1=new y.dynamics.ContactLink,this._link2=new y.dynamics.ContactLink,this._s1=null,this._s2=null,this._b1=null,this._b2=null,this._detector=null,this._cachedDetectorData=new y.collision.narrowphase.detector.CachedDetectorData,this._detectorResult=new y.collision.narrowphase.DetectorResult,this._latest=!1,this._shouldBeSkipped=!1,this._manifold=new y.dynamics.constraint.contact.Manifold,this._updater=new y.dynamics.constraint.contact.ManifoldUpdater(this._manifold),this._contactConstraint=new y.dynamics.constraint.contact.ContactConstraint(this._manifold),this._touching=!1}_updateManifold(){if(this._detector==null)return;let t=this._touching,e=this._detectorResult;if(this._detector.detect(e,this._s1._geom,this._s2._geom,this._s1._transform,this._s2._transform,this._cachedDetectorData),this._touching=e.numPoints>0,this._touching?(this._manifold._buildBasis(e.normal),e.getMaxDepth()>y.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold?this._contactConstraint._positionCorrectionAlgorithm=y.common.Setting.alternativeContactPositionCorrectionAlgorithm:this._contactConstraint._positionCorrectionAlgorithm=y.common.Setting.defaultContactPositionCorrectionAlgorithm,e.incremental?this._updater.incrementalUpdate(e,this._b1._transform,this._b2._transform):this._updater.totalUpdate(e,this._b1._transform,this._b2._transform)):this._manifold._clear(),this._touching&&!t){let i=this._s1._contactCallback,n=this._s2._contactCallback;i==n&&(n=null),i!=null&&i.beginContact(this),n!=null&&n.beginContact(this)}if(!this._touching&&t){let i=this._s1._contactCallback,n=this._s2._contactCallback;i==n&&(n=null),i!=null&&i.endContact(this),n!=null&&n.endContact(this)}if(this._touching){let i=this._s1._contactCallback,n=this._s2._contactCallback;i==n&&(n=null),i!=null&&i.preSolve(this),n!=null&&n.preSolve(this)}}_postSolve(){let t=this._s1._contactCallback,e=this._s2._contactCallback;t==e&&(e=null),t!=null&&t.postSolve(this),e!=null&&e.postSolve(this)}getShape1(){return this._s1}getShape2(){return this._s2}isTouching(){return this._touching}getManifold(){return this._manifold}getContactConstraint(){return this._contactConstraint}getPrev(){return this._prev}getNext(){return this._next}};y.dynamics.ContactLink=class{constructor(){this._prev=null,this._next=null,this._contact=null,this._other=null}getContact(){return this._contact}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}};y.dynamics.ContactManager=class{constructor(t){this._broadPhase=t,this._collisionMatrix=new y.collision.narrowphase.CollisionMatrix,this._numContacts=0}createContacts(){let t=this._broadPhase._proxyPairList;for(;t!=null;){let e=t._next;for(;;){let i,n;if(t._p1._id<t._p2._id?(i=t._p1.userData,n=t._p2.userData):(i=t._p2.userData,n=t._p1.userData),!this.shouldCollide(i,n))break;let s=i._rigidBody,o=n._rigidBody,r;s._numContactLinks<o._numContactLinks?r=s._contactLinkList:r=o._contactLinkList;let _=i._id,a=n._id,l=!1;for(;r!=null;){let h=r._contact;if(h._s1._id==_&&h._s2._id==a){h._latest=!0,l=!0;break}r=r._next}if(!l){let h=this._contactPool;h!=null?(this._contactPool=h._next,h._next=null):h=new y.dynamics.Contact;let m=h;this._contactList==null?(this._contactList=m,this._contactListLast=m):(this._contactListLast._next=m,m._prev=this._contactListLast,this._contactListLast=m),m._latest=!0;let f=this._collisionMatrix.detectors[i._geom._type][n._geom._type];m._s1=i,m._s2=n,m._b1=i._rigidBody,m._b2=n._rigidBody,m._touching=!1,m._b1._contactLinkList==null?(m._b1._contactLinkList=m._link1,m._b1._contactLinkListLast=m._link1):(m._b1._contactLinkListLast._next=m._link1,m._link1._prev=m._b1._contactLinkListLast,m._b1._contactLinkListLast=m._link1),m._b2._contactLinkList==null?(m._b2._contactLinkList=m._link2,m._b2._contactLinkListLast=m._link2):(m._b2._contactLinkListLast._next=m._link2,m._link2._prev=m._b2._contactLinkListLast,m._b2._contactLinkListLast=m._link2),m._b1._numContactLinks++,m._b2._numContactLinks++,m._link1._other=m._b2,m._link2._other=m._b1,m._link1._contact=m,m._link2._contact=m,m._detector=f;let p=m._contactConstraint;p._s1=i,p._s2=n,p._b1=p._s1._rigidBody,p._b2=p._s2._rigidBody,p._tf1=p._b1._transform,p._tf2=p._b2._transform,this._numContacts++}break}t=e}}destroyOutdatedContacts(){let t=this._broadPhase._incremental,e=this._contactList;for(;e!=null;){let i=e._next;for(;;){if(e._latest){e._latest=!1,e._shouldBeSkipped=!1;break}if(!t){let m=e._prev,f=e._next;if(m!=null&&(m._next=f),f!=null&&(f._prev=m),e==this._contactList&&(this._contactList=this._contactList._next),e==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),e._next=null,e._prev=null,e._touching){let x=e._s1._contactCallback,b=e._s2._contactCallback;x==b&&(b=null),x!=null&&x.endContact(e),b!=null&&b.endContact(e)}let p=e._link1._prev,d=e._link1._next;p!=null&&(p._next=d),d!=null&&(d._prev=p),e._link1==e._b1._contactLinkList&&(e._b1._contactLinkList=e._b1._contactLinkList._next),e._link1==e._b1._contactLinkListLast&&(e._b1._contactLinkListLast=e._b1._contactLinkListLast._prev),e._link1._next=null,e._link1._prev=null;let u=e._link2._prev,g=e._link2._next;u!=null&&(u._next=g),g!=null&&(g._prev=u),e._link2==e._b2._contactLinkList&&(e._b2._contactLinkList=e._b2._contactLinkList._next),e._link2==e._b2._contactLinkListLast&&(e._b2._contactLinkListLast=e._b2._contactLinkListLast._prev),e._link2._next=null,e._link2._prev=null,e._b1._numContactLinks--,e._b2._numContactLinks--,e._link1._other=null,e._link2._other=null,e._link1._contact=null,e._link2._contact=null,e._s1=null,e._s2=null,e._b1=null,e._b2=null,e._touching=!1,e._cachedDetectorData._clear(),e._manifold._clear(),e._detector=null;let v=e._contactConstraint;v._s1=null,v._s2=null,v._b1=null,v._b2=null,v._tf1=null,v._tf2=null,e._next=this._contactPool,this._contactPool=e,this._numContacts--;break}let n=e._s1,s=e._s2,o=n._rigidBody,r=s._rigidBody;if(!(!o._sleeping&&o._type!=1)&&!(!r._sleeping&&r._type!=1)){e._shouldBeSkipped=!0;break}let _=n._aabb,a=s._aabb,l=n._proxy,h=s._proxy;if(!(l._aabbMinX<h._aabbMaxX&&l._aabbMaxX>h._aabbMinX&&l._aabbMinY<h._aabbMaxY&&l._aabbMaxY>h._aabbMinY&&l._aabbMinZ<h._aabbMaxZ&&l._aabbMaxZ>h._aabbMinZ)||!this.shouldCollide(n,s)){let m=e._prev,f=e._next;if(m!=null&&(m._next=f),f!=null&&(f._prev=m),e==this._contactList&&(this._contactList=this._contactList._next),e==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),e._next=null,e._prev=null,e._touching){let x=e._s1._contactCallback,b=e._s2._contactCallback;x==b&&(b=null),x!=null&&x.endContact(e),b!=null&&b.endContact(e)}let p=e._link1._prev,d=e._link1._next;p!=null&&(p._next=d),d!=null&&(d._prev=p),e._link1==e._b1._contactLinkList&&(e._b1._contactLinkList=e._b1._contactLinkList._next),e._link1==e._b1._contactLinkListLast&&(e._b1._contactLinkListLast=e._b1._contactLinkListLast._prev),e._link1._next=null,e._link1._prev=null;let u=e._link2._prev,g=e._link2._next;u!=null&&(u._next=g),g!=null&&(g._prev=u),e._link2==e._b2._contactLinkList&&(e._b2._contactLinkList=e._b2._contactLinkList._next),e._link2==e._b2._contactLinkListLast&&(e._b2._contactLinkListLast=e._b2._contactLinkListLast._prev),e._link2._next=null,e._link2._prev=null,e._b1._numContactLinks--,e._b2._numContactLinks--,e._link1._other=null,e._link2._other=null,e._link1._contact=null,e._link2._contact=null,e._s1=null,e._s2=null,e._b1=null,e._b2=null,e._touching=!1,e._cachedDetectorData._clear(),e._manifold._clear(),e._detector=null;let v=e._contactConstraint;v._s1=null,v._s2=null,v._b1=null,v._b2=null,v._tf1=null,v._tf2=null,e._next=this._contactPool,this._contactPool=e,this._numContacts--;break}e._shouldBeSkipped=!(_._minX<a._maxX&&_._maxX>a._minX&&_._minY<a._maxY&&_._maxY>a._minY&&_._minZ<a._maxZ&&_._maxZ>a._minZ);break}e=i}}shouldCollide(t,e){let i=t._rigidBody,n=e._rigidBody;if(i==n||i._type!=0&&n._type!=0||(t._collisionGroup&e._collisionMask)==0||(e._collisionGroup&t._collisionMask)==0)return!1;let s,o;for(i._numJointLinks<n._numJointLinks?(s=i._jointLinkList,o=n):(s=n._jointLinkList,o=i);s!=null;){if(s._other==o&&!s._joint._allowCollision)return!1;s=s._next}return!0}_updateContacts(){this._broadPhase.collectPairs(),this.createContacts(),this.destroyOutdatedContacts()}_postSolve(){let t=this._contactList;for(;t!=null;){let e=t._next;t._touching&&t._postSolve(),t=e}}getNumContacts(){return this._numContacts}getContactList(){return this._contactList}};y.dynamics.Island=class{constructor(){this.rigidBodies=new Array(y.common.Setting.islandInitialRigidBodyArraySize),this.solvers=new Array(y.common.Setting.islandInitialConstraintArraySize),this.solversSi=new Array(y.common.Setting.islandInitialConstraintArraySize),this.solversNgs=new Array(y.common.Setting.islandInitialConstraintArraySize),this.numRigidBodies=0,this.numSolvers=0,this.numSolversSi=0,this.numSolversNgs=0}_clear(){for(;this.numRigidBodies>0;)this.rigidBodies[--this.numRigidBodies]=null;for(;this.numSolvers>0;)this.solvers[--this.numSolvers]=null;for(;this.numSolversSi>0;)this.solversSi[--this.numSolversSi]=null;for(;this.numSolversNgs>0;)this.solversNgs[--this.numSolversNgs]=null}_addRigidBody(t){if(this.numRigidBodies==this.rigidBodies.length){let e=new Array(this.numRigidBodies<<1),i=0,n=this.numRigidBodies;for(;i<n;){let s=i++;e[s]=this.rigidBodies[s],this.rigidBodies[s]=null}this.rigidBodies=e}t._addedToIsland=!0,this.rigidBodies[this.numRigidBodies++]=t}_addConstraintSolver(t,e){if(this.numSolvers==this.solvers.length){let i=new Array(this.numSolvers<<1),n=0,s=this.numSolvers;for(;n<s;){let o=n++;i[o]=this.solvers[o],this.solvers[o]=null}this.solvers=i}if(t._addedToIsland=!0,this.solvers[this.numSolvers++]=t,e==y.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE){if(this.numSolversSi==this.solversSi.length){let i=new Array(this.numSolversSi<<1),n=0,s=this.numSolversSi;for(;n<s;){let o=n++;i[o]=this.solversSi[o],this.solversSi[o]=null}this.solversSi=i}this.solversSi[this.numSolversSi++]=t}if(e==y.dynamics.constraint.PositionCorrectionAlgorithm.NGS){if(this.numSolversNgs==this.solversNgs.length){let i=new Array(this.numSolversNgs<<1),n=0,s=this.numSolversNgs;for(;n<s;){let o=n++;i[o]=this.solversNgs[o],this.solversNgs[o]=null}this.solversNgs=i}this.solversNgs[this.numSolversNgs++]=t}}_stepSingleRigidBody(t,e){let i=t.dt,n=e._ptransform,s=e._transform;if(n._positionX=s._positionX,n._positionY=s._positionY,n._positionZ=s._positionZ,n._rotation00=s._rotation00,n._rotation01=s._rotation01,n._rotation02=s._rotation02,n._rotation10=s._rotation10,n._rotation11=s._rotation11,n._rotation12=s._rotation12,n._rotation20=s._rotation20,n._rotation21=s._rotation21,n._rotation22=s._rotation22,e._linearContactImpulseX=0,e._linearContactImpulseY=0,e._linearContactImpulseZ=0,e._angularContactImpulseX=0,e._angularContactImpulseY=0,e._angularContactImpulseZ=0,e._autoSleep&&e._velX*e._velX+e._velY*e._velY+e._velZ*e._velZ<y.common.Setting.sleepingVelocityThreshold*y.common.Setting.sleepingVelocityThreshold&&e._angVelX*e._angVelX+e._angVelY*e._angVelY+e._angVelZ*e._angVelZ<y.common.Setting.sleepingAngularVelocityThreshold*y.common.Setting.sleepingAngularVelocityThreshold?(e._sleepTime+=i,e._sleepTime>y.common.Setting.sleepingTimeThreshold&&(e._sleeping=!0,e._sleepTime=0)):e._sleepTime=0,!e._sleeping){if(e._type==0){let r=i*e._linearDamping,_=r*r,a=1/(1+r+_*(.5+r*.16666666666666666+_*.041666666666666664)),l=i*e._angularDamping,h=l*l,m=1/(1+l+h*(.5+l*.16666666666666666+h*.041666666666666664)),f,p,d,u,g,v;f=this.gravityX*e._gravityScale,p=this.gravityY*e._gravityScale,d=this.gravityZ*e._gravityScale,f+=e._forceX*e._invMass,p+=e._forceY*e._invMass,d+=e._forceZ*e._invMass;let x,b,Y;x=e._invInertia00*e._torqueX+e._invInertia01*e._torqueY+e._invInertia02*e._torqueZ,b=e._invInertia10*e._torqueX+e._invInertia11*e._torqueY+e._invInertia12*e._torqueZ,Y=e._invInertia20*e._torqueX+e._invInertia21*e._torqueY+e._invInertia22*e._torqueZ,u=x,g=b,v=Y,e._velX+=f*i,e._velY+=p*i,e._velZ+=d*i,e._velX*=a,e._velY*=a,e._velZ*=a,e._angVelX+=u*i,e._angVelY+=g*i,e._angVelZ+=v*i,e._angVelX*=m,e._angVelY*=m,e._angVelZ*=m}e._integrate(i);let o=e._shapeList;for(;o!=null;){let r=o._next,_=e._ptransform,a=e._transform,l=o._ptransform,h=o._localTransform,m,f,p,d,u,g,v,x,b;m=_._rotation00*h._rotation00+_._rotation01*h._rotation10+_._rotation02*h._rotation20,f=_._rotation00*h._rotation01+_._rotation01*h._rotation11+_._rotation02*h._rotation21,p=_._rotation00*h._rotation02+_._rotation01*h._rotation12+_._rotation02*h._rotation22,d=_._rotation10*h._rotation00+_._rotation11*h._rotation10+_._rotation12*h._rotation20,u=_._rotation10*h._rotation01+_._rotation11*h._rotation11+_._rotation12*h._rotation21,g=_._rotation10*h._rotation02+_._rotation11*h._rotation12+_._rotation12*h._rotation22,v=_._rotation20*h._rotation00+_._rotation21*h._rotation10+_._rotation22*h._rotation20,x=_._rotation20*h._rotation01+_._rotation21*h._rotation11+_._rotation22*h._rotation21,b=_._rotation20*h._rotation02+_._rotation21*h._rotation12+_._rotation22*h._rotation22,l._rotation00=m,l._rotation01=f,l._rotation02=p,l._rotation10=d,l._rotation11=u,l._rotation12=g,l._rotation20=v,l._rotation21=x,l._rotation22=b;let Y,w,Z;Y=_._rotation00*h._positionX+_._rotation01*h._positionY+_._rotation02*h._positionZ,w=_._rotation10*h._positionX+_._rotation11*h._positionY+_._rotation12*h._positionZ,Z=_._rotation20*h._positionX+_._rotation21*h._positionY+_._rotation22*h._positionZ,l._positionX=Y,l._positionY=w,l._positionZ=Z,l._positionX+=_._positionX,l._positionY+=_._positionY,l._positionZ+=_._positionZ;let X=o._transform,M=o._localTransform,z,T,F,P,A,L,S,R,E;z=a._rotation00*M._rotation00+a._rotation01*M._rotation10+a._rotation02*M._rotation20,T=a._rotation00*M._rotation01+a._rotation01*M._rotation11+a._rotation02*M._rotation21,F=a._rotation00*M._rotation02+a._rotation01*M._rotation12+a._rotation02*M._rotation22,P=a._rotation10*M._rotation00+a._rotation11*M._rotation10+a._rotation12*M._rotation20,A=a._rotation10*M._rotation01+a._rotation11*M._rotation11+a._rotation12*M._rotation21,L=a._rotation10*M._rotation02+a._rotation11*M._rotation12+a._rotation12*M._rotation22,S=a._rotation20*M._rotation00+a._rotation21*M._rotation10+a._rotation22*M._rotation20,R=a._rotation20*M._rotation01+a._rotation21*M._rotation11+a._rotation22*M._rotation21,E=a._rotation20*M._rotation02+a._rotation21*M._rotation12+a._rotation22*M._rotation22,X._rotation00=z,X._rotation01=T,X._rotation02=F,X._rotation10=P,X._rotation11=A,X._rotation12=L,X._rotation20=S,X._rotation21=R,X._rotation22=E;let C,k,V;C=a._rotation00*M._positionX+a._rotation01*M._positionY+a._rotation02*M._positionZ,k=a._rotation10*M._positionX+a._rotation11*M._positionY+a._rotation12*M._positionZ,V=a._rotation20*M._positionX+a._rotation21*M._positionY+a._rotation22*M._positionZ,X._positionX=C,X._positionY=k,X._positionZ=V,X._positionX+=a._positionX,X._positionY+=a._positionY,X._positionZ+=a._positionZ;let B,J,I,G,D,et;if(o._geom._computeAabb(o._aabb,o._ptransform),B=o._aabb._minX,J=o._aabb._minY,I=o._aabb._minZ,G=o._aabb._maxX,D=o._aabb._maxY,et=o._aabb._maxZ,o._geom._computeAabb(o._aabb,o._transform),o._aabb._minX=B<o._aabb._minX?B:o._aabb._minX,o._aabb._minY=J<o._aabb._minY?J:o._aabb._minY,o._aabb._minZ=I<o._aabb._minZ?I:o._aabb._minZ,o._aabb._maxX=G>o._aabb._maxX?G:o._aabb._maxX,o._aabb._maxY=D>o._aabb._maxY?D:o._aabb._maxY,o._aabb._maxZ=et>o._aabb._maxZ?et:o._aabb._maxZ,o._proxy!=null){let $,j,q;$=o._transform._positionX-o._ptransform._positionX,j=o._transform._positionY-o._ptransform._positionY,q=o._transform._positionZ-o._ptransform._positionZ;let tt=o.displacement;tt.x=$,tt.y=j,tt.z=q,o._rigidBody._world._broadPhase.moveProxy(o._proxy,o._aabb,o.displacement)}o=r}}}_step(t,e,i){let n=t.dt,s=!0,o=0,r=this.numRigidBodies;for(;o<r;){let P=this.rigidBodies[o++],A=P._ptransform,L=P._transform;if(A._positionX=L._positionX,A._positionY=L._positionY,A._positionZ=L._positionZ,A._rotation00=L._rotation00,A._rotation01=L._rotation01,A._rotation02=L._rotation02,A._rotation10=L._rotation10,A._rotation11=L._rotation11,A._rotation12=L._rotation12,A._rotation20=L._rotation20,A._rotation21=L._rotation21,A._rotation22=L._rotation22,P._linearContactImpulseX=0,P._linearContactImpulseY=0,P._linearContactImpulseZ=0,P._angularContactImpulseX=0,P._angularContactImpulseY=0,P._angularContactImpulseZ=0,P._sleeping=!1,P._autoSleep&&P._velX*P._velX+P._velY*P._velY+P._velZ*P._velZ<y.common.Setting.sleepingVelocityThreshold*y.common.Setting.sleepingVelocityThreshold&&P._angVelX*P._angVelX+P._angVelY*P._angVelY+P._angVelZ*P._angVelZ<y.common.Setting.sleepingAngularVelocityThreshold*y.common.Setting.sleepingAngularVelocityThreshold?P._sleepTime+=n:P._sleepTime=0,P._sleepTime<y.common.Setting.sleepingTimeThreshold&&(s=!1),P._type==0){let S=n*P._linearDamping,R=S*S,E=1/(1+S+R*(.5+S*.16666666666666666+R*.041666666666666664)),C=n*P._angularDamping,k=C*C,V=1/(1+C+k*(.5+C*.16666666666666666+k*.041666666666666664)),B,J,I,G,D,et;B=this.gravityX*P._gravityScale,J=this.gravityY*P._gravityScale,I=this.gravityZ*P._gravityScale,B+=P._forceX*P._invMass,J+=P._forceY*P._invMass,I+=P._forceZ*P._invMass;let $,j,q;$=P._invInertia00*P._torqueX+P._invInertia01*P._torqueY+P._invInertia02*P._torqueZ,j=P._invInertia10*P._torqueX+P._invInertia11*P._torqueY+P._invInertia12*P._torqueZ,q=P._invInertia20*P._torqueX+P._invInertia21*P._torqueY+P._invInertia22*P._torqueZ,G=$,D=j,et=q,P._velX+=B*n,P._velY+=J*n,P._velZ+=I*n,P._velX*=E,P._velY*=E,P._velZ*=E,P._angVelX+=G*n,P._angVelY+=D*n,P._angVelZ+=et*n,P._angVelX*=V,P._angVelY*=V,P._angVelZ*=V}}if(s){let P=0,A=this.numRigidBodies;for(;P<A;){let L=this.rigidBodies[P++];L._sleeping=!0,L._sleepTime=0}return}let _=0,a=this.numSolvers;for(;_<a;)this.solvers[_++].preSolveVelocity(t);let l=0,h=this.numSolvers;for(;l<h;)this.solvers[l++].warmStart(t);let m=0;for(;m<e;){++m;let P=0,A=this.numSolvers;for(;P<A;)this.solvers[P++].solveVelocity()}let f=0,p=this.numSolvers;for(;f<p;)this.solvers[f++].postSolveVelocity(t);let d=0,u=this.numRigidBodies;for(;d<u;)this.rigidBodies[d++]._integrate(n);let g=0,v=this.numSolversSi;for(;g<v;)this.solversSi[g++].preSolvePosition(t);let x=0;for(;x<i;){++x;let P=0,A=this.numSolversSi;for(;P<A;)this.solversSi[P++].solvePositionSplitImpulse()}let b=0,Y=this.numRigidBodies;for(;b<Y;)this.rigidBodies[b++]._integratePseudoVelocity();let w=0,Z=this.numSolversNgs;for(;w<Z;)this.solversNgs[w++].preSolvePosition(t);let X=0;for(;X<i;){++X;let P=0,A=this.numSolversNgs;for(;P<A;)this.solversNgs[P++].solvePositionNgs(t)}let M=0,z=this.numSolvers;for(;M<z;)this.solvers[M++].postSolve();let T=0,F=this.numRigidBodies;for(;T<F;){let P=this.rigidBodies[T++],A=P._shapeList;for(;A!=null;){let L=A._next,S=P._ptransform,R=P._transform,E=A._ptransform,C=A._localTransform,k,V,B,J,I,G,D,et,$;k=S._rotation00*C._rotation00+S._rotation01*C._rotation10+S._rotation02*C._rotation20,V=S._rotation00*C._rotation01+S._rotation01*C._rotation11+S._rotation02*C._rotation21,B=S._rotation00*C._rotation02+S._rotation01*C._rotation12+S._rotation02*C._rotation22,J=S._rotation10*C._rotation00+S._rotation11*C._rotation10+S._rotation12*C._rotation20,I=S._rotation10*C._rotation01+S._rotation11*C._rotation11+S._rotation12*C._rotation21,G=S._rotation10*C._rotation02+S._rotation11*C._rotation12+S._rotation12*C._rotation22,D=S._rotation20*C._rotation00+S._rotation21*C._rotation10+S._rotation22*C._rotation20,et=S._rotation20*C._rotation01+S._rotation21*C._rotation11+S._rotation22*C._rotation21,$=S._rotation20*C._rotation02+S._rotation21*C._rotation12+S._rotation22*C._rotation22,E._rotation00=k,E._rotation01=V,E._rotation02=B,E._rotation10=J,E._rotation11=I,E._rotation12=G,E._rotation20=D,E._rotation21=et,E._rotation22=$;let j,q,tt;j=S._rotation00*C._positionX+S._rotation01*C._positionY+S._rotation02*C._positionZ,q=S._rotation10*C._positionX+S._rotation11*C._positionY+S._rotation12*C._positionZ,tt=S._rotation20*C._positionX+S._rotation21*C._positionY+S._rotation22*C._positionZ,E._positionX=j,E._positionY=q,E._positionZ=tt,E._positionX+=S._positionX,E._positionY+=S._positionY,E._positionZ+=S._positionZ;let W=A._transform,U=A._localTransform,it,Q,at,ht,_t,mt,ft,ut,H;it=R._rotation00*U._rotation00+R._rotation01*U._rotation10+R._rotation02*U._rotation20,Q=R._rotation00*U._rotation01+R._rotation01*U._rotation11+R._rotation02*U._rotation21,at=R._rotation00*U._rotation02+R._rotation01*U._rotation12+R._rotation02*U._rotation22,ht=R._rotation10*U._rotation00+R._rotation11*U._rotation10+R._rotation12*U._rotation20,_t=R._rotation10*U._rotation01+R._rotation11*U._rotation11+R._rotation12*U._rotation21,mt=R._rotation10*U._rotation02+R._rotation11*U._rotation12+R._rotation12*U._rotation22,ft=R._rotation20*U._rotation00+R._rotation21*U._rotation10+R._rotation22*U._rotation20,ut=R._rotation20*U._rotation01+R._rotation21*U._rotation11+R._rotation22*U._rotation21,H=R._rotation20*U._rotation02+R._rotation21*U._rotation12+R._rotation22*U._rotation22,W._rotation00=it,W._rotation01=Q,W._rotation02=at,W._rotation10=ht,W._rotation11=_t,W._rotation12=mt,W._rotation20=ft,W._rotation21=ut,W._rotation22=H;let O,ot,pt;O=R._rotation00*U._positionX+R._rotation01*U._positionY+R._rotation02*U._positionZ,ot=R._rotation10*U._positionX+R._rotation11*U._positionY+R._rotation12*U._positionZ,pt=R._rotation20*U._positionX+R._rotation21*U._positionY+R._rotation22*U._positionZ,W._positionX=O,W._positionY=ot,W._positionZ=pt,W._positionX+=R._positionX,W._positionY+=R._positionY,W._positionZ+=R._positionZ;let vt,xt,Mt,ct,St,It;if(A._geom._computeAabb(A._aabb,A._ptransform),vt=A._aabb._minX,xt=A._aabb._minY,Mt=A._aabb._minZ,ct=A._aabb._maxX,St=A._aabb._maxY,It=A._aabb._maxZ,A._geom._computeAabb(A._aabb,A._transform),A._aabb._minX=vt<A._aabb._minX?vt:A._aabb._minX,A._aabb._minY=xt<A._aabb._minY?xt:A._aabb._minY,A._aabb._minZ=Mt<A._aabb._minZ?Mt:A._aabb._minZ,A._aabb._maxX=ct>A._aabb._maxX?ct:A._aabb._maxX,A._aabb._maxY=St>A._aabb._maxY?St:A._aabb._maxY,A._aabb._maxZ=It>A._aabb._maxZ?It:A._aabb._maxZ,A._proxy!=null){let dt,K,lt;dt=A._transform._positionX-A._ptransform._positionX,K=A._transform._positionY-A._ptransform._positionY,lt=A._transform._positionZ-A._ptransform._positionZ;let rt=A.displacement;rt.x=dt,rt.y=K,rt.z=lt,A._rigidBody._world._broadPhase.moveProxy(A._proxy,A._aabb,A.displacement)}A=L}}}};y.dynamics.TimeStep=class{constructor(){this.dt=0,this.invDt=0,this.dtRatio=1}};y.dynamics.World=class{constructor(t,e){switch(t==null&&(t=2),t){case 1:this._broadPhase=new y.collision.broadphase.bruteforce.BruteForceBroadPhase;break;case 2:this._broadPhase=new y.collision.broadphase.bvh.BvhBroadPhase;break}this._contactManager=new y.dynamics.ContactManager(this._broadPhase),e==null&&(e=new y.common.Vec3(0,-9.80665,0)),this._gravity=new y.common.Vec3(e.x,e.y,e.z),this._rigidBodyList=null,this._rigidBodyListLast=null,this._jointList=null,this._jointListLast=null,this._numRigidBodies=0,this._numShapes=0,this._numJoints=0,this._numIslands=0,this._numVelocityIterations=10,this._numPositionIterations=5,this._rayCastWrapper=new y.dynamics._World.RayCastWrapper,this._convexCastWrapper=new y.dynamics._World.ConvexCastWrapper,this._aabbTestWrapper=new y.dynamics._World.AabbTestWrapper,this._island=new y.dynamics.Island,this._solversInIslands=new Array(y.common.Setting.islandInitialConstraintArraySize),this._rigidBodyStack=new Array(y.common.Setting.islandInitialRigidBodyArraySize),this._timeStep=new y.dynamics.TimeStep,this._pool=new y.common.Pool,this._shapeIdCount=0}_updateContacts(){let t=Date.now()/1e3;this._contactManager._updateContacts(),y.dynamics.common.Performance.broadPhaseCollisionTime=(Date.now()/1e3-t)*1e3;let e=Date.now()/1e3,i=this._contactManager._contactList;for(;i!=null;){let n=i._next;i._shouldBeSkipped||i._updateManifold(),i=n}y.dynamics.common.Performance.narrowPhaseCollisionTime=(Date.now()/1e3-e)*1e3}_solveIslands(){let t=Date.now()/1e3;if(y.common.Setting.disableSleeping){let s=this._rigidBodyList;for(;s!=null;)s._sleeping=!1,s._sleepTime=0,s=s._next}if(this._rigidBodyStack.length<this._numRigidBodies){let s=this._rigidBodyStack.length<<1;for(;s<this._numRigidBodies;)s<<=1;this._rigidBodyStack=new Array(s)}this._numIslands=0;let e=this._island,i=this._gravity;e.gravityX=i.x,e.gravityY=i.y,e.gravityZ=i.z;let n=this._rigidBodyList;for(this._numSolversInIslands=0;n!=null;){let s=n._next;for(;!(n._addedToIsland||n._sleeping||n._type==1);){if(n._numContactLinks==0&&n._numJointLinks==0){this._island._stepSingleRigidBody(this._timeStep,n),this._numIslands++;break}this.buildIsland(n),this._island._step(this._timeStep,this._numVelocityIterations,this._numPositionIterations),this._island._clear(),this._numIslands++;break}n=s}for(this._contactManager._postSolve(),n=this._rigidBodyList;n!=null;)n._addedToIsland=!1,n=n._next;for(n=this._rigidBodyList;n!=null;)n._forceX=0,n._forceY=0,n._forceZ=0,n._torqueX=0,n._torqueY=0,n._torqueZ=0,n=n._next;for(;this._numSolversInIslands>0;)this._solversInIslands[--this._numSolversInIslands]._addedToIsland=!1,this._solversInIslands[this._numSolversInIslands]=null;y.dynamics.common.Performance.dynamicsTime=(Date.now()/1e3-t)*1e3}buildIsland(t){let e=1;for(this._island._addRigidBody(t),this._rigidBodyStack[0]=t;e>0;){let i=this._rigidBodyStack[--e];if(this._rigidBodyStack[e]=null,i._type==1)continue;let n=i._contactLinkList;for(;n!=null;){let o=n._next,r=n._contact._contactConstraint,_=n._contact._contactConstraint._solver;if(r.isTouching()&&!_._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){let l=new Array(this._numSolversInIslands<<1),h=0,m=this._numSolversInIslands;for(;h<m;){let f=h++;l[f]=this._solversInIslands[f],this._solversInIslands[f]=null}this._solversInIslands=l}this._solversInIslands[this._numSolversInIslands++]=_,this._island._addConstraintSolver(_,r._positionCorrectionAlgorithm);let a=n._other;a._addedToIsland||(this._island._addRigidBody(a),this._rigidBodyStack[e++]=a)}n=o}let s=i._jointLinkList;for(;s!=null;){let o=s._next,r=s._joint,_=r._solver;if(!_._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){let l=new Array(this._numSolversInIslands<<1),h=0,m=this._numSolversInIslands;for(;h<m;){let f=h++;l[f]=this._solversInIslands[f],this._solversInIslands[f]=null}this._solversInIslands=l}this._solversInIslands[this._numSolversInIslands++]=_,this._island._addConstraintSolver(_,r._positionCorrectionAlgorithm);let a=s._other;a._addedToIsland||(this._island._addRigidBody(a),this._rigidBodyStack[e++]=a)}s=o}}}_drawBvh(t,e){t.drawBvh&&this._drawBvhNode(t,e._root,0,t.style.bvhNodeColor)}_drawBvhNode(t,e,i,n){if(e!=null){if(i>=t.drawBvhMinLevel&&i<=t.drawBvhMaxLevel){let s=this._pool,o=s.sizeVec3==0?new y.common.Vec3:s.stackVec3[--s.sizeVec3],r=this._pool,_=r.sizeVec3==0?new y.common.Vec3:r.stackVec3[--r.sizeVec3],a=o;a.x=e._aabbMinX,a.y=e._aabbMinY,a.z=e._aabbMinZ;let l=_;l.x=e._aabbMaxX,l.y=e._aabbMaxY,l.z=e._aabbMaxZ,t.aabb(o,_,n);let h=this._pool;if(o!=null){if(o.zero(),h.sizeVec3==h.stackVec3.length){let f=new Array(h.sizeVec3<<1),p=0,d=h.sizeVec3;for(;p<d;){let u=p++;f[u]=h.stackVec3[u],h.stackVec3[u]=null}h.stackVec3=f}h.stackVec3[h.sizeVec3++]=o}let m=this._pool;if(_!=null){if(_.zero(),m.sizeVec3==m.stackVec3.length){let f=new Array(m.sizeVec3<<1),p=0,d=m.sizeVec3;for(;p<d;){let u=p++;f[u]=m.stackVec3[u],m.stackVec3[u]=null}m.stackVec3=f}m.stackVec3[m.sizeVec3++]=_}}this._drawBvhNode(t,e._children[0],i+1,n),this._drawBvhNode(t,e._children[1],i+1,n)}}_drawRigidBodies(t){let e=t.style,i=this._rigidBodyList;for(;i!=null;){let n=i._next;if(t.drawBases){let _=t.style;t.basis(i._transform,_.basisLength,_.basisColorX,_.basisColorY,_.basisColorZ)}let s=null,o=i._type==0;o||(s=i._type==2?e.kinematicShapeColor:e.staticShapeColor);let r=i._shapeList;for(;r!=null;){let _=r._next;if(o&&((r._id&1)==0?s=i._sleeping?e.sleepingShapeColor1:i._sleepTime>y.common.Setting.sleepingTimeThreshold?e.sleepyShapeColor1:e.shapeColor1:s=i._sleeping?e.sleepingShapeColor2:i._sleepTime>y.common.Setting.sleepingTimeThreshold?e.sleepyShapeColor2:e.shapeColor2),t.drawShapes){let a=r._geom,l=r._transform;switch(a._type){case 0:t.sphere(l,a._radius,s);break;case 1:let h=a,m=this._pool,f=m.sizeVec3==0?new y.common.Vec3:m.stackVec3[--m.sizeVec3],p=f;p.x=h._halfExtentsX,p.y=h._halfExtentsY,p.z=h._halfExtentsZ,t.box(l,f,s);let d=this._pool;if(f!=null){if(f.zero(),d.sizeVec3==d.stackVec3.length){let W=new Array(d.sizeVec3<<1),U=0,it=d.sizeVec3;for(;U<it;){let Q=U++;W[Q]=d.stackVec3[Q],d.stackVec3[Q]=null}d.stackVec3=W}d.stackVec3[d.sizeVec3++]=f}break;case 2:let u=a;t.cylinder(l,u._radius,u._halfHeight,s);break;case 3:let g=a;t.cone(l,g._radius,g._halfHeight,s);break;case 4:let v=a;t.capsule(l,v._radius,v._halfHeight,s);break;case 5:let x=a,b=x._numVertices,Y=this._pool,w=Y.sizeVec3==0?new y.common.Vec3:Y.stackVec3[--Y.sizeVec3],Z=this._pool,X=Z.sizeVec3==0?new y.common.Vec3:Z.stackVec3[--Z.sizeVec3],M=this._pool,z=M.sizeVec3==0?new y.common.Vec3:M.stackVec3[--M.sizeVec3],T=this._pool,F=T.sizeVec3==0?new y.common.Vec3:T.stackVec3[--T.sizeVec3],P=this._pool,A=P.sizeVec3==0?new y.common.Vec3:P.stackVec3[--P.sizeVec3],L=this._pool,S=L.sizeVec3==0?new y.common.Vec3:L.stackVec3[--L.sizeVec3],R=this._pool,E=R.sizeMat3==0?new y.common.Mat3:R.stackMat3[--R.sizeMat3],C=this._pool,k=C.sizeVec3==0?new y.common.Vec3:C.stackVec3[--C.sizeVec3],V=E;V.e00=l._rotation00,V.e01=l._rotation01,V.e02=l._rotation02,V.e10=l._rotation10,V.e11=l._rotation11,V.e12=l._rotation12,V.e20=l._rotation20,V.e21=l._rotation21,V.e22=l._rotation22;let B=k;B.x=l._positionX,B.y=l._positionY,B.z=l._positionZ;let J=0;for(;J<b;){let W=J++,U=x._tmpVertices[W],it=x._vertices[W];U.x=it.x,U.y=it.y,U.z=it.z;let Q=U.x*E.e10+U.y*E.e11+U.z*E.e12,at=U.x*E.e20+U.y*E.e21+U.z*E.e22;U.x=U.x*E.e00+U.y*E.e01+U.z*E.e02,U.y=Q,U.z=at,U.x+=k.x,U.y+=k.y,U.z+=k.z}if(b>30){let W=0;for(;W<b;){let U=W++,it=x._tmpVertices[U];w.x=it.x,w.y=it.y,w.z=it.z;let Q=x._tmpVertices[(U+1)%b];X.x=Q.x,X.y=Q.y,X.z=Q.z,t.line(w,X,s)}}else if(this._debugDraw.wireframe||b>10){let W=0;for(;W<b;){let U=W++,it=x._tmpVertices[U];w.x=it.x,w.y=it.y,w.z=it.z;let Q=0;for(;Q<U;){let at=x._tmpVertices[Q++];X.x=at.x,X.y=at.y,X.z=at.z,t.line(w,X,s)}}}else{let W=0;for(;W<b;){let U=W++,it=x._tmpVertices[U];w.x=it.x,w.y=it.y,w.z=it.z;let Q=0;for(;Q<U;){let at=Q++,ht=x._tmpVertices[at];X.x=ht.x,X.y=ht.y,X.z=ht.z;let _t=0;for(;_t<at;){let mt=x._tmpVertices[_t++];z.x=mt.x,z.y=mt.y,z.z=mt.z,F.x=X.x,F.y=X.y,F.z=X.z;let ft=F;ft.x-=w.x,ft.y-=w.y,ft.z-=w.z,A.x=z.x,A.y=z.y,A.z=z.z;let ut=A;ut.x-=w.x,ut.y-=w.y,ut.z-=w.z,S.x=F.x,S.y=F.y,S.z=F.z;let H=S,O=H.z*A.x-H.x*A.z,ot=H.x*A.y-H.y*A.x;H.x=H.y*A.z-H.z*A.y,H.y=O,H.z=ot;let pt=Math.sqrt(H.x*H.x+H.y*H.y+H.z*H.z);pt>0&&(pt=1/pt),H.x*=pt,H.y*=pt,H.z*=pt,t.triangle(w,X,z,S,S,S,s),S.x=-S.x,S.y=-S.y,S.z=-S.z,t.triangle(w,z,X,S,S,S,s)}}}}let I=this._pool;if(w!=null){if(w.zero(),I.sizeVec3==I.stackVec3.length){let W=new Array(I.sizeVec3<<1),U=0,it=I.sizeVec3;for(;U<it;){let Q=U++;W[Q]=I.stackVec3[Q],I.stackVec3[Q]=null}I.stackVec3=W}I.stackVec3[I.sizeVec3++]=w}let G=this._pool;if(X!=null){if(X.zero(),G.sizeVec3==G.stackVec3.length){let W=new Array(G.sizeVec3<<1),U=0,it=G.sizeVec3;for(;U<it;){let Q=U++;W[Q]=G.stackVec3[Q],G.stackVec3[Q]=null}G.stackVec3=W}G.stackVec3[G.sizeVec3++]=X}let D=this._pool;if(z!=null){if(z.zero(),D.sizeVec3==D.stackVec3.length){let W=new Array(D.sizeVec3<<1),U=0,it=D.sizeVec3;for(;U<it;){let Q=U++;W[Q]=D.stackVec3[Q],D.stackVec3[Q]=null}D.stackVec3=W}D.stackVec3[D.sizeVec3++]=z}let et=this._pool;if(F!=null){if(F.zero(),et.sizeVec3==et.stackVec3.length){let W=new Array(et.sizeVec3<<1),U=0,it=et.sizeVec3;for(;U<it;){let Q=U++;W[Q]=et.stackVec3[Q],et.stackVec3[Q]=null}et.stackVec3=W}et.stackVec3[et.sizeVec3++]=F}let $=this._pool;if(A!=null){if(A.zero(),$.sizeVec3==$.stackVec3.length){let W=new Array($.sizeVec3<<1),U=0,it=$.sizeVec3;for(;U<it;){let Q=U++;W[Q]=$.stackVec3[Q],$.stackVec3[Q]=null}$.stackVec3=W}$.stackVec3[$.sizeVec3++]=A}let j=this._pool;if(S!=null){if(S.zero(),j.sizeVec3==j.stackVec3.length){let W=new Array(j.sizeVec3<<1),U=0,it=j.sizeVec3;for(;U<it;){let Q=U++;W[Q]=j.stackVec3[Q],j.stackVec3[Q]=null}j.stackVec3=W}j.stackVec3[j.sizeVec3++]=S}let q=this._pool;if(E!=null){if(E.e00=1,E.e01=0,E.e02=0,E.e10=0,E.e11=1,E.e12=0,E.e20=0,E.e21=0,E.e22=1,q.sizeMat3==q.stackMat3.length){let W=new Array(q.sizeMat3<<1),U=0,it=q.sizeMat3;for(;U<it;){let Q=U++;W[Q]=q.stackMat3[Q],q.stackMat3[Q]=null}q.stackMat3=W}q.stackMat3[q.sizeMat3++]=E}let tt=this._pool;if(k!=null){if(k.zero(),tt.sizeVec3==tt.stackVec3.length){let W=new Array(tt.sizeVec3<<1),U=0,it=tt.sizeVec3;for(;U<it;){let Q=U++;W[Q]=tt.stackVec3[Q],tt.stackVec3[Q]=null}tt.stackVec3=W}tt.stackVec3[tt.sizeVec3++]=k}break}}if(t.drawAabbs){let a=r._aabb,l=e.aabbColor,h=this._pool,m=h.sizeVec3==0?new y.common.Vec3:h.stackVec3[--h.sizeVec3],f=this._pool,p=f.sizeVec3==0?new y.common.Vec3:f.stackVec3[--f.sizeVec3],d=m;d.x=a._minX,d.y=a._minY,d.z=a._minZ;let u=p;u.x=a._maxX,u.y=a._maxY,u.z=a._maxZ,t.aabb(m,p,l);let g=this._pool;if(m!=null){if(m.zero(),g.sizeVec3==g.stackVec3.length){let x=new Array(g.sizeVec3<<1),b=0,Y=g.sizeVec3;for(;b<Y;){let w=b++;x[w]=g.stackVec3[w],g.stackVec3[w]=null}g.stackVec3=x}g.stackVec3[g.sizeVec3++]=m}let v=this._pool;if(p!=null){if(p.zero(),v.sizeVec3==v.stackVec3.length){let x=new Array(v.sizeVec3<<1),b=0,Y=v.sizeVec3;for(;b<Y;){let w=b++;x[w]=v.stackVec3[w],v.stackVec3[w]=null}v.stackVec3=x}v.stackVec3[v.sizeVec3++]=p}}r=_}i=n}}_drawConstraints(t){let e=t.style;if(t.drawPairs||t.drawContacts){let i=this._contactManager._contactList;for(;i!=null;){let n=i._next;if(t.drawPairs){let s=e.pairColor,o=this._pool,r=o.sizeVec3==0?new y.common.Vec3:o.stackVec3[--o.sizeVec3],_=this._pool,a=_.sizeVec3==0?new y.common.Vec3:_.stackVec3[--_.sizeVec3],l=r;l.x=i._s1._transform._positionX,l.y=i._s1._transform._positionY,l.z=i._s1._transform._positionZ;let h=a;h.x=i._s2._transform._positionX,h.y=i._s2._transform._positionY,h.z=i._s2._transform._positionZ,t.line(r,a,s);let m=this._pool;if(r!=null){if(r.zero(),m.sizeVec3==m.stackVec3.length){let p=new Array(m.sizeVec3<<1),d=0,u=m.sizeVec3;for(;d<u;){let g=d++;p[g]=m.stackVec3[g],m.stackVec3[g]=null}m.stackVec3=p}m.stackVec3[m.sizeVec3++]=r}let f=this._pool;if(a!=null){if(a.zero(),f.sizeVec3==f.stackVec3.length){let p=new Array(f.sizeVec3<<1),d=0,u=f.sizeVec3;for(;d<u;){let g=d++;p[g]=f.stackVec3[g],f.stackVec3[g]=null}f.stackVec3=p}f.stackVec3[f.sizeVec3++]=a}}if(t.drawContacts){let s=i._contactConstraint,o=i._contactConstraint._manifold._points,r=0,_=i._contactConstraint._manifold._numPoints;for(;r<_;){let a=o[r++],l=t.style,h=this._pool,m=h.sizeVec3==0?new y.common.Vec3:h.stackVec3[--h.sizeVec3],f=this._pool,p=f.sizeVec3==0?new y.common.Vec3:f.stackVec3[--f.sizeVec3],d=this._pool,u=d.sizeVec3==0?new y.common.Vec3:d.stackVec3[--d.sizeVec3],g=this._pool,v=g.sizeVec3==0?new y.common.Vec3:g.stackVec3[--g.sizeVec3],x=this._pool,b=x.sizeVec3==0?new y.common.Vec3:x.stackVec3[--x.sizeVec3],Y=m;Y.x=a._pos1X,Y.y=a._pos1Y,Y.z=a._pos1Z;let w=p;w.x=a._pos2X,w.y=a._pos2Y,w.z=a._pos2Z;let Z=u;Z.x=s._manifold._normalX,Z.y=s._manifold._normalY,Z.z=s._manifold._normalZ;let X=v;X.x=s._manifold._tangentX,X.y=s._manifold._tangentY,X.z=s._manifold._tangentZ;let M=b;if(M.x=s._manifold._binormalX,M.y=s._manifold._binormalY,M.z=s._manifold._binormalZ,a._disabled)t.point(m,l.disabledContactColor),t.point(p,l.disabledContactColor),t.line(m,p,l.disabledContactColor);else if(a._warmStarted){let R;switch(a._id&3){case 0:R=l.contactColor;break;case 1:R=l.contactColor2;break;case 2:R=l.contactColor3;break;default:R=l.contactColor4}t.point(m,R),t.point(p,R),t.line(m,p,l.contactColor)}else t.point(m,l.newContactColor),t.point(p,l.newContactColor),t.line(m,p,l.newContactColor);p.x=m.x,p.y=m.y,p.z=m.z;let z=p,T=l.contactNormalLength;if(z.x+=u.x*T,z.y+=u.y*T,z.z+=u.z*T,t.line(m,p,l.contactNormalColor),t.drawContactBases){p.x=m.x,p.y=m.y,p.z=m.z;let R=p,E=l.contactTangentLength;R.x+=v.x*E,R.y+=v.y*E,R.z+=v.z*E,t.line(m,p,l.contactTangentColor),p.x=m.x,p.y=m.y,p.z=m.z;let C=p,k=l.contactBinormalLength;C.x+=b.x*k,C.y+=b.y*k,C.z+=b.z*k,t.line(m,p,l.contactBinormalColor)}let F=this._pool;if(m!=null){if(m.zero(),F.sizeVec3==F.stackVec3.length){let R=new Array(F.sizeVec3<<1),E=0,C=F.sizeVec3;for(;E<C;){let k=E++;R[k]=F.stackVec3[k],F.stackVec3[k]=null}F.stackVec3=R}F.stackVec3[F.sizeVec3++]=m}let P=this._pool;if(p!=null){if(p.zero(),P.sizeVec3==P.stackVec3.length){let R=new Array(P.sizeVec3<<1),E=0,C=P.sizeVec3;for(;E<C;){let k=E++;R[k]=P.stackVec3[k],P.stackVec3[k]=null}P.stackVec3=R}P.stackVec3[P.sizeVec3++]=p}let A=this._pool;if(u!=null){if(u.zero(),A.sizeVec3==A.stackVec3.length){let R=new Array(A.sizeVec3<<1),E=0,C=A.sizeVec3;for(;E<C;){let k=E++;R[k]=A.stackVec3[k],A.stackVec3[k]=null}A.stackVec3=R}A.stackVec3[A.sizeVec3++]=u}let L=this._pool;if(v!=null){if(v.zero(),L.sizeVec3==L.stackVec3.length){let R=new Array(L.sizeVec3<<1),E=0,C=L.sizeVec3;for(;E<C;){let k=E++;R[k]=L.stackVec3[k],L.stackVec3[k]=null}L.stackVec3=R}L.stackVec3[L.sizeVec3++]=v}let S=this._pool;if(b!=null){if(b.zero(),S.sizeVec3==S.stackVec3.length){let R=new Array(S.sizeVec3<<1),E=0,C=S.sizeVec3;for(;E<C;){let k=E++;R[k]=S.stackVec3[k],S.stackVec3[k]=null}S.stackVec3=R}S.stackVec3[S.sizeVec3++]=b}}}i=n}}if(t.drawJoints){let i=this._jointList;for(;i!=null;){let n=i._next,s=this._pool,o=s.sizeVec3==0?new y.common.Vec3:s.stackVec3[--s.sizeVec3],r=this._pool,_=r.sizeVec3==0?new y.common.Vec3:r.stackVec3[--r.sizeVec3],a=o;a.x=i._b1._transform._positionX,a.y=i._b1._transform._positionY,a.z=i._b1._transform._positionZ;let l=_;l.x=i._b2._transform._positionX,l.y=i._b2._transform._positionY,l.z=i._b2._transform._positionZ;let h=this._pool,m=h.sizeVec3==0?new y.common.Vec3:h.stackVec3[--h.sizeVec3],f=this._pool,p=f.sizeVec3==0?new y.common.Vec3:f.stackVec3[--f.sizeVec3],d=this._pool,u=d.sizeVec3==0?new y.common.Vec3:d.stackVec3[--d.sizeVec3],g=this._pool,v=g.sizeVec3==0?new y.common.Vec3:g.stackVec3[--g.sizeVec3],x=this._pool,b=x.sizeVec3==0?new y.common.Vec3:x.stackVec3[--x.sizeVec3],Y=this._pool,w=Y.sizeVec3==0?new y.common.Vec3:Y.stackVec3[--Y.sizeVec3],Z=this._pool,X=Z.sizeVec3==0?new y.common.Vec3:Z.stackVec3[--Z.sizeVec3],M=this._pool,z=M.sizeVec3==0?new y.common.Vec3:M.stackVec3[--M.sizeVec3],T=m;T.x=i._anchor1X,T.y=i._anchor1Y,T.z=i._anchor1Z;let F=p;F.x=i._anchor2X,F.y=i._anchor2Y,F.z=i._anchor2Z;let P=u;P.x=i._basisX1X,P.y=i._basisX1Y,P.z=i._basisX1Z;let A=v;A.x=i._basisY1X,A.y=i._basisY1Y,A.z=i._basisY1Z;let L=b;L.x=i._basisZ1X,L.y=i._basisZ1Y,L.z=i._basisZ1Z;let S=w;S.x=i._basisX2X,S.y=i._basisX2Y,S.z=i._basisX2Z;let R=X;R.x=i._basisY2X,R.y=i._basisY2Y,R.z=i._basisY2Z;let E=z;if(E.x=i._basisZ2X,E.y=i._basisZ2Y,E.z=i._basisZ2Z,t.line(o,m,t.style.jointLineColor),t.line(_,p,t.style.jointLineColor),t.drawJointLimits)switch(i._type){case 0:break;case 1:let j=i._lm;this._drawRotationalLimit(t,m,v,b,X,t.style.jointRotationalConstraintRadius,j.lowerLimit,j.upperLimit,t.style.jointLineColor);break;case 2:let q=i,tt=t.style.jointLineColor,W=q._rotLm,U=q._translLm;this._drawRotationalLimit(t,p,v,b,X,t.style.jointRotationalConstraintRadius,W.lowerLimit,W.upperLimit,tt),this._drawTranslationalLimit(t,m,u,U.lowerLimit,U.upperLimit,tt);break;case 3:let it=i._lm;this._drawTranslationalLimit(t,m,u,it.lowerLimit,it.upperLimit,t.style.jointLineColor);break;case 4:let Q=i,at=t.style.jointRotationalConstraintRadius,ht=t.style.jointLineColor,_t=Q._lm1,mt=Q._lm2;this._drawRotationalLimit(t,m,v,b,v,at,Q._angleX-_t.upperLimit,Q._angleX-_t.lowerLimit,ht),this._drawRotationalLimit(t,p,w,X,w,at,mt.lowerLimit-Q._angleZ,mt.upperLimit-Q._angleZ,ht);break;case 5:let ft=i,ut=t.style.jointRotationalConstraintRadius,H=t.style.jointLineColor,O=ft._twistLm;this._drawRotationalLimit(t,p,X,z,X,ut,O.lowerLimit-ft._twistAngle,O.upperLimit-ft._twistAngle,H),this._drawEllipseOnSphere(t,m,u,v,b,ft._maxSwingAngle1,ft._maxSwingAngle2,ut,H);let ot=this._pool,pt=ot.sizeVec3==0?new y.common.Vec3:ot.stackVec3[--ot.sizeVec3];pt.x=p.x,pt.y=p.y,pt.z=p.z;let vt=pt;vt.x+=w.x*ut,vt.y+=w.y*ut,vt.z+=w.z*ut,t.line(p,vt,H);let xt=this._pool;if(vt!=null){if(vt.zero(),xt.sizeVec3==xt.stackVec3.length){let pe=new Array(xt.sizeVec3<<1),$t=0,Ht=xt.sizeVec3;for(;$t<Ht;){let ue=$t++;pe[ue]=xt.stackVec3[ue],xt.stackVec3[ue]=null}xt.stackVec3=pe}xt.stackVec3[xt.sizeVec3++]=vt}break;case 6:let Mt=i,ct=t.style.jointRotationalConstraintRadius,St=t.style.jointLineColor,It=Mt._rotLms[0],dt=Mt._rotLms[1],K=Mt._rotLms[2];this._drawTranslationalLimit3D(t,m,u,v,b,Mt._translLms[0],Mt._translLms[1],Mt._translLms[2],St);let lt=this._pool,rt=lt.sizeVec3==0?new y.common.Vec3:lt.stackVec3[--lt.sizeVec3],Vt=rt;Vt.x=Mt._axisYX,Vt.y=Mt._axisYY,Vt.z=Mt._axisYZ;let At=this._pool,Yt=At.sizeVec3==0?new y.common.Vec3:At.stackVec3[--At.sizeVec3];Yt.x=u.x,Yt.y=u.y,Yt.z=u.z;let Xt=Yt,Nt=this._pool,ie=Nt.sizeVec3==0?new y.common.Vec3:Nt.stackVec3[--Nt.sizeVec3];ie.x=u.x,ie.y=u.y,ie.z=u.z;let ee=ie,Ze=ee.z*rt.x-ee.x*rt.z,ze=ee.x*rt.y-ee.y*rt.x;ee.x=ee.y*rt.z-ee.z*rt.y,ee.y=Ze,ee.z=ze,this._drawRotationalLimit(t,p,v,b,v,ct,Mt._angleX-It.upperLimit,Mt._angleX-It.lowerLimit,St),this._drawRotationalLimit(t,p,Xt,ee,Xt,ct,dt.lowerLimit-Mt._angleY,dt.upperLimit-Mt._angleY,St),this._drawRotationalLimit(t,p,w,X,w,ct,K.lowerLimit-Mt._angleZ,K.upperLimit-Mt._angleZ,St);break}t.line(m,p,t.style.jointErrorColor);let C=this._pool;if(o!=null){if(o.zero(),C.sizeVec3==C.stackVec3.length){let j=new Array(C.sizeVec3<<1),q=0,tt=C.sizeVec3;for(;q<tt;){let W=q++;j[W]=C.stackVec3[W],C.stackVec3[W]=null}C.stackVec3=j}C.stackVec3[C.sizeVec3++]=o}let k=this._pool;if(_!=null){if(_.zero(),k.sizeVec3==k.stackVec3.length){let j=new Array(k.sizeVec3<<1),q=0,tt=k.sizeVec3;for(;q<tt;){let W=q++;j[W]=k.stackVec3[W],k.stackVec3[W]=null}k.stackVec3=j}k.stackVec3[k.sizeVec3++]=_}let V=this._pool;if(m!=null){if(m.zero(),V.sizeVec3==V.stackVec3.length){let j=new Array(V.sizeVec3<<1),q=0,tt=V.sizeVec3;for(;q<tt;){let W=q++;j[W]=V.stackVec3[W],V.stackVec3[W]=null}V.stackVec3=j}V.stackVec3[V.sizeVec3++]=m}let B=this._pool;if(p!=null){if(p.zero(),B.sizeVec3==B.stackVec3.length){let j=new Array(B.sizeVec3<<1),q=0,tt=B.sizeVec3;for(;q<tt;){let W=q++;j[W]=B.stackVec3[W],B.stackVec3[W]=null}B.stackVec3=j}B.stackVec3[B.sizeVec3++]=p}let J=this._pool;if(u!=null){if(u.zero(),J.sizeVec3==J.stackVec3.length){let j=new Array(J.sizeVec3<<1),q=0,tt=J.sizeVec3;for(;q<tt;){let W=q++;j[W]=J.stackVec3[W],J.stackVec3[W]=null}J.stackVec3=j}J.stackVec3[J.sizeVec3++]=u}let I=this._pool;if(v!=null){if(v.zero(),I.sizeVec3==I.stackVec3.length){let j=new Array(I.sizeVec3<<1),q=0,tt=I.sizeVec3;for(;q<tt;){let W=q++;j[W]=I.stackVec3[W],I.stackVec3[W]=null}I.stackVec3=j}I.stackVec3[I.sizeVec3++]=v}let G=this._pool;if(b!=null){if(b.zero(),G.sizeVec3==G.stackVec3.length){let j=new Array(G.sizeVec3<<1),q=0,tt=G.sizeVec3;for(;q<tt;){let W=q++;j[W]=G.stackVec3[W],G.stackVec3[W]=null}G.stackVec3=j}G.stackVec3[G.sizeVec3++]=b}let D=this._pool;if(w!=null){if(w.zero(),D.sizeVec3==D.stackVec3.length){let j=new Array(D.sizeVec3<<1),q=0,tt=D.sizeVec3;for(;q<tt;){let W=q++;j[W]=D.stackVec3[W],D.stackVec3[W]=null}D.stackVec3=j}D.stackVec3[D.sizeVec3++]=w}let et=this._pool;if(X!=null){if(X.zero(),et.sizeVec3==et.stackVec3.length){let j=new Array(et.sizeVec3<<1),q=0,tt=et.sizeVec3;for(;q<tt;){let W=q++;j[W]=et.stackVec3[W],et.stackVec3[W]=null}et.stackVec3=j}et.stackVec3[et.sizeVec3++]=X}let $=this._pool;if(z!=null){if(z.zero(),$.sizeVec3==$.stackVec3.length){let j=new Array($.sizeVec3<<1),q=0,tt=$.sizeVec3;for(;q<tt;){let W=q++;j[W]=$.stackVec3[W],$.stackVec3[W]=null}$.stackVec3=j}$.stackVec3[$.sizeVec3++]=z}i=n}}}_drawRotationalLimit(t,e,i,n,s,o,r,_,a){if(r!=_){let l=this._pool,h=l.sizeVec3==0?new y.common.Vec3:l.stackVec3[--l.sizeVec3];h.x=e.x,h.y=e.y,h.z=e.z;let m=h;m.x+=s.x*o,m.y+=s.y*o,m.z+=s.z*o,t.line(e,m,a);let f=this._pool;if(m!=null){if(m.zero(),f.sizeVec3==f.stackVec3.length){let p=new Array(f.sizeVec3<<1),d=0,u=f.sizeVec3;for(;d<u;){let g=d++;p[g]=f.stackVec3[g],f.stackVec3[g]=null}f.stackVec3=p}f.stackVec3[f.sizeVec3++]=m}r>_?t.ellipse(e,i,n,o,o,a):t.arc(e,i,n,o,o,r,_,!0,a)}}_drawTranslationalLimit(t,e,i,n,s,o){if(n<s){let r=this._pool,_=r.sizeVec3==0?new y.common.Vec3:r.stackVec3[--r.sizeVec3];_.x=e.x,_.y=e.y,_.z=e.z;let a=_;a.x+=i.x*n,a.y+=i.y*n,a.z+=i.z*n;let l=this._pool,h=l.sizeVec3==0?new y.common.Vec3:l.stackVec3[--l.sizeVec3];h.x=e.x,h.y=e.y,h.z=e.z;let m=h;m.x+=i.x*s,m.y+=i.y*s,m.z+=i.z*s,t.line(a,m,o);let f=this._pool;if(a!=null){if(a.zero(),f.sizeVec3==f.stackVec3.length){let d=new Array(f.sizeVec3<<1),u=0,g=f.sizeVec3;for(;u<g;){let v=u++;d[v]=f.stackVec3[v],f.stackVec3[v]=null}f.stackVec3=d}f.stackVec3[f.sizeVec3++]=a}let p=this._pool;if(m!=null){if(m.zero(),p.sizeVec3==p.stackVec3.length){let d=new Array(p.sizeVec3<<1),u=0,g=p.sizeVec3;for(;u<g;){let v=u++;d[v]=p.stackVec3[v],p.stackVec3[v]=null}p.stackVec3=d}p.stackVec3[p.sizeVec3++]=m}}}_drawTranslationalLimit3D(t,e,i,n,s,o,r,_,a){let l=o.lowerLimit,h=o.upperLimit,m=r.lowerLimit,f=r.upperLimit,p=_.lowerLimit,d=_.upperLimit,u=this._pool;u.sizeVec3==0?new y.common.Vec3:--u.sizeVec3;let g=this._pool;g.sizeVec3==0?new y.common.Vec3:--g.sizeVec3;let v=this._pool,x=v.sizeVec3==0?new y.common.Vec3:v.stackVec3[--v.sizeVec3];x.x=e.x,x.y=e.y,x.z=e.z;let b=x;b.x+=i.x*l,b.y+=i.y*l,b.z+=i.z*l,b.x+=n.x*m,b.y+=n.y*m,b.z+=n.z*m,b.x+=s.x*p,b.y+=s.y*p,b.z+=s.z*p;let Y=this._pool,w=Y.sizeVec3==0?new y.common.Vec3:Y.stackVec3[--Y.sizeVec3];w.x=e.x,w.y=e.y,w.z=e.z;let Z=w;Z.x+=i.x*l,Z.y+=i.y*l,Z.z+=i.z*l,Z.x+=n.x*m,Z.y+=n.y*m,Z.z+=n.z*m,Z.x+=s.x*d,Z.y+=s.y*d,Z.z+=s.z*d;let X=this._pool,M=X.sizeVec3==0?new y.common.Vec3:X.stackVec3[--X.sizeVec3];M.x=e.x,M.y=e.y,M.z=e.z;let z=M;z.x+=i.x*l,z.y+=i.y*l,z.z+=i.z*l,z.x+=n.x*f,z.y+=n.y*f,z.z+=n.z*f,z.x+=s.x*p,z.y+=s.y*p,z.z+=s.z*p;let T=this._pool,F=T.sizeVec3==0?new y.common.Vec3:T.stackVec3[--T.sizeVec3];F.x=e.x,F.y=e.y,F.z=e.z;let P=F;P.x+=i.x*l,P.y+=i.y*l,P.z+=i.z*l,P.x+=n.x*f,P.y+=n.y*f,P.z+=n.z*f,P.x+=s.x*d,P.y+=s.y*d,P.z+=s.z*d;let A=this._pool,L=A.sizeVec3==0?new y.common.Vec3:A.stackVec3[--A.sizeVec3];L.x=e.x,L.y=e.y,L.z=e.z;let S=L;S.x+=i.x*h,S.y+=i.y*h,S.z+=i.z*h,S.x+=n.x*m,S.y+=n.y*m,S.z+=n.z*m,S.x+=s.x*p,S.y+=s.y*p,S.z+=s.z*p;let R=this._pool,E=R.sizeVec3==0?new y.common.Vec3:R.stackVec3[--R.sizeVec3];E.x=e.x,E.y=e.y,E.z=e.z;let C=E;C.x+=i.x*h,C.y+=i.y*h,C.z+=i.z*h,C.x+=n.x*m,C.y+=n.y*m,C.z+=n.z*m,C.x+=s.x*d,C.y+=s.y*d,C.z+=s.z*d;let k=this._pool,V=k.sizeVec3==0?new y.common.Vec3:k.stackVec3[--k.sizeVec3];V.x=e.x,V.y=e.y,V.z=e.z;let B=V;B.x+=i.x*h,B.y+=i.y*h,B.z+=i.z*h,B.x+=n.x*f,B.y+=n.y*f,B.z+=n.z*f,B.x+=s.x*p,B.y+=s.y*p,B.z+=s.z*p;let J=this._pool,I=J.sizeVec3==0?new y.common.Vec3:J.stackVec3[--J.sizeVec3];I.x=e.x,I.y=e.y,I.z=e.z;let G=I;G.x+=i.x*h,G.y+=i.y*h,G.z+=i.z*h,G.x+=n.x*f,G.y+=n.y*f,G.z+=n.z*f,G.x+=s.x*d,G.y+=s.y*d,G.z+=s.z*d,t.line(b,S,a),t.line(z,B,a),t.line(Z,C,a),t.line(P,G,a),t.line(b,z,a),t.line(S,B,a),t.line(Z,P,a),t.line(C,G,a),t.line(b,Z,a),t.line(S,C,a),t.line(z,P,a),t.line(B,G,a);let D=this._pool;if(b!=null){if(b.zero(),D.sizeVec3==D.stackVec3.length){let it=new Array(D.sizeVec3<<1),Q=0,at=D.sizeVec3;for(;Q<at;){let ht=Q++;it[ht]=D.stackVec3[ht],D.stackVec3[ht]=null}D.stackVec3=it}D.stackVec3[D.sizeVec3++]=b}let et=this._pool;if(Z!=null){if(Z.zero(),et.sizeVec3==et.stackVec3.length){let it=new Array(et.sizeVec3<<1),Q=0,at=et.sizeVec3;for(;Q<at;){let ht=Q++;it[ht]=et.stackVec3[ht],et.stackVec3[ht]=null}et.stackVec3=it}et.stackVec3[et.sizeVec3++]=Z}let $=this._pool;if(z!=null){if(z.zero(),$.sizeVec3==$.stackVec3.length){let it=new Array($.sizeVec3<<1),Q=0,at=$.sizeVec3;for(;Q<at;){let ht=Q++;it[ht]=$.stackVec3[ht],$.stackVec3[ht]=null}$.stackVec3=it}$.stackVec3[$.sizeVec3++]=z}let j=this._pool;if(P!=null){if(P.zero(),j.sizeVec3==j.stackVec3.length){let it=new Array(j.sizeVec3<<1),Q=0,at=j.sizeVec3;for(;Q<at;){let ht=Q++;it[ht]=j.stackVec3[ht],j.stackVec3[ht]=null}j.stackVec3=it}j.stackVec3[j.sizeVec3++]=P}let q=this._pool;if(S!=null){if(S.zero(),q.sizeVec3==q.stackVec3.length){let it=new Array(q.sizeVec3<<1),Q=0,at=q.sizeVec3;for(;Q<at;){let ht=Q++;it[ht]=q.stackVec3[ht],q.stackVec3[ht]=null}q.stackVec3=it}q.stackVec3[q.sizeVec3++]=S}let tt=this._pool;if(C!=null){if(C.zero(),tt.sizeVec3==tt.stackVec3.length){let it=new Array(tt.sizeVec3<<1),Q=0,at=tt.sizeVec3;for(;Q<at;){let ht=Q++;it[ht]=tt.stackVec3[ht],tt.stackVec3[ht]=null}tt.stackVec3=it}tt.stackVec3[tt.sizeVec3++]=C}let W=this._pool;if(B!=null){if(B.zero(),W.sizeVec3==W.stackVec3.length){let it=new Array(W.sizeVec3<<1),Q=0,at=W.sizeVec3;for(;Q<at;){let ht=Q++;it[ht]=W.stackVec3[ht],W.stackVec3[ht]=null}W.stackVec3=it}W.stackVec3[W.sizeVec3++]=B}let U=this._pool;if(G!=null){if(G.zero(),U.sizeVec3==U.stackVec3.length){let it=new Array(U.sizeVec3<<1),Q=0,at=U.sizeVec3;for(;Q<at;){let ht=Q++;it[ht]=U.stackVec3[ht],U.stackVec3[ht]=null}U.stackVec3=it}U.stackVec3[U.sizeVec3++]=G}}_drawEllipseOnSphere(t,e,i,n,s,o,r,_,a){let l=0,h=this._pool,m=h.sizeVec3==0?new y.common.Vec3:h.stackVec3[--h.sizeVec3],f=this._pool,p=f.sizeQuat==0?new y.common.Quat:f.stackQuat[--f.sizeQuat],d=this._pool,u=d.sizeMat3==0?new y.common.Mat3:d.stackMat3[--d.sizeMat3],g=this._pool,v=g.sizeVec3==0?new y.common.Vec3:g.stackVec3[--g.sizeVec3],x=0;for(;x<17;){let X=x++,M=Math.cos(l)*o,z=Math.sin(l)*r,T=Math.sqrt(M*M+z*z),F=Math.sin(T*.5),P=Math.cos(T*.5),A=m.zero();A.x+=n.x*M,A.y+=n.y*M,A.z+=n.z*M,A.x+=s.x*z,A.y+=s.y*z,A.z+=s.z*z;let L=1/T*F;m.x*=L,m.y*=L,m.z*=L,p.x=m.x,p.y=m.y,p.z=m.z,p.w=P;let S=p.x,R=p.y,E=p.z,C=p.w,k=2*S,V=2*R,B=2*E,J=S*k,I=R*V,G=E*B,D=S*V,et=R*B,$=S*B,j=C*k,q=C*V,tt=C*B;u.e00=1-I-G,u.e01=D-tt,u.e02=$+q,u.e10=D+tt,u.e11=1-J-G,u.e12=et-j,u.e20=$-q,u.e21=et+j,u.e22=1-J-I;let W=this._pool,U=W.sizeVec3==0?new y.common.Vec3:W.stackVec3[--W.sizeVec3];U.x+=i.x*_,U.y+=i.y*_,U.z+=i.z*_;let it=U,Q=it.x*u.e10+it.y*u.e11+it.z*u.e12,at=it.x*u.e20+it.y*u.e21+it.z*u.e22;it.x=it.x*u.e00+it.y*u.e01+it.z*u.e02,it.y=Q,it.z=at,it.x+=e.x,it.y+=e.y,it.z+=e.z,X>=1&&t.line(v,it,a);let ht=this._pool;if(v!=null){if(v.zero(),ht.sizeVec3==ht.stackVec3.length){let _t=new Array(ht.sizeVec3<<1),mt=0,ft=ht.sizeVec3;for(;mt<ft;){let ut=mt++;_t[ut]=ht.stackVec3[ut],ht.stackVec3[ut]=null}ht.stackVec3=_t}ht.stackVec3[ht.sizeVec3++]=v}v=it,l+=.39269908169872375}let b=this._pool;if(m!=null){if(m.zero(),b.sizeVec3==b.stackVec3.length){let X=new Array(b.sizeVec3<<1),M=0,z=b.sizeVec3;for(;M<z;){let T=M++;X[T]=b.stackVec3[T],b.stackVec3[T]=null}b.stackVec3=X}b.stackVec3[b.sizeVec3++]=m}let Y=this._pool;if(p!=null){if(p.x=0,p.y=0,p.z=0,p.w=1,Y.sizeQuat==Y.stackQuat.length){let X=new Array(Y.sizeQuat<<1),M=0,z=Y.sizeQuat;for(;M<z;){let T=M++;X[T]=Y.stackQuat[T],Y.stackQuat[T]=null}Y.stackQuat=X}Y.stackQuat[Y.sizeQuat++]=p}let w=this._pool;if(u!=null){if(u.e00=1,u.e01=0,u.e02=0,u.e10=0,u.e11=1,u.e12=0,u.e20=0,u.e21=0,u.e22=1,w.sizeMat3==w.stackMat3.length){let X=new Array(w.sizeMat3<<1),M=0,z=w.sizeMat3;for(;M<z;){let T=M++;X[T]=w.stackMat3[T],w.stackMat3[T]=null}w.stackMat3=X}w.stackMat3[w.sizeMat3++]=u}let Z=this._pool;if(v!=null){if(v.zero(),Z.sizeVec3==Z.stackVec3.length){let X=new Array(Z.sizeVec3<<1),M=0,z=Z.sizeVec3;for(;M<z;){let T=M++;X[T]=Z.stackVec3[T],Z.stackVec3[T]=null}Z.stackVec3=X}Z.stackVec3[Z.sizeVec3++]=v}}step(t){this._timeStep.dt>0&&(this._timeStep.dtRatio=t/this._timeStep.dt),this._timeStep.dt=t,this._timeStep.invDt=1/t;let e=Date.now()/1e3;this._updateContacts(),this._solveIslands(),y.dynamics.common.Performance.totalTime=(Date.now()/1e3-e)*1e3}addRigidBody(t){if(t._world!=null)throw new Error("A rigid body cannot belong to multiple worlds.");this._rigidBodyList==null?(this._rigidBodyList=t,this._rigidBodyListLast=t):(this._rigidBodyListLast._next=t,t._prev=this._rigidBodyListLast,this._rigidBodyListLast=t),t._world=this;let e=t._shapeList;for(;e!=null;){let i=e._next;e._proxy=this._broadPhase.createProxy(e,e._aabb),e._id=this._shapeIdCount++,this._numShapes++,e=i}this._numRigidBodies++}removeRigidBody(t){if(t._world!=this)throw new Error("The rigid body doesn't belong to the world.");let e=t._prev,i=t._next;e!=null&&(e._next=i),i!=null&&(i._prev=e),t==this._rigidBodyList&&(this._rigidBodyList=this._rigidBodyList._next),t==this._rigidBodyListLast&&(this._rigidBodyListLast=this._rigidBodyListLast._prev),t._next=null,t._prev=null,t._world=null;let n=t._shapeList;for(;n!=null;){let s=n._next;this._broadPhase.destroyProxy(n._proxy),n._proxy=null,n._id=-1;let o=n._rigidBody._contactLinkList;for(;o!=null;){let r=o._next,_=o._contact;if(_._s1==n||_._s2==n){let a=o._other;a._sleeping=!1,a._sleepTime=0;let l=this._contactManager,h=_._prev,m=_._next;if(h!=null&&(h._next=m),m!=null&&(m._prev=h),_==l._contactList&&(l._contactList=l._contactList._next),_==l._contactListLast&&(l._contactListLast=l._contactListLast._prev),_._next=null,_._prev=null,_._touching){let v=_._s1._contactCallback,x=_._s2._contactCallback;v==x&&(x=null),v!=null&&v.endContact(_),x!=null&&x.endContact(_)}let f=_._link1._prev,p=_._link1._next;f!=null&&(f._next=p),p!=null&&(p._prev=f),_._link1==_._b1._contactLinkList&&(_._b1._contactLinkList=_._b1._contactLinkList._next),_._link1==_._b1._contactLinkListLast&&(_._b1._contactLinkListLast=_._b1._contactLinkListLast._prev),_._link1._next=null,_._link1._prev=null;let d=_._link2._prev,u=_._link2._next;d!=null&&(d._next=u),u!=null&&(u._prev=d),_._link2==_._b2._contactLinkList&&(_._b2._contactLinkList=_._b2._contactLinkList._next),_._link2==_._b2._contactLinkListLast&&(_._b2._contactLinkListLast=_._b2._contactLinkListLast._prev),_._link2._next=null,_._link2._prev=null,_._b1._numContactLinks--,_._b2._numContactLinks--,_._link1._other=null,_._link2._other=null,_._link1._contact=null,_._link2._contact=null,_._s1=null,_._s2=null,_._b1=null,_._b2=null,_._touching=!1,_._cachedDetectorData._clear(),_._manifold._clear(),_._detector=null;let g=_._contactConstraint;g._s1=null,g._s2=null,g._b1=null,g._b2=null,g._tf1=null,g._tf2=null,_._next=l._contactPool,l._contactPool=_,l._numContacts--}o=r}this._numShapes--,n=s}this._numRigidBodies--}addJoint(t){if(t._world!=null)throw new Error("A joint cannot belong to multiple worlds.");this._jointList==null?(this._jointList=t,this._jointListLast=t):(this._jointListLast._next=t,t._prev=this._jointListLast,this._jointListLast=t),t._world=this,t._link1._other=t._b2,t._link2._other=t._b1,t._b1._jointLinkList==null?(t._b1._jointLinkList=t._link1,t._b1._jointLinkListLast=t._link1):(t._b1._jointLinkListLast._next=t._link1,t._link1._prev=t._b1._jointLinkListLast,t._b1._jointLinkListLast=t._link1),t._b2._jointLinkList==null?(t._b2._jointLinkList=t._link2,t._b2._jointLinkListLast=t._link2):(t._b2._jointLinkListLast._next=t._link2,t._link2._prev=t._b2._jointLinkListLast,t._b2._jointLinkListLast=t._link2),t._b1._numJointLinks++,t._b2._numJointLinks++;let e=t._b1;e._sleeping=!1,e._sleepTime=0;let i=t._b2;i._sleeping=!1,i._sleepTime=0,t._syncAnchors(),this._numJoints++}removeJoint(t){if(t._world!=this)throw new Error("The joint doesn't belong to the world.");let e=t._prev,i=t._next;e!=null&&(e._next=i),i!=null&&(i._prev=e),t==this._jointList&&(this._jointList=this._jointList._next),t==this._jointListLast&&(this._jointListLast=this._jointListLast._prev),t._next=null,t._prev=null,t._world=null;let n=t._link1._prev,s=t._link1._next;n!=null&&(n._next=s),s!=null&&(s._prev=n),t._link1==t._b1._jointLinkList&&(t._b1._jointLinkList=t._b1._jointLinkList._next),t._link1==t._b1._jointLinkListLast&&(t._b1._jointLinkListLast=t._b1._jointLinkListLast._prev),t._link1._next=null,t._link1._prev=null;let o=t._link2._prev,r=t._link2._next;o!=null&&(o._next=r),r!=null&&(r._prev=o),t._link2==t._b2._jointLinkList&&(t._b2._jointLinkList=t._b2._jointLinkList._next),t._link2==t._b2._jointLinkListLast&&(t._b2._jointLinkListLast=t._b2._jointLinkListLast._prev),t._link2._next=null,t._link2._prev=null,t._link1._other=null,t._link2._other=null,t._b1._numJointLinks--,t._b2._numJointLinks--;let _=t._b1;_._sleeping=!1,_._sleepTime=0;let a=t._b2;a._sleeping=!1,a._sleepTime=0,this._numJoints--}setDebugDraw(t){this._debugDraw=t}getDebugDraw(){return this._debugDraw}debugDraw(){this._debugDraw!=null&&(this._broadPhase._type==2&&this._drawBvh(this._debugDraw,this._broadPhase._tree),this._drawRigidBodies(this._debugDraw),this._drawConstraints(this._debugDraw))}rayCast(t,e,i){let n=this._rayCastWrapper.begin;n.x=t.x,n.y=t.y,n.z=t.z;let s=this._rayCastWrapper.end;s.x=e.x,s.y=e.y,s.z=e.z,this._rayCastWrapper.callback=i,this._broadPhase.rayCast(t,e,this._rayCastWrapper)}convexCast(t,e,i,n){this._convexCastWrapper.convex=t;let s=this._convexCastWrapper.begin;s._positionX=e._positionX,s._positionY=e._positionY,s._positionZ=e._positionZ,s._rotation00=e._rotation00,s._rotation01=e._rotation01,s._rotation02=e._rotation02,s._rotation10=e._rotation10,s._rotation11=e._rotation11,s._rotation12=e._rotation12,s._rotation20=e._rotation20,s._rotation21=e._rotation21,s._rotation22=e._rotation22;let o=this._convexCastWrapper.translation;o.x=i.x,o.y=i.y,o.z=i.z,this._convexCastWrapper.callback=n,this._broadPhase.convexCast(t,e,i,this._convexCastWrapper)}aabbTest(t,e){this._aabbTestWrapper._aabb.copyFrom(t),this._aabbTestWrapper._callback=e,this._broadPhase.aabbTest(t,this._aabbTestWrapper)}getRigidBodyList(){return this._rigidBodyList}getJointList(){return this._jointList}getBroadPhase(){return this._broadPhase}getContactManager(){return this._contactManager}getNumRigidBodies(){return this._numRigidBodies}getNumJoints(){return this._numJoints}getNumShapes(){return this._numShapes}getNumIslands(){return this._numIslands}getNumVelocityIterations(){return this._numVelocityIterations}setNumVelocityIterations(t){this._numVelocityIterations=t}getNumPositionIterations(){return this._numPositionIterations}setNumPositionIterations(t){this._numPositionIterations=t}getGravity(){return this._gravity}setGravity(t){let e=this._gravity;e.x=t.x,e.y=t.y,e.z=t.z}};y.dynamics._World||(y.dynamics._World={});y.dynamics._World.RayCastWrapper=class extends y.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new y.collision.geometry.RayCastHit,this.begin=new y.common.Vec3,this.end=new y.common.Vec3,this.callback=null}process(t){let e=t.userData;e._geom.rayCast(this.begin,this.end,e._transform,this.rayCastHit)&&this.callback.process(e,this.rayCastHit)}};y.dynamics._World.ConvexCastWrapper=class extends y.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new y.collision.geometry.RayCastHit,this.begin=new y.common.Transform,this.translation=new y.common.Vec3,this.zero=new y.common.Vec3,this.callback=null,this.convex=null}process(t){let e=t.userData,i=e._geom._type;i<0||i>5||y.collision.narrowphase.detector.gjkepa.GjkEpa.instance.convexCast(this.convex,e._geom,this.begin,e._transform,this.translation,this.zero,this.rayCastHit)&&this.callback.process(e,this.rayCastHit)}};y.dynamics._World.AabbTestWrapper=class extends y.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this._aabb=new y.collision.geometry.Aabb,this._callback=null}process(t){let e=t.userData,i=e._aabb;i._minX<this._aabb._maxX&&i._maxX>this._aabb._minX&&i._minY<this._aabb._maxY&&i._maxY>this._aabb._minY&&i._minZ<this._aabb._maxZ&&i._maxZ>this._aabb._minZ&&this._callback.process(e)}};y.dynamics.callback||(y.dynamics.callback={});y.dynamics.callback.AabbTestCallback=class{constructor(){}process(t){}};y.dynamics.callback.ContactCallback=class{constructor(){}beginContact(t){}preSolve(t){}postSolve(t){}endContact(t){}};y.dynamics.callback.RayCastCallback=class{constructor(){}process(t,e){}};y.dynamics.callback.RayCastClosest=class extends y.dynamics.callback.RayCastCallback{constructor(){super(),this.position=new y.common.Vec3,this.normal=new y.common.Vec3,this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}clear(){this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}process(t,e){if(e.fraction<this.fraction){this.shape=t,this.hit=!0,this.fraction=e.fraction;let i=this.position,n=e.position;i.x=n.x,i.y=n.y,i.z=n.z;let s=this.normal,o=e.normal;s.x=o.x,s.y=o.y,s.z=o.z}}};y.dynamics.common||(y.dynamics.common={});y.dynamics.common.DebugDraw=class{constructor(){this.p=new y.common.Pool,this.wireframe=!1,this.drawShapes=!0,this.drawBvh=!1,this.drawBvhMinLevel=0,this.drawBvhMaxLevel=65536,this.drawAabbs=!1,this.drawBases=!1,this.drawPairs=!1,this.drawContacts=!1,this.drawJoints=!0,this.drawJointLimits=!1,this.sphereCoords=new Array(5),this.tmpSphereVerts=new Array(5),this.tmpSphereNorms=new Array(5);let t=0;for(;t<5;){let i=t++,n=i==0||i==4?1:8;this.sphereCoords[i]=new Array(n),this.tmpSphereVerts[i]=new Array(n),this.tmpSphereNorms[i]=new Array(n);let s=0;for(;s<8;){let o=s++,r=i*.7853981633974475,_=o*.7853981633974475;this.sphereCoords[i][o]=new y.common.Vec3(Math.sin(r)*Math.cos(_),Math.cos(r),-Math.sin(r)*Math.sin(_)),this.tmpSphereVerts[i][o]=new y.common.Vec3,this.tmpSphereNorms[i][o]=new y.common.Vec3}}this.circleCoords=new Array(8),this.circleCoordsShift=new Array(8),this.tmpCircleVerts1=new Array(8),this.tmpCircleVerts2=new Array(8),this.tmpCircleNorms=new Array(8);let e=0;for(;e<8;){let i=e++;this.circleCoords[i]=new y.common.Vec3(Math.cos(i*.7853981633974475),0,-Math.sin(i*.7853981633974475)),this.circleCoordsShift[i]=new y.common.Vec3(Math.cos((i+.5)*.7853981633974475),0,-Math.sin((i+.5)*.7853981633974475)),this.tmpCircleVerts1[i]=new y.common.Vec3,this.tmpCircleVerts2[i]=new y.common.Vec3,this.tmpCircleNorms[i]=new y.common.Vec3}this.style=new y.dynamics.common.DebugDrawStyle}aabb(t,e,i){let n=this.p,s=(n.sizeVec3==0?new y.common.Vec3:n.stackVec3[--n.sizeVec3]).init(t.x,t.y,t.z),o=this.p,r=(o.sizeVec3==0?new y.common.Vec3:o.stackVec3[--o.sizeVec3]).init(t.x,t.y,e.z),_=this.p,a=(_.sizeVec3==0?new y.common.Vec3:_.stackVec3[--_.sizeVec3]).init(t.x,e.y,t.z),l=this.p,h=(l.sizeVec3==0?new y.common.Vec3:l.stackVec3[--l.sizeVec3]).init(t.x,e.y,e.z),m=this.p,f=(m.sizeVec3==0?new y.common.Vec3:m.stackVec3[--m.sizeVec3]).init(e.x,t.y,t.z),p=this.p,d=(p.sizeVec3==0?new y.common.Vec3:p.stackVec3[--p.sizeVec3]).init(e.x,t.y,e.z),u=this.p,g=(u.sizeVec3==0?new y.common.Vec3:u.stackVec3[--u.sizeVec3]).init(e.x,e.y,t.z),v=this.p,x=(v.sizeVec3==0?new y.common.Vec3:v.stackVec3[--v.sizeVec3]).init(e.x,e.y,e.z);this.line(s,r,i),this.line(a,h,i),this.line(f,d,i),this.line(g,x,i),this.line(s,a,i),this.line(r,h,i),this.line(f,g,i),this.line(d,x,i),this.line(s,f,i),this.line(r,d,i),this.line(a,g,i),this.line(h,x,i);let b=this.p;if(s!=null){if(s.zero(),b.sizeVec3==b.stackVec3.length){let F=new Array(b.sizeVec3<<1),P=0,A=b.sizeVec3;for(;P<A;){let L=P++;F[L]=b.stackVec3[L],b.stackVec3[L]=null}b.stackVec3=F}b.stackVec3[b.sizeVec3++]=s}let Y=this.p;if(r!=null){if(r.zero(),Y.sizeVec3==Y.stackVec3.length){let F=new Array(Y.sizeVec3<<1),P=0,A=Y.sizeVec3;for(;P<A;){let L=P++;F[L]=Y.stackVec3[L],Y.stackVec3[L]=null}Y.stackVec3=F}Y.stackVec3[Y.sizeVec3++]=r}let w=this.p;if(a!=null){if(a.zero(),w.sizeVec3==w.stackVec3.length){let F=new Array(w.sizeVec3<<1),P=0,A=w.sizeVec3;for(;P<A;){let L=P++;F[L]=w.stackVec3[L],w.stackVec3[L]=null}w.stackVec3=F}w.stackVec3[w.sizeVec3++]=a}let Z=this.p;if(h!=null){if(h.zero(),Z.sizeVec3==Z.stackVec3.length){let F=new Array(Z.sizeVec3<<1),P=0,A=Z.sizeVec3;for(;P<A;){let L=P++;F[L]=Z.stackVec3[L],Z.stackVec3[L]=null}Z.stackVec3=F}Z.stackVec3[Z.sizeVec3++]=h}let X=this.p;if(f!=null){if(f.zero(),X.sizeVec3==X.stackVec3.length){let F=new Array(X.sizeVec3<<1),P=0,A=X.sizeVec3;for(;P<A;){let L=P++;F[L]=X.stackVec3[L],X.stackVec3[L]=null}X.stackVec3=F}X.stackVec3[X.sizeVec3++]=f}let M=this.p;if(d!=null){if(d.zero(),M.sizeVec3==M.stackVec3.length){let F=new Array(M.sizeVec3<<1),P=0,A=M.sizeVec3;for(;P<A;){let L=P++;F[L]=M.stackVec3[L],M.stackVec3[L]=null}M.stackVec3=F}M.stackVec3[M.sizeVec3++]=d}let z=this.p;if(g!=null){if(g.zero(),z.sizeVec3==z.stackVec3.length){let F=new Array(z.sizeVec3<<1),P=0,A=z.sizeVec3;for(;P<A;){let L=P++;F[L]=z.stackVec3[L],z.stackVec3[L]=null}z.stackVec3=F}z.stackVec3[z.sizeVec3++]=g}let T=this.p;if(x!=null){if(x.zero(),T.sizeVec3==T.stackVec3.length){let F=new Array(T.sizeVec3<<1),P=0,A=T.sizeVec3;for(;P<A;){let L=P++;F[L]=T.stackVec3[L],T.stackVec3[L]=null}T.stackVec3=F}T.stackVec3[T.sizeVec3++]=x}}basis(t,e,i,n,s){let o=this.p,r=o.sizeVec3==0?new y.common.Vec3:o.stackVec3[--o.sizeVec3],_=this.p,a=_.sizeMat3==0?new y.common.Mat3:_.stackMat3[--_.sizeMat3],l=this.p,h=l.sizeVec3==0?new y.common.Vec3:l.stackVec3[--l.sizeVec3],m=this.p,f=m.sizeVec3==0?new y.common.Vec3:m.stackVec3[--m.sizeVec3],p=this.p,d=p.sizeVec3==0?new y.common.Vec3:p.stackVec3[--p.sizeVec3],u=r;u.x=t._positionX,u.y=t._positionY,u.z=t._positionZ;let g=a;g.e00=t._rotation00,g.e01=t._rotation01,g.e02=t._rotation02,g.e10=t._rotation10,g.e11=t._rotation11,g.e12=t._rotation12,g.e20=t._rotation20,g.e21=t._rotation21,g.e22=t._rotation22,h.init(a.e00,a.e10,a.e20),f.init(a.e01,a.e11,a.e21),d.init(a.e02,a.e12,a.e22),h.x*=e,h.y*=e,h.z*=e;let v=h;v.x+=r.x,v.y+=r.y,v.z+=r.z,f.x*=e,f.y*=e,f.z*=e;let x=f;x.x+=r.x,x.y+=r.y,x.z+=r.z,d.x*=e,d.y*=e,d.z*=e;let b=d;b.x+=r.x,b.y+=r.y,b.z+=r.z,this.line(r,h,i),this.line(r,f,n),this.line(r,d,s);let Y=this.p;if(r!=null){if(r.zero(),Y.sizeVec3==Y.stackVec3.length){let z=new Array(Y.sizeVec3<<1),T=0,F=Y.sizeVec3;for(;T<F;){let P=T++;z[P]=Y.stackVec3[P],Y.stackVec3[P]=null}Y.stackVec3=z}Y.stackVec3[Y.sizeVec3++]=r}let w=this.p;if(a!=null){if(a.e00=1,a.e01=0,a.e02=0,a.e10=0,a.e11=1,a.e12=0,a.e20=0,a.e21=0,a.e22=1,w.sizeMat3==w.stackMat3.length){let z=new Array(w.sizeMat3<<1),T=0,F=w.sizeMat3;for(;T<F;){let P=T++;z[P]=w.stackMat3[P],w.stackMat3[P]=null}w.stackMat3=z}w.stackMat3[w.sizeMat3++]=a}let Z=this.p;if(h!=null){if(h.zero(),Z.sizeVec3==Z.stackVec3.length){let z=new Array(Z.sizeVec3<<1),T=0,F=Z.sizeVec3;for(;T<F;){let P=T++;z[P]=Z.stackVec3[P],Z.stackVec3[P]=null}Z.stackVec3=z}Z.stackVec3[Z.sizeVec3++]=h}let X=this.p;if(f!=null){if(f.zero(),X.sizeVec3==X.stackVec3.length){let z=new Array(X.sizeVec3<<1),T=0,F=X.sizeVec3;for(;T<F;){let P=T++;z[P]=X.stackVec3[P],X.stackVec3[P]=null}X.stackVec3=z}X.stackVec3[X.sizeVec3++]=f}let M=this.p;if(d!=null){if(d.zero(),M.sizeVec3==M.stackVec3.length){let z=new Array(M.sizeVec3<<1),T=0,F=M.sizeVec3;for(;T<F;){let P=T++;z[P]=M.stackVec3[P],M.stackVec3[P]=null}M.stackVec3=z}M.stackVec3[M.sizeVec3++]=d}}ellipse(t,e,i,n,s,o){this.arc(t,e,i,n,s,0,6.28318530717958,!1,o)}arc(t,e,i,n,s,o,r,_,a){let l=this.p,h=l.sizeVec3==0?new y.common.Vec3:l.stackVec3[--l.sizeVec3];h.x=e.x,h.y=e.y,h.z=e.z;let m=h;m.x*=n,m.y*=n,m.z*=n;let f=this.p,p=f.sizeVec3==0?new y.common.Vec3:f.stackVec3[--f.sizeVec3];p.x=i.x,p.y=i.y,p.z=i.z;let d=p;d.x*=s,d.y*=s,d.z*=s;let u=r-o;u<0&&(u=-u);let g=u/.5235987755982984+.5|0;g==0&&(g=1);let v=o,x=(r-o)/g,b=this.p,Y=b.sizeVec3==0?new y.common.Vec3:b.stackVec3[--b.sizeVec3];Y.x=t.x,Y.y=t.y,Y.z=t.z;let w=Y,Z=Math.cos(o);w.x+=m.x*Z,w.y+=m.y*Z,w.z+=m.z*Z;let X=Math.sin(o);w.x+=d.x*X,w.y+=d.y*X,w.z+=d.z*X;let M=w;_&&this.line(t,w,a);let z=0,T=g;for(;z<T;){++z,v+=x;let L=this.p,S=L.sizeVec3==0?new y.common.Vec3:L.stackVec3[--L.sizeVec3];S.x=t.x,S.y=t.y,S.z=t.z;let R=S,E=Math.cos(v);R.x+=m.x*E,R.y+=m.y*E,R.z+=m.z*E;let C=Math.sin(v);R.x+=d.x*C,R.y+=d.y*C,R.z+=d.z*C,this.line(M,R,a);let k=this.p;if(M!=null){if(M.zero(),k.sizeVec3==k.stackVec3.length){let V=new Array(k.sizeVec3<<1),B=0,J=k.sizeVec3;for(;B<J;){let I=B++;V[I]=k.stackVec3[I],k.stackVec3[I]=null}k.stackVec3=V}k.stackVec3[k.sizeVec3++]=M}M=R}_&&this.line(t,M,a);let F=this.p;if(M!=null){if(M.zero(),F.sizeVec3==F.stackVec3.length){let L=new Array(F.sizeVec3<<1),S=0,R=F.sizeVec3;for(;S<R;){let E=S++;L[E]=F.stackVec3[E],F.stackVec3[E]=null}F.stackVec3=L}F.stackVec3[F.sizeVec3++]=M}let P=this.p;if(m!=null){if(m.zero(),P.sizeVec3==P.stackVec3.length){let L=new Array(P.sizeVec3<<1),S=0,R=P.sizeVec3;for(;S<R;){let E=S++;L[E]=P.stackVec3[E],P.stackVec3[E]=null}P.stackVec3=L}P.stackVec3[P.sizeVec3++]=m}let A=this.p;if(d!=null){if(d.zero(),A.sizeVec3==A.stackVec3.length){let L=new Array(A.sizeVec3<<1),S=0,R=A.sizeVec3;for(;S<R;){let E=S++;L[E]=A.stackVec3[E],A.stackVec3[E]=null}A.stackVec3=L}A.stackVec3[A.sizeVec3++]=d}}cone(t,e,i,n){let s=this.p,o=s.sizeVec3==0?new y.common.Vec3:s.stackVec3[--s.sizeVec3],r=this.p,_=r.sizeVec3==0?new y.common.Vec3:r.stackVec3[--r.sizeVec3],a=this.p,l=a.sizeVec3==0?new y.common.Vec3:a.stackVec3[--a.sizeVec3],h=this.p,m=h.sizeVec3==0?new y.common.Vec3:h.stackVec3[--h.sizeVec3],f=this.p,p=f.sizeMat3==0?new y.common.Mat3:f.stackMat3[--f.sizeMat3],d=m;d.x=t._positionX,d.y=t._positionY,d.z=t._positionZ;let u=p;u.e00=t._rotation00,u.e01=t._rotation01,u.e02=t._rotation02,u.e10=t._rotation10,u.e11=t._rotation11,u.e12=t._rotation12,u.e20=t._rotation20,u.e21=t._rotation21,u.e22=t._rotation22,o.init(p.e00,p.e10,p.e20),_.init(p.e01,p.e11,p.e21),l.init(p.e02,p.e12,p.e22);let g=this.p,v=g.sizeVec3==0?new y.common.Vec3:g.stackVec3[--g.sizeVec3];v.x=m.x,v.y=m.y,v.z=m.z;let x=v;x.x+=_.x*i,x.y+=_.y*i,x.z+=_.z*i;let b=this.p,Y=b.sizeVec3==0?new y.common.Vec3:b.stackVec3[--b.sizeVec3];Y.x=m.x,Y.y=m.y,Y.z=m.z;let w=Y,Z=-i;if(w.x+=_.x*Z,w.y+=_.y*Z,w.z+=_.z*Z,this.wireframe){let L=this.p,S=L.sizeVec3==0?new y.common.Vec3:L.stackVec3[--L.sizeVec3];S.x=w.x,S.y=w.y,S.z=w.z;let R=S,E=-e;R.x+=o.x*E,R.y+=o.y*E,R.z+=o.z*E,R.x+=l.x*0,R.y+=l.y*0,R.z+=l.z*0;let C=this.p,k=C.sizeVec3==0?new y.common.Vec3:C.stackVec3[--C.sizeVec3];k.x=w.x,k.y=w.y,k.z=w.z;let V=k;V.x+=o.x*e,V.y+=o.y*e,V.z+=o.z*e,V.x+=l.x*0,V.y+=l.y*0,V.z+=l.z*0;let B=this.p,J=B.sizeVec3==0?new y.common.Vec3:B.stackVec3[--B.sizeVec3];J.x=w.x,J.y=w.y,J.z=w.z;let I=J;I.x+=o.x*0,I.y+=o.y*0,I.z+=o.z*0;let G=-e;I.x+=l.x*G,I.y+=l.y*G,I.z+=l.z*G;let D=this.p,et=D.sizeVec3==0?new y.common.Vec3:D.stackVec3[--D.sizeVec3];et.x=w.x,et.y=w.y,et.z=w.z;let $=et;$.x+=o.x*0,$.y+=o.y*0,$.z+=o.z*0,$.x+=l.x*e,$.y+=l.y*e,$.z+=l.z*e,this.ellipse(w,o,l,e,e,n),this.line(x,R,n),this.line(x,V,n),this.line(x,I,n),this.line(x,$,n);let j=this.p;if(R!=null){if(R.zero(),j.sizeVec3==j.stackVec3.length){let U=new Array(j.sizeVec3<<1),it=0,Q=j.sizeVec3;for(;it<Q;){let at=it++;U[at]=j.stackVec3[at],j.stackVec3[at]=null}j.stackVec3=U}j.stackVec3[j.sizeVec3++]=R}let q=this.p;if(V!=null){if(V.zero(),q.sizeVec3==q.stackVec3.length){let U=new Array(q.sizeVec3<<1),it=0,Q=q.sizeVec3;for(;it<Q;){let at=it++;U[at]=q.stackVec3[at],q.stackVec3[at]=null}q.stackVec3=U}q.stackVec3[q.sizeVec3++]=V}let tt=this.p;if(I!=null){if(I.zero(),tt.sizeVec3==tt.stackVec3.length){let U=new Array(tt.sizeVec3<<1),it=0,Q=tt.sizeVec3;for(;it<Q;){let at=it++;U[at]=tt.stackVec3[at],tt.stackVec3[at]=null}tt.stackVec3=U}tt.stackVec3[tt.sizeVec3++]=I}let W=this.p;if($!=null){if($.zero(),W.sizeVec3==W.stackVec3.length){let U=new Array(W.sizeVec3<<1),it=0,Q=W.sizeVec3;for(;it<Q;){let at=it++;U[at]=W.stackVec3[at],W.stackVec3[at]=null}W.stackVec3=U}W.stackVec3[W.sizeVec3++]=$}}else{let L=1/Math.sqrt(e*e+4*i*i),S=2*i*L,R=e*L,E=0;for(;E<8;){let k=E++,V=this.tmpCircleNorms[k],B=this.circleCoords[k];V.x=B.x,V.y=B.y,V.z=B.z,V.x*=S,V.y*=S,V.z*=S,V.y+=R;let J=this.tmpCircleNorms[k],I=J.x*p.e10+J.y*p.e11+J.z*p.e12,G=J.x*p.e20+J.y*p.e21+J.z*p.e22;J.x=J.x*p.e00+J.y*p.e01+J.z*p.e02,J.y=I,J.z=G;let D=this.tmpCircleVerts1[k],et=this.circleCoordsShift[k];D.x=et.x,D.y=et.y,D.z=et.z,D.x*=S,D.y*=S,D.z*=S,D.y+=R;let $=this.tmpCircleVerts1[k],j=$.x*p.e10+$.y*p.e11+$.z*p.e12,q=$.x*p.e20+$.y*p.e21+$.z*p.e22;$.x=$.x*p.e00+$.y*p.e01+$.z*p.e02,$.y=j,$.z=q;let tt=this.tmpCircleVerts2[k],W=this.circleCoords[k];tt.x=W.x,tt.y=W.y,tt.z=W.z;let U=tt.x*p.e10+tt.y*p.e11+tt.z*p.e12,it=tt.x*p.e20+tt.y*p.e21+tt.z*p.e22;tt.x=tt.x*p.e00+tt.y*p.e01+tt.z*p.e02,tt.y=U,tt.z=it,tt.x*=e,tt.y*=e,tt.z*=e,tt.x+=m.x,tt.y+=m.y,tt.z+=m.z;let Q=this.tmpCircleVerts2[k],at=-i;Q.x+=_.x*at,Q.y+=_.y*at,Q.z+=_.z*at}let C=0;for(;C<8;){let k=C++,V=this.tmpCircleVerts2[k],B=this.tmpCircleVerts2[(k+1)%8],J=this.tmpCircleVerts1[k];this.triangle(x,V,B,J,this.tmpCircleNorms[k],this.tmpCircleNorms[(k+1)%8],n),V=this.tmpCircleVerts2[(k+1)%8],B=this.tmpCircleVerts2[k];let I=this.p,G=I.sizeVec3==0?new y.common.Vec3:I.stackVec3[--I.sizeVec3];G.x=_.x,G.y=_.y,G.z=_.z;let D=G;D.x=-D.x,D.y=-D.y,D.z=-D.z,this.triangle(w,V,B,D,D,D,n);let et=this.p;if(D!=null){if(D.zero(),et.sizeVec3==et.stackVec3.length){let $=new Array(et.sizeVec3<<1),j=0,q=et.sizeVec3;for(;j<q;){let tt=j++;$[tt]=et.stackVec3[tt],et.stackVec3[tt]=null}et.stackVec3=$}et.stackVec3[et.sizeVec3++]=D}}}let X=this.p;if(x!=null){if(x.zero(),X.sizeVec3==X.stackVec3.length){let L=new Array(X.sizeVec3<<1),S=0,R=X.sizeVec3;for(;S<R;){let E=S++;L[E]=X.stackVec3[E],X.stackVec3[E]=null}X.stackVec3=L}X.stackVec3[X.sizeVec3++]=x}let M=this.p;if(w!=null){if(w.zero(),M.sizeVec3==M.stackVec3.length){let L=new Array(M.sizeVec3<<1),S=0,R=M.sizeVec3;for(;S<R;){let E=S++;L[E]=M.stackVec3[E],M.stackVec3[E]=null}M.stackVec3=L}M.stackVec3[M.sizeVec3++]=w}let z=this.p;if(m!=null){if(m.zero(),z.sizeVec3==z.stackVec3.length){let L=new Array(z.sizeVec3<<1),S=0,R=z.sizeVec3;for(;S<R;){let E=S++;L[E]=z.stackVec3[E],z.stackVec3[E]=null}z.stackVec3=L}z.stackVec3[z.sizeVec3++]=m}let T=this.p;if(p!=null){if(p.e00=1,p.e01=0,p.e02=0,p.e10=0,p.e11=1,p.e12=0,p.e20=0,p.e21=0,p.e22=1,T.sizeMat3==T.stackMat3.length){let L=new Array(T.sizeMat3<<1),S=0,R=T.sizeMat3;for(;S<R;){let E=S++;L[E]=T.stackMat3[E],T.stackMat3[E]=null}T.stackMat3=L}T.stackMat3[T.sizeMat3++]=p}let F=this.p;if(o!=null){if(o.zero(),F.sizeVec3==F.stackVec3.length){let L=new Array(F.sizeVec3<<1),S=0,R=F.sizeVec3;for(;S<R;){let E=S++;L[E]=F.stackVec3[E],F.stackVec3[E]=null}F.stackVec3=L}F.stackVec3[F.sizeVec3++]=o}let P=this.p;if(_!=null){if(_.zero(),P.sizeVec3==P.stackVec3.length){let L=new Array(P.sizeVec3<<1),S=0,R=P.sizeVec3;for(;S<R;){let E=S++;L[E]=P.stackVec3[E],P.stackVec3[E]=null}P.stackVec3=L}P.stackVec3[P.sizeVec3++]=_}let A=this.p;if(l!=null){if(l.zero(),A.sizeVec3==A.stackVec3.length){let L=new Array(A.sizeVec3<<1),S=0,R=A.sizeVec3;for(;S<R;){let E=S++;L[E]=A.stackVec3[E],A.stackVec3[E]=null}A.stackVec3=L}A.stackVec3[A.sizeVec3++]=l}}cylinder(t,e,i,n){let s=this.p,o=s.sizeVec3==0?new y.common.Vec3:s.stackVec3[--s.sizeVec3],r=this.p,_=r.sizeVec3==0?new y.common.Vec3:r.stackVec3[--r.sizeVec3],a=this.p,l=a.sizeVec3==0?new y.common.Vec3:a.stackVec3[--a.sizeVec3],h=this.p,m=h.sizeVec3==0?new y.common.Vec3:h.stackVec3[--h.sizeVec3],f=this.p,p=f.sizeMat3==0?new y.common.Mat3:f.stackMat3[--f.sizeMat3],d=m;d.x=t._positionX,d.y=t._positionY,d.z=t._positionZ;let u=p;u.e00=t._rotation00,u.e01=t._rotation01,u.e02=t._rotation02,u.e10=t._rotation10,u.e11=t._rotation11,u.e12=t._rotation12,u.e20=t._rotation20,u.e21=t._rotation21,u.e22=t._rotation22,o.init(p.e00,p.e10,p.e20),_.init(p.e01,p.e11,p.e21),l.init(p.e02,p.e12,p.e22);let g=this.p,v=g.sizeVec3==0?new y.common.Vec3:g.stackVec3[--g.sizeVec3];v.x=m.x,v.y=m.y,v.z=m.z;let x=v;x.x+=_.x*i,x.y+=_.y*i,x.z+=_.z*i;let b=this.p,Y=b.sizeVec3==0?new y.common.Vec3:b.stackVec3[--b.sizeVec3];Y.x=m.x,Y.y=m.y,Y.z=m.z;let w=Y,Z=-i;if(w.x+=_.x*Z,w.y+=_.y*Z,w.z+=_.z*Z,this.wireframe){let L=this.p,S=L.sizeVec3==0?new y.common.Vec3:L.stackVec3[--L.sizeVec3];S.x=x.x,S.y=x.y,S.z=x.z;let R=S,E=-e;R.x+=o.x*E,R.y+=o.y*E,R.z+=o.z*E,R.x+=l.x*0,R.y+=l.y*0,R.z+=l.z*0;let C=this.p,k=C.sizeVec3==0?new y.common.Vec3:C.stackVec3[--C.sizeVec3];k.x=x.x,k.y=x.y,k.z=x.z;let V=k;V.x+=o.x*e,V.y+=o.y*e,V.z+=o.z*e,V.x+=l.x*0,V.y+=l.y*0,V.z+=l.z*0;let B=this.p,J=B.sizeVec3==0?new y.common.Vec3:B.stackVec3[--B.sizeVec3];J.x=x.x,J.y=x.y,J.z=x.z;let I=J;I.x+=o.x*0,I.y+=o.y*0,I.z+=o.z*0;let G=-e;I.x+=l.x*G,I.y+=l.y*G,I.z+=l.z*G;let D=this.p,et=D.sizeVec3==0?new y.common.Vec3:D.stackVec3[--D.sizeVec3];et.x=x.x,et.y=x.y,et.z=x.z;let $=et;$.x+=o.x*0,$.y+=o.y*0,$.z+=o.z*0,$.x+=l.x*e,$.y+=l.y*e,$.z+=l.z*e;let j=this.p,q=j.sizeVec3==0?new y.common.Vec3:j.stackVec3[--j.sizeVec3];q.x=w.x,q.y=w.y,q.z=w.z;let tt=q,W=-e;tt.x+=o.x*W,tt.y+=o.y*W,tt.z+=o.z*W,tt.x+=l.x*0,tt.y+=l.y*0,tt.z+=l.z*0;let U=this.p,it=U.sizeVec3==0?new y.common.Vec3:U.stackVec3[--U.sizeVec3];it.x=w.x,it.y=w.y,it.z=w.z;let Q=it;Q.x+=o.x*e,Q.y+=o.y*e,Q.z+=o.z*e,Q.x+=l.x*0,Q.y+=l.y*0,Q.z+=l.z*0;let at=this.p,ht=at.sizeVec3==0?new y.common.Vec3:at.stackVec3[--at.sizeVec3];ht.x=w.x,ht.y=w.y,ht.z=w.z;let _t=ht;_t.x+=o.x*0,_t.y+=o.y*0,_t.z+=o.z*0;let mt=-e;_t.x+=l.x*mt,_t.y+=l.y*mt,_t.z+=l.z*mt;let ft=this.p,ut=ft.sizeVec3==0?new y.common.Vec3:ft.stackVec3[--ft.sizeVec3];ut.x=w.x,ut.y=w.y,ut.z=w.z;let H=ut;H.x+=o.x*0,H.y+=o.y*0,H.z+=o.z*0,H.x+=l.x*e,H.y+=l.y*e,H.z+=l.z*e,this.ellipse(x,o,l,e,e,n),this.ellipse(w,o,l,e,e,n),this.line(R,tt,n),this.line(V,Q,n),this.line(I,_t,n),this.line($,H,n);let O=this.p;if(R!=null){if(R.zero(),O.sizeVec3==O.stackVec3.length){let It=new Array(O.sizeVec3<<1),dt=0,K=O.sizeVec3;for(;dt<K;){let lt=dt++;It[lt]=O.stackVec3[lt],O.stackVec3[lt]=null}O.stackVec3=It}O.stackVec3[O.sizeVec3++]=R}let ot=this.p;if(V!=null){if(V.zero(),ot.sizeVec3==ot.stackVec3.length){let It=new Array(ot.sizeVec3<<1),dt=0,K=ot.sizeVec3;for(;dt<K;){let lt=dt++;It[lt]=ot.stackVec3[lt],ot.stackVec3[lt]=null}ot.stackVec3=It}ot.stackVec3[ot.sizeVec3++]=V}let pt=this.p;if(I!=null){if(I.zero(),pt.sizeVec3==pt.stackVec3.length){let It=new Array(pt.sizeVec3<<1),dt=0,K=pt.sizeVec3;for(;dt<K;){let lt=dt++;It[lt]=pt.stackVec3[lt],pt.stackVec3[lt]=null}pt.stackVec3=It}pt.stackVec3[pt.sizeVec3++]=I}let vt=this.p;if($!=null){if($.zero(),vt.sizeVec3==vt.stackVec3.length){let It=new Array(vt.sizeVec3<<1),dt=0,K=vt.sizeVec3;for(;dt<K;){let lt=dt++;It[lt]=vt.stackVec3[lt],vt.stackVec3[lt]=null}vt.stackVec3=It}vt.stackVec3[vt.sizeVec3++]=$}let xt=this.p;if(tt!=null){if(tt.zero(),xt.sizeVec3==xt.stackVec3.length){let It=new Array(xt.sizeVec3<<1),dt=0,K=xt.sizeVec3;for(;dt<K;){let lt=dt++;It[lt]=xt.stackVec3[lt],xt.stackVec3[lt]=null}xt.stackVec3=It}xt.stackVec3[xt.sizeVec3++]=tt}let Mt=this.p;if(Q!=null){if(Q.zero(),Mt.sizeVec3==Mt.stackVec3.length){let It=new Array(Mt.sizeVec3<<1),dt=0,K=Mt.sizeVec3;for(;dt<K;){let lt=dt++;It[lt]=Mt.stackVec3[lt],Mt.stackVec3[lt]=null}Mt.stackVec3=It}Mt.stackVec3[Mt.sizeVec3++]=Q}let ct=this.p;if(_t!=null){if(_t.zero(),ct.sizeVec3==ct.stackVec3.length){let It=new Array(ct.sizeVec3<<1),dt=0,K=ct.sizeVec3;for(;dt<K;){let lt=dt++;It[lt]=ct.stackVec3[lt],ct.stackVec3[lt]=null}ct.stackVec3=It}ct.stackVec3[ct.sizeVec3++]=_t}let St=this.p;if(H!=null){if(H.zero(),St.sizeVec3==St.stackVec3.length){let It=new Array(St.sizeVec3<<1),dt=0,K=St.sizeVec3;for(;dt<K;){let lt=dt++;It[lt]=St.stackVec3[lt],St.stackVec3[lt]=null}St.stackVec3=It}St.stackVec3[St.sizeVec3++]=H}}else{let L=0;for(;L<8;){let R=L++,E=this.tmpCircleNorms[R],C=this.circleCoords[R];E.x=C.x,E.y=C.y,E.z=C.z;let k=E.x*p.e10+E.y*p.e11+E.z*p.e12,V=E.x*p.e20+E.y*p.e21+E.z*p.e22;E.x=E.x*p.e00+E.y*p.e01+E.z*p.e02,E.y=k,E.z=V;let B=this.tmpCircleVerts1[R],J=this.tmpCircleNorms[R];B.x=J.x,B.y=J.y,B.z=J.z,B.x*=e,B.y*=e,B.z*=e,B.x+=m.x,B.y+=m.y,B.z+=m.z;let I=this.tmpCircleVerts2[R],G=this.tmpCircleVerts1[R];I.x=G.x,I.y=G.y,I.z=G.z;let D=this.tmpCircleVerts1[R];D.x+=_.x*i,D.y+=_.y*i,D.z+=_.z*i;let et=this.tmpCircleVerts2[R],$=-i;et.x+=_.x*$,et.y+=_.y*$,et.z+=_.z*$}let S=0;for(;S<8;){let R=S++,E,C=this.tmpCircleVerts1[R],k=this.tmpCircleVerts1[(R+1)%8],V=_;this.triangle(x,C,k,V,V,V,n),C=this.tmpCircleVerts2[(R+1)%8],k=this.tmpCircleVerts2[R];let B=this.p,J=B.sizeVec3==0?new y.common.Vec3:B.stackVec3[--B.sizeVec3];J.x=_.x,J.y=_.y,J.z=_.z;let I=J;I.x=-I.x,I.y=-I.y,I.z=-I.z,this.triangle(w,C,k,I,I,I,n);let G=this.p;if(I!=null){if(I.zero(),G.sizeVec3==G.stackVec3.length){let et=new Array(G.sizeVec3<<1),$=0,j=G.sizeVec3;for(;$<j;){let q=$++;et[q]=G.stackVec3[q],G.stackVec3[q]=null}G.stackVec3=et}G.stackVec3[G.sizeVec3++]=I}E=this.tmpCircleVerts1[R],C=this.tmpCircleVerts2[R],k=this.tmpCircleVerts2[(R+1)%8],V=this.tmpCircleNorms[R];let D=this.tmpCircleNorms[(R+1)%8];this.rect(E,C,k,this.tmpCircleVerts1[(R+1)%8],V,V,D,D,n)}}let X=this.p;if(x!=null){if(x.zero(),X.sizeVec3==X.stackVec3.length){let L=new Array(X.sizeVec3<<1),S=0,R=X.sizeVec3;for(;S<R;){let E=S++;L[E]=X.stackVec3[E],X.stackVec3[E]=null}X.stackVec3=L}X.stackVec3[X.sizeVec3++]=x}let M=this.p;if(w!=null){if(w.zero(),M.sizeVec3==M.stackVec3.length){let L=new Array(M.sizeVec3<<1),S=0,R=M.sizeVec3;for(;S<R;){let E=S++;L[E]=M.stackVec3[E],M.stackVec3[E]=null}M.stackVec3=L}M.stackVec3[M.sizeVec3++]=w}let z=this.p;if(m!=null){if(m.zero(),z.sizeVec3==z.stackVec3.length){let L=new Array(z.sizeVec3<<1),S=0,R=z.sizeVec3;for(;S<R;){let E=S++;L[E]=z.stackVec3[E],z.stackVec3[E]=null}z.stackVec3=L}z.stackVec3[z.sizeVec3++]=m}let T=this.p;if(p!=null){if(p.e00=1,p.e01=0,p.e02=0,p.e10=0,p.e11=1,p.e12=0,p.e20=0,p.e21=0,p.e22=1,T.sizeMat3==T.stackMat3.length){let L=new Array(T.sizeMat3<<1),S=0,R=T.sizeMat3;for(;S<R;){let E=S++;L[E]=T.stackMat3[E],T.stackMat3[E]=null}T.stackMat3=L}T.stackMat3[T.sizeMat3++]=p}let F=this.p;if(o!=null){if(o.zero(),F.sizeVec3==F.stackVec3.length){let L=new Array(F.sizeVec3<<1),S=0,R=F.sizeVec3;for(;S<R;){let E=S++;L[E]=F.stackVec3[E],F.stackVec3[E]=null}F.stackVec3=L}F.stackVec3[F.sizeVec3++]=o}let P=this.p;if(_!=null){if(_.zero(),P.sizeVec3==P.stackVec3.length){let L=new Array(P.sizeVec3<<1),S=0,R=P.sizeVec3;for(;S<R;){let E=S++;L[E]=P.stackVec3[E],P.stackVec3[E]=null}P.stackVec3=L}P.stackVec3[P.sizeVec3++]=_}let A=this.p;if(l!=null){if(l.zero(),A.sizeVec3==A.stackVec3.length){let L=new Array(A.sizeVec3<<1),S=0,R=A.sizeVec3;for(;S<R;){let E=S++;L[E]=A.stackVec3[E],A.stackVec3[E]=null}A.stackVec3=L}A.stackVec3[A.sizeVec3++]=l}}capsule(t,e,i,n){let s=this.p,o=s.sizeVec3==0?new y.common.Vec3:s.stackVec3[--s.sizeVec3],r=this.p,_=r.sizeVec3==0?new y.common.Vec3:r.stackVec3[--r.sizeVec3],a=this.p,l=a.sizeVec3==0?new y.common.Vec3:a.stackVec3[--a.sizeVec3],h=this.p,m=h.sizeVec3==0?new y.common.Vec3:h.stackVec3[--h.sizeVec3],f=this.p,p=f.sizeMat3==0?new y.common.Mat3:f.stackMat3[--f.sizeMat3],d=m;d.x=t._positionX,d.y=t._positionY,d.z=t._positionZ;let u=p;u.e00=t._rotation00,u.e01=t._rotation01,u.e02=t._rotation02,u.e10=t._rotation10,u.e11=t._rotation11,u.e12=t._rotation12,u.e20=t._rotation20,u.e21=t._rotation21,u.e22=t._rotation22,o.init(p.e00,p.e10,p.e20),_.init(p.e01,p.e11,p.e21),l.init(p.e02,p.e12,p.e22);let g=this.tmpSphereVerts,v=this.tmpSphereNorms,x=0;for(;x<5;){let C=x++,k=this.tmpSphereVerts[C].length,V=0;for(;V<k;){let B=V++,J=v[C][B],I=this.sphereCoords[C][B];J.x=I.x,J.y=I.y,J.z=I.z;let G=J.x*p.e10+J.y*p.e11+J.z*p.e12,D=J.x*p.e20+J.y*p.e21+J.z*p.e22;J.x=J.x*p.e00+J.y*p.e01+J.z*p.e02,J.y=G,J.z=D}}let b=0;for(;b<4;){let C=b++;if(C==0){let V=0;for(;V<3;){let B=V++,J=this.tmpSphereVerts[B].length,I=0;for(;I<J;){let G=I++,D=g[B][G],et=v[B][G];D.x=et.x,D.y=et.y,D.z=et.z,D.x*=e,D.y*=e,D.z*=e,D.x+=m.x,D.y+=m.y,D.z+=m.z,D.x+=_.x*i,D.y+=_.y*i,D.z+=_.z*i}}}if(C==2){let V=2;for(;V<5;){let B=V++,J=this.tmpSphereVerts[B].length,I=0;for(;I<J;){let G=I++,D=g[B][G],et=v[B][G];D.x=et.x,D.y=et.y,D.z=et.z,D.x*=e,D.y*=e,D.z*=e,D.x+=m.x,D.y+=m.y,D.z+=m.z;let $=-i;D.x+=_.x*$,D.y+=_.y*$,D.z+=_.z*$}}}let k=0;for(;k<8;){let V=k++,B,J,I,G,D,et,$,j;C==0?this.wireframe?(B=g[0][0],J=g[1][V],this.line(B,J,n)):(B=g[0][0],J=g[1][V],I=g[1][(V+1)%8],D=v[0][0],et=v[1][V],$=v[1][(V+1)%8],this.triangle(B,J,I,D,et,$,n)):C==3?this.wireframe?(B=g[4][0],J=g[C][(V+1)%8],I=g[C][V],this.line(B,J,n),this.line(J,I,n)):(B=g[4][0],J=g[C][(V+1)%8],I=g[C][V],D=v[4][0],et=v[C][(V+1)%8],$=v[C][V],this.triangle(B,J,I,D,et,$,n)):this.wireframe?(B=g[C][V],J=g[C][(V+1)%8],I=g[C+1][V],this.line(B,J,n),this.line(B,I,n)):(B=g[C][V],J=g[C][(V+1)%8],I=g[C+1][V],G=g[C+1][(V+1)%8],D=v[C][V],et=v[C][(V+1)%8],$=v[C+1][V],j=v[C+1][(V+1)%8],this.rect(B,I,G,J,D,$,j,et,n))}}let Y=this.p,w=Y.sizeVec3==0?new y.common.Vec3:Y.stackVec3[--Y.sizeVec3];w.x=m.x,w.y=m.y,w.z=m.z;let Z=w;Z.x+=_.x*i,Z.y+=_.y*i,Z.z+=_.z*i;let X=this.p,M=X.sizeVec3==0?new y.common.Vec3:X.stackVec3[--X.sizeVec3];M.x=m.x,M.y=m.y,M.z=m.z;let z=M,T=-i;if(z.x+=_.x*T,z.y+=_.y*T,z.z+=_.z*T,this.wireframe){let C=this.p,k=C.sizeVec3==0?new y.common.Vec3:C.stackVec3[--C.sizeVec3];k.x=Z.x,k.y=Z.y,k.z=Z.z;let V=k,B=-e;V.x+=o.x*B,V.y+=o.y*B,V.z+=o.z*B,V.x+=l.x*0,V.y+=l.y*0,V.z+=l.z*0;let J=this.p,I=J.sizeVec3==0?new y.common.Vec3:J.stackVec3[--J.sizeVec3];I.x=Z.x,I.y=Z.y,I.z=Z.z;let G=I;G.x+=o.x*e,G.y+=o.y*e,G.z+=o.z*e,G.x+=l.x*0,G.y+=l.y*0,G.z+=l.z*0;let D=this.p,et=D.sizeVec3==0?new y.common.Vec3:D.stackVec3[--D.sizeVec3];et.x=Z.x,et.y=Z.y,et.z=Z.z;let $=et;$.x+=o.x*0,$.y+=o.y*0,$.z+=o.z*0;let j=-e;$.x+=l.x*j,$.y+=l.y*j,$.z+=l.z*j;let q=this.p,tt=q.sizeVec3==0?new y.common.Vec3:q.stackVec3[--q.sizeVec3];tt.x=Z.x,tt.y=Z.y,tt.z=Z.z;let W=tt;W.x+=o.x*0,W.y+=o.y*0,W.z+=o.z*0,W.x+=l.x*e,W.y+=l.y*e,W.z+=l.z*e;let U=this.p,it=U.sizeVec3==0?new y.common.Vec3:U.stackVec3[--U.sizeVec3];it.x=z.x,it.y=z.y,it.z=z.z;let Q=it,at=-e;Q.x+=o.x*at,Q.y+=o.y*at,Q.z+=o.z*at,Q.x+=l.x*0,Q.y+=l.y*0,Q.z+=l.z*0;let ht=this.p,_t=ht.sizeVec3==0?new y.common.Vec3:ht.stackVec3[--ht.sizeVec3];_t.x=z.x,_t.y=z.y,_t.z=z.z;let mt=_t;mt.x+=o.x*e,mt.y+=o.y*e,mt.z+=o.z*e,mt.x+=l.x*0,mt.y+=l.y*0,mt.z+=l.z*0;let ft=this.p,ut=ft.sizeVec3==0?new y.common.Vec3:ft.stackVec3[--ft.sizeVec3];ut.x=z.x,ut.y=z.y,ut.z=z.z;let H=ut;H.x+=o.x*0,H.y+=o.y*0,H.z+=o.z*0;let O=-e;H.x+=l.x*O,H.y+=l.y*O,H.z+=l.z*O;let ot=this.p,pt=ot.sizeVec3==0?new y.common.Vec3:ot.stackVec3[--ot.sizeVec3];pt.x=z.x,pt.y=z.y,pt.z=z.z;let vt=pt;vt.x+=o.x*0,vt.y+=o.y*0,vt.z+=o.z*0,vt.x+=l.x*e,vt.y+=l.y*e,vt.z+=l.z*e,this.ellipse(Z,o,l,e,e,n),this.ellipse(z,o,l,e,e,n),this.line(V,Q,n),this.line(G,mt,n),this.line($,H,n),this.line(W,vt,n);let xt=this.p;if(V!=null){if(V.zero(),xt.sizeVec3==xt.stackVec3.length){let rt=new Array(xt.sizeVec3<<1),Vt=0,At=xt.sizeVec3;for(;Vt<At;){let Yt=Vt++;rt[Yt]=xt.stackVec3[Yt],xt.stackVec3[Yt]=null}xt.stackVec3=rt}xt.stackVec3[xt.sizeVec3++]=V}let Mt=this.p;if(G!=null){if(G.zero(),Mt.sizeVec3==Mt.stackVec3.length){let rt=new Array(Mt.sizeVec3<<1),Vt=0,At=Mt.sizeVec3;for(;Vt<At;){let Yt=Vt++;rt[Yt]=Mt.stackVec3[Yt],Mt.stackVec3[Yt]=null}Mt.stackVec3=rt}Mt.stackVec3[Mt.sizeVec3++]=G}let ct=this.p;if($!=null){if($.zero(),ct.sizeVec3==ct.stackVec3.length){let rt=new Array(ct.sizeVec3<<1),Vt=0,At=ct.sizeVec3;for(;Vt<At;){let Yt=Vt++;rt[Yt]=ct.stackVec3[Yt],ct.stackVec3[Yt]=null}ct.stackVec3=rt}ct.stackVec3[ct.sizeVec3++]=$}let St=this.p;if(W!=null){if(W.zero(),St.sizeVec3==St.stackVec3.length){let rt=new Array(St.sizeVec3<<1),Vt=0,At=St.sizeVec3;for(;Vt<At;){let Yt=Vt++;rt[Yt]=St.stackVec3[Yt],St.stackVec3[Yt]=null}St.stackVec3=rt}St.stackVec3[St.sizeVec3++]=W}let It=this.p;if(Q!=null){if(Q.zero(),It.sizeVec3==It.stackVec3.length){let rt=new Array(It.sizeVec3<<1),Vt=0,At=It.sizeVec3;for(;Vt<At;){let Yt=Vt++;rt[Yt]=It.stackVec3[Yt],It.stackVec3[Yt]=null}It.stackVec3=rt}It.stackVec3[It.sizeVec3++]=Q}let dt=this.p;if(mt!=null){if(mt.zero(),dt.sizeVec3==dt.stackVec3.length){let rt=new Array(dt.sizeVec3<<1),Vt=0,At=dt.sizeVec3;for(;Vt<At;){let Yt=Vt++;rt[Yt]=dt.stackVec3[Yt],dt.stackVec3[Yt]=null}dt.stackVec3=rt}dt.stackVec3[dt.sizeVec3++]=mt}let K=this.p;if(H!=null){if(H.zero(),K.sizeVec3==K.stackVec3.length){let rt=new Array(K.sizeVec3<<1),Vt=0,At=K.sizeVec3;for(;Vt<At;){let Yt=Vt++;rt[Yt]=K.stackVec3[Yt],K.stackVec3[Yt]=null}K.stackVec3=rt}K.stackVec3[K.sizeVec3++]=H}let lt=this.p;if(vt!=null){if(vt.zero(),lt.sizeVec3==lt.stackVec3.length){let rt=new Array(lt.sizeVec3<<1),Vt=0,At=lt.sizeVec3;for(;Vt<At;){let Yt=Vt++;rt[Yt]=lt.stackVec3[Yt],lt.stackVec3[Yt]=null}lt.stackVec3=rt}lt.stackVec3[lt.sizeVec3++]=vt}}else{let C=0;for(;C<8;){let V=C++,B=this.tmpCircleNorms[V],J=this.circleCoords[V];B.x=J.x,B.y=J.y,B.z=J.z;let I=B.x*p.e10+B.y*p.e11+B.z*p.e12,G=B.x*p.e20+B.y*p.e21+B.z*p.e22;B.x=B.x*p.e00+B.y*p.e01+B.z*p.e02,B.y=I,B.z=G;let D=this.tmpCircleVerts1[V],et=this.tmpCircleNorms[V];D.x=et.x,D.y=et.y,D.z=et.z,D.x*=e,D.y*=e,D.z*=e,D.x+=m.x,D.y+=m.y,D.z+=m.z;let $=this.tmpCircleVerts2[V],j=this.tmpCircleVerts1[V];$.x=j.x,$.y=j.y,$.z=j.z;let q=this.tmpCircleVerts1[V];q.x+=_.x*i,q.y+=_.y*i,q.z+=_.z*i;let tt=this.tmpCircleVerts2[V],W=-i;tt.x+=_.x*W,tt.y+=_.y*W,tt.z+=_.z*W}let k=0;for(;k<8;){let V=k++,B=this.tmpCircleNorms[V],J=this.tmpCircleNorms[(V+1)%8];this.rect(this.tmpCircleVerts1[V],this.tmpCircleVerts2[V],this.tmpCircleVerts2[(V+1)%8],this.tmpCircleVerts1[(V+1)%8],B,B,J,J,n)}}let F=this.p;if(Z!=null){if(Z.zero(),F.sizeVec3==F.stackVec3.length){let C=new Array(F.sizeVec3<<1),k=0,V=F.sizeVec3;for(;k<V;){let B=k++;C[B]=F.stackVec3[B],F.stackVec3[B]=null}F.stackVec3=C}F.stackVec3[F.sizeVec3++]=Z}let P=this.p;if(z!=null){if(z.zero(),P.sizeVec3==P.stackVec3.length){let C=new Array(P.sizeVec3<<1),k=0,V=P.sizeVec3;for(;k<V;){let B=k++;C[B]=P.stackVec3[B],P.stackVec3[B]=null}P.stackVec3=C}P.stackVec3[P.sizeVec3++]=z}let A=this.p;if(m!=null){if(m.zero(),A.sizeVec3==A.stackVec3.length){let C=new Array(A.sizeVec3<<1),k=0,V=A.sizeVec3;for(;k<V;){let B=k++;C[B]=A.stackVec3[B],A.stackVec3[B]=null}A.stackVec3=C}A.stackVec3[A.sizeVec3++]=m}let L=this.p;if(p!=null){if(p.e00=1,p.e01=0,p.e02=0,p.e10=0,p.e11=1,p.e12=0,p.e20=0,p.e21=0,p.e22=1,L.sizeMat3==L.stackMat3.length){let C=new Array(L.sizeMat3<<1),k=0,V=L.sizeMat3;for(;k<V;){let B=k++;C[B]=L.stackMat3[B],L.stackMat3[B]=null}L.stackMat3=C}L.stackMat3[L.sizeMat3++]=p}let S=this.p;if(o!=null){if(o.zero(),S.sizeVec3==S.stackVec3.length){let C=new Array(S.sizeVec3<<1),k=0,V=S.sizeVec3;for(;k<V;){let B=k++;C[B]=S.stackVec3[B],S.stackVec3[B]=null}S.stackVec3=C}S.stackVec3[S.sizeVec3++]=o}let R=this.p;if(_!=null){if(_.zero(),R.sizeVec3==R.stackVec3.length){let C=new Array(R.sizeVec3<<1),k=0,V=R.sizeVec3;for(;k<V;){let B=k++;C[B]=R.stackVec3[B],R.stackVec3[B]=null}R.stackVec3=C}R.stackVec3[R.sizeVec3++]=_}let E=this.p;if(l!=null){if(l.zero(),E.sizeVec3==E.stackVec3.length){let C=new Array(E.sizeVec3<<1),k=0,V=E.sizeVec3;for(;k<V;){let B=k++;C[B]=E.stackVec3[B],E.stackVec3[B]=null}E.stackVec3=C}E.stackVec3[E.sizeVec3++]=l}}sphere(t,e,i){let n=this.p,s=n.sizeVec3==0?new y.common.Vec3:n.stackVec3[--n.sizeVec3],o=this.p,r=o.sizeMat3==0?new y.common.Mat3:o.stackMat3[--o.sizeMat3],_=s;_.x=t._positionX,_.y=t._positionY,_.z=t._positionZ;let a=r;a.e00=t._rotation00,a.e01=t._rotation01,a.e02=t._rotation02,a.e10=t._rotation10,a.e11=t._rotation11,a.e12=t._rotation12,a.e20=t._rotation20,a.e21=t._rotation21,a.e22=t._rotation22;let l=this.tmpSphereVerts,h=this.tmpSphereNorms,m=0;for(;m<5;){let u=m++,g=this.tmpSphereVerts[u].length,v=0;for(;v<g;){let x=v++,b=h[u][x],Y=this.sphereCoords[u][x];b.x=Y.x,b.y=Y.y,b.z=Y.z;let w=b.x*r.e10+b.y*r.e11+b.z*r.e12,Z=b.x*r.e20+b.y*r.e21+b.z*r.e22;b.x=b.x*r.e00+b.y*r.e01+b.z*r.e02,b.y=w,b.z=Z;let X=l[u][x],M=h[u][x];X.x=M.x,X.y=M.y,X.z=M.z,X.x*=e,X.y*=e,X.z*=e,X.x+=s.x,X.y+=s.y,X.z+=s.z}}let f=0;for(;f<4;){let u=f++,g=0;for(;g<8;){let v=g++,x,b,Y,w,Z,X,M,z;u==0?this.wireframe?(x=l[0][0],b=l[1][v],this.line(x,b,i)):(x=l[0][0],b=l[1][v],Y=l[1][(v+1)%8],Z=h[0][0],X=h[1][v],M=h[1][(v+1)%8],this.triangle(x,b,Y,Z,X,M,i)):u==3?this.wireframe?(x=l[4][0],b=l[u][(v+1)%8],Y=l[u][v],this.line(x,b,i),this.line(b,Y,i)):(x=l[4][0],b=l[u][(v+1)%8],Y=l[u][v],Z=h[4][0],X=h[u][(v+1)%8],M=h[u][v],this.triangle(x,b,Y,Z,X,M,i)):this.wireframe?(x=l[u][v],b=l[u][(v+1)%8],Y=l[u+1][v],this.line(x,b,i),this.line(x,Y,i)):(x=l[u][v],b=l[u][(v+1)%8],Y=l[u+1][v],w=l[u+1][(v+1)%8],Z=h[u][v],X=h[u][(v+1)%8],M=h[u+1][v],z=h[u+1][(v+1)%8],this.rect(x,Y,w,b,Z,M,z,X,i))}}let p=this.p;if(s!=null){if(s.zero(),p.sizeVec3==p.stackVec3.length){let u=new Array(p.sizeVec3<<1),g=0,v=p.sizeVec3;for(;g<v;){let x=g++;u[x]=p.stackVec3[x],p.stackVec3[x]=null}p.stackVec3=u}p.stackVec3[p.sizeVec3++]=s}let d=this.p;if(r!=null){if(r.e00=1,r.e01=0,r.e02=0,r.e10=0,r.e11=1,r.e12=0,r.e20=0,r.e21=0,r.e22=1,d.sizeMat3==d.stackMat3.length){let u=new Array(d.sizeMat3<<1),g=0,v=d.sizeMat3;for(;g<v;){let x=g++;u[x]=d.stackMat3[x],d.stackMat3[x]=null}d.stackMat3=u}d.stackMat3[d.sizeMat3++]=r}}box(t,e,i){let n=this.p,s=n.sizeVec3==0?new y.common.Vec3:n.stackVec3[--n.sizeVec3],o=this.p,r=o.sizeVec3==0?new y.common.Vec3:o.stackVec3[--o.sizeVec3],_=this.p,a=_.sizeVec3==0?new y.common.Vec3:_.stackVec3[--_.sizeVec3],l=this.p,h=l.sizeVec3==0?new y.common.Vec3:l.stackVec3[--l.sizeVec3],m=this.p,f=m.sizeMat3==0?new y.common.Mat3:m.stackMat3[--m.sizeMat3],p=h;p.x=t._positionX,p.y=t._positionY,p.z=t._positionZ;let d=f;d.e00=t._rotation00,d.e01=t._rotation01,d.e02=t._rotation02,d.e10=t._rotation10,d.e11=t._rotation11,d.e12=t._rotation12,d.e20=t._rotation20,d.e21=t._rotation21,d.e22=t._rotation22,s.init(f.e00,f.e10,f.e20),r.init(f.e01,f.e11,f.e21),a.init(f.e02,f.e12,f.e22);let u=e.x,g=e.y,v=e.z,x=this.p,b=x.sizeVec3==0?new y.common.Vec3:x.stackVec3[--x.sizeVec3];b.x=h.x,b.y=h.y,b.z=h.z;let Y=b,w=-u;Y.x+=s.x*w,Y.y+=s.y*w,Y.z+=s.z*w;let Z=-g;Y.x+=r.x*Z,Y.y+=r.y*Z,Y.z+=r.z*Z;let X=-v;Y.x+=a.x*X,Y.y+=a.y*X,Y.z+=a.z*X;let M=this.p,z=M.sizeVec3==0?new y.common.Vec3:M.stackVec3[--M.sizeVec3];z.x=h.x,z.y=h.y,z.z=h.z;let T=z,F=-u;T.x+=s.x*F,T.y+=s.y*F,T.z+=s.z*F;let P=-g;T.x+=r.x*P,T.y+=r.y*P,T.z+=r.z*P,T.x+=a.x*v,T.y+=a.y*v,T.z+=a.z*v;let A=this.p,L=A.sizeVec3==0?new y.common.Vec3:A.stackVec3[--A.sizeVec3];L.x=h.x,L.y=h.y,L.z=h.z;let S=L,R=-u;S.x+=s.x*R,S.y+=s.y*R,S.z+=s.z*R,S.x+=r.x*g,S.y+=r.y*g,S.z+=r.z*g;let E=-v;S.x+=a.x*E,S.y+=a.y*E,S.z+=a.z*E;let C=this.p,k=C.sizeVec3==0?new y.common.Vec3:C.stackVec3[--C.sizeVec3];k.x=h.x,k.y=h.y,k.z=h.z;let V=k,B=-u;V.x+=s.x*B,V.y+=s.y*B,V.z+=s.z*B,V.x+=r.x*g,V.y+=r.y*g,V.z+=r.z*g,V.x+=a.x*v,V.y+=a.y*v,V.z+=a.z*v;let J=this.p,I=J.sizeVec3==0?new y.common.Vec3:J.stackVec3[--J.sizeVec3];I.x=h.x,I.y=h.y,I.z=h.z;let G=I;G.x+=s.x*u,G.y+=s.y*u,G.z+=s.z*u;let D=-g;G.x+=r.x*D,G.y+=r.y*D,G.z+=r.z*D;let et=-v;G.x+=a.x*et,G.y+=a.y*et,G.z+=a.z*et;let $=this.p,j=$.sizeVec3==0?new y.common.Vec3:$.stackVec3[--$.sizeVec3];j.x=h.x,j.y=h.y,j.z=h.z;let q=j;q.x+=s.x*u,q.y+=s.y*u,q.z+=s.z*u;let tt=-g;q.x+=r.x*tt,q.y+=r.y*tt,q.z+=r.z*tt,q.x+=a.x*v,q.y+=a.y*v,q.z+=a.z*v;let W=this.p,U=W.sizeVec3==0?new y.common.Vec3:W.stackVec3[--W.sizeVec3];U.x=h.x,U.y=h.y,U.z=h.z;let it=U;it.x+=s.x*u,it.y+=s.y*u,it.z+=s.z*u,it.x+=r.x*g,it.y+=r.y*g,it.z+=r.z*g;let Q=-v;it.x+=a.x*Q,it.y+=a.y*Q,it.z+=a.z*Q;let at=this.p,ht=at.sizeVec3==0?new y.common.Vec3:at.stackVec3[--at.sizeVec3];ht.x=h.x,ht.y=h.y,ht.z=h.z;let _t=ht;if(_t.x+=s.x*u,_t.y+=s.y*u,_t.z+=s.z*u,_t.x+=r.x*g,_t.y+=r.y*g,_t.z+=r.z*g,_t.x+=a.x*v,_t.y+=a.y*v,_t.z+=a.z*v,this.wireframe)this.line(Y,T,i),this.line(S,V,i),this.line(G,q,i),this.line(it,_t,i),this.line(Y,S,i),this.line(T,V,i),this.line(G,it,i),this.line(q,_t,i),this.line(Y,G,i),this.line(T,q,i),this.line(S,it,i),this.line(V,_t,i);else{let dt=this.p,K=dt.sizeVec3==0?new y.common.Vec3:dt.stackVec3[--dt.sizeVec3];K.x=s.x,K.y=s.y,K.z=s.z;let lt=K;lt.x=-lt.x,lt.y=-lt.y,lt.z=-lt.z;let rt=this.p,Vt=rt.sizeVec3==0?new y.common.Vec3:rt.stackVec3[--rt.sizeVec3];Vt.x=r.x,Vt.y=r.y,Vt.z=r.z;let At=Vt;At.x=-At.x,At.y=-At.y,At.z=-At.z;let Yt=this.p,Xt=Yt.sizeVec3==0?new y.common.Vec3:Yt.stackVec3[--Yt.sizeVec3];Xt.x=a.x,Xt.y=a.y,Xt.z=a.z;let Nt=Xt;Nt.x=-Nt.x,Nt.y=-Nt.y,Nt.z=-Nt.z,this.rect(Y,T,V,S,lt,lt,lt,lt,i),this.rect(G,it,_t,q,s,s,s,s,i),this.rect(Y,G,q,T,At,At,At,At,i),this.rect(S,V,_t,it,r,r,r,r,i),this.rect(Y,S,it,G,Nt,Nt,Nt,Nt,i),this.rect(T,q,_t,V,a,a,a,a,i);let ie=this.p;if(lt!=null){if(lt.zero(),ie.sizeVec3==ie.stackVec3.length){let ze=new Array(ie.sizeVec3<<1),pe=0,$t=ie.sizeVec3;for(;pe<$t;){let Ht=pe++;ze[Ht]=ie.stackVec3[Ht],ie.stackVec3[Ht]=null}ie.stackVec3=ze}ie.stackVec3[ie.sizeVec3++]=lt}let ee=this.p;if(At!=null){if(At.zero(),ee.sizeVec3==ee.stackVec3.length){let ze=new Array(ee.sizeVec3<<1),pe=0,$t=ee.sizeVec3;for(;pe<$t;){let Ht=pe++;ze[Ht]=ee.stackVec3[Ht],ee.stackVec3[Ht]=null}ee.stackVec3=ze}ee.stackVec3[ee.sizeVec3++]=At}let Ze=this.p;if(Nt!=null){if(Nt.zero(),Ze.sizeVec3==Ze.stackVec3.length){let ze=new Array(Ze.sizeVec3<<1),pe=0,$t=Ze.sizeVec3;for(;pe<$t;){let Ht=pe++;ze[Ht]=Ze.stackVec3[Ht],Ze.stackVec3[Ht]=null}Ze.stackVec3=ze}Ze.stackVec3[Ze.sizeVec3++]=Nt}}let mt=this.p;if(Y!=null){if(Y.zero(),mt.sizeVec3==mt.stackVec3.length){let dt=new Array(mt.sizeVec3<<1),K=0,lt=mt.sizeVec3;for(;K<lt;){let rt=K++;dt[rt]=mt.stackVec3[rt],mt.stackVec3[rt]=null}mt.stackVec3=dt}mt.stackVec3[mt.sizeVec3++]=Y}let ft=this.p;if(T!=null){if(T.zero(),ft.sizeVec3==ft.stackVec3.length){let dt=new Array(ft.sizeVec3<<1),K=0,lt=ft.sizeVec3;for(;K<lt;){let rt=K++;dt[rt]=ft.stackVec3[rt],ft.stackVec3[rt]=null}ft.stackVec3=dt}ft.stackVec3[ft.sizeVec3++]=T}let ut=this.p;if(S!=null){if(S.zero(),ut.sizeVec3==ut.stackVec3.length){let dt=new Array(ut.sizeVec3<<1),K=0,lt=ut.sizeVec3;for(;K<lt;){let rt=K++;dt[rt]=ut.stackVec3[rt],ut.stackVec3[rt]=null}ut.stackVec3=dt}ut.stackVec3[ut.sizeVec3++]=S}let H=this.p;if(V!=null){if(V.zero(),H.sizeVec3==H.stackVec3.length){let dt=new Array(H.sizeVec3<<1),K=0,lt=H.sizeVec3;for(;K<lt;){let rt=K++;dt[rt]=H.stackVec3[rt],H.stackVec3[rt]=null}H.stackVec3=dt}H.stackVec3[H.sizeVec3++]=V}let O=this.p;if(G!=null){if(G.zero(),O.sizeVec3==O.stackVec3.length){let dt=new Array(O.sizeVec3<<1),K=0,lt=O.sizeVec3;for(;K<lt;){let rt=K++;dt[rt]=O.stackVec3[rt],O.stackVec3[rt]=null}O.stackVec3=dt}O.stackVec3[O.sizeVec3++]=G}let ot=this.p;if(q!=null){if(q.zero(),ot.sizeVec3==ot.stackVec3.length){let dt=new Array(ot.sizeVec3<<1),K=0,lt=ot.sizeVec3;for(;K<lt;){let rt=K++;dt[rt]=ot.stackVec3[rt],ot.stackVec3[rt]=null}ot.stackVec3=dt}ot.stackVec3[ot.sizeVec3++]=q}let pt=this.p;if(it!=null){if(it.zero(),pt.sizeVec3==pt.stackVec3.length){let dt=new Array(pt.sizeVec3<<1),K=0,lt=pt.sizeVec3;for(;K<lt;){let rt=K++;dt[rt]=pt.stackVec3[rt],pt.stackVec3[rt]=null}pt.stackVec3=dt}pt.stackVec3[pt.sizeVec3++]=it}let vt=this.p;if(_t!=null){if(_t.zero(),vt.sizeVec3==vt.stackVec3.length){let dt=new Array(vt.sizeVec3<<1),K=0,lt=vt.sizeVec3;for(;K<lt;){let rt=K++;dt[rt]=vt.stackVec3[rt],vt.stackVec3[rt]=null}vt.stackVec3=dt}vt.stackVec3[vt.sizeVec3++]=_t}let xt=this.p;if(h!=null){if(h.zero(),xt.sizeVec3==xt.stackVec3.length){let dt=new Array(xt.sizeVec3<<1),K=0,lt=xt.sizeVec3;for(;K<lt;){let rt=K++;dt[rt]=xt.stackVec3[rt],xt.stackVec3[rt]=null}xt.stackVec3=dt}xt.stackVec3[xt.sizeVec3++]=h}let Mt=this.p;if(f!=null){if(f.e00=1,f.e01=0,f.e02=0,f.e10=0,f.e11=1,f.e12=0,f.e20=0,f.e21=0,f.e22=1,Mt.sizeMat3==Mt.stackMat3.length){let dt=new Array(Mt.sizeMat3<<1),K=0,lt=Mt.sizeMat3;for(;K<lt;){let rt=K++;dt[rt]=Mt.stackMat3[rt],Mt.stackMat3[rt]=null}Mt.stackMat3=dt}Mt.stackMat3[Mt.sizeMat3++]=f}let ct=this.p;if(s!=null){if(s.zero(),ct.sizeVec3==ct.stackVec3.length){let dt=new Array(ct.sizeVec3<<1),K=0,lt=ct.sizeVec3;for(;K<lt;){let rt=K++;dt[rt]=ct.stackVec3[rt],ct.stackVec3[rt]=null}ct.stackVec3=dt}ct.stackVec3[ct.sizeVec3++]=s}let St=this.p;if(r!=null){if(r.zero(),St.sizeVec3==St.stackVec3.length){let dt=new Array(St.sizeVec3<<1),K=0,lt=St.sizeVec3;for(;K<lt;){let rt=K++;dt[rt]=St.stackVec3[rt],St.stackVec3[rt]=null}St.stackVec3=dt}St.stackVec3[St.sizeVec3++]=r}let It=this.p;if(a!=null){if(a.zero(),It.sizeVec3==It.stackVec3.length){let dt=new Array(It.sizeVec3<<1),K=0,lt=It.sizeVec3;for(;K<lt;){let rt=K++;dt[rt]=It.stackVec3[rt],It.stackVec3[rt]=null}It.stackVec3=dt}It.stackVec3[It.sizeVec3++]=a}}rect(t,e,i,n,s,o,r,_,a){this.triangle(t,e,i,s,o,r,a),this.triangle(t,i,n,s,r,_,a)}point(t,e){}triangle(t,e,i,n,s,o,r){}line(t,e,i){}};y.dynamics.common.DebugDrawStyle=class{constructor(){this.basisColorZ=new y.common.Vec3(0,0,1),this.basisColorY=new y.common.Vec3(0,1,0),this.basisColorX=new y.common.Vec3(1,0,0),this.basisLength=.5,this.jointRotationalConstraintRadius=.3,this.jointErrorColor=new y.common.Vec3(1,.1,.1),this.jointLineColor=new y.common.Vec3(.8,.8,.8),this.contactBinormalLength=.5,this.contactTangentLength=.5,this.contactNormalLength=.5,this.contactBinormalColor=new y.common.Vec3(.2,.2,1),this.contactTangentColor=new y.common.Vec3(.1,.8,.1),this.contactNormalColor=new y.common.Vec3(1,.1,.1),this.disabledContactColor=new y.common.Vec3(.5,.1,.1),this.newContactColor=new y.common.Vec3(1,1,.1),this.contactColor4=new y.common.Vec3(.8,.1,1),this.contactColor3=new y.common.Vec3(.1,.8,.6),this.contactColor2=new y.common.Vec3(1,.6,.1),this.contactColor=new y.common.Vec3(1,.1,.1),this.pairColor=new y.common.Vec3(1,1,.1),this.bvhNodeColor=new y.common.Vec3(.4,.4,.4),this.aabbColor=new y.common.Vec3(1,.1,.1),this.kinematicShapeColor=new y.common.Vec3(1,.5,.1),this.staticShapeColor=new y.common.Vec3(.7,.7,.7),this.sleepingShapeColor2=new y.common.Vec3(.2,.8,.5),this.sleepingShapeColor1=new y.common.Vec3(.3,.3,.8),this.sleepyShapeColor2=new y.common.Vec3(.6,.8,.3),this.sleepyShapeColor1=new y.common.Vec3(.5,.25,.6),this.shapeColor2=new y.common.Vec3(1,.8,.1),this.shapeColor1=new y.common.Vec3(.7,.2,.4)}};y.dynamics.common.Performance=class{};y.dynamics.constraint||(y.dynamics.constraint={});y.dynamics.constraint.ConstraintSolver=class{constructor(){this._b1=null,this._b2=null,this._addedToIsland=!1}preSolveVelocity(t){}warmStart(t){}solveVelocity(){}postSolveVelocity(t){}preSolvePosition(t){}solvePositionSplitImpulse(){}solvePositionNgs(t){}postSolve(){}};y.dynamics.constraint.PositionCorrectionAlgorithm=class{};y.dynamics.constraint.contact||(y.dynamics.constraint.contact={});y.dynamics.constraint.contact.ContactConstraint=class{constructor(t){this._solver=new y.dynamics.constraint.solver.pgs.PgsContactConstraintSolver(this),this._manifold=t}_getVelocitySolverInfo(t,e){e.b1=this._b1,e.b2=this._b2;let i,n,s,o,r,_,a,l,h;i=this._manifold._normalX,n=this._manifold._normalY,s=this._manifold._normalZ,o=this._manifold._tangentX,r=this._manifold._tangentY,_=this._manifold._tangentZ,a=this._manifold._binormalX,l=this._manifold._binormalY,h=this._manifold._binormalZ;let m=Math.sqrt(this._s1._friction*this._s2._friction),f=Math.sqrt(this._s1._restitution*this._s2._restitution),p=this._manifold._numPoints;e.numRows=0;let d=0;for(;d<p;){let u=this._manifold._points[d++];if(u._depth<0){u._disabled=!0;let b=u._impulse;b.impulseN=0,b.impulseT=0,b.impulseB=0,b.impulseP=0,b.impulseLX=0,b.impulseLY=0,b.impulseLZ=0;continue}else u._disabled=!1;let g=e.rows[e.numRows++];g.friction=m,g.cfm=0;let v=g.jacobianN;v.lin1X=i,v.lin1Y=n,v.lin1Z=s,v.lin2X=i,v.lin2Y=n,v.lin2Z=s,v.ang1X=u._relPos1Y*s-u._relPos1Z*n,v.ang1Y=u._relPos1Z*i-u._relPos1X*s,v.ang1Z=u._relPos1X*n-u._relPos1Y*i,v.ang2X=u._relPos2Y*s-u._relPos2Z*n,v.ang2Y=u._relPos2Z*i-u._relPos2X*s,v.ang2Z=u._relPos2X*n-u._relPos2Y*i,v=g.jacobianT,v.lin1X=o,v.lin1Y=r,v.lin1Z=_,v.lin2X=o,v.lin2Y=r,v.lin2Z=_,v.ang1X=u._relPos1Y*_-u._relPos1Z*r,v.ang1Y=u._relPos1Z*o-u._relPos1X*_,v.ang1Z=u._relPos1X*r-u._relPos1Y*o,v.ang2X=u._relPos2Y*_-u._relPos2Z*r,v.ang2Y=u._relPos2Z*o-u._relPos2X*_,v.ang2Z=u._relPos2X*r-u._relPos2Y*o,v=g.jacobianB,v.lin1X=a,v.lin1Y=l,v.lin1Z=h,v.lin2X=a,v.lin2Y=l,v.lin2Z=h,v.ang1X=u._relPos1Y*h-u._relPos1Z*l,v.ang1Y=u._relPos1Z*a-u._relPos1X*h,v.ang1Z=u._relPos1X*l-u._relPos1Y*a,v.ang2X=u._relPos2Y*h-u._relPos2Z*l,v.ang2Y=u._relPos2Z*a-u._relPos2X*h,v.ang2Z=u._relPos2X*l-u._relPos2Y*a,v=g.jacobianN;let x=v.lin1X*this._b1._velX+v.lin1Y*this._b1._velY+v.lin1Z*this._b1._velZ+(v.ang1X*this._b1._angVelX+v.ang1Y*this._b1._angVelY+v.ang1Z*this._b1._angVelZ)-(v.lin2X*this._b2._velX+v.lin2Y*this._b2._velY+v.lin2Z*this._b2._velZ+(v.ang2X*this._b2._angVelX+v.ang2Y*this._b2._angVelY+v.ang2Z*this._b2._angVelZ));if(x<-y.common.Setting.contactEnableBounceThreshold&&!u._warmStarted?g.rhs=-x*f:g.rhs=0,this._positionCorrectionAlgorithm==y.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE&&u._depth>y.common.Setting.linearSlop){let b=(u._depth-y.common.Setting.linearSlop)*y.common.Setting.velocityBaumgarte*t.invDt;g.rhs<b&&(g.rhs=b)}if(!u._warmStarted){let b=u._impulse;b.impulseN=0,b.impulseT=0,b.impulseB=0,b.impulseP=0,b.impulseLX=0,b.impulseLY=0,b.impulseLZ=0}g.impulse=u._impulse}}_getPositionSolverInfo(t){t.b1=this._b1,t.b2=this._b2;let e,i,n;e=this._manifold._normalX,i=this._manifold._normalY,n=this._manifold._normalZ;let s=this._manifold._numPoints;t.numRows=0;let o=0;for(;o<s;){let r=this._manifold._points[o++];if(r._disabled)continue;let _=t.rows[t.numRows++],a=_.jacobianN;a.lin1X=e,a.lin1Y=i,a.lin1Z=n,a.lin2X=e,a.lin2Y=i,a.lin2Z=n,a.ang1X=r._relPos1Y*n-r._relPos1Z*i,a.ang1Y=r._relPos1Z*e-r._relPos1X*n,a.ang1Z=r._relPos1X*i-r._relPos1Y*e,a.ang2X=r._relPos2Y*n-r._relPos2Z*i,a.ang2Y=r._relPos2Z*e-r._relPos2X*n,a.ang2Z=r._relPos2X*i-r._relPos2Y*e,_.rhs=r._depth-y.common.Setting.linearSlop,_.rhs<0&&(_.rhs=0),_.impulse=r._impulse}}_syncManifold(){this._manifold._updateDepthsAndPositions(this._tf1,this._tf2)}getShape1(){return this._s1}getShape2(){return this._s2}getManifold(){return this._manifold}isTouching(){let t=0,e=this._manifold._numPoints;for(;t<e;)if(this._manifold._points[t++]._depth>=0)return!0;return!1}};y.dynamics.constraint.contact.ContactImpulse=class{constructor(){this.impulseN=0,this.impulseT=0,this.impulseB=0,this.impulseP=0,this.impulseLX=0,this.impulseLY=0,this.impulseLZ=0}copyFrom(t){this.impulseN=t.impulseN,this.impulseT=t.impulseT,this.impulseB=t.impulseB,this.impulseLX=t.impulseLX,this.impulseLY=t.impulseLY,this.impulseLZ=t.impulseLZ}};y.dynamics.constraint.contact.Manifold=class{constructor(){this._normalX=0,this._normalY=0,this._normalZ=0,this._tangentX=0,this._tangentY=0,this._tangentZ=0,this._binormalX=0,this._binormalY=0,this._binormalZ=0,this._numPoints=0,this._points=new Array(y.common.Setting.maxManifoldPoints);let t=0,e=y.common.Setting.maxManifoldPoints;for(;t<e;)this._points[t++]=new y.dynamics.constraint.contact.ManifoldPoint}_clear(){let t=0,e=this._numPoints;for(;t<e;){let i=this._points[t++];i._localPos1X=0,i._localPos1Y=0,i._localPos1Z=0,i._localPos2X=0,i._localPos2Y=0,i._localPos2Z=0,i._relPos1X=0,i._relPos1Y=0,i._relPos1Z=0,i._relPos2X=0,i._relPos2Y=0,i._relPos2Z=0,i._pos1X=0,i._pos1Y=0,i._pos1Z=0,i._pos2X=0,i._pos2Y=0,i._pos2Z=0,i._depth=0;let n=i._impulse;n.impulseN=0,n.impulseT=0,n.impulseB=0,n.impulseP=0,n.impulseLX=0,n.impulseLY=0,n.impulseLZ=0,i._warmStarted=!1,i._disabled=!1,i._id=-1}this._numPoints=0}_buildBasis(t){this._normalX=t.x,this._normalY=t.y,this._normalZ=t.z;let e=t.x,i=t.y,n=t.z,s=e*e,o=i*i,r=n*n,_,a,l,h,m,f;if(s<o)if(s<r){let p=1/Math.sqrt(o+r);_=0,a=-n*p,l=i*p,h=i*l-n*a,m=-e*l,f=e*a}else{let p=1/Math.sqrt(s+o);_=-i*p,a=e*p,l=0,h=-n*a,m=n*_,f=e*a-i*_}else if(o<r){let p=1/Math.sqrt(s+r);_=n*p,a=0,l=-e*p,h=i*l,m=n*_-e*l,f=-i*_}else{let p=1/Math.sqrt(s+o);_=-i*p,a=e*p,l=0,h=-n*a,m=n*_,f=e*a-i*_}this._tangentX=_,this._tangentY=a,this._tangentZ=l,this._binormalX=h,this._binormalY=m,this._binormalZ=f}_updateDepthsAndPositions(t,e){let i=0,n=this._numPoints;for(;i<n;){let s=this._points[i++],o,r,_;o=t._rotation00*s._localPos1X+t._rotation01*s._localPos1Y+t._rotation02*s._localPos1Z,r=t._rotation10*s._localPos1X+t._rotation11*s._localPos1Y+t._rotation12*s._localPos1Z,_=t._rotation20*s._localPos1X+t._rotation21*s._localPos1Y+t._rotation22*s._localPos1Z,s._relPos1X=o,s._relPos1Y=r,s._relPos1Z=_;let a,l,h;a=e._rotation00*s._localPos2X+e._rotation01*s._localPos2Y+e._rotation02*s._localPos2Z,l=e._rotation10*s._localPos2X+e._rotation11*s._localPos2Y+e._rotation12*s._localPos2Z,h=e._rotation20*s._localPos2X+e._rotation21*s._localPos2Y+e._rotation22*s._localPos2Z,s._relPos2X=a,s._relPos2Y=l,s._relPos2Z=h,s._pos1X=s._relPos1X+t._positionX,s._pos1Y=s._relPos1Y+t._positionY,s._pos1Z=s._relPos1Z+t._positionZ,s._pos2X=s._relPos2X+e._positionX,s._pos2Y=s._relPos2Y+e._positionY,s._pos2Z=s._relPos2Z+e._positionZ;let m,f,p;m=s._pos1X-s._pos2X,f=s._pos1Y-s._pos2Y,p=s._pos1Z-s._pos2Z,s._depth=-(m*this._normalX+f*this._normalY+p*this._normalZ)}}getNormal(){let t=new y.common.Vec3;return t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ,t}getNormalTo(t){t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ}getTangent(){let t=new y.common.Vec3;return t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ,t}getTangentTo(t){t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ}getBinormal(){let t=new y.common.Vec3;return t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ,t}getBinormalTo(t){t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ}getPoints(){return this._points}getNumPoints(){return this._numPoints}};y.dynamics.constraint.contact.ManifoldPoint=class{constructor(){this._localPos1X=0,this._localPos1Y=0,this._localPos1Z=0,this._localPos2X=0,this._localPos2Y=0,this._localPos2Z=0,this._relPos1X=0,this._relPos1Y=0,this._relPos1Z=0,this._relPos2X=0,this._relPos2Y=0,this._relPos2Z=0,this._pos1X=0,this._pos1Y=0,this._pos1Z=0,this._pos2X=0,this._pos2Y=0,this._pos2Z=0,this._depth=0,this._impulse=new y.dynamics.constraint.contact.ContactImpulse,this._warmStarted=!1,this._disabled=!1,this._id=-1}getPosition1(){let t=new y.common.Vec3;return t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z,t}getPosition1To(t){t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z}getPosition2(){let t=new y.common.Vec3;return t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z,t}getPosition2To(t){t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z}getDepth(){return this._depth}isWarmStarted(){return this._warmStarted}getNormalImpulse(){return this._impulse.impulseN}getTangentImpulse(){return this._impulse.impulseT}getBinormalImpulse(){return this._impulse.impulseB}isEnabled(){return!this._disabled}};y.dynamics.constraint.contact.ManifoldUpdater=class{constructor(t){this._manifold=t,this.numOldPoints=0,this.oldPoints=new Array(y.common.Setting.maxManifoldPoints);let e=0,i=y.common.Setting.maxManifoldPoints;for(;e<i;)this.oldPoints[e++]=new y.dynamics.constraint.contact.ManifoldPoint}removeOutdatedPoints(){let t=this._manifold._numPoints;for(;--t>=0;){let e=this._manifold._points[t],i,n,s;i=e._pos1X-e._pos2X,n=e._pos1Y-e._pos2Y,s=e._pos1Z-e._pos2Z;let o=this._manifold._normalX*i+this._manifold._normalY*n+this._manifold._normalZ*s;if(o>y.common.Setting.contactPersistenceThreshold){this.removeManifoldPoint(t);continue}if(i+=this._manifold._normalX*-o,n+=this._manifold._normalY*-o,s+=this._manifold._normalZ*-o,i*i+n*n+s*s>y.common.Setting.contactPersistenceThreshold*y.common.Setting.contactPersistenceThreshold){this.removeManifoldPoint(t);continue}}}removeManifoldPoint(t){let e=--this._manifold._numPoints;if(t!=e){let s=this._manifold._points[t];this._manifold._points[t]=this._manifold._points[e],this._manifold._points[e]=s}let i=this._manifold._points[e];i._localPos1X=0,i._localPos1Y=0,i._localPos1Z=0,i._localPos2X=0,i._localPos2Y=0,i._localPos2Z=0,i._relPos1X=0,i._relPos1Y=0,i._relPos1Z=0,i._relPos2X=0,i._relPos2Y=0,i._relPos2Z=0,i._pos1X=0,i._pos1Y=0,i._pos1Z=0,i._pos2X=0,i._pos2Y=0,i._pos2Z=0,i._depth=0;let n=i._impulse;n.impulseN=0,n.impulseT=0,n.impulseB=0,n.impulseP=0,n.impulseLX=0,n.impulseLY=0,n.impulseLZ=0,i._warmStarted=!1,i._disabled=!1,i._id=-1}addManifoldPoint(t,e,i){let n=this._manifold._numPoints;if(n==y.common.Setting.maxManifoldPoints){let d=this.computeTargetIndex(t,e,i),u=this._manifold._points[d],g=t.position1;u._pos1X=g.x,u._pos1Y=g.y,u._pos1Z=g.z;let v=t.position2;u._pos2X=v.x,u._pos2Y=v.y,u._pos2Z=v.z,u._relPos1X=u._pos1X-e._positionX,u._relPos1Y=u._pos1Y-e._positionY,u._relPos1Z=u._pos1Z-e._positionZ,u._relPos2X=u._pos2X-i._positionX,u._relPos2Y=u._pos2Y-i._positionY,u._relPos2Z=u._pos2Z-i._positionZ;let x,b,Y;x=e._rotation00*u._relPos1X+e._rotation10*u._relPos1Y+e._rotation20*u._relPos1Z,b=e._rotation01*u._relPos1X+e._rotation11*u._relPos1Y+e._rotation21*u._relPos1Z,Y=e._rotation02*u._relPos1X+e._rotation12*u._relPos1Y+e._rotation22*u._relPos1Z,u._localPos1X=x,u._localPos1Y=b,u._localPos1Z=Y;let w,Z,X;w=i._rotation00*u._relPos2X+i._rotation10*u._relPos2Y+i._rotation20*u._relPos2Z,Z=i._rotation01*u._relPos2X+i._rotation11*u._relPos2Y+i._rotation21*u._relPos2Z,X=i._rotation02*u._relPos2X+i._rotation12*u._relPos2Y+i._rotation22*u._relPos2Z,u._localPos2X=w,u._localPos2Y=Z,u._localPos2Z=X,u._depth=t.depth;let M=u._impulse;M.impulseN=0,M.impulseT=0,M.impulseB=0,M.impulseP=0,M.impulseLX=0,M.impulseLY=0,M.impulseLZ=0,u._id=t.id,u._warmStarted=!1,u._disabled=!1;return}let s=this._manifold._points[n],o=t.position1;s._pos1X=o.x,s._pos1Y=o.y,s._pos1Z=o.z;let r=t.position2;s._pos2X=r.x,s._pos2Y=r.y,s._pos2Z=r.z,s._relPos1X=s._pos1X-e._positionX,s._relPos1Y=s._pos1Y-e._positionY,s._relPos1Z=s._pos1Z-e._positionZ,s._relPos2X=s._pos2X-i._positionX,s._relPos2Y=s._pos2Y-i._positionY,s._relPos2Z=s._pos2Z-i._positionZ;let _,a,l;_=e._rotation00*s._relPos1X+e._rotation10*s._relPos1Y+e._rotation20*s._relPos1Z,a=e._rotation01*s._relPos1X+e._rotation11*s._relPos1Y+e._rotation21*s._relPos1Z,l=e._rotation02*s._relPos1X+e._rotation12*s._relPos1Y+e._rotation22*s._relPos1Z,s._localPos1X=_,s._localPos1Y=a,s._localPos1Z=l;let h,m,f;h=i._rotation00*s._relPos2X+i._rotation10*s._relPos2Y+i._rotation20*s._relPos2Z,m=i._rotation01*s._relPos2X+i._rotation11*s._relPos2Y+i._rotation21*s._relPos2Z,f=i._rotation02*s._relPos2X+i._rotation12*s._relPos2Y+i._rotation22*s._relPos2Z,s._localPos2X=h,s._localPos2Y=m,s._localPos2Z=f,s._depth=t.depth;let p=s._impulse;p.impulseN=0,p.impulseT=0,p.impulseB=0,p.impulseP=0,p.impulseLX=0,p.impulseLY=0,p.impulseLZ=0,s._id=t.id,s._warmStarted=!1,s._disabled=!1,this._manifold._numPoints++}computeTargetIndex(t,e,i){let n=this._manifold._points[0],s=this._manifold._points[1],o=this._manifold._points[2],r=this._manifold._points[3],_=n._depth,a=0;s._depth>_&&(_=s._depth,a=1),o._depth>_&&(_=o._depth,a=2),r._depth>_&&(a=3);let l,h,m,f=t.position1;l=f.x,h=f.y,m=f.z,l-=e._positionX,h-=e._positionY,m-=e._positionZ;let p=s._relPos1X,d=s._relPos1Y,u=s._relPos1Z,g=o._relPos1X,v=o._relPos1Y,x=o._relPos1Z,b=r._relPos1X,Y=r._relPos1Y,w=r._relPos1Z,Z,X,M,z,T,F,P,A,L,S,R,E,C,k,V,B,J,I;Z=g-p,X=v-d,M=x-u,z=l-b,T=h-Y,F=m-w,P=b-p,A=Y-d,L=w-u,S=l-g,R=h-v,E=m-x,C=l-p,k=h-d,V=m-u,B=b-g,J=Y-v,I=w-x;let G,D,et,$,j,q,tt,W,U;G=X*F-M*T,D=M*z-Z*F,et=Z*T-X*z,$=A*E-L*R,j=L*S-P*E,q=P*R-A*S,tt=k*I-V*J,W=V*B-C*I,U=C*J-k*B;let it=G*G+D*D+et*et,Q=$*$+j*j+q*q,at=tt*tt+W*W+U*U,ht=n._relPos1X,_t=n._relPos1Y,mt=n._relPos1Z,ft=o._relPos1X,ut=o._relPos1Y,H=o._relPos1Z,O=r._relPos1X,ot=r._relPos1Y,pt=r._relPos1Z,vt,xt,Mt,ct,St,It,dt,K,lt,rt,Vt,At,Yt,Xt,Nt,ie,ee,Ze;vt=ft-ht,xt=ut-_t,Mt=H-mt,ct=l-O,St=h-ot,It=m-pt,dt=O-ht,K=ot-_t,lt=pt-mt,rt=l-ft,Vt=h-ut,At=m-H,Yt=l-ht,Xt=h-_t,Nt=m-mt,ie=O-ft,ee=ot-ut,Ze=pt-H;let ze,pe,$t,Ht,ue,Ie,qe,Ee,Ut;ze=xt*It-Mt*St,pe=Mt*ct-vt*It,$t=vt*St-xt*ct,Ht=K*At-lt*Vt,ue=lt*rt-dt*At,Ie=dt*Vt-K*rt,qe=Xt*Ze-Nt*ee,Ee=Nt*ie-Yt*Ze,Ut=Yt*ee-Xt*ie;let nt=ze*ze+pe*pe+$t*$t,gt=Ht*Ht+ue*ue+Ie*Ie,yt=qe*qe+Ee*Ee+Ut*Ut,bt=nt>gt?nt>yt?nt:yt:gt>yt?gt:yt,st=n._relPos1X,Pt=n._relPos1Y,Dt=n._relPos1Z,N=s._relPos1X,kt=s._relPos1Y,Rt=s._relPos1Z,Ot=r._relPos1X,Wt=r._relPos1Y,Bt=r._relPos1Z,re,Ce,be,Tt,Lt,Zt,me,Me,fe,ti,di,Le,_i,yi,he,gi,bi,Mi;re=N-st,Ce=kt-Pt,be=Rt-Dt,Tt=l-Ot,Lt=h-Wt,Zt=m-Bt,me=Ot-st,Me=Wt-Pt,fe=Bt-Dt,ti=l-N,di=h-kt,Le=m-Rt,_i=l-st,yi=h-Pt,he=m-Dt,gi=Ot-N,bi=Wt-kt,Mi=Bt-Rt;let Ii,He,Je,Ke,ci,hi,ei,ai,Qe;Ii=Ce*Zt-be*Lt,He=be*Tt-re*Zt,Je=re*Lt-Ce*Tt,Ke=Me*Le-fe*di,ci=fe*ti-me*Le,hi=me*di-Me*ti,ei=yi*Mi-he*bi,ai=he*gi-_i*Mi,Qe=_i*bi-yi*gi;let We=Ii*Ii+He*He+Je*Je,ke=Ke*Ke+ci*ci+hi*hi,le=ei*ei+ai*ai+Qe*Qe,ge=We>ke?We>le?We:le:ke>le?ke:le,jt=n._relPos1X,Ae=n._relPos1Y,Se=n._relPos1Z,Re=s._relPos1X,Te=s._relPos1Y,Ne=s._relPos1Z,se=o._relPos1X,Ct=o._relPos1Y,Gt=o._relPos1Z,Pe,Ve,Ue,ii,ri,ui,vi,ce,Ge,we,Be,xe,qt,Jt,ve,Qt,zt,Et;Pe=Re-jt,Ve=Te-Ae,Ue=Ne-Se,ii=l-se,ri=h-Ct,ui=m-Gt,vi=se-jt,ce=Ct-Ae,Ge=Gt-Se,we=l-Re,Be=h-Te,xe=m-Ne,qt=l-jt,Jt=h-Ae,ve=m-Se,Qt=se-Re,zt=Ct-Te,Et=Gt-Ne;let Kt,te,ne,_e,de,Ye,ye,oe,Ft;Kt=Ve*ui-Ue*ri,te=Ue*ii-Pe*ui,ne=Pe*ri-Ve*ii,_e=ce*xe-Ge*Be,de=Ge*we-vi*xe,Ye=vi*Be-ce*we,ye=Jt*Et-ve*zt,oe=ve*Qt-qt*Et,Ft=qt*zt-Jt*Qt;let ae=Kt*Kt+te*te+ne*ne,Xe=_e*_e+de*de+Ye*Ye,Oe=ye*ye+oe*oe+Ft*Ft,oi=ae>Xe?ae>Oe?ae:Oe:Xe>Oe?Xe:Oe,pi=it>Q?it>at?it:at:Q>at?Q:at,$e=0;return(bt>pi&&a!=1||a==0)&&(pi=bt,$e=1),ge>pi&&a!=2&&(pi=ge,$e=2),oi>pi&&a!=3&&($e=3),$e}computeRelativePositions(t,e){let i=this._manifold._numPoints,n=0;for(;n<i;){let s=this._manifold._points[n++],o,r,_;o=t._rotation00*s._localPos1X+t._rotation01*s._localPos1Y+t._rotation02*s._localPos1Z,r=t._rotation10*s._localPos1X+t._rotation11*s._localPos1Y+t._rotation12*s._localPos1Z,_=t._rotation20*s._localPos1X+t._rotation21*s._localPos1Y+t._rotation22*s._localPos1Z,s._relPos1X=o,s._relPos1Y=r,s._relPos1Z=_;let a,l,h;a=e._rotation00*s._localPos2X+e._rotation01*s._localPos2Y+e._rotation02*s._localPos2Z,l=e._rotation10*s._localPos2X+e._rotation11*s._localPos2Y+e._rotation12*s._localPos2Z,h=e._rotation20*s._localPos2X+e._rotation21*s._localPos2Y+e._rotation22*s._localPos2Z,s._relPos2X=a,s._relPos2Y=l,s._relPos2Z=h,s._warmStarted=!0}}findNearestContactPointIndex(t,e,i){let n=y.common.Setting.contactPersistenceThreshold*y.common.Setting.contactPersistenceThreshold,s=-1,o=0,r=this._manifold._numPoints;for(;o<r;){let _=o++,a=this._manifold._points[_],l,h,m,f,p,d,u=t.position1;l=u.x,h=u.y,m=u.z;let g=t.position2;f=g.x,p=g.y,d=g.z,l-=e._positionX,h-=e._positionY,m-=e._positionZ,f-=i._positionX,p-=i._positionY,d-=i._positionZ;let v,x,b,Y,w,Z;v=a._relPos1X-l,x=a._relPos1Y-h,b=a._relPos1Z-m,Y=a._relPos2X-f,w=a._relPos2Y-p,Z=a._relPos2Z-d;let X=v*v+x*x+b*b,M=Y*Y+w*w+Z*Z,z=X<M?X:M;z<n&&(n=z,s=_)}return s}totalUpdate(t,e,i){this.numOldPoints=this._manifold._numPoints;let n=0,s=this.numOldPoints;for(;n<s;){let _=n++,a=this.oldPoints[_],l=this._manifold._points[_];a._localPos1X=l._localPos1X,a._localPos1Y=l._localPos1Y,a._localPos1Z=l._localPos1Z,a._localPos2X=l._localPos2X,a._localPos2Y=l._localPos2Y,a._localPos2Z=l._localPos2Z,a._relPos1X=l._relPos1X,a._relPos1Y=l._relPos1Y,a._relPos1Z=l._relPos1Z,a._relPos2X=l._relPos2X,a._relPos2Y=l._relPos2Y,a._relPos2Z=l._relPos2Z,a._pos1X=l._pos1X,a._pos1Y=l._pos1Y,a._pos1Z=l._pos1Z,a._pos2X=l._pos2X,a._pos2Y=l._pos2Y,a._pos2Z=l._pos2Z,a._depth=l._depth,a._impulse.copyFrom(l._impulse),a._id=l._id,a._warmStarted=l._warmStarted,a._disabled=!1}let o=t.numPoints;this._manifold._numPoints=o;let r=0;for(;r<o;){let _=r++,a=this._manifold._points[_],l=t.points[_],h=l.position1;a._pos1X=h.x,a._pos1Y=h.y,a._pos1Z=h.z;let m=l.position2;a._pos2X=m.x,a._pos2Y=m.y,a._pos2Z=m.z,a._relPos1X=a._pos1X-e._positionX,a._relPos1Y=a._pos1Y-e._positionY,a._relPos1Z=a._pos1Z-e._positionZ,a._relPos2X=a._pos2X-i._positionX,a._relPos2Y=a._pos2Y-i._positionY,a._relPos2Z=a._pos2Z-i._positionZ;let f,p,d;f=e._rotation00*a._relPos1X+e._rotation10*a._relPos1Y+e._rotation20*a._relPos1Z,p=e._rotation01*a._relPos1X+e._rotation11*a._relPos1Y+e._rotation21*a._relPos1Z,d=e._rotation02*a._relPos1X+e._rotation12*a._relPos1Y+e._rotation22*a._relPos1Z,a._localPos1X=f,a._localPos1Y=p,a._localPos1Z=d;let u,g,v;u=i._rotation00*a._relPos2X+i._rotation10*a._relPos2Y+i._rotation20*a._relPos2Z,g=i._rotation01*a._relPos2X+i._rotation11*a._relPos2Y+i._rotation21*a._relPos2Z,v=i._rotation02*a._relPos2X+i._rotation12*a._relPos2Y+i._rotation22*a._relPos2Z,a._localPos2X=u,a._localPos2Y=g,a._localPos2Z=v,a._depth=l.depth;let x=a._impulse;x.impulseN=0,x.impulseT=0,x.impulseB=0,x.impulseP=0,x.impulseLX=0,x.impulseLY=0,x.impulseLZ=0,a._id=l.id,a._warmStarted=!1,a._disabled=!1;let b=0,Y=this.numOldPoints;for(;b<Y;){let w=this.oldPoints[b++];if(a._id==w._id){a._impulse.copyFrom(w._impulse),a._warmStarted=!0;break}}}}incrementalUpdate(t,e,i){this._manifold._updateDepthsAndPositions(e,i);let n=0,s=this._manifold._numPoints;for(;n<s;)this._manifold._points[n++]._warmStarted=!0;let o=t.points[0],r=this.findNearestContactPointIndex(o,e,i);if(r==-1)this.addManifoldPoint(o,e,i);else{let _=this._manifold._points[r],a=o.position1;_._pos1X=a.x,_._pos1Y=a.y,_._pos1Z=a.z;let l=o.position2;_._pos2X=l.x,_._pos2Y=l.y,_._pos2Z=l.z,_._relPos1X=_._pos1X-e._positionX,_._relPos1Y=_._pos1Y-e._positionY,_._relPos1Z=_._pos1Z-e._positionZ,_._relPos2X=_._pos2X-i._positionX,_._relPos2Y=_._pos2Y-i._positionY,_._relPos2Z=_._pos2Z-i._positionZ;let h,m,f;h=e._rotation00*_._relPos1X+e._rotation10*_._relPos1Y+e._rotation20*_._relPos1Z,m=e._rotation01*_._relPos1X+e._rotation11*_._relPos1Y+e._rotation21*_._relPos1Z,f=e._rotation02*_._relPos1X+e._rotation12*_._relPos1Y+e._rotation22*_._relPos1Z,_._localPos1X=h,_._localPos1Y=m,_._localPos1Z=f;let p,d,u;p=i._rotation00*_._relPos2X+i._rotation10*_._relPos2Y+i._rotation20*_._relPos2Z,d=i._rotation01*_._relPos2X+i._rotation11*_._relPos2Y+i._rotation21*_._relPos2Z,u=i._rotation02*_._relPos2X+i._rotation12*_._relPos2Y+i._rotation22*_._relPos2Z,_._localPos2X=p,_._localPos2Y=d,_._localPos2Z=u,_._depth=o.depth}this.removeOutdatedPoints()}};y.dynamics.constraint.info||(y.dynamics.constraint.info={});y.dynamics.constraint.info.JacobianRow=class{constructor(){this.lin1X=0,this.lin1Y=0,this.lin1Z=0,this.lin2X=0,this.lin2Y=0,this.lin2Z=0,this.ang1X=0,this.ang1Y=0,this.ang1Z=0,this.ang2X=0,this.ang2Y=0,this.ang2Z=0,this.flag=0}updateSparsity(){this.flag=0,(!(this.lin1X==0&&this.lin1Y==0&&this.lin1Z==0)||!(this.lin2X==0&&this.lin2Y==0&&this.lin2Z==0))&&(this.flag|=1),(!(this.ang1X==0&&this.ang1Y==0&&this.ang1Z==0)||!(this.ang2X==0&&this.ang2Y==0&&this.ang2Z==0))&&(this.flag|=2)}};y.dynamics.constraint.info.contact||(y.dynamics.constraint.info.contact={});y.dynamics.constraint.info.contact.ContactSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0,this.rows=new Array(y.common.Setting.maxManifoldPoints);let t=0,e=this.rows.length;for(;t<e;)this.rows[t++]=new y.dynamics.constraint.info.contact.ContactSolverInfoRow}};y.dynamics.constraint.info.contact.ContactSolverInfoRow=class{constructor(){this.jacobianN=new y.dynamics.constraint.info.JacobianRow,this.jacobianT=new y.dynamics.constraint.info.JacobianRow,this.jacobianB=new y.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.friction=0,this.impulse=null}};y.dynamics.constraint.info.joint||(y.dynamics.constraint.info.joint={});y.dynamics.constraint.info.joint.JointSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0,this.rows=new Array(y.common.Setting.maxJacobianRows);let t=0,e=this.rows.length;for(;t<e;)this.rows[t++]=new y.dynamics.constraint.info.joint.JointSolverInfoRow}};y.dynamics.constraint.info.joint.JointSolverInfoRow=class{constructor(){this.jacobian=new y.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.minImpulse=0,this.maxImpulse=0,this.motorSpeed=0,this.motorMaxImpulse=0,this.impulse=null}};y.dynamics.constraint.joint||(y.dynamics.constraint.joint={});y.dynamics.constraint.joint.BasisTracker=class{constructor(t){this.joint=t,this.xX=0,this.xY=0,this.xZ=0,this.yX=0,this.yY=0,this.yZ=0,this.zX=0,this.zY=0,this.zZ=0}};y.dynamics.constraint.joint.Joint=class{constructor(t,e){switch(this._link1=new y.dynamics.constraint.joint.JointLink(this),this._link2=new y.dynamics.constraint.joint.JointLink(this),this._positionCorrectionAlgorithm=y.common.Setting.defaultJointPositionCorrectionAlgorithm,this._type=e,this._world=null,this._b1=t.rigidBody1,this._b2=t.rigidBody2,this._allowCollision=t.allowCollision,this._breakForce=t.breakForce,this._breakTorque=t.breakTorque,t.solverType){case 0:this._solver=new y.dynamics.constraint.solver.pgs.PgsJointConstraintSolver(this);break;case 1:this._solver=new y.dynamics.constraint.solver.direct.DirectJointConstraintSolver(this);break}let i=t.localAnchor1;this._localAnchor1X=i.x,this._localAnchor1Y=i.y,this._localAnchor1Z=i.z;let n=t.localAnchor2;this._localAnchor2X=n.x,this._localAnchor2Y=n.y,this._localAnchor2Z=n.z,this._relativeAnchor1X=0,this._relativeAnchor1Y=0,this._relativeAnchor1Z=0,this._relativeAnchor2X=0,this._relativeAnchor2Y=0,this._relativeAnchor2Z=0,this._anchor1X=0,this._anchor1Y=0,this._anchor1Z=0,this._anchor2X=0,this._anchor2Y=0,this._anchor2Z=0,this._localBasisX1X=0,this._localBasisX1Y=0,this._localBasisX1Z=0,this._localBasisY1X=0,this._localBasisY1Y=0,this._localBasisY1Z=0,this._localBasisZ1X=0,this._localBasisZ1Y=0,this._localBasisZ1Z=0,this._localBasisX2X=0,this._localBasisX2Y=0,this._localBasisX2Z=0,this._localBasisY2X=0,this._localBasisY2Y=0,this._localBasisY2Z=0,this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=0,this._impulses=new Array(y.common.Setting.maxJacobianRows);let s=0,o=y.common.Setting.maxJacobianRows;for(;s<o;)this._impulses[s++]=new y.dynamics.constraint.joint.JointImpulse}buildLocalBasesFromX(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let tt=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;tt>0&&(tt=1/Math.sqrt(tt)),this._localBasisX1X*=tt,this._localBasisX1Y*=tt,this._localBasisX1Z*=tt}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{let tt=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;tt>0&&(tt=1/Math.sqrt(tt)),this._localBasisX2X*=tt,this._localBasisX2Y*=tt,this._localBasisX2Z*=tt}let t,e,i,n,s,o,r,_,a,l,h,m,f,p=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(p<-.999999999){let tt,W,U,it=this._localBasisX1X,Q=this._localBasisX1Y,at=this._localBasisX1Z,ht=it*it,_t=Q*Q,mt=at*at,ft;ht<_t?ht<mt?(ft=1/Math.sqrt(_t+mt),tt=0,W=at*ft,U=-Q*ft):(ft=1/Math.sqrt(ht+_t),tt=Q*ft,W=-it*ft,U=0):_t<mt?(ft=1/Math.sqrt(mt+ht),tt=-at*ft,W=0,U=it*ft):(ft=1/Math.sqrt(ht+_t),tt=Q*ft,W=-it*ft,U=0),t=tt,e=W,i=U,n=0}else{let tt,W,U;tt=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,W=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,U=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;let it=Math.sqrt((1+p)*.5);p=.5/it,tt*=p,W*=p,U*=p,t=tt,e=W,i=U,n=it}let d=t,u=e,g=i,v=n,x=2*d,b=2*u,Y=2*g,w=d*x,Z=u*b,X=g*Y,M=d*b,z=u*Y,T=d*Y,F=v*x,P=v*b,A=v*Y;s=1-Z-X,o=M-A,r=T+P,_=M+A,a=1-w-X,l=z-F,h=T-P,m=z+F,f=1-w-Z;let L=this._localBasisX1X,S=this._localBasisX1Y,R=this._localBasisX1Z,E=L*L,C=S*S,k=R*R,V;E<C?E<k?(V=1/Math.sqrt(C+k),this._localBasisY1X=0,this._localBasisY1Y=R*V,this._localBasisY1Z=-S*V):(V=1/Math.sqrt(E+C),this._localBasisY1X=S*V,this._localBasisY1Y=-L*V,this._localBasisY1Z=0):C<k?(V=1/Math.sqrt(k+E),this._localBasisY1X=-R*V,this._localBasisY1Y=0,this._localBasisY1Z=L*V):(V=1/Math.sqrt(E+C),this._localBasisY1X=S*V,this._localBasisY1Y=-L*V,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X;let B,J,I;B=s*this._localBasisX1X+o*this._localBasisX1Y+r*this._localBasisX1Z,J=_*this._localBasisX1X+a*this._localBasisX1Y+l*this._localBasisX1Z,I=h*this._localBasisX1X+m*this._localBasisX1Y+f*this._localBasisX1Z,this._localBasisX2X=B,this._localBasisX2Y=J,this._localBasisX2Z=I;let G,D,et;G=s*this._localBasisY1X+o*this._localBasisY1Y+r*this._localBasisY1Z,D=_*this._localBasisY1X+a*this._localBasisY1Y+l*this._localBasisY1Z,et=h*this._localBasisY1X+m*this._localBasisY1Y+f*this._localBasisY1Z,this._localBasisY2X=G,this._localBasisY2Y=D,this._localBasisY2Z=et;let $,j,q;$=s*this._localBasisZ1X+o*this._localBasisZ1Y+r*this._localBasisZ1Z,j=_*this._localBasisZ1X+a*this._localBasisZ1Y+l*this._localBasisZ1Z,q=h*this._localBasisZ1X+m*this._localBasisZ1Y+f*this._localBasisZ1Z,this._localBasisZ2X=$,this._localBasisZ2Y=j,this._localBasisZ2Z=q}buildLocalBasesFromXY(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{let t=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX2X*=t,this._localBasisX2Y*=t,this._localBasisX2Z*=t}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){let t=this._localBasisX1X,e=this._localBasisX1Y,i=this._localBasisX1Z,n=t*t,s=e*e,o=i*i,r;n<s?n<o?(r=1/Math.sqrt(s+o),this._localBasisY1X=0,this._localBasisY1Y=i*r,this._localBasisY1Z=-e*r):(r=1/Math.sqrt(n+s),this._localBasisY1X=e*r,this._localBasisY1Y=-t*r,this._localBasisY1Z=0):s<o?(r=1/Math.sqrt(o+n),this._localBasisY1X=-i*r,this._localBasisY1Y=0,this._localBasisY1Z=t*r):(r=1/Math.sqrt(n+s),this._localBasisY1X=e*r,this._localBasisY1Y=-t*r,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{let t=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ1X*=t,this._localBasisZ1Y*=t,this._localBasisZ1Z*=t,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0){let t=this._localBasisX2X,e=this._localBasisX2Y,i=this._localBasisX2Z,n=t*t,s=e*e,o=i*i,r;n<s?n<o?(r=1/Math.sqrt(s+o),this._localBasisY2X=0,this._localBasisY2Y=i*r,this._localBasisY2Z=-e*r):(r=1/Math.sqrt(n+s),this._localBasisY2X=e*r,this._localBasisY2Y=-t*r,this._localBasisY2Z=0):s<o?(r=1/Math.sqrt(o+n),this._localBasisY2X=-i*r,this._localBasisY2Y=0,this._localBasisY2Z=t*r):(r=1/Math.sqrt(n+s),this._localBasisY2X=e*r,this._localBasisY2Y=-t*r,this._localBasisY2Z=0),this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X}else{let t=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ2X*=t,this._localBasisZ2Y*=t,this._localBasisZ2Z*=t,this._localBasisY2X=this._localBasisZ2Y*this._localBasisX2Z-this._localBasisZ2Z*this._localBasisX2Y,this._localBasisY2Y=this._localBasisZ2Z*this._localBasisX2X-this._localBasisZ2X*this._localBasisX2Z,this._localBasisY2Z=this._localBasisZ2X*this._localBasisX2Y-this._localBasisZ2Y*this._localBasisX2X}}buildLocalBasesFromX1Z2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let D=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;D>0&&(D=1/Math.sqrt(D)),this._localBasisX1X*=D,this._localBasisX1Y*=D,this._localBasisX1Z*=D}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0)this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=1;else{let D=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;D>0&&(D=1/Math.sqrt(D)),this._localBasisZ2X*=D,this._localBasisZ2Y*=D,this._localBasisZ2Z*=D}let t=this._b1._transform,e=this._b2._transform,i,n,s,o,r,_,a,l,h,m,f,p,d,u,g,v,x,b;v=t._rotation00*this._localBasisX1X+t._rotation01*this._localBasisX1Y+t._rotation02*this._localBasisX1Z,x=t._rotation10*this._localBasisX1X+t._rotation11*this._localBasisX1Y+t._rotation12*this._localBasisX1Z,b=t._rotation20*this._localBasisX1X+t._rotation21*this._localBasisX1Y+t._rotation22*this._localBasisX1Z,i=v,n=x,s=b;let Y,w,Z;if(Y=e._rotation00*this._localBasisZ2X+e._rotation01*this._localBasisZ2Y+e._rotation02*this._localBasisZ2Z,w=e._rotation10*this._localBasisZ2X+e._rotation11*this._localBasisZ2Y+e._rotation12*this._localBasisZ2Z,Z=e._rotation20*this._localBasisZ2X+e._rotation21*this._localBasisZ2Y+e._rotation22*this._localBasisZ2Z,d=Y,u=w,g=Z,a=u*s-g*n,l=g*i-d*s,h=d*n-u*i,a*a+l*l+h*h==0){let D=i,et=n,$=s,j=D*D,q=et*et,tt=$*$,W;j<q?j<tt?(W=1/Math.sqrt(q+tt),a=0,l=$*W,h=-et*W):(W=1/Math.sqrt(j+q),a=et*W,l=-D*W,h=0):q<tt?(W=1/Math.sqrt(tt+j),a=-$*W,l=0,h=D*W):(W=1/Math.sqrt(j+q),a=et*W,l=-D*W,h=0)}o=n*h-s*l,r=s*a-i*h,_=i*l-n*a,m=l*g-h*u,f=h*d-a*g,p=a*u-l*d;let X,M,z;X=t._rotation00*i+t._rotation10*n+t._rotation20*s,M=t._rotation01*i+t._rotation11*n+t._rotation21*s,z=t._rotation02*i+t._rotation12*n+t._rotation22*s,this._localBasisX1X=X,this._localBasisX1Y=M,this._localBasisX1Z=z;let T,F,P;T=t._rotation00*a+t._rotation10*l+t._rotation20*h,F=t._rotation01*a+t._rotation11*l+t._rotation21*h,P=t._rotation02*a+t._rotation12*l+t._rotation22*h,this._localBasisY1X=T,this._localBasisY1Y=F,this._localBasisY1Z=P;let A,L,S;A=t._rotation00*o+t._rotation10*r+t._rotation20*_,L=t._rotation01*o+t._rotation11*r+t._rotation21*_,S=t._rotation02*o+t._rotation12*r+t._rotation22*_,this._localBasisZ1X=A,this._localBasisZ1Y=L,this._localBasisZ1Z=S;let R,E,C;R=e._rotation00*m+e._rotation10*f+e._rotation20*p,E=e._rotation01*m+e._rotation11*f+e._rotation21*p,C=e._rotation02*m+e._rotation12*f+e._rotation22*p,this._localBasisX2X=R,this._localBasisX2Y=E,this._localBasisX2Z=C;let k,V,B;k=e._rotation00*a+e._rotation10*l+e._rotation20*h,V=e._rotation01*a+e._rotation11*l+e._rotation21*h,B=e._rotation02*a+e._rotation12*l+e._rotation22*h,this._localBasisY2X=k,this._localBasisY2Y=V,this._localBasisY2Z=B;let J,I,G;J=e._rotation00*d+e._rotation10*u+e._rotation20*g,I=e._rotation01*d+e._rotation11*u+e._rotation21*g,G=e._rotation02*d+e._rotation12*u+e._rotation22*g,this._localBasisZ2X=J,this._localBasisZ2Y=I,this._localBasisZ2Z=G}buildLocalBasesFromXY1X2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let I=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;I>0&&(I=1/Math.sqrt(I)),this._localBasisX1X*=I,this._localBasisX1Y*=I,this._localBasisX1Z*=I}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){let I=this._localBasisX1X,G=this._localBasisX1Y,D=this._localBasisX1Z,et=I*I,$=G*G,j=D*D,q;et<$?et<j?(q=1/Math.sqrt($+j),this._localBasisY1X=0,this._localBasisY1Y=D*q,this._localBasisY1Z=-G*q):(q=1/Math.sqrt(et+$),this._localBasisY1X=G*q,this._localBasisY1Y=-I*q,this._localBasisY1Z=0):$<j?(q=1/Math.sqrt(j+et),this._localBasisY1X=-D*q,this._localBasisY1Y=0,this._localBasisY1Z=I*q):(q=1/Math.sqrt(et+$),this._localBasisY1X=G*q,this._localBasisY1Y=-I*q,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{let I=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;I>0&&(I=1/Math.sqrt(I)),this._localBasisZ1X*=I,this._localBasisZ1Y*=I,this._localBasisZ1Z*=I,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}let t,e,i,n,s,o,r,_,a,l,h,m,f,p=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(p<-.999999999){let I,G,D,et=this._localBasisX1X,$=this._localBasisX1Y,j=this._localBasisX1Z,q=et*et,tt=$*$,W=j*j,U;q<tt?q<W?(U=1/Math.sqrt(tt+W),I=0,G=j*U,D=-$*U):(U=1/Math.sqrt(q+tt),I=$*U,G=-et*U,D=0):tt<W?(U=1/Math.sqrt(W+q),I=-j*U,G=0,D=et*U):(U=1/Math.sqrt(q+tt),I=$*U,G=-et*U,D=0),t=I,e=G,i=D,n=0}else{let I,G,D;I=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,G=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,D=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;let et=Math.sqrt((1+p)*.5);p=.5/et,I*=p,G*=p,D*=p,t=I,e=G,i=D,n=et}let d=t,u=e,g=i,v=n,x=2*d,b=2*u,Y=2*g,w=d*x,Z=u*b,X=g*Y,M=d*b,z=u*Y,T=d*Y,F=v*x,P=v*b,A=v*Y;s=1-Z-X,o=M-A,r=T+P,_=M+A,a=1-w-X,l=z-F,h=T-P,m=z+F,f=1-w-Z;let L,S,R;L=s*this._localBasisX1X+o*this._localBasisX1Y+r*this._localBasisX1Z,S=_*this._localBasisX1X+a*this._localBasisX1Y+l*this._localBasisX1Z,R=h*this._localBasisX1X+m*this._localBasisX1Y+f*this._localBasisX1Z,this._localBasisX2X=L,this._localBasisX2Y=S,this._localBasisX2Z=R;let E,C,k;E=s*this._localBasisY1X+o*this._localBasisY1Y+r*this._localBasisY1Z,C=_*this._localBasisY1X+a*this._localBasisY1Y+l*this._localBasisY1Z,k=h*this._localBasisY1X+m*this._localBasisY1Y+f*this._localBasisY1Z,this._localBasisY2X=E,this._localBasisY2Y=C,this._localBasisY2Z=k;let V,B,J;V=s*this._localBasisZ1X+o*this._localBasisZ1Y+r*this._localBasisZ1Z,B=_*this._localBasisZ1X+a*this._localBasisZ1Y+l*this._localBasisZ1Z,J=h*this._localBasisZ1X+m*this._localBasisZ1Y+f*this._localBasisZ1Z,this._localBasisZ2X=V,this._localBasisZ2Y=B,this._localBasisZ2Z=J}setSolverInfoRowLinear(t,e,i,n,s,o,r){let _,a,l=y.common.Setting.linearSlop;if(r)_=0,a=1;else{if(s.frequency>0){l=0;let u=6.28318530717958*s.frequency,g=s.dampingRatio;g<y.common.Setting.minSpringDamperDampingRatio&&(g=y.common.Setting.minSpringDamperDampingRatio);let v=o.dt,x=2*g*u,b=u*u;s.useSymplecticEuler?(_=1/(v*x),a=b/x):(_=1/(v*(v*b+x)),a=b/(v*b+x))}else _=0,a=this.getErp(o,!1);i.motorForce>0?(t.motorSpeed=i.motorSpeed,t.motorMaxImpulse=i.motorForce*o.dt):(t.motorSpeed=0,t.motorMaxImpulse=0)}let h=i.lowerLimit,m=i.upperLimit,f,p,d;h>m?(f=0,p=0,d=0):h==m?(f=-1/0,p=1/0,d=e-h):e<h?(f=-1/0,p=0,d=e-h+l,d>0&&(d=0)):e>m?(f=0,p=1/0,d=e-m-l,d<0&&(d=0)):(f=0,p=0,d=0),t.minImpulse=f,t.maxImpulse=p,t.cfm=_*(n==0?0:1/n),t.rhs=d*a}setSolverInfoRowAngular(t,e,i,n,s,o,r){let _,a,l=y.common.Setting.angularSlop;if(r)_=0,a=1;else{if(s.frequency>0){l=0;let g=6.28318530717958*s.frequency,v=s.dampingRatio;v<y.common.Setting.minSpringDamperDampingRatio&&(v=y.common.Setting.minSpringDamperDampingRatio);let x=o.dt,b=2*v*g,Y=g*g;s.useSymplecticEuler?(_=1/(x*b),a=Y/b):(_=1/(x*(x*Y+b)),a=Y/(x*Y+b))}else _=0,a=this.getErp(o,!1);i.motorTorque>0?(t.motorSpeed=i.motorSpeed,t.motorMaxImpulse=i.motorTorque*o.dt):(t.motorSpeed=0,t.motorMaxImpulse=0)}let h=i.lowerLimit,m=i.upperLimit,f=(h+m)*.5;e-=f,e=((e+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,e+=f;let p,d,u;h>m?(p=0,d=0,u=0):h==m?(p=-1/0,d=1/0,u=e-h):e<h?(p=-1/0,d=0,u=e-h+l,u>0&&(u=0)):e>m?(p=0,d=1/0,u=e-m-l,u<0&&(u=0)):(p=0,d=0,u=0),t.minImpulse=p,t.maxImpulse=d,t.cfm=_*(n==0?0:1/n),t.rhs=u*a}getErp(t,e){return e?1:this._positionCorrectionAlgorithm==y.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?t.invDt*y.common.Setting.velocityBaumgarte:0}computeEffectiveInertiaMoment(t,e,i){let n,s,o,r,_,a,l,h,m;l=this._b1._invInertia00*t+this._b1._invInertia01*e+this._b1._invInertia02*i,h=this._b1._invInertia10*t+this._b1._invInertia11*e+this._b1._invInertia12*i,m=this._b1._invInertia20*t+this._b1._invInertia21*e+this._b1._invInertia22*i,n=l,s=h,o=m;let f,p,d;f=this._b2._invInertia00*t+this._b2._invInertia01*e+this._b2._invInertia02*i,p=this._b2._invInertia10*t+this._b2._invInertia11*e+this._b2._invInertia12*i,d=this._b2._invInertia20*t+this._b2._invInertia21*e+this._b2._invInertia22*i,r=f,_=p,a=d;let u=n*t+s*e+o*i,g=r*t+_*e+a*i;if(u>0){let v=t*this._relativeAnchor1X+e*this._relativeAnchor1Y+i*this._relativeAnchor1Z,x=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z-v*v;x>0&&(this._b1._invMass>0?u=1/(1/u+this._b1._mass*x):u=0)}if(g>0){let v=t*this._relativeAnchor2X+e*this._relativeAnchor2Y+i*this._relativeAnchor2Z,x=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z-v*v;x>0&&(this._b2._invMass>0?g=1/(1/g+this._b2._mass*x):g=0)}return u+g==0?0:1/(u+g)}computeEffectiveInertiaMoment2(t,e,i,n,s,o){let r,_,a,l,h,m,f,p,d;f=this._b1._invInertia00*t+this._b1._invInertia01*e+this._b1._invInertia02*i,p=this._b1._invInertia10*t+this._b1._invInertia11*e+this._b1._invInertia12*i,d=this._b1._invInertia20*t+this._b1._invInertia21*e+this._b1._invInertia22*i,r=f,_=p,a=d;let u,g,v;u=this._b2._invInertia00*n+this._b2._invInertia01*s+this._b2._invInertia02*o,g=this._b2._invInertia10*n+this._b2._invInertia11*s+this._b2._invInertia12*o,v=this._b2._invInertia20*n+this._b2._invInertia21*s+this._b2._invInertia22*o,l=u,h=g,m=v;let x=r*t+_*e+a*i,b=l*n+h*s+m*o;if(x>0){let Y=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,w=t*this._relativeAnchor1X+e*this._relativeAnchor1Y+i*this._relativeAnchor1Z,Z=Y*Y-w*w;Z>0&&(this._b1._invMass>0?x=1/(1/x+this._b1._mass*Z):x=0)}if(b>0){let Y=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,w=n*this._relativeAnchor2X+s*this._relativeAnchor2Y+o*this._relativeAnchor2Z,Z=Y*Y-w*w;Z>0&&(this._b2._invMass>0?b=1/(1/b+this._b2._mass*Z):b=0)}return x+b==0?0:1/(x+b)}_syncAnchors(){let t=this._b1._transform,e=this._b2._transform,i,n,s;i=t._rotation00*this._localAnchor1X+t._rotation01*this._localAnchor1Y+t._rotation02*this._localAnchor1Z,n=t._rotation10*this._localAnchor1X+t._rotation11*this._localAnchor1Y+t._rotation12*this._localAnchor1Z,s=t._rotation20*this._localAnchor1X+t._rotation21*this._localAnchor1Y+t._rotation22*this._localAnchor1Z,this._relativeAnchor1X=i,this._relativeAnchor1Y=n,this._relativeAnchor1Z=s;let o,r,_;o=e._rotation00*this._localAnchor2X+e._rotation01*this._localAnchor2Y+e._rotation02*this._localAnchor2Z,r=e._rotation10*this._localAnchor2X+e._rotation11*this._localAnchor2Y+e._rotation12*this._localAnchor2Z,_=e._rotation20*this._localAnchor2X+e._rotation21*this._localAnchor2Y+e._rotation22*this._localAnchor2Z,this._relativeAnchor2X=o,this._relativeAnchor2Y=r,this._relativeAnchor2Z=_,this._anchor1X=this._relativeAnchor1X+t._positionX,this._anchor1Y=this._relativeAnchor1Y+t._positionY,this._anchor1Z=this._relativeAnchor1Z+t._positionZ,this._anchor2X=this._relativeAnchor2X+e._positionX,this._anchor2Y=this._relativeAnchor2Y+e._positionY,this._anchor2Z=this._relativeAnchor2Z+e._positionZ;let a,l,h;a=t._rotation00*this._localBasisX1X+t._rotation01*this._localBasisX1Y+t._rotation02*this._localBasisX1Z,l=t._rotation10*this._localBasisX1X+t._rotation11*this._localBasisX1Y+t._rotation12*this._localBasisX1Z,h=t._rotation20*this._localBasisX1X+t._rotation21*this._localBasisX1Y+t._rotation22*this._localBasisX1Z,this._basisX1X=a,this._basisX1Y=l,this._basisX1Z=h;let m,f,p;m=t._rotation00*this._localBasisY1X+t._rotation01*this._localBasisY1Y+t._rotation02*this._localBasisY1Z,f=t._rotation10*this._localBasisY1X+t._rotation11*this._localBasisY1Y+t._rotation12*this._localBasisY1Z,p=t._rotation20*this._localBasisY1X+t._rotation21*this._localBasisY1Y+t._rotation22*this._localBasisY1Z,this._basisY1X=m,this._basisY1Y=f,this._basisY1Z=p;let d,u,g;d=t._rotation00*this._localBasisZ1X+t._rotation01*this._localBasisZ1Y+t._rotation02*this._localBasisZ1Z,u=t._rotation10*this._localBasisZ1X+t._rotation11*this._localBasisZ1Y+t._rotation12*this._localBasisZ1Z,g=t._rotation20*this._localBasisZ1X+t._rotation21*this._localBasisZ1Y+t._rotation22*this._localBasisZ1Z,this._basisZ1X=d,this._basisZ1Y=u,this._basisZ1Z=g;let v,x,b;v=e._rotation00*this._localBasisX2X+e._rotation01*this._localBasisX2Y+e._rotation02*this._localBasisX2Z,x=e._rotation10*this._localBasisX2X+e._rotation11*this._localBasisX2Y+e._rotation12*this._localBasisX2Z,b=e._rotation20*this._localBasisX2X+e._rotation21*this._localBasisX2Y+e._rotation22*this._localBasisX2Z,this._basisX2X=v,this._basisX2Y=x,this._basisX2Z=b;let Y,w,Z;Y=e._rotation00*this._localBasisY2X+e._rotation01*this._localBasisY2Y+e._rotation02*this._localBasisY2Z,w=e._rotation10*this._localBasisY2X+e._rotation11*this._localBasisY2Y+e._rotation12*this._localBasisY2Z,Z=e._rotation20*this._localBasisY2X+e._rotation21*this._localBasisY2Y+e._rotation22*this._localBasisY2Z,this._basisY2X=Y,this._basisY2Y=w,this._basisY2Z=Z;let X,M,z;X=e._rotation00*this._localBasisZ2X+e._rotation01*this._localBasisZ2Y+e._rotation02*this._localBasisZ2Z,M=e._rotation10*this._localBasisZ2X+e._rotation11*this._localBasisZ2Y+e._rotation12*this._localBasisZ2Z,z=e._rotation20*this._localBasisZ2X+e._rotation21*this._localBasisZ2Y+e._rotation22*this._localBasisZ2Z,this._basisZ2X=X,this._basisZ2Y=M,this._basisZ2Z=z}_getVelocitySolverInfo(t,e){e.b1=this._b1,e.b2=this._b2,e.numRows=0}_getPositionSolverInfo(t){t.b1=this._b1,t.b2=this._b2,t.numRows=0}_checkDestruction(){let t=this._appliedTorqueX*this._appliedTorqueX+this._appliedTorqueY*this._appliedTorqueY+this._appliedTorqueZ*this._appliedTorqueZ;if(this._breakForce>0&&this._appliedForceX*this._appliedForceX+this._appliedForceY*this._appliedForceY+this._appliedForceZ*this._appliedForceZ>this._breakForce*this._breakForce){this._world.removeJoint(this);return}if(this._breakTorque>0&&t>this._breakTorque*this._breakTorque){this._world.removeJoint(this);return}}getRigidBody1(){return this._b1}getRigidBody2(){return this._b2}getType(){return this._type}getAnchor1(){let t=new y.common.Vec3;return t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z,t}getAnchor2(){let t=new y.common.Vec3;return t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z,t}getAnchor1To(t){t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z}getAnchor2To(t){t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z}getLocalAnchor1(){let t=new y.common.Vec3;return t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z,t}getLocalAnchor2(){let t=new y.common.Vec3;return t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z,t}getLocalAnchor1To(t){t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z}getLocalAnchor2To(t){t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z}getBasis1(){let t=new y.common.Mat3,e,i,n,s,o,r,_,a,l;return e=this._basisX1X,i=this._basisY1X,n=this._basisZ1X,s=this._basisX1Y,o=this._basisY1Y,r=this._basisZ1Y,_=this._basisX1Z,a=this._basisY1Z,l=this._basisZ1Z,t.e00=e,t.e01=i,t.e02=n,t.e10=s,t.e11=o,t.e12=r,t.e20=_,t.e21=a,t.e22=l,t}getBasis2(){let t=new y.common.Mat3,e,i,n,s,o,r,_,a,l;return e=this._basisX2X,i=this._basisY2X,n=this._basisZ2X,s=this._basisX2Y,o=this._basisY2Y,r=this._basisZ2Y,_=this._basisX2Z,a=this._basisY2Z,l=this._basisZ2Z,t.e00=e,t.e01=i,t.e02=n,t.e10=s,t.e11=o,t.e12=r,t.e20=_,t.e21=a,t.e22=l,t}getBasis1To(t){let e,i,n,s,o,r,_,a,l;e=this._basisX1X,i=this._basisY1X,n=this._basisZ1X,s=this._basisX1Y,o=this._basisY1Y,r=this._basisZ1Y,_=this._basisX1Z,a=this._basisY1Z,l=this._basisZ1Z,t.e00=e,t.e01=i,t.e02=n,t.e10=s,t.e11=o,t.e12=r,t.e20=_,t.e21=a,t.e22=l}getBasis2To(t){let e,i,n,s,o,r,_,a,l;e=this._basisX2X,i=this._basisY2X,n=this._basisZ2X,s=this._basisX2Y,o=this._basisY2Y,r=this._basisZ2Y,_=this._basisX2Z,a=this._basisY2Z,l=this._basisZ2Z,t.e00=e,t.e01=i,t.e02=n,t.e10=s,t.e11=o,t.e12=r,t.e20=_,t.e21=a,t.e22=l}getAllowCollision(){return this._allowCollision}setAllowCollision(t){this._allowCollision=t}getBreakForce(){return this._breakForce}setBreakForce(t){this._breakForce=t}getBreakTorque(){return this._breakTorque}setBreakTorque(t){this._breakTorque=t}getPositionCorrectionAlgorithm(){return this._positionCorrectionAlgorithm}setPositionCorrectionAlgorithm(t){switch(t){case 0:case 1:case 2:break;default:throw new Error("invalid position correction algorithm id: "+t)}this._positionCorrectionAlgorithm=t}getAppliedForce(){let t=new y.common.Vec3;return t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ,t}getAppliedForceTo(t){t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ}getAppliedTorque(){let t=new y.common.Vec3;return t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ,t}getAppliedTorqueTo(t){t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ}getPrev(){return this._prev}getNext(){return this._next}};y.dynamics.constraint.joint.CylindricalJoint=class extends y.dynamics.constraint.joint.Joint{constructor(t){super(t,2);let e=t.localAxis1;this._localBasisX1X=e.x,this._localBasisX1Y=e.y,this._localBasisX1Z=e.z;let i=t.localAxis2;this._localBasisX2X=i.x,this._localBasisX2Y=i.y,this._localBasisX2Z=i.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this._basis=new y.dynamics.constraint.joint.BasisTracker(this),this._translSd=t.translationalSpringDamper.clone(),this._translLm=t.translationalLimitMotor.clone(),this._rotSd=t.rotationalSpringDamper.clone(),this._rotLm=t.rotationalLimitMotor.clone()}getInfo(t,e,i){let n=this.getErp(e,i),s=this.linearErrorY*n,o=this.linearErrorZ*n,r=this.angularErrorY*n,_=this.angularErrorZ*n,a,l=1/(this._b1._invMass+this._b2._invMass),h=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ);if(this._translSd.frequency<=0||!i){let X=this._impulses[0],M=t.rows[t.numRows++],z=M.jacobian;z.lin1X=0,z.lin1Y=0,z.lin1Z=0,z.lin2X=0,z.lin2Y=0,z.lin2Z=0,z.ang1X=0,z.ang1Y=0,z.ang1Z=0,z.ang2X=0,z.ang2Y=0,z.ang2Z=0,M.rhs=0,M.cfm=0,M.minImpulse=0,M.maxImpulse=0,M.motorSpeed=0,M.motorMaxImpulse=0,M.impulse=null,M.impulse=X,this.setSolverInfoRowLinear(M,this.translation,this._translLm,l,this._translSd,e,i),a=M.jacobian,a.lin1X=this._basis.xX,a.lin1Y=this._basis.xY,a.lin1Z=this._basis.xZ,a.lin2X=this._basis.xX,a.lin2Y=this._basis.xY,a.lin2Z=this._basis.xZ,a.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,a.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,a.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,a.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,a.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,a.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}let m=this._impulses[1],f=t.rows[t.numRows++],p=f.jacobian;p.lin1X=0,p.lin1Y=0,p.lin1Z=0,p.lin2X=0,p.lin2Y=0,p.lin2Z=0,p.ang1X=0,p.ang1Y=0,p.ang1Z=0,p.ang2X=0,p.ang2Y=0,p.ang2Z=0,f.rhs=0,f.cfm=0,f.minImpulse=0,f.maxImpulse=0,f.motorSpeed=0,f.motorMaxImpulse=0,f.impulse=null,f.impulse=m,f.rhs=s,f.cfm=0,f.minImpulse=-1/0,f.maxImpulse=1/0,a=f.jacobian,a.lin1X=this._basis.yX,a.lin1Y=this._basis.yY,a.lin1Z=this._basis.yZ,a.lin2X=this._basis.yX,a.lin2Y=this._basis.yY,a.lin2Z=this._basis.yZ,a.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,a.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,a.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,a.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,a.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,a.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;let d=this._impulses[2],u=t.rows[t.numRows++],g=u.jacobian;if(g.lin1X=0,g.lin1Y=0,g.lin1Z=0,g.lin2X=0,g.lin2Y=0,g.lin2Z=0,g.ang1X=0,g.ang1Y=0,g.ang1Z=0,g.ang2X=0,g.ang2Y=0,g.ang2Z=0,u.rhs=0,u.cfm=0,u.minImpulse=0,u.maxImpulse=0,u.motorSpeed=0,u.motorMaxImpulse=0,u.impulse=null,u.impulse=d,u.rhs=o,u.cfm=0,u.minImpulse=-1/0,u.maxImpulse=1/0,a=u.jacobian,a.lin1X=this._basis.zX,a.lin1Y=this._basis.zY,a.lin1Z=this._basis.zZ,a.lin2X=this._basis.zX,a.lin2Y=this._basis.zY,a.lin2Z=this._basis.zZ,a.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,a.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,a.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,a.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,a.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,a.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX,this._rotSd.frequency<=0||!i){let X=this._impulses[3],M=t.rows[t.numRows++],z=M.jacobian;z.lin1X=0,z.lin1Y=0,z.lin1Z=0,z.lin2X=0,z.lin2Y=0,z.lin2Z=0,z.ang1X=0,z.ang1Y=0,z.ang1Z=0,z.ang2X=0,z.ang2Y=0,z.ang2Z=0,M.rhs=0,M.cfm=0,M.minImpulse=0,M.maxImpulse=0,M.motorSpeed=0,M.motorMaxImpulse=0,M.impulse=null,M.impulse=X,this.setSolverInfoRowAngular(M,this.angle,this._rotLm,h,this._rotSd,e,i),a=M.jacobian,a.ang1X=this._basis.xX,a.ang1Y=this._basis.xY,a.ang1Z=this._basis.xZ,a.ang2X=this._basis.xX,a.ang2Y=this._basis.xY,a.ang2Z=this._basis.xZ}let v=this._impulses[4],x=t.rows[t.numRows++],b=x.jacobian;b.lin1X=0,b.lin1Y=0,b.lin1Z=0,b.lin2X=0,b.lin2Y=0,b.lin2Z=0,b.ang1X=0,b.ang1Y=0,b.ang1Z=0,b.ang2X=0,b.ang2Y=0,b.ang2Z=0,x.rhs=0,x.cfm=0,x.minImpulse=0,x.maxImpulse=0,x.motorSpeed=0,x.motorMaxImpulse=0,x.impulse=null,x.impulse=v,x.rhs=r,x.cfm=0,x.minImpulse=-1/0,x.maxImpulse=1/0,a=x.jacobian,a.ang1X=this._basis.yX,a.ang1Y=this._basis.yY,a.ang1Z=this._basis.yZ,a.ang2X=this._basis.yX,a.ang2Y=this._basis.yY,a.ang2Z=this._basis.yZ;let Y=this._impulses[5],w=t.rows[t.numRows++],Z=w.jacobian;Z.lin1X=0,Z.lin1Y=0,Z.lin1Z=0,Z.lin2X=0,Z.lin2Y=0,Z.lin2Z=0,Z.ang1X=0,Z.ang1Y=0,Z.ang1Z=0,Z.ang2X=0,Z.ang2Y=0,Z.ang2Z=0,w.rhs=0,w.cfm=0,w.minImpulse=0,w.maxImpulse=0,w.motorSpeed=0,w.motorMaxImpulse=0,w.impulse=null,w.impulse=Y,w.rhs=_,w.cfm=0,w.minImpulse=-1/0,w.maxImpulse=1/0,a=w.jacobian,a.ang1X=this._basis.zX,a.ang1Y=this._basis.zY,a.ang1Z=this._basis.zZ,a.ang2X=this._basis.zX,a.ang2Y=this._basis.zY,a.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();let t=this._basis,e=t.joint._b1._invMass,i=t.joint._b2._invMass,n,s,o,r,_,a,l,h,m,f,p,d,u,g,v,x,b,Y,w,Z,X,M,z,T,F,P,A,L,S,R,E,C,k,V,B,J,I=t.joint._basisX1X*t.joint._basisX2X+t.joint._basisX1Y*t.joint._basisX2Y+t.joint._basisX1Z*t.joint._basisX2Z;if(I<-.999999999){let Bt,re,Ce,be=t.joint._basisX1X,Tt=t.joint._basisX1Y,Lt=t.joint._basisX1Z,Zt=be*be,me=Tt*Tt,Me=Lt*Lt,fe;Zt<me?Zt<Me?(fe=1/Math.sqrt(me+Me),Bt=0,re=Lt*fe,Ce=-Tt*fe):(fe=1/Math.sqrt(Zt+me),Bt=Tt*fe,re=-be*fe,Ce=0):me<Me?(fe=1/Math.sqrt(Me+Zt),Bt=-Lt*fe,re=0,Ce=be*fe):(fe=1/Math.sqrt(Zt+me),Bt=Tt*fe,re=-be*fe,Ce=0),n=Bt,s=re,o=Ce,r=0}else{let Bt,re,Ce;Bt=t.joint._basisX1Y*t.joint._basisX2Z-t.joint._basisX1Z*t.joint._basisX2Y,re=t.joint._basisX1Z*t.joint._basisX2X-t.joint._basisX1X*t.joint._basisX2Z,Ce=t.joint._basisX1X*t.joint._basisX2Y-t.joint._basisX1Y*t.joint._basisX2X;let be=Math.sqrt((1+I)*.5);I=.5/be,Bt*=I,re*=I,Ce*=I,n=Bt,s=re,o=Ce,r=be}_=0,a=0,l=0,h=1;let G,D,et,$,j,q,tt,W;G=_,D=a,et=l,$=h,j=n,q=s,tt=o,W=r;let U=G*j+D*q+et*tt+$*W;if(U<0&&(U=-U,j=-j,q=-q,tt=-tt,W=-W),U>.999999){let Bt,re,Ce,be;Bt=j-G,re=q-D,Ce=tt-et,be=W-$,j=G+Bt*(e/(e+i)),q=D+re*(e/(e+i)),tt=et+Ce*(e/(e+i)),W=$+be*(e/(e+i));let Tt=j*j+q*q+tt*tt+W*W;Tt>1e-32&&(Tt=1/Math.sqrt(Tt)),m=j*Tt,f=q*Tt,p=tt*Tt,d=W*Tt}else{let Bt=e/(e+i)*Math.acos(U);j+=G*-U,q+=D*-U,tt+=et*-U,W+=$*-U;let re=j*j+q*q+tt*tt+W*W;re>1e-32&&(re=1/Math.sqrt(re)),j*=re,q*=re,tt*=re,W*=re;let Ce=Math.sin(Bt),be=Math.cos(Bt);G*=be,D*=be,et*=be,$*=be,m=G+j*Ce,f=D+q*Ce,p=et+tt*Ce,d=$+W*Ce}let it=m,Q=f,at=p,ht=d,_t=2*it,mt=2*Q,ft=2*at,ut=it*_t,H=Q*mt,O=at*ft,ot=it*mt,pt=Q*ft,vt=it*ft,xt=ht*_t,Mt=ht*mt,ct=ht*ft;u=1-H-O,g=ot-ct,v=vt+Mt,x=ot+ct,b=1-ut-O,Y=pt-xt,w=vt-Mt,Z=pt+xt,X=1-ut-H;let St,It,dt;St=u*t.joint._basisX1X+g*t.joint._basisX1Y+v*t.joint._basisX1Z,It=x*t.joint._basisX1X+b*t.joint._basisX1Y+Y*t.joint._basisX1Z,dt=w*t.joint._basisX1X+Z*t.joint._basisX1Y+X*t.joint._basisX1Z,M=St,z=It,T=dt,E=t.xX,C=t.xY,k=t.xZ,V=t.yX,B=t.yY,J=t.yZ;let K=E*M+C*z+k*T;if(K<-.999999999){let Bt,re,Ce,be=E,Tt=C,Lt=k,Zt=be*be,me=Tt*Tt,Me=Lt*Lt,fe;Zt<me?Zt<Me?(fe=1/Math.sqrt(me+Me),Bt=0,re=Lt*fe,Ce=-Tt*fe):(fe=1/Math.sqrt(Zt+me),Bt=Tt*fe,re=-be*fe,Ce=0):me<Me?(fe=1/Math.sqrt(Me+Zt),Bt=-Lt*fe,re=0,Ce=be*fe):(fe=1/Math.sqrt(Zt+me),Bt=Tt*fe,re=-be*fe,Ce=0),m=Bt,f=re,p=Ce,d=0}else{let Bt,re,Ce;Bt=C*T-k*z,re=k*M-E*T,Ce=E*z-C*M;let be=Math.sqrt((1+K)*.5);K=.5/be,Bt*=K,re*=K,Ce*=K,m=Bt,f=re,p=Ce,d=be}let lt=m,rt=f,Vt=p,At=d,Yt=2*lt,Xt=2*rt,Nt=2*Vt,ie=lt*Yt,ee=rt*Xt,Ze=Vt*Nt,ze=lt*Xt,pe=rt*Nt,$t=lt*Nt,Ht=At*Yt,ue=At*Xt,Ie=At*Nt;u=1-ee-Ze,g=ze-Ie,v=$t+ue,x=ze+Ie,b=1-ie-Ze,Y=pe-Ht,w=$t-ue,Z=pe+Ht,X=1-ie-ee;let qe,Ee,Ut;if(qe=u*V+g*B+v*J,Ee=x*V+b*B+Y*J,Ut=w*V+Z*B+X*J,F=qe,P=Ee,A=Ut,L=z*A-T*P,S=T*F-M*A,R=M*P-z*F,L*L+S*S+R*R>1e-6){let Bt=L*L+S*S+R*R;Bt>0&&(Bt=1/Math.sqrt(Bt)),L*=Bt,S*=Bt,R*=Bt}else{let Bt=M,re=z,Ce=T,be=Bt*Bt,Tt=re*re,Lt=Ce*Ce,Zt;be<Tt?be<Lt?(Zt=1/Math.sqrt(Tt+Lt),L=0,S=Ce*Zt,R=-re*Zt):(Zt=1/Math.sqrt(be+Tt),L=re*Zt,S=-Bt*Zt,R=0):Tt<Lt?(Zt=1/Math.sqrt(Lt+be),L=-Ce*Zt,S=0,R=Bt*Zt):(Zt=1/Math.sqrt(be+Tt),L=re*Zt,S=-Bt*Zt,R=0)}F=S*T-R*z,P=R*M-L*T,A=L*z-S*M,t.xX=M,t.xY=z,t.xZ=T,t.yX=F,t.yY=P,t.yZ=A,t.zX=L,t.zY=S,t.zZ=R;let nt,gt,yt;nt=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,gt=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,yt=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;let bt=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,st=bt<=-1?3.14159265358979:bt>=1?0:Math.acos(bt),Pt=nt*nt+gt*gt+yt*yt;Pt>0&&(Pt=1/Math.sqrt(Pt)),nt*=Pt,gt*=Pt,yt*=Pt,nt*=st,gt*=st,yt*=st,this.angularErrorY=nt*this._basis.yX+gt*this._basis.yY+yt*this._basis.yZ,this.angularErrorZ=nt*this._basis.zX+gt*this._basis.zY+yt*this._basis.zZ;let Dt,N,kt;Dt=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,N=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,kt=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,bt=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=bt<=-1?3.14159265358979:bt>=1?0:Math.acos(bt),Dt*this._basis.xX+N*this._basis.xY+kt*this._basis.xZ<0&&(this.angle=-this.angle);let Rt,Ot,Wt;Rt=this._anchor2X-this._anchor1X,Ot=this._anchor2Y-this._anchor1Y,Wt=this._anchor2Z-this._anchor1Z,this.translation=Rt*this._basis.xX+Ot*this._basis.xY+Wt*this._basis.xZ,this.linearErrorY=Rt*this._basis.yX+Ot*this._basis.yY+Wt*this._basis.yZ,this.linearErrorZ=Rt*this._basis.zX+Ot*this._basis.zY+Wt*this._basis.zZ}_getVelocitySolverInfo(t,e){super._getVelocitySolverInfo(t,e),this.getInfo(e,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new y.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new y.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new y.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new y.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getTranslationalSpringDamper(){return this._translSd}getRotationalSpringDamper(){return this._rotSd}getTranslationalLimitMotor(){return this._translLm}getRotationalLimitMotor(){return this._rotLm}getAngle(){return this.angle}getTranslation(){return this.translation}};y.dynamics.constraint.joint.JointConfig=class{constructor(){this.rigidBody1=null,this.rigidBody2=null,this.localAnchor1=new y.common.Vec3,this.localAnchor2=new y.common.Vec3,this.allowCollision=!1,this.solverType=y.common.Setting.defaultJointConstraintSolverType,this.positionCorrectionAlgorithm=y.common.Setting.defaultJointPositionCorrectionAlgorithm,this.breakForce=0,this.breakTorque=0}_init(t,e,i){this.rigidBody1=t,this.rigidBody2=e;let n=this.rigidBody1,s=this.localAnchor1,o,r,_;o=i.x,r=i.y,_=i.z,o-=n._transform._positionX,r-=n._transform._positionY,_-=n._transform._positionZ;let a,l,h;a=n._transform._rotation00*o+n._transform._rotation10*r+n._transform._rotation20*_,l=n._transform._rotation01*o+n._transform._rotation11*r+n._transform._rotation21*_,h=n._transform._rotation02*o+n._transform._rotation12*r+n._transform._rotation22*_,o=a,r=l,_=h,s.x=o,s.y=r,s.z=_;let m=this.rigidBody2,f=this.localAnchor2,p,d,u;p=i.x,d=i.y,u=i.z,p-=m._transform._positionX,d-=m._transform._positionY,u-=m._transform._positionZ;let g,v,x;g=m._transform._rotation00*p+m._transform._rotation10*d+m._transform._rotation20*u,v=m._transform._rotation01*p+m._transform._rotation11*d+m._transform._rotation21*u,x=m._transform._rotation02*p+m._transform._rotation12*d+m._transform._rotation22*u,p=g,d=v,u=x,f.x=p,f.y=d,f.z=u}};y.dynamics.constraint.joint.CylindricalJointConfig=class extends y.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new y.common.Vec3(1,0,0),this.localAxis2=new y.common.Vec3(1,0,0),this.translationalLimitMotor=new y.dynamics.constraint.joint.TranslationalLimitMotor,this.translationalSpringDamper=new y.dynamics.constraint.joint.SpringDamper,this.rotationalLimitMotor=new y.dynamics.constraint.joint.RotationalLimitMotor,this.rotationalSpringDamper=new y.dynamics.constraint.joint.SpringDamper}init(t,e,i,n){this._init(t,e,i);let s=this.localAxis1,o,r,_;o=n.x,r=n.y,_=n.z;let a,l,h;a=t._transform._rotation00*o+t._transform._rotation10*r+t._transform._rotation20*_,l=t._transform._rotation01*o+t._transform._rotation11*r+t._transform._rotation21*_,h=t._transform._rotation02*o+t._transform._rotation12*r+t._transform._rotation22*_,o=a,r=l,_=h,s.x=o,s.y=r,s.z=_;let m=this.localAxis2,f,p,d;f=n.x,p=n.y,d=n.z;let u,g,v;return u=e._transform._rotation00*f+e._transform._rotation10*p+e._transform._rotation20*d,g=e._transform._rotation01*f+e._transform._rotation11*p+e._transform._rotation21*d,v=e._transform._rotation02*f+e._transform._rotation12*p+e._transform._rotation22*d,f=u,p=g,d=v,m.x=f,m.y=p,m.z=d,this}};y.dynamics.constraint.joint.GenericJoint=class extends y.dynamics.constraint.joint.Joint{constructor(t){super(t,y.dynamics.constraint.joint.JointType.GENERIC);let e,i=t.localBasis1;if(i.e00*(i.e11*i.e22-i.e12*i.e21)-i.e01*(i.e10*i.e22-i.e12*i.e20)+i.e02*(i.e10*i.e21-i.e11*i.e20)<0)e=!0;else{let X=t.localBasis2;e=X.e00*(X.e11*X.e22-X.e12*X.e21)-X.e01*(X.e10*X.e22-X.e12*X.e20)+X.e02*(X.e10*X.e21-X.e11*X.e20)<0}e&&console.log("src/oimo/dynamics/constraint/joint/GenericJoint.hx:50:","[warning] joint basis must be right handed");let n,s,o,r,_,a,l,h,m,f,p,d,u,g,v,x,b,Y,w=t.localBasis1;n=w.e00,s=w.e01,o=w.e02,r=w.e10,_=w.e11,a=w.e12,l=w.e20,h=w.e21,m=w.e22;let Z=t.localBasis2;f=Z.e00,p=Z.e01,d=Z.e02,u=Z.e10,g=Z.e11,v=Z.e12,x=Z.e20,b=Z.e21,Y=Z.e22,this._localBasisX1X=n,this._localBasisX1Y=r,this._localBasisX1Z=l,this._localBasisY1X=s,this._localBasisY1Y=_,this._localBasisY1Z=h,this._localBasisZ1X=o,this._localBasisZ1Y=a,this._localBasisZ1Z=m,this._localBasisX2X=f,this._localBasisX2Y=u,this._localBasisX2Z=x,this._localBasisY2X=p,this._localBasisY2Y=g,this._localBasisY2Z=b,this._localBasisZ2X=d,this._localBasisZ2Y=v,this._localBasisZ2Z=Y,this._angleX=0,this._angleY=0,this._angleZ=0,this.translationX=0,this.translationY=0,this.translationZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1,this._translLms=new Array(3),this._translSds=new Array(3),this._rotLms=new Array(3),this._rotSds=new Array(3),this._translLms[0]=t.translationalLimitMotors[0].clone(),this._translLms[1]=t.translationalLimitMotors[1].clone(),this._translLms[2]=t.translationalLimitMotors[2].clone(),this._translSds[0]=t.translationalSpringDampers[0].clone(),this._translSds[1]=t.translationalSpringDampers[1].clone(),this._translSds[2]=t.translationalSpringDampers[2].clone(),this._rotLms[0]=t.rotationalLimitMotors[0].clone(),this._rotLms[1]=t.rotationalLimitMotors[1].clone(),this._rotLms[2]=t.rotationalLimitMotors[2].clone(),this._rotSds[0]=t.rotationalSpringDampers[0].clone(),this._rotSds[1]=t.rotationalSpringDampers[1].clone(),this._rotSds[2]=t.rotationalSpringDampers[2].clone()}getInfo(t,e,i){let n,s=1/(this._b1._invMass+this._b2._invMass),o=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),r=this.computeEffectiveInertiaMoment(this._axisYX,this._axisYY,this._axisYZ),_=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ);if(this._translSds[0].frequency<=0||!i){let a=this._impulses[0],l=t.rows[t.numRows++],h=l.jacobian;h.lin1X=0,h.lin1Y=0,h.lin1Z=0,h.lin2X=0,h.lin2Y=0,h.lin2Z=0,h.ang1X=0,h.ang1Y=0,h.ang1Z=0,h.ang2X=0,h.ang2Y=0,h.ang2Z=0,l.rhs=0,l.cfm=0,l.minImpulse=0,l.maxImpulse=0,l.motorSpeed=0,l.motorMaxImpulse=0,l.impulse=null,l.impulse=a,this.setSolverInfoRowLinear(l,this.translationX,this._translLms[0],s,this._translSds[0],e,i),n=l.jacobian,n.lin1X=this._basisX1X,n.lin1Y=this._basisX1Y,n.lin1Z=this._basisX1Z,n.lin2X=this._basisX1X,n.lin2Y=this._basisX1Y,n.lin2Z=this._basisX1Z,n.ang1X=this._relativeAnchor1Y*this._basisX1Z-this._relativeAnchor1Z*this._basisX1Y,n.ang1Y=this._relativeAnchor1Z*this._basisX1X-this._relativeAnchor1X*this._basisX1Z,n.ang1Z=this._relativeAnchor1X*this._basisX1Y-this._relativeAnchor1Y*this._basisX1X,n.ang2X=this._relativeAnchor2Y*this._basisX1Z-this._relativeAnchor2Z*this._basisX1Y,n.ang2Y=this._relativeAnchor2Z*this._basisX1X-this._relativeAnchor2X*this._basisX1Z,n.ang2Z=this._relativeAnchor2X*this._basisX1Y-this._relativeAnchor2Y*this._basisX1X}if(this._translSds[1].frequency<=0||!i){let a=this._impulses[1],l=t.rows[t.numRows++],h=l.jacobian;h.lin1X=0,h.lin1Y=0,h.lin1Z=0,h.lin2X=0,h.lin2Y=0,h.lin2Z=0,h.ang1X=0,h.ang1Y=0,h.ang1Z=0,h.ang2X=0,h.ang2Y=0,h.ang2Z=0,l.rhs=0,l.cfm=0,l.minImpulse=0,l.maxImpulse=0,l.motorSpeed=0,l.motorMaxImpulse=0,l.impulse=null,l.impulse=a,this.setSolverInfoRowLinear(l,this.translationY,this._translLms[1],s,this._translSds[1],e,i),n=l.jacobian,n.lin1X=this._basisY1X,n.lin1Y=this._basisY1Y,n.lin1Z=this._basisY1Z,n.lin2X=this._basisY1X,n.lin2Y=this._basisY1Y,n.lin2Z=this._basisY1Z,n.ang1X=this._relativeAnchor1Y*this._basisY1Z-this._relativeAnchor1Z*this._basisY1Y,n.ang1Y=this._relativeAnchor1Z*this._basisY1X-this._relativeAnchor1X*this._basisY1Z,n.ang1Z=this._relativeAnchor1X*this._basisY1Y-this._relativeAnchor1Y*this._basisY1X,n.ang2X=this._relativeAnchor2Y*this._basisY1Z-this._relativeAnchor2Z*this._basisY1Y,n.ang2Y=this._relativeAnchor2Z*this._basisY1X-this._relativeAnchor2X*this._basisY1Z,n.ang2Z=this._relativeAnchor2X*this._basisY1Y-this._relativeAnchor2Y*this._basisY1X}if(this._translSds[2].frequency<=0||!i){let a=this._impulses[2],l=t.rows[t.numRows++],h=l.jacobian;h.lin1X=0,h.lin1Y=0,h.lin1Z=0,h.lin2X=0,h.lin2Y=0,h.lin2Z=0,h.ang1X=0,h.ang1Y=0,h.ang1Z=0,h.ang2X=0,h.ang2Y=0,h.ang2Z=0,l.rhs=0,l.cfm=0,l.minImpulse=0,l.maxImpulse=0,l.motorSpeed=0,l.motorMaxImpulse=0,l.impulse=null,l.impulse=a,this.setSolverInfoRowLinear(l,this.translationZ,this._translLms[2],s,this._translSds[2],e,i),n=l.jacobian,n.lin1X=this._basisZ1X,n.lin1Y=this._basisZ1Y,n.lin1Z=this._basisZ1Z,n.lin2X=this._basisZ1X,n.lin2Y=this._basisZ1Y,n.lin2Z=this._basisZ1Z,n.ang1X=this._relativeAnchor1Y*this._basisZ1Z-this._relativeAnchor1Z*this._basisZ1Y,n.ang1Y=this._relativeAnchor1Z*this._basisZ1X-this._relativeAnchor1X*this._basisZ1Z,n.ang1Z=this._relativeAnchor1X*this._basisZ1Y-this._relativeAnchor1Y*this._basisZ1X,n.ang2X=this._relativeAnchor2Y*this._basisZ1Z-this._relativeAnchor2Z*this._basisZ1Y,n.ang2Y=this._relativeAnchor2Z*this._basisZ1X-this._relativeAnchor2X*this._basisZ1Z,n.ang2Z=this._relativeAnchor2X*this._basisZ1Y-this._relativeAnchor2Y*this._basisZ1X}if(!this.xSingular&&(this._rotSds[0].frequency<=0||!i)){let a=this._impulses[3],l=t.rows[t.numRows++],h=l.jacobian;h.lin1X=0,h.lin1Y=0,h.lin1Z=0,h.lin2X=0,h.lin2Y=0,h.lin2Z=0,h.ang1X=0,h.ang1Y=0,h.ang1Z=0,h.ang2X=0,h.ang2Y=0,h.ang2Z=0,l.rhs=0,l.cfm=0,l.minImpulse=0,l.maxImpulse=0,l.motorSpeed=0,l.motorMaxImpulse=0,l.impulse=null,l.impulse=a,this.setSolverInfoRowAngular(l,this._angleX,this._rotLms[0],o,this._rotSds[0],e,i),n=l.jacobian,n.ang1X=this._axisXX,n.ang1Y=this._axisXY,n.ang1Z=this._axisXZ,n.ang2X=this._axisXX,n.ang2Y=this._axisXY,n.ang2Z=this._axisXZ}if(!this.ySingular&&(this._rotSds[1].frequency<=0||!i)){let a=this._impulses[4],l=t.rows[t.numRows++],h=l.jacobian;h.lin1X=0,h.lin1Y=0,h.lin1Z=0,h.lin2X=0,h.lin2Y=0,h.lin2Z=0,h.ang1X=0,h.ang1Y=0,h.ang1Z=0,h.ang2X=0,h.ang2Y=0,h.ang2Z=0,l.rhs=0,l.cfm=0,l.minImpulse=0,l.maxImpulse=0,l.motorSpeed=0,l.motorMaxImpulse=0,l.impulse=null,l.impulse=a,this.setSolverInfoRowAngular(l,this._angleY,this._rotLms[1],r,this._rotSds[1],e,i),n=l.jacobian,n.ang1X=this._axisYX,n.ang1Y=this._axisYY,n.ang1Z=this._axisYZ,n.ang2X=this._axisYX,n.ang2Y=this._axisYY,n.ang2Z=this._axisYZ}if(!this.zSingular&&(this._rotSds[2].frequency<=0||!i)){let a=this._impulses[5],l=t.rows[t.numRows++],h=l.jacobian;h.lin1X=0,h.lin1Y=0,h.lin1Z=0,h.lin2X=0,h.lin2Y=0,h.lin2Z=0,h.ang1X=0,h.ang1Y=0,h.ang1Z=0,h.ang2X=0,h.ang2Y=0,h.ang2Z=0,l.rhs=0,l.cfm=0,l.minImpulse=0,l.maxImpulse=0,l.motorSpeed=0,l.motorMaxImpulse=0,l.impulse=null,l.impulse=a,this.setSolverInfoRowAngular(l,this._angleZ,this._rotLms[2],_,this._rotSds[2],e,i),n=l.jacobian,n.ang1X=this._axisZX,n.ang1Y=this._axisZY,n.ang1Z=this._axisZZ,n.ang2X=this._axisZX,n.ang2Y=this._axisZY,n.ang2Z=this._axisZZ}}_syncAnchors(){super._syncAnchors();let t,e,i,n,s,o,r,_,a;t=this._basisX1X,e=this._basisX1Y,i=this._basisX1Z,r=this._basisZ2X,_=this._basisZ2Y,a=this._basisZ2Z,n=_*i-a*e,s=a*t-r*i,o=r*e-_*t,this._axisXX=s*a-o*_,this._axisXY=o*r-n*a,this._axisXZ=n*_-s*r,this._axisYX=n,this._axisYY=s,this._axisYZ=o,this._axisZX=e*o-i*s,this._axisZY=i*n-t*o,this._axisZZ=t*s-e*n;let l=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;l>0&&(l=1/Math.sqrt(l)),this._axisXX*=l,this._axisXY*=l,this._axisXZ*=l;let h=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;h>0&&(h=1/Math.sqrt(h)),this._axisYX*=h,this._axisYY*=h,this._axisYZ*=h;let m=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;m>0&&(m=1/Math.sqrt(m)),this._axisZX*=m,this._axisZY*=m,this._axisZZ*=m,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0;let f,p,d,u,g,v,x,b,Y,w,Z,X,M,z,T,F,P,A;f=this._basisX1X,p=this._basisY1X,d=this._basisZ1X,u=this._basisX1Y,g=this._basisY1Y,v=this._basisZ1Y,x=this._basisX1Z,b=this._basisY1Z,Y=this._basisZ1Z,w=this._basisX2X,Z=this._basisY2X,X=this._basisZ2X,M=this._basisX2Y,z=this._basisY2Y,T=this._basisZ2Y,F=this._basisX2Z,P=this._basisY2Z,A=this._basisZ2Z;let L,S,R,E,C,k,V,B,J,I,G,D,et,$;B=f*w+u*M+x*F,J=f*Z+u*z+x*P,I=f*X+u*T+x*A,G=p*Z+g*z+b*P,D=p*X+g*T+b*A,et=d*Z+v*z+Y*P,$=d*X+v*T+Y*A,L=B,S=J,R=I,E=G,C=D,k=et,V=$;let j,q,tt,W=R;if(W<=-1){let at=Math.atan2(k,E);j=at*.5,q=-1.570796326794895,tt=-at*.5}else if(W>=1){let at=Math.atan2(k,E);j=at*.5,q=1.570796326794895,tt=at*.5}else j=Math.atan2(-C,V),q=Math.asin(W),tt=Math.atan2(-S,L);this._angleX=j,this._angleY=q,this._angleZ=tt;let U,it,Q;U=this._anchor2X-this._anchor1X,it=this._anchor2Y-this._anchor1Y,Q=this._anchor2Z-this._anchor1Z,this.translationX=U*this._basisX1X+it*this._basisX1Y+Q*this._basisX1Z,this.translationY=U*this._basisY1X+it*this._basisY1Y+Q*this._basisY1Z,this.translationZ=U*this._basisZ1X+it*this._basisZ1Y+Q*this._basisZ1Z}_getVelocitySolverInfo(t,e){super._getVelocitySolverInfo(t,e),this.getInfo(e,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxisX(){let t=new y.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxisY(){let t=new y.common.Vec3;return t.x=this._axisYX,t.y=this._axisYY,t.z=this._axisYZ,t}getAxisZ(){let t=new y.common.Vec3;return t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z,t}getTranslationalSpringDampers(){return this._translSds.slice(0)}getRotationalSpringDampers(){return this._rotSds.slice(0)}getTranslationalLimitMotors(){return this._translLms.slice(0)}getRotationalLimitMotors(){return this._rotLms.slice(0)}getAngles(){return new y.common.Vec3(this._angleX,this._angleY,this._angleZ)}getTranslations(){return new y.common.Vec3(this.translationX,this.translationY,this.translationZ)}};y.dynamics.constraint.joint.GenericJointConfig=class extends y.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localBasis1=new y.common.Mat3,this.localBasis2=new y.common.Mat3;let t=[];t.push(new y.dynamics.constraint.joint.TranslationalLimitMotor().setLimits(0,0)),t.push(new y.dynamics.constraint.joint.TranslationalLimitMotor().setLimits(0,0)),t.push(new y.dynamics.constraint.joint.TranslationalLimitMotor().setLimits(0,0)),this.translationalLimitMotors=t;let e=[];e.push(new y.dynamics.constraint.joint.RotationalLimitMotor().setLimits(0,0)),e.push(new y.dynamics.constraint.joint.RotationalLimitMotor().setLimits(0,0)),e.push(new y.dynamics.constraint.joint.RotationalLimitMotor().setLimits(0,0)),this.rotationalLimitMotors=e,this.translationalSpringDampers=[new y.dynamics.constraint.joint.SpringDamper,new y.dynamics.constraint.joint.SpringDamper,new y.dynamics.constraint.joint.SpringDamper],this.rotationalSpringDampers=[new y.dynamics.constraint.joint.SpringDamper,new y.dynamics.constraint.joint.SpringDamper,new y.dynamics.constraint.joint.SpringDamper]}init(t,e,i,n,s){this._init(t,e,i);let o=t._transform,r=e._transform,_,a,l,h,m,f,p,d,u,g,v,x,b,Y,w,Z,X,M,z,T,F,P,A,L,S,R,E,C,k,V,B,J,I,G,D,et;_=n.e00,a=n.e01,l=n.e02,h=n.e10,m=n.e11,f=n.e12,p=n.e20,d=n.e21,u=n.e22,g=s.e00,v=s.e01,x=s.e02,b=s.e10,Y=s.e11,w=s.e12,Z=s.e20,X=s.e21,M=s.e22;let $,j,q,tt,W,U,it,Q,at;$=o._rotation00*_+o._rotation10*h+o._rotation20*p,j=o._rotation00*a+o._rotation10*m+o._rotation20*d,q=o._rotation00*l+o._rotation10*f+o._rotation20*u,tt=o._rotation01*_+o._rotation11*h+o._rotation21*p,W=o._rotation01*a+o._rotation11*m+o._rotation21*d,U=o._rotation01*l+o._rotation11*f+o._rotation21*u,it=o._rotation02*_+o._rotation12*h+o._rotation22*p,Q=o._rotation02*a+o._rotation12*m+o._rotation22*d,at=o._rotation02*l+o._rotation12*f+o._rotation22*u,z=$,T=j,F=q,P=tt,A=W,L=U,S=it,R=Q,E=at;let ht,_t,mt,ft,ut,H,O,ot,pt;ht=r._rotation00*g+r._rotation10*b+r._rotation20*Z,_t=r._rotation00*v+r._rotation10*Y+r._rotation20*X,mt=r._rotation00*x+r._rotation10*w+r._rotation20*M,ft=r._rotation01*g+r._rotation11*b+r._rotation21*Z,ut=r._rotation01*v+r._rotation11*Y+r._rotation21*X,H=r._rotation01*x+r._rotation11*w+r._rotation21*M,O=r._rotation02*g+r._rotation12*b+r._rotation22*Z,ot=r._rotation02*v+r._rotation12*Y+r._rotation22*X,pt=r._rotation02*x+r._rotation12*w+r._rotation22*M,C=ht,k=_t,V=mt,B=ft,J=ut,I=H,G=O,D=ot,et=pt;let vt=this.localBasis1;vt.e00=z,vt.e01=T,vt.e02=F,vt.e10=P,vt.e11=A,vt.e12=L,vt.e20=S,vt.e21=R,vt.e22=E;let xt=this.localBasis2;return xt.e00=C,xt.e01=k,xt.e02=V,xt.e10=B,xt.e11=J,xt.e12=I,xt.e20=G,xt.e21=D,xt.e22=et,this}};y.dynamics.constraint.joint.JointImpulse=class{constructor(){this.impulse=0,this.impulseM=0,this.impulseP=0}};y.dynamics.constraint.joint.JointLink=class{constructor(t){this._joint=t}getContact(){return this._joint}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}};y.dynamics.constraint.joint.JointMacro=class{};y.dynamics.constraint.joint.JointType=class{};y.dynamics.constraint.joint.PrismaticJoint=class extends y.dynamics.constraint.joint.Joint{constructor(t){super(t,y.dynamics.constraint.joint.JointType.PRISMATIC);let e=t.localAxis1;this._localBasisX1X=e.x,this._localBasisX1Y=e.y,this._localBasisX1Z=e.z;let i=t.localAxis2;this._localBasisX2X=i.x,this._localBasisX2Y=i.y,this._localBasisX2Z=i.z,this.buildLocalBasesFromX(),this._basis=new y.dynamics.constraint.joint.BasisTracker(this),this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this.angularErrorX=0,this.angularErrorY=0,this.angularErrorZ=0,this._sd=t.springDamper.clone(),this._lm=t.limitMotor.clone()}getInfo(t,e,i){let n=this.getErp(e,i),s=this.linearErrorY*n,o=this.linearErrorZ*n,r=this.angularErrorX*n,_=this.angularErrorY*n,a=this.angularErrorZ*n,l;if(this._sd.frequency<=0||!i){let z=this._impulses[0],T=t.rows[t.numRows++],F=T.jacobian;F.lin1X=0,F.lin1Y=0,F.lin1Z=0,F.lin2X=0,F.lin2Y=0,F.lin2Z=0,F.ang1X=0,F.ang1Y=0,F.ang1Z=0,F.ang2X=0,F.ang2Y=0,F.ang2Z=0,T.rhs=0,T.cfm=0,T.minImpulse=0,T.maxImpulse=0,T.motorSpeed=0,T.motorMaxImpulse=0,T.impulse=null,T.impulse=z,this.setSolverInfoRowLinear(T,this.translation,this._lm,1/(this._b1._invMass+this._b2._invMass),this._sd,e,i),l=T.jacobian,l.lin1X=this._basis.xX,l.lin1Y=this._basis.xY,l.lin1Z=this._basis.xZ,l.lin2X=this._basis.xX,l.lin2Y=this._basis.xY,l.lin2Z=this._basis.xZ,l.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,l.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,l.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,l.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,l.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,l.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}let h=this._impulses[1],m=t.rows[t.numRows++],f=m.jacobian;f.lin1X=0,f.lin1Y=0,f.lin1Z=0,f.lin2X=0,f.lin2Y=0,f.lin2Z=0,f.ang1X=0,f.ang1Y=0,f.ang1Z=0,f.ang2X=0,f.ang2Y=0,f.ang2Z=0,m.rhs=0,m.cfm=0,m.minImpulse=0,m.maxImpulse=0,m.motorSpeed=0,m.motorMaxImpulse=0,m.impulse=null,m.impulse=h,m.rhs=s,m.cfm=0,m.minImpulse=-1/0,m.maxImpulse=1/0,l=m.jacobian,l.lin1X=this._basis.yX,l.lin1Y=this._basis.yY,l.lin1Z=this._basis.yZ,l.lin2X=this._basis.yX,l.lin2Y=this._basis.yY,l.lin2Z=this._basis.yZ,l.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,l.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,l.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,l.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,l.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,l.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;let p=this._impulses[2],d=t.rows[t.numRows++],u=d.jacobian;u.lin1X=0,u.lin1Y=0,u.lin1Z=0,u.lin2X=0,u.lin2Y=0,u.lin2Z=0,u.ang1X=0,u.ang1Y=0,u.ang1Z=0,u.ang2X=0,u.ang2Y=0,u.ang2Z=0,d.rhs=0,d.cfm=0,d.minImpulse=0,d.maxImpulse=0,d.motorSpeed=0,d.motorMaxImpulse=0,d.impulse=null,d.impulse=p,d.rhs=o,d.cfm=0,d.minImpulse=-1/0,d.maxImpulse=1/0,l=d.jacobian,l.lin1X=this._basis.zX,l.lin1Y=this._basis.zY,l.lin1Z=this._basis.zZ,l.lin2X=this._basis.zX,l.lin2Y=this._basis.zY,l.lin2Z=this._basis.zZ,l.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,l.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,l.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,l.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,l.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,l.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX;let g=this._impulses[3],v=t.rows[t.numRows++],x=v.jacobian;x.lin1X=0,x.lin1Y=0,x.lin1Z=0,x.lin2X=0,x.lin2Y=0,x.lin2Z=0,x.ang1X=0,x.ang1Y=0,x.ang1Z=0,x.ang2X=0,x.ang2Y=0,x.ang2Z=0,v.rhs=0,v.cfm=0,v.minImpulse=0,v.maxImpulse=0,v.motorSpeed=0,v.motorMaxImpulse=0,v.impulse=null,v.impulse=g,v.rhs=r,v.cfm=0,v.minImpulse=-1/0,v.maxImpulse=1/0,l=v.jacobian,l.ang1X=1,l.ang1Y=0,l.ang1Z=0,l.ang2X=1,l.ang2Y=0,l.ang2Z=0;let b=this._impulses[4],Y=t.rows[t.numRows++],w=Y.jacobian;w.lin1X=0,w.lin1Y=0,w.lin1Z=0,w.lin2X=0,w.lin2Y=0,w.lin2Z=0,w.ang1X=0,w.ang1Y=0,w.ang1Z=0,w.ang2X=0,w.ang2Y=0,w.ang2Z=0,Y.rhs=0,Y.cfm=0,Y.minImpulse=0,Y.maxImpulse=0,Y.motorSpeed=0,Y.motorMaxImpulse=0,Y.impulse=null,Y.impulse=b,Y.rhs=_,Y.cfm=0,Y.minImpulse=-1/0,Y.maxImpulse=1/0,l=Y.jacobian,l.ang1X=0,l.ang1Y=1,l.ang1Z=0,l.ang2X=0,l.ang2Y=1,l.ang2Z=0;let Z=this._impulses[5],X=t.rows[t.numRows++],M=X.jacobian;M.lin1X=0,M.lin1Y=0,M.lin1Z=0,M.lin2X=0,M.lin2Y=0,M.lin2Z=0,M.ang1X=0,M.ang1Y=0,M.ang1Z=0,M.ang2X=0,M.ang2Y=0,M.ang2Z=0,X.rhs=0,X.cfm=0,X.minImpulse=0,X.maxImpulse=0,X.motorSpeed=0,X.motorMaxImpulse=0,X.impulse=null,X.impulse=Z,X.rhs=a,X.cfm=0,X.minImpulse=-1/0,X.maxImpulse=1/0,l=X.jacobian,l.ang1X=0,l.ang1Y=0,l.ang1Z=1,l.ang2X=0,l.ang2Y=0,l.ang2Z=1}_syncAnchors(){super._syncAnchors();let t=this._basis,e=t.joint._b1._invMass,i=t.joint._b2._invMass,n,s,o,r,_,a,l,h,m,f,p,d,u,g,v,x,b,Y,w,Z,X,M,z,T,F,P,A,L,S,R,E,C,k,V,B,J,I=t.joint._basisX1X*t.joint._basisX2X+t.joint._basisX1Y*t.joint._basisX2Y+t.joint._basisX1Z*t.joint._basisX2Z;if(I<-.999999999){let Ct,Gt,Pe,Ve=t.joint._basisX1X,Ue=t.joint._basisX1Y,ii=t.joint._basisX1Z,ri=Ve*Ve,ui=Ue*Ue,vi=ii*ii,ce;ri<ui?ri<vi?(ce=1/Math.sqrt(ui+vi),Ct=0,Gt=ii*ce,Pe=-Ue*ce):(ce=1/Math.sqrt(ri+ui),Ct=Ue*ce,Gt=-Ve*ce,Pe=0):ui<vi?(ce=1/Math.sqrt(vi+ri),Ct=-ii*ce,Gt=0,Pe=Ve*ce):(ce=1/Math.sqrt(ri+ui),Ct=Ue*ce,Gt=-Ve*ce,Pe=0),n=Ct,s=Gt,o=Pe,r=0}else{let Ct,Gt,Pe;Ct=t.joint._basisX1Y*t.joint._basisX2Z-t.joint._basisX1Z*t.joint._basisX2Y,Gt=t.joint._basisX1Z*t.joint._basisX2X-t.joint._basisX1X*t.joint._basisX2Z,Pe=t.joint._basisX1X*t.joint._basisX2Y-t.joint._basisX1Y*t.joint._basisX2X;let Ve=Math.sqrt((1+I)*.5);I=.5/Ve,Ct*=I,Gt*=I,Pe*=I,n=Ct,s=Gt,o=Pe,r=Ve}_=0,a=0,l=0,h=1;let G,D,et,$,j,q,tt,W;G=_,D=a,et=l,$=h,j=n,q=s,tt=o,W=r;let U=G*j+D*q+et*tt+$*W;if(U<0&&(U=-U,j=-j,q=-q,tt=-tt,W=-W),U>.999999){let Ct,Gt,Pe,Ve;Ct=j-G,Gt=q-D,Pe=tt-et,Ve=W-$,j=G+Ct*(e/(e+i)),q=D+Gt*(e/(e+i)),tt=et+Pe*(e/(e+i)),W=$+Ve*(e/(e+i));let Ue=j*j+q*q+tt*tt+W*W;Ue>1e-32&&(Ue=1/Math.sqrt(Ue)),m=j*Ue,f=q*Ue,p=tt*Ue,d=W*Ue}else{let Ct=e/(e+i)*Math.acos(U);j+=G*-U,q+=D*-U,tt+=et*-U,W+=$*-U;let Gt=j*j+q*q+tt*tt+W*W;Gt>1e-32&&(Gt=1/Math.sqrt(Gt)),j*=Gt,q*=Gt,tt*=Gt,W*=Gt;let Pe=Math.sin(Ct),Ve=Math.cos(Ct);G*=Ve,D*=Ve,et*=Ve,$*=Ve,m=G+j*Pe,f=D+q*Pe,p=et+tt*Pe,d=$+W*Pe}let it=m,Q=f,at=p,ht=d,_t=2*it,mt=2*Q,ft=2*at,ut=it*_t,H=Q*mt,O=at*ft,ot=it*mt,pt=Q*ft,vt=it*ft,xt=ht*_t,Mt=ht*mt,ct=ht*ft;u=1-H-O,g=ot-ct,v=vt+Mt,x=ot+ct,b=1-ut-O,Y=pt-xt,w=vt-Mt,Z=pt+xt,X=1-ut-H;let St,It,dt;St=u*t.joint._basisX1X+g*t.joint._basisX1Y+v*t.joint._basisX1Z,It=x*t.joint._basisX1X+b*t.joint._basisX1Y+Y*t.joint._basisX1Z,dt=w*t.joint._basisX1X+Z*t.joint._basisX1Y+X*t.joint._basisX1Z,M=St,z=It,T=dt,E=t.xX,C=t.xY,k=t.xZ,V=t.yX,B=t.yY,J=t.yZ;let K=E*M+C*z+k*T;if(K<-.999999999){let Ct,Gt,Pe,Ve=E,Ue=C,ii=k,ri=Ve*Ve,ui=Ue*Ue,vi=ii*ii,ce;ri<ui?ri<vi?(ce=1/Math.sqrt(ui+vi),Ct=0,Gt=ii*ce,Pe=-Ue*ce):(ce=1/Math.sqrt(ri+ui),Ct=Ue*ce,Gt=-Ve*ce,Pe=0):ui<vi?(ce=1/Math.sqrt(vi+ri),Ct=-ii*ce,Gt=0,Pe=Ve*ce):(ce=1/Math.sqrt(ri+ui),Ct=Ue*ce,Gt=-Ve*ce,Pe=0),m=Ct,f=Gt,p=Pe,d=0}else{let Ct,Gt,Pe;Ct=C*T-k*z,Gt=k*M-E*T,Pe=E*z-C*M;let Ve=Math.sqrt((1+K)*.5);K=.5/Ve,Ct*=K,Gt*=K,Pe*=K,m=Ct,f=Gt,p=Pe,d=Ve}let lt=m,rt=f,Vt=p,At=d,Yt=2*lt,Xt=2*rt,Nt=2*Vt,ie=lt*Yt,ee=rt*Xt,Ze=Vt*Nt,ze=lt*Xt,pe=rt*Nt,$t=lt*Nt,Ht=At*Yt,ue=At*Xt,Ie=At*Nt;u=1-ee-Ze,g=ze-Ie,v=$t+ue,x=ze+Ie,b=1-ie-Ze,Y=pe-Ht,w=$t-ue,Z=pe+Ht,X=1-ie-ee;let qe,Ee,Ut;if(qe=u*V+g*B+v*J,Ee=x*V+b*B+Y*J,Ut=w*V+Z*B+X*J,F=qe,P=Ee,A=Ut,L=z*A-T*P,S=T*F-M*A,R=M*P-z*F,L*L+S*S+R*R>1e-6){let Ct=L*L+S*S+R*R;Ct>0&&(Ct=1/Math.sqrt(Ct)),L*=Ct,S*=Ct,R*=Ct}else{let Ct=M,Gt=z,Pe=T,Ve=Ct*Ct,Ue=Gt*Gt,ii=Pe*Pe,ri;Ve<Ue?Ve<ii?(ri=1/Math.sqrt(Ue+ii),L=0,S=Pe*ri,R=-Gt*ri):(ri=1/Math.sqrt(Ve+Ue),L=Gt*ri,S=-Ct*ri,R=0):Ue<ii?(ri=1/Math.sqrt(ii+Ve),L=-Pe*ri,S=0,R=Ct*ri):(ri=1/Math.sqrt(Ve+Ue),L=Gt*ri,S=-Ct*ri,R=0)}F=S*T-R*z,P=R*M-L*T,A=L*z-S*M,t.xX=M,t.xY=z,t.xZ=T,t.yX=F,t.yY=P,t.yZ=A,t.zX=L,t.zY=S,t.zZ=R;let nt,gt,yt,bt,st,Pt,Dt,N,kt,Rt,Ot,Wt,Bt,re,Ce,be,Tt,Lt;nt=this._basisX1X,gt=this._basisY1X,yt=this._basisZ1X,bt=this._basisX1Y,st=this._basisY1Y,Pt=this._basisZ1Y,Dt=this._basisX1Z,N=this._basisY1Z,kt=this._basisZ1Z,Rt=this._basisX2X,Ot=this._basisY2X,Wt=this._basisZ2X,Bt=this._basisX2Y,re=this._basisY2Y,Ce=this._basisZ2Y,be=this._basisX2Z,Tt=this._basisY2Z,Lt=this._basisZ2Z;let Zt,me,Me,fe,ti,di,Le,_i,yi,he,gi,bi,Mi,Ii,He,Je,Ke,ci;he=Rt*nt+Ot*gt+Wt*yt,gi=Rt*bt+Ot*st+Wt*Pt,bi=Rt*Dt+Ot*N+Wt*kt,Mi=Bt*nt+re*gt+Ce*yt,Ii=Bt*bt+re*st+Ce*Pt,He=Bt*Dt+re*N+Ce*kt,Je=be*nt+Tt*gt+Lt*yt,Ke=be*bt+Tt*st+Lt*Pt,ci=be*Dt+Tt*N+Lt*kt,Zt=he,me=gi,Me=bi,fe=Mi,ti=Ii,di=He,Le=Je,_i=Ke,yi=ci;let hi,ei,ai,Qe,We=Zt,ke=ti,le=yi,ge=We+ke+le,jt;ge>0?(jt=Math.sqrt(ge+1),Qe=.5*jt,jt=.5/jt,hi=(_i-di)*jt,ei=(Me-Le)*jt,ai=(fe-me)*jt):We>ke?We>le?(jt=Math.sqrt(We-ke-le+1),hi=.5*jt,jt=.5/jt,ei=(me+fe)*jt,ai=(Me+Le)*jt,Qe=(_i-di)*jt):(jt=Math.sqrt(le-We-ke+1),ai=.5*jt,jt=.5/jt,hi=(Me+Le)*jt,ei=(di+_i)*jt,Qe=(fe-me)*jt):ke>le?(jt=Math.sqrt(ke-le-We+1),ei=.5*jt,jt=.5/jt,hi=(me+fe)*jt,ai=(di+_i)*jt,Qe=(Me-Le)*jt):(jt=Math.sqrt(le-We-ke+1),ai=.5*jt,jt=.5/jt,hi=(Me+Le)*jt,ei=(di+_i)*jt,Qe=(fe-me)*jt);let Ae=Qe,Se=(Ae<=-1?3.14159265358979:Ae>=1?0:Math.acos(Ae))*2;this.angularErrorX=hi,this.angularErrorY=ei,this.angularErrorZ=ai;let Re=this.angularErrorX*this.angularErrorX+this.angularErrorY*this.angularErrorY+this.angularErrorZ*this.angularErrorZ;Re>0&&(Re=1/Math.sqrt(Re)),this.angularErrorX*=Re,this.angularErrorY*=Re,this.angularErrorZ*=Re,this.angularErrorX*=Se,this.angularErrorY*=Se,this.angularErrorZ*=Se;let Te,Ne,se;Te=this._anchor2X-this._anchor1X,Ne=this._anchor2Y-this._anchor1Y,se=this._anchor2Z-this._anchor1Z,this.translation=Te*this._basis.xX+Ne*this._basis.xY+se*this._basis.xZ,this.linearErrorY=Te*this._basis.yX+Ne*this._basis.yY+se*this._basis.yZ,this.linearErrorZ=Te*this._basis.zX+Ne*this._basis.zY+se*this._basis.zZ}_getVelocitySolverInfo(t,e){super._getVelocitySolverInfo(t,e),this.getInfo(e,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new y.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new y.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new y.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new y.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getTranslation(){return this.translation}};y.dynamics.constraint.joint.PrismaticJointConfig=class extends y.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new y.common.Vec3(1,0,0),this.localAxis2=new y.common.Vec3(1,0,0),this.limitMotor=new y.dynamics.constraint.joint.TranslationalLimitMotor,this.springDamper=new y.dynamics.constraint.joint.SpringDamper}init(t,e,i,n){this._init(t,e,i);let s=this.localAxis1,o,r,_;o=n.x,r=n.y,_=n.z;let a,l,h;a=t._transform._rotation00*o+t._transform._rotation10*r+t._transform._rotation20*_,l=t._transform._rotation01*o+t._transform._rotation11*r+t._transform._rotation21*_,h=t._transform._rotation02*o+t._transform._rotation12*r+t._transform._rotation22*_,o=a,r=l,_=h,s.x=o,s.y=r,s.z=_;let m=this.localAxis2,f,p,d;f=n.x,p=n.y,d=n.z;let u,g,v;return u=e._transform._rotation00*f+e._transform._rotation10*p+e._transform._rotation20*d,g=e._transform._rotation01*f+e._transform._rotation11*p+e._transform._rotation21*d,v=e._transform._rotation02*f+e._transform._rotation12*p+e._transform._rotation22*d,f=u,p=g,d=v,m.x=f,m.y=p,m.z=d,this}};y.dynamics.constraint.joint.RagdollJoint=class extends y.dynamics.constraint.joint.Joint{constructor(t){super(t,y.dynamics.constraint.joint.JointType.RAGDOLL);let e=t.localTwistAxis1;this._localBasisX1X=e.x,this._localBasisX1Y=e.y,this._localBasisX1Z=e.z;let i=t.localSwingAxis1;this._localBasisY1X=i.x,this._localBasisY1Y=i.y,this._localBasisY1Z=i.z;let n=t.localTwistAxis2;this._localBasisX2X=n.x,this._localBasisX2Y=n.y,this._localBasisX2Z=n.z,this.buildLocalBasesFromXY1X2(),this._twistSd=t.twistSpringDamper.clone(),this._twistLm=t.twistLimitMotor.clone(),this._swingSd=t.swingSpringDamper.clone(),this._maxSwingAngle1=t.maxSwingAngle1,this._maxSwingAngle2=t.maxSwingAngle2,this._maxSwingAngle1<y.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle1=y.common.Setting.minRagdollMaxSwingAngle),this._maxSwingAngle2<y.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle2=y.common.Setting.minRagdollMaxSwingAngle),this.dummySwingLm=new y.dynamics.constraint.joint.RotationalLimitMotor,this.dummySwingLm.lowerLimit=-1,this.dummySwingLm.upperLimit=0,this._swingAngle=0,this._twistAngle=0,this.swingError=0,this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.twistAxisX=0,this.twistAxisY=0,this.twistAxisZ=0}getInfo(t,e,i){let n=this.getErp(e,i),s,o,r;s=this.linearErrorX*n,o=this.linearErrorY*n,r=this.linearErrorZ*n;let _,a,l,h,m,f,p,d,u,g,v,x,b,Y,w,Z,X,M;_=0,a=-this._relativeAnchor1Z,l=this._relativeAnchor1Y,h=this._relativeAnchor1Z,m=0,f=-this._relativeAnchor1X,p=-this._relativeAnchor1Y,d=this._relativeAnchor1X,u=0,g=0,v=-this._relativeAnchor2Z,x=this._relativeAnchor2Y,b=this._relativeAnchor2Z,Y=0,w=-this._relativeAnchor2X,Z=-this._relativeAnchor2Y,X=this._relativeAnchor2X,M=0,_=-_,a=-a,l=-l,h=-h,m=-m,f=-f,p=-p,d=-d,u=-u,g=-g,v=-v,x=-x,b=-b,Y=-Y,w=-w,Z=-Z,X=-X,M=-M;let z=this.computeEffectiveInertiaMoment(this.swingAxisX,this.swingAxisY,this.swingAxisZ),T=this.computeEffectiveInertiaMoment(this._basisX2X,this._basisX2Y,this._basisX2Z),F=this._impulses[0],P=t.rows[t.numRows++],A=P.jacobian;A.lin1X=0,A.lin1Y=0,A.lin1Z=0,A.lin2X=0,A.lin2Y=0,A.lin2Z=0,A.ang1X=0,A.ang1Y=0,A.ang1Z=0,A.ang2X=0,A.ang2Y=0,A.ang2Z=0,P.rhs=0,P.cfm=0,P.minImpulse=0,P.maxImpulse=0,P.motorSpeed=0,P.motorMaxImpulse=0,P.impulse=null,P.impulse=F,P.rhs=s,P.cfm=0,P.minImpulse=-1/0,P.maxImpulse=1/0;let L=P.jacobian;L.lin1X=1,L.lin1Y=0,L.lin1Z=0,L.lin2X=1,L.lin2Y=0,L.lin2Z=0,L.ang1X=_,L.ang1Y=a,L.ang1Z=l,L.ang2X=g,L.ang2Y=v,L.ang2Z=x;let S=this._impulses[1],R=t.rows[t.numRows++],E=R.jacobian;E.lin1X=0,E.lin1Y=0,E.lin1Z=0,E.lin2X=0,E.lin2Y=0,E.lin2Z=0,E.ang1X=0,E.ang1Y=0,E.ang1Z=0,E.ang2X=0,E.ang2Y=0,E.ang2Z=0,R.rhs=0,R.cfm=0,R.minImpulse=0,R.maxImpulse=0,R.motorSpeed=0,R.motorMaxImpulse=0,R.impulse=null,R.impulse=S,R.rhs=o,R.cfm=0,R.minImpulse=-1/0,R.maxImpulse=1/0,L=R.jacobian,L.lin1X=0,L.lin1Y=1,L.lin1Z=0,L.lin2X=0,L.lin2Y=1,L.lin2Z=0,L.ang1X=h,L.ang1Y=m,L.ang1Z=f,L.ang2X=b,L.ang2Y=Y,L.ang2Z=w;let C=this._impulses[2],k=t.rows[t.numRows++],V=k.jacobian;if(V.lin1X=0,V.lin1Y=0,V.lin1Z=0,V.lin2X=0,V.lin2Y=0,V.lin2Z=0,V.ang1X=0,V.ang1Y=0,V.ang1Z=0,V.ang2X=0,V.ang2Y=0,V.ang2Z=0,k.rhs=0,k.cfm=0,k.minImpulse=0,k.maxImpulse=0,k.motorSpeed=0,k.motorMaxImpulse=0,k.impulse=null,k.impulse=C,k.rhs=r,k.cfm=0,k.minImpulse=-1/0,k.maxImpulse=1/0,L=k.jacobian,L.lin1X=0,L.lin1Y=0,L.lin1Z=1,L.lin2X=0,L.lin2Y=0,L.lin2Z=1,L.ang1X=p,L.ang1Y=d,L.ang1Z=u,L.ang2X=Z,L.ang2Y=X,L.ang2Z=M,this.swingError>0&&(this._swingSd.frequency<=0||!i)){let B=this._impulses[3],J=t.rows[t.numRows++],I=J.jacobian;I.lin1X=0,I.lin1Y=0,I.lin1Z=0,I.lin2X=0,I.lin2Y=0,I.lin2Z=0,I.ang1X=0,I.ang1Y=0,I.ang1Z=0,I.ang2X=0,I.ang2Y=0,I.ang2Z=0,J.rhs=0,J.cfm=0,J.minImpulse=0,J.maxImpulse=0,J.motorSpeed=0,J.motorMaxImpulse=0,J.impulse=null,J.impulse=B,this.setSolverInfoRowAngular(J,this.swingError,this.dummySwingLm,z,this._swingSd,e,i),L=J.jacobian,L.ang1X=this.swingAxisX,L.ang1Y=this.swingAxisY,L.ang1Z=this.swingAxisZ,L.ang2X=this.swingAxisX,L.ang2Y=this.swingAxisY,L.ang2Z=this.swingAxisZ}if(this._twistSd.frequency<=0||!i){let B=this._impulses[4],J=t.rows[t.numRows++],I=J.jacobian;I.lin1X=0,I.lin1Y=0,I.lin1Z=0,I.lin2X=0,I.lin2Y=0,I.lin2Z=0,I.ang1X=0,I.ang1Y=0,I.ang1Z=0,I.ang2X=0,I.ang2Y=0,I.ang2Z=0,J.rhs=0,J.cfm=0,J.minImpulse=0,J.maxImpulse=0,J.motorSpeed=0,J.motorMaxImpulse=0,J.impulse=null,J.impulse=B,this.setSolverInfoRowAngular(J,this._twistAngle,this._twistLm,T,this._twistSd,e,i),L=J.jacobian,L.ang1X=this.twistAxisX,L.ang1Y=this.twistAxisY,L.ang1Z=this.twistAxisZ,L.ang2X=this.twistAxisX,L.ang2Y=this.twistAxisY,L.ang2Z=this.twistAxisZ}}_syncAnchors(){super._syncAnchors();let t,e,i,n,s,o;t=this._basisX1X,e=this._basisX1Y,i=this._basisX1Z,n=this._basisX2X,s=this._basisX2Y,o=this._basisX2Z;let r,_,a,l,h,m,f,p,d;r=this._basisX1X,_=this._basisY1X,a=this._basisZ1X,l=this._basisX1Y,h=this._basisY1Y,m=this._basisZ1Y,f=this._basisX1Z,p=this._basisY1Z,d=this._basisZ1Z;let u,g,v,x,b,Y,w,Z,X,M,z,T,F,P,A,L,S=t*n+e*s+i*o;if(S<-.999999999){let St,It,dt,K=t,lt=e,rt=i,Vt=K*K,At=lt*lt,Yt=rt*rt,Xt;Vt<At?Vt<Yt?(Xt=1/Math.sqrt(At+Yt),St=0,It=rt*Xt,dt=-lt*Xt):(Xt=1/Math.sqrt(Vt+At),St=lt*Xt,It=-K*Xt,dt=0):At<Yt?(Xt=1/Math.sqrt(Yt+Vt),St=-rt*Xt,It=0,dt=K*Xt):(Xt=1/Math.sqrt(Vt+At),St=lt*Xt,It=-K*Xt,dt=0),u=St,g=It,v=dt,x=0}else{let St,It,dt;St=e*o-i*s,It=i*n-t*o,dt=t*s-e*n;let K=Math.sqrt((1+S)*.5);S=.5/K,St*=S,It*=S,dt*=S,u=St,g=It,v=dt,x=K}let R=u,E=g,C=v,k=x,V=2*R,B=2*E,J=2*C,I=R*V,G=E*B,D=C*J,et=R*B,$=E*J,j=R*J,q=k*V,tt=k*B,W=k*J;b=1-G-D,Y=et-W,w=j+tt,Z=et+W,X=1-I-D,M=$-q,z=j-tt,T=$+q,F=1-I-G,this._swingAngle=(x<=-1?3.14159265358979:x>=1?0:Math.acos(x))*2,P=u,A=g,L=v;let U,it,Q,at,ht,_t;at=b*this._basisY2X+Z*this._basisY2Y+z*this._basisY2Z,ht=Y*this._basisY2X+X*this._basisY2Y+T*this._basisY2Z,_t=w*this._basisY2X+M*this._basisY2Y+F*this._basisY2Z,U=at,it=ht,Q=_t,this._twistAngle=Math.atan2(this._basisZ1X*U+this._basisZ1Y*it+this._basisZ1Z*Q,this._basisY1X*U+this._basisY1Y*it+this._basisY1Z*Q),this.twistAxisX=this._basisX1X+this._basisX2X,this.twistAxisY=this._basisX1Y+this._basisX2Y,this.twistAxisZ=this._basisX1Z+this._basisX2Z;let mt=this.twistAxisX*this.twistAxisX+this.twistAxisY*this.twistAxisY+this.twistAxisZ*this.twistAxisZ;mt>0&&(mt=1/Math.sqrt(mt)),this.twistAxisX*=mt,this.twistAxisY*=mt,this.twistAxisZ*=mt;let ft=Math.sqrt(P*P+A*A+L*L);ft>0&&(ft=1/ft),P*=ft*this._swingAngle,A*=ft*this._swingAngle,L*=ft*this._swingAngle;let ut,H;ut=_*P+h*A+p*L,H=a*P+m*A+d*L,A=ut,L=H;let O=A,ot=L,pt=this._maxSwingAngle1,vt=this._maxSwingAngle2,xt=1/(pt*pt),Mt=1/(vt*vt),ct=O*O*xt+ot*ot*Mt;if(ct==0)this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.swingError=0;else{let St=Math.sqrt(1/ct),It=O*St,dt=ot*St,K=It*xt,lt=dt*Mt;ft=1/Math.sqrt(K*K+lt*lt),K*=ft,lt*=ft;let rt=(O-It)*K+(ot-dt)*lt;if(rt>0){this.swingError=rt,this.swingAxisX=0,this.swingAxisY=K,this.swingAxisZ=lt;let Vt,At,Yt;Vt=r*this.swingAxisX+_*this.swingAxisY+a*this.swingAxisZ,At=l*this.swingAxisX+h*this.swingAxisY+m*this.swingAxisZ,Yt=f*this.swingAxisX+p*this.swingAxisY+d*this.swingAxisZ,this.swingAxisX=Vt,this.swingAxisY=At,this.swingAxisZ=Yt;let Xt,Nt,ie;Xt=b*this.swingAxisX+Y*this.swingAxisY+w*this.swingAxisZ,Nt=Z*this.swingAxisX+X*this.swingAxisY+M*this.swingAxisZ,ie=z*this.swingAxisX+T*this.swingAxisY+F*this.swingAxisZ,this.swingAxisX=Xt,this.swingAxisY=Nt,this.swingAxisZ=ie}else this.swingError=0}this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,e){super._getVelocitySolverInfo(t,e),this.getInfo(e,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new y.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new y.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new y.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new y.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getTwistSpringDamper(){return this._twistSd}getTwistLimitMotor(){return this._twistLm}getSwingSpringDamper(){return this._swingSd}getSwingAxis(){let t=new y.common.Vec3;return t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ,t}getSwingAxisTo(t){t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ}getSwingAngle(){return this._swingAngle}getTwistAngle(){return this._twistAngle}};y.dynamics.constraint.joint.RagdollJointConfig=class extends y.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localTwistAxis1=new y.common.Vec3(1,0,0),this.localTwistAxis2=new y.common.Vec3(1,0,0),this.localSwingAxis1=new y.common.Vec3(0,1,0),this.twistSpringDamper=new y.dynamics.constraint.joint.SpringDamper,this.swingSpringDamper=new y.dynamics.constraint.joint.SpringDamper,this.twistLimitMotor=new y.dynamics.constraint.joint.RotationalLimitMotor,this.maxSwingAngle1=3.14159265358979,this.maxSwingAngle2=3.14159265358979}init(t,e,i,n,s){this._init(t,e,i);let o=this.localTwistAxis1,r,_,a;r=n.x,_=n.y,a=n.z;let l,h,m;l=t._transform._rotation00*r+t._transform._rotation10*_+t._transform._rotation20*a,h=t._transform._rotation01*r+t._transform._rotation11*_+t._transform._rotation21*a,m=t._transform._rotation02*r+t._transform._rotation12*_+t._transform._rotation22*a,r=l,_=h,a=m,o.x=r,o.y=_,o.z=a;let f=this.localTwistAxis2,p,d,u;p=n.x,d=n.y,u=n.z;let g,v,x;g=e._transform._rotation00*p+e._transform._rotation10*d+e._transform._rotation20*u,v=e._transform._rotation01*p+e._transform._rotation11*d+e._transform._rotation21*u,x=e._transform._rotation02*p+e._transform._rotation12*d+e._transform._rotation22*u,p=g,d=v,u=x,f.x=p,f.y=d,f.z=u;let b=this.localSwingAxis1,Y,w,Z;Y=s.x,w=s.y,Z=s.z;let X,M,z;return X=t._transform._rotation00*Y+t._transform._rotation10*w+t._transform._rotation20*Z,M=t._transform._rotation01*Y+t._transform._rotation11*w+t._transform._rotation21*Z,z=t._transform._rotation02*Y+t._transform._rotation12*w+t._transform._rotation22*Z,Y=X,w=M,Z=z,b.x=Y,b.y=w,b.z=Z,this}};y.dynamics.constraint.joint.RevoluteJoint=class extends y.dynamics.constraint.joint.Joint{constructor(t){super(t,1);let e=t.localAxis1;this._localBasisX1X=e.x,this._localBasisX1Y=e.y,this._localBasisX1Z=e.z;let i=t.localAxis2;this._localBasisX2X=i.x,this._localBasisX2Y=i.y,this._localBasisX2Z=i.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this._basis=new y.dynamics.constraint.joint.BasisTracker(this),this._sd=t.springDamper.clone(),this._lm=t.limitMotor.clone()}getInfo(t,e,i){let n=this.getErp(e,i),s,o,r;s=this.linearErrorX*n,o=this.linearErrorY*n,r=this.linearErrorZ*n;let _=this.angularErrorY*n,a=this.angularErrorZ*n,l,h,m,f,p,d,u,g,v,x,b,Y,w,Z,X,M,z,T;l=0,h=-this._relativeAnchor1Z,m=this._relativeAnchor1Y,f=this._relativeAnchor1Z,p=0,d=-this._relativeAnchor1X,u=-this._relativeAnchor1Y,g=this._relativeAnchor1X,v=0,x=0,b=-this._relativeAnchor2Z,Y=this._relativeAnchor2Y,w=this._relativeAnchor2Z,Z=0,X=-this._relativeAnchor2X,M=-this._relativeAnchor2Y,z=this._relativeAnchor2X,T=0,l=-l,h=-h,m=-m,f=-f,p=-p,d=-d,u=-u,g=-g,v=-v,x=-x,b=-b,Y=-Y,w=-w,Z=-Z,X=-X,M=-M,z=-z,T=-T;let F=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ),P=this._impulses[0],A=t.rows[t.numRows++],L=A.jacobian;L.lin1X=0,L.lin1Y=0,L.lin1Z=0,L.lin2X=0,L.lin2Y=0,L.lin2Z=0,L.ang1X=0,L.ang1Y=0,L.ang1Z=0,L.ang2X=0,L.ang2Y=0,L.ang2Z=0,A.rhs=0,A.cfm=0,A.minImpulse=0,A.maxImpulse=0,A.motorSpeed=0,A.motorMaxImpulse=0,A.impulse=null,A.impulse=P,A.rhs=s,A.cfm=0,A.minImpulse=-1/0,A.maxImpulse=1/0;let S=A.jacobian;S.lin1X=1,S.lin1Y=0,S.lin1Z=0,S.lin2X=1,S.lin2Y=0,S.lin2Z=0,S.ang1X=l,S.ang1Y=h,S.ang1Z=m,S.ang2X=x,S.ang2Y=b,S.ang2Z=Y;let R=this._impulses[1],E=t.rows[t.numRows++],C=E.jacobian;C.lin1X=0,C.lin1Y=0,C.lin1Z=0,C.lin2X=0,C.lin2Y=0,C.lin2Z=0,C.ang1X=0,C.ang1Y=0,C.ang1Z=0,C.ang2X=0,C.ang2Y=0,C.ang2Z=0,E.rhs=0,E.cfm=0,E.minImpulse=0,E.maxImpulse=0,E.motorSpeed=0,E.motorMaxImpulse=0,E.impulse=null,E.impulse=R,E.rhs=o,E.cfm=0,E.minImpulse=-1/0,E.maxImpulse=1/0,S=E.jacobian,S.lin1X=0,S.lin1Y=1,S.lin1Z=0,S.lin2X=0,S.lin2Y=1,S.lin2Z=0,S.ang1X=f,S.ang1Y=p,S.ang1Z=d,S.ang2X=w,S.ang2Y=Z,S.ang2Z=X;let k=this._impulses[2],V=t.rows[t.numRows++],B=V.jacobian;if(B.lin1X=0,B.lin1Y=0,B.lin1Z=0,B.lin2X=0,B.lin2Y=0,B.lin2Z=0,B.ang1X=0,B.ang1Y=0,B.ang1Z=0,B.ang2X=0,B.ang2Y=0,B.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=k,V.rhs=r,V.cfm=0,V.minImpulse=-1/0,V.maxImpulse=1/0,S=V.jacobian,S.lin1X=0,S.lin1Y=0,S.lin1Z=1,S.lin2X=0,S.lin2Y=0,S.lin2Z=1,S.ang1X=u,S.ang1Y=g,S.ang1Z=v,S.ang2X=M,S.ang2Y=z,S.ang2Z=T,this._sd.frequency<=0||!i){let j=this._impulses[3],q=t.rows[t.numRows++],tt=q.jacobian;tt.lin1X=0,tt.lin1Y=0,tt.lin1Z=0,tt.lin2X=0,tt.lin2Y=0,tt.lin2Z=0,tt.ang1X=0,tt.ang1Y=0,tt.ang1Z=0,tt.ang2X=0,tt.ang2Y=0,tt.ang2Z=0,q.rhs=0,q.cfm=0,q.minImpulse=0,q.maxImpulse=0,q.motorSpeed=0,q.motorMaxImpulse=0,q.impulse=null,q.impulse=j,this.setSolverInfoRowAngular(q,this.angle,this._lm,F,this._sd,e,i),S=q.jacobian,S.ang1X=this._basis.xX,S.ang1Y=this._basis.xY,S.ang1Z=this._basis.xZ,S.ang2X=this._basis.xX,S.ang2Y=this._basis.xY,S.ang2Z=this._basis.xZ}let J=this._impulses[4],I=t.rows[t.numRows++],G=I.jacobian;G.lin1X=0,G.lin1Y=0,G.lin1Z=0,G.lin2X=0,G.lin2Y=0,G.lin2Z=0,G.ang1X=0,G.ang1Y=0,G.ang1Z=0,G.ang2X=0,G.ang2Y=0,G.ang2Z=0,I.rhs=0,I.cfm=0,I.minImpulse=0,I.maxImpulse=0,I.motorSpeed=0,I.motorMaxImpulse=0,I.impulse=null,I.impulse=J,I.rhs=_,I.cfm=0,I.minImpulse=-1/0,I.maxImpulse=1/0,S=I.jacobian,S.ang1X=this._basis.yX,S.ang1Y=this._basis.yY,S.ang1Z=this._basis.yZ,S.ang2X=this._basis.yX,S.ang2Y=this._basis.yY,S.ang2Z=this._basis.yZ;let D=this._impulses[5],et=t.rows[t.numRows++],$=et.jacobian;$.lin1X=0,$.lin1Y=0,$.lin1Z=0,$.lin2X=0,$.lin2Y=0,$.lin2Z=0,$.ang1X=0,$.ang1Y=0,$.ang1Z=0,$.ang2X=0,$.ang2Y=0,$.ang2Z=0,et.rhs=0,et.cfm=0,et.minImpulse=0,et.maxImpulse=0,et.motorSpeed=0,et.motorMaxImpulse=0,et.impulse=null,et.impulse=D,et.rhs=a,et.cfm=0,et.minImpulse=-1/0,et.maxImpulse=1/0,S=et.jacobian,S.ang1X=this._basis.zX,S.ang1Y=this._basis.zY,S.ang1Z=this._basis.zZ,S.ang2X=this._basis.zX,S.ang2Y=this._basis.zY,S.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();let t=this._basis,e=t.joint._b1._invMass,i=t.joint._b2._invMass,n,s,o,r,_,a,l,h,m,f,p,d,u,g,v,x,b,Y,w,Z,X,M,z,T,F,P,A,L,S,R,E,C,k,V,B,J,I=t.joint._basisX1X*t.joint._basisX2X+t.joint._basisX1Y*t.joint._basisX2Y+t.joint._basisX1Z*t.joint._basisX2Z;if(I<-.999999999){let Rt,Ot,Wt,Bt=t.joint._basisX1X,re=t.joint._basisX1Y,Ce=t.joint._basisX1Z,be=Bt*Bt,Tt=re*re,Lt=Ce*Ce,Zt;be<Tt?be<Lt?(Zt=1/Math.sqrt(Tt+Lt),Rt=0,Ot=Ce*Zt,Wt=-re*Zt):(Zt=1/Math.sqrt(be+Tt),Rt=re*Zt,Ot=-Bt*Zt,Wt=0):Tt<Lt?(Zt=1/Math.sqrt(Lt+be),Rt=-Ce*Zt,Ot=0,Wt=Bt*Zt):(Zt=1/Math.sqrt(be+Tt),Rt=re*Zt,Ot=-Bt*Zt,Wt=0),n=Rt,s=Ot,o=Wt,r=0}else{let Rt,Ot,Wt;Rt=t.joint._basisX1Y*t.joint._basisX2Z-t.joint._basisX1Z*t.joint._basisX2Y,Ot=t.joint._basisX1Z*t.joint._basisX2X-t.joint._basisX1X*t.joint._basisX2Z,Wt=t.joint._basisX1X*t.joint._basisX2Y-t.joint._basisX1Y*t.joint._basisX2X;let Bt=Math.sqrt((1+I)*.5);I=.5/Bt,Rt*=I,Ot*=I,Wt*=I,n=Rt,s=Ot,o=Wt,r=Bt}_=0,a=0,l=0,h=1;let G,D,et,$,j,q,tt,W;G=_,D=a,et=l,$=h,j=n,q=s,tt=o,W=r;let U=G*j+D*q+et*tt+$*W;if(U<0&&(U=-U,j=-j,q=-q,tt=-tt,W=-W),U>.999999){let Rt,Ot,Wt,Bt;Rt=j-G,Ot=q-D,Wt=tt-et,Bt=W-$,j=G+Rt*(e/(e+i)),q=D+Ot*(e/(e+i)),tt=et+Wt*(e/(e+i)),W=$+Bt*(e/(e+i));let re=j*j+q*q+tt*tt+W*W;re>1e-32&&(re=1/Math.sqrt(re)),m=j*re,f=q*re,p=tt*re,d=W*re}else{let Rt=e/(e+i)*Math.acos(U);j+=G*-U,q+=D*-U,tt+=et*-U,W+=$*-U;let Ot=j*j+q*q+tt*tt+W*W;Ot>1e-32&&(Ot=1/Math.sqrt(Ot)),j*=Ot,q*=Ot,tt*=Ot,W*=Ot;let Wt=Math.sin(Rt),Bt=Math.cos(Rt);G*=Bt,D*=Bt,et*=Bt,$*=Bt,m=G+j*Wt,f=D+q*Wt,p=et+tt*Wt,d=$+W*Wt}let it=m,Q=f,at=p,ht=d,_t=2*it,mt=2*Q,ft=2*at,ut=it*_t,H=Q*mt,O=at*ft,ot=it*mt,pt=Q*ft,vt=it*ft,xt=ht*_t,Mt=ht*mt,ct=ht*ft;u=1-H-O,g=ot-ct,v=vt+Mt,x=ot+ct,b=1-ut-O,Y=pt-xt,w=vt-Mt,Z=pt+xt,X=1-ut-H;let St,It,dt;St=u*t.joint._basisX1X+g*t.joint._basisX1Y+v*t.joint._basisX1Z,It=x*t.joint._basisX1X+b*t.joint._basisX1Y+Y*t.joint._basisX1Z,dt=w*t.joint._basisX1X+Z*t.joint._basisX1Y+X*t.joint._basisX1Z,M=St,z=It,T=dt,E=t.xX,C=t.xY,k=t.xZ,V=t.yX,B=t.yY,J=t.yZ;let K=E*M+C*z+k*T;if(K<-.999999999){let Rt,Ot,Wt,Bt=E,re=C,Ce=k,be=Bt*Bt,Tt=re*re,Lt=Ce*Ce,Zt;be<Tt?be<Lt?(Zt=1/Math.sqrt(Tt+Lt),Rt=0,Ot=Ce*Zt,Wt=-re*Zt):(Zt=1/Math.sqrt(be+Tt),Rt=re*Zt,Ot=-Bt*Zt,Wt=0):Tt<Lt?(Zt=1/Math.sqrt(Lt+be),Rt=-Ce*Zt,Ot=0,Wt=Bt*Zt):(Zt=1/Math.sqrt(be+Tt),Rt=re*Zt,Ot=-Bt*Zt,Wt=0),m=Rt,f=Ot,p=Wt,d=0}else{let Rt,Ot,Wt;Rt=C*T-k*z,Ot=k*M-E*T,Wt=E*z-C*M;let Bt=Math.sqrt((1+K)*.5);K=.5/Bt,Rt*=K,Ot*=K,Wt*=K,m=Rt,f=Ot,p=Wt,d=Bt}let lt=m,rt=f,Vt=p,At=d,Yt=2*lt,Xt=2*rt,Nt=2*Vt,ie=lt*Yt,ee=rt*Xt,Ze=Vt*Nt,ze=lt*Xt,pe=rt*Nt,$t=lt*Nt,Ht=At*Yt,ue=At*Xt,Ie=At*Nt;u=1-ee-Ze,g=ze-Ie,v=$t+ue,x=ze+Ie,b=1-ie-Ze,Y=pe-Ht,w=$t-ue,Z=pe+Ht,X=1-ie-ee;let qe,Ee,Ut;if(qe=u*V+g*B+v*J,Ee=x*V+b*B+Y*J,Ut=w*V+Z*B+X*J,F=qe,P=Ee,A=Ut,L=z*A-T*P,S=T*F-M*A,R=M*P-z*F,L*L+S*S+R*R>1e-6){let Rt=L*L+S*S+R*R;Rt>0&&(Rt=1/Math.sqrt(Rt)),L*=Rt,S*=Rt,R*=Rt}else{let Rt=M,Ot=z,Wt=T,Bt=Rt*Rt,re=Ot*Ot,Ce=Wt*Wt,be;Bt<re?Bt<Ce?(be=1/Math.sqrt(re+Ce),L=0,S=Wt*be,R=-Ot*be):(be=1/Math.sqrt(Bt+re),L=Ot*be,S=-Rt*be,R=0):re<Ce?(be=1/Math.sqrt(Ce+Bt),L=-Wt*be,S=0,R=Rt*be):(be=1/Math.sqrt(Bt+re),L=Ot*be,S=-Rt*be,R=0)}F=S*T-R*z,P=R*M-L*T,A=L*z-S*M,t.xX=M,t.xY=z,t.xZ=T,t.yX=F,t.yY=P,t.yZ=A,t.zX=L,t.zY=S,t.zZ=R;let nt,gt,yt;nt=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,gt=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,yt=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;let bt=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,st=bt<=-1?3.14159265358979:bt>=1?0:Math.acos(bt),Pt=nt*nt+gt*gt+yt*yt;Pt>0&&(Pt=1/Math.sqrt(Pt)),nt*=Pt,gt*=Pt,yt*=Pt,nt*=st,gt*=st,yt*=st,this.angularErrorY=nt*this._basis.yX+gt*this._basis.yY+yt*this._basis.yZ,this.angularErrorZ=nt*this._basis.zX+gt*this._basis.zY+yt*this._basis.zZ;let Dt,N,kt;Dt=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,N=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,kt=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,bt=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=bt<=-1?3.14159265358979:bt>=1?0:Math.acos(bt),Dt*this._basis.xX+N*this._basis.xY+kt*this._basis.xZ<0&&(this.angle=-this.angle),this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,e){super._getVelocitySolverInfo(t,e),this.getInfo(e,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new y.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new y.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new y.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new y.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getAngle(){return this.angle}};y.dynamics.constraint.joint.RevoluteJointConfig=class extends y.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new y.common.Vec3(1,0,0),this.localAxis2=new y.common.Vec3(1,0,0),this.springDamper=new y.dynamics.constraint.joint.SpringDamper,this.limitMotor=new y.dynamics.constraint.joint.RotationalLimitMotor}init(t,e,i,n){this._init(t,e,i);let s=this.localAxis1,o,r,_;o=n.x,r=n.y,_=n.z;let a,l,h;a=t._transform._rotation00*o+t._transform._rotation10*r+t._transform._rotation20*_,l=t._transform._rotation01*o+t._transform._rotation11*r+t._transform._rotation21*_,h=t._transform._rotation02*o+t._transform._rotation12*r+t._transform._rotation22*_,o=a,r=l,_=h,s.x=o,s.y=r,s.z=_;let m=this.localAxis2,f,p,d;f=n.x,p=n.y,d=n.z;let u,g,v;return u=e._transform._rotation00*f+e._transform._rotation10*p+e._transform._rotation20*d,g=e._transform._rotation01*f+e._transform._rotation11*p+e._transform._rotation21*d,v=e._transform._rotation02*f+e._transform._rotation12*p+e._transform._rotation22*d,f=u,p=g,d=v,m.x=f,m.y=p,m.z=d,this}};y.dynamics.constraint.joint.RotationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorTorque=0}setLimits(t,e){return this.lowerLimit=t,this.upperLimit=e,this}setMotor(t,e){return this.motorSpeed=t,this.motorTorque=e,this}clone(){let t=new y.dynamics.constraint.joint.RotationalLimitMotor;return t.lowerLimit=this.lowerLimit,t.upperLimit=this.upperLimit,t.motorSpeed=this.motorSpeed,t.motorTorque=this.motorTorque,t}};y.dynamics.constraint.joint.SphericalJoint=class extends y.dynamics.constraint.joint.Joint{constructor(t){super(t,0),this._sd=t.springDamper.clone()}getInfo(t,e,i){if(this._sd.frequency>0&&i)return;let n,s,o;n=this._anchor2X-this._anchor1X,s=this._anchor2Y-this._anchor1Y,o=this._anchor2Z-this._anchor1Z;let r,_;if(this._sd.frequency>0){let I=6.28318530717958*this._sd.frequency,G=this._sd.dampingRatio;G<y.common.Setting.minSpringDamperDampingRatio&&(G=y.common.Setting.minSpringDamperDampingRatio);let D=e.dt,et=2*G*I,$=I*I;this._sd.useSymplecticEuler?(r=1/(D*et),_=$/et):(r=1/(D*(D*$+et)),_=$/(D*$+et)),r*=this._b1._invMass+this._b2._invMass}else r=0,_=this.getErp(e,i);let a,l,h;a=n*_,l=s*_,h=o*_;let m,f,p,d,u,g,v,x,b,Y,w,Z,X,M,z,T,F,P;m=0,f=-this._relativeAnchor1Z,p=this._relativeAnchor1Y,d=this._relativeAnchor1Z,u=0,g=-this._relativeAnchor1X,v=-this._relativeAnchor1Y,x=this._relativeAnchor1X,b=0,Y=0,w=-this._relativeAnchor2Z,Z=this._relativeAnchor2Y,X=this._relativeAnchor2Z,M=0,z=-this._relativeAnchor2X,T=-this._relativeAnchor2Y,F=this._relativeAnchor2X,P=0,m=-m,f=-f,p=-p,d=-d,u=-u,g=-g,v=-v,x=-x,b=-b,Y=-Y,w=-w,Z=-Z,X=-X,M=-M,z=-z,T=-T,F=-F,P=-P;let A=this._impulses[0],L=t.rows[t.numRows++],S=L.jacobian;S.lin1X=0,S.lin1Y=0,S.lin1Z=0,S.lin2X=0,S.lin2Y=0,S.lin2Z=0,S.ang1X=0,S.ang1Y=0,S.ang1Z=0,S.ang2X=0,S.ang2Y=0,S.ang2Z=0,L.rhs=0,L.cfm=0,L.minImpulse=0,L.maxImpulse=0,L.motorSpeed=0,L.motorMaxImpulse=0,L.impulse=null,L.impulse=A,L.rhs=a,L.cfm=r,L.minImpulse=-1/0,L.maxImpulse=1/0;let R=L.jacobian;R.lin1X=1,R.lin1Y=0,R.lin1Z=0,R.lin2X=1,R.lin2Y=0,R.lin2Z=0,R.ang1X=m,R.ang1Y=f,R.ang1Z=p,R.ang2X=Y,R.ang2Y=w,R.ang2Z=Z;let E=this._impulses[1],C=t.rows[t.numRows++],k=C.jacobian;k.lin1X=0,k.lin1Y=0,k.lin1Z=0,k.lin2X=0,k.lin2Y=0,k.lin2Z=0,k.ang1X=0,k.ang1Y=0,k.ang1Z=0,k.ang2X=0,k.ang2Y=0,k.ang2Z=0,C.rhs=0,C.cfm=0,C.minImpulse=0,C.maxImpulse=0,C.motorSpeed=0,C.motorMaxImpulse=0,C.impulse=null,C.impulse=E,C.rhs=l,C.cfm=r,C.minImpulse=-1/0,C.maxImpulse=1/0,R=C.jacobian,R.lin1X=0,R.lin1Y=1,R.lin1Z=0,R.lin2X=0,R.lin2Y=1,R.lin2Z=0,R.ang1X=d,R.ang1Y=u,R.ang1Z=g,R.ang2X=X,R.ang2Y=M,R.ang2Z=z;let V=this._impulses[2],B=t.rows[t.numRows++],J=B.jacobian;J.lin1X=0,J.lin1Y=0,J.lin1Z=0,J.lin2X=0,J.lin2Y=0,J.lin2Z=0,J.ang1X=0,J.ang1Y=0,J.ang1Z=0,J.ang2X=0,J.ang2Y=0,J.ang2Z=0,B.rhs=0,B.cfm=0,B.minImpulse=0,B.maxImpulse=0,B.motorSpeed=0,B.motorMaxImpulse=0,B.impulse=null,B.impulse=V,B.rhs=h,B.cfm=r,B.minImpulse=-1/0,B.maxImpulse=1/0,R=B.jacobian,R.lin1X=0,R.lin1Y=0,R.lin1Z=1,R.lin2X=0,R.lin2Y=0,R.lin2Z=1,R.ang1X=v,R.ang1Y=x,R.ang1Z=b,R.ang2X=T,R.ang2Y=F,R.ang2Z=P}_getVelocitySolverInfo(t,e){super._getVelocitySolverInfo(t,e),this.getInfo(e,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getSpringDamper(){return this._sd}};y.dynamics.constraint.joint.SphericalJointConfig=class extends y.dynamics.constraint.joint.JointConfig{constructor(){super(),this.springDamper=new y.dynamics.constraint.joint.SpringDamper}init(t,e,i){return this._init(t,e,i),this}};y.dynamics.constraint.joint.SpringDamper=class{constructor(){this.frequency=0,this.dampingRatio=0,this.useSymplecticEuler=!1}setSpring(t,e){return this.frequency=t,this.dampingRatio=e,this}setSymplecticEuler(t){return this.useSymplecticEuler=t,this}clone(){let t=new y.dynamics.constraint.joint.SpringDamper;return t.frequency=this.frequency,t.dampingRatio=this.dampingRatio,t.useSymplecticEuler=this.useSymplecticEuler,t}};y.dynamics.constraint.joint.TranslationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorForce=0}setLimits(t,e){return this.lowerLimit=t,this.upperLimit=e,this}setMotor(t,e){return this.motorSpeed=t,this.motorForce=e,this}clone(){let t=new y.dynamics.constraint.joint.TranslationalLimitMotor;return t.lowerLimit=this.lowerLimit,t.upperLimit=this.upperLimit,t.motorSpeed=this.motorSpeed,t.motorForce=this.motorForce,t}};y.dynamics.constraint.joint.UniversalJoint=class extends y.dynamics.constraint.joint.Joint{constructor(t){super(t,y.dynamics.constraint.joint.JointType.UNIVERSAL);let e=t.localAxis1;this._localBasisX1X=e.x,this._localBasisX1Y=e.y,this._localBasisX1Z=e.z;let i=t.localAxis2;this._localBasisZ2X=i.x,this._localBasisZ2Y=i.y,this._localBasisZ2Z=i.z,this.buildLocalBasesFromX1Z2(),this._angleX=0,this._angleY=0,this._angleZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1,this._sd1=t.springDamper1.clone(),this._sd2=t.springDamper2.clone(),this._lm1=t.limitMotor1.clone(),this._lm2=t.limitMotor2.clone()}getInfo(t,e,i){let n=this.getErp(e,i),s,o,r;s=this.linearErrorX*n,o=this.linearErrorY*n,r=this.linearErrorZ*n;let _=this._angleY*n,a,l,h,m,f,p,d,u,g,v,x,b,Y,w,Z,X,M,z;a=0,l=-this._relativeAnchor1Z,h=this._relativeAnchor1Y,m=this._relativeAnchor1Z,f=0,p=-this._relativeAnchor1X,d=-this._relativeAnchor1Y,u=this._relativeAnchor1X,g=0,v=0,x=-this._relativeAnchor2Z,b=this._relativeAnchor2Y,Y=this._relativeAnchor2Z,w=0,Z=-this._relativeAnchor2X,X=-this._relativeAnchor2Y,M=this._relativeAnchor2X,z=0,a=-a,l=-l,h=-h,m=-m,f=-f,p=-p,d=-d,u=-u,g=-g,v=-v,x=-x,b=-b,Y=-Y,w=-w,Z=-Z,X=-X,M=-M,z=-z;let T=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),F=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ),P=this._impulses[0],A=t.rows[t.numRows++],L=A.jacobian;L.lin1X=0,L.lin1Y=0,L.lin1Z=0,L.lin2X=0,L.lin2Y=0,L.lin2Z=0,L.ang1X=0,L.ang1Y=0,L.ang1Z=0,L.ang2X=0,L.ang2Y=0,L.ang2Z=0,A.rhs=0,A.cfm=0,A.minImpulse=0,A.maxImpulse=0,A.motorSpeed=0,A.motorMaxImpulse=0,A.impulse=null,A.impulse=P,A.rhs=s,A.cfm=0,A.minImpulse=-1/0,A.maxImpulse=1/0;let S=A.jacobian;S.lin1X=1,S.lin1Y=0,S.lin1Z=0,S.lin2X=1,S.lin2Y=0,S.lin2Z=0,S.ang1X=a,S.ang1Y=l,S.ang1Z=h,S.ang2X=v,S.ang2Y=x,S.ang2Z=b;let R=this._impulses[1],E=t.rows[t.numRows++],C=E.jacobian;C.lin1X=0,C.lin1Y=0,C.lin1Z=0,C.lin2X=0,C.lin2Y=0,C.lin2Z=0,C.ang1X=0,C.ang1Y=0,C.ang1Z=0,C.ang2X=0,C.ang2Y=0,C.ang2Z=0,E.rhs=0,E.cfm=0,E.minImpulse=0,E.maxImpulse=0,E.motorSpeed=0,E.motorMaxImpulse=0,E.impulse=null,E.impulse=R,E.rhs=o,E.cfm=0,E.minImpulse=-1/0,E.maxImpulse=1/0,S=E.jacobian,S.lin1X=0,S.lin1Y=1,S.lin1Z=0,S.lin2X=0,S.lin2Y=1,S.lin2Z=0,S.ang1X=m,S.ang1Y=f,S.ang1Z=p,S.ang2X=Y,S.ang2Y=w,S.ang2Z=Z;let k=this._impulses[2],V=t.rows[t.numRows++],B=V.jacobian;if(B.lin1X=0,B.lin1Y=0,B.lin1Z=0,B.lin2X=0,B.lin2Y=0,B.lin2Z=0,B.ang1X=0,B.ang1Y=0,B.ang1Z=0,B.ang2X=0,B.ang2Y=0,B.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=k,V.rhs=r,V.cfm=0,V.minImpulse=-1/0,V.maxImpulse=1/0,S=V.jacobian,S.lin1X=0,S.lin1Y=0,S.lin1Z=1,S.lin2X=0,S.lin2Y=0,S.lin2Z=1,S.ang1X=d,S.ang1Y=u,S.ang1Z=g,S.ang2X=X,S.ang2Y=M,S.ang2Z=z,!this.xSingular&&(this._sd1.frequency<=0||!i)){let J=this._impulses[3],I=t.rows[t.numRows++],G=I.jacobian;G.lin1X=0,G.lin1Y=0,G.lin1Z=0,G.lin2X=0,G.lin2Y=0,G.lin2Z=0,G.ang1X=0,G.ang1Y=0,G.ang1Z=0,G.ang2X=0,G.ang2Y=0,G.ang2Z=0,I.rhs=0,I.cfm=0,I.minImpulse=0,I.maxImpulse=0,I.motorSpeed=0,I.motorMaxImpulse=0,I.impulse=null,I.impulse=J,this.setSolverInfoRowAngular(I,this._angleX,this._lm1,T,this._sd1,e,i),S=I.jacobian,S.ang1X=this._axisXX,S.ang1Y=this._axisXY,S.ang1Z=this._axisXZ,S.ang2X=this._axisXX,S.ang2Y=this._axisXY,S.ang2Z=this._axisXZ}if(!this.ySingular){let J=this._impulses[4],I=t.rows[t.numRows++],G=I.jacobian;G.lin1X=0,G.lin1Y=0,G.lin1Z=0,G.lin2X=0,G.lin2Y=0,G.lin2Z=0,G.ang1X=0,G.ang1Y=0,G.ang1Z=0,G.ang2X=0,G.ang2Y=0,G.ang2Z=0,I.rhs=0,I.cfm=0,I.minImpulse=0,I.maxImpulse=0,I.motorSpeed=0,I.motorMaxImpulse=0,I.impulse=null,I.impulse=J,I.rhs=_,I.cfm=0,I.minImpulse=-1/0,I.maxImpulse=1/0,S=I.jacobian,S.ang1X=this._axisYX,S.ang1Y=this._axisYY,S.ang1Z=this._axisYZ,S.ang2X=this._axisYX,S.ang2Y=this._axisYY,S.ang2Z=this._axisYZ}if(!this.zSingular&&(this._sd2.frequency<=0||!i)){let J=this._impulses[5],I=t.rows[t.numRows++],G=I.jacobian;G.lin1X=0,G.lin1Y=0,G.lin1Z=0,G.lin2X=0,G.lin2Y=0,G.lin2Z=0,G.ang1X=0,G.ang1Y=0,G.ang1Z=0,G.ang2X=0,G.ang2Y=0,G.ang2Z=0,I.rhs=0,I.cfm=0,I.minImpulse=0,I.maxImpulse=0,I.motorSpeed=0,I.motorMaxImpulse=0,I.impulse=null,I.impulse=J,this.setSolverInfoRowAngular(I,this._angleZ,this._lm2,F,this._sd2,e,i),S=I.jacobian,S.ang1X=this._axisZX,S.ang1Y=this._axisZY,S.ang1Z=this._axisZZ,S.ang2X=this._axisZX,S.ang2Y=this._axisZY,S.ang2Z=this._axisZZ}}_syncAnchors(){super._syncAnchors();let t,e,i,n,s,o,r,_,a;t=this._basisX1X,e=this._basisX1Y,i=this._basisX1Z,r=this._basisZ2X,_=this._basisZ2Y,a=this._basisZ2Z,n=_*i-a*e,s=a*t-r*i,o=r*e-_*t,this._axisXX=s*a-o*_,this._axisXY=o*r-n*a,this._axisXZ=n*_-s*r,this._axisYX=n,this._axisYY=s,this._axisYZ=o,this._axisZX=e*o-i*s,this._axisZY=i*n-t*o,this._axisZZ=t*s-e*n;let l=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;l>0&&(l=1/Math.sqrt(l)),this._axisXX*=l,this._axisXY*=l,this._axisXZ*=l;let h=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;h>0&&(h=1/Math.sqrt(h)),this._axisYX*=h,this._axisYY*=h,this._axisYZ*=h;let m=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;m>0&&(m=1/Math.sqrt(m)),this._axisZX*=m,this._axisZY*=m,this._axisZZ*=m,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0;let f,p,d,u,g,v,x,b,Y,w,Z,X,M,z,T,F,P,A;f=this._basisX1X,p=this._basisY1X,d=this._basisZ1X,u=this._basisX1Y,g=this._basisY1Y,v=this._basisZ1Y,x=this._basisX1Z,b=this._basisY1Z,Y=this._basisZ1Z,w=this._basisX2X,Z=this._basisY2X,X=this._basisZ2X,M=this._basisX2Y,z=this._basisY2Y,T=this._basisZ2Y,F=this._basisX2Z,P=this._basisY2Z,A=this._basisZ2Z;let L,S,R,E,C,k,V,B,J,I,G,D,et,$;B=f*w+u*M+x*F,J=f*Z+u*z+x*P,I=f*X+u*T+x*A,G=p*Z+g*z+b*P,D=p*X+g*T+b*A,et=d*Z+v*z+Y*P,$=d*X+v*T+Y*A,L=B,S=J,R=I,E=G,C=D,k=et,V=$;let j,q,tt,W=R;if(W<=-1){let U=Math.atan2(k,E);j=U*.5,q=-1.570796326794895,tt=-U*.5}else if(W>=1){let U=Math.atan2(k,E);j=U*.5,q=1.570796326794895,tt=U*.5}else j=Math.atan2(-C,V),q=Math.asin(W),tt=Math.atan2(-S,L);this._angleX=j,this._angleY=q,this._angleZ=tt,this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,e){super._getVelocitySolverInfo(t,e),this.getInfo(e,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new y.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new y.common.Vec3;return t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z}getLocalAxis1(){let t=new y.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new y.common.Vec3;return t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z}getSpringDamper1(){return this._sd1}getSpringDamper2(){return this._sd2}getLimitMotor1(){return this._lm1}getLimitMotor2(){return this._lm2}getAngle1(){return this._angleX}getAngle2(){return this._angleZ}};y.dynamics.constraint.joint.UniversalJointConfig=class extends y.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new y.common.Vec3(1,0,0),this.localAxis2=new y.common.Vec3(1,0,0),this.springDamper1=new y.dynamics.constraint.joint.SpringDamper,this.springDamper2=new y.dynamics.constraint.joint.SpringDamper,this.limitMotor1=new y.dynamics.constraint.joint.RotationalLimitMotor,this.limitMotor2=new y.dynamics.constraint.joint.RotationalLimitMotor}init(t,e,i,n,s){this._init(t,e,i);let o=this.localAxis1,r,_,a;r=n.x,_=n.y,a=n.z;let l,h,m;l=t._transform._rotation00*r+t._transform._rotation10*_+t._transform._rotation20*a,h=t._transform._rotation01*r+t._transform._rotation11*_+t._transform._rotation21*a,m=t._transform._rotation02*r+t._transform._rotation12*_+t._transform._rotation22*a,r=l,_=h,a=m,o.x=r,o.y=_,o.z=a;let f=this.localAxis2,p,d,u;p=s.x,d=s.y,u=s.z;let g,v,x;return g=e._transform._rotation00*p+e._transform._rotation10*d+e._transform._rotation20*u,v=e._transform._rotation01*p+e._transform._rotation11*d+e._transform._rotation21*u,x=e._transform._rotation02*p+e._transform._rotation12*d+e._transform._rotation22*u,p=g,d=v,u=x,f.x=p,f.y=d,f.z=u,this}};y.dynamics.constraint.solver||(y.dynamics.constraint.solver={});y.dynamics.constraint.solver.ConstraintSolverType=class{};y.dynamics.constraint.solver.common||(y.dynamics.constraint.solver.common={});y.dynamics.constraint.solver.common.ContactSolverMassDataRow=class{constructor(){this.invMLinN1X=0,this.invMLinN1Y=0,this.invMLinN1Z=0,this.invMLinN2X=0,this.invMLinN2Y=0,this.invMLinN2Z=0,this.invMAngN1X=0,this.invMAngN1Y=0,this.invMAngN1Z=0,this.invMAngN2X=0,this.invMAngN2Y=0,this.invMAngN2Z=0,this.invMLinT1X=0,this.invMLinT1Y=0,this.invMLinT1Z=0,this.invMLinT2X=0,this.invMLinT2Y=0,this.invMLinT2Z=0,this.invMAngT1X=0,this.invMAngT1Y=0,this.invMAngT1Z=0,this.invMAngT2X=0,this.invMAngT2Y=0,this.invMAngT2Z=0,this.invMLinB1X=0,this.invMLinB1Y=0,this.invMLinB1Z=0,this.invMLinB2X=0,this.invMLinB2Y=0,this.invMLinB2Z=0,this.invMAngB1X=0,this.invMAngB1Y=0,this.invMAngB1Z=0,this.invMAngB2X=0,this.invMAngB2Y=0,this.invMAngB2Z=0,this.massN=0,this.massTB00=0,this.massTB01=0,this.massTB10=0,this.massTB11=0}};y.dynamics.constraint.solver.common.JointSolverMassDataRow=class{constructor(){this.invMLin1X=0,this.invMLin1Y=0,this.invMLin1Z=0,this.invMLin2X=0,this.invMLin2Y=0,this.invMLin2Z=0,this.invMAng1X=0,this.invMAng1Y=0,this.invMAng1Z=0,this.invMAng2X=0,this.invMAng2Y=0,this.invMAng2Z=0,this.mass=0,this.massWithoutCfm=0}};y.dynamics.constraint.solver.direct||(y.dynamics.constraint.solver.direct={});y.dynamics.constraint.solver.direct.Boundary=class{constructor(t){this.iBounded=new Array(t),this.iUnbounded=new Array(t),this.signs=new Array(t),this.b=new Array(t),this.numBounded=0,this.numUnbounded=0,this.matrixId=0}init(t){this.numBounded=t.numBounded;let e=0,i=this.numBounded;for(;e<i;){let o=e++;this.iBounded[o]=t.iBounded[o],this.signs[o]=t.signs[o]}this.numUnbounded=t.numUnbounded,this.matrixId=0;let n=0,s=this.numUnbounded;for(;n<s;){let o=n++,r=t.iUnbounded[o];this.iUnbounded[o]=r,this.matrixId|=1<<r}}computeImpulses(t,e,i,n,s,o,r){let _=0,a=this.numUnbounded;for(;_<a;){let Z=this.iUnbounded[_++],X=t.rows[Z];this.b[Z]=X.rhs*o-i[Z]-X.cfm*n[Z]}let l=e._invMassWithoutCfm,h=0,m=this.numBounded;for(;h<m;){let Z=h++,X=this.iBounded[Z],M=this.signs[Z],z=t.rows[X],T=(M<0?z.minImpulse:M>0?z.maxImpulse:0)-n[X];if(s[X]=T,T!=0){let F=0,P=this.numUnbounded;for(;F<P;){let A=this.iUnbounded[F++];this.b[A]-=l[X][A]*T}}}let f=this.iUnbounded,p=this.numUnbounded,d=0,u=0;for(;u<p;)d|=1<<f[u++];let g;e._cacheComputed[d]||(e.computeSubmatrix(d,f,p),e._cacheComputed[d]=!0),g=e._cachedSubmatrices[d];let v=!0,x=0,b=this.numUnbounded;for(;x<b;){let Z=x++,X=this.iUnbounded[Z],M=t.rows[X],z=n[X],T=z,F=0,P=this.numUnbounded;for(;F<P;){let A=F++;T+=this.b[this.iUnbounded[A]]*g[Z][A]}if(T<M.minImpulse-y.common.Setting.directMlcpSolverEps||T>M.maxImpulse+y.common.Setting.directMlcpSolverEps){v=!1;break}s[X]=T-z}if(r)return!0;if(!v)return!1;let Y=0,w=this.numBounded;for(;Y<w;){let Z=Y++,X=this.iBounded[Z],M=t.rows[X],z=this.signs[Z],T=0,F=n[X]+s[X],P=i[X],A=0,L=t.numRows;for(;A<L;){let S=A++;P+=l[X][S]*s[S]}if(T=M.rhs*o-P-M.cfm*F,z<0&&T>y.common.Setting.directMlcpSolverEps||z>0&&T<-y.common.Setting.directMlcpSolverEps){v=!1;break}}return v}};y.dynamics.constraint.solver.direct.BoundaryBuildInfo=class{constructor(t){this.size=t,this.numBounded=0,this.iBounded=new Array(t),this.signs=new Array(t),this.numUnbounded=0,this.iUnbounded=new Array(t)}};y.dynamics.constraint.solver.direct.BoundaryBuilder=class{constructor(t){this.maxRows=t,this.numBoundaries=0,this.boundaries=new Array(1<<t),this.bbInfo=new y.dynamics.constraint.solver.direct.BoundaryBuildInfo(t)}buildBoundariesRecursive(t,e){if(e==t.numRows){this.boundaries[this.numBoundaries]==null&&(this.boundaries[this.numBoundaries]=new y.dynamics.constraint.solver.direct.Boundary(this.maxRows)),this.boundaries[this.numBoundaries++].init(this.bbInfo);return}let i=t.rows[e],n=i.minImpulse>-1/0,s=i.maxImpulse<1/0;if(i.minImpulse==0&&i.maxImpulse==0){let r=this.bbInfo;r.iBounded[r.numBounded]=e,r.signs[r.numBounded]=0,r.numBounded++,this.buildBoundariesRecursive(t,e+1),this.bbInfo.numBounded--;return}let o=this.bbInfo;if(o.iUnbounded[o.numUnbounded]=e,o.numUnbounded++,this.buildBoundariesRecursive(t,e+1),this.bbInfo.numUnbounded--,n){let r=this.bbInfo;r.iBounded[r.numBounded]=e,r.signs[r.numBounded]=-1,r.numBounded++,this.buildBoundariesRecursive(t,e+1),this.bbInfo.numBounded--}if(s){let r=this.bbInfo;r.iBounded[r.numBounded]=e,r.signs[r.numBounded]=1,r.numBounded++,this.buildBoundariesRecursive(t,e+1),this.bbInfo.numBounded--}}buildBoundaries(t){this.numBoundaries=0;let e=this.bbInfo;e.numBounded=0,e.numUnbounded=0,this.buildBoundariesRecursive(t,0)}};y.dynamics.constraint.solver.direct.BoundarySelector=class{constructor(t){this.n=t,this.indices=new Array(t),this.tmpIndices=new Array(t);let e=0;for(;e<t;){let i=e++;this.indices[i]=i}}getIndex(t){return this.indices[t]}select(t){let e=0;for(;this.indices[e]!=t;)++e;for(;e>0;){let i=this.indices[e];this.indices[e]=this.indices[e-1],this.indices[e-1]=i,--e}}setSize(t){let e=0,i=0,n=0,s=this.n;for(;n<s;){let r=this.indices[n++];r<t?(this.tmpIndices[e]=r,++e):(this.tmpIndices[t+i]=r,++i)}let o=this.indices;this.indices=this.tmpIndices,this.tmpIndices=o}};y.dynamics.constraint.solver.direct.DirectJointConstraintSolver=class extends y.dynamics.constraint.ConstraintSolver{constructor(t){super(),this.joint=t,this.info=new y.dynamics.constraint.info.joint.JointSolverInfo;let e=y.common.Setting.maxJacobianRows;this.massMatrix=new y.dynamics.constraint.solver.direct.MassMatrix(e),this.boundaryBuilder=new y.dynamics.constraint.solver.direct.BoundaryBuilder(e),this.massData=new Array(e);let i=0,n=this.massData.length;for(;i<n;)this.massData[i++]=new y.dynamics.constraint.solver.common.JointSolverMassDataRow;let s=this.boundaryBuilder.boundaries.length;this.velBoundarySelector=new y.dynamics.constraint.solver.direct.BoundarySelector(s),this.posBoundarySelector=new y.dynamics.constraint.solver.direct.BoundarySelector(s),this.relVels=new Array(e),this.impulses=new Array(e),this.dImpulses=new Array(e),this.dTotalImpulses=new Array(e);let o=0;for(;o<e;){let r=o++;this.relVels[r]=0,this.impulses[r]=0,this.dImpulses[r]=0,this.dTotalImpulses[r]=0}}preSolveVelocity(t){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);let e=this.boundaryBuilder;e.numBoundaries=0;let i=e.bbInfo;i.numBounded=0,i.numUnbounded=0,e.buildBoundariesRecursive(this.info,0);let n=this.velBoundarySelector,s=this.boundaryBuilder.numBoundaries,o=0,r=0,_=0,a=n.n;for(;_<a;){let h=n.indices[_++];h<s?(n.tmpIndices[o]=h,++o):(n.tmpIndices[s+r]=h,++r)}let l=n.indices;n.indices=n.tmpIndices,n.tmpIndices=l}warmStart(t){let e=this.joint._positionCorrectionAlgorithm==y.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?y.common.Setting.jointWarmStartingFactorForBaungarte:y.common.Setting.jointWarmStartingFactor;if(e*=t.dtRatio,e<=0){let w=0,Z=this.info.numRows;for(;w<Z;){let X=this.info.rows[w++].impulse;X.impulse=0,X.impulseM=0,X.impulseP=0}return}let i=0,n=this.info.numRows;for(;i<n;){let w=i++,Z=this.info.rows[w],X=Z.impulse,M=X.impulse*e;if(M<Z.minImpulse?M=Z.minImpulse:M>Z.maxImpulse&&(M=Z.maxImpulse),X.impulse=M,Z.motorMaxImpulse>0){let z=X.impulseM*e,T=Z.motorMaxImpulse;z<-T?z=-T:z>T&&(z=T),X.impulseM=z}else X.impulseM=0;this.dImpulses[w]=X.impulse+X.impulseM}let s=this.dImpulses,o=!1,r=!1,_,a,l,h,m,f,p,d,u,g,v,x;_=this._b1._velX,a=this._b1._velY,l=this._b1._velZ,h=this._b2._velX,m=this._b2._velY,f=this._b2._velZ,p=this._b1._angVelX,d=this._b1._angVelY,u=this._b1._angVelZ,g=this._b2._angVelX,v=this._b2._angVelY,x=this._b2._angVelZ;let b=0,Y=this.info.numRows;for(;b<Y;){let w=b++,Z=this.info.rows[w].jacobian,X=this.massData[w],M=s[w];(Z.flag&1)!=0&&(_+=X.invMLin1X*M,a+=X.invMLin1Y*M,l+=X.invMLin1Z*M,h+=X.invMLin2X*-M,m+=X.invMLin2Y*-M,f+=X.invMLin2Z*-M,o=!0),(Z.flag&2)!=0&&(p+=X.invMAng1X*M,d+=X.invMAng1Y*M,u+=X.invMAng1Z*M,g+=X.invMAng2X*-M,v+=X.invMAng2Y*-M,x+=X.invMAng2Z*-M,r=!0)}o&&(this._b1._velX=_,this._b1._velY=a,this._b1._velZ=l,this._b2._velX=h,this._b2._velY=m,this._b2._velZ=f),r&&(this._b1._angVelX=p,this._b1._angVelY=d,this._b1._angVelZ=u,this._b2._angVelX=g,this._b2._angVelY=v,this._b2._angVelZ=x)}solveVelocity(){let t=this.info.numRows,e,i,n,s,o,r,_,a,l,h,m,f;e=this._b1._velX,i=this._b1._velY,n=this._b1._velZ,s=this._b2._velX,o=this._b2._velY,r=this._b2._velZ,_=this._b1._angVelX,a=this._b1._angVelY,l=this._b1._angVelZ,h=this._b2._angVelX,m=this._b2._angVelY,f=this._b2._angVelZ;let p=0;for(;p<t;){let b=p++,Y=this.info.rows[b],w=Y.jacobian,Z=0;Z+=e*w.lin1X+i*w.lin1Y+n*w.lin1Z,Z-=s*w.lin2X+o*w.lin2Y+r*w.lin2Z,Z+=_*w.ang1X+a*w.ang1Y+l*w.ang1Z,Z-=h*w.ang2X+m*w.ang2Y+f*w.ang2Z,this.relVels[b]=Z,this.impulses[b]=Y.impulse.impulse,this.dTotalImpulses[b]=0}let d=this.massMatrix._invMassWithoutCfm,u=0;for(;u<t;){let b=u++,Y=this.info.rows[b],w=Y.impulse;if(Y.motorMaxImpulse>0){let Z=w.impulseM,X=Z+this.massData[b].massWithoutCfm*(-Y.motorSpeed-this.relVels[b]),M=Y.motorMaxImpulse;X<-M?X=-M:X>M&&(X=M),w.impulseM=X;let z=X-Z;this.dTotalImpulses[b]=z;let T=0;for(;T<t;){let F=T++;this.relVels[F]+=z*d[b][F]}}}let g=!1,v=0,x=this.boundaryBuilder.numBoundaries;for(;v<x;){let b=this.velBoundarySelector.indices[v++];if(this.boundaryBuilder.boundaries[b].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,1,!1)){let Y=0;for(;Y<t;){let G=Y++,D=this.dImpulses[G];this.info.rows[G].impulse.impulse+=D,this.dTotalImpulses[G]+=D}let w=this.dTotalImpulses,Z=!1,X=!1,M,z,T,F,P,A,L,S,R,E,C,k;M=this._b1._velX,z=this._b1._velY,T=this._b1._velZ,F=this._b2._velX,P=this._b2._velY,A=this._b2._velZ,L=this._b1._angVelX,S=this._b1._angVelY,R=this._b1._angVelZ,E=this._b2._angVelX,C=this._b2._angVelY,k=this._b2._angVelZ;let V=0,B=this.info.numRows;for(;V<B;){let G=V++,D=this.info.rows[G].jacobian,et=this.massData[G],$=w[G];(D.flag&1)!=0&&(M+=et.invMLin1X*$,z+=et.invMLin1Y*$,T+=et.invMLin1Z*$,F+=et.invMLin2X*-$,P+=et.invMLin2Y*-$,A+=et.invMLin2Z*-$,Z=!0),(D.flag&2)!=0&&(L+=et.invMAng1X*$,S+=et.invMAng1Y*$,R+=et.invMAng1Z*$,E+=et.invMAng2X*-$,C+=et.invMAng2Y*-$,k+=et.invMAng2Z*-$,X=!0)}Z&&(this._b1._velX=M,this._b1._velY=z,this._b1._velZ=T,this._b2._velX=F,this._b2._velY=P,this._b2._velZ=A),X&&(this._b1._angVelX=L,this._b1._angVelY=S,this._b1._angVelZ=R,this._b2._angVelX=E,this._b2._angVelY=C,this._b2._angVelZ=k);let J=this.velBoundarySelector,I=0;for(;J.indices[I]!=b;)++I;for(;I>0;){let G=J.indices[I];J.indices[I]=J.indices[I-1],J.indices[I-1]=G,--I}g=!0;break}}if(!g){console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:335:","could not find solution. (velocity)");return}}postSolveVelocity(t){let e,i,n,s,o,r;e=0,i=0,n=0,s=0,o=0,r=0;let _=0,a=this.info.numRows;for(;_<a;){let l=this.info.rows[_++],h=l.impulse,m=l.jacobian;(m.flag&1)!=0?(e+=m.lin1X*h.impulse,i+=m.lin1Y*h.impulse,n+=m.lin1Z*h.impulse):(m.flag&2)!=0&&(s+=m.ang1X*h.impulse,o+=m.ang1Y*h.impulse,r+=m.ang1Z*h.impulse)}this.joint._appliedForceX=e*t.invDt,this.joint._appliedForceY=i*t.invDt,this.joint._appliedForceZ=n*t.invDt,this.joint._appliedTorqueX=s*t.invDt,this.joint._appliedTorqueY=o*t.invDt,this.joint._appliedTorqueZ=r*t.invDt}preSolvePosition(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);let e=this.boundaryBuilder;e.numBoundaries=0;let i=e.bbInfo;i.numBounded=0,i.numUnbounded=0,e.buildBoundariesRecursive(this.info,0);let n=this.posBoundarySelector,s=this.boundaryBuilder.numBoundaries,o=0,r=0,_=0,a=n.n;for(;_<a;){let f=n.indices[_++];f<s?(n.tmpIndices[o]=f,++o):(n.tmpIndices[s+r]=f,++r)}let l=n.indices;n.indices=n.tmpIndices,n.tmpIndices=l;let h=0,m=this.info.numRows;for(;h<m;)this.info.rows[h++].impulse.impulseP=0}solvePositionSplitImpulse(){let t=this.info.numRows,e,i,n,s,o,r,_,a,l,h,m,f;e=this._b1._pseudoVelX,i=this._b1._pseudoVelY,n=this._b1._pseudoVelZ,s=this._b2._pseudoVelX,o=this._b2._pseudoVelY,r=this._b2._pseudoVelZ,_=this._b1._angPseudoVelX,a=this._b1._angPseudoVelY,l=this._b1._angPseudoVelZ,h=this._b2._angPseudoVelX,m=this._b2._angPseudoVelY,f=this._b2._angPseudoVelZ;let p=0;for(;p<t;){let v=p++,x=this.info.rows[v],b=x.jacobian,Y=0;Y+=e*b.lin1X+i*b.lin1Y+n*b.lin1Z,Y-=s*b.lin2X+o*b.lin2Y+r*b.lin2Z,Y+=_*b.ang1X+a*b.ang1Y+l*b.ang1Z,Y-=h*b.ang2X+m*b.ang2Y+f*b.ang2Z,this.relVels[v]=Y,this.impulses[v]=x.impulse.impulseP}let d=!1,u=0,g=this.boundaryBuilder.numBoundaries;for(;u<g;){let v=this.posBoundarySelector.indices[u++];if(this.boundaryBuilder.boundaries[v].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,y.common.Setting.positionSplitImpulseBaumgarte,!1)){let x=0;for(;x<t;){let J=x++;this.info.rows[J].impulse.impulseP+=this.dImpulses[J]}let b=this.dImpulses,Y=!1,w=!1,Z,X,M,z,T,F,P,A,L,S,R,E;Z=this._b1._pseudoVelX,X=this._b1._pseudoVelY,M=this._b1._pseudoVelZ,z=this._b2._pseudoVelX,T=this._b2._pseudoVelY,F=this._b2._pseudoVelZ,P=this._b1._angPseudoVelX,A=this._b1._angPseudoVelY,L=this._b1._angPseudoVelZ,S=this._b2._angPseudoVelX,R=this._b2._angPseudoVelY,E=this._b2._angPseudoVelZ;let C=0,k=this.info.numRows;for(;C<k;){let J=C++,I=this.info.rows[J].jacobian,G=this.massData[J],D=b[J];(I.flag&1)!=0&&(Z+=G.invMLin1X*D,X+=G.invMLin1Y*D,M+=G.invMLin1Z*D,z+=G.invMLin2X*-D,T+=G.invMLin2Y*-D,F+=G.invMLin2Z*-D,Y=!0),(I.flag&2)!=0&&(P+=G.invMAng1X*D,A+=G.invMAng1Y*D,L+=G.invMAng1Z*D,S+=G.invMAng2X*-D,R+=G.invMAng2Y*-D,E+=G.invMAng2Z*-D,w=!0)}Y&&(this._b1._pseudoVelX=Z,this._b1._pseudoVelY=X,this._b1._pseudoVelZ=M,this._b2._pseudoVelX=z,this._b2._pseudoVelY=T,this._b2._pseudoVelZ=F),w&&(this._b1._angPseudoVelX=P,this._b1._angPseudoVelY=A,this._b1._angPseudoVelZ=L,this._b2._angPseudoVelX=S,this._b2._angPseudoVelY=R,this._b2._angPseudoVelZ=E);let V=this.posBoundarySelector,B=0;for(;V.indices[B]!=v;)++B;for(;B>0;){let J=V.indices[B];V.indices[B]=V.indices[B-1],V.indices[B-1]=J,--B}d=!0;break}}if(!d){console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:450:","could not find solution. (split impulse)");return}}solvePositionNgs(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);let e=this.boundaryBuilder;e.numBoundaries=0;let i=e.bbInfo;i.numBounded=0,i.numUnbounded=0,e.buildBoundariesRecursive(this.info,0);let n=this.posBoundarySelector,s=this.boundaryBuilder.numBoundaries,o=0,r=0,_=0,a=n.n;for(;_<a;){let u=n.indices[_++];u<s?(n.tmpIndices[o]=u,++o):(n.tmpIndices[s+r]=u,++r)}let l=n.indices;n.indices=n.tmpIndices,n.tmpIndices=l;let h=this.info.numRows,m=0;for(;m<h;){let u=m++,g=this.info.rows[u].impulse;this.relVels[u]=0,this.impulses[u]=g.impulseP}let f=!1,p=0,d=this.boundaryBuilder.numBoundaries;for(;p<d;){let u=this.posBoundarySelector.indices[p++];if(this.boundaryBuilder.boundaries[u].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,y.common.Setting.positionNgsBaumgarte,!1)){let g=0;for(;g<h;){let V=g++;this.info.rows[V].impulse.impulseP+=this.dImpulses[V]}let v=this.dImpulses,x=!1,b=!1,Y,w,Z,X,M,z,T,F,P,A,L,S;Y=0,w=0,Z=0,X=0,M=0,z=0,T=0,F=0,P=0,A=0,L=0,S=0;let R=0,E=this.info.numRows;for(;R<E;){let V=R++,B=this.info.rows[V].jacobian,J=this.massData[V],I=v[V];(B.flag&1)!=0&&(Y+=J.invMLin1X*I,w+=J.invMLin1Y*I,Z+=J.invMLin1Z*I,X+=J.invMLin2X*-I,M+=J.invMLin2Y*-I,z+=J.invMLin2Z*-I,x=!0),(B.flag&2)!=0&&(T+=J.invMAng1X*I,F+=J.invMAng1Y*I,P+=J.invMAng1Z*I,A+=J.invMAng2X*-I,L+=J.invMAng2Y*-I,S+=J.invMAng2Z*-I,b=!0)}if(x){let V=this._b1;V._transform._positionX+=Y,V._transform._positionY+=w,V._transform._positionZ+=Z;let B=this._b2;B._transform._positionX+=X,B._transform._positionY+=M,B._transform._positionZ+=z}if(b){let V=this._b1,B=Math.sqrt(T*T+F*F+P*P),J=B*.5,I,G;if(J<.5){let ce=J*J;I=.5*(1-ce*.16666666666666666+ce*ce*.008333333333333333),G=1-ce*.5+ce*ce*.041666666666666664}else I=Math.sin(J)/B,G=Math.cos(J);let D,et,$;D=T*I,et=F*I,$=P*I;let j,q,tt,W;j=D,q=et,tt=$,W=G;let U,it,Q,at,ht=V._transform._rotation00,_t=V._transform._rotation11,mt=V._transform._rotation22,ft=ht+_t+mt,ut;ft>0?(ut=Math.sqrt(ft+1),at=.5*ut,ut=.5/ut,U=(V._transform._rotation21-V._transform._rotation12)*ut,it=(V._transform._rotation02-V._transform._rotation20)*ut,Q=(V._transform._rotation10-V._transform._rotation01)*ut):ht>_t?ht>mt?(ut=Math.sqrt(ht-_t-mt+1),U=.5*ut,ut=.5/ut,it=(V._transform._rotation01+V._transform._rotation10)*ut,Q=(V._transform._rotation02+V._transform._rotation20)*ut,at=(V._transform._rotation21-V._transform._rotation12)*ut):(ut=Math.sqrt(mt-ht-_t+1),Q=.5*ut,ut=.5/ut,U=(V._transform._rotation02+V._transform._rotation20)*ut,it=(V._transform._rotation12+V._transform._rotation21)*ut,at=(V._transform._rotation10-V._transform._rotation01)*ut):_t>mt?(ut=Math.sqrt(_t-mt-ht+1),it=.5*ut,ut=.5/ut,U=(V._transform._rotation01+V._transform._rotation10)*ut,Q=(V._transform._rotation12+V._transform._rotation21)*ut,at=(V._transform._rotation02-V._transform._rotation20)*ut):(ut=Math.sqrt(mt-ht-_t+1),Q=.5*ut,ut=.5/ut,U=(V._transform._rotation02+V._transform._rotation20)*ut,it=(V._transform._rotation12+V._transform._rotation21)*ut,at=(V._transform._rotation10-V._transform._rotation01)*ut),U=W*U+j*at+q*Q-tt*it,it=W*it-j*Q+q*at+tt*U,Q=W*Q+j*it-q*U+tt*at,at=W*at-j*U-q*it-tt*Q;let H=U*U+it*it+Q*Q+at*at;H>1e-32&&(H=1/Math.sqrt(H)),U*=H,it*=H,Q*=H,at*=H;let O=U,ot=it,pt=Q,vt=at,xt=2*O,Mt=2*ot,ct=2*pt,St=O*xt,It=ot*Mt,dt=pt*ct,K=O*Mt,lt=ot*ct,rt=O*ct,Vt=vt*xt,At=vt*Mt,Yt=vt*ct;V._transform._rotation00=1-It-dt,V._transform._rotation01=K-Yt,V._transform._rotation02=rt+At,V._transform._rotation10=K+Yt,V._transform._rotation11=1-St-dt,V._transform._rotation12=lt-Vt,V._transform._rotation20=rt-At,V._transform._rotation21=lt+Vt,V._transform._rotation22=1-St-It;let Xt,Nt,ie,ee,Ze,ze,pe,$t,Ht;Xt=V._transform._rotation00*V._invLocalInertia00+V._transform._rotation01*V._invLocalInertia10+V._transform._rotation02*V._invLocalInertia20,Nt=V._transform._rotation00*V._invLocalInertia01+V._transform._rotation01*V._invLocalInertia11+V._transform._rotation02*V._invLocalInertia21,ie=V._transform._rotation00*V._invLocalInertia02+V._transform._rotation01*V._invLocalInertia12+V._transform._rotation02*V._invLocalInertia22,ee=V._transform._rotation10*V._invLocalInertia00+V._transform._rotation11*V._invLocalInertia10+V._transform._rotation12*V._invLocalInertia20,Ze=V._transform._rotation10*V._invLocalInertia01+V._transform._rotation11*V._invLocalInertia11+V._transform._rotation12*V._invLocalInertia21,ze=V._transform._rotation10*V._invLocalInertia02+V._transform._rotation11*V._invLocalInertia12+V._transform._rotation12*V._invLocalInertia22,pe=V._transform._rotation20*V._invLocalInertia00+V._transform._rotation21*V._invLocalInertia10+V._transform._rotation22*V._invLocalInertia20,$t=V._transform._rotation20*V._invLocalInertia01+V._transform._rotation21*V._invLocalInertia11+V._transform._rotation22*V._invLocalInertia21,Ht=V._transform._rotation20*V._invLocalInertia02+V._transform._rotation21*V._invLocalInertia12+V._transform._rotation22*V._invLocalInertia22,V._invInertia00=Xt,V._invInertia01=Nt,V._invInertia02=ie,V._invInertia10=ee,V._invInertia11=Ze,V._invInertia12=ze,V._invInertia20=pe,V._invInertia21=$t,V._invInertia22=Ht;let ue,Ie,qe,Ee,Ut,nt,gt,yt,bt;ue=V._invInertia00*V._transform._rotation00+V._invInertia01*V._transform._rotation01+V._invInertia02*V._transform._rotation02,Ie=V._invInertia00*V._transform._rotation10+V._invInertia01*V._transform._rotation11+V._invInertia02*V._transform._rotation12,qe=V._invInertia00*V._transform._rotation20+V._invInertia01*V._transform._rotation21+V._invInertia02*V._transform._rotation22,Ee=V._invInertia10*V._transform._rotation00+V._invInertia11*V._transform._rotation01+V._invInertia12*V._transform._rotation02,Ut=V._invInertia10*V._transform._rotation10+V._invInertia11*V._transform._rotation11+V._invInertia12*V._transform._rotation12,nt=V._invInertia10*V._transform._rotation20+V._invInertia11*V._transform._rotation21+V._invInertia12*V._transform._rotation22,gt=V._invInertia20*V._transform._rotation00+V._invInertia21*V._transform._rotation01+V._invInertia22*V._transform._rotation02,yt=V._invInertia20*V._transform._rotation10+V._invInertia21*V._transform._rotation11+V._invInertia22*V._transform._rotation12,bt=V._invInertia20*V._transform._rotation20+V._invInertia21*V._transform._rotation21+V._invInertia22*V._transform._rotation22,V._invInertia00=ue,V._invInertia01=Ie,V._invInertia02=qe,V._invInertia10=Ee,V._invInertia11=Ut,V._invInertia12=nt,V._invInertia20=gt,V._invInertia21=yt,V._invInertia22=bt,V._invInertia00*=V._rotFactor.x,V._invInertia01*=V._rotFactor.x,V._invInertia02*=V._rotFactor.x,V._invInertia10*=V._rotFactor.y,V._invInertia11*=V._rotFactor.y,V._invInertia12*=V._rotFactor.y,V._invInertia20*=V._rotFactor.z,V._invInertia21*=V._rotFactor.z,V._invInertia22*=V._rotFactor.z;let st=this._b2,Pt=Math.sqrt(A*A+L*L+S*S),Dt=Pt*.5,N,kt;if(Dt<.5){let ce=Dt*Dt;N=.5*(1-ce*.16666666666666666+ce*ce*.008333333333333333),kt=1-ce*.5+ce*ce*.041666666666666664}else N=Math.sin(Dt)/Pt,kt=Math.cos(Dt);let Rt,Ot,Wt;Rt=A*N,Ot=L*N,Wt=S*N;let Bt,re,Ce,be;Bt=Rt,re=Ot,Ce=Wt,be=kt;let Tt,Lt,Zt,me,Me=st._transform._rotation00,fe=st._transform._rotation11,ti=st._transform._rotation22,di=Me+fe+ti,Le;di>0?(Le=Math.sqrt(di+1),me=.5*Le,Le=.5/Le,Tt=(st._transform._rotation21-st._transform._rotation12)*Le,Lt=(st._transform._rotation02-st._transform._rotation20)*Le,Zt=(st._transform._rotation10-st._transform._rotation01)*Le):Me>fe?Me>ti?(Le=Math.sqrt(Me-fe-ti+1),Tt=.5*Le,Le=.5/Le,Lt=(st._transform._rotation01+st._transform._rotation10)*Le,Zt=(st._transform._rotation02+st._transform._rotation20)*Le,me=(st._transform._rotation21-st._transform._rotation12)*Le):(Le=Math.sqrt(ti-Me-fe+1),Zt=.5*Le,Le=.5/Le,Tt=(st._transform._rotation02+st._transform._rotation20)*Le,Lt=(st._transform._rotation12+st._transform._rotation21)*Le,me=(st._transform._rotation10-st._transform._rotation01)*Le):fe>ti?(Le=Math.sqrt(fe-ti-Me+1),Lt=.5*Le,Le=.5/Le,Tt=(st._transform._rotation01+st._transform._rotation10)*Le,Zt=(st._transform._rotation12+st._transform._rotation21)*Le,me=(st._transform._rotation02-st._transform._rotation20)*Le):(Le=Math.sqrt(ti-Me-fe+1),Zt=.5*Le,Le=.5/Le,Tt=(st._transform._rotation02+st._transform._rotation20)*Le,Lt=(st._transform._rotation12+st._transform._rotation21)*Le,me=(st._transform._rotation10-st._transform._rotation01)*Le),Tt=be*Tt+Bt*me+re*Zt-Ce*Lt,Lt=be*Lt-Bt*Zt+re*me+Ce*Tt,Zt=be*Zt+Bt*Lt-re*Tt+Ce*me,me=be*me-Bt*Tt-re*Lt-Ce*Zt;let _i=Tt*Tt+Lt*Lt+Zt*Zt+me*me;_i>1e-32&&(_i=1/Math.sqrt(_i)),Tt*=_i,Lt*=_i,Zt*=_i,me*=_i;let yi=Tt,he=Lt,gi=Zt,bi=me,Mi=2*yi,Ii=2*he,He=2*gi,Je=yi*Mi,Ke=he*Ii,ci=gi*He,hi=yi*Ii,ei=he*He,ai=yi*He,Qe=bi*Mi,We=bi*Ii,ke=bi*He;st._transform._rotation00=1-Ke-ci,st._transform._rotation01=hi-ke,st._transform._rotation02=ai+We,st._transform._rotation10=hi+ke,st._transform._rotation11=1-Je-ci,st._transform._rotation12=ei-Qe,st._transform._rotation20=ai-We,st._transform._rotation21=ei+Qe,st._transform._rotation22=1-Je-Ke;let le,ge,jt,Ae,Se,Re,Te,Ne,se;le=st._transform._rotation00*st._invLocalInertia00+st._transform._rotation01*st._invLocalInertia10+st._transform._rotation02*st._invLocalInertia20,ge=st._transform._rotation00*st._invLocalInertia01+st._transform._rotation01*st._invLocalInertia11+st._transform._rotation02*st._invLocalInertia21,jt=st._transform._rotation00*st._invLocalInertia02+st._transform._rotation01*st._invLocalInertia12+st._transform._rotation02*st._invLocalInertia22,Ae=st._transform._rotation10*st._invLocalInertia00+st._transform._rotation11*st._invLocalInertia10+st._transform._rotation12*st._invLocalInertia20,Se=st._transform._rotation10*st._invLocalInertia01+st._transform._rotation11*st._invLocalInertia11+st._transform._rotation12*st._invLocalInertia21,Re=st._transform._rotation10*st._invLocalInertia02+st._transform._rotation11*st._invLocalInertia12+st._transform._rotation12*st._invLocalInertia22,Te=st._transform._rotation20*st._invLocalInertia00+st._transform._rotation21*st._invLocalInertia10+st._transform._rotation22*st._invLocalInertia20,Ne=st._transform._rotation20*st._invLocalInertia01+st._transform._rotation21*st._invLocalInertia11+st._transform._rotation22*st._invLocalInertia21,se=st._transform._rotation20*st._invLocalInertia02+st._transform._rotation21*st._invLocalInertia12+st._transform._rotation22*st._invLocalInertia22,st._invInertia00=le,st._invInertia01=ge,st._invInertia02=jt,st._invInertia10=Ae,st._invInertia11=Se,st._invInertia12=Re,st._invInertia20=Te,st._invInertia21=Ne,st._invInertia22=se;let Ct,Gt,Pe,Ve,Ue,ii,ri,ui,vi;Ct=st._invInertia00*st._transform._rotation00+st._invInertia01*st._transform._rotation01+st._invInertia02*st._transform._rotation02,Gt=st._invInertia00*st._transform._rotation10+st._invInertia01*st._transform._rotation11+st._invInertia02*st._transform._rotation12,Pe=st._invInertia00*st._transform._rotation20+st._invInertia01*st._transform._rotation21+st._invInertia02*st._transform._rotation22,Ve=st._invInertia10*st._transform._rotation00+st._invInertia11*st._transform._rotation01+st._invInertia12*st._transform._rotation02,Ue=st._invInertia10*st._transform._rotation10+st._invInertia11*st._transform._rotation11+st._invInertia12*st._transform._rotation12,ii=st._invInertia10*st._transform._rotation20+st._invInertia11*st._transform._rotation21+st._invInertia12*st._transform._rotation22,ri=st._invInertia20*st._transform._rotation00+st._invInertia21*st._transform._rotation01+st._invInertia22*st._transform._rotation02,ui=st._invInertia20*st._transform._rotation10+st._invInertia21*st._transform._rotation11+st._invInertia22*st._transform._rotation12,vi=st._invInertia20*st._transform._rotation20+st._invInertia21*st._transform._rotation21+st._invInertia22*st._transform._rotation22,st._invInertia00=Ct,st._invInertia01=Gt,st._invInertia02=Pe,st._invInertia10=Ve,st._invInertia11=Ue,st._invInertia12=ii,st._invInertia20=ri,st._invInertia21=ui,st._invInertia22=vi,st._invInertia00*=st._rotFactor.x,st._invInertia01*=st._rotFactor.x,st._invInertia02*=st._rotFactor.x,st._invInertia10*=st._rotFactor.y,st._invInertia11*=st._rotFactor.y,st._invInertia12*=st._rotFactor.y,st._invInertia20*=st._rotFactor.z,st._invInertia21*=st._rotFactor.z,st._invInertia22*=st._rotFactor.z}let C=this.posBoundarySelector,k=0;for(;C.indices[k]!=u;)++k;for(;k>0;){let V=C.indices[k];C.indices[k]=C.indices[k-1],C.indices[k-1]=V,--k}f=!0;break}}if(!f){console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:502:","could not find solution. (NGS)");return}}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}};y.dynamics.constraint.solver.direct.MassMatrix=class{constructor(t){this._size=t,this.tmpMatrix=new Array(this._size),this._invMass=new Array(this._size),this._invMassWithoutCfm=new Array(this._size);let e=0,i=this._size;for(;e<i;){let o=e++;this.tmpMatrix[o]=new Array(this._size),this._invMass[o]=new Array(this._size),this._invMassWithoutCfm[o]=new Array(this._size);let r=0,_=this._size;for(;r<_;){let a=r++;this.tmpMatrix[o][a]=0,this._invMass[o][a]=0,this._invMassWithoutCfm[o][a]=0}}this._maxSubmatrixId=1<<this._size,this._cacheComputed=new Array(this._maxSubmatrixId),this._cachedSubmatrices=new Array(this._maxSubmatrixId);let n=0,s=this._maxSubmatrixId;for(;n<s;){let o=n++,r;r=(o&85)+(o>>1&85),r=(r&51)+(r>>2&51),r=(r&15)+(r>>4&15);let _=r,a=new Array(_),l=0;for(;l<_;){let h=l++;a[h]=new Array(_);let m=0;for(;m<_;)a[h][m++]=0}this._cacheComputed[o]=!1,this._cachedSubmatrices[o]=a}}computeSubmatrix(t,e,i){let n=0;for(;n<i;){let m=n++,f=e[m],p=0;for(;p<i;){let d=p++;this.tmpMatrix[m][d]=this._invMass[f][e[d]]}}let s=this.tmpMatrix,o=this._cachedSubmatrices[t],r,_,a,l,h;switch(i){case 4:r=s[0],_=o[0],h=1/r[0],_[0]=h,r[1]*=h,r[2]*=h,r[3]*=h,a=s[1],l=o[1],l[0]=-h*a[0],a[1]-=r[1]*a[0],a[2]-=r[2]*a[0],a[3]-=r[3]*a[0],a=s[2],l=o[2],l[0]=-h*a[0],a[1]-=r[1]*a[0],a[2]-=r[2]*a[0],a[3]-=r[3]*a[0],a=s[3],l=o[3],l[0]=-h*a[0],a[1]-=r[1]*a[0],a[2]-=r[2]*a[0],a[3]-=r[3]*a[0],r=s[1],_=o[1],h=1/r[1],_[1]=h,_[0]*=h,r[2]*=h,r[3]*=h,a=s[0],l=o[0],l[0]-=_[0]*a[1],a[2]-=r[2]*a[1],a[3]-=r[3]*a[1],a=s[2],l=o[2],l[0]-=_[0]*a[1],l[1]=-h*a[1],a[2]-=r[2]*a[1],a[3]-=r[3]*a[1],a=s[3],l=o[3],l[0]-=_[0]*a[1],l[1]=-h*a[1],a[2]-=r[2]*a[1],a[3]-=r[3]*a[1],r=s[2],_=o[2],h=1/r[2],_[2]=h,_[0]*=h,_[1]*=h,r[3]*=h,a=s[0],l=o[0],l[0]-=_[0]*a[2],a[3]-=r[3]*a[2],a=s[1],l=o[1],l[0]-=_[0]*a[2],l[1]-=_[1]*a[2],a[3]-=r[3]*a[2],a=s[3],l=o[3],l[0]-=_[0]*a[2],l[1]-=_[1]*a[2],l[2]=-h*a[2],a[3]-=r[3]*a[2],r=s[3],_=o[3],h=1/r[3],_[3]=h,_[0]*=h,_[1]*=h,_[2]*=h,a=s[0],l=o[0],l[0]-=_[0]*a[3],a=s[1],l=o[1],l[0]-=_[0]*a[3],l[1]-=_[1]*a[3],a=s[2],l=o[2],l[0]-=_[0]*a[3],l[1]-=_[1]*a[3],l[2]-=_[2]*a[3],_=o[1],o[0][1]=_[0],_=o[2],o[0][2]=_[0],o[1][2]=_[1],_=o[3],o[0][3]=_[0],o[1][3]=_[1],o[2][3]=_[2];break;case 5:r=s[0],_=o[0],h=1/r[0],_[0]=h,r[1]*=h,r[2]*=h,r[3]*=h,r[4]*=h,a=s[1],l=o[1],l[0]=-h*a[0],a[1]-=r[1]*a[0],a[2]-=r[2]*a[0],a[3]-=r[3]*a[0],a[4]-=r[4]*a[0],a=s[2],l=o[2],l[0]=-h*a[0],a[1]-=r[1]*a[0],a[2]-=r[2]*a[0],a[3]-=r[3]*a[0],a[4]-=r[4]*a[0],a=s[3],l=o[3],l[0]=-h*a[0],a[1]-=r[1]*a[0],a[2]-=r[2]*a[0],a[3]-=r[3]*a[0],a[4]-=r[4]*a[0],a=s[4],l=o[4],l[0]=-h*a[0],a[1]-=r[1]*a[0],a[2]-=r[2]*a[0],a[3]-=r[3]*a[0],a[4]-=r[4]*a[0],r=s[1],_=o[1],h=1/r[1],_[1]=h,_[0]*=h,r[2]*=h,r[3]*=h,r[4]*=h,a=s[0],l=o[0],l[0]-=_[0]*a[1],a[2]-=r[2]*a[1],a[3]-=r[3]*a[1],a[4]-=r[4]*a[1],a=s[2],l=o[2],l[0]-=_[0]*a[1],l[1]=-h*a[1],a[2]-=r[2]*a[1],a[3]-=r[3]*a[1],a[4]-=r[4]*a[1],a=s[3],l=o[3],l[0]-=_[0]*a[1],l[1]=-h*a[1],a[2]-=r[2]*a[1],a[3]-=r[3]*a[1],a[4]-=r[4]*a[1],a=s[4],l=o[4],l[0]-=_[0]*a[1],l[1]=-h*a[1],a[2]-=r[2]*a[1],a[3]-=r[3]*a[1],a[4]-=r[4]*a[1],r=s[2],_=o[2],h=1/r[2],_[2]=h,_[0]*=h,_[1]*=h,r[3]*=h,r[4]*=h,a=s[0],l=o[0],l[0]-=_[0]*a[2],a[3]-=r[3]*a[2],a[4]-=r[4]*a[2],a=s[1],l=o[1],l[0]-=_[0]*a[2],l[1]-=_[1]*a[2],a[3]-=r[3]*a[2],a[4]-=r[4]*a[2],a=s[3],l=o[3],l[0]-=_[0]*a[2],l[1]-=_[1]*a[2],l[2]=-h*a[2],a[3]-=r[3]*a[2],a[4]-=r[4]*a[2],a=s[4],l=o[4],l[0]-=_[0]*a[2],l[1]-=_[1]*a[2],l[2]=-h*a[2],a[3]-=r[3]*a[2],a[4]-=r[4]*a[2],r=s[3],_=o[3],h=1/r[3],_[3]=h,_[0]*=h,_[1]*=h,_[2]*=h,r[4]*=h,a=s[0],l=o[0],l[0]-=_[0]*a[3],a[4]-=r[4]*a[3],a=s[1],l=o[1],l[0]-=_[0]*a[3],l[1]-=_[1]*a[3],a[4]-=r[4]*a[3],a=s[2],l=o[2],l[0]-=_[0]*a[3],l[1]-=_[1]*a[3],l[2]-=_[2]*a[3],a[4]-=r[4]*a[3],a=s[4],l=o[4],l[0]-=_[0]*a[3],l[1]-=_[1]*a[3],l[2]-=_[2]*a[3],l[3]=-h*a[3],a[4]-=r[4]*a[3],r=s[4],_=o[4],h=1/r[4],_[4]=h,_[0]*=h,_[1]*=h,_[2]*=h,_[3]*=h,a=s[0],l=o[0],l[0]-=_[0]*a[4],a=s[1],l=o[1],l[0]-=_[0]*a[4],l[1]-=_[1]*a[4],a=s[2],l=o[2],l[0]-=_[0]*a[4],l[1]-=_[1]*a[4],l[2]-=_[2]*a[4],a=s[3],l=o[3],l[0]-=_[0]*a[4],l[1]-=_[1]*a[4],l[2]-=_[2]*a[4],l[3]-=_[3]*a[4],_=o[1],o[0][1]=_[0],_=o[2],o[0][2]=_[0],o[1][2]=_[1],_=o[3],o[0][3]=_[0],o[1][3]=_[1],o[2][3]=_[2],_=o[4],o[0][4]=_[0],o[1][4]=_[1],o[2][4]=_[2],o[3][4]=_[3];break;case 6:r=s[0],_=o[0],h=1/r[0],_[0]=h,r[1]*=h,r[2]*=h,r[3]*=h,r[4]*=h,r[5]*=h,a=s[1],l=o[1],l[0]=-h*a[0],a[1]-=r[1]*a[0],a[2]-=r[2]*a[0],a[3]-=r[3]*a[0],a[4]-=r[4]*a[0],a[5]-=r[5]*a[0],a=s[2],l=o[2],l[0]=-h*a[0],a[1]-=r[1]*a[0],a[2]-=r[2]*a[0],a[3]-=r[3]*a[0],a[4]-=r[4]*a[0],a[5]-=r[5]*a[0],a=s[3],l=o[3],l[0]=-h*a[0],a[1]-=r[1]*a[0],a[2]-=r[2]*a[0],a[3]-=r[3]*a[0],a[4]-=r[4]*a[0],a[5]-=r[5]*a[0],a=s[4],l=o[4],l[0]=-h*a[0],a[1]-=r[1]*a[0],a[2]-=r[2]*a[0],a[3]-=r[3]*a[0],a[4]-=r[4]*a[0],a[5]-=r[5]*a[0],a=s[5],l=o[5],l[0]=-h*a[0],a[1]-=r[1]*a[0],a[2]-=r[2]*a[0],a[3]-=r[3]*a[0],a[4]-=r[4]*a[0],a[5]-=r[5]*a[0],r=s[1],_=o[1],h=1/r[1],_[1]=h,_[0]*=h,r[2]*=h,r[3]*=h,r[4]*=h,r[5]*=h,a=s[0],l=o[0],l[0]-=_[0]*a[1],a[2]-=r[2]*a[1],a[3]-=r[3]*a[1],a[4]-=r[4]*a[1],a[5]-=r[5]*a[1],a=s[2],l=o[2],l[0]-=_[0]*a[1],l[1]=-h*a[1],a[2]-=r[2]*a[1],a[3]-=r[3]*a[1],a[4]-=r[4]*a[1],a[5]-=r[5]*a[1],a=s[3],l=o[3],l[0]-=_[0]*a[1],l[1]=-h*a[1],a[2]-=r[2]*a[1],a[3]-=r[3]*a[1],a[4]-=r[4]*a[1],a[5]-=r[5]*a[1],a=s[4],l=o[4],l[0]-=_[0]*a[1],l[1]=-h*a[1],a[2]-=r[2]*a[1],a[3]-=r[3]*a[1],a[4]-=r[4]*a[1],a[5]-=r[5]*a[1],a=s[5],l=o[5],l[0]-=_[0]*a[1],l[1]=-h*a[1],a[2]-=r[2]*a[1],a[3]-=r[3]*a[1],a[4]-=r[4]*a[1],a[5]-=r[5]*a[1],r=s[2],_=o[2],h=1/r[2],_[2]=h,_[0]*=h,_[1]*=h,r[3]*=h,r[4]*=h,r[5]*=h,a=s[0],l=o[0],l[0]-=_[0]*a[2],a[3]-=r[3]*a[2],a[4]-=r[4]*a[2],a[5]-=r[5]*a[2],a=s[1],l=o[1],l[0]-=_[0]*a[2],l[1]-=_[1]*a[2],a[3]-=r[3]*a[2],a[4]-=r[4]*a[2],a[5]-=r[5]*a[2],a=s[3],l=o[3],l[0]-=_[0]*a[2],l[1]-=_[1]*a[2],l[2]=-h*a[2],a[3]-=r[3]*a[2],a[4]-=r[4]*a[2],a[5]-=r[5]*a[2],a=s[4],l=o[4],l[0]-=_[0]*a[2],l[1]-=_[1]*a[2],l[2]=-h*a[2],a[3]-=r[3]*a[2],a[4]-=r[4]*a[2],a[5]-=r[5]*a[2],a=s[5],l=o[5],l[0]-=_[0]*a[2],l[1]-=_[1]*a[2],l[2]=-h*a[2],a[3]-=r[3]*a[2],a[4]-=r[4]*a[2],a[5]-=r[5]*a[2],r=s[3],_=o[3],h=1/r[3],_[3]=h,_[0]*=h,_[1]*=h,_[2]*=h,r[4]*=h,r[5]*=h,a=s[0],l=o[0],l[0]-=_[0]*a[3],a[4]-=r[4]*a[3],a[5]-=r[5]*a[3],a=s[1],l=o[1],l[0]-=_[0]*a[3],l[1]-=_[1]*a[3],a[4]-=r[4]*a[3],a[5]-=r[5]*a[3],a=s[2],l=o[2],l[0]-=_[0]*a[3],l[1]-=_[1]*a[3],l[2]-=_[2]*a[3],a[4]-=r[4]*a[3],a[5]-=r[5]*a[3],a=s[4],l=o[4],l[0]-=_[0]*a[3],l[1]-=_[1]*a[3],l[2]-=_[2]*a[3],l[3]=-h*a[3],a[4]-=r[4]*a[3],a[5]-=r[5]*a[3],a=s[5],l=o[5],l[0]-=_[0]*a[3],l[1]-=_[1]*a[3],l[2]-=_[2]*a[3],l[3]=-h*a[3],a[4]-=r[4]*a[3],a[5]-=r[5]*a[3],r=s[4],_=o[4],h=1/r[4],_[4]=h,_[0]*=h,_[1]*=h,_[2]*=h,_[3]*=h,r[5]*=h,a=s[0],l=o[0],l[0]-=_[0]*a[4],a[5]-=r[5]*a[4],a=s[1],l=o[1],l[0]-=_[0]*a[4],l[1]-=_[1]*a[4],a[5]-=r[5]*a[4],a=s[2],l=o[2],l[0]-=_[0]*a[4],l[1]-=_[1]*a[4],l[2]-=_[2]*a[4],a[5]-=r[5]*a[4],a=s[3],l=o[3],l[0]-=_[0]*a[4],l[1]-=_[1]*a[4],l[2]-=_[2]*a[4],l[3]-=_[3]*a[4],a[5]-=r[5]*a[4],a=s[5],l=o[5],l[0]-=_[0]*a[4],l[1]-=_[1]*a[4],l[2]-=_[2]*a[4],l[3]-=_[3]*a[4],l[4]=-h*a[4],a[5]-=r[5]*a[4],r=s[5],_=o[5],h=1/r[5],_[5]=h,_[0]*=h,_[1]*=h,_[2]*=h,_[3]*=h,_[4]*=h,a=s[0],l=o[0],l[0]-=_[0]*a[5],a=s[1],l=o[1],l[0]-=_[0]*a[5],l[1]-=_[1]*a[5],a=s[2],l=o[2],l[0]-=_[0]*a[5],l[1]-=_[1]*a[5],l[2]-=_[2]*a[5],a=s[3],l=o[3],l[0]-=_[0]*a[5],l[1]-=_[1]*a[5],l[2]-=_[2]*a[5],l[3]-=_[3]*a[5],a=s[4],l=o[4],l[0]-=_[0]*a[5],l[1]-=_[1]*a[5],l[2]-=_[2]*a[5],l[3]-=_[3]*a[5],l[4]-=_[4]*a[5],_=o[1],o[0][1]=_[0],_=o[2],o[0][2]=_[0],o[1][2]=_[1],_=o[3],o[0][3]=_[0],o[1][3]=_[1],o[2][3]=_[2],_=o[4],o[0][4]=_[0],o[1][4]=_[1],o[2][4]=_[2],o[3][4]=_[3],_=o[5],o[0][5]=_[0],o[1][5]=_[1],o[2][5]=_[2],o[3][5]=_[3],o[4][5]=_[4];break;default:let m=0;for(;m<i;){let p=m++;r=s[p],_=o[p];let d=1/r[p];_[p]=d;let u=0;for(;u<p;)_[u++]*=d;let g=p+1;for(;g<i;)r[g++]*=d;let v=0;for(;v<p;){let b=v++;a=s[b],l=o[b];let Y=0,w=b+1;for(;Y<w;){let X=Y++;l[X]-=_[X]*a[p]}let Z=p+1;for(;Z<i;){let X=Z++;a[X]-=r[X]*a[p]}}let x=p+1;for(;x<i;){let b=x++;a=s[b],l=o[b];let Y=0;for(;Y<p;){let Z=Y++;l[Z]-=_[Z]*a[p]}l[p]=-d*a[p];let w=p+1;for(;w<i;){let Z=w++;a[Z]-=r[Z]*a[p]}}}let f=1;for(;f<i;){let p=f++;_=o[p];let d=0;for(;d<p;){let u=d++;o[u][p]=_[u]}}}}computeInvMass(t,e){let i=this._invMass,n=this._invMassWithoutCfm,s=t.numRows,o=t.b1,r=t.b2,_=o._invMass,a=r._invMass,l,h,m,f,p,d,u,g,v,x,b,Y,w,Z,X,M,z,T;l=o._invInertia00,h=o._invInertia01,m=o._invInertia02,f=o._invInertia10,p=o._invInertia11,d=o._invInertia12,u=o._invInertia20,g=o._invInertia21,v=o._invInertia22,x=r._invInertia00,b=r._invInertia01,Y=r._invInertia02,w=r._invInertia10,Z=r._invInertia11,X=r._invInertia12,M=r._invInertia20,z=r._invInertia21,T=r._invInertia22;let F=0;for(;F<s;){let S=F++,R=t.rows[S].jacobian,E=e[S];if(R.updateSparsity(),(R.flag&1)!=0?(E.invMLin1X=R.lin1X*_,E.invMLin1Y=R.lin1Y*_,E.invMLin1Z=R.lin1Z*_,E.invMLin2X=R.lin2X*a,E.invMLin2Y=R.lin2Y*a,E.invMLin2Z=R.lin2Z*a):(E.invMLin1X=0,E.invMLin1Y=0,E.invMLin1Z=0,E.invMLin2X=0,E.invMLin2Y=0,E.invMLin2Z=0),(R.flag&2)!=0){let C,k,V;C=l*R.ang1X+h*R.ang1Y+m*R.ang1Z,k=f*R.ang1X+p*R.ang1Y+d*R.ang1Z,V=u*R.ang1X+g*R.ang1Y+v*R.ang1Z,E.invMAng1X=C,E.invMAng1Y=k,E.invMAng1Z=V;let B,J,I;B=x*R.ang2X+b*R.ang2Y+Y*R.ang2Z,J=w*R.ang2X+Z*R.ang2Y+X*R.ang2Z,I=M*R.ang2X+z*R.ang2Y+T*R.ang2Z,E.invMAng2X=B,E.invMAng2Y=J,E.invMAng2Z=I}else E.invMAng1X=0,E.invMAng1Y=0,E.invMAng1Z=0,E.invMAng2X=0,E.invMAng2Y=0,E.invMAng2Z=0}let P=0;for(;P<s;){let S=P++,R=t.rows[S].jacobian,E=S;for(;E<s;){let C=E++,k=e[C],V=R.lin1X*k.invMLin1X+R.lin1Y*k.invMLin1Y+R.lin1Z*k.invMLin1Z+(R.ang1X*k.invMAng1X+R.ang1Y*k.invMAng1Y+R.ang1Z*k.invMAng1Z)+(R.lin2X*k.invMLin2X+R.lin2Y*k.invMLin2Y+R.lin2Z*k.invMLin2Z)+(R.ang2X*k.invMAng2X+R.ang2Y*k.invMAng2Y+R.ang2Z*k.invMAng2Z);S==C?(i[S][C]=V+t.rows[S].cfm,n[S][C]=V,k.mass=V+t.rows[S].cfm,k.massWithoutCfm=V,k.mass!=0&&(k.mass=1/k.mass),k.massWithoutCfm!=0&&(k.massWithoutCfm=1/k.massWithoutCfm)):(i[S][C]=V,i[C][S]=V,n[S][C]=V,n[C][S]=V)}}let A=0,L=this._maxSubmatrixId;for(;A<L;)this._cacheComputed[A++]=!1}};y.dynamics.constraint.solver.pgs||(y.dynamics.constraint.solver.pgs={});y.dynamics.constraint.solver.pgs.PgsContactConstraintSolver=class extends y.dynamics.constraint.ConstraintSolver{constructor(t){super(),this.constraint=t,this.info=new y.dynamics.constraint.info.contact.ContactSolverInfo,this.massData=new Array(y.common.Setting.maxManifoldPoints);let e=0,i=this.massData.length;for(;e<i;)this.massData[e++]=new y.dynamics.constraint.solver.common.ContactSolverMassDataRow}preSolveVelocity(t){this.constraint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2;let e=this._b1._invMass,i=this._b2._invMass,n,s,o,r,_,a,l,h,m,f,p,d,u,g,v,x,b,Y;n=this._b1._invInertia00,s=this._b1._invInertia01,o=this._b1._invInertia02,r=this._b1._invInertia10,_=this._b1._invInertia11,a=this._b1._invInertia12,l=this._b1._invInertia20,h=this._b1._invInertia21,m=this._b1._invInertia22,f=this._b2._invInertia00,p=this._b2._invInertia01,d=this._b2._invInertia02,u=this._b2._invInertia10,g=this._b2._invInertia11,v=this._b2._invInertia12,x=this._b2._invInertia20,b=this._b2._invInertia21,Y=this._b2._invInertia22;let w=0,Z=this.info.numRows;for(;w<Z;){let X=w++,M=this.info.rows[X],z=this.massData[X],T=M.jacobianN;z.invMLinN1X=T.lin1X*e,z.invMLinN1Y=T.lin1Y*e,z.invMLinN1Z=T.lin1Z*e,z.invMLinN2X=T.lin2X*i,z.invMLinN2Y=T.lin2Y*i,z.invMLinN2Z=T.lin2Z*i;let F,P,A;F=n*T.ang1X+s*T.ang1Y+o*T.ang1Z,P=r*T.ang1X+_*T.ang1Y+a*T.ang1Z,A=l*T.ang1X+h*T.ang1Y+m*T.ang1Z,z.invMAngN1X=F,z.invMAngN1Y=P,z.invMAngN1Z=A;let L,S,R;L=f*T.ang2X+p*T.ang2Y+d*T.ang2Z,S=u*T.ang2X+g*T.ang2Y+v*T.ang2Z,R=x*T.ang2X+b*T.ang2Y+Y*T.ang2Z,z.invMAngN2X=L,z.invMAngN2Y=S,z.invMAngN2Z=R,z.massN=e+i+(z.invMAngN1X*T.ang1X+z.invMAngN1Y*T.ang1Y+z.invMAngN1Z*T.ang1Z)+(z.invMAngN2X*T.ang2X+z.invMAngN2Y*T.ang2Y+z.invMAngN2Z*T.ang2Z),z.massN!=0&&(z.massN=1/z.massN);let E=M.jacobianT,C=M.jacobianB;z.invMLinT1X=E.lin1X*e,z.invMLinT1Y=E.lin1Y*e,z.invMLinT1Z=E.lin1Z*e,z.invMLinT2X=E.lin2X*i,z.invMLinT2Y=E.lin2Y*i,z.invMLinT2Z=E.lin2Z*i,z.invMLinB1X=C.lin1X*e,z.invMLinB1Y=C.lin1Y*e,z.invMLinB1Z=C.lin1Z*e,z.invMLinB2X=C.lin2X*i,z.invMLinB2Y=C.lin2Y*i,z.invMLinB2Z=C.lin2Z*i;let k,V,B;k=n*E.ang1X+s*E.ang1Y+o*E.ang1Z,V=r*E.ang1X+_*E.ang1Y+a*E.ang1Z,B=l*E.ang1X+h*E.ang1Y+m*E.ang1Z,z.invMAngT1X=k,z.invMAngT1Y=V,z.invMAngT1Z=B;let J,I,G;J=f*E.ang2X+p*E.ang2Y+d*E.ang2Z,I=u*E.ang2X+g*E.ang2Y+v*E.ang2Z,G=x*E.ang2X+b*E.ang2Y+Y*E.ang2Z,z.invMAngT2X=J,z.invMAngT2Y=I,z.invMAngT2Z=G;let D,et,$;D=n*C.ang1X+s*C.ang1Y+o*C.ang1Z,et=r*C.ang1X+_*C.ang1Y+a*C.ang1Z,$=l*C.ang1X+h*C.ang1Y+m*C.ang1Z,z.invMAngB1X=D,z.invMAngB1Y=et,z.invMAngB1Z=$;let j,q,tt;j=f*C.ang2X+p*C.ang2Y+d*C.ang2Z,q=u*C.ang2X+g*C.ang2Y+v*C.ang2Z,tt=x*C.ang2X+b*C.ang2Y+Y*C.ang2Z,z.invMAngB2X=j,z.invMAngB2Y=q,z.invMAngB2Z=tt;let W=e+i+(z.invMAngT1X*E.ang1X+z.invMAngT1Y*E.ang1Y+z.invMAngT1Z*E.ang1Z)+(z.invMAngT2X*E.ang2X+z.invMAngT2Y*E.ang2Y+z.invMAngT2Z*E.ang2Z),U=z.invMAngT1X*C.ang1X+z.invMAngT1Y*C.ang1Y+z.invMAngT1Z*C.ang1Z+(z.invMAngT2X*C.ang2X+z.invMAngT2Y*C.ang2Y+z.invMAngT2Z*C.ang2Z),it=e+i+(z.invMAngB1X*C.ang1X+z.invMAngB1Y*C.ang1Y+z.invMAngB1Z*C.ang1Z)+(z.invMAngB2X*C.ang2X+z.invMAngB2Y*C.ang2Y+z.invMAngB2Z*C.ang2Z),Q=W*it-U*U;Q!=0&&(Q=1/Q),z.massTB00=it*Q,z.massTB01=-U*Q,z.massTB10=-U*Q,z.massTB11=W*Q}}warmStart(t){let e,i,n,s,o,r,_,a,l,h,m,f;e=this._b1._velX,i=this._b1._velY,n=this._b1._velZ,s=this._b2._velX,o=this._b2._velY,r=this._b2._velZ,_=this._b1._angVelX,a=this._b1._angVelY,l=this._b1._angVelZ,h=this._b2._angVelX,m=this._b2._angVelY,f=this._b2._angVelZ;let p=0,d=this.info.numRows;for(;p<d;){let u=p++,g=this.info.rows[u],v=g.impulse,x=this.massData[u],b=g.jacobianT,Y=g.jacobianB,w=v.impulseN,Z=v.impulseLX*b.lin1X+v.impulseLY*b.lin1Y+v.impulseLZ*b.lin1Z,X=v.impulseLX*Y.lin1X+v.impulseLY*Y.lin1Y+v.impulseLZ*Y.lin1Z;v.impulseT=Z,v.impulseB=X,v.impulseN*=t.dtRatio,v.impulseT*=t.dtRatio,v.impulseB*=t.dtRatio,e+=x.invMLinN1X*w,i+=x.invMLinN1Y*w,n+=x.invMLinN1Z*w,e+=x.invMLinT1X*Z,i+=x.invMLinT1Y*Z,n+=x.invMLinT1Z*Z,e+=x.invMLinB1X*X,i+=x.invMLinB1Y*X,n+=x.invMLinB1Z*X,s+=x.invMLinN2X*-w,o+=x.invMLinN2Y*-w,r+=x.invMLinN2Z*-w,s+=x.invMLinT2X*-Z,o+=x.invMLinT2Y*-Z,r+=x.invMLinT2Z*-Z,s+=x.invMLinB2X*-X,o+=x.invMLinB2Y*-X,r+=x.invMLinB2Z*-X,_+=x.invMAngN1X*w,a+=x.invMAngN1Y*w,l+=x.invMAngN1Z*w,_+=x.invMAngT1X*Z,a+=x.invMAngT1Y*Z,l+=x.invMAngT1Z*Z,_+=x.invMAngB1X*X,a+=x.invMAngB1Y*X,l+=x.invMAngB1Z*X,h+=x.invMAngN2X*-w,m+=x.invMAngN2Y*-w,f+=x.invMAngN2Z*-w,h+=x.invMAngT2X*-Z,m+=x.invMAngT2Y*-Z,f+=x.invMAngT2Z*-Z,h+=x.invMAngB2X*-X,m+=x.invMAngB2Y*-X,f+=x.invMAngB2Z*-X}this._b1._velX=e,this._b1._velY=i,this._b1._velZ=n,this._b2._velX=s,this._b2._velY=o,this._b2._velZ=r,this._b1._angVelX=_,this._b1._angVelY=a,this._b1._angVelZ=l,this._b2._angVelX=h,this._b2._angVelY=m,this._b2._angVelZ=f}solveVelocity(){let t,e,i,n,s,o,r,_,a,l,h,m;t=this._b1._velX,e=this._b1._velY,i=this._b1._velZ,n=this._b2._velX,s=this._b2._velY,o=this._b2._velZ,r=this._b1._angVelX,_=this._b1._angVelY,a=this._b1._angVelZ,l=this._b2._angVelX,h=this._b2._angVelY,m=this._b2._angVelZ;let f=0,p=this.info.numRows;for(;f<p;){let g=f++,v=this.info.rows[g],x=this.massData[g],b=v.impulse,Y=0,w=v.jacobianT;Y+=t*w.lin1X+e*w.lin1Y+i*w.lin1Z,Y-=n*w.lin2X+s*w.lin2Y+o*w.lin2Z,Y+=r*w.ang1X+_*w.ang1Y+a*w.ang1Z,Y-=l*w.ang2X+h*w.ang2Y+m*w.ang2Z;let Z=0;w=v.jacobianB,Z+=t*w.lin1X+e*w.lin1Y+i*w.lin1Z,Z-=n*w.lin2X+s*w.lin2Y+o*w.lin2Z,Z+=r*w.ang1X+_*w.ang1Y+a*w.ang1Z,Z-=l*w.ang2X+h*w.ang2Y+m*w.ang2Z;let X=-(Y*x.massTB00+Z*x.massTB01),M=-(Y*x.massTB10+Z*x.massTB11),z=b.impulseT,T=b.impulseB;b.impulseT+=X,b.impulseB+=M;let F=v.friction*b.impulseN;if(F==0)b.impulseT=0,b.impulseB=0;else{let P=b.impulseT*b.impulseT+b.impulseB*b.impulseB;if(P>F*F){let A=F/Math.sqrt(P);b.impulseT*=A,b.impulseB*=A}}X=b.impulseT-z,M=b.impulseB-T,t+=x.invMLinT1X*X,e+=x.invMLinT1Y*X,i+=x.invMLinT1Z*X,t+=x.invMLinB1X*M,e+=x.invMLinB1Y*M,i+=x.invMLinB1Z*M,n+=x.invMLinT2X*-X,s+=x.invMLinT2Y*-X,o+=x.invMLinT2Z*-X,n+=x.invMLinB2X*-M,s+=x.invMLinB2Y*-M,o+=x.invMLinB2Z*-M,r+=x.invMAngT1X*X,_+=x.invMAngT1Y*X,a+=x.invMAngT1Z*X,r+=x.invMAngB1X*M,_+=x.invMAngB1Y*M,a+=x.invMAngB1Z*M,l+=x.invMAngT2X*-X,h+=x.invMAngT2Y*-X,m+=x.invMAngT2Z*-X,l+=x.invMAngB2X*-M,h+=x.invMAngB2Y*-M,m+=x.invMAngB2Z*-M}let d=0,u=this.info.numRows;for(;d<u;){let g=d++,v=this.info.rows[g],x=this.massData[g],b=v.impulse,Y=0,w=v.jacobianN;Y+=t*w.lin1X+e*w.lin1Y+i*w.lin1Z,Y-=n*w.lin2X+s*w.lin2Y+o*w.lin2Z,Y+=r*w.ang1X+_*w.ang1Y+a*w.ang1Z,Y-=l*w.ang2X+h*w.ang2Y+m*w.ang2Z;let Z=(v.rhs-Y)*x.massN,X=b.impulseN;b.impulseN+=Z,b.impulseN<0&&(b.impulseN=0),Z=b.impulseN-X,t+=x.invMLinN1X*Z,e+=x.invMLinN1Y*Z,i+=x.invMLinN1Z*Z,n+=x.invMLinN2X*-Z,s+=x.invMLinN2Y*-Z,o+=x.invMLinN2Z*-Z,r+=x.invMAngN1X*Z,_+=x.invMAngN1Y*Z,a+=x.invMAngN1Z*Z,l+=x.invMAngN2X*-Z,h+=x.invMAngN2Y*-Z,m+=x.invMAngN2Z*-Z}this._b1._velX=t,this._b1._velY=e,this._b1._velZ=i,this._b2._velX=n,this._b2._velY=s,this._b2._velZ=o,this._b1._angVelX=r,this._b1._angVelY=_,this._b1._angVelZ=a,this._b2._angVelX=l,this._b2._angVelY=h,this._b2._angVelZ=m}preSolvePosition(t){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);let e=this._b1._invMass,i=this._b2._invMass,n,s,o,r,_,a,l,h,m,f,p,d,u,g,v,x,b,Y;n=this._b1._invInertia00,s=this._b1._invInertia01,o=this._b1._invInertia02,r=this._b1._invInertia10,_=this._b1._invInertia11,a=this._b1._invInertia12,l=this._b1._invInertia20,h=this._b1._invInertia21,m=this._b1._invInertia22,f=this._b2._invInertia00,p=this._b2._invInertia01,d=this._b2._invInertia02,u=this._b2._invInertia10,g=this._b2._invInertia11,v=this._b2._invInertia12,x=this._b2._invInertia20,b=this._b2._invInertia21,Y=this._b2._invInertia22;let w=0,Z=this.info.numRows;for(;w<Z;){let z=w++,T=this.massData[z],F=this.info.rows[z].jacobianN;T.invMLinN1X=F.lin1X*e,T.invMLinN1Y=F.lin1Y*e,T.invMLinN1Z=F.lin1Z*e,T.invMLinN2X=F.lin2X*i,T.invMLinN2Y=F.lin2Y*i,T.invMLinN2Z=F.lin2Z*i;let P,A,L;P=n*F.ang1X+s*F.ang1Y+o*F.ang1Z,A=r*F.ang1X+_*F.ang1Y+a*F.ang1Z,L=l*F.ang1X+h*F.ang1Y+m*F.ang1Z,T.invMAngN1X=P,T.invMAngN1Y=A,T.invMAngN1Z=L;let S,R,E;S=f*F.ang2X+p*F.ang2Y+d*F.ang2Z,R=u*F.ang2X+g*F.ang2Y+v*F.ang2Z,E=x*F.ang2X+b*F.ang2Y+Y*F.ang2Z,T.invMAngN2X=S,T.invMAngN2Y=R,T.invMAngN2Z=E,T.massN=e+i+(T.invMAngN1X*F.ang1X+T.invMAngN1Y*F.ang1Y+T.invMAngN1Z*F.ang1Z)+(T.invMAngN2X*F.ang2X+T.invMAngN2Y*F.ang2Y+T.invMAngN2Z*F.ang2Z),T.massN!=0&&(T.massN=1/T.massN)}let X=0,M=this.info.numRows;for(;X<M;)this.info.rows[X++].impulse.impulseP=0}solvePositionSplitImpulse(){let t,e,i,n,s,o,r,_,a,l,h,m;t=this._b1._pseudoVelX,e=this._b1._pseudoVelY,i=this._b1._pseudoVelZ,n=this._b2._pseudoVelX,s=this._b2._pseudoVelY,o=this._b2._pseudoVelZ,r=this._b1._angPseudoVelX,_=this._b1._angPseudoVelY,a=this._b1._angPseudoVelZ,l=this._b2._angPseudoVelX,h=this._b2._angPseudoVelY,m=this._b2._angPseudoVelZ;let f=0,p=this.info.numRows;for(;f<p;){let d=f++,u=this.info.rows[d],g=this.massData[d],v=u.impulse,x=u.jacobianN,b=0;b+=t*x.lin1X+e*x.lin1Y+i*x.lin1Z,b-=n*x.lin2X+s*x.lin2Y+o*x.lin2Z,b+=r*x.ang1X+_*x.ang1Y+a*x.ang1Z,b-=l*x.ang2X+h*x.ang2Y+m*x.ang2Z;let Y=(u.rhs-b)*g.massN*y.common.Setting.positionSplitImpulseBaumgarte,w=v.impulseP;v.impulseP+=Y,v.impulseP<0&&(v.impulseP=0),Y=v.impulseP-w,t+=g.invMLinN1X*Y,e+=g.invMLinN1Y*Y,i+=g.invMLinN1Z*Y,n+=g.invMLinN2X*-Y,s+=g.invMLinN2Y*-Y,o+=g.invMLinN2Z*-Y,r+=g.invMAngN1X*Y,_+=g.invMAngN1Y*Y,a+=g.invMAngN1Z*Y,l+=g.invMAngN2X*-Y,h+=g.invMAngN2Y*-Y,m+=g.invMAngN2Z*-Y}this._b1._pseudoVelX=t,this._b1._pseudoVelY=e,this._b1._pseudoVelZ=i,this._b2._pseudoVelX=n,this._b2._pseudoVelY=s,this._b2._pseudoVelZ=o,this._b1._angPseudoVelX=r,this._b1._angPseudoVelY=_,this._b1._angPseudoVelZ=a,this._b2._angPseudoVelX=l,this._b2._angPseudoVelY=h,this._b2._angPseudoVelZ=m}solvePositionNgs(t){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);let e=this._b1._invMass,i=this._b2._invMass,n,s,o,r,_,a,l,h,m,f,p,d,u,g,v,x,b,Y;n=this._b1._invInertia00,s=this._b1._invInertia01,o=this._b1._invInertia02,r=this._b1._invInertia10,_=this._b1._invInertia11,a=this._b1._invInertia12,l=this._b1._invInertia20,h=this._b1._invInertia21,m=this._b1._invInertia22,f=this._b2._invInertia00,p=this._b2._invInertia01,d=this._b2._invInertia02,u=this._b2._invInertia10,g=this._b2._invInertia11,v=this._b2._invInertia12,x=this._b2._invInertia20,b=this._b2._invInertia21,Y=this._b2._invInertia22;let w=0,Z=this.info.numRows;for(;w<Z;){let Be=w++,xe=this.massData[Be],qt=this.info.rows[Be].jacobianN;xe.invMLinN1X=qt.lin1X*e,xe.invMLinN1Y=qt.lin1Y*e,xe.invMLinN1Z=qt.lin1Z*e,xe.invMLinN2X=qt.lin2X*i,xe.invMLinN2Y=qt.lin2Y*i,xe.invMLinN2Z=qt.lin2Z*i;let Jt,ve,Qt;Jt=n*qt.ang1X+s*qt.ang1Y+o*qt.ang1Z,ve=r*qt.ang1X+_*qt.ang1Y+a*qt.ang1Z,Qt=l*qt.ang1X+h*qt.ang1Y+m*qt.ang1Z,xe.invMAngN1X=Jt,xe.invMAngN1Y=ve,xe.invMAngN1Z=Qt;let zt,Et,Kt;zt=f*qt.ang2X+p*qt.ang2Y+d*qt.ang2Z,Et=u*qt.ang2X+g*qt.ang2Y+v*qt.ang2Z,Kt=x*qt.ang2X+b*qt.ang2Y+Y*qt.ang2Z,xe.invMAngN2X=zt,xe.invMAngN2Y=Et,xe.invMAngN2Z=Kt,xe.massN=e+i+(xe.invMAngN1X*qt.ang1X+xe.invMAngN1Y*qt.ang1Y+xe.invMAngN1Z*qt.ang1Z)+(xe.invMAngN2X*qt.ang2X+xe.invMAngN2Y*qt.ang2Y+xe.invMAngN2Z*qt.ang2Z),xe.massN!=0&&(xe.massN=1/xe.massN)}let X,M,z,T,F,P,A,L,S,R,E,C;X=0,M=0,z=0,T=0,F=0,P=0,A=0,L=0,S=0,R=0,E=0,C=0;let k=0,V=this.info.numRows;for(;k<V;){let Be=k++,xe=this.info.rows[Be],qt=this.massData[Be],Jt=xe.impulse,ve=xe.jacobianN,Qt=0;Qt+=X*ve.lin1X+M*ve.lin1Y+z*ve.lin1Z,Qt-=T*ve.lin2X+F*ve.lin2Y+P*ve.lin2Z,Qt+=A*ve.ang1X+L*ve.ang1Y+S*ve.ang1Z,Qt-=R*ve.ang2X+E*ve.ang2Y+C*ve.ang2Z;let zt=(xe.rhs-Qt)*qt.massN*y.common.Setting.positionNgsBaumgarte,Et=Jt.impulseP;Jt.impulseP+=zt,Jt.impulseP<0&&(Jt.impulseP=0),zt=Jt.impulseP-Et,X+=qt.invMLinN1X*zt,M+=qt.invMLinN1Y*zt,z+=qt.invMLinN1Z*zt,T+=qt.invMLinN2X*-zt,F+=qt.invMLinN2Y*-zt,P+=qt.invMLinN2Z*-zt,A+=qt.invMAngN1X*zt,L+=qt.invMAngN1Y*zt,S+=qt.invMAngN1Z*zt,R+=qt.invMAngN2X*-zt,E+=qt.invMAngN2Y*-zt,C+=qt.invMAngN2Z*-zt}let B=this._b1;B._transform._positionX+=X,B._transform._positionY+=M,B._transform._positionZ+=z;let J=this._b2;J._transform._positionX+=T,J._transform._positionY+=F,J._transform._positionZ+=P;let I=this._b1,G=Math.sqrt(A*A+L*L+S*S),D=G*.5,et,$;if(D<.5){let Be=D*D;et=.5*(1-Be*.16666666666666666+Be*Be*.008333333333333333),$=1-Be*.5+Be*Be*.041666666666666664}else et=Math.sin(D)/G,$=Math.cos(D);let j,q,tt;j=A*et,q=L*et,tt=S*et;let W,U,it,Q;W=j,U=q,it=tt,Q=$;let at,ht,_t,mt,ft=I._transform._rotation00,ut=I._transform._rotation11,H=I._transform._rotation22,O=ft+ut+H,ot;O>0?(ot=Math.sqrt(O+1),mt=.5*ot,ot=.5/ot,at=(I._transform._rotation21-I._transform._rotation12)*ot,ht=(I._transform._rotation02-I._transform._rotation20)*ot,_t=(I._transform._rotation10-I._transform._rotation01)*ot):ft>ut?ft>H?(ot=Math.sqrt(ft-ut-H+1),at=.5*ot,ot=.5/ot,ht=(I._transform._rotation01+I._transform._rotation10)*ot,_t=(I._transform._rotation02+I._transform._rotation20)*ot,mt=(I._transform._rotation21-I._transform._rotation12)*ot):(ot=Math.sqrt(H-ft-ut+1),_t=.5*ot,ot=.5/ot,at=(I._transform._rotation02+I._transform._rotation20)*ot,ht=(I._transform._rotation12+I._transform._rotation21)*ot,mt=(I._transform._rotation10-I._transform._rotation01)*ot):ut>H?(ot=Math.sqrt(ut-H-ft+1),ht=.5*ot,ot=.5/ot,at=(I._transform._rotation01+I._transform._rotation10)*ot,_t=(I._transform._rotation12+I._transform._rotation21)*ot,mt=(I._transform._rotation02-I._transform._rotation20)*ot):(ot=Math.sqrt(H-ft-ut+1),_t=.5*ot,ot=.5/ot,at=(I._transform._rotation02+I._transform._rotation20)*ot,ht=(I._transform._rotation12+I._transform._rotation21)*ot,mt=(I._transform._rotation10-I._transform._rotation01)*ot),at=Q*at+W*mt+U*_t-it*ht,ht=Q*ht-W*_t+U*mt+it*at,_t=Q*_t+W*ht-U*at+it*mt,mt=Q*mt-W*at-U*ht-it*_t;let pt=at*at+ht*ht+_t*_t+mt*mt;pt>1e-32&&(pt=1/Math.sqrt(pt)),at*=pt,ht*=pt,_t*=pt,mt*=pt;let vt=at,xt=ht,Mt=_t,ct=mt,St=2*vt,It=2*xt,dt=2*Mt,K=vt*St,lt=xt*It,rt=Mt*dt,Vt=vt*It,At=xt*dt,Yt=vt*dt,Xt=ct*St,Nt=ct*It,ie=ct*dt;I._transform._rotation00=1-lt-rt,I._transform._rotation01=Vt-ie,I._transform._rotation02=Yt+Nt,I._transform._rotation10=Vt+ie,I._transform._rotation11=1-K-rt,I._transform._rotation12=At-Xt,I._transform._rotation20=Yt-Nt,I._transform._rotation21=At+Xt,I._transform._rotation22=1-K-lt;let ee,Ze,ze,pe,$t,Ht,ue,Ie,qe;ee=I._transform._rotation00*I._invLocalInertia00+I._transform._rotation01*I._invLocalInertia10+I._transform._rotation02*I._invLocalInertia20,Ze=I._transform._rotation00*I._invLocalInertia01+I._transform._rotation01*I._invLocalInertia11+I._transform._rotation02*I._invLocalInertia21,ze=I._transform._rotation00*I._invLocalInertia02+I._transform._rotation01*I._invLocalInertia12+I._transform._rotation02*I._invLocalInertia22,pe=I._transform._rotation10*I._invLocalInertia00+I._transform._rotation11*I._invLocalInertia10+I._transform._rotation12*I._invLocalInertia20,$t=I._transform._rotation10*I._invLocalInertia01+I._transform._rotation11*I._invLocalInertia11+I._transform._rotation12*I._invLocalInertia21,Ht=I._transform._rotation10*I._invLocalInertia02+I._transform._rotation11*I._invLocalInertia12+I._transform._rotation12*I._invLocalInertia22,ue=I._transform._rotation20*I._invLocalInertia00+I._transform._rotation21*I._invLocalInertia10+I._transform._rotation22*I._invLocalInertia20,Ie=I._transform._rotation20*I._invLocalInertia01+I._transform._rotation21*I._invLocalInertia11+I._transform._rotation22*I._invLocalInertia21,qe=I._transform._rotation20*I._invLocalInertia02+I._transform._rotation21*I._invLocalInertia12+I._transform._rotation22*I._invLocalInertia22,I._invInertia00=ee,I._invInertia01=Ze,I._invInertia02=ze,I._invInertia10=pe,I._invInertia11=$t,I._invInertia12=Ht,I._invInertia20=ue,I._invInertia21=Ie,I._invInertia22=qe;let Ee,Ut,nt,gt,yt,bt,st,Pt,Dt;Ee=I._invInertia00*I._transform._rotation00+I._invInertia01*I._transform._rotation01+I._invInertia02*I._transform._rotation02,Ut=I._invInertia00*I._transform._rotation10+I._invInertia01*I._transform._rotation11+I._invInertia02*I._transform._rotation12,nt=I._invInertia00*I._transform._rotation20+I._invInertia01*I._transform._rotation21+I._invInertia02*I._transform._rotation22,gt=I._invInertia10*I._transform._rotation00+I._invInertia11*I._transform._rotation01+I._invInertia12*I._transform._rotation02,yt=I._invInertia10*I._transform._rotation10+I._invInertia11*I._transform._rotation11+I._invInertia12*I._transform._rotation12,bt=I._invInertia10*I._transform._rotation20+I._invInertia11*I._transform._rotation21+I._invInertia12*I._transform._rotation22,st=I._invInertia20*I._transform._rotation00+I._invInertia21*I._transform._rotation01+I._invInertia22*I._transform._rotation02,Pt=I._invInertia20*I._transform._rotation10+I._invInertia21*I._transform._rotation11+I._invInertia22*I._transform._rotation12,Dt=I._invInertia20*I._transform._rotation20+I._invInertia21*I._transform._rotation21+I._invInertia22*I._transform._rotation22,I._invInertia00=Ee,I._invInertia01=Ut,I._invInertia02=nt,I._invInertia10=gt,I._invInertia11=yt,I._invInertia12=bt,I._invInertia20=st,I._invInertia21=Pt,I._invInertia22=Dt,I._invInertia00*=I._rotFactor.x,I._invInertia01*=I._rotFactor.x,I._invInertia02*=I._rotFactor.x,I._invInertia10*=I._rotFactor.y,I._invInertia11*=I._rotFactor.y,I._invInertia12*=I._rotFactor.y,I._invInertia20*=I._rotFactor.z,I._invInertia21*=I._rotFactor.z,I._invInertia22*=I._rotFactor.z;let N=this._b2,kt=Math.sqrt(R*R+E*E+C*C),Rt=kt*.5,Ot,Wt;if(Rt<.5){let Be=Rt*Rt;Ot=.5*(1-Be*.16666666666666666+Be*Be*.008333333333333333),Wt=1-Be*.5+Be*Be*.041666666666666664}else Ot=Math.sin(Rt)/kt,Wt=Math.cos(Rt);let Bt,re,Ce;Bt=R*Ot,re=E*Ot,Ce=C*Ot;let be,Tt,Lt,Zt;be=Bt,Tt=re,Lt=Ce,Zt=Wt;let me,Me,fe,ti,di=N._transform._rotation00,Le=N._transform._rotation11,_i=N._transform._rotation22,yi=di+Le+_i,he;yi>0?(he=Math.sqrt(yi+1),ti=.5*he,he=.5/he,me=(N._transform._rotation21-N._transform._rotation12)*he,Me=(N._transform._rotation02-N._transform._rotation20)*he,fe=(N._transform._rotation10-N._transform._rotation01)*he):di>Le?di>_i?(he=Math.sqrt(di-Le-_i+1),me=.5*he,he=.5/he,Me=(N._transform._rotation01+N._transform._rotation10)*he,fe=(N._transform._rotation02+N._transform._rotation20)*he,ti=(N._transform._rotation21-N._transform._rotation12)*he):(he=Math.sqrt(_i-di-Le+1),fe=.5*he,he=.5/he,me=(N._transform._rotation02+N._transform._rotation20)*he,Me=(N._transform._rotation12+N._transform._rotation21)*he,ti=(N._transform._rotation10-N._transform._rotation01)*he):Le>_i?(he=Math.sqrt(Le-_i-di+1),Me=.5*he,he=.5/he,me=(N._transform._rotation01+N._transform._rotation10)*he,fe=(N._transform._rotation12+N._transform._rotation21)*he,ti=(N._transform._rotation02-N._transform._rotation20)*he):(he=Math.sqrt(_i-di-Le+1),fe=.5*he,he=.5/he,me=(N._transform._rotation02+N._transform._rotation20)*he,Me=(N._transform._rotation12+N._transform._rotation21)*he,ti=(N._transform._rotation10-N._transform._rotation01)*he),me=Zt*me+be*ti+Tt*fe-Lt*Me,Me=Zt*Me-be*fe+Tt*ti+Lt*me,fe=Zt*fe+be*Me-Tt*me+Lt*ti,ti=Zt*ti-be*me-Tt*Me-Lt*fe;let gi=me*me+Me*Me+fe*fe+ti*ti;gi>1e-32&&(gi=1/Math.sqrt(gi)),me*=gi,Me*=gi,fe*=gi,ti*=gi;let bi=me,Mi=Me,Ii=fe,He=ti,Je=2*bi,Ke=2*Mi,ci=2*Ii,hi=bi*Je,ei=Mi*Ke,ai=Ii*ci,Qe=bi*Ke,We=Mi*ci,ke=bi*ci,le=He*Je,ge=He*Ke,jt=He*ci;N._transform._rotation00=1-ei-ai,N._transform._rotation01=Qe-jt,N._transform._rotation02=ke+ge,N._transform._rotation10=Qe+jt,N._transform._rotation11=1-hi-ai,N._transform._rotation12=We-le,N._transform._rotation20=ke-ge,N._transform._rotation21=We+le,N._transform._rotation22=1-hi-ei;let Ae,Se,Re,Te,Ne,se,Ct,Gt,Pe;Ae=N._transform._rotation00*N._invLocalInertia00+N._transform._rotation01*N._invLocalInertia10+N._transform._rotation02*N._invLocalInertia20,Se=N._transform._rotation00*N._invLocalInertia01+N._transform._rotation01*N._invLocalInertia11+N._transform._rotation02*N._invLocalInertia21,Re=N._transform._rotation00*N._invLocalInertia02+N._transform._rotation01*N._invLocalInertia12+N._transform._rotation02*N._invLocalInertia22,Te=N._transform._rotation10*N._invLocalInertia00+N._transform._rotation11*N._invLocalInertia10+N._transform._rotation12*N._invLocalInertia20,Ne=N._transform._rotation10*N._invLocalInertia01+N._transform._rotation11*N._invLocalInertia11+N._transform._rotation12*N._invLocalInertia21,se=N._transform._rotation10*N._invLocalInertia02+N._transform._rotation11*N._invLocalInertia12+N._transform._rotation12*N._invLocalInertia22,Ct=N._transform._rotation20*N._invLocalInertia00+N._transform._rotation21*N._invLocalInertia10+N._transform._rotation22*N._invLocalInertia20,Gt=N._transform._rotation20*N._invLocalInertia01+N._transform._rotation21*N._invLocalInertia11+N._transform._rotation22*N._invLocalInertia21,Pe=N._transform._rotation20*N._invLocalInertia02+N._transform._rotation21*N._invLocalInertia12+N._transform._rotation22*N._invLocalInertia22,N._invInertia00=Ae,N._invInertia01=Se,N._invInertia02=Re,N._invInertia10=Te,N._invInertia11=Ne,N._invInertia12=se,N._invInertia20=Ct,N._invInertia21=Gt,N._invInertia22=Pe;let Ve,Ue,ii,ri,ui,vi,ce,Ge,we;Ve=N._invInertia00*N._transform._rotation00+N._invInertia01*N._transform._rotation01+N._invInertia02*N._transform._rotation02,Ue=N._invInertia00*N._transform._rotation10+N._invInertia01*N._transform._rotation11+N._invInertia02*N._transform._rotation12,ii=N._invInertia00*N._transform._rotation20+N._invInertia01*N._transform._rotation21+N._invInertia02*N._transform._rotation22,ri=N._invInertia10*N._transform._rotation00+N._invInertia11*N._transform._rotation01+N._invInertia12*N._transform._rotation02,ui=N._invInertia10*N._transform._rotation10+N._invInertia11*N._transform._rotation11+N._invInertia12*N._transform._rotation12,vi=N._invInertia10*N._transform._rotation20+N._invInertia11*N._transform._rotation21+N._invInertia12*N._transform._rotation22,ce=N._invInertia20*N._transform._rotation00+N._invInertia21*N._transform._rotation01+N._invInertia22*N._transform._rotation02,Ge=N._invInertia20*N._transform._rotation10+N._invInertia21*N._transform._rotation11+N._invInertia22*N._transform._rotation12,we=N._invInertia20*N._transform._rotation20+N._invInertia21*N._transform._rotation21+N._invInertia22*N._transform._rotation22,N._invInertia00=Ve,N._invInertia01=Ue,N._invInertia02=ii,N._invInertia10=ri,N._invInertia11=ui,N._invInertia12=vi,N._invInertia20=ce,N._invInertia21=Ge,N._invInertia22=we,N._invInertia00*=N._rotFactor.x,N._invInertia01*=N._rotFactor.x,N._invInertia02*=N._rotFactor.x,N._invInertia10*=N._rotFactor.y,N._invInertia11*=N._rotFactor.y,N._invInertia12*=N._rotFactor.y,N._invInertia20*=N._rotFactor.z,N._invInertia21*=N._rotFactor.z,N._invInertia22*=N._rotFactor.z}postSolve(){let t,e,i,n,s,o,r,_,a;t=0,e=0,i=0,n=0,s=0,o=0,r=0,_=0,a=0;let l=0,h=this.info.numRows;for(;l<h;){let m=this.info.rows[l++],f=m.impulse,p=m.jacobianN,d=m.jacobianT,u=m.jacobianB,g=f.impulseN,v=f.impulseT,x=f.impulseB,b,Y,w;b=0,Y=0,w=0,b+=d.lin1X*v,Y+=d.lin1Y*v,w+=d.lin1Z*v,b+=u.lin1X*x,Y+=u.lin1Y*x,w+=u.lin1Z*x,f.impulseLX=b,f.impulseLY=Y,f.impulseLZ=w,t+=p.lin1X*g,e+=p.lin1Y*g,i+=p.lin1Z*g,n+=p.ang1X*g,s+=p.ang1Y*g,o+=p.ang1Z*g,r+=p.ang2X*g,_+=p.ang2Y*g,a+=p.ang2Z*g,t+=d.lin1X*v,e+=d.lin1Y*v,i+=d.lin1Z*v,n+=d.ang1X*v,s+=d.ang1Y*v,o+=d.ang1Z*v,r+=d.ang2X*v,_+=d.ang2Y*v,a+=d.ang2Z*v,t+=u.lin1X*x,e+=u.lin1Y*x,i+=u.lin1Z*x,n+=u.ang1X*x,s+=u.ang1Y*x,o+=u.ang1Z*x,r+=u.ang2X*x,_+=u.ang2Y*x,a+=u.ang2Z*x}this._b1._linearContactImpulseX+=t,this._b1._linearContactImpulseY+=e,this._b1._linearContactImpulseZ+=i,this._b1._angularContactImpulseX+=n,this._b1._angularContactImpulseY+=s,this._b1._angularContactImpulseZ+=o,this._b2._linearContactImpulseX-=t,this._b2._linearContactImpulseY-=e,this._b2._linearContactImpulseZ-=i,this._b2._angularContactImpulseX-=r,this._b2._angularContactImpulseY-=_,this._b2._angularContactImpulseZ-=a,this.constraint._syncManifold()}};y.dynamics.constraint.solver.pgs.PgsJointConstraintSolver=class extends y.dynamics.constraint.ConstraintSolver{constructor(t){super(),this.joint=t,this.info=new y.dynamics.constraint.info.joint.JointSolverInfo,this.massData=new Array(y.common.Setting.maxJacobianRows);let e=0,i=this.massData.length;for(;e<i;)this.massData[e++]=new y.dynamics.constraint.solver.common.JointSolverMassDataRow}preSolveVelocity(t){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2;let e=this._b1._invMass,i=this._b2._invMass,n,s,o,r,_,a,l,h,m,f,p,d,u,g,v,x,b,Y;n=this._b1._invInertia00,s=this._b1._invInertia01,o=this._b1._invInertia02,r=this._b1._invInertia10,_=this._b1._invInertia11,a=this._b1._invInertia12,l=this._b1._invInertia20,h=this._b1._invInertia21,m=this._b1._invInertia22,f=this._b2._invInertia00,p=this._b2._invInertia01,d=this._b2._invInertia02,u=this._b2._invInertia10,g=this._b2._invInertia11,v=this._b2._invInertia12,x=this._b2._invInertia20,b=this._b2._invInertia21,Y=this._b2._invInertia22;let w=0,Z=this.info.numRows;for(;w<Z;){let X=w++,M=this.info.rows[X],z=this.massData[X],T=M.jacobian;if(T.updateSparsity(),(T.flag&1)!=0?(z.invMLin1X=T.lin1X*e,z.invMLin1Y=T.lin1Y*e,z.invMLin1Z=T.lin1Z*e,z.invMLin2X=T.lin2X*i,z.invMLin2Y=T.lin2Y*i,z.invMLin2Z=T.lin2Z*i):(z.invMLin1X=0,z.invMLin1Y=0,z.invMLin1Z=0,z.invMLin2X=0,z.invMLin2Y=0,z.invMLin2Z=0),(T.flag&2)!=0){let F,P,A;F=n*T.ang1X+s*T.ang1Y+o*T.ang1Z,P=r*T.ang1X+_*T.ang1Y+a*T.ang1Z,A=l*T.ang1X+h*T.ang1Y+m*T.ang1Z,z.invMAng1X=F,z.invMAng1Y=P,z.invMAng1Z=A;let L,S,R;L=f*T.ang2X+p*T.ang2Y+d*T.ang2Z,S=u*T.ang2X+g*T.ang2Y+v*T.ang2Z,R=x*T.ang2X+b*T.ang2Y+Y*T.ang2Z,z.invMAng2X=L,z.invMAng2Y=S,z.invMAng2Z=R}else z.invMAng1X=0,z.invMAng1Y=0,z.invMAng1Z=0,z.invMAng2X=0,z.invMAng2Y=0,z.invMAng2Z=0;z.massWithoutCfm=z.invMLin1X*T.lin1X+z.invMLin1Y*T.lin1Y+z.invMLin1Z*T.lin1Z+(z.invMLin2X*T.lin2X+z.invMLin2Y*T.lin2Y+z.invMLin2Z*T.lin2Z)+(z.invMAng1X*T.ang1X+z.invMAng1Y*T.ang1Y+z.invMAng1Z*T.ang1Z)+(z.invMAng2X*T.ang2X+z.invMAng2Y*T.ang2Y+z.invMAng2Z*T.ang2Z),z.mass=z.massWithoutCfm+M.cfm,z.massWithoutCfm!=0&&(z.massWithoutCfm=1/z.massWithoutCfm),z.mass!=0&&(z.mass=1/z.mass)}}warmStart(t){let e=this.joint._positionCorrectionAlgorithm==y.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?y.common.Setting.jointWarmStartingFactorForBaungarte:y.common.Setting.jointWarmStartingFactor;if(e*=t.dtRatio,e<=0){let g=0,v=this.info.numRows;for(;g<v;){let x=this.info.rows[g++].impulse;x.impulse=0,x.impulseM=0,x.impulseP=0}return}let i,n,s,o,r,_,a,l,h,m,f,p;i=this._b1._velX,n=this._b1._velY,s=this._b1._velZ,o=this._b2._velX,r=this._b2._velY,_=this._b2._velZ,a=this._b1._angVelX,l=this._b1._angVelY,h=this._b1._angVelZ,m=this._b2._angVelX,f=this._b2._angVelY,p=this._b2._angVelZ;let d=0,u=this.info.numRows;for(;d<u;){let g=d++,v=this.massData[g],x=this.info.rows[g].impulse;x.impulse*=e,x.impulseM*=e;let b=x.impulse+x.impulseM;i+=v.invMLin1X*b,n+=v.invMLin1Y*b,s+=v.invMLin1Z*b,o+=v.invMLin2X*-b,r+=v.invMLin2Y*-b,_+=v.invMLin2Z*-b,a+=v.invMAng1X*b,l+=v.invMAng1Y*b,h+=v.invMAng1Z*b,m+=v.invMAng2X*-b,f+=v.invMAng2Y*-b,p+=v.invMAng2Z*-b}this._b1._velX=i,this._b1._velY=n,this._b1._velZ=s,this._b2._velX=o,this._b2._velY=r,this._b2._velZ=_,this._b1._angVelX=a,this._b1._angVelY=l,this._b1._angVelZ=h,this._b2._angVelX=m,this._b2._angVelY=f,this._b2._angVelZ=p}solveVelocity(){let t,e,i,n,s,o,r,_,a,l,h,m;t=this._b1._velX,e=this._b1._velY,i=this._b1._velZ,n=this._b2._velX,s=this._b2._velY,o=this._b2._velZ,r=this._b1._angVelX,_=this._b1._angVelY,a=this._b1._angVelZ,l=this._b2._angVelX,h=this._b2._angVelY,m=this._b2._angVelZ;let f=0,p=this.info.numRows;for(;f<p;){let g=f++,v=this.info.rows[g],x=this.massData[g],b=v.impulse,Y=v.jacobian;if(v.motorMaxImpulse==0)continue;let w=0;w+=t*Y.lin1X+e*Y.lin1Y+i*Y.lin1Z,w-=n*Y.lin2X+s*Y.lin2Y+o*Y.lin2Z,w+=r*Y.ang1X+_*Y.ang1Y+a*Y.ang1Z,w-=l*Y.ang2X+h*Y.ang2Y+m*Y.ang2Z;let Z=(-v.motorSpeed-w)*x.massWithoutCfm,X=b.impulseM;b.impulseM+=Z,b.impulseM<-v.motorMaxImpulse?b.impulseM=-v.motorMaxImpulse:b.impulseM>v.motorMaxImpulse&&(b.impulseM=v.motorMaxImpulse),Z=b.impulseM-X,(Y.flag&1)!=0&&(t+=x.invMLin1X*Z,e+=x.invMLin1Y*Z,i+=x.invMLin1Z*Z,n+=x.invMLin2X*-Z,s+=x.invMLin2Y*-Z,o+=x.invMLin2Z*-Z),(Y.flag&2)!=0&&(r+=x.invMAng1X*Z,_+=x.invMAng1Y*Z,a+=x.invMAng1Z*Z,l+=x.invMAng2X*-Z,h+=x.invMAng2Y*-Z,m+=x.invMAng2Z*-Z)}let d=0,u=this.info.numRows;for(;d<u;){let g=d++,v=this.info.rows[g],x=this.massData[g],b=v.impulse,Y=v.jacobian,w=0;w+=t*Y.lin1X+e*Y.lin1Y+i*Y.lin1Z,w-=n*Y.lin2X+s*Y.lin2Y+o*Y.lin2Z,w+=r*Y.ang1X+_*Y.ang1Y+a*Y.ang1Z,w-=l*Y.ang2X+h*Y.ang2Y+m*Y.ang2Z;let Z=(v.rhs-w-b.impulse*v.cfm)*x.mass,X=b.impulse;b.impulse+=Z,b.impulse<v.minImpulse?b.impulse=v.minImpulse:b.impulse>v.maxImpulse&&(b.impulse=v.maxImpulse),Z=b.impulse-X,(Y.flag&1)!=0&&(t+=x.invMLin1X*Z,e+=x.invMLin1Y*Z,i+=x.invMLin1Z*Z,n+=x.invMLin2X*-Z,s+=x.invMLin2Y*-Z,o+=x.invMLin2Z*-Z),(Y.flag&2)!=0&&(r+=x.invMAng1X*Z,_+=x.invMAng1Y*Z,a+=x.invMAng1Z*Z,l+=x.invMAng2X*-Z,h+=x.invMAng2Y*-Z,m+=x.invMAng2Z*-Z)}this._b1._velX=t,this._b1._velY=e,this._b1._velZ=i,this._b2._velX=n,this._b2._velY=s,this._b2._velZ=o,this._b1._angVelX=r,this._b1._angVelY=_,this._b1._angVelZ=a,this._b2._angVelX=l,this._b2._angVelY=h,this._b2._angVelZ=m}postSolveVelocity(t){let e,i,n,s,o,r;e=0,i=0,n=0,s=0,o=0,r=0;let _=0,a=this.info.numRows;for(;_<a;){let l=this.info.rows[_++],h=l.impulse,m=l.jacobian;(m.flag&1)!=0?(e+=m.lin1X*h.impulse,i+=m.lin1Y*h.impulse,n+=m.lin1Z*h.impulse):(m.flag&2)!=0&&(s+=m.ang1X*h.impulse,o+=m.ang1Y*h.impulse,r+=m.ang1Z*h.impulse)}this.joint._appliedForceX=e*t.invDt,this.joint._appliedForceY=i*t.invDt,this.joint._appliedForceZ=n*t.invDt,this.joint._appliedTorqueX=s*t.invDt,this.joint._appliedTorqueY=o*t.invDt,this.joint._appliedTorqueZ=r*t.invDt}preSolvePosition(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;let e=this._b1._invMass,i=this._b2._invMass,n,s,o,r,_,a,l,h,m,f,p,d,u,g,v,x,b,Y;n=this._b1._invInertia00,s=this._b1._invInertia01,o=this._b1._invInertia02,r=this._b1._invInertia10,_=this._b1._invInertia11,a=this._b1._invInertia12,l=this._b1._invInertia20,h=this._b1._invInertia21,m=this._b1._invInertia22,f=this._b2._invInertia00,p=this._b2._invInertia01,d=this._b2._invInertia02,u=this._b2._invInertia10,g=this._b2._invInertia11,v=this._b2._invInertia12,x=this._b2._invInertia20,b=this._b2._invInertia21,Y=this._b2._invInertia22;let w=0,Z=this.info.numRows;for(;w<Z;){let z=w++,T=this.massData[z],F=this.info.rows[z].jacobian;T.invMLin1X=F.lin1X*e,T.invMLin1Y=F.lin1Y*e,T.invMLin1Z=F.lin1Z*e,T.invMLin2X=F.lin2X*i,T.invMLin2Y=F.lin2Y*i,T.invMLin2Z=F.lin2Z*i;let P,A,L;P=n*F.ang1X+s*F.ang1Y+o*F.ang1Z,A=r*F.ang1X+_*F.ang1Y+a*F.ang1Z,L=l*F.ang1X+h*F.ang1Y+m*F.ang1Z,T.invMAng1X=P,T.invMAng1Y=A,T.invMAng1Z=L;let S,R,E;S=f*F.ang2X+p*F.ang2Y+d*F.ang2Z,R=u*F.ang2X+g*F.ang2Y+v*F.ang2Z,E=x*F.ang2X+b*F.ang2Y+Y*F.ang2Z,T.invMAng2X=S,T.invMAng2Y=R,T.invMAng2Z=E,T.mass=T.invMLin1X*F.lin1X+T.invMLin1Y*F.lin1Y+T.invMLin1Z*F.lin1Z+(T.invMLin2X*F.lin2X+T.invMLin2Y*F.lin2Y+T.invMLin2Z*F.lin2Z)+(T.invMAng1X*F.ang1X+T.invMAng1Y*F.ang1Y+T.invMAng1Z*F.ang1Z)+(T.invMAng2X*F.ang2X+T.invMAng2Y*F.ang2Y+T.invMAng2Z*F.ang2Z),T.mass!=0&&(T.mass=1/T.mass)}let X=0,M=this.info.numRows;for(;X<M;)this.info.rows[X++].impulse.impulseP=0}solvePositionSplitImpulse(){let t,e,i,n,s,o,r,_,a,l,h,m;t=this._b1._pseudoVelX,e=this._b1._pseudoVelY,i=this._b1._pseudoVelZ,n=this._b2._pseudoVelX,s=this._b2._pseudoVelY,o=this._b2._pseudoVelZ,r=this._b1._angPseudoVelX,_=this._b1._angPseudoVelY,a=this._b1._angPseudoVelZ,l=this._b2._angPseudoVelX,h=this._b2._angPseudoVelY,m=this._b2._angPseudoVelZ;let f=0,p=this.info.numRows;for(;f<p;){let d=f++,u=this.info.rows[d],g=this.massData[d],v=u.impulse,x=u.jacobian,b=0;b+=t*x.lin1X+e*x.lin1Y+i*x.lin1Z,b-=n*x.lin2X+s*x.lin2Y+o*x.lin2Z,b+=r*x.ang1X+_*x.ang1Y+a*x.ang1Z,b-=l*x.ang2X+h*x.ang2Y+m*x.ang2Z;let Y=(u.rhs*y.common.Setting.positionSplitImpulseBaumgarte-b)*g.mass,w=v.impulseP;v.impulseP+=Y,v.impulseP<u.minImpulse?v.impulseP=u.minImpulse:v.impulseP>u.maxImpulse&&(v.impulseP=u.maxImpulse),Y=v.impulseP-w,t+=g.invMLin1X*Y,e+=g.invMLin1Y*Y,i+=g.invMLin1Z*Y,n+=g.invMLin2X*-Y,s+=g.invMLin2Y*-Y,o+=g.invMLin2Z*-Y,r+=g.invMAng1X*Y,_+=g.invMAng1Y*Y,a+=g.invMAng1Z*Y,l+=g.invMAng2X*-Y,h+=g.invMAng2Y*-Y,m+=g.invMAng2Z*-Y}this._b1._pseudoVelX=t,this._b1._pseudoVelY=e,this._b1._pseudoVelZ=i,this._b2._pseudoVelX=n,this._b2._pseudoVelY=s,this._b2._pseudoVelZ=o,this._b1._angPseudoVelX=r,this._b1._angPseudoVelY=_,this._b1._angPseudoVelZ=a,this._b2._angPseudoVelX=l,this._b2._angPseudoVelY=h,this._b2._angPseudoVelZ=m}solvePositionNgs(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;let e=this._b1._invMass,i=this._b2._invMass,n,s,o,r,_,a,l,h,m,f,p,d,u,g,v,x,b,Y;n=this._b1._invInertia00,s=this._b1._invInertia01,o=this._b1._invInertia02,r=this._b1._invInertia10,_=this._b1._invInertia11,a=this._b1._invInertia12,l=this._b1._invInertia20,h=this._b1._invInertia21,m=this._b1._invInertia22,f=this._b2._invInertia00,p=this._b2._invInertia01,d=this._b2._invInertia02,u=this._b2._invInertia10,g=this._b2._invInertia11,v=this._b2._invInertia12,x=this._b2._invInertia20,b=this._b2._invInertia21,Y=this._b2._invInertia22;let w=0,Z=this.info.numRows;for(;w<Z;){let Be=w++,xe=this.massData[Be],qt=this.info.rows[Be].jacobian;xe.invMLin1X=qt.lin1X*e,xe.invMLin1Y=qt.lin1Y*e,xe.invMLin1Z=qt.lin1Z*e,xe.invMLin2X=qt.lin2X*i,xe.invMLin2Y=qt.lin2Y*i,xe.invMLin2Z=qt.lin2Z*i;let Jt,ve,Qt;Jt=n*qt.ang1X+s*qt.ang1Y+o*qt.ang1Z,ve=r*qt.ang1X+_*qt.ang1Y+a*qt.ang1Z,Qt=l*qt.ang1X+h*qt.ang1Y+m*qt.ang1Z,xe.invMAng1X=Jt,xe.invMAng1Y=ve,xe.invMAng1Z=Qt;let zt,Et,Kt;zt=f*qt.ang2X+p*qt.ang2Y+d*qt.ang2Z,Et=u*qt.ang2X+g*qt.ang2Y+v*qt.ang2Z,Kt=x*qt.ang2X+b*qt.ang2Y+Y*qt.ang2Z,xe.invMAng2X=zt,xe.invMAng2Y=Et,xe.invMAng2Z=Kt,xe.mass=xe.invMLin1X*qt.lin1X+xe.invMLin1Y*qt.lin1Y+xe.invMLin1Z*qt.lin1Z+(xe.invMLin2X*qt.lin2X+xe.invMLin2Y*qt.lin2Y+xe.invMLin2Z*qt.lin2Z)+(xe.invMAng1X*qt.ang1X+xe.invMAng1Y*qt.ang1Y+xe.invMAng1Z*qt.ang1Z)+(xe.invMAng2X*qt.ang2X+xe.invMAng2Y*qt.ang2Y+xe.invMAng2Z*qt.ang2Z),xe.mass!=0&&(xe.mass=1/xe.mass)}let X,M,z,T,F,P,A,L,S,R,E,C;X=0,M=0,z=0,T=0,F=0,P=0,A=0,L=0,S=0,R=0,E=0,C=0;let k=0,V=this.info.numRows;for(;k<V;){let Be=k++,xe=this.info.rows[Be],qt=this.massData[Be],Jt=xe.impulse,ve=xe.jacobian,Qt=0;Qt+=X*ve.lin1X+M*ve.lin1Y+z*ve.lin1Z,Qt-=T*ve.lin2X+F*ve.lin2Y+P*ve.lin2Z,Qt+=A*ve.ang1X+L*ve.ang1Y+S*ve.ang1Z,Qt-=R*ve.ang2X+E*ve.ang2Y+C*ve.ang2Z;let zt=(xe.rhs*y.common.Setting.positionNgsBaumgarte-Qt)*qt.mass,Et=Jt.impulseP;Jt.impulseP+=zt,Jt.impulseP<xe.minImpulse?Jt.impulseP=xe.minImpulse:Jt.impulseP>xe.maxImpulse&&(Jt.impulseP=xe.maxImpulse),zt=Jt.impulseP-Et,X+=qt.invMLin1X*zt,M+=qt.invMLin1Y*zt,z+=qt.invMLin1Z*zt,T+=qt.invMLin2X*-zt,F+=qt.invMLin2Y*-zt,P+=qt.invMLin2Z*-zt,A+=qt.invMAng1X*zt,L+=qt.invMAng1Y*zt,S+=qt.invMAng1Z*zt,R+=qt.invMAng2X*-zt,E+=qt.invMAng2Y*-zt,C+=qt.invMAng2Z*-zt}let B=this._b1;B._transform._positionX+=X,B._transform._positionY+=M,B._transform._positionZ+=z;let J=this._b2;J._transform._positionX+=T,J._transform._positionY+=F,J._transform._positionZ+=P;let I=this._b1,G=Math.sqrt(A*A+L*L+S*S),D=G*.5,et,$;if(D<.5){let Be=D*D;et=.5*(1-Be*.16666666666666666+Be*Be*.008333333333333333),$=1-Be*.5+Be*Be*.041666666666666664}else et=Math.sin(D)/G,$=Math.cos(D);let j,q,tt;j=A*et,q=L*et,tt=S*et;let W,U,it,Q;W=j,U=q,it=tt,Q=$;let at,ht,_t,mt,ft=I._transform._rotation00,ut=I._transform._rotation11,H=I._transform._rotation22,O=ft+ut+H,ot;O>0?(ot=Math.sqrt(O+1),mt=.5*ot,ot=.5/ot,at=(I._transform._rotation21-I._transform._rotation12)*ot,ht=(I._transform._rotation02-I._transform._rotation20)*ot,_t=(I._transform._rotation10-I._transform._rotation01)*ot):ft>ut?ft>H?(ot=Math.sqrt(ft-ut-H+1),at=.5*ot,ot=.5/ot,ht=(I._transform._rotation01+I._transform._rotation10)*ot,_t=(I._transform._rotation02+I._transform._rotation20)*ot,mt=(I._transform._rotation21-I._transform._rotation12)*ot):(ot=Math.sqrt(H-ft-ut+1),_t=.5*ot,ot=.5/ot,at=(I._transform._rotation02+I._transform._rotation20)*ot,ht=(I._transform._rotation12+I._transform._rotation21)*ot,mt=(I._transform._rotation10-I._transform._rotation01)*ot):ut>H?(ot=Math.sqrt(ut-H-ft+1),ht=.5*ot,ot=.5/ot,at=(I._transform._rotation01+I._transform._rotation10)*ot,_t=(I._transform._rotation12+I._transform._rotation21)*ot,mt=(I._transform._rotation02-I._transform._rotation20)*ot):(ot=Math.sqrt(H-ft-ut+1),_t=.5*ot,ot=.5/ot,at=(I._transform._rotation02+I._transform._rotation20)*ot,ht=(I._transform._rotation12+I._transform._rotation21)*ot,mt=(I._transform._rotation10-I._transform._rotation01)*ot),at=Q*at+W*mt+U*_t-it*ht,ht=Q*ht-W*_t+U*mt+it*at,_t=Q*_t+W*ht-U*at+it*mt,mt=Q*mt-W*at-U*ht-it*_t;let pt=at*at+ht*ht+_t*_t+mt*mt;pt>1e-32&&(pt=1/Math.sqrt(pt)),at*=pt,ht*=pt,_t*=pt,mt*=pt;let vt=at,xt=ht,Mt=_t,ct=mt,St=2*vt,It=2*xt,dt=2*Mt,K=vt*St,lt=xt*It,rt=Mt*dt,Vt=vt*It,At=xt*dt,Yt=vt*dt,Xt=ct*St,Nt=ct*It,ie=ct*dt;I._transform._rotation00=1-lt-rt,I._transform._rotation01=Vt-ie,I._transform._rotation02=Yt+Nt,I._transform._rotation10=Vt+ie,I._transform._rotation11=1-K-rt,I._transform._rotation12=At-Xt,I._transform._rotation20=Yt-Nt,I._transform._rotation21=At+Xt,I._transform._rotation22=1-K-lt;let ee,Ze,ze,pe,$t,Ht,ue,Ie,qe;ee=I._transform._rotation00*I._invLocalInertia00+I._transform._rotation01*I._invLocalInertia10+I._transform._rotation02*I._invLocalInertia20,Ze=I._transform._rotation00*I._invLocalInertia01+I._transform._rotation01*I._invLocalInertia11+I._transform._rotation02*I._invLocalInertia21,ze=I._transform._rotation00*I._invLocalInertia02+I._transform._rotation01*I._invLocalInertia12+I._transform._rotation02*I._invLocalInertia22,pe=I._transform._rotation10*I._invLocalInertia00+I._transform._rotation11*I._invLocalInertia10+I._transform._rotation12*I._invLocalInertia20,$t=I._transform._rotation10*I._invLocalInertia01+I._transform._rotation11*I._invLocalInertia11+I._transform._rotation12*I._invLocalInertia21,Ht=I._transform._rotation10*I._invLocalInertia02+I._transform._rotation11*I._invLocalInertia12+I._transform._rotation12*I._invLocalInertia22,ue=I._transform._rotation20*I._invLocalInertia00+I._transform._rotation21*I._invLocalInertia10+I._transform._rotation22*I._invLocalInertia20,Ie=I._transform._rotation20*I._invLocalInertia01+I._transform._rotation21*I._invLocalInertia11+I._transform._rotation22*I._invLocalInertia21,qe=I._transform._rotation20*I._invLocalInertia02+I._transform._rotation21*I._invLocalInertia12+I._transform._rotation22*I._invLocalInertia22,I._invInertia00=ee,I._invInertia01=Ze,I._invInertia02=ze,I._invInertia10=pe,I._invInertia11=$t,I._invInertia12=Ht,I._invInertia20=ue,I._invInertia21=Ie,I._invInertia22=qe;let Ee,Ut,nt,gt,yt,bt,st,Pt,Dt;Ee=I._invInertia00*I._transform._rotation00+I._invInertia01*I._transform._rotation01+I._invInertia02*I._transform._rotation02,Ut=I._invInertia00*I._transform._rotation10+I._invInertia01*I._transform._rotation11+I._invInertia02*I._transform._rotation12,nt=I._invInertia00*I._transform._rotation20+I._invInertia01*I._transform._rotation21+I._invInertia02*I._transform._rotation22,gt=I._invInertia10*I._transform._rotation00+I._invInertia11*I._transform._rotation01+I._invInertia12*I._transform._rotation02,yt=I._invInertia10*I._transform._rotation10+I._invInertia11*I._transform._rotation11+I._invInertia12*I._transform._rotation12,bt=I._invInertia10*I._transform._rotation20+I._invInertia11*I._transform._rotation21+I._invInertia12*I._transform._rotation22,st=I._invInertia20*I._transform._rotation00+I._invInertia21*I._transform._rotation01+I._invInertia22*I._transform._rotation02,Pt=I._invInertia20*I._transform._rotation10+I._invInertia21*I._transform._rotation11+I._invInertia22*I._transform._rotation12,Dt=I._invInertia20*I._transform._rotation20+I._invInertia21*I._transform._rotation21+I._invInertia22*I._transform._rotation22,I._invInertia00=Ee,I._invInertia01=Ut,I._invInertia02=nt,I._invInertia10=gt,I._invInertia11=yt,I._invInertia12=bt,I._invInertia20=st,I._invInertia21=Pt,I._invInertia22=Dt,I._invInertia00*=I._rotFactor.x,I._invInertia01*=I._rotFactor.x,I._invInertia02*=I._rotFactor.x,I._invInertia10*=I._rotFactor.y,I._invInertia11*=I._rotFactor.y,I._invInertia12*=I._rotFactor.y,I._invInertia20*=I._rotFactor.z,I._invInertia21*=I._rotFactor.z,I._invInertia22*=I._rotFactor.z;let N=this._b2,kt=Math.sqrt(R*R+E*E+C*C),Rt=kt*.5,Ot,Wt;if(Rt<.5){let Be=Rt*Rt;Ot=.5*(1-Be*.16666666666666666+Be*Be*.008333333333333333),Wt=1-Be*.5+Be*Be*.041666666666666664}else Ot=Math.sin(Rt)/kt,Wt=Math.cos(Rt);let Bt,re,Ce;Bt=R*Ot,re=E*Ot,Ce=C*Ot;let be,Tt,Lt,Zt;be=Bt,Tt=re,Lt=Ce,Zt=Wt;let me,Me,fe,ti,di=N._transform._rotation00,Le=N._transform._rotation11,_i=N._transform._rotation22,yi=di+Le+_i,he;yi>0?(he=Math.sqrt(yi+1),ti=.5*he,he=.5/he,me=(N._transform._rotation21-N._transform._rotation12)*he,Me=(N._transform._rotation02-N._transform._rotation20)*he,fe=(N._transform._rotation10-N._transform._rotation01)*he):di>Le?di>_i?(he=Math.sqrt(di-Le-_i+1),me=.5*he,he=.5/he,Me=(N._transform._rotation01+N._transform._rotation10)*he,fe=(N._transform._rotation02+N._transform._rotation20)*he,ti=(N._transform._rotation21-N._transform._rotation12)*he):(he=Math.sqrt(_i-di-Le+1),fe=.5*he,he=.5/he,me=(N._transform._rotation02+N._transform._rotation20)*he,Me=(N._transform._rotation12+N._transform._rotation21)*he,ti=(N._transform._rotation10-N._transform._rotation01)*he):Le>_i?(he=Math.sqrt(Le-_i-di+1),Me=.5*he,he=.5/he,me=(N._transform._rotation01+N._transform._rotation10)*he,fe=(N._transform._rotation12+N._transform._rotation21)*he,ti=(N._transform._rotation02-N._transform._rotation20)*he):(he=Math.sqrt(_i-di-Le+1),fe=.5*he,he=.5/he,me=(N._transform._rotation02+N._transform._rotation20)*he,Me=(N._transform._rotation12+N._transform._rotation21)*he,ti=(N._transform._rotation10-N._transform._rotation01)*he),me=Zt*me+be*ti+Tt*fe-Lt*Me,Me=Zt*Me-be*fe+Tt*ti+Lt*me,fe=Zt*fe+be*Me-Tt*me+Lt*ti,ti=Zt*ti-be*me-Tt*Me-Lt*fe;let gi=me*me+Me*Me+fe*fe+ti*ti;gi>1e-32&&(gi=1/Math.sqrt(gi)),me*=gi,Me*=gi,fe*=gi,ti*=gi;let bi=me,Mi=Me,Ii=fe,He=ti,Je=2*bi,Ke=2*Mi,ci=2*Ii,hi=bi*Je,ei=Mi*Ke,ai=Ii*ci,Qe=bi*Ke,We=Mi*ci,ke=bi*ci,le=He*Je,ge=He*Ke,jt=He*ci;N._transform._rotation00=1-ei-ai,N._transform._rotation01=Qe-jt,N._transform._rotation02=ke+ge,N._transform._rotation10=Qe+jt,N._transform._rotation11=1-hi-ai,N._transform._rotation12=We-le,N._transform._rotation20=ke-ge,N._transform._rotation21=We+le,N._transform._rotation22=1-hi-ei;let Ae,Se,Re,Te,Ne,se,Ct,Gt,Pe;Ae=N._transform._rotation00*N._invLocalInertia00+N._transform._rotation01*N._invLocalInertia10+N._transform._rotation02*N._invLocalInertia20,Se=N._transform._rotation00*N._invLocalInertia01+N._transform._rotation01*N._invLocalInertia11+N._transform._rotation02*N._invLocalInertia21,Re=N._transform._rotation00*N._invLocalInertia02+N._transform._rotation01*N._invLocalInertia12+N._transform._rotation02*N._invLocalInertia22,Te=N._transform._rotation10*N._invLocalInertia00+N._transform._rotation11*N._invLocalInertia10+N._transform._rotation12*N._invLocalInertia20,Ne=N._transform._rotation10*N._invLocalInertia01+N._transform._rotation11*N._invLocalInertia11+N._transform._rotation12*N._invLocalInertia21,se=N._transform._rotation10*N._invLocalInertia02+N._transform._rotation11*N._invLocalInertia12+N._transform._rotation12*N._invLocalInertia22,Ct=N._transform._rotation20*N._invLocalInertia00+N._transform._rotation21*N._invLocalInertia10+N._transform._rotation22*N._invLocalInertia20,Gt=N._transform._rotation20*N._invLocalInertia01+N._transform._rotation21*N._invLocalInertia11+N._transform._rotation22*N._invLocalInertia21,Pe=N._transform._rotation20*N._invLocalInertia02+N._transform._rotation21*N._invLocalInertia12+N._transform._rotation22*N._invLocalInertia22,N._invInertia00=Ae,N._invInertia01=Se,N._invInertia02=Re,N._invInertia10=Te,N._invInertia11=Ne,N._invInertia12=se,N._invInertia20=Ct,N._invInertia21=Gt,N._invInertia22=Pe;let Ve,Ue,ii,ri,ui,vi,ce,Ge,we;Ve=N._invInertia00*N._transform._rotation00+N._invInertia01*N._transform._rotation01+N._invInertia02*N._transform._rotation02,Ue=N._invInertia00*N._transform._rotation10+N._invInertia01*N._transform._rotation11+N._invInertia02*N._transform._rotation12,ii=N._invInertia00*N._transform._rotation20+N._invInertia01*N._transform._rotation21+N._invInertia02*N._transform._rotation22,ri=N._invInertia10*N._transform._rotation00+N._invInertia11*N._transform._rotation01+N._invInertia12*N._transform._rotation02,ui=N._invInertia10*N._transform._rotation10+N._invInertia11*N._transform._rotation11+N._invInertia12*N._transform._rotation12,vi=N._invInertia10*N._transform._rotation20+N._invInertia11*N._transform._rotation21+N._invInertia12*N._transform._rotation22,ce=N._invInertia20*N._transform._rotation00+N._invInertia21*N._transform._rotation01+N._invInertia22*N._transform._rotation02,Ge=N._invInertia20*N._transform._rotation10+N._invInertia21*N._transform._rotation11+N._invInertia22*N._transform._rotation12,we=N._invInertia20*N._transform._rotation20+N._invInertia21*N._transform._rotation21+N._invInertia22*N._transform._rotation22,N._invInertia00=Ve,N._invInertia01=Ue,N._invInertia02=ii,N._invInertia10=ri,N._invInertia11=ui,N._invInertia12=vi,N._invInertia20=ce,N._invInertia21=Ge,N._invInertia22=we,N._invInertia00*=N._rotFactor.x,N._invInertia01*=N._rotFactor.x,N._invInertia02*=N._rotFactor.x,N._invInertia10*=N._rotFactor.y,N._invInertia11*=N._rotFactor.y,N._invInertia12*=N._rotFactor.y,N._invInertia20*=N._rotFactor.z,N._invInertia21*=N._rotFactor.z,N._invInertia22*=N._rotFactor.z}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}};y.dynamics.rigidbody||(y.dynamics.rigidbody={});y.dynamics.rigidbody.MassData=class{constructor(){this.mass=0,this.localInertia=new y.common.Mat3}};y.dynamics.rigidbody.RigidBody=class{constructor(t){this._next=null,this._prev=null,this._shapeList=null,this._shapeListLast=null,this._numShapes=0,this._contactLinkList=null,this._contactLinkListLast=null,this._numContactLinks=0,this._jointLinkList=null,this._jointLinkListLast=null,this._numJointLinks=0;let e=t.linearVelocity;this._velX=e.x,this._velY=e.y,this._velZ=e.z;let i=t.angularVelocity;this._angVelX=i.x,this._angVelY=i.y,this._angVelZ=i.z,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._ptransform=new y.common.Transform,this._transform=new y.common.Transform;let n=t.position;this._ptransform._positionX=n.x,this._ptransform._positionY=n.y,this._ptransform._positionZ=n.z;let s=t.rotation;this._ptransform._rotation00=s.e00,this._ptransform._rotation01=s.e01,this._ptransform._rotation02=s.e02,this._ptransform._rotation10=s.e10,this._ptransform._rotation11=s.e11,this._ptransform._rotation12=s.e12,this._ptransform._rotation20=s.e20,this._ptransform._rotation21=s.e21,this._ptransform._rotation22=s.e22;let o=this._transform,r=this._ptransform;o._positionX=r._positionX,o._positionY=r._positionY,o._positionZ=r._positionZ,o._rotation00=r._rotation00,o._rotation01=r._rotation01,o._rotation02=r._rotation02,o._rotation10=r._rotation10,o._rotation11=r._rotation11,o._rotation12=r._rotation12,o._rotation20=r._rotation20,o._rotation21=r._rotation21,o._rotation22=r._rotation22,this._type=t.type,this._sleepTime=0,this._sleeping=!1,this._autoSleep=t.autoSleep,this._mass=0,this._invMass=0,this._localInertia00=0,this._localInertia01=0,this._localInertia02=0,this._localInertia10=0,this._localInertia11=0,this._localInertia12=0,this._localInertia20=0,this._localInertia21=0,this._localInertia22=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._invInertia00=0,this._invInertia01=0,this._invInertia02=0,this._invInertia10=0,this._invInertia11=0,this._invInertia12=0,this._invInertia20=0,this._invInertia21=0,this._invInertia22=0,this._linearDamping=t.linearDamping,this._angularDamping=t.angularDamping,this._forceX=0,this._forceY=0,this._forceZ=0,this._torqueX=0,this._torqueY=0,this._torqueZ=0,this._linearContactImpulseX=0,this._linearContactImpulseY=0,this._linearContactImpulseZ=0,this._angularContactImpulseX=0,this._angularContactImpulseY=0,this._angularContactImpulseZ=0,this._rotFactor=new y.common.Vec3(1,1,1),this._addedToIsland=!1,this._gravityScale=1,this._world=null}_integrate(t){switch(this._type){case 1:this._velX=0,this._velY=0,this._velZ=0,this._angVelX=0,this._angVelY=0,this._angVelZ=0,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:let e,i,n,s,o,r;e=this._velX*t,i=this._velY*t,n=this._velZ*t,s=this._angVelX*t,o=this._angVelY*t,r=this._angVelZ*t;let _=e*e+i*i+n*n,a=s*s+o*o+r*r;if(_==0&&a==0)return;if(_>y.common.Setting.maxTranslationPerStep*y.common.Setting.maxTranslationPerStep){let ct=y.common.Setting.maxTranslationPerStep/Math.sqrt(_);this._velX*=ct,this._velY*=ct,this._velZ*=ct,e*=ct,i*=ct,n*=ct}if(a>y.common.Setting.maxRotationPerStep*y.common.Setting.maxRotationPerStep){let ct=y.common.Setting.maxRotationPerStep/Math.sqrt(a);this._angVelX*=ct,this._angVelY*=ct,this._angVelZ*=ct,s*=ct,o*=ct,r*=ct}this._transform._positionX+=e,this._transform._positionY+=i,this._transform._positionZ+=n;let l=Math.sqrt(s*s+o*o+r*r),h=l*.5,m,f;if(h<.5){let ct=h*h;m=.5*(1-ct*.16666666666666666+ct*ct*.008333333333333333),f=1-ct*.5+ct*ct*.041666666666666664}else m=Math.sin(h)/l,f=Math.cos(h);let p,d,u;p=s*m,d=o*m,u=r*m;let g,v,x,b;g=p,v=d,x=u,b=f;let Y,w,Z,X,M=this._transform._rotation00,z=this._transform._rotation11,T=this._transform._rotation22,F=M+z+T,P;F>0?(P=Math.sqrt(F+1),X=.5*P,P=.5/P,Y=(this._transform._rotation21-this._transform._rotation12)*P,w=(this._transform._rotation02-this._transform._rotation20)*P,Z=(this._transform._rotation10-this._transform._rotation01)*P):M>z?M>T?(P=Math.sqrt(M-z-T+1),Y=.5*P,P=.5/P,w=(this._transform._rotation01+this._transform._rotation10)*P,Z=(this._transform._rotation02+this._transform._rotation20)*P,X=(this._transform._rotation21-this._transform._rotation12)*P):(P=Math.sqrt(T-M-z+1),Z=.5*P,P=.5/P,Y=(this._transform._rotation02+this._transform._rotation20)*P,w=(this._transform._rotation12+this._transform._rotation21)*P,X=(this._transform._rotation10-this._transform._rotation01)*P):z>T?(P=Math.sqrt(z-T-M+1),w=.5*P,P=.5/P,Y=(this._transform._rotation01+this._transform._rotation10)*P,Z=(this._transform._rotation12+this._transform._rotation21)*P,X=(this._transform._rotation02-this._transform._rotation20)*P):(P=Math.sqrt(T-M-z+1),Z=.5*P,P=.5/P,Y=(this._transform._rotation02+this._transform._rotation20)*P,w=(this._transform._rotation12+this._transform._rotation21)*P,X=(this._transform._rotation10-this._transform._rotation01)*P),Y=b*Y+g*X+v*Z-x*w,w=b*w-g*Z+v*X+x*Y,Z=b*Z+g*w-v*Y+x*X,X=b*X-g*Y-v*w-x*Z;let A=Y*Y+w*w+Z*Z+X*X;A>1e-32&&(A=1/Math.sqrt(A)),Y*=A,w*=A,Z*=A,X*=A;let L=Y,S=w,R=Z,E=X,C=2*L,k=2*S,V=2*R,B=L*C,J=S*k,I=R*V,G=L*k,D=S*V,et=L*V,$=E*C,j=E*k,q=E*V;this._transform._rotation00=1-J-I,this._transform._rotation01=G-q,this._transform._rotation02=et+j,this._transform._rotation10=G+q,this._transform._rotation11=1-B-I,this._transform._rotation12=D-$,this._transform._rotation20=et-j,this._transform._rotation21=D+$,this._transform._rotation22=1-B-J;let tt,W,U,it,Q,at,ht,_t,mt;tt=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,W=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,U=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,it=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,Q=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,at=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,ht=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_t=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,mt=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=tt,this._invInertia01=W,this._invInertia02=U,this._invInertia10=it,this._invInertia11=Q,this._invInertia12=at,this._invInertia20=ht,this._invInertia21=_t,this._invInertia22=mt;let ft,ut,H,O,ot,pt,vt,xt,Mt;ft=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,ut=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,H=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,O=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,ot=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,pt=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,vt=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,xt=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,Mt=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=ft,this._invInertia01=ut,this._invInertia02=H,this._invInertia10=O,this._invInertia11=ot,this._invInertia12=pt,this._invInertia20=vt,this._invInertia21=xt,this._invInertia22=Mt,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;break}}_integratePseudoVelocity(){if(!(this._pseudoVelX*this._pseudoVelX+this._pseudoVelY*this._pseudoVelY+this._pseudoVelZ*this._pseudoVelZ==0&&this._angPseudoVelX*this._angPseudoVelX+this._angPseudoVelY*this._angPseudoVelY+this._angPseudoVelZ*this._angPseudoVelZ==0))switch(this._type){case 1:this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:let t,e,i,n,s,o;t=this._pseudoVelX,e=this._pseudoVelY,i=this._pseudoVelZ,n=this._angPseudoVelX,s=this._angPseudoVelY,o=this._angPseudoVelZ,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._transform._positionX+=t,this._transform._positionY+=e,this._transform._positionZ+=i;let r=Math.sqrt(n*n+s*s+o*o),_=r*.5,a,l;if(_<.5){let vt=_*_;a=.5*(1-vt*.16666666666666666+vt*vt*.008333333333333333),l=1-vt*.5+vt*vt*.041666666666666664}else a=Math.sin(_)/r,l=Math.cos(_);let h,m,f;h=n*a,m=s*a,f=o*a;let p,d,u,g;p=h,d=m,u=f,g=l;let v,x,b,Y,w=this._transform._rotation00,Z=this._transform._rotation11,X=this._transform._rotation22,M=w+Z+X,z;M>0?(z=Math.sqrt(M+1),Y=.5*z,z=.5/z,v=(this._transform._rotation21-this._transform._rotation12)*z,x=(this._transform._rotation02-this._transform._rotation20)*z,b=(this._transform._rotation10-this._transform._rotation01)*z):w>Z?w>X?(z=Math.sqrt(w-Z-X+1),v=.5*z,z=.5/z,x=(this._transform._rotation01+this._transform._rotation10)*z,b=(this._transform._rotation02+this._transform._rotation20)*z,Y=(this._transform._rotation21-this._transform._rotation12)*z):(z=Math.sqrt(X-w-Z+1),b=.5*z,z=.5/z,v=(this._transform._rotation02+this._transform._rotation20)*z,x=(this._transform._rotation12+this._transform._rotation21)*z,Y=(this._transform._rotation10-this._transform._rotation01)*z):Z>X?(z=Math.sqrt(Z-X-w+1),x=.5*z,z=.5/z,v=(this._transform._rotation01+this._transform._rotation10)*z,b=(this._transform._rotation12+this._transform._rotation21)*z,Y=(this._transform._rotation02-this._transform._rotation20)*z):(z=Math.sqrt(X-w-Z+1),b=.5*z,z=.5/z,v=(this._transform._rotation02+this._transform._rotation20)*z,x=(this._transform._rotation12+this._transform._rotation21)*z,Y=(this._transform._rotation10-this._transform._rotation01)*z),v=g*v+p*Y+d*b-u*x,x=g*x-p*b+d*Y+u*v,b=g*b+p*x-d*v+u*Y,Y=g*Y-p*v-d*x-u*b;let T=v*v+x*x+b*b+Y*Y;T>1e-32&&(T=1/Math.sqrt(T)),v*=T,x*=T,b*=T,Y*=T;let F=v,P=x,A=b,L=Y,S=2*F,R=2*P,E=2*A,C=F*S,k=P*R,V=A*E,B=F*R,J=P*E,I=F*E,G=L*S,D=L*R,et=L*E;this._transform._rotation00=1-k-V,this._transform._rotation01=B-et,this._transform._rotation02=I+D,this._transform._rotation10=B+et,this._transform._rotation11=1-C-V,this._transform._rotation12=J-G,this._transform._rotation20=I-D,this._transform._rotation21=J+G,this._transform._rotation22=1-C-k;let $,j,q,tt,W,U,it,Q,at;$=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,j=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,q=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,tt=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,W=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,U=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,it=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,Q=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,at=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=$,this._invInertia01=j,this._invInertia02=q,this._invInertia10=tt,this._invInertia11=W,this._invInertia12=U,this._invInertia20=it,this._invInertia21=Q,this._invInertia22=at;let ht,_t,mt,ft,ut,H,O,ot,pt;ht=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,_t=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,mt=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,ft=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,ut=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,H=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,O=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,ot=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,pt=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=ht,this._invInertia01=_t,this._invInertia02=mt,this._invInertia10=ft,this._invInertia11=ut,this._invInertia12=H,this._invInertia20=O,this._invInertia21=ot,this._invInertia22=pt,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;break}}updateMass(){let t,e,i,n,s,o,r,_,a;t=0,e=0,i=0,n=0,s=0,o=0,r=0,_=0,a=0;let l=0,h=this._shapeList;for(;h!=null;){let A=h._next,L=h._geom;L._updateMass();let S=h._density*L._volume,R,E,C,k,V,B,J,I,G,D,et,$,j,q,tt,W,U,it;D=h._localTransform._rotation00*L._inertiaCoeff00+h._localTransform._rotation01*L._inertiaCoeff10+h._localTransform._rotation02*L._inertiaCoeff20,et=h._localTransform._rotation00*L._inertiaCoeff01+h._localTransform._rotation01*L._inertiaCoeff11+h._localTransform._rotation02*L._inertiaCoeff21,$=h._localTransform._rotation00*L._inertiaCoeff02+h._localTransform._rotation01*L._inertiaCoeff12+h._localTransform._rotation02*L._inertiaCoeff22,j=h._localTransform._rotation10*L._inertiaCoeff00+h._localTransform._rotation11*L._inertiaCoeff10+h._localTransform._rotation12*L._inertiaCoeff20,q=h._localTransform._rotation10*L._inertiaCoeff01+h._localTransform._rotation11*L._inertiaCoeff11+h._localTransform._rotation12*L._inertiaCoeff21,tt=h._localTransform._rotation10*L._inertiaCoeff02+h._localTransform._rotation11*L._inertiaCoeff12+h._localTransform._rotation12*L._inertiaCoeff22,W=h._localTransform._rotation20*L._inertiaCoeff00+h._localTransform._rotation21*L._inertiaCoeff10+h._localTransform._rotation22*L._inertiaCoeff20,U=h._localTransform._rotation20*L._inertiaCoeff01+h._localTransform._rotation21*L._inertiaCoeff11+h._localTransform._rotation22*L._inertiaCoeff21,it=h._localTransform._rotation20*L._inertiaCoeff02+h._localTransform._rotation21*L._inertiaCoeff12+h._localTransform._rotation22*L._inertiaCoeff22,R=D,E=et,C=$,k=j,V=q,B=tt,J=W,I=U,G=it;let Q,at,ht,_t,mt,ft,ut,H,O;Q=R*h._localTransform._rotation00+E*h._localTransform._rotation01+C*h._localTransform._rotation02,at=R*h._localTransform._rotation10+E*h._localTransform._rotation11+C*h._localTransform._rotation12,ht=R*h._localTransform._rotation20+E*h._localTransform._rotation21+C*h._localTransform._rotation22,_t=k*h._localTransform._rotation00+V*h._localTransform._rotation01+B*h._localTransform._rotation02,mt=k*h._localTransform._rotation10+V*h._localTransform._rotation11+B*h._localTransform._rotation12,ft=k*h._localTransform._rotation20+V*h._localTransform._rotation21+B*h._localTransform._rotation22,ut=J*h._localTransform._rotation00+I*h._localTransform._rotation01+G*h._localTransform._rotation02,H=J*h._localTransform._rotation10+I*h._localTransform._rotation11+G*h._localTransform._rotation12,O=J*h._localTransform._rotation20+I*h._localTransform._rotation21+G*h._localTransform._rotation22,R=Q,E=at,C=ht,k=_t,V=mt,B=ft,J=ut,I=H,G=O,R*=S,E*=S,C*=S,k*=S,V*=S,B*=S,J*=S,I*=S,G*=S;let ot,pt,vt,xt,Mt,ct,St,It,dt,K=h._localTransform._positionX*h._localTransform._positionX,lt=h._localTransform._positionY*h._localTransform._positionY,rt=h._localTransform._positionZ*h._localTransform._positionZ,Vt=-h._localTransform._positionX*h._localTransform._positionY,At=-h._localTransform._positionY*h._localTransform._positionZ,Yt=-h._localTransform._positionZ*h._localTransform._positionX;ot=lt+rt,pt=Vt,vt=Yt,xt=Vt,Mt=K+rt,ct=At,St=Yt,It=At,dt=K+lt,R+=ot*S,E+=pt*S,C+=vt*S,k+=xt*S,V+=Mt*S,B+=ct*S,J+=St*S,I+=It*S,G+=dt*S,l+=S,t+=R,e+=E,i+=C,n+=k,s+=V,o+=B,r+=J,_+=I,a+=G,h=A}if(this._mass=l,this._localInertia00=t,this._localInertia01=e,this._localInertia02=i,this._localInertia10=n,this._localInertia11=s,this._localInertia12=o,this._localInertia20=r,this._localInertia21=_,this._localInertia22=a,this._mass>0&&this._localInertia00*(this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21)-this._localInertia01*(this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20)+this._localInertia02*(this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20)>0&&this._type==0){this._invMass=1/this._mass;let A=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,L=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,S=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,R=this._localInertia00*A-this._localInertia01*L+this._localInertia02*S;(R<-1e-32||R>1e-32)&&(R=1/R),this._invLocalInertia00=A*R,this._invLocalInertia01=-(this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21)*R,this._invLocalInertia02=(this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11)*R,this._invLocalInertia10=-L*R,this._invLocalInertia11=(this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20)*R,this._invLocalInertia12=-(this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10)*R,this._invLocalInertia20=S*R,this._invLocalInertia21=-(this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20)*R,this._invLocalInertia22=(this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10)*R,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._type==0&&(this._type=1);let m,f,p,d,u,g,v,x,b;m=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,f=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,p=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,d=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,u=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,g=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,v=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,x=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,b=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=m,this._invInertia01=f,this._invInertia02=p,this._invInertia10=d,this._invInertia11=u,this._invInertia12=g,this._invInertia20=v,this._invInertia21=x,this._invInertia22=b;let Y,w,Z,X,M,z,T,F,P;Y=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,w=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,Z=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,X=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,M=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,z=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,T=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,F=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,P=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=Y,this._invInertia01=w,this._invInertia02=Z,this._invInertia10=X,this._invInertia11=M,this._invInertia12=z,this._invInertia20=T,this._invInertia21=F,this._invInertia22=P,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getPosition(){let t=new y.common.Vec3;return t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ,t}getPositionTo(t){t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ}setPosition(t){this._transform._positionX=t.x,this._transform._positionY=t.y,this._transform._positionZ=t.z;let e=this._ptransform,i=this._transform;e._positionX=i._positionX,e._positionY=i._positionY,e._positionZ=i._positionZ,e._rotation00=i._rotation00,e._rotation01=i._rotation01,e._rotation02=i._rotation02,e._rotation10=i._rotation10,e._rotation11=i._rotation11,e._rotation12=i._rotation12,e._rotation20=i._rotation20,e._rotation21=i._rotation21,e._rotation22=i._rotation22;let n=this._shapeList;for(;n!=null;){let s=n._next,o=this._ptransform,r=this._transform,_=n._ptransform,a=n._localTransform,l,h,m,f,p,d,u,g,v;l=o._rotation00*a._rotation00+o._rotation01*a._rotation10+o._rotation02*a._rotation20,h=o._rotation00*a._rotation01+o._rotation01*a._rotation11+o._rotation02*a._rotation21,m=o._rotation00*a._rotation02+o._rotation01*a._rotation12+o._rotation02*a._rotation22,f=o._rotation10*a._rotation00+o._rotation11*a._rotation10+o._rotation12*a._rotation20,p=o._rotation10*a._rotation01+o._rotation11*a._rotation11+o._rotation12*a._rotation21,d=o._rotation10*a._rotation02+o._rotation11*a._rotation12+o._rotation12*a._rotation22,u=o._rotation20*a._rotation00+o._rotation21*a._rotation10+o._rotation22*a._rotation20,g=o._rotation20*a._rotation01+o._rotation21*a._rotation11+o._rotation22*a._rotation21,v=o._rotation20*a._rotation02+o._rotation21*a._rotation12+o._rotation22*a._rotation22,_._rotation00=l,_._rotation01=h,_._rotation02=m,_._rotation10=f,_._rotation11=p,_._rotation12=d,_._rotation20=u,_._rotation21=g,_._rotation22=v;let x,b,Y;x=o._rotation00*a._positionX+o._rotation01*a._positionY+o._rotation02*a._positionZ,b=o._rotation10*a._positionX+o._rotation11*a._positionY+o._rotation12*a._positionZ,Y=o._rotation20*a._positionX+o._rotation21*a._positionY+o._rotation22*a._positionZ,_._positionX=x,_._positionY=b,_._positionZ=Y,_._positionX+=o._positionX,_._positionY+=o._positionY,_._positionZ+=o._positionZ;let w=n._transform,Z=n._localTransform,X,M,z,T,F,P,A,L,S;X=r._rotation00*Z._rotation00+r._rotation01*Z._rotation10+r._rotation02*Z._rotation20,M=r._rotation00*Z._rotation01+r._rotation01*Z._rotation11+r._rotation02*Z._rotation21,z=r._rotation00*Z._rotation02+r._rotation01*Z._rotation12+r._rotation02*Z._rotation22,T=r._rotation10*Z._rotation00+r._rotation11*Z._rotation10+r._rotation12*Z._rotation20,F=r._rotation10*Z._rotation01+r._rotation11*Z._rotation11+r._rotation12*Z._rotation21,P=r._rotation10*Z._rotation02+r._rotation11*Z._rotation12+r._rotation12*Z._rotation22,A=r._rotation20*Z._rotation00+r._rotation21*Z._rotation10+r._rotation22*Z._rotation20,L=r._rotation20*Z._rotation01+r._rotation21*Z._rotation11+r._rotation22*Z._rotation21,S=r._rotation20*Z._rotation02+r._rotation21*Z._rotation12+r._rotation22*Z._rotation22,w._rotation00=X,w._rotation01=M,w._rotation02=z,w._rotation10=T,w._rotation11=F,w._rotation12=P,w._rotation20=A,w._rotation21=L,w._rotation22=S;let R,E,C;R=r._rotation00*Z._positionX+r._rotation01*Z._positionY+r._rotation02*Z._positionZ,E=r._rotation10*Z._positionX+r._rotation11*Z._positionY+r._rotation12*Z._positionZ,C=r._rotation20*Z._positionX+r._rotation21*Z._positionY+r._rotation22*Z._positionZ,w._positionX=R,w._positionY=E,w._positionZ=C,w._positionX+=r._positionX,w._positionY+=r._positionY,w._positionZ+=r._positionZ;let k,V,B,J,I,G;if(n._geom._computeAabb(n._aabb,n._ptransform),k=n._aabb._minX,V=n._aabb._minY,B=n._aabb._minZ,J=n._aabb._maxX,I=n._aabb._maxY,G=n._aabb._maxZ,n._geom._computeAabb(n._aabb,n._transform),n._aabb._minX=k<n._aabb._minX?k:n._aabb._minX,n._aabb._minY=V<n._aabb._minY?V:n._aabb._minY,n._aabb._minZ=B<n._aabb._minZ?B:n._aabb._minZ,n._aabb._maxX=J>n._aabb._maxX?J:n._aabb._maxX,n._aabb._maxY=I>n._aabb._maxY?I:n._aabb._maxY,n._aabb._maxZ=G>n._aabb._maxZ?G:n._aabb._maxZ,n._proxy!=null){let D,et,$;D=n._transform._positionX-n._ptransform._positionX,et=n._transform._positionY-n._ptransform._positionY,$=n._transform._positionZ-n._ptransform._positionZ;let j=n.displacement;j.x=D,j.y=et,j.z=$,n._rigidBody._world._broadPhase.moveProxy(n._proxy,n._aabb,n.displacement)}n=s}this._sleeping=!1,this._sleepTime=0}translate(t){let e,i,n;e=t.x,i=t.y,n=t.z,this._transform._positionX+=e,this._transform._positionY+=i,this._transform._positionZ+=n;let s=this._ptransform,o=this._transform;s._positionX=o._positionX,s._positionY=o._positionY,s._positionZ=o._positionZ,s._rotation00=o._rotation00,s._rotation01=o._rotation01,s._rotation02=o._rotation02,s._rotation10=o._rotation10,s._rotation11=o._rotation11,s._rotation12=o._rotation12,s._rotation20=o._rotation20,s._rotation21=o._rotation21,s._rotation22=o._rotation22;let r=this._shapeList;for(;r!=null;){let _=r._next,a=this._ptransform,l=this._transform,h=r._ptransform,m=r._localTransform,f,p,d,u,g,v,x,b,Y;f=a._rotation00*m._rotation00+a._rotation01*m._rotation10+a._rotation02*m._rotation20,p=a._rotation00*m._rotation01+a._rotation01*m._rotation11+a._rotation02*m._rotation21,d=a._rotation00*m._rotation02+a._rotation01*m._rotation12+a._rotation02*m._rotation22,u=a._rotation10*m._rotation00+a._rotation11*m._rotation10+a._rotation12*m._rotation20,g=a._rotation10*m._rotation01+a._rotation11*m._rotation11+a._rotation12*m._rotation21,v=a._rotation10*m._rotation02+a._rotation11*m._rotation12+a._rotation12*m._rotation22,x=a._rotation20*m._rotation00+a._rotation21*m._rotation10+a._rotation22*m._rotation20,b=a._rotation20*m._rotation01+a._rotation21*m._rotation11+a._rotation22*m._rotation21,Y=a._rotation20*m._rotation02+a._rotation21*m._rotation12+a._rotation22*m._rotation22,h._rotation00=f,h._rotation01=p,h._rotation02=d,h._rotation10=u,h._rotation11=g,h._rotation12=v,h._rotation20=x,h._rotation21=b,h._rotation22=Y;let w,Z,X;w=a._rotation00*m._positionX+a._rotation01*m._positionY+a._rotation02*m._positionZ,Z=a._rotation10*m._positionX+a._rotation11*m._positionY+a._rotation12*m._positionZ,X=a._rotation20*m._positionX+a._rotation21*m._positionY+a._rotation22*m._positionZ,h._positionX=w,h._positionY=Z,h._positionZ=X,h._positionX+=a._positionX,h._positionY+=a._positionY,h._positionZ+=a._positionZ;let M=r._transform,z=r._localTransform,T,F,P,A,L,S,R,E,C;T=l._rotation00*z._rotation00+l._rotation01*z._rotation10+l._rotation02*z._rotation20,F=l._rotation00*z._rotation01+l._rotation01*z._rotation11+l._rotation02*z._rotation21,P=l._rotation00*z._rotation02+l._rotation01*z._rotation12+l._rotation02*z._rotation22,A=l._rotation10*z._rotation00+l._rotation11*z._rotation10+l._rotation12*z._rotation20,L=l._rotation10*z._rotation01+l._rotation11*z._rotation11+l._rotation12*z._rotation21,S=l._rotation10*z._rotation02+l._rotation11*z._rotation12+l._rotation12*z._rotation22,R=l._rotation20*z._rotation00+l._rotation21*z._rotation10+l._rotation22*z._rotation20,E=l._rotation20*z._rotation01+l._rotation21*z._rotation11+l._rotation22*z._rotation21,C=l._rotation20*z._rotation02+l._rotation21*z._rotation12+l._rotation22*z._rotation22,M._rotation00=T,M._rotation01=F,M._rotation02=P,M._rotation10=A,M._rotation11=L,M._rotation12=S,M._rotation20=R,M._rotation21=E,M._rotation22=C;let k,V,B;k=l._rotation00*z._positionX+l._rotation01*z._positionY+l._rotation02*z._positionZ,V=l._rotation10*z._positionX+l._rotation11*z._positionY+l._rotation12*z._positionZ,B=l._rotation20*z._positionX+l._rotation21*z._positionY+l._rotation22*z._positionZ,M._positionX=k,M._positionY=V,M._positionZ=B,M._positionX+=l._positionX,M._positionY+=l._positionY,M._positionZ+=l._positionZ;let J,I,G,D,et,$;if(r._geom._computeAabb(r._aabb,r._ptransform),J=r._aabb._minX,I=r._aabb._minY,G=r._aabb._minZ,D=r._aabb._maxX,et=r._aabb._maxY,$=r._aabb._maxZ,r._geom._computeAabb(r._aabb,r._transform),r._aabb._minX=J<r._aabb._minX?J:r._aabb._minX,r._aabb._minY=I<r._aabb._minY?I:r._aabb._minY,r._aabb._minZ=G<r._aabb._minZ?G:r._aabb._minZ,r._aabb._maxX=D>r._aabb._maxX?D:r._aabb._maxX,r._aabb._maxY=et>r._aabb._maxY?et:r._aabb._maxY,r._aabb._maxZ=$>r._aabb._maxZ?$:r._aabb._maxZ,r._proxy!=null){let j,q,tt;j=r._transform._positionX-r._ptransform._positionX,q=r._transform._positionY-r._ptransform._positionY,tt=r._transform._positionZ-r._ptransform._positionZ;let W=r.displacement;W.x=j,W.y=q,W.z=tt,r._rigidBody._world._broadPhase.moveProxy(r._proxy,r._aabb,r.displacement)}r=_}this._sleeping=!1,this._sleepTime=0}getRotation(){let t=new y.common.Mat3;return t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22,t}getRotationTo(t){t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22}setRotation(t){this._transform._rotation00=t.e00,this._transform._rotation01=t.e01,this._transform._rotation02=t.e02,this._transform._rotation10=t.e10,this._transform._rotation11=t.e11,this._transform._rotation12=t.e12,this._transform._rotation20=t.e20,this._transform._rotation21=t.e21,this._transform._rotation22=t.e22;let e,i,n,s,o,r,_,a,l;e=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,i=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,n=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,s=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,o=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,r=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,_=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,a=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=e,this._invInertia01=i,this._invInertia02=n,this._invInertia10=s,this._invInertia11=o,this._invInertia12=r,this._invInertia20=_,this._invInertia21=a,this._invInertia22=l;let h,m,f,p,d,u,g,v,x;h=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,m=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,f=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,p=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,d=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,u=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,g=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,v=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,x=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=h,this._invInertia01=m,this._invInertia02=f,this._invInertia10=p,this._invInertia11=d,this._invInertia12=u,this._invInertia20=g,this._invInertia21=v,this._invInertia22=x,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let b=this._ptransform,Y=this._transform;b._positionX=Y._positionX,b._positionY=Y._positionY,b._positionZ=Y._positionZ,b._rotation00=Y._rotation00,b._rotation01=Y._rotation01,b._rotation02=Y._rotation02,b._rotation10=Y._rotation10,b._rotation11=Y._rotation11,b._rotation12=Y._rotation12,b._rotation20=Y._rotation20,b._rotation21=Y._rotation21,b._rotation22=Y._rotation22;let w=this._shapeList;for(;w!=null;){let Z=w._next,X=this._ptransform,M=this._transform,z=w._ptransform,T=w._localTransform,F,P,A,L,S,R,E,C,k;F=X._rotation00*T._rotation00+X._rotation01*T._rotation10+X._rotation02*T._rotation20,P=X._rotation00*T._rotation01+X._rotation01*T._rotation11+X._rotation02*T._rotation21,A=X._rotation00*T._rotation02+X._rotation01*T._rotation12+X._rotation02*T._rotation22,L=X._rotation10*T._rotation00+X._rotation11*T._rotation10+X._rotation12*T._rotation20,S=X._rotation10*T._rotation01+X._rotation11*T._rotation11+X._rotation12*T._rotation21,R=X._rotation10*T._rotation02+X._rotation11*T._rotation12+X._rotation12*T._rotation22,E=X._rotation20*T._rotation00+X._rotation21*T._rotation10+X._rotation22*T._rotation20,C=X._rotation20*T._rotation01+X._rotation21*T._rotation11+X._rotation22*T._rotation21,k=X._rotation20*T._rotation02+X._rotation21*T._rotation12+X._rotation22*T._rotation22,z._rotation00=F,z._rotation01=P,z._rotation02=A,z._rotation10=L,z._rotation11=S,z._rotation12=R,z._rotation20=E,z._rotation21=C,z._rotation22=k;let V,B,J;V=X._rotation00*T._positionX+X._rotation01*T._positionY+X._rotation02*T._positionZ,B=X._rotation10*T._positionX+X._rotation11*T._positionY+X._rotation12*T._positionZ,J=X._rotation20*T._positionX+X._rotation21*T._positionY+X._rotation22*T._positionZ,z._positionX=V,z._positionY=B,z._positionZ=J,z._positionX+=X._positionX,z._positionY+=X._positionY,z._positionZ+=X._positionZ;let I=w._transform,G=w._localTransform,D,et,$,j,q,tt,W,U,it;D=M._rotation00*G._rotation00+M._rotation01*G._rotation10+M._rotation02*G._rotation20,et=M._rotation00*G._rotation01+M._rotation01*G._rotation11+M._rotation02*G._rotation21,$=M._rotation00*G._rotation02+M._rotation01*G._rotation12+M._rotation02*G._rotation22,j=M._rotation10*G._rotation00+M._rotation11*G._rotation10+M._rotation12*G._rotation20,q=M._rotation10*G._rotation01+M._rotation11*G._rotation11+M._rotation12*G._rotation21,tt=M._rotation10*G._rotation02+M._rotation11*G._rotation12+M._rotation12*G._rotation22,W=M._rotation20*G._rotation00+M._rotation21*G._rotation10+M._rotation22*G._rotation20,U=M._rotation20*G._rotation01+M._rotation21*G._rotation11+M._rotation22*G._rotation21,it=M._rotation20*G._rotation02+M._rotation21*G._rotation12+M._rotation22*G._rotation22,I._rotation00=D,I._rotation01=et,I._rotation02=$,I._rotation10=j,I._rotation11=q,I._rotation12=tt,I._rotation20=W,I._rotation21=U,I._rotation22=it;let Q,at,ht;Q=M._rotation00*G._positionX+M._rotation01*G._positionY+M._rotation02*G._positionZ,at=M._rotation10*G._positionX+M._rotation11*G._positionY+M._rotation12*G._positionZ,ht=M._rotation20*G._positionX+M._rotation21*G._positionY+M._rotation22*G._positionZ,I._positionX=Q,I._positionY=at,I._positionZ=ht,I._positionX+=M._positionX,I._positionY+=M._positionY,I._positionZ+=M._positionZ;let _t,mt,ft,ut,H,O;if(w._geom._computeAabb(w._aabb,w._ptransform),_t=w._aabb._minX,mt=w._aabb._minY,ft=w._aabb._minZ,ut=w._aabb._maxX,H=w._aabb._maxY,O=w._aabb._maxZ,w._geom._computeAabb(w._aabb,w._transform),w._aabb._minX=_t<w._aabb._minX?_t:w._aabb._minX,w._aabb._minY=mt<w._aabb._minY?mt:w._aabb._minY,w._aabb._minZ=ft<w._aabb._minZ?ft:w._aabb._minZ,w._aabb._maxX=ut>w._aabb._maxX?ut:w._aabb._maxX,w._aabb._maxY=H>w._aabb._maxY?H:w._aabb._maxY,w._aabb._maxZ=O>w._aabb._maxZ?O:w._aabb._maxZ,w._proxy!=null){let ot,pt,vt;ot=w._transform._positionX-w._ptransform._positionX,pt=w._transform._positionY-w._ptransform._positionY,vt=w._transform._positionZ-w._ptransform._positionZ;let xt=w.displacement;xt.x=ot,xt.y=pt,xt.z=vt,w._rigidBody._world._broadPhase.moveProxy(w._proxy,w._aabb,w.displacement)}w=Z}this._sleeping=!1,this._sleepTime=0}setRotationXyz(t){let e,i,n;e=t.x,i=t.y,n=t.z;let s=Math.sin(e),o=Math.sin(i),r=Math.sin(n),_=Math.cos(e),a=Math.cos(i),l=Math.cos(n);this._transform._rotation00=a*l,this._transform._rotation01=-a*r,this._transform._rotation02=o,this._transform._rotation10=_*r+l*s*o,this._transform._rotation11=_*l-s*o*r,this._transform._rotation12=-a*s,this._transform._rotation20=s*r-_*l*o,this._transform._rotation21=l*s+_*o*r,this._transform._rotation22=_*a;let h,m,f,p,d,u,g,v,x;h=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,m=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,f=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,p=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,d=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,u=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,g=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,v=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,x=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=h,this._invInertia01=m,this._invInertia02=f,this._invInertia10=p,this._invInertia11=d,this._invInertia12=u,this._invInertia20=g,this._invInertia21=v,this._invInertia22=x;let b,Y,w,Z,X,M,z,T,F;b=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,Y=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,w=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,Z=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,X=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,M=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,z=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,T=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,F=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=b,this._invInertia01=Y,this._invInertia02=w,this._invInertia10=Z,this._invInertia11=X,this._invInertia12=M,this._invInertia20=z,this._invInertia21=T,this._invInertia22=F,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let P=this._ptransform,A=this._transform;P._positionX=A._positionX,P._positionY=A._positionY,P._positionZ=A._positionZ,P._rotation00=A._rotation00,P._rotation01=A._rotation01,P._rotation02=A._rotation02,P._rotation10=A._rotation10,P._rotation11=A._rotation11,P._rotation12=A._rotation12,P._rotation20=A._rotation20,P._rotation21=A._rotation21,P._rotation22=A._rotation22;let L=this._shapeList;for(;L!=null;){let S=L._next,R=this._ptransform,E=this._transform,C=L._ptransform,k=L._localTransform,V,B,J,I,G,D,et,$,j;V=R._rotation00*k._rotation00+R._rotation01*k._rotation10+R._rotation02*k._rotation20,B=R._rotation00*k._rotation01+R._rotation01*k._rotation11+R._rotation02*k._rotation21,J=R._rotation00*k._rotation02+R._rotation01*k._rotation12+R._rotation02*k._rotation22,I=R._rotation10*k._rotation00+R._rotation11*k._rotation10+R._rotation12*k._rotation20,G=R._rotation10*k._rotation01+R._rotation11*k._rotation11+R._rotation12*k._rotation21,D=R._rotation10*k._rotation02+R._rotation11*k._rotation12+R._rotation12*k._rotation22,et=R._rotation20*k._rotation00+R._rotation21*k._rotation10+R._rotation22*k._rotation20,$=R._rotation20*k._rotation01+R._rotation21*k._rotation11+R._rotation22*k._rotation21,j=R._rotation20*k._rotation02+R._rotation21*k._rotation12+R._rotation22*k._rotation22,C._rotation00=V,C._rotation01=B,C._rotation02=J,C._rotation10=I,C._rotation11=G,C._rotation12=D,C._rotation20=et,C._rotation21=$,C._rotation22=j;let q,tt,W;q=R._rotation00*k._positionX+R._rotation01*k._positionY+R._rotation02*k._positionZ,tt=R._rotation10*k._positionX+R._rotation11*k._positionY+R._rotation12*k._positionZ,W=R._rotation20*k._positionX+R._rotation21*k._positionY+R._rotation22*k._positionZ,C._positionX=q,C._positionY=tt,C._positionZ=W,C._positionX+=R._positionX,C._positionY+=R._positionY,C._positionZ+=R._positionZ;let U=L._transform,it=L._localTransform,Q,at,ht,_t,mt,ft,ut,H,O;Q=E._rotation00*it._rotation00+E._rotation01*it._rotation10+E._rotation02*it._rotation20,at=E._rotation00*it._rotation01+E._rotation01*it._rotation11+E._rotation02*it._rotation21,ht=E._rotation00*it._rotation02+E._rotation01*it._rotation12+E._rotation02*it._rotation22,_t=E._rotation10*it._rotation00+E._rotation11*it._rotation10+E._rotation12*it._rotation20,mt=E._rotation10*it._rotation01+E._rotation11*it._rotation11+E._rotation12*it._rotation21,ft=E._rotation10*it._rotation02+E._rotation11*it._rotation12+E._rotation12*it._rotation22,ut=E._rotation20*it._rotation00+E._rotation21*it._rotation10+E._rotation22*it._rotation20,H=E._rotation20*it._rotation01+E._rotation21*it._rotation11+E._rotation22*it._rotation21,O=E._rotation20*it._rotation02+E._rotation21*it._rotation12+E._rotation22*it._rotation22,U._rotation00=Q,U._rotation01=at,U._rotation02=ht,U._rotation10=_t,U._rotation11=mt,U._rotation12=ft,U._rotation20=ut,U._rotation21=H,U._rotation22=O;let ot,pt,vt;ot=E._rotation00*it._positionX+E._rotation01*it._positionY+E._rotation02*it._positionZ,pt=E._rotation10*it._positionX+E._rotation11*it._positionY+E._rotation12*it._positionZ,vt=E._rotation20*it._positionX+E._rotation21*it._positionY+E._rotation22*it._positionZ,U._positionX=ot,U._positionY=pt,U._positionZ=vt,U._positionX+=E._positionX,U._positionY+=E._positionY,U._positionZ+=E._positionZ;let xt,Mt,ct,St,It,dt;if(L._geom._computeAabb(L._aabb,L._ptransform),xt=L._aabb._minX,Mt=L._aabb._minY,ct=L._aabb._minZ,St=L._aabb._maxX,It=L._aabb._maxY,dt=L._aabb._maxZ,L._geom._computeAabb(L._aabb,L._transform),L._aabb._minX=xt<L._aabb._minX?xt:L._aabb._minX,L._aabb._minY=Mt<L._aabb._minY?Mt:L._aabb._minY,L._aabb._minZ=ct<L._aabb._minZ?ct:L._aabb._minZ,L._aabb._maxX=St>L._aabb._maxX?St:L._aabb._maxX,L._aabb._maxY=It>L._aabb._maxY?It:L._aabb._maxY,L._aabb._maxZ=dt>L._aabb._maxZ?dt:L._aabb._maxZ,L._proxy!=null){let K,lt,rt;K=L._transform._positionX-L._ptransform._positionX,lt=L._transform._positionY-L._ptransform._positionY,rt=L._transform._positionZ-L._ptransform._positionZ;let Vt=L.displacement;Vt.x=K,Vt.y=lt,Vt.z=rt,L._rigidBody._world._broadPhase.moveProxy(L._proxy,L._aabb,L.displacement)}L=S}this._sleeping=!1,this._sleepTime=0}rotate(t){let e,i,n,s,o,r,_,a,l;e=t.e00,i=t.e01,n=t.e02,s=t.e10,o=t.e11,r=t.e12,_=t.e20,a=t.e21,l=t.e22;let h,m,f,p,d,u,g,v,x;h=e*this._transform._rotation00+i*this._transform._rotation10+n*this._transform._rotation20,m=e*this._transform._rotation01+i*this._transform._rotation11+n*this._transform._rotation21,f=e*this._transform._rotation02+i*this._transform._rotation12+n*this._transform._rotation22,p=s*this._transform._rotation00+o*this._transform._rotation10+r*this._transform._rotation20,d=s*this._transform._rotation01+o*this._transform._rotation11+r*this._transform._rotation21,u=s*this._transform._rotation02+o*this._transform._rotation12+r*this._transform._rotation22,g=_*this._transform._rotation00+a*this._transform._rotation10+l*this._transform._rotation20,v=_*this._transform._rotation01+a*this._transform._rotation11+l*this._transform._rotation21,x=_*this._transform._rotation02+a*this._transform._rotation12+l*this._transform._rotation22,this._transform._rotation00=h,this._transform._rotation01=m,this._transform._rotation02=f,this._transform._rotation10=p,this._transform._rotation11=d,this._transform._rotation12=u,this._transform._rotation20=g,this._transform._rotation21=v,this._transform._rotation22=x;let b,Y,w,Z,X,M,z,T,F;b=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,Y=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,w=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,Z=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,X=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,M=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,z=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,T=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,F=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=b,this._invInertia01=Y,this._invInertia02=w,this._invInertia10=Z,this._invInertia11=X,this._invInertia12=M,this._invInertia20=z,this._invInertia21=T,this._invInertia22=F;let P,A,L,S,R,E,C,k,V;P=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,A=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,L=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,S=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,R=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,E=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,C=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,k=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,V=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=P,this._invInertia01=A,this._invInertia02=L,this._invInertia10=S,this._invInertia11=R,this._invInertia12=E,this._invInertia20=C,this._invInertia21=k,this._invInertia22=V,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let B=this._ptransform,J=this._transform;B._positionX=J._positionX,B._positionY=J._positionY,B._positionZ=J._positionZ,B._rotation00=J._rotation00,B._rotation01=J._rotation01,B._rotation02=J._rotation02,B._rotation10=J._rotation10,B._rotation11=J._rotation11,B._rotation12=J._rotation12,B._rotation20=J._rotation20,B._rotation21=J._rotation21,B._rotation22=J._rotation22;let I=this._shapeList;for(;I!=null;){let G=I._next,D=this._ptransform,et=this._transform,$=I._ptransform,j=I._localTransform,q,tt,W,U,it,Q,at,ht,_t;q=D._rotation00*j._rotation00+D._rotation01*j._rotation10+D._rotation02*j._rotation20,tt=D._rotation00*j._rotation01+D._rotation01*j._rotation11+D._rotation02*j._rotation21,W=D._rotation00*j._rotation02+D._rotation01*j._rotation12+D._rotation02*j._rotation22,U=D._rotation10*j._rotation00+D._rotation11*j._rotation10+D._rotation12*j._rotation20,it=D._rotation10*j._rotation01+D._rotation11*j._rotation11+D._rotation12*j._rotation21,Q=D._rotation10*j._rotation02+D._rotation11*j._rotation12+D._rotation12*j._rotation22,at=D._rotation20*j._rotation00+D._rotation21*j._rotation10+D._rotation22*j._rotation20,ht=D._rotation20*j._rotation01+D._rotation21*j._rotation11+D._rotation22*j._rotation21,_t=D._rotation20*j._rotation02+D._rotation21*j._rotation12+D._rotation22*j._rotation22,$._rotation00=q,$._rotation01=tt,$._rotation02=W,$._rotation10=U,$._rotation11=it,$._rotation12=Q,$._rotation20=at,$._rotation21=ht,$._rotation22=_t;let mt,ft,ut;mt=D._rotation00*j._positionX+D._rotation01*j._positionY+D._rotation02*j._positionZ,ft=D._rotation10*j._positionX+D._rotation11*j._positionY+D._rotation12*j._positionZ,ut=D._rotation20*j._positionX+D._rotation21*j._positionY+D._rotation22*j._positionZ,$._positionX=mt,$._positionY=ft,$._positionZ=ut,$._positionX+=D._positionX,$._positionY+=D._positionY,$._positionZ+=D._positionZ;let H=I._transform,O=I._localTransform,ot,pt,vt,xt,Mt,ct,St,It,dt;ot=et._rotation00*O._rotation00+et._rotation01*O._rotation10+et._rotation02*O._rotation20,pt=et._rotation00*O._rotation01+et._rotation01*O._rotation11+et._rotation02*O._rotation21,vt=et._rotation00*O._rotation02+et._rotation01*O._rotation12+et._rotation02*O._rotation22,xt=et._rotation10*O._rotation00+et._rotation11*O._rotation10+et._rotation12*O._rotation20,Mt=et._rotation10*O._rotation01+et._rotation11*O._rotation11+et._rotation12*O._rotation21,ct=et._rotation10*O._rotation02+et._rotation11*O._rotation12+et._rotation12*O._rotation22,St=et._rotation20*O._rotation00+et._rotation21*O._rotation10+et._rotation22*O._rotation20,It=et._rotation20*O._rotation01+et._rotation21*O._rotation11+et._rotation22*O._rotation21,dt=et._rotation20*O._rotation02+et._rotation21*O._rotation12+et._rotation22*O._rotation22,H._rotation00=ot,H._rotation01=pt,H._rotation02=vt,H._rotation10=xt,H._rotation11=Mt,H._rotation12=ct,H._rotation20=St,H._rotation21=It,H._rotation22=dt;let K,lt,rt;K=et._rotation00*O._positionX+et._rotation01*O._positionY+et._rotation02*O._positionZ,lt=et._rotation10*O._positionX+et._rotation11*O._positionY+et._rotation12*O._positionZ,rt=et._rotation20*O._positionX+et._rotation21*O._positionY+et._rotation22*O._positionZ,H._positionX=K,H._positionY=lt,H._positionZ=rt,H._positionX+=et._positionX,H._positionY+=et._positionY,H._positionZ+=et._positionZ;let Vt,At,Yt,Xt,Nt,ie;if(I._geom._computeAabb(I._aabb,I._ptransform),Vt=I._aabb._minX,At=I._aabb._minY,Yt=I._aabb._minZ,Xt=I._aabb._maxX,Nt=I._aabb._maxY,ie=I._aabb._maxZ,I._geom._computeAabb(I._aabb,I._transform),I._aabb._minX=Vt<I._aabb._minX?Vt:I._aabb._minX,I._aabb._minY=At<I._aabb._minY?At:I._aabb._minY,I._aabb._minZ=Yt<I._aabb._minZ?Yt:I._aabb._minZ,I._aabb._maxX=Xt>I._aabb._maxX?Xt:I._aabb._maxX,I._aabb._maxY=Nt>I._aabb._maxY?Nt:I._aabb._maxY,I._aabb._maxZ=ie>I._aabb._maxZ?ie:I._aabb._maxZ,I._proxy!=null){let ee,Ze,ze;ee=I._transform._positionX-I._ptransform._positionX,Ze=I._transform._positionY-I._ptransform._positionY,ze=I._transform._positionZ-I._ptransform._positionZ;let pe=I.displacement;pe.x=ee,pe.y=Ze,pe.z=ze,I._rigidBody._world._broadPhase.moveProxy(I._proxy,I._aabb,I.displacement)}I=G}this._sleeping=!1,this._sleepTime=0}rotateXyz(t){let e,i,n,s,o,r,_,a,l,h,m,f;e=t.x,i=t.y,n=t.z;let p=Math.sin(e),d=Math.sin(i),u=Math.sin(n),g=Math.cos(e),v=Math.cos(i),x=Math.cos(n);s=v*x,o=-v*u,r=d,_=g*u+x*p*d,a=g*x-p*d*u,l=-v*p,h=p*u-g*x*d,m=x*p+g*d*u,f=g*v;let b,Y,w,Z,X,M,z,T,F;b=s*this._transform._rotation00+o*this._transform._rotation10+r*this._transform._rotation20,Y=s*this._transform._rotation01+o*this._transform._rotation11+r*this._transform._rotation21,w=s*this._transform._rotation02+o*this._transform._rotation12+r*this._transform._rotation22,Z=_*this._transform._rotation00+a*this._transform._rotation10+l*this._transform._rotation20,X=_*this._transform._rotation01+a*this._transform._rotation11+l*this._transform._rotation21,M=_*this._transform._rotation02+a*this._transform._rotation12+l*this._transform._rotation22,z=h*this._transform._rotation00+m*this._transform._rotation10+f*this._transform._rotation20,T=h*this._transform._rotation01+m*this._transform._rotation11+f*this._transform._rotation21,F=h*this._transform._rotation02+m*this._transform._rotation12+f*this._transform._rotation22,this._transform._rotation00=b,this._transform._rotation01=Y,this._transform._rotation02=w,this._transform._rotation10=Z,this._transform._rotation11=X,this._transform._rotation12=M,this._transform._rotation20=z,this._transform._rotation21=T,this._transform._rotation22=F;let P,A,L,S,R,E,C,k,V;P=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,A=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,L=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,S=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,R=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,E=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,C=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,k=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,V=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=P,this._invInertia01=A,this._invInertia02=L,this._invInertia10=S,this._invInertia11=R,this._invInertia12=E,this._invInertia20=C,this._invInertia21=k,this._invInertia22=V;let B,J,I,G,D,et,$,j,q;B=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,J=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,I=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,G=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,D=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,et=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,$=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,j=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,q=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=B,this._invInertia01=J,this._invInertia02=I,this._invInertia10=G,this._invInertia11=D,this._invInertia12=et,this._invInertia20=$,this._invInertia21=j,this._invInertia22=q,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let tt=this._ptransform,W=this._transform;tt._positionX=W._positionX,tt._positionY=W._positionY,tt._positionZ=W._positionZ,tt._rotation00=W._rotation00,tt._rotation01=W._rotation01,tt._rotation02=W._rotation02,tt._rotation10=W._rotation10,tt._rotation11=W._rotation11,tt._rotation12=W._rotation12,tt._rotation20=W._rotation20,tt._rotation21=W._rotation21,tt._rotation22=W._rotation22;let U=this._shapeList;for(;U!=null;){let it=U._next,Q=this._ptransform,at=this._transform,ht=U._ptransform,_t=U._localTransform,mt,ft,ut,H,O,ot,pt,vt,xt;mt=Q._rotation00*_t._rotation00+Q._rotation01*_t._rotation10+Q._rotation02*_t._rotation20,ft=Q._rotation00*_t._rotation01+Q._rotation01*_t._rotation11+Q._rotation02*_t._rotation21,ut=Q._rotation00*_t._rotation02+Q._rotation01*_t._rotation12+Q._rotation02*_t._rotation22,H=Q._rotation10*_t._rotation00+Q._rotation11*_t._rotation10+Q._rotation12*_t._rotation20,O=Q._rotation10*_t._rotation01+Q._rotation11*_t._rotation11+Q._rotation12*_t._rotation21,ot=Q._rotation10*_t._rotation02+Q._rotation11*_t._rotation12+Q._rotation12*_t._rotation22,pt=Q._rotation20*_t._rotation00+Q._rotation21*_t._rotation10+Q._rotation22*_t._rotation20,vt=Q._rotation20*_t._rotation01+Q._rotation21*_t._rotation11+Q._rotation22*_t._rotation21,xt=Q._rotation20*_t._rotation02+Q._rotation21*_t._rotation12+Q._rotation22*_t._rotation22,ht._rotation00=mt,ht._rotation01=ft,ht._rotation02=ut,ht._rotation10=H,ht._rotation11=O,ht._rotation12=ot,ht._rotation20=pt,ht._rotation21=vt,ht._rotation22=xt;let Mt,ct,St;Mt=Q._rotation00*_t._positionX+Q._rotation01*_t._positionY+Q._rotation02*_t._positionZ,ct=Q._rotation10*_t._positionX+Q._rotation11*_t._positionY+Q._rotation12*_t._positionZ,St=Q._rotation20*_t._positionX+Q._rotation21*_t._positionY+Q._rotation22*_t._positionZ,ht._positionX=Mt,ht._positionY=ct,ht._positionZ=St,ht._positionX+=Q._positionX,ht._positionY+=Q._positionY,ht._positionZ+=Q._positionZ;let It=U._transform,dt=U._localTransform,K,lt,rt,Vt,At,Yt,Xt,Nt,ie;K=at._rotation00*dt._rotation00+at._rotation01*dt._rotation10+at._rotation02*dt._rotation20,lt=at._rotation00*dt._rotation01+at._rotation01*dt._rotation11+at._rotation02*dt._rotation21,rt=at._rotation00*dt._rotation02+at._rotation01*dt._rotation12+at._rotation02*dt._rotation22,Vt=at._rotation10*dt._rotation00+at._rotation11*dt._rotation10+at._rotation12*dt._rotation20,At=at._rotation10*dt._rotation01+at._rotation11*dt._rotation11+at._rotation12*dt._rotation21,Yt=at._rotation10*dt._rotation02+at._rotation11*dt._rotation12+at._rotation12*dt._rotation22,Xt=at._rotation20*dt._rotation00+at._rotation21*dt._rotation10+at._rotation22*dt._rotation20,Nt=at._rotation20*dt._rotation01+at._rotation21*dt._rotation11+at._rotation22*dt._rotation21,ie=at._rotation20*dt._rotation02+at._rotation21*dt._rotation12+at._rotation22*dt._rotation22,It._rotation00=K,It._rotation01=lt,It._rotation02=rt,It._rotation10=Vt,It._rotation11=At,It._rotation12=Yt,It._rotation20=Xt,It._rotation21=Nt,It._rotation22=ie;let ee,Ze,ze;ee=at._rotation00*dt._positionX+at._rotation01*dt._positionY+at._rotation02*dt._positionZ,Ze=at._rotation10*dt._positionX+at._rotation11*dt._positionY+at._rotation12*dt._positionZ,ze=at._rotation20*dt._positionX+at._rotation21*dt._positionY+at._rotation22*dt._positionZ,It._positionX=ee,It._positionY=Ze,It._positionZ=ze,It._positionX+=at._positionX,It._positionY+=at._positionY,It._positionZ+=at._positionZ;let pe,$t,Ht,ue,Ie,qe;if(U._geom._computeAabb(U._aabb,U._ptransform),pe=U._aabb._minX,$t=U._aabb._minY,Ht=U._aabb._minZ,ue=U._aabb._maxX,Ie=U._aabb._maxY,qe=U._aabb._maxZ,U._geom._computeAabb(U._aabb,U._transform),U._aabb._minX=pe<U._aabb._minX?pe:U._aabb._minX,U._aabb._minY=$t<U._aabb._minY?$t:U._aabb._minY,U._aabb._minZ=Ht<U._aabb._minZ?Ht:U._aabb._minZ,U._aabb._maxX=ue>U._aabb._maxX?ue:U._aabb._maxX,U._aabb._maxY=Ie>U._aabb._maxY?Ie:U._aabb._maxY,U._aabb._maxZ=qe>U._aabb._maxZ?qe:U._aabb._maxZ,U._proxy!=null){let Ee,Ut,nt;Ee=U._transform._positionX-U._ptransform._positionX,Ut=U._transform._positionY-U._ptransform._positionY,nt=U._transform._positionZ-U._ptransform._positionZ;let gt=U.displacement;gt.x=Ee,gt.y=Ut,gt.z=nt,U._rigidBody._world._broadPhase.moveProxy(U._proxy,U._aabb,U.displacement)}U=it}this._sleeping=!1,this._sleepTime=0}getOrientation(){let t=new y.common.Quat,e,i,n,s,o=this._transform._rotation00,r=this._transform._rotation11,_=this._transform._rotation22,a=o+r+_,l;return a>0?(l=Math.sqrt(a+1),s=.5*l,l=.5/l,e=(this._transform._rotation21-this._transform._rotation12)*l,i=(this._transform._rotation02-this._transform._rotation20)*l,n=(this._transform._rotation10-this._transform._rotation01)*l):o>r?o>_?(l=Math.sqrt(o-r-_+1),e=.5*l,l=.5/l,i=(this._transform._rotation01+this._transform._rotation10)*l,n=(this._transform._rotation02+this._transform._rotation20)*l,s=(this._transform._rotation21-this._transform._rotation12)*l):(l=Math.sqrt(_-o-r+1),n=.5*l,l=.5/l,e=(this._transform._rotation02+this._transform._rotation20)*l,i=(this._transform._rotation12+this._transform._rotation21)*l,s=(this._transform._rotation10-this._transform._rotation01)*l):r>_?(l=Math.sqrt(r-_-o+1),i=.5*l,l=.5/l,e=(this._transform._rotation01+this._transform._rotation10)*l,n=(this._transform._rotation12+this._transform._rotation21)*l,s=(this._transform._rotation02-this._transform._rotation20)*l):(l=Math.sqrt(_-o-r+1),n=.5*l,l=.5/l,e=(this._transform._rotation02+this._transform._rotation20)*l,i=(this._transform._rotation12+this._transform._rotation21)*l,s=(this._transform._rotation10-this._transform._rotation01)*l),t.x=e,t.y=i,t.z=n,t.w=s,t}getOrientationTo(t){let e,i,n,s,o=this._transform._rotation00,r=this._transform._rotation11,_=this._transform._rotation22,a=o+r+_,l;a>0?(l=Math.sqrt(a+1),s=.5*l,l=.5/l,e=(this._transform._rotation21-this._transform._rotation12)*l,i=(this._transform._rotation02-this._transform._rotation20)*l,n=(this._transform._rotation10-this._transform._rotation01)*l):o>r?o>_?(l=Math.sqrt(o-r-_+1),e=.5*l,l=.5/l,i=(this._transform._rotation01+this._transform._rotation10)*l,n=(this._transform._rotation02+this._transform._rotation20)*l,s=(this._transform._rotation21-this._transform._rotation12)*l):(l=Math.sqrt(_-o-r+1),n=.5*l,l=.5/l,e=(this._transform._rotation02+this._transform._rotation20)*l,i=(this._transform._rotation12+this._transform._rotation21)*l,s=(this._transform._rotation10-this._transform._rotation01)*l):r>_?(l=Math.sqrt(r-_-o+1),i=.5*l,l=.5/l,e=(this._transform._rotation01+this._transform._rotation10)*l,n=(this._transform._rotation12+this._transform._rotation21)*l,s=(this._transform._rotation02-this._transform._rotation20)*l):(l=Math.sqrt(_-o-r+1),n=.5*l,l=.5/l,e=(this._transform._rotation02+this._transform._rotation20)*l,i=(this._transform._rotation12+this._transform._rotation21)*l,s=(this._transform._rotation10-this._transform._rotation01)*l),t.x=e,t.y=i,t.z=n,t.w=s}setOrientation(t){let e,i,n,s;e=t.x,i=t.y,n=t.z,s=t.w;let o=e,r=i,_=n,a=s,l=2*o,h=2*r,m=2*_,f=o*l,p=r*h,d=_*m,u=o*h,g=r*m,v=o*m,x=a*l,b=a*h,Y=a*m;this._transform._rotation00=1-p-d,this._transform._rotation01=u-Y,this._transform._rotation02=v+b,this._transform._rotation10=u+Y,this._transform._rotation11=1-f-d,this._transform._rotation12=g-x,this._transform._rotation20=v-b,this._transform._rotation21=g+x,this._transform._rotation22=1-f-p;let w,Z,X,M,z,T,F,P,A;w=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,Z=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,X=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,M=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,z=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,T=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,F=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,P=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,A=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=w,this._invInertia01=Z,this._invInertia02=X,this._invInertia10=M,this._invInertia11=z,this._invInertia12=T,this._invInertia20=F,this._invInertia21=P,this._invInertia22=A;let L,S,R,E,C,k,V,B,J;L=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,S=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,R=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,E=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,C=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,k=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,V=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,B=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,J=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=L,this._invInertia01=S,this._invInertia02=R,this._invInertia10=E,this._invInertia11=C,this._invInertia12=k,this._invInertia20=V,this._invInertia21=B,this._invInertia22=J,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let I=this._ptransform,G=this._transform;I._positionX=G._positionX,I._positionY=G._positionY,I._positionZ=G._positionZ,I._rotation00=G._rotation00,I._rotation01=G._rotation01,I._rotation02=G._rotation02,I._rotation10=G._rotation10,I._rotation11=G._rotation11,I._rotation12=G._rotation12,I._rotation20=G._rotation20,I._rotation21=G._rotation21,I._rotation22=G._rotation22;let D=this._shapeList;for(;D!=null;){let et=D._next,$=this._ptransform,j=this._transform,q=D._ptransform,tt=D._localTransform,W,U,it,Q,at,ht,_t,mt,ft;W=$._rotation00*tt._rotation00+$._rotation01*tt._rotation10+$._rotation02*tt._rotation20,U=$._rotation00*tt._rotation01+$._rotation01*tt._rotation11+$._rotation02*tt._rotation21,it=$._rotation00*tt._rotation02+$._rotation01*tt._rotation12+$._rotation02*tt._rotation22,Q=$._rotation10*tt._rotation00+$._rotation11*tt._rotation10+$._rotation12*tt._rotation20,at=$._rotation10*tt._rotation01+$._rotation11*tt._rotation11+$._rotation12*tt._rotation21,ht=$._rotation10*tt._rotation02+$._rotation11*tt._rotation12+$._rotation12*tt._rotation22,_t=$._rotation20*tt._rotation00+$._rotation21*tt._rotation10+$._rotation22*tt._rotation20,mt=$._rotation20*tt._rotation01+$._rotation21*tt._rotation11+$._rotation22*tt._rotation21,ft=$._rotation20*tt._rotation02+$._rotation21*tt._rotation12+$._rotation22*tt._rotation22,q._rotation00=W,q._rotation01=U,q._rotation02=it,q._rotation10=Q,q._rotation11=at,q._rotation12=ht,q._rotation20=_t,q._rotation21=mt,q._rotation22=ft;let ut,H,O;ut=$._rotation00*tt._positionX+$._rotation01*tt._positionY+$._rotation02*tt._positionZ,H=$._rotation10*tt._positionX+$._rotation11*tt._positionY+$._rotation12*tt._positionZ,O=$._rotation20*tt._positionX+$._rotation21*tt._positionY+$._rotation22*tt._positionZ,q._positionX=ut,q._positionY=H,q._positionZ=O,q._positionX+=$._positionX,q._positionY+=$._positionY,q._positionZ+=$._positionZ;let ot=D._transform,pt=D._localTransform,vt,xt,Mt,ct,St,It,dt,K,lt;vt=j._rotation00*pt._rotation00+j._rotation01*pt._rotation10+j._rotation02*pt._rotation20,xt=j._rotation00*pt._rotation01+j._rotation01*pt._rotation11+j._rotation02*pt._rotation21,Mt=j._rotation00*pt._rotation02+j._rotation01*pt._rotation12+j._rotation02*pt._rotation22,ct=j._rotation10*pt._rotation00+j._rotation11*pt._rotation10+j._rotation12*pt._rotation20,St=j._rotation10*pt._rotation01+j._rotation11*pt._rotation11+j._rotation12*pt._rotation21,It=j._rotation10*pt._rotation02+j._rotation11*pt._rotation12+j._rotation12*pt._rotation22,dt=j._rotation20*pt._rotation00+j._rotation21*pt._rotation10+j._rotation22*pt._rotation20,K=j._rotation20*pt._rotation01+j._rotation21*pt._rotation11+j._rotation22*pt._rotation21,lt=j._rotation20*pt._rotation02+j._rotation21*pt._rotation12+j._rotation22*pt._rotation22,ot._rotation00=vt,ot._rotation01=xt,ot._rotation02=Mt,ot._rotation10=ct,ot._rotation11=St,ot._rotation12=It,ot._rotation20=dt,ot._rotation21=K,ot._rotation22=lt;let rt,Vt,At;rt=j._rotation00*pt._positionX+j._rotation01*pt._positionY+j._rotation02*pt._positionZ,Vt=j._rotation10*pt._positionX+j._rotation11*pt._positionY+j._rotation12*pt._positionZ,At=j._rotation20*pt._positionX+j._rotation21*pt._positionY+j._rotation22*pt._positionZ,ot._positionX=rt,ot._positionY=Vt,ot._positionZ=At,ot._positionX+=j._positionX,ot._positionY+=j._positionY,ot._positionZ+=j._positionZ;let Yt,Xt,Nt,ie,ee,Ze;if(D._geom._computeAabb(D._aabb,D._ptransform),Yt=D._aabb._minX,Xt=D._aabb._minY,Nt=D._aabb._minZ,ie=D._aabb._maxX,ee=D._aabb._maxY,Ze=D._aabb._maxZ,D._geom._computeAabb(D._aabb,D._transform),D._aabb._minX=Yt<D._aabb._minX?Yt:D._aabb._minX,D._aabb._minY=Xt<D._aabb._minY?Xt:D._aabb._minY,D._aabb._minZ=Nt<D._aabb._minZ?Nt:D._aabb._minZ,D._aabb._maxX=ie>D._aabb._maxX?ie:D._aabb._maxX,D._aabb._maxY=ee>D._aabb._maxY?ee:D._aabb._maxY,D._aabb._maxZ=Ze>D._aabb._maxZ?Ze:D._aabb._maxZ,D._proxy!=null){let ze,pe,$t;ze=D._transform._positionX-D._ptransform._positionX,pe=D._transform._positionY-D._ptransform._positionY,$t=D._transform._positionZ-D._ptransform._positionZ;let Ht=D.displacement;Ht.x=ze,Ht.y=pe,Ht.z=$t,D._rigidBody._world._broadPhase.moveProxy(D._proxy,D._aabb,D.displacement)}D=et}this._sleeping=!1,this._sleepTime=0}getTransform(){let t=this._transform,e=new y.common.Transform;return e._positionX=t._positionX,e._positionY=t._positionY,e._positionZ=t._positionZ,e._rotation00=t._rotation00,e._rotation01=t._rotation01,e._rotation02=t._rotation02,e._rotation10=t._rotation10,e._rotation11=t._rotation11,e._rotation12=t._rotation12,e._rotation20=t._rotation20,e._rotation21=t._rotation21,e._rotation22=t._rotation22,e}getTransformTo(t){let e=this._transform;t._positionX=e._positionX,t._positionY=e._positionY,t._positionZ=e._positionZ,t._rotation00=e._rotation00,t._rotation01=e._rotation01,t._rotation02=e._rotation02,t._rotation10=e._rotation10,t._rotation11=e._rotation11,t._rotation12=e._rotation12,t._rotation20=e._rotation20,t._rotation21=e._rotation21,t._rotation22=e._rotation22}setTransform(t){this._transform._positionX=t._positionX,this._transform._positionY=t._positionY,this._transform._positionZ=t._positionZ,this._transform._rotation00=t._rotation00,this._transform._rotation01=t._rotation01,this._transform._rotation02=t._rotation02,this._transform._rotation10=t._rotation10,this._transform._rotation11=t._rotation11,this._transform._rotation12=t._rotation12,this._transform._rotation20=t._rotation20,this._transform._rotation21=t._rotation21,this._transform._rotation22=t._rotation22;let e,i,n,s,o,r,_,a,l;e=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,i=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,n=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,s=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,o=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,r=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,_=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,a=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=e,this._invInertia01=i,this._invInertia02=n,this._invInertia10=s,this._invInertia11=o,this._invInertia12=r,this._invInertia20=_,this._invInertia21=a,this._invInertia22=l;let h,m,f,p,d,u,g,v,x;h=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,m=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,f=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,p=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,d=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,u=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,g=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,v=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,x=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=h,this._invInertia01=m,this._invInertia02=f,this._invInertia10=p,this._invInertia11=d,this._invInertia12=u,this._invInertia20=g,this._invInertia21=v,this._invInertia22=x,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let b=this._ptransform,Y=this._transform;b._positionX=Y._positionX,b._positionY=Y._positionY,b._positionZ=Y._positionZ,b._rotation00=Y._rotation00,b._rotation01=Y._rotation01,b._rotation02=Y._rotation02,b._rotation10=Y._rotation10,b._rotation11=Y._rotation11,b._rotation12=Y._rotation12,b._rotation20=Y._rotation20,b._rotation21=Y._rotation21,b._rotation22=Y._rotation22;let w=this._shapeList;for(;w!=null;){let Z=w._next,X=this._ptransform,M=this._transform,z=w._ptransform,T=w._localTransform,F,P,A,L,S,R,E,C,k;F=X._rotation00*T._rotation00+X._rotation01*T._rotation10+X._rotation02*T._rotation20,P=X._rotation00*T._rotation01+X._rotation01*T._rotation11+X._rotation02*T._rotation21,A=X._rotation00*T._rotation02+X._rotation01*T._rotation12+X._rotation02*T._rotation22,L=X._rotation10*T._rotation00+X._rotation11*T._rotation10+X._rotation12*T._rotation20,S=X._rotation10*T._rotation01+X._rotation11*T._rotation11+X._rotation12*T._rotation21,R=X._rotation10*T._rotation02+X._rotation11*T._rotation12+X._rotation12*T._rotation22,E=X._rotation20*T._rotation00+X._rotation21*T._rotation10+X._rotation22*T._rotation20,C=X._rotation20*T._rotation01+X._rotation21*T._rotation11+X._rotation22*T._rotation21,k=X._rotation20*T._rotation02+X._rotation21*T._rotation12+X._rotation22*T._rotation22,z._rotation00=F,z._rotation01=P,z._rotation02=A,z._rotation10=L,z._rotation11=S,z._rotation12=R,z._rotation20=E,z._rotation21=C,z._rotation22=k;let V,B,J;V=X._rotation00*T._positionX+X._rotation01*T._positionY+X._rotation02*T._positionZ,B=X._rotation10*T._positionX+X._rotation11*T._positionY+X._rotation12*T._positionZ,J=X._rotation20*T._positionX+X._rotation21*T._positionY+X._rotation22*T._positionZ,z._positionX=V,z._positionY=B,z._positionZ=J,z._positionX+=X._positionX,z._positionY+=X._positionY,z._positionZ+=X._positionZ;let I=w._transform,G=w._localTransform,D,et,$,j,q,tt,W,U,it;D=M._rotation00*G._rotation00+M._rotation01*G._rotation10+M._rotation02*G._rotation20,et=M._rotation00*G._rotation01+M._rotation01*G._rotation11+M._rotation02*G._rotation21,$=M._rotation00*G._rotation02+M._rotation01*G._rotation12+M._rotation02*G._rotation22,j=M._rotation10*G._rotation00+M._rotation11*G._rotation10+M._rotation12*G._rotation20,q=M._rotation10*G._rotation01+M._rotation11*G._rotation11+M._rotation12*G._rotation21,tt=M._rotation10*G._rotation02+M._rotation11*G._rotation12+M._rotation12*G._rotation22,W=M._rotation20*G._rotation00+M._rotation21*G._rotation10+M._rotation22*G._rotation20,U=M._rotation20*G._rotation01+M._rotation21*G._rotation11+M._rotation22*G._rotation21,it=M._rotation20*G._rotation02+M._rotation21*G._rotation12+M._rotation22*G._rotation22,I._rotation00=D,I._rotation01=et,I._rotation02=$,I._rotation10=j,I._rotation11=q,I._rotation12=tt,I._rotation20=W,I._rotation21=U,I._rotation22=it;let Q,at,ht;Q=M._rotation00*G._positionX+M._rotation01*G._positionY+M._rotation02*G._positionZ,at=M._rotation10*G._positionX+M._rotation11*G._positionY+M._rotation12*G._positionZ,ht=M._rotation20*G._positionX+M._rotation21*G._positionY+M._rotation22*G._positionZ,I._positionX=Q,I._positionY=at,I._positionZ=ht,I._positionX+=M._positionX,I._positionY+=M._positionY,I._positionZ+=M._positionZ;let _t,mt,ft,ut,H,O;if(w._geom._computeAabb(w._aabb,w._ptransform),_t=w._aabb._minX,mt=w._aabb._minY,ft=w._aabb._minZ,ut=w._aabb._maxX,H=w._aabb._maxY,O=w._aabb._maxZ,w._geom._computeAabb(w._aabb,w._transform),w._aabb._minX=_t<w._aabb._minX?_t:w._aabb._minX,w._aabb._minY=mt<w._aabb._minY?mt:w._aabb._minY,w._aabb._minZ=ft<w._aabb._minZ?ft:w._aabb._minZ,w._aabb._maxX=ut>w._aabb._maxX?ut:w._aabb._maxX,w._aabb._maxY=H>w._aabb._maxY?H:w._aabb._maxY,w._aabb._maxZ=O>w._aabb._maxZ?O:w._aabb._maxZ,w._proxy!=null){let ot,pt,vt;ot=w._transform._positionX-w._ptransform._positionX,pt=w._transform._positionY-w._ptransform._positionY,vt=w._transform._positionZ-w._ptransform._positionZ;let xt=w.displacement;xt.x=ot,xt.y=pt,xt.z=vt,w._rigidBody._world._broadPhase.moveProxy(w._proxy,w._aabb,w.displacement)}w=Z}this._sleeping=!1,this._sleepTime=0}getMass(){return this._mass}getLocalInertia(){let t=new y.common.Mat3;return t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22,t}getLocalInertiaTo(t){t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22}getMassData(){let t=new y.dynamics.rigidbody.MassData;t.mass=this._mass;let e=t.localInertia;return e.e00=this._localInertia00,e.e01=this._localInertia01,e.e02=this._localInertia02,e.e10=this._localInertia10,e.e11=this._localInertia11,e.e12=this._localInertia12,e.e20=this._localInertia20,e.e21=this._localInertia21,e.e22=this._localInertia22,t}getMassDataTo(t){t.mass=this._mass;let e=t.localInertia;e.e00=this._localInertia00,e.e01=this._localInertia01,e.e02=this._localInertia02,e.e10=this._localInertia10,e.e11=this._localInertia11,e.e12=this._localInertia12,e.e20=this._localInertia20,e.e21=this._localInertia21,e.e22=this._localInertia22}setMassData(t){this._mass=t.mass;let e=t.localInertia;if(this._localInertia00=e.e00,this._localInertia01=e.e01,this._localInertia02=e.e02,this._localInertia10=e.e10,this._localInertia11=e.e11,this._localInertia12=e.e12,this._localInertia20=e.e20,this._localInertia21=e.e21,this._localInertia22=e.e22,this._mass>0&&this._localInertia00*(this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21)-this._localInertia01*(this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20)+this._localInertia02*(this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20)>0&&this._type==0){this._invMass=1/this._mass;let Y=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,w=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,Z=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,X=this._localInertia00*Y-this._localInertia01*w+this._localInertia02*Z;(X<-1e-32||X>1e-32)&&(X=1/X),this._invLocalInertia00=Y*X,this._invLocalInertia01=-(this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21)*X,this._invLocalInertia02=(this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11)*X,this._invLocalInertia10=-w*X,this._invLocalInertia11=(this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20)*X,this._invLocalInertia12=-(this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10)*X,this._invLocalInertia20=Z*X,this._invLocalInertia21=-(this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20)*X,this._invLocalInertia22=(this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10)*X,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._type==0&&(this._type=1);let i,n,s,o,r,_,a,l,h;i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,n=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,s=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,r=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,_=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,a=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,l=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=n,this._invInertia02=s,this._invInertia10=o,this._invInertia11=r,this._invInertia12=_,this._invInertia20=a,this._invInertia21=l,this._invInertia22=h;let m,f,p,d,u,g,v,x,b;m=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,f=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,p=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,d=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,u=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,g=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,v=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,x=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,b=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=m,this._invInertia01=f,this._invInertia02=p,this._invInertia10=d,this._invInertia11=u,this._invInertia12=g,this._invInertia20=v,this._invInertia21=x,this._invInertia22=b,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getRotationFactor(){let t=this._rotFactor;return new y.common.Vec3(t.x,t.y,t.z)}setRotationFactor(t){let e=this._rotFactor;e.x=t.x,e.y=t.y,e.z=t.z;let i,n,s,o,r,_,a,l,h;i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,n=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,s=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,r=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,_=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,a=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,l=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=n,this._invInertia02=s,this._invInertia10=o,this._invInertia11=r,this._invInertia12=_,this._invInertia20=a,this._invInertia21=l,this._invInertia22=h;let m,f,p,d,u,g,v,x,b;m=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,f=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,p=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,d=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,u=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,g=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,v=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,x=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,b=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=m,this._invInertia01=f,this._invInertia02=p,this._invInertia10=d,this._invInertia11=u,this._invInertia12=g,this._invInertia20=v,this._invInertia21=x,this._invInertia22=b,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getLinearVelocity(){let t=new y.common.Vec3;return t.x=this._velX,t.y=this._velY,t.z=this._velZ,t}getLinearVelocityTo(t){t.x=this._velX,t.y=this._velY,t.z=this._velZ}setLinearVelocity(t){this._type==1?(this._velX=0,this._velY=0,this._velZ=0):(this._velX=t.x,this._velY=t.y,this._velZ=t.z),this._sleeping=!1,this._sleepTime=0}getAngularVelocity(){let t=new y.common.Vec3;return t.x=this._angVelX,t.y=this._angVelY,t.z=this._angVelZ,t}getAngularVelocityTo(t){t.x=this._velX,t.y=this._velY,t.z=this._velZ}setAngularVelocity(t){this._type==1?(this._angVelX=0,this._angVelY=0,this._angVelZ=0):(this._angVelX=t.x,this._angVelY=t.y,this._angVelZ=t.z),this._sleeping=!1,this._sleepTime=0}addLinearVelocity(t){if(this._type!=1){let e,i,n;e=t.x,i=t.y,n=t.z,this._velX+=e,this._velY+=i,this._velZ+=n}this._sleeping=!1,this._sleepTime=0}addAngularVelocity(t){if(this._type!=1){let e,i,n;e=t.x,i=t.y,n=t.z,this._angVelX+=e,this._angVelY+=i,this._angVelZ+=n}this._sleeping=!1,this._sleepTime=0}applyImpulse(t,e){let i,n,s;i=t.x,n=t.y,s=t.z,this._velX+=i*this._invMass,this._velY+=n*this._invMass,this._velZ+=s*this._invMass;let o,r,_,a,l,h;a=e.x,l=e.y,h=e.z,a-=this._transform._positionX,l-=this._transform._positionY,h-=this._transform._positionZ,o=l*s-h*n,r=h*i-a*s,_=a*n-l*i;let m,f,p;m=this._invInertia00*o+this._invInertia01*r+this._invInertia02*_,f=this._invInertia10*o+this._invInertia11*r+this._invInertia12*_,p=this._invInertia20*o+this._invInertia21*r+this._invInertia22*_,o=m,r=f,_=p,this._angVelX+=o,this._angVelY+=r,this._angVelZ+=_,this._sleeping=!1,this._sleepTime=0}applyLinearImpulse(t){let e,i,n;e=t.x,i=t.y,n=t.z,this._velX+=e*this._invMass,this._velY+=i*this._invMass,this._velZ+=n*this._invMass,this._sleeping=!1,this._sleepTime=0}applyAngularImpulse(t){let e,i,n;e=t.x,i=t.y,n=t.z;let s,o,r;s=this._invInertia00*e+this._invInertia01*i+this._invInertia02*n,o=this._invInertia10*e+this._invInertia11*i+this._invInertia12*n,r=this._invInertia20*e+this._invInertia21*i+this._invInertia22*n,e=s,i=o,n=r,this._angVelX+=e,this._angVelY+=i,this._angVelZ+=n,this._sleeping=!1,this._sleepTime=0}applyForce(t,e){let i,n,s;i=t.x,n=t.y,s=t.z,this._forceX+=i,this._forceY+=n,this._forceZ+=s;let o,r,_,a,l,h;a=e.x,l=e.y,h=e.z,a-=this._transform._positionX,l-=this._transform._positionY,h-=this._transform._positionZ,o=l*s-h*n,r=h*i-a*s,_=a*n-l*i,this._torqueX+=o,this._torqueY+=r,this._torqueZ+=_,this._sleeping=!1,this._sleepTime=0}applyForceToCenter(t){let e,i,n;e=t.x,i=t.y,n=t.z,this._forceX+=e,this._forceY+=i,this._forceZ+=n,this._sleeping=!1,this._sleepTime=0}applyTorque(t){let e,i,n;e=t.x,i=t.y,n=t.z,this._torqueX+=e,this._torqueY+=i,this._torqueZ+=n,this._sleeping=!1,this._sleepTime=0}getLinearContactImpulse(){let t=new y.common.Vec3;return t.x=this._linearContactImpulseX,t.y=this._linearContactImpulseY,t.z=this._linearContactImpulseZ,t}getLinearContactImpulseTo(t){t.x=this._linearContactImpulseX,t.y=this._linearContactImpulseY,t.z=this._linearContactImpulseZ}getAngularContactImpulse(){let t=new y.common.Vec3;return t.x=this._angularContactImpulseX,t.y=this._angularContactImpulseY,t.z=this._angularContactImpulseZ,t}getAngularContactImpulseTo(t){t.x=this._angularContactImpulseX,t.y=this._angularContactImpulseY,t.z=this._angularContactImpulseZ}getGravityScale(){return this._gravityScale}setGravityScale(t){this._gravityScale=t,this._sleeping=!1,this._sleepTime=0}getLocalPoint(t){let e,i,n;e=t.x,i=t.y,n=t.z,e-=this._transform._positionX,i-=this._transform._positionY,n-=this._transform._positionZ;let s,o,r;s=this._transform._rotation00*e+this._transform._rotation10*i+this._transform._rotation20*n,o=this._transform._rotation01*e+this._transform._rotation11*i+this._transform._rotation21*n,r=this._transform._rotation02*e+this._transform._rotation12*i+this._transform._rotation22*n,e=s,i=o,n=r;let _=new y.common.Vec3;return _.x=e,_.y=i,_.z=n,_}getLocalPointTo(t,e){let i,n,s;i=t.x,n=t.y,s=t.z,i-=this._transform._positionX,n-=this._transform._positionY,s-=this._transform._positionZ;let o,r,_;o=this._transform._rotation00*i+this._transform._rotation10*n+this._transform._rotation20*s,r=this._transform._rotation01*i+this._transform._rotation11*n+this._transform._rotation21*s,_=this._transform._rotation02*i+this._transform._rotation12*n+this._transform._rotation22*s,i=o,n=r,s=_,e.x=i,e.y=n,e.z=s}getLocalVector(t){let e,i,n;e=t.x,i=t.y,n=t.z;let s,o,r;s=this._transform._rotation00*e+this._transform._rotation10*i+this._transform._rotation20*n,o=this._transform._rotation01*e+this._transform._rotation11*i+this._transform._rotation21*n,r=this._transform._rotation02*e+this._transform._rotation12*i+this._transform._rotation22*n,e=s,i=o,n=r;let _=new y.common.Vec3;return _.x=e,_.y=i,_.z=n,_}getLocalVectorTo(t,e){let i,n,s;i=t.x,n=t.y,s=t.z;let o,r,_;o=this._transform._rotation00*i+this._transform._rotation10*n+this._transform._rotation20*s,r=this._transform._rotation01*i+this._transform._rotation11*n+this._transform._rotation21*s,_=this._transform._rotation02*i+this._transform._rotation12*n+this._transform._rotation22*s,i=o,n=r,s=_,e.x=i,e.y=n,e.z=s}getWorldPoint(t){let e,i,n;e=t.x,i=t.y,n=t.z;let s,o,r;s=this._transform._rotation00*e+this._transform._rotation01*i+this._transform._rotation02*n,o=this._transform._rotation10*e+this._transform._rotation11*i+this._transform._rotation12*n,r=this._transform._rotation20*e+this._transform._rotation21*i+this._transform._rotation22*n,e=s,i=o,n=r,e+=this._transform._positionX,i+=this._transform._positionY,n+=this._transform._positionZ;let _=new y.common.Vec3;return _.x=e,_.y=i,_.z=n,_}getWorldPointTo(t,e){let i,n,s;i=t.x,n=t.y,s=t.z;let o,r,_;o=this._transform._rotation00*i+this._transform._rotation01*n+this._transform._rotation02*s,r=this._transform._rotation10*i+this._transform._rotation11*n+this._transform._rotation12*s,_=this._transform._rotation20*i+this._transform._rotation21*n+this._transform._rotation22*s,i=o,n=r,s=_,i+=this._transform._positionX,n+=this._transform._positionY,s+=this._transform._positionZ,e.x=i,e.y=n,e.z=s}getWorldVector(t){let e,i,n;e=t.x,i=t.y,n=t.z;let s,o,r;s=this._transform._rotation00*e+this._transform._rotation01*i+this._transform._rotation02*n,o=this._transform._rotation10*e+this._transform._rotation11*i+this._transform._rotation12*n,r=this._transform._rotation20*e+this._transform._rotation21*i+this._transform._rotation22*n,e=s,i=o,n=r;let _=new y.common.Vec3;return _.x=e,_.y=i,_.z=n,_}getWorldVectorTo(t,e){let i,n,s;i=t.x,n=t.y,s=t.z;let o,r,_;o=this._transform._rotation00*i+this._transform._rotation01*n+this._transform._rotation02*s,r=this._transform._rotation10*i+this._transform._rotation11*n+this._transform._rotation12*s,_=this._transform._rotation20*i+this._transform._rotation21*n+this._transform._rotation22*s,i=o,n=r,s=_,e.x=i,e.y=n,e.z=s}getNumShapes(){return this._numShapes}getShapeList(){return this._shapeList}getNumContactLinks(){return this._numContactLinks}getContactLinkList(){return this._contactLinkList}getNumJointLinks(){return this._numJointLinks}getJointLinkList(){return this._jointLinkList}addShape(t){if(this._shapeList==null?(this._shapeList=t,this._shapeListLast=t):(this._shapeListLast._next=t,t._prev=this._shapeListLast,this._shapeListLast=t),this._numShapes++,t._rigidBody=this,this._world!=null){let i=this._world;t._proxy=i._broadPhase.createProxy(t,t._aabb),t._id=i._shapeIdCount++,i._numShapes++}this.updateMass();let e=this._shapeList;for(;e!=null;){let i=e._next,n=this._ptransform,s=this._transform,o=e._ptransform,r=e._localTransform,_,a,l,h,m,f,p,d,u;_=n._rotation00*r._rotation00+n._rotation01*r._rotation10+n._rotation02*r._rotation20,a=n._rotation00*r._rotation01+n._rotation01*r._rotation11+n._rotation02*r._rotation21,l=n._rotation00*r._rotation02+n._rotation01*r._rotation12+n._rotation02*r._rotation22,h=n._rotation10*r._rotation00+n._rotation11*r._rotation10+n._rotation12*r._rotation20,m=n._rotation10*r._rotation01+n._rotation11*r._rotation11+n._rotation12*r._rotation21,f=n._rotation10*r._rotation02+n._rotation11*r._rotation12+n._rotation12*r._rotation22,p=n._rotation20*r._rotation00+n._rotation21*r._rotation10+n._rotation22*r._rotation20,d=n._rotation20*r._rotation01+n._rotation21*r._rotation11+n._rotation22*r._rotation21,u=n._rotation20*r._rotation02+n._rotation21*r._rotation12+n._rotation22*r._rotation22,o._rotation00=_,o._rotation01=a,o._rotation02=l,o._rotation10=h,o._rotation11=m,o._rotation12=f,o._rotation20=p,o._rotation21=d,o._rotation22=u;let g,v,x;g=n._rotation00*r._positionX+n._rotation01*r._positionY+n._rotation02*r._positionZ,v=n._rotation10*r._positionX+n._rotation11*r._positionY+n._rotation12*r._positionZ,x=n._rotation20*r._positionX+n._rotation21*r._positionY+n._rotation22*r._positionZ,o._positionX=g,o._positionY=v,o._positionZ=x,o._positionX+=n._positionX,o._positionY+=n._positionY,o._positionZ+=n._positionZ;let b=e._transform,Y=e._localTransform,w,Z,X,M,z,T,F,P,A;w=s._rotation00*Y._rotation00+s._rotation01*Y._rotation10+s._rotation02*Y._rotation20,Z=s._rotation00*Y._rotation01+s._rotation01*Y._rotation11+s._rotation02*Y._rotation21,X=s._rotation00*Y._rotation02+s._rotation01*Y._rotation12+s._rotation02*Y._rotation22,M=s._rotation10*Y._rotation00+s._rotation11*Y._rotation10+s._rotation12*Y._rotation20,z=s._rotation10*Y._rotation01+s._rotation11*Y._rotation11+s._rotation12*Y._rotation21,T=s._rotation10*Y._rotation02+s._rotation11*Y._rotation12+s._rotation12*Y._rotation22,F=s._rotation20*Y._rotation00+s._rotation21*Y._rotation10+s._rotation22*Y._rotation20,P=s._rotation20*Y._rotation01+s._rotation21*Y._rotation11+s._rotation22*Y._rotation21,A=s._rotation20*Y._rotation02+s._rotation21*Y._rotation12+s._rotation22*Y._rotation22,b._rotation00=w,b._rotation01=Z,b._rotation02=X,b._rotation10=M,b._rotation11=z,b._rotation12=T,b._rotation20=F,b._rotation21=P,b._rotation22=A;let L,S,R;L=s._rotation00*Y._positionX+s._rotation01*Y._positionY+s._rotation02*Y._positionZ,S=s._rotation10*Y._positionX+s._rotation11*Y._positionY+s._rotation12*Y._positionZ,R=s._rotation20*Y._positionX+s._rotation21*Y._positionY+s._rotation22*Y._positionZ,b._positionX=L,b._positionY=S,b._positionZ=R,b._positionX+=s._positionX,b._positionY+=s._positionY,b._positionZ+=s._positionZ;let E,C,k,V,B,J;if(e._geom._computeAabb(e._aabb,e._ptransform),E=e._aabb._minX,C=e._aabb._minY,k=e._aabb._minZ,V=e._aabb._maxX,B=e._aabb._maxY,J=e._aabb._maxZ,e._geom._computeAabb(e._aabb,e._transform),e._aabb._minX=E<e._aabb._minX?E:e._aabb._minX,e._aabb._minY=C<e._aabb._minY?C:e._aabb._minY,e._aabb._minZ=k<e._aabb._minZ?k:e._aabb._minZ,e._aabb._maxX=V>e._aabb._maxX?V:e._aabb._maxX,e._aabb._maxY=B>e._aabb._maxY?B:e._aabb._maxY,e._aabb._maxZ=J>e._aabb._maxZ?J:e._aabb._maxZ,e._proxy!=null){let I,G,D;I=e._transform._positionX-e._ptransform._positionX,G=e._transform._positionY-e._ptransform._positionY,D=e._transform._positionZ-e._ptransform._positionZ;let et=e.displacement;et.x=I,et.y=G,et.z=D,e._rigidBody._world._broadPhase.moveProxy(e._proxy,e._aabb,e.displacement)}e=i}}removeShape(t){let e=t._prev,i=t._next;if(e!=null&&(e._next=i),i!=null&&(i._prev=e),t==this._shapeList&&(this._shapeList=this._shapeList._next),t==this._shapeListLast&&(this._shapeListLast=this._shapeListLast._prev),t._next=null,t._prev=null,this._numShapes--,t._rigidBody=null,this._world!=null){let s=this._world;s._broadPhase.destroyProxy(t._proxy),t._proxy=null,t._id=-1;let o=t._rigidBody._contactLinkList;for(;o!=null;){let r=o._next,_=o._contact;if(_._s1==t||_._s2==t){let a=o._other;a._sleeping=!1,a._sleepTime=0;let l=s._contactManager,h=_._prev,m=_._next;if(h!=null&&(h._next=m),m!=null&&(m._prev=h),_==l._contactList&&(l._contactList=l._contactList._next),_==l._contactListLast&&(l._contactListLast=l._contactListLast._prev),_._next=null,_._prev=null,_._touching){let v=_._s1._contactCallback,x=_._s2._contactCallback;v==x&&(x=null),v!=null&&v.endContact(_),x!=null&&x.endContact(_)}let f=_._link1._prev,p=_._link1._next;f!=null&&(f._next=p),p!=null&&(p._prev=f),_._link1==_._b1._contactLinkList&&(_._b1._contactLinkList=_._b1._contactLinkList._next),_._link1==_._b1._contactLinkListLast&&(_._b1._contactLinkListLast=_._b1._contactLinkListLast._prev),_._link1._next=null,_._link1._prev=null;let d=_._link2._prev,u=_._link2._next;d!=null&&(d._next=u),u!=null&&(u._prev=d),_._link2==_._b2._contactLinkList&&(_._b2._contactLinkList=_._b2._contactLinkList._next),_._link2==_._b2._contactLinkListLast&&(_._b2._contactLinkListLast=_._b2._contactLinkListLast._prev),_._link2._next=null,_._link2._prev=null,_._b1._numContactLinks--,_._b2._numContactLinks--,_._link1._other=null,_._link2._other=null,_._link1._contact=null,_._link2._contact=null,_._s1=null,_._s2=null,_._b1=null,_._b2=null,_._touching=!1,_._cachedDetectorData._clear(),_._manifold._clear(),_._detector=null;let g=_._contactConstraint;g._s1=null,g._s2=null,g._b1=null,g._b2=null,g._tf1=null,g._tf2=null,_._next=l._contactPool,l._contactPool=_,l._numContacts--}o=r}s._numShapes--}this.updateMass();let n=this._shapeList;for(;n!=null;){let s=n._next,o=this._ptransform,r=this._transform,_=n._ptransform,a=n._localTransform,l,h,m,f,p,d,u,g,v;l=o._rotation00*a._rotation00+o._rotation01*a._rotation10+o._rotation02*a._rotation20,h=o._rotation00*a._rotation01+o._rotation01*a._rotation11+o._rotation02*a._rotation21,m=o._rotation00*a._rotation02+o._rotation01*a._rotation12+o._rotation02*a._rotation22,f=o._rotation10*a._rotation00+o._rotation11*a._rotation10+o._rotation12*a._rotation20,p=o._rotation10*a._rotation01+o._rotation11*a._rotation11+o._rotation12*a._rotation21,d=o._rotation10*a._rotation02+o._rotation11*a._rotation12+o._rotation12*a._rotation22,u=o._rotation20*a._rotation00+o._rotation21*a._rotation10+o._rotation22*a._rotation20,g=o._rotation20*a._rotation01+o._rotation21*a._rotation11+o._rotation22*a._rotation21,v=o._rotation20*a._rotation02+o._rotation21*a._rotation12+o._rotation22*a._rotation22,_._rotation00=l,_._rotation01=h,_._rotation02=m,_._rotation10=f,_._rotation11=p,_._rotation12=d,_._rotation20=u,_._rotation21=g,_._rotation22=v;let x,b,Y;x=o._rotation00*a._positionX+o._rotation01*a._positionY+o._rotation02*a._positionZ,b=o._rotation10*a._positionX+o._rotation11*a._positionY+o._rotation12*a._positionZ,Y=o._rotation20*a._positionX+o._rotation21*a._positionY+o._rotation22*a._positionZ,_._positionX=x,_._positionY=b,_._positionZ=Y,_._positionX+=o._positionX,_._positionY+=o._positionY,_._positionZ+=o._positionZ;let w=n._transform,Z=n._localTransform,X,M,z,T,F,P,A,L,S;X=r._rotation00*Z._rotation00+r._rotation01*Z._rotation10+r._rotation02*Z._rotation20,M=r._rotation00*Z._rotation01+r._rotation01*Z._rotation11+r._rotation02*Z._rotation21,z=r._rotation00*Z._rotation02+r._rotation01*Z._rotation12+r._rotation02*Z._rotation22,T=r._rotation10*Z._rotation00+r._rotation11*Z._rotation10+r._rotation12*Z._rotation20,F=r._rotation10*Z._rotation01+r._rotation11*Z._rotation11+r._rotation12*Z._rotation21,P=r._rotation10*Z._rotation02+r._rotation11*Z._rotation12+r._rotation12*Z._rotation22,A=r._rotation20*Z._rotation00+r._rotation21*Z._rotation10+r._rotation22*Z._rotation20,L=r._rotation20*Z._rotation01+r._rotation21*Z._rotation11+r._rotation22*Z._rotation21,S=r._rotation20*Z._rotation02+r._rotation21*Z._rotation12+r._rotation22*Z._rotation22,w._rotation00=X,w._rotation01=M,w._rotation02=z,w._rotation10=T,w._rotation11=F,w._rotation12=P,w._rotation20=A,w._rotation21=L,w._rotation22=S;let R,E,C;R=r._rotation00*Z._positionX+r._rotation01*Z._positionY+r._rotation02*Z._positionZ,E=r._rotation10*Z._positionX+r._rotation11*Z._positionY+r._rotation12*Z._positionZ,C=r._rotation20*Z._positionX+r._rotation21*Z._positionY+r._rotation22*Z._positionZ,w._positionX=R,w._positionY=E,w._positionZ=C,w._positionX+=r._positionX,w._positionY+=r._positionY,w._positionZ+=r._positionZ;let k,V,B,J,I,G;if(n._geom._computeAabb(n._aabb,n._ptransform),k=n._aabb._minX,V=n._aabb._minY,B=n._aabb._minZ,J=n._aabb._maxX,I=n._aabb._maxY,G=n._aabb._maxZ,n._geom._computeAabb(n._aabb,n._transform),n._aabb._minX=k<n._aabb._minX?k:n._aabb._minX,n._aabb._minY=V<n._aabb._minY?V:n._aabb._minY,n._aabb._minZ=B<n._aabb._minZ?B:n._aabb._minZ,n._aabb._maxX=J>n._aabb._maxX?J:n._aabb._maxX,n._aabb._maxY=I>n._aabb._maxY?I:n._aabb._maxY,n._aabb._maxZ=G>n._aabb._maxZ?G:n._aabb._maxZ,n._proxy!=null){let D,et,$;D=n._transform._positionX-n._ptransform._positionX,et=n._transform._positionY-n._ptransform._positionY,$=n._transform._positionZ-n._ptransform._positionZ;let j=n.displacement;j.x=D,j.y=et,j.z=$,n._rigidBody._world._broadPhase.moveProxy(n._proxy,n._aabb,n.displacement)}n=s}}getType(){return this._type}setType(t){this._type=t,this.updateMass()}wakeUp(){this._sleeping=!1,this._sleepTime=0}sleep(){this._sleeping=!0,this._sleepTime=0}isSleeping(){return this._sleeping}getSleepTime(){return this._sleepTime}setAutoSleep(t){this._autoSleep=t,this._sleeping=!1,this._sleepTime=0}getLinearDamping(){return this._linearDamping}setLinearDamping(t){this._linearDamping=t}getAngularDamping(){return this._angularDamping}setAngularDamping(t){this._angularDamping=t}getPrev(){return this._prev}getNext(){return this._next}};y.dynamics.rigidbody.RigidBodyConfig=class{constructor(){this.position=new y.common.Vec3,this.rotation=new y.common.Mat3,this.linearVelocity=new y.common.Vec3,this.angularVelocity=new y.common.Vec3,this.type=0,this.autoSleep=!0,this.linearDamping=0,this.angularDamping=0}};y.dynamics.rigidbody.RigidBodyType=class{};y.dynamics.rigidbody.Shape=class{constructor(t){this._id=-1,this._localTransform=new y.common.Transform,this._ptransform=new y.common.Transform,this._transform=new y.common.Transform;let e=t.position;this._localTransform._positionX=e.x,this._localTransform._positionY=e.y,this._localTransform._positionZ=e.z;let i=t.rotation;this._localTransform._rotation00=i.e00,this._localTransform._rotation01=i.e01,this._localTransform._rotation02=i.e02,this._localTransform._rotation10=i.e10,this._localTransform._rotation11=i.e11,this._localTransform._rotation12=i.e12,this._localTransform._rotation20=i.e20,this._localTransform._rotation21=i.e21,this._localTransform._rotation22=i.e22;let n=this._ptransform,s=this._localTransform;n._positionX=s._positionX,n._positionY=s._positionY,n._positionZ=s._positionZ,n._rotation00=s._rotation00,n._rotation01=s._rotation01,n._rotation02=s._rotation02,n._rotation10=s._rotation10,n._rotation11=s._rotation11,n._rotation12=s._rotation12,n._rotation20=s._rotation20,n._rotation21=s._rotation21,n._rotation22=s._rotation22;let o=this._transform,r=this._localTransform;o._positionX=r._positionX,o._positionY=r._positionY,o._positionZ=r._positionZ,o._rotation00=r._rotation00,o._rotation01=r._rotation01,o._rotation02=r._rotation02,o._rotation10=r._rotation10,o._rotation11=r._rotation11,o._rotation12=r._rotation12,o._rotation20=r._rotation20,o._rotation21=r._rotation21,o._rotation22=r._rotation22,this._restitution=t.restitution,this._friction=t.friction,this._density=t.density,this._geom=t.geometry,this._collisionGroup=t.collisionGroup,this._collisionMask=t.collisionMask,this._contactCallback=t.contactCallback,this._aabb=new y.collision.geometry.Aabb,this._proxy=null,this.displacement=new y.common.Vec3}getFriction(){return this._friction}setFriction(t){this._friction=t}getRestitution(){return this._restitution}setRestitution(t){this._restitution=t}getLocalTransform(){let t=this._localTransform,e=new y.common.Transform;return e._positionX=t._positionX,e._positionY=t._positionY,e._positionZ=t._positionZ,e._rotation00=t._rotation00,e._rotation01=t._rotation01,e._rotation02=t._rotation02,e._rotation10=t._rotation10,e._rotation11=t._rotation11,e._rotation12=t._rotation12,e._rotation20=t._rotation20,e._rotation21=t._rotation21,e._rotation22=t._rotation22,e}getLocalTransformTo(t){let e=this._localTransform;t._positionX=e._positionX,t._positionY=e._positionY,t._positionZ=e._positionZ,t._rotation00=e._rotation00,t._rotation01=e._rotation01,t._rotation02=e._rotation02,t._rotation10=e._rotation10,t._rotation11=e._rotation11,t._rotation12=e._rotation12,t._rotation20=e._rotation20,t._rotation21=e._rotation21,t._rotation22=e._rotation22}getTransform(){let t=this._transform,e=new y.common.Transform;return e._positionX=t._positionX,e._positionY=t._positionY,e._positionZ=t._positionZ,e._rotation00=t._rotation00,e._rotation01=t._rotation01,e._rotation02=t._rotation02,e._rotation10=t._rotation10,e._rotation11=t._rotation11,e._rotation12=t._rotation12,e._rotation20=t._rotation20,e._rotation21=t._rotation21,e._rotation22=t._rotation22,e}getTransformTo(t){let e=this._transform;t._positionX=e._positionX,t._positionY=e._positionY,t._positionZ=e._positionZ,t._rotation00=e._rotation00,t._rotation01=e._rotation01,t._rotation02=e._rotation02,t._rotation10=e._rotation10,t._rotation11=e._rotation11,t._rotation12=e._rotation12,t._rotation20=e._rotation20,t._rotation21=e._rotation21,t._rotation22=e._rotation22}setLocalTransform(t){let e=this._localTransform;if(e._positionX=t._positionX,e._positionY=t._positionY,e._positionZ=t._positionZ,e._rotation00=t._rotation00,e._rotation01=t._rotation01,e._rotation02=t._rotation02,e._rotation10=t._rotation10,e._rotation11=t._rotation11,e._rotation12=t._rotation12,e._rotation20=t._rotation20,e._rotation21=t._rotation21,e._rotation22=t._rotation22,this._rigidBody!=null){let i=this._rigidBody;i.updateMass();let n=i._shapeList;for(;n!=null;){let s=n._next,o=i._ptransform,r=i._transform,_=n._ptransform,a=n._localTransform,l,h,m,f,p,d,u,g,v;l=o._rotation00*a._rotation00+o._rotation01*a._rotation10+o._rotation02*a._rotation20,h=o._rotation00*a._rotation01+o._rotation01*a._rotation11+o._rotation02*a._rotation21,m=o._rotation00*a._rotation02+o._rotation01*a._rotation12+o._rotation02*a._rotation22,f=o._rotation10*a._rotation00+o._rotation11*a._rotation10+o._rotation12*a._rotation20,p=o._rotation10*a._rotation01+o._rotation11*a._rotation11+o._rotation12*a._rotation21,d=o._rotation10*a._rotation02+o._rotation11*a._rotation12+o._rotation12*a._rotation22,u=o._rotation20*a._rotation00+o._rotation21*a._rotation10+o._rotation22*a._rotation20,g=o._rotation20*a._rotation01+o._rotation21*a._rotation11+o._rotation22*a._rotation21,v=o._rotation20*a._rotation02+o._rotation21*a._rotation12+o._rotation22*a._rotation22,_._rotation00=l,_._rotation01=h,_._rotation02=m,_._rotation10=f,_._rotation11=p,_._rotation12=d,_._rotation20=u,_._rotation21=g,_._rotation22=v;let x,b,Y;x=o._rotation00*a._positionX+o._rotation01*a._positionY+o._rotation02*a._positionZ,b=o._rotation10*a._positionX+o._rotation11*a._positionY+o._rotation12*a._positionZ,Y=o._rotation20*a._positionX+o._rotation21*a._positionY+o._rotation22*a._positionZ,_._positionX=x,_._positionY=b,_._positionZ=Y,_._positionX+=o._positionX,_._positionY+=o._positionY,_._positionZ+=o._positionZ;let w=n._transform,Z=n._localTransform,X,M,z,T,F,P,A,L,S;X=r._rotation00*Z._rotation00+r._rotation01*Z._rotation10+r._rotation02*Z._rotation20,M=r._rotation00*Z._rotation01+r._rotation01*Z._rotation11+r._rotation02*Z._rotation21,z=r._rotation00*Z._rotation02+r._rotation01*Z._rotation12+r._rotation02*Z._rotation22,T=r._rotation10*Z._rotation00+r._rotation11*Z._rotation10+r._rotation12*Z._rotation20,F=r._rotation10*Z._rotation01+r._rotation11*Z._rotation11+r._rotation12*Z._rotation21,P=r._rotation10*Z._rotation02+r._rotation11*Z._rotation12+r._rotation12*Z._rotation22,A=r._rotation20*Z._rotation00+r._rotation21*Z._rotation10+r._rotation22*Z._rotation20,L=r._rotation20*Z._rotation01+r._rotation21*Z._rotation11+r._rotation22*Z._rotation21,S=r._rotation20*Z._rotation02+r._rotation21*Z._rotation12+r._rotation22*Z._rotation22,w._rotation00=X,w._rotation01=M,w._rotation02=z,w._rotation10=T,w._rotation11=F,w._rotation12=P,w._rotation20=A,w._rotation21=L,w._rotation22=S;let R,E,C;R=r._rotation00*Z._positionX+r._rotation01*Z._positionY+r._rotation02*Z._positionZ,E=r._rotation10*Z._positionX+r._rotation11*Z._positionY+r._rotation12*Z._positionZ,C=r._rotation20*Z._positionX+r._rotation21*Z._positionY+r._rotation22*Z._positionZ,w._positionX=R,w._positionY=E,w._positionZ=C,w._positionX+=r._positionX,w._positionY+=r._positionY,w._positionZ+=r._positionZ;let k,V,B,J,I,G;if(n._geom._computeAabb(n._aabb,n._ptransform),k=n._aabb._minX,V=n._aabb._minY,B=n._aabb._minZ,J=n._aabb._maxX,I=n._aabb._maxY,G=n._aabb._maxZ,n._geom._computeAabb(n._aabb,n._transform),n._aabb._minX=k<n._aabb._minX?k:n._aabb._minX,n._aabb._minY=V<n._aabb._minY?V:n._aabb._minY,n._aabb._minZ=B<n._aabb._minZ?B:n._aabb._minZ,n._aabb._maxX=J>n._aabb._maxX?J:n._aabb._maxX,n._aabb._maxY=I>n._aabb._maxY?I:n._aabb._maxY,n._aabb._maxZ=G>n._aabb._maxZ?G:n._aabb._maxZ,n._proxy!=null){let D,et,$;D=n._transform._positionX-n._ptransform._positionX,et=n._transform._positionY-n._ptransform._positionY,$=n._transform._positionZ-n._ptransform._positionZ;let j=n.displacement;j.x=D,j.y=et,j.z=$,n._rigidBody._world._broadPhase.moveProxy(n._proxy,n._aabb,n.displacement)}n=s}}}getDensity(){return this._density}setDensity(t){if(this._density=t,this._rigidBody!=null){let e=this._rigidBody;e.updateMass();let i=e._shapeList;for(;i!=null;){let n=i._next,s=e._ptransform,o=e._transform,r=i._ptransform,_=i._localTransform,a,l,h,m,f,p,d,u,g;a=s._rotation00*_._rotation00+s._rotation01*_._rotation10+s._rotation02*_._rotation20,l=s._rotation00*_._rotation01+s._rotation01*_._rotation11+s._rotation02*_._rotation21,h=s._rotation00*_._rotation02+s._rotation01*_._rotation12+s._rotation02*_._rotation22,m=s._rotation10*_._rotation00+s._rotation11*_._rotation10+s._rotation12*_._rotation20,f=s._rotation10*_._rotation01+s._rotation11*_._rotation11+s._rotation12*_._rotation21,p=s._rotation10*_._rotation02+s._rotation11*_._rotation12+s._rotation12*_._rotation22,d=s._rotation20*_._rotation00+s._rotation21*_._rotation10+s._rotation22*_._rotation20,u=s._rotation20*_._rotation01+s._rotation21*_._rotation11+s._rotation22*_._rotation21,g=s._rotation20*_._rotation02+s._rotation21*_._rotation12+s._rotation22*_._rotation22,r._rotation00=a,r._rotation01=l,r._rotation02=h,r._rotation10=m,r._rotation11=f,r._rotation12=p,r._rotation20=d,r._rotation21=u,r._rotation22=g;let v,x,b;v=s._rotation00*_._positionX+s._rotation01*_._positionY+s._rotation02*_._positionZ,x=s._rotation10*_._positionX+s._rotation11*_._positionY+s._rotation12*_._positionZ,b=s._rotation20*_._positionX+s._rotation21*_._positionY+s._rotation22*_._positionZ,r._positionX=v,r._positionY=x,r._positionZ=b,r._positionX+=s._positionX,r._positionY+=s._positionY,r._positionZ+=s._positionZ;let Y=i._transform,w=i._localTransform,Z,X,M,z,T,F,P,A,L;Z=o._rotation00*w._rotation00+o._rotation01*w._rotation10+o._rotation02*w._rotation20,X=o._rotation00*w._rotation01+o._rotation01*w._rotation11+o._rotation02*w._rotation21,M=o._rotation00*w._rotation02+o._rotation01*w._rotation12+o._rotation02*w._rotation22,z=o._rotation10*w._rotation00+o._rotation11*w._rotation10+o._rotation12*w._rotation20,T=o._rotation10*w._rotation01+o._rotation11*w._rotation11+o._rotation12*w._rotation21,F=o._rotation10*w._rotation02+o._rotation11*w._rotation12+o._rotation12*w._rotation22,P=o._rotation20*w._rotation00+o._rotation21*w._rotation10+o._rotation22*w._rotation20,A=o._rotation20*w._rotation01+o._rotation21*w._rotation11+o._rotation22*w._rotation21,L=o._rotation20*w._rotation02+o._rotation21*w._rotation12+o._rotation22*w._rotation22,Y._rotation00=Z,Y._rotation01=X,Y._rotation02=M,Y._rotation10=z,Y._rotation11=T,Y._rotation12=F,Y._rotation20=P,Y._rotation21=A,Y._rotation22=L;let S,R,E;S=o._rotation00*w._positionX+o._rotation01*w._positionY+o._rotation02*w._positionZ,R=o._rotation10*w._positionX+o._rotation11*w._positionY+o._rotation12*w._positionZ,E=o._rotation20*w._positionX+o._rotation21*w._positionY+o._rotation22*w._positionZ,Y._positionX=S,Y._positionY=R,Y._positionZ=E,Y._positionX+=o._positionX,Y._positionY+=o._positionY,Y._positionZ+=o._positionZ;let C,k,V,B,J,I;if(i._geom._computeAabb(i._aabb,i._ptransform),C=i._aabb._minX,k=i._aabb._minY,V=i._aabb._minZ,B=i._aabb._maxX,J=i._aabb._maxY,I=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=C<i._aabb._minX?C:i._aabb._minX,i._aabb._minY=k<i._aabb._minY?k:i._aabb._minY,i._aabb._minZ=V<i._aabb._minZ?V:i._aabb._minZ,i._aabb._maxX=B>i._aabb._maxX?B:i._aabb._maxX,i._aabb._maxY=J>i._aabb._maxY?J:i._aabb._maxY,i._aabb._maxZ=I>i._aabb._maxZ?I:i._aabb._maxZ,i._proxy!=null){let G,D,et;G=i._transform._positionX-i._ptransform._positionX,D=i._transform._positionY-i._ptransform._positionY,et=i._transform._positionZ-i._ptransform._positionZ;let $=i.displacement;$.x=G,$.y=D,$.z=et,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=n}}}getAabb(){return this._aabb.clone()}getAabbTo(t){t.copyFrom(this._aabb)}getGeometry(){return this._geom}getRigidBody(){return this._rigidBody}getCollisionGroup(){return this._collisionGroup}setCollisionGroup(t){this._collisionGroup=t}getCollisionMask(){return this._collisionMask}setCollisionMask(t){this._collisionMask=t}getContactCallback(){return this._contactCallback}setContactCallback(t){this._contactCallback=t}getPrev(){return this._prev}getNext(){return this._next}};y.dynamics.rigidbody.ShapeConfig=class{constructor(){this.position=new y.common.Vec3,this.rotation=new y.common.Mat3,this.friction=y.common.Setting.defaultFriction,this.restitution=y.common.Setting.defaultRestitution,this.density=y.common.Setting.defaultDensity,this.collisionGroup=y.common.Setting.defaultCollisionGroup,this.collisionMask=y.common.Setting.defaultCollisionMask,this.geometry=null,this.contactCallback=null}};y.m||(y.m={});y.m.M=class{};y.collision.broadphase.BroadPhaseType._BRUTE_FORCE=1;y.collision.broadphase.BroadPhaseType._BVH=2;y.collision.broadphase.BroadPhaseType.BRUTE_FORCE=1;y.collision.broadphase.BroadPhaseType.BVH=2;y.collision.broadphase.bvh.BvhInsertionStrategy.SIMPLE=0;y.collision.broadphase.bvh.BvhInsertionStrategy.MINIMIZE_SURFACE_AREA=1;y.collision.geometry.GeometryType._SPHERE=0;y.collision.geometry.GeometryType._BOX=1;y.collision.geometry.GeometryType._CYLINDER=2;y.collision.geometry.GeometryType._CONE=3;y.collision.geometry.GeometryType._CAPSULE=4;y.collision.geometry.GeometryType._CONVEX_HULL=5;y.collision.geometry.GeometryType._CONVEX_MIN=0;y.collision.geometry.GeometryType._CONVEX_MAX=5;y.collision.geometry.GeometryType.SPHERE=0;y.collision.geometry.GeometryType.BOX=1;y.collision.geometry.GeometryType.CYLINDER=2;y.collision.geometry.GeometryType.CONE=3;y.collision.geometry.GeometryType.CAPSULE=4;y.collision.geometry.GeometryType.CONVEX_HULL=5;y.collision.narrowphase.detector.BoxBoxDetector.EDGE_BIAS_MULT=1;y.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.OK=0;y.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.INVALID_TRIANGLE=1;y.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_PAIR_INDEX=2;y.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_TRIANGLE=3;y.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.EDGE_LOOP_BROKEN=4;y.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_OUTER_TRIANGLE=5;y.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.TRIANGLE_INVISIBLE=6;y.collision.narrowphase.detector.gjkepa.EpaTriangle.count=0;y.common.Vec3.numCreations=0;y.common.Setting.defaultFriction=.2;y.common.Setting.defaultRestitution=.2;y.common.Setting.defaultDensity=1;y.common.Setting.defaultCollisionGroup=1;y.common.Setting.defaultCollisionMask=1;y.common.Setting.maxTranslationPerStep=20;y.common.Setting.maxRotationPerStep=3.14159265358979;y.common.Setting.bvhProxyPadding=.1;y.common.Setting.bvhIncrementalCollisionThreshold=.45;y.common.Setting.defaultGJKMargin=.05;y.common.Setting.enableGJKCaching=!0;y.common.Setting.maxEPAVertices=128;y.common.Setting.maxEPAPolyhedronFaces=128;y.common.Setting.contactEnableBounceThreshold=.5;y.common.Setting.velocityBaumgarte=.2;y.common.Setting.positionSplitImpulseBaumgarte=.4;y.common.Setting.positionNgsBaumgarte=1;y.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold=.05;y.common.Setting.defaultContactPositionCorrectionAlgorithm=0;y.common.Setting.alternativeContactPositionCorrectionAlgorithm=1;y.common.Setting.contactPersistenceThreshold=.05;y.common.Setting.maxManifoldPoints=4;y.common.Setting.defaultJointConstraintSolverType=0;y.common.Setting.defaultJointPositionCorrectionAlgorithm=0;y.common.Setting.jointWarmStartingFactorForBaungarte=.8;y.common.Setting.jointWarmStartingFactor=.95;y.common.Setting.minSpringDamperDampingRatio=1e-6;y.common.Setting.minRagdollMaxSwingAngle=1e-6;y.common.Setting.maxJacobianRows=6;y.common.Setting.directMlcpSolverEps=1e-9;y.common.Setting.islandInitialRigidBodyArraySize=128;y.common.Setting.islandInitialConstraintArraySize=128;y.common.Setting.sleepingVelocityThreshold=.2;y.common.Setting.sleepingAngularVelocityThreshold=.5;y.common.Setting.sleepingTimeThreshold=1;y.common.Setting.disableSleeping=!1;y.common.Setting.linearSlop=.005;y.common.Setting.angularSlop=.017453292519943278;y.collision.narrowphase.detector.gjkepa.GjkEpa.instance=new y.collision.narrowphase.detector.gjkepa.GjkEpa;y.collision.narrowphase.detector.gjkepa.GjkEpaResultState._SUCCEEDED=0;y.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_FAILED_TO_MAKE_TETRAHEDRON=1;y.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_DID_NOT_CONVERGE=2;y.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_INIT=257;y.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_ADD_VERTEX=258;y.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_DID_NOT_CONVERGE=259;y.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED=0;y.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_FAILED_TO_MAKE_TETRAHEDRON=1;y.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_DID_NOT_CONVERGE=2;y.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT=257;y.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX=258;y.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE=259;y.common.Mat3.numCreations=0;y.common.Mat4.numCreations=0;y.common.MathUtil.POSITIVE_INFINITY=1/0;y.common.MathUtil.NEGATIVE_INFINITY=-1/0;y.common.MathUtil.PI=3.14159265358979;y.common.MathUtil.TWO_PI=6.28318530717958;y.common.MathUtil.HALF_PI=1.570796326794895;y.common.MathUtil.TO_RADIANS=.017453292519943278;y.common.MathUtil.TO_DEGREES=57.29577951308238;y.common.Quat.numCreations=0;y.dynamics.common.DebugDraw.SPHERE_PHI_DIVISION=8;y.dynamics.common.DebugDraw.SPHERE_THETA_DIVISION=4;y.dynamics.common.DebugDraw.CIRCLE_THETA_DIVISION=8;y.dynamics.common.Performance.broadPhaseCollisionTime=0;y.dynamics.common.Performance.narrowPhaseCollisionTime=0;y.dynamics.common.Performance.dynamicsTime=0;y.dynamics.common.Performance.totalTime=0;y.dynamics.constraint.PositionCorrectionAlgorithm._BAUMGARTE=0;y.dynamics.constraint.PositionCorrectionAlgorithm._SPLIT_IMPULSE=1;y.dynamics.constraint.PositionCorrectionAlgorithm._NGS=2;y.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE=0;y.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE=1;y.dynamics.constraint.PositionCorrectionAlgorithm.NGS=2;y.dynamics.constraint.info.JacobianRow.BIT_LINEAR_SET=1;y.dynamics.constraint.info.JacobianRow.BIT_ANGULAR_SET=2;y.dynamics.constraint.joint.JointType._SPHERICAL=0;y.dynamics.constraint.joint.JointType._REVOLUTE=1;y.dynamics.constraint.joint.JointType._CYLINDRICAL=2;y.dynamics.constraint.joint.JointType._PRISMATIC=3;y.dynamics.constraint.joint.JointType._UNIVERSAL=4;y.dynamics.constraint.joint.JointType._RAGDOLL=5;y.dynamics.constraint.joint.JointType._GENERIC=6;y.dynamics.constraint.joint.JointType.SPHERICAL=0;y.dynamics.constraint.joint.JointType.REVOLUTE=1;y.dynamics.constraint.joint.JointType.CYLINDRICAL=2;y.dynamics.constraint.joint.JointType.PRISMATIC=3;y.dynamics.constraint.joint.JointType.UNIVERSAL=4;y.dynamics.constraint.joint.JointType.RAGDOLL=5;y.dynamics.constraint.joint.JointType.GENERIC=6;y.dynamics.constraint.solver.ConstraintSolverType._ITERATIVE=0;y.dynamics.constraint.solver.ConstraintSolverType._DIRECT=1;y.dynamics.constraint.solver.ConstraintSolverType.ITERATIVE=0;y.dynamics.constraint.solver.ConstraintSolverType.DIRECT=1;y.dynamics.rigidbody.RigidBodyType._DYNAMIC=0;y.dynamics.rigidbody.RigidBodyType._STATIC=1;y.dynamics.rigidbody.RigidBodyType._KINEMATIC=2;y.dynamics.rigidbody.RigidBodyType.DYNAMIC=0;y.dynamics.rigidbody.RigidBodyType.STATIC=1;y.dynamics.rigidbody.RigidBodyType.KINEMATIC=2;y.dynamics.World;y.dynamics.rigidbody.RigidBodyType;y.dynamics.rigidbody.RigidBodyConfig;y.dynamics.rigidbody.RigidBody;y.dynamics.rigidbody.ShapeConfig;y.dynamics.rigidbody.Shape;y.dynamics.constraint.joint.SphericalJointConfig;y.dynamics.constraint.joint.SphericalJoint;y.dynamics.constraint.joint.RevoluteJointConfig;y.dynamics.constraint.joint.RevoluteJoint;y.dynamics.constraint.joint.CylindricalJointConfig;y.dynamics.constraint.joint.CylindricalJoint;y.dynamics.constraint.joint.PrismaticJointConfig;y.dynamics.constraint.joint.PrismaticJoint;y.dynamics.constraint.joint.UniversalJointConfig;y.dynamics.constraint.joint.UniversalJoint;y.dynamics.constraint.joint.RagdollJointConfig;y.dynamics.constraint.joint.RagdollJoint;y.dynamics.constraint.joint.GenericJointConfig;y.dynamics.constraint.joint.GenericJoint;y.dynamics.constraint.joint.JointConfig;y.dynamics.constraint.joint.Joint;y.dynamics.constraint.joint.SpringDamper;y.dynamics.constraint.joint.TranslationalLimitMotor;y.dynamics.constraint.joint.RotationalLimitMotor;y.common.Vec3;y.common.Quat;y.common.Mat3;y.common.MathUtil;y.common.Transform;y.common.Setting;y.collision.geometry.CapsuleGeometry;y.collision.geometry.ConvexHullGeometry;y.collision.geometry.BoxGeometry;y.collision.geometry.SphereGeometry;y.collision.geometry.CylinderGeometry;y.collision.geometry.ConeGeometry;y.collision.geometry.Geometry;y.dynamics.callback.RayCastClosest;y.dynamics.callback.ContactCallback;y.dynamics.World;y.dynamics.rigidbody.RigidBodyType;y.dynamics.rigidbody.RigidBodyConfig;y.dynamics.rigidbody.RigidBody;y.dynamics.rigidbody.ShapeConfig;y.dynamics.rigidbody.Shape;y.dynamics.constraint.joint.SphericalJointConfig;y.dynamics.constraint.joint.SphericalJoint;y.dynamics.constraint.joint.RevoluteJointConfig;y.dynamics.constraint.joint.RevoluteJoint;y.dynamics.constraint.joint.CylindricalJointConfig;y.dynamics.constraint.joint.CylindricalJoint;y.dynamics.constraint.joint.PrismaticJointConfig;y.dynamics.constraint.joint.PrismaticJoint;y.dynamics.constraint.joint.UniversalJointConfig;y.dynamics.constraint.joint.UniversalJoint;y.dynamics.constraint.joint.RagdollJointConfig;y.dynamics.constraint.joint.RagdollJoint;y.dynamics.constraint.joint.GenericJointConfig;y.dynamics.constraint.joint.GenericJoint;y.dynamics.constraint.joint.Joint;y.common.Vec3;y.common.Quat;y.collision.geometry.BoxGeometry;y.collision.geometry.SphereGeometry;y.dynamics.callback.ContactCallback;var w2=`
float random(vec2 co) {
    float a = 12.9898;
    float b = 78.233;
    float c = 43758.5453;
    float dt = dot(co.xy, vec2(a, b));
    float sn = mod(dt, 3.14);
    return fract(sin(sn) * c);
}
`,X2=`
${w2}

vec3 dither(vec3 color) {
    // Calculate grid position
    float grid_position = random(gl_FragCoord.xy);

    // Shift the individual colors differently, thus making it even harder to see the dithering pattern
    vec3 dither_shift_RGB = vec3(0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0);

    // Modify shift acording to grid position
    dither_shift_RGB = mix(2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position);

    // Shift the color by dither_shift
    return color + dither_shift_RGB;
}
`,z2=`
in vec3 position;
in vec2 uv;

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;

uniform mat3 uMapTransform;
uniform mat4 uMatrix;

out vec2 vUv;
out vec4 vCoord;

void main() {
    vUv = (uMapTransform * vec3(uv, 1.0)).xy;
    vCoord = uMatrix * vec4(position, 1.0);

    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,I2=`
float blendOverlay(float x, float y) {
    return (x < 0.5) ? (2.0 * x * y) : (1.0 - 2.0 * (1.0 - x) * (1.0 - y));
}

vec4 blendOverlay(vec4 x, vec4 y, float opacity) {
    vec4 z = vec4(blendOverlay(x.r, y.r), blendOverlay(x.g, y.g), blendOverlay(x.b, y.b), blendOverlay(x.a, y.a));
    return z * opacity + x * (1.0 - opacity);
}
`,Y2=`
precision highp float;

uniform sampler2D tMap;
uniform sampler2D tReflect;
uniform vec3 uColor;

#ifdef USE_FOG
    uniform vec3 uFogColor;
    uniform float uFogNear;
    uniform float uFogFar;
#endif

in vec2 vUv;
in vec4 vCoord;

out vec4 FragColor;

${I2}
${X2}

void main() {
    vec4 base = texture(tMap, vUv);
    vec4 blend = textureProj(tReflect, vCoord);

    FragColor = base * blend;

    base = FragColor;
    blend = vec4(uColor, 1.0);

    FragColor = blendOverlay(base, blend, 1.0);

    #ifdef USE_FOG
        float fogDepth = gl_FragCoord.z / gl_FragCoord.w;
        float fogFactor = smoothstep(uFogNear, uFogFar, fogDepth);

        FragColor.rgb = mix(FragColor.rgb, uFogColor, fogFactor);
    #endif

    #ifdef DITHERING
        FragColor.rgb = dither(FragColor.rgb);
    #endif

    FragColor.a = 1.0;
}
`;class Z2 extends Do{constructor({color:t=new fi(8355711),map:e=null,fog:i=null,dithering:n=!1}={}){const s={glslVersion:yo,defines:{},uniforms:{tMap:new Ni(null),tReflect:new Ni(null),uMapTransform:new Ni(new Wi),uMatrix:new Ni(new xi),uColor:new Ni(t instanceof fi?t:new fi(t))},vertexShader:z2,fragmentShader:Y2,blending:Yn};e&&(e.updateMatrix(),s.uniforms=Object.assign(s.uniforms,{tMap:new Ni(e),uMapTransform:new Ni(e.matrix)})),i&&(s.defines=Object.assign(s.defines,{USE_FOG:""}),s.uniforms=Object.assign(s.uniforms,{uFogColor:new Ni(i.color),uFogNear:new Ni(i.near),uFogFar:new Ni(i.far)})),n&&(s.defines=Object.assign(s.defines,{DITHERING:""})),super(s)}}class S2{constructor(){li(this,"camera",new Sc);li(this,"orbitControl");this.camera.fov=75}init(){}setOrbitControl(t){const e=new Lc(this.camera,t);e.enableDamping=!0,this.orbitControl=e}}class L2{constructor(){li(this,"axesHelper",new Ac(1));li(this,"scene",new Tc);li(this,"setAxesHelper",(t=!0)=>{(typeof t=="boolean"?t:!1)?this.scene.add(this.axesHelper):this.scene.remove(this.axesHelper)})}}class A2{constructor(t){li(this,"renderer");this.renderer=new Vc({canvas:t,alpha:!1})}init(){}}class T2{constructor(t,e){li(this,"worldController");li(this,"gui",new cc({closed:!0}));this.worldController=t,this.fixGui(e)}fixGui(t){const e=this.gui.domElement.parentElement;t.appendChild(e)}init(){const{testLight:t,cameraController:e,animationController:i}=this.worldController;this.gui.add(t.position,"y").setValue(20).min(-100).max(100).step(.1),this.gui.add(t.position,"z").setValue(100).min(-100).max(100).step(.1),this.gui.add(i,"isScroll").setValue(!0),this.gui.add(e.camera.position,"z").setValue(37).min(-200).max(37).step(.1);const n={color:"#ffffff"};this.gui.addColor(n,"color").onChange(o=>{vn.material.emissive.setHex(parseInt(o.slice(1),16)),vn.material.color.setHex(parseInt(o.slice(1),16))});const s={metalness:0};this.gui.add(s,"metalness").min(0).max(1).step(.01).onChange(o=>{vn.material.metalness=o})}}class V2{constructor(t){li(this,"clock");li(this,"worldController");li(this,"isStop",!1);li(this,"privateTime",0);li(this,"isScroll",!0);li(this,"scrollProgress",0);li(this,"onScroll",()=>{const t=document.documentElement.scrollTop||document.body.scrollTop,e=document.documentElement.clientHeight,i=document.documentElement.offsetHeight,n=t/(i-e);this.scrollProgress=n});this.worldController=t,this.clock=t.clock}update(){if(this.isStop)return;const t=this.clock.getElapsedTime(),e=t-this.privateTime;this.privateTime=t;const i=[-100,75],n=[0,80],s=this.worldController.testLight;let r=s.position.z+e*30;r=r+(r>i[1]?i[0]-i[1]:0),s.position.z=r;const _=(r-i[0])/(i[1]-i[0]),a=.7,l=.58;if(_>a){const u=n[0]+(n[1]-n[0])*(1-(_-a)/(1-a));s.intensity=u}else if(_<l){const u=n[0]+(n[1]-n[0])*(_/(1-l));s.intensity=u}else _<.7&&(s.intensity=n[0]);const h=[5,20],f=this.worldController.cameraController.camera.position.z;let p=0,d=0;if(f<h[0]?(d=255,p=0):f<h[1]||(d=0,p=1),vn.material.emissive.setRGB(d,d,d),vn.material.color.setRGB(d,d,d),vn.material.metalness=p,this.isScroll){const u=[-192,37],g=u[0]+(u[1]-u[0])*this.scrollProgress;this.worldController.cameraController.camera.position.z=g}}}class E2{constructor(t){li(this,"view");li(this,"clock",new Ic);li(this,"cameraController",new S2);li(this,"sceneController",new L2);li(this,"animationController",new V2(this));li(this,"renderManager");li(this,"guiController");li(this,"testLight");this.view=t,this.renderManager=new A2(this.view.canvasEl)}addGui(t){this.guiController=new T2(this,t)}async init(){var r;this.sceneController.setAxesHelper(!1),this.cameraController.init(),this.sceneController.scene.add(this.cameraController.camera),this.cameraController.camera.position.x=0,this.cameraController.camera.position.y=1.7,this.cameraController.camera.position.z=20,this.cameraController.camera.lookAt(0,1.7,-200),this.renderManager.init(),this.testLight=new Yc(16777215,50,1e3),this.sceneController.scene.add(this.testLight),this.testLight.position.set(0,20,100);const t=new Zc({color:0,emissive:1118481,flatShading:!0}),e=await In.gltfLoader.loadAsync(Rc);this.sceneController.scene.add(e.scene),e.scene.traverse(_=>{const a=_;a.isMesh&&(a.material=t)});let i;Array(10).fill([-200,20]).map((_,a)=>{const l=_[0]+_[1]*a;i=new vn,i.initMesh(),i.position.z=l,this.sceneController.scene.add(i)});const n=this.sceneController.scene;class s extends Sr{constructor(){super();li(this,"reflector",new rh);li(this,"resize",(l,h)=>{l=Bc(l)/2,h=1024,this.reflector.setSize(l,h)});this.initReflector()}initReflector(){this.reflector=new rh}async initMesh(){const l=new Ec(100,500),h=new Cc,m=(await yc(()=>import("./polished_concrete_basecolor-2f072720.js"),[])).default,f=await h.loadAsync(m);f.wrapS=wl,f.wrapT=wl,f.repeat.set(16,16);const{fog:p}=n,d=new Z2({map:f,fog:p,dithering:!0});d.uniforms.tReflect=this.reflector.renderTargetUniform,d.uniforms.uMatrix=this.reflector.textureMatrixUniform;const u=new lh(l,d);u.position.z=-200,u.rotation.x=-Math.PI/2,u.add(this.reflector),u.onBeforeRender=(g,v,x)=>{this.visible=!1,this.reflector.update(g,v,x),this.visible=!0},this.add(u)}}const o=new s;this.sceneController.scene.add(o),o.initMesh(),(r=this.guiController)==null||r.init()}resize(t,e){this.cameraController.camera.aspect=t/e,this.cameraController.camera.updateProjectionMatrix(),this.renderManager.renderer.setSize(t,e),this.renderManager.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2))}render(){var t;(t=this.cameraController.orbitControl)==null||t.update(),this.animationController.update(),this.renderManager.renderer.render(this.sceneController.scene,this.cameraController.camera)}}const Bs=class{constructor(t,e){li(this,"canvasEl");li(this,"viewraperEl");li(this,"size",new Bs.Size);li(this,"worldController");li(this,"resize",()=>{this.size.width/this.size.height>1;const t=this.viewraperEl?this.viewraperEl.offsetWidth:0,e=this.viewraperEl?this.viewraperEl.offsetHeight:0;this.size.width=t,this.size.height=e,this.worldController.resize(t,e)});this.canvasEl=t,this.viewraperEl=e;const i=new Xc("/assets/draco/").url;Bs.dracoLoader.setDecoderPath(i),Bs.gltfLoader.setDRACOLoader(Bs.dracoLoader),this.worldController=new E2(this)}init(){this.size.width=this.viewraperEl.offsetWidth,this.size.height=this.viewraperEl.offsetHeight,this.worldController.init(),this.resize()}render(){this.worldController.render(),window.requestAnimationFrame(()=>this.render())}addEventListener(){window.addEventListener("resize",this.resize),window.addEventListener("scroll",this.worldController.animationController.onScroll)}removeEventListener(){var t;window.removeEventListener("resize",this.resize),window.removeEventListener("scroll",this.worldController.animationController.onScroll),(t=this.worldController.guiController)==null||t.gui.destroy()}};let In=Bs;li(In,"dracoLoader",new Mc),li(In,"gltfLoader",new wc),li(In,"svgLoader",new _h);(c=>{class t{constructor(){li(this,"width",1920);li(this,"height",1080)}}c.Size=t})(In||(In={}));var C2=In;const Yo=class extends Sr{constructor(){super()}async initMesh(){const t=await Yo.geometrysPromise,e=new Sr;e.position.set(0,3,0),e.scale.y*=-1,t.forEach(i=>{const n=new lh(i,Yo.material);e.add(n)}),this.add(e)}};let vn=Yo;li(vn,"geometrysPromise",In.svgLoader.loadAsync('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg"><path stroke-width="0.25" d="M 3 0 L 0 5 H 6 Z"/></svg>').then(t=>{var n;const e=[],i=t.paths;for(let s=0,o=i.length;s<o;s++){const r=i[s];for(let _=0,a=r.subPaths.length;_<a;_++){const l=r.subPaths[_],h=_h.pointsToStroke(l.getPoints(),(n=r==null?void 0:r.userData)==null?void 0:n.style);h&&(h.center(),e.push(h))}}return e})),li(vn,"material",new zc({color:16777215,emissive:16777215}));const P2=c=>(xc("data-v-65677168"),c=c(),bc(),c),R2=P2(()=>mo("div",{class:"container"},null,-1)),k2=pc({name:"l00-view",setup(c){const t=Fo(),e=Fo(),i=Fo();let n;return mc(()=>{n==null||n.removeEventListener()}),uc(()=>{const s=t.value,o=i.value,r=e.value;n=new C2(s,o),n.init(),n.worldController.addGui(r),n.addEventListener(),n.render()}),(s,o)=>(Ml(),fc(vc,null,[(Ml(),dc(gc,{to:"body"},[mo("div",{class:"guiwraper",ref_key:"guiwraper",ref:e},null,512)])),mo("div",{class:"viewraper",ref_key:"viewraper",ref:i},[mo("canvas",{ref_key:"canvas",ref:t},null,512)],512),R2],64))}});var _x=Pc(k2,[["__scopeId","data-v-65677168"],["__file","/Volumes/Work/l00 Studio/l00/source/src/graphics-components/l00-view/l00-view.vue"]]);export{_x as default};
