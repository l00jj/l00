var _=Object.defineProperty;var M=(a,e,t)=>e in a?_(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var i=(a,e,t)=>(M(a,typeof e!="symbol"?e+"":e,t),t);import{d as f,r as l,j as L,w as y,o as g,c as w,a as x,J as z,p as b,e as S,g as T}from"./vendor-777cad06.js";import{g as u,G as m,d as A,e as R,T as D,f as P,P as k,O as E,W as F,s as c,Q as j,a as C,D as p,M as o,b as h,h as H,U,X as W,r as I,A as O,S as B}from"./dat.gui.module-e1d34a20.js";import{F as G}from"./FontLoader-712e5c28.js";import{_ as v}from"./plugin-vue_export-helper-4223c0cf.js";class N{constructor(e){i(this,"main");i(this,"isActive",!1);i(this,"ui");this.main=e,window.location.hash.includes("debug")&&this.active()}active(){this.isActive=!0,this.ui=new u,this.fixGui(),this.toWindowTest()}fixGui(){var s;const e=this.main.viewArea,t=(s=this.ui)==null?void 0:s.domElement.parentElement;e.appendChild(t),t.style.position="absolute"}toWindowTest(){window.debugView=this.main}addFolder(e){if(!this.ui||!(this.ui instanceof u))return s=>{};const t=this.ui.addFolder(e);return s=>{s(t)}}destroy(){var e;(e=this.ui)==null||e.destroy(),delete window.debugView}}class ${constructor(e,t){i(this,"function");i(this,"isOnce");this.function=e,this.isOnce=t.isOnce?t.isOnce:!1}}class d{constructor(){i(this,"__emittersMap__",new WeakMap);i(this,"__emitters__",new Map)}on(e,t){if(typeof e!="string"||e===""||typeof t!="function")return!1;let s=this.__emitters__.get(e);if(s||(s=new Set,this.__emitters__.set(e,s)),this.__emittersMap__.has(t))return!1;{const n=new $(t,{isOnce:!1});this.__emittersMap__.set(t,n),s.add(n)}return!0}once(e,t){if(this.on(e,t)){const s=this.__emittersMap__.get(t);if(!s)return!1;s.isOnce=!0}else return!1;return!0}off(e,t){const s=this.__emitters__.get(e);if(!s)return!1;const n=this.__emittersMap__.get(t);return n?(this.__emittersMap__.delete(t),s.delete(n),s.size===0&&this.__emitters__.delete(e),!0):!1}offAll(e){const t=this.__emitters__.get(e);return t?(t.clear(),this.__emitters__.delete(e),!0):!1}clearEvents(){return this.__emitters__.clear(),!0}async emit(e,...t){const s=this.__emitters__.get(e);if(!!s)for(let n of s.values()){try{await n.function.apply(void 0,t)}catch(r){console.error(r)}n.isOnce&&this.off(e,n.function)}}}class V extends d{constructor(t){super();i(this,"viewArea");i(this,"width",0);i(this,"height",0);i(this,"pixelRatio",0);i(this,"onWindowResizeListener",()=>{this.updateSize(),this.emit("resize")});this.viewArea=t,this.updateSize(),this.setWindowResizeEmitter()}updateSize(){this.width=this.viewArea.offsetWidth,this.height=this.viewArea.offsetHeight,this.pixelRatio=Math.min(window.devicePixelRatio,2)}setWindowResizeEmitter(){window.addEventListener("resize",this.onWindowResizeListener)}removeWindowResizeEmitter(){window.removeEventListener("resize",this.onWindowResizeListener)}onResize(t){return this.on("resize",t)}destroy(){return this.removeWindowResizeEmitter(),this.clearEvents()}}class q extends d{constructor(){super();i(this,"start");i(this,"current");i(this,"elapsed");i(this,"delta");i(this,"onTickLoopFunction",()=>{const t=Date.now();this.delta=t-this.current,this.current=t,this.elapsed=this.current-this.start,this.emit("tick"),window.requestAnimationFrame(this.currentTickLoopFunction)});i(this,"currentTickLoopFunction",()=>{});this.start=Date.now(),this.current=this.start,this.elapsed=0,this.delta=16}tick(){this.currentTickLoopFunction!==this.onTickLoopFunction&&(this.currentTickLoopFunction=this.onTickLoopFunction,this.currentTickLoopFunction())}onTick(t){return this.on("tick",t)}destroy(){return this.currentTickLoopFunction=()=>{},this.clearEvents()}}class J extends d{constructor(t){super();i(this,"sources");i(this,"items");i(this,"toLoad");i(this,"loaded");i(this,"loaders",{gltfLoader:new m,gltfDracoLoader:new m().setDRACOLoader(new A().setDecoderPath(new R("/assets/draco/").url)),textureLoader:new D,cubeTextureLoader:new P,fontLoader:new G});i(this,"isReady",!1);this.sources=t,this.items={},this.toLoad=this.sources.length,this.loaded=0,this.startLoading()}startLoading(){if(this.sources.length===0)return this.ready();for(const t of this.sources)if(t.type==="gltfModel")this.loaders.gltfLoader.load(t.path,s=>{this.sourceLoaded(t,s)});else if(t.type==="gltfDracoModel")this.loaders.gltfDracoLoader.load(t.path,s=>{this.sourceLoaded(t,s)});else if(t.type==="texture")this.loaders.textureLoader.load(t.path,s=>{this.sourceLoaded(t,s)});else if(t.type==="cubeTexture")this.loaders.cubeTextureLoader.load(t.path,s=>{this.sourceLoaded(t,s)});else if(t.type==="fontJSON")this.loaders.fontLoader.load(t.path,s=>{this.sourceLoaded(t,s)});else throw`Unknow source.type: ${t.type}`}sourceLoaded(t,s){this.items[t.name]=s,this.loaded++,this.loaded===this.toLoad&&this.ready()}ready(){this.isReady=!0,this.emit("ready")}onReady(t){return this.isReady?t():this.once("ready",t)}}class X{constructor(e){i(this,"main");i(this,"sizes");i(this,"scene");i(this,"canvas");i(this,"instance");i(this,"controls");this.main=e,this.sizes=this.main.sizes,this.scene=this.main.scene,this.canvas=this.main.canvas,this.setInstance(),this.setOrbitControls()}setInstance(){this.instance=new k(75,this.sizes.width/this.sizes.height,.1,100),this.instance.position.set(8,2,-4),this.instance.lookAt(0,0,0),this.scene.add(this.instance)}setOrbitControls(){this.controls=new E(this.instance,this.canvas),this.controls.enableDamping=!0}resize(){this.instance.aspect=this.sizes.width/this.sizes.height,this.instance.updateProjectionMatrix()}update(){this.controls.update()}}class Q{constructor(e){i(this,"main");i(this,"canvas");i(this,"sizes");i(this,"scene");i(this,"camera");i(this,"instance");this.main=e,this.canvas=this.main.canvas,this.sizes=this.main.sizes,this.scene=this.main.scene,this.camera=this.main.camera,this.setInstance()}setInstance(){this.instance=new F({canvas:this.canvas,antialias:!0,alpha:!1}),this.instance.physicallyCorrectLights=!0,this.instance.outputEncoding=c,this.instance.toneMapping=j,this.instance.toneMappingExposure=1,this.instance.shadowMap.enabled=!0,this.instance.shadowMap.type=C,this.instance.setSize(this.sizes.width,this.sizes.height),this.instance.setPixelRatio(this.sizes.pixelRatio)}resize(){this.instance.setSize(this.sizes.width,this.sizes.height),this.instance.setPixelRatio(this.sizes.pixelRatio)}update(){this.instance.render(this.scene,this.camera.instance)}}class Y{constructor(e){i(this,"main");i(this,"scene");i(this,"resources");i(this,"addDebug");i(this,"directionalLight");i(this,"sunLight");i(this,"environmentMap");this.main=e,this.scene=this.main.scene,this.resources=this.main.resources,this.addDebug=this.main.debug.addFolder("environment"),this.setDirectionalLight(),this.setEnvironmentMap()}setDirectionalLight(){this.directionalLight=new p("#ffffff",3),this.directionalLight.castShadow=!0,this.directionalLight.shadow.mapSize.set(1024,1024),this.directionalLight.shadow.camera.far=15,this.directionalLight.shadow.normalBias=.05,this.directionalLight.position.set(.25,2,-2.25),this.scene.add(this.directionalLight)}setSunLight(){this.sunLight=new p("#ffffff",4),this.sunLight.castShadow=!0,this.sunLight.shadow.camera.far=15,this.sunLight.shadow.mapSize.set(1024,1024),this.sunLight.shadow.normalBias=.05,this.sunLight.position.set(3.5,2,-1.25),this.scene.add(this.sunLight),this.addDebug(e=>{e.add(this.sunLight,"intensity").name("sunLightIntensity").min(0).max(10).step(.001),e.add(this.sunLight.position,"x").name("sunLightX").min(-5).max(5).step(.001),e.add(this.sunLight.position,"y").name("sunLightY").min(-5).max(5).step(.001),e.add(this.sunLight.position,"z").name("sunLightZ").min(-5).max(5).step(.001)})}setEnvironmentMap(){this.environmentMap={},this.environmentMap.intensity=.4,this.environmentMap.texture=this.resources.items.environmentMapTexture,this.environmentMap.texture.encoding=c,this.scene.background=this.environmentMap.texture,this.scene.environment=this.environmentMap.texture,this.environmentMap.updateMaterials=()=>{this.scene.traverse(e=>{e instanceof o&&e.material instanceof h&&(e.material.envMap=this.environmentMap.texture,e.material.envMapIntensity=this.environmentMap.intensity,e.material.needsUpdate=!0,e.castShadow=!0,e.receiveShadow=!0)})},this.environmentMap.updateMaterials(),this.addDebug(e=>{e.add(this.environmentMap,"intensity").name("envMapIntensity").min(0).max(4).step(.001).onChange(()=>{this.environmentMap.updateMaterials()})})}}class Z{constructor(e){i(this,"main");i(this,"scene");i(this,"addDebug");i(this,"isShowAxesHelper",!0);i(this,"axesHelper");this.main=e,this.scene=this.main.scene,this.addDebug=this.main.debug.addFolder("AxesHelper"),this.setAxesHelper()}setAxesHelper(){this.addDebug(e=>{this.axesHelper=new H(1),this.toggleAxesHelper(),e.open(),e.add(this,"isShowAxesHelper").onChange(t=>{this.toggleAxesHelper()})})}toggleAxesHelper(e){(typeof e=="boolean"?e:this.isShowAxesHelper)?this.scene.add(this.axesHelper):this.scene.remove(this.axesHelper)}}class K{constructor(e){i(this,"main");i(this,"scene");i(this,"resources");i(this,"time");i(this,"addDebug");i(this,"customUniforms",{uTime:{value:0}});i(this,"material");i(this,"customDepthMaterial");i(this,"resource");i(this,"model");i(this,"testPlane");i(this,"animation");this.main=e,this.scene=this.main.scene,this.resources=this.main.resources,this.time=this.main.time,this.addDebug=this.main.debug.addFolder("Model"),this.setMaterial(),this.setModel(),this.setPlane()}setMaterial(){const e=this.main.resources.items.modelMapTexture;e.encoding=c;const t=this.main.resources.items.modelNormalTexture,s="float angle = sin(position.y + uTime) * 0.5;";this.material=new h({map:e,normalMap:t}),this.material.onBeforeCompile=n=>{n.uniforms.uTime=this.customUniforms.uTime,n.vertexShader=n.vertexShader.replace("#include <common>",`
            #include <common>
            
            uniform float uTime;

            mat2 get2dRotateMatrix(float _angle){
                return mat2(cos(_angle), - sin(_angle), sin(_angle), cos(_angle));
            }

            `),n.vertexShader=n.vertexShader.replace("#include <beginnormal_vertex>",`
            #include <beginnormal_vertex>

            ${s}
            mat2 rotateMatrix = get2dRotateMatrix(angle);


            objectNormal.xz = rotateMatrix * objectNormal.xz;

            `),n.vertexShader=n.vertexShader.replace("#include <begin_vertex>",`
            #include <begin_vertex>
            
            transformed.xz = rotateMatrix * transformed.xz;
            `)},this.customDepthMaterial=new U({depthPacking:W}),this.customDepthMaterial.onBeforeCompile=n=>{n.uniforms.uTime=this.customUniforms.uTime,n.vertexShader=n.vertexShader.replace("#include <common>",`
            #include <common>
            
            uniform float uTime;

            mat2 get2dRotateMatrix(float _angle){
                return mat2(cos(_angle), - sin(_angle), sin(_angle), cos(_angle));
            }
            `),n.vertexShader=n.vertexShader.replace("#include <begin_vertex>",`
            #include <begin_vertex>
            
            ${s}
            mat2 rotateMatrix = get2dRotateMatrix(angle);

            transformed.xz = rotateMatrix * transformed.xz;
            `)}}updateMaterial(){const e=this.time.elapsed/1e3;this.customUniforms.uTime.value=e}setModel(){this.resource=this.main.resources.items.model,this.model=this.resource.scene.children[0],this.model.rotation.y=Math.PI*.5,this.model.material=this.material,this.model.customDepthMaterial=this.customDepthMaterial,this.scene.add(this.model),this.model.traverse(e=>{e instanceof o&&(e.castShadow=!0)})}setPlane(){this.testPlane=new o(new I(15,15,15),new h),this.testPlane.rotation.y=Math.PI,this.testPlane.position.y=-5,this.testPlane.position.z=5,this.scene.add(this.testPlane)}setAnimation(){this.animation={},this.animation.mixer=new O(this.model),this.animation.actions={},this.animation.actions.idle=this.animation.mixer.clipAction(this.resource.animations[0]),this.animation.actions.walking=this.animation.mixer.clipAction(this.resource.animations[1]),this.animation.actions.running=this.animation.mixer.clipAction(this.resource.animations[2]),this.animation.actions.current=this.animation.actions.idle,this.animation.actions.current.play(),this.animation.play=e=>{const t=this.animation.actions[e],s=this.animation.actions.current;t.reset(),t.play(),t.crossFadeFrom(s,1),this.animation.actions.current=t}}update(){this.updateMaterial()}}class ee{constructor(e){i(this,"main");i(this,"scene");i(this,"environment");i(this,"resources");i(this,"axesHelper");i(this,"model");this.main=e,this.scene=this.main.scene,this.resources=this.main.resources,this.resources.onReady(()=>{this.model=new K(this.main),this.environment=new Y(this.main),this.axesHelper=new Z(this.main)})}resize(){}update(){var e;(e=this.model)==null||e.update()}}var te=[{name:"environmentMapTexture",type:"cubeTexture",path:[new URL("/l00/static/jpg/px-a0e41bf9.jpg?url",self.location).href,new URL("/l00/static/jpg/nx-57f73ba7.jpg?url",self.location).href,new URL("/l00/static/jpg/py-7322f97e.jpg?url",self.location).href,new URL("/l00/static/jpg/ny-d209a134.jpg?url",self.location).href,new URL("/l00/static/jpg/pz-b0eb9498.jpg?url",self.location).href,new URL("/l00/static/jpg/nz-fc946930.jpg?url",self.location).href]},{name:"model",type:"gltfModel",path:new URL("/l00/static/glb/LeePerrySmith-402b8a8a.glb?url",self.location).href},{name:"modelMapTexture",type:"texture",path:new URL("/l00/static/jpg/color-e976d73b.jpg?url",self.location).href},{name:"modelNormalTexture",type:"texture",path:new URL("/l00/static/jpg/normal-36925e51.jpg?url",self.location).href}];class ie{constructor(e,t){i(this,"canvas");i(this,"viewArea");i(this,"sizes");i(this,"time");i(this,"scene");i(this,"resources");i(this,"camera");i(this,"renderer");i(this,"world");i(this,"isPlayAnimation",!0);i(this,"debug");this.canvas=e,this.viewArea=t,this.debug=new N(this),this.sizes=new V(t),this.time=new q,this.scene=new B,this.resources=new J(te),this.camera=new X(this),this.renderer=new Q(this),this.world=new ee(this),this.sizes.onResize(()=>this.resize()),this.time.onTick(()=>this.update())}resize(){this.camera.resize(),this.world.resize(),this.renderer.resize()}update(){this.camera.update(),this.world.update(),this.renderer.update()}render(){this.time.tick()}destroy(){this.sizes.destroy(),this.time.destroy(),this.camera.controls.dispose(),this.renderer.instance.dispose(),this.debug.destroy(),this.scene.traverse(e=>{if(e instanceof o){e.geometry.dispose();for(const t in e.material){const s=e.material[t];s&&typeof s.dispose=="function"&&s.dispose()}}})}}const se=a=>(b("data-v-0695a09a"),a=a(),S(),a),ne=se(()=>x("div",{class:"background"},null,-1)),ae=f({name:"l00-ModifiedMaterials",props:{onMounted:{type:Function,required:!1}},setup(a){const e=l(),t=l();let s;return L(async()=>{const n=e.value,r=t.value;s=new ie(n,r),s.render()}),y(()=>{s==null||s.destroy()}),(n,r)=>(g(),w("section",z(n.$attrs,{ref_key:"viewArea",ref:t}),[ne,x("canvas",{class:"",ref_key:"canvas",ref:e},null,512)],16))}});var re=v(ae,[["__scopeId","data-v-0695a09a"],["__file","/Volumes/Work/l00 Studio/l00/source/src/graphics-components/test-modified-materials/l00-ModifiedMaterials.vue"]]);const oe=f({name:"index",setup(a){return(e,t)=>(g(),w("div",null,[T(re)]))}});var me=v(oe,[["__file","/Volumes/Work/l00 Studio/l00/source/src/graphics-components/test-modified-materials/index.vue"]]);export{me as default};
